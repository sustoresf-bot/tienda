{
  "version": 3,
  "sources": ["../components/SustIABot.js"],
  "sourcesContent": ["import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { Send, X, Trash2, CheckCircle, Plus, Info, Star } from 'lucide-react';\n\nconst BotProductCard = ({ product, onAdd }) => {\n    const [qty, setQty] = useState(1);\n    const finalPrice = product.basePrice * (1 - (product.discount || 0) / 100);\n\n    return (\n        <div className=\"min-w-[200px] max-w-[200px] bg-[#1a1a1a] rounded-2xl border border-white/5 overflow-hidden flex flex-col group snap-center\">\n            <div className=\"relative h-28 bg-white p-2\">\n                <img src={product.image} className=\"w-full h-full object-contain group-hover:scale-110 transition duration-500\" alt={product.name} />\n                {product.discount > 0 && (\n                    <div className=\"absolute top-2 left-2 bg-red-600 text-white text-[10px] font-black px-2 py-0.5 rounded-full shadow-lg\">\n                        -{product.discount}%\n                    </div>\n                )}\n            </div>\n            <div className=\"p-3 flex-1 flex flex-col\">\n                <h4 className=\"text-white font-bold text-xs line-clamp-2 mb-2 leading-tight h-8\">{product.name}</h4>\n                <div className=\"mt-auto\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                        <span className=\"text-yellow-500 font-black text-sm\">${Math.round(finalPrice).toLocaleString()}</span>\n                        {product.discount > 0 && (\n                            <span className=\"text-slate-500 text-[10px] line-through\">${product.basePrice.toLocaleString()}</span>\n                        )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"flex bg-black/40 rounded-lg border border-white/5 overflow-hidden\">\n                            <button\n                                onClick={() => setQty(Math.max(1, qty - 1))}\n                                className=\"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition\"\n                            >\n                                -\n                            </button>\n                            <span className=\"px-2 py-1 text-xs text-white font-bold min-w-[24px] text-center\">{qty}</span>\n                            <button\n                                onClick={() => setQty(Math.min(99, qty + 1))}\n                                className=\"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition\"\n                            >\n                                +\n                            </button>\n                        </div>\n                        <button\n                            onClick={() => onAdd(product, qty)}\n                            className=\"flex-1 bg-yellow-600 hover:bg-yellow-500 text-white py-1.5 rounded-lg text-[10px] font-black transition flex items-center justify-center gap-1 shadow-lg shadow-yellow-900/20\"\n                        >\n                            <Plus className=\"w-3 h-3\" /> LISTO\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst SustIABot = React.memo(({ settings, products, addToCart, controlPanel, coupons, appId }) => {\n    // 1. Verificaci√≥n de Plan - Solo disponible en Plan Premium\n    const forceEnabled = (() => {\n        try {\n            const href = String(window.location.href || '');\n            if (href.includes('sustia=1')) return true;\n            return new URLSearchParams(window.location.search).get('sustia') === '1';\n        } catch { return false; }\n    })();\n    if (!forceEnabled && settings?.subscriptionPlan !== 'premium') return null;\n\n    const [isOpen, setIsOpen] = useState(false);\n    const [isDarkMode, setIsDarkMode] = useState(false);\n\n    // Custom Bot Image (Configurable)\n    const botImage = settings?.botImage || \"sustia-ai-v2.jpg\";\n\n    const chatStorageKey = `sustore_sustia_chat_${appId}`;\n    const defaultBotMessage = { role: 'model', text: '¬°Hola! Soy SustIA ü§ñ, tu asistente personal. ¬øBuscas algo especial hoy? Puedo verificar stock y agregar productos a tu carrito.' };\n    const [messages, setMessages] = useState([defaultBotMessage]);\n    const [inputValue, setInputValue] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    const [lastContext, setLastContext] = useState(null); // Para manejar contexto (S√≠/No)\n    const messagesEndRef = useRef(null);\n    const messagesRef = useRef(messages);\n    const inFlightRef = useRef(false);\n    const pendingTextRef = useRef(null);\n    const isMountedRef = useRef(true);\n\n    const safeProducts = Array.isArray(products) ? products : [];\n    const safeCoupons = Array.isArray(coupons) ? coupons : [];\n    const aiEnabled = !!settings?.aiAssistant?.enabled;\n\n    useEffect(() => {\n        const check = () => {\n            try {\n                setIsDarkMode(document?.documentElement?.classList?.contains('dark-mode') === true);\n            } catch {\n                setIsDarkMode(false);\n            }\n        };\n        check();\n\n        let obs;\n        try {\n            obs = new MutationObserver(() => check());\n            if (document?.documentElement) obs.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });\n        } catch { }\n\n        return () => {\n            try { obs?.disconnect?.(); } catch { }\n        };\n    }, []);\n\n    const normalizeText = (value) => {\n        if (value === null || value === undefined) return '';\n        return String(value).toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").trim();\n    };\n\n    const tokenize = (value) => {\n        const t = normalizeText(value);\n        if (!t) return [];\n        const raw = t.split(/[\\s,.;:!?/()\\\\[\\]{}\"‚Äú‚Äù'‚Äô\\-+*_]+/).filter(Boolean);\n        const stop = new Set([\n            'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas',\n            'de', 'del', 'en', 'con', 'sin', 'para', 'por', 'a', 'al',\n            'que', 'como', 'cual', 'cuales', 'donde', 'cuando', 'quien', 'quienes',\n            'hola', 'buenas', 'buenos', 'dia', 'dias', 'tardes', 'noches',\n            'busco', 'buscar', 'tenes', 'tienes', 'precio', 'vale', 'cuesta',\n            'quiero', 'necesito', 'hay', 'me', 'te', 'mi', 'mis', 'tu', 'tus',\n            'agrega', 'agregar', 'agregame', 'agregalo', 'sumar', 'sumame', 'poner', 'pone',\n            'comprar', 'compralo', 'llevo', 'carrito', 'bolsa', 'cesta',\n            'mas', 'menos', 'muy', 'super', 're'\n        ]);\n        return raw.filter(w => w.length > 1 && !stop.has(w) && !/^\\d+$/.test(w));\n    };\n\n    const parseHumanNumber = (rawNumber, contextText) => {\n        if (!rawNumber) return null;\n        const n = parseFloat(String(rawNumber).replace(',', '.'));\n        if (!Number.isFinite(n)) return null;\n        const hasK = contextText.includes(`${rawNumber}k`) || contextText.includes(`${rawNumber} k`) || contextText.includes(`${rawNumber}mil`) || contextText.includes(`${rawNumber} mil`);\n        if (hasK) return n * 1000;\n        return n;\n    };\n\n    const parseQuantity = (t) => {\n        const text = normalizeText(t);\n        const m1 = text.match(/\\b(?:x|por)\\s*(\\d{1,3})\\b/);\n        if (m1) return Math.max(1, Math.min(99, parseInt(m1[1], 10)));\n        const m2 = text.match(/\\b(\\d{1,3})\\s*(?:u|ud|uds|unidad|unidades|pcs|piezas)\\b/);\n        if (m2) return Math.max(1, Math.min(99, parseInt(m2[1], 10)));\n        const m3 = text.match(/\\b(\\d{1,2})\\b/);\n        if (m3 && text.match(/\\b(agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|quiero|llevo|comprar)\\b/)) {\n            return Math.max(1, Math.min(99, parseInt(m3[1], 10)));\n        }\n        return 1;\n    };\n\n    const getProductCategories = (p) => {\n        const cats = [];\n        if (Array.isArray(p?.categories)) cats.push(...p.categories);\n        if (typeof p?.category === 'string' && p.category.trim()) cats.push(p.category);\n        return cats\n            .filter(Boolean)\n            .map(c => String(c).trim())\n            .filter(Boolean);\n    };\n\n    const getProductFinalPrice = (p) => {\n        const base = Number(p?.basePrice) || 0;\n        const disc = Number(p?.discount) || 0;\n        return base * (1 - disc / 100);\n    };\n\n    const aiContext = useMemo(() => {\n        const storeName = settings?.storeName ? String(settings.storeName) : '';\n        const aboutUsText = settings?.aboutUsText ? String(settings.aboutUsText) : '';\n\n        const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n        const pickupEnabled = !!settings?.shippingPickup?.enabled;\n        const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n        const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n        const pickupAddress = settings?.shippingPickup?.address || '';\n        const shippingParts = [];\n        if (pickupEnabled) shippingParts.push(`Retiro en local: ${pickupAddress ? pickupAddress : 'a coordinar'}.`);\n        if (deliveryEnabled) {\n            if (freeAbove > 0) shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n            else shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n        }\n\n        const hasCard = !!settings?.paymentMercadoPago?.enabled;\n        const hasTransfer = !!settings?.paymentTransfer?.enabled;\n        const hasCash = !!settings?.paymentCash && pickupEnabled;\n        const payParts = [];\n        if (hasCard) payParts.push('Tarjeta (Mercado Pago)');\n        if (hasTransfer) payParts.push('Transferencia');\n        if (hasCash) payParts.push('Efectivo (solo retiro en local)');\n\n        const categories = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...safeProducts.flatMap(p => getProductCategories(p))])]\n            .map(c => String(c).trim())\n            .filter(Boolean)\n            .slice(0, 20);\n\n        const productHints = safeProducts\n            .filter(p => p && (Number(p.stock) || 0) > 0 && p.isActive !== false)\n            .map(p => ({\n                name: String(p.name || '').trim(),\n                price: getProductFinalPrice(p),\n                discount: Number(p.discount) || 0,\n                featured: !!p.isFeatured,\n                cats: getProductCategories(p).slice(0, 2).join(', ')\n            }))\n            .filter(p => p.name)\n            .sort((a, b) => (b.discount - a.discount) || (Number(b.featured) - Number(a.featured)) || (a.price - b.price))\n            .slice(0, 25)\n            .map(p => `${p.name} ‚Äî $${Math.round(p.price).toLocaleString()}${p.cats ? ` ‚Äî ${p.cats}` : ''}`);\n\n        return {\n            storeName,\n            aboutUsText,\n            shipping: shippingParts.join(' '),\n            payments: payParts.join(', '),\n            categories,\n            productHints\n        };\n    }, [settings, safeProducts]);\n\n    const callExternalAI = async ({ userText, history, signal }) => {\n        const res = await fetch('/api/ai/chat', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                userText,\n                messages: Array.isArray(history) ? history : [],\n                context: aiContext\n            }),\n            signal\n        });\n        const data = await res.json().catch(() => ({}));\n        if (!res.ok) throw new Error(data?.error || 'ai_error');\n        if (!data?.text || typeof data.text !== 'string') throw new Error('ai_invalid');\n        return { text: data.text };\n    };\n\n    // Auto-scroll al √∫ltimo mensaje\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isOpen]);\n\n    useEffect(() => {\n        messagesRef.current = messages;\n    }, [messages]);\n\n    useEffect(() => {\n        return () => { isMountedRef.current = false; };\n    }, []);\n\n    // --- HERRAMIENTA DE B√öSQUEDA INTELIGENTE (FUZZY) ---\n    const fuzzySearch = (text, query) => {\n        if (!query || typeof query !== 'string') return false;\n        if (!text || typeof text !== 'string') return false;\n\n        const str = normalizeText(text);\n        const patt = normalizeText(query);\n\n        if (str.includes(patt)) return true; // Coincidencia exacta parcial\n\n        // Coincidencia aproximada simple (para Typos)\n        // Si m√°s del 70% de los caracteres est√°n presentes en orden relativo\n        let matches = 0;\n        let lastIndex = -1;\n        for (let char of patt) {\n            const index = str.indexOf(char, lastIndex + 1);\n            if (index > -1) {\n                matches++;\n                lastIndex = index;\n            }\n        }\n        return (matches / patt.length) > 0.75;\n    };\n\n    // --- CEREBRO LOCAL AVANZADO V5 (Universal & Contextual) ---\n    const callLocalBrain = async (userText, currentMessages) => {\n        await new Promise(resolve => setTimeout(resolve, 800)); // Simular pensamiento\n        const text = normalizeText(userText);\n        const qty = parseQuantity(text);\n\n        if (text.length <= 1) {\n            return { text: \"Te le√≠, pero me falta info üòä. ¬øQu√© est√°s buscando? (ej: 'auriculares', 'zapatillas', 'env√≠o', 'pagos')\" };\n        }\n\n        // 0. Detectar Saludos\n        if (text.match(/\\b(hola|holas|buen dia|buenos dias|buenas tardes|buenas noches|buenas|hello|hi|hey|que tal|como estas|como va|todo bien)\\b/)) {\n            return { text: \"¬°Hola! üëã ¬øQu√© quer√©s hacer? Pod√©s pedirme productos, ofertas, cupones, env√≠o, pagos o que agregue algo al carrito.\" };\n        }\n\n        if (text.match(/\\b(quien sos|que sos|que haces|sos real|sos un bot|asistente)\\b/)) {\n            const storeName = settings?.storeName ? ` de **${settings.storeName}**` : '';\n            return { text: `Soy SustIA${storeName}. Puedo ayudarte a encontrar productos, ver ofertas/cupones y armar el carrito m√°s r√°pido.` };\n        }\n\n        if (text.match(/\\b(categorias|categoria|rubros|rubro|secciones)\\b/)) {\n            const prodCats = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n            const cats = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...prodCats])]\n                .map(c => String(c).trim())\n                .filter(Boolean);\n            if (cats.length === 0) return { text: \"Todav√≠a no tengo categor√≠as configuradas. Decime qu√© est√°s buscando y lo resuelvo igual.\" };\n            const top = cats.slice(0, 10);\n            return { text: `Tenemos estas categor√≠as:\\n\\n${top.map(c => `- ${c}`).join('\\n')}\\n\\nDecime cu√°l te interesa y te muestro opciones.` };\n        }\n\n        if (text.match(/\\b(sobre|info|informacion|quienes somos|about)\\b/)) {\n            const about = settings?.aboutUsText || '';\n            if (about.trim()) return { text: about.trim() };\n            return { text: \"Esta tienda todav√≠a no carg√≥ su secci√≥n ‚ÄúSobre nosotros‚Äù. ¬øQuer√©s que te ayude a encontrar un producto?\" };\n        }\n\n        // 0.1 Comandos de Sistema (Universal)\n        if (controlPanel) {\n            if (text.match(/modo\\s*(?:oscuro|noche|dark)/)) {\n                controlPanel.setDarkMode(true);\n                return { text: \"He activado el modo oscuro üåô. ¬øMejor para tus ojos?\" };\n            }\n            if (text.match(/modo\\s*(?:claro|dia|light)/)) {\n                controlPanel.setDarkMode(false);\n                return { text: \"He activado el modo claro ‚òÄÔ∏è.\" };\n            }\n            if (text.match(/(?:ver|abrir|ir al)\\s*(?:carrito|bolsa|cesta)/)) {\n                controlPanel.openCart();\n                return { text: \"Abriendo tu carrito de compras... üõí\" };\n            }\n        }\n\n        if (text.match(/\\b(envio|envios|entrega|delivery|domicilio|retiro|retirar|local|pickup)\\b/)) {\n            const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n            const pickupEnabled = !!settings?.shippingPickup?.enabled;\n            const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n            const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n            const pickupAddress = settings?.shippingPickup?.address || '';\n\n            const lines = [];\n            if (pickupEnabled) {\n                lines.push(`üìç Retiro en local: ${pickupAddress ? `**${pickupAddress}**` : 'a coordinar'}.`);\n            }\n            if (deliveryEnabled) {\n                if (freeAbove > 0) {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n                } else {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n                }\n            }\n            if (!pickupEnabled && !deliveryEnabled) {\n                lines.push(\"Todav√≠a no tengo configurado el m√©todo de entrega para esta tienda.\");\n            }\n            lines.push(\"Si me dec√≠s tu ciudad/zona, te digo lo mejor para vos.\");\n            return { text: lines.join('\\n') };\n        }\n\n        if (text.match(/\\b(pago|pagos|tarjeta|mercado\\s*pago|transferencia|cbu|alias|efectivo)\\b/)) {\n            const hasCard = !!settings?.paymentMercadoPago?.enabled;\n            const hasTransfer = !!settings?.paymentTransfer?.enabled;\n            const hasCash = !!settings?.paymentCash && !!settings?.shippingPickup?.enabled;\n            const wantsTransferData = hasTransfer && text.match(/\\b(alias|cbu|transferencia)\\b/);\n            const options = [];\n            if (hasCard) options.push(\"üí≥ Tarjeta (Mercado Pago)\");\n            if (hasTransfer) options.push(\"üè¶ Transferencia\");\n            if (hasCash) options.push(\"üíµ Efectivo (solo retiro en local)\");\n\n            if (options.length === 0) {\n                return { text: \"Todav√≠a no tengo m√©todos de pago configurados para esta tienda. Si quer√©s, te paso WhatsApp para coordinar.\" };\n            }\n            if (wantsTransferData) {\n                const holderName = settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName).trim() : '';\n                const alias = settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias).trim() : '';\n                const cbu = settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu).trim() : '';\n                const lines = [\"Para transferir, us√° estos datos:\"];\n                if (holderName) lines.push(`- Titular: ${holderName}`);\n                if (alias) lines.push(`- Alias: ${alias}`);\n                if (cbu) lines.push(`- CBU: ${cbu}`);\n                if (!holderName && !alias && !cbu) {\n                    lines.push(\"- A√∫n no est√°n cargados los datos de transferencia para esta tienda.\");\n                }\n                return { text: lines.join('\\n') };\n            }\n            return { text: `Pod√©s pagar con:\\n\\n${options.map(o => `- ${o}`).join('\\n')}\\n\\n¬øCon cu√°l prefer√≠s?` };\n        }\n\n        // 0.2 Detectar Ayuda/Contacto\n        if (text.match(/\\b(ayuda|soporte|contacto|human|persona|asesor)\\b/)) {\n            if (settings?.whatsappLink) {\n                return { text: `Claro. Si necesitas asistencia personalizada con un humano üßë‚Äçüíª, escr√≠benos a nuestro WhatsApp: ${settings.whatsappLink} üì≤` };\n            }\n            return { text: \"Estoy dise√±ado para ayudarte a encontrar productos las 24hs. ü§ñ ¬øBuscas algo en espec√≠fico?\" };\n        }\n\n        // 0.3 Detectar Promociones/Cupones\n        if (text.match(/\\b(descuento|promo|cupon|oferta|codigo|rebaja)\\b/)) {\n            const activeCoupons = safeCoupons.filter(c => c?.active);\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0);\n\n            if (activeCoupons.length > 0) {\n                const couponText = activeCoupons\n                    .filter(c => c?.code)\n                    .map(c => `üé´ **${c.code}** (${c.discountType === 'percentage' ? c.value + '%' : '$' + c.value} OFF)`)\n                    .join(\"\\n\");\n                return { text: `¬°S√≠! Tenemos estos cupones disponibles para ti:\\n\\n${couponText}\\n\\n¬°√ösalos al finalizar tu compra! üõí` };\n            } else if (deals.length > 0) {\n                setLastContext({ type: 'show_deals', data: deals.sort(() => 0.5 - Math.random()).slice(0, 5) });\n                return { text: `No tengo c√≥digos de cup√≥n activos ahora, pero s√≠ tenemos **${deals.length}** productos con descuento. ¬øQuer√©s que te muestre los mejores? üè∑Ô∏è` };\n            } else {\n                return { text: \"Por el momento no tengo c√≥digos promocionales activos, pero nuestros precios son los mejores del mercado. üòâ\" };\n            }\n        }\n\n        // 1. Manejo de Contexto (Conversacional)\n        if (lastContext) {\n            if (text.match(/\\b(si|claro|dale|bueno|yes|por favor|obvio)\\b/)) {\n                const ctx = lastContext;\n                setLastContext(null);\n                if (ctx.type === 'suggest_cross_sell') {\n                    return {\n                        text: \"¬°Excelente! Mira estas oportunidades que seleccion√© para ti: üî•\",\n                        products: ctx.data\n                    };\n                }\n                if (ctx.type === 'show_deals') {\n                    return {\n                        text: \"Listo. Estas son algunas ofertas que valen la pena ahora mismo:\",\n                        products: ctx.data\n                    };\n                }\n            } else if (text.match(/\\b(no|gracias|paso|cancelar|asi esta bien)\\b/)) {\n                setLastContext(null);\n                return { text: \"Entendido. ¬øNecesitas ayuda con algo m√°s? üòä\" };\n            }\n        }\n\n        // 2. Detectar Intenciones\n        const isCheaper = text.match(/(?:mas|muy|super)\\s*(?:barato|economico|bajo)|oferta|menos|mas\\s*economico/);\n        const isExpensive = text.match(/(?:mas|muy|super)\\s*(?:caro|mejor|calidad|top|premium)|costoso|lujo/);\n        const isBuying = text.match(/(?:agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|comprar|quiero|dame|carrito|llevo|lo quiero)/);\n\n        // 2.1 Filtros de Precio Inteligentes (NUEVO)\n        let minPrice = 0;\n        let maxPrice = Infinity;\n\n        // Detectar \"menos de X\"\n        const lessThanMatch = text.match(/(?:menos|menor|bajo)\\s*(?:de|a|que)?\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (lessThanMatch) {\n            const parsed = parseHumanNumber(lessThanMatch[1], text);\n            if (parsed !== null) maxPrice = parsed;\n        }\n\n        // Detectar \"entre X y Y\"\n        const betweenMatch = text.match(/entre\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?\\s*y\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (betweenMatch) {\n            const parsedMin = parseHumanNumber(betweenMatch[1], text);\n            const parsedMax = parseHumanNumber(betweenMatch[2], text);\n            if (parsedMin !== null) minPrice = parsedMin;\n            if (parsedMax !== null) maxPrice = parsedMax;\n        }\n\n        // 3. Detectar Categor√≠a (Fuzzy)\n        const availableCategories = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n        const detectedCategoryVal = availableCategories.find(c => fuzzySearch(c, text) || fuzzySearch(text, c));\n        const targetCategory = detectedCategoryVal ? detectedCategoryVal.toLowerCase() : null;\n\n        // 4. B√∫squeda y Scoring de Productos\n        const synonyms = new Map([\n            ['celu', 'celular'],\n            ['cel', 'celular'],\n            ['tele', 'televisor'],\n            ['tv', 'televisor'],\n            ['compu', 'computadora'],\n            ['notebook', 'laptop'],\n            ['auris', 'auriculares'],\n            ['zapas', 'zapatillas'],\n            ['remera', 'camiseta'],\n            ['remeras', 'camisetas']\n        ]);\n        const keywords = tokenize(text).flatMap(k => {\n            const alt = synonyms.get(k);\n            return alt ? [k, alt] : [k];\n        });\n\n        if (keywords.length === 0 && !targetCategory && !isCheaper && !isExpensive && !isBuying) {\n            return { text: \"¬øMe dec√≠s qu√© producto o categor√≠a quer√©s ver? Si quer√©s, tambi√©n pod√©s preguntar por 'env√≠o', 'pagos' o 'cupones'.\" };\n        }\n\n        let candidates = safeProducts.filter(p => (Number(p?.stock) || 0) > 0 && p?.isActive !== false);\n\n        // Aplicar filtros de precio\n        candidates = candidates.filter(p => {\n            const fp = getProductFinalPrice(p);\n            return fp >= minPrice && fp <= maxPrice;\n        });\n\n        // Filtro por categor√≠a detectada\n        if (targetCategory) {\n            candidates = candidates.filter(p => getProductCategories(p).some(c => c.toLowerCase() === targetCategory));\n        }\n\n        const scores = candidates.map(p => {\n            let score = 0;\n            const pName = normalizeText(p.name);\n            const pDesc = normalizeText(p.description);\n\n            keywords.forEach(k => {\n                if (pName.includes(k)) score += 10;\n                else if (fuzzySearch(pName, k)) score += 5;\n                if (pDesc.includes(k)) score += 2;\n            });\n\n            if (p.isFeatured) score += 5;\n            if (p.discount > 0) score += 3;\n            if (isCheaper) score += (1 / (getProductFinalPrice(p) || 1)) * 10000;\n            if (isExpensive) score += getProductFinalPrice(p) / 100;\n\n            return { product: p, score };\n        });\n\n        const sorted = scores.filter(s => s.score > 0).sort((a, b) => b.score - a.score);\n        const topMatches = sorted.slice(0, 5).map(s => s.product);\n\n        if (topMatches.length === 0) {\n            return { text: \"No encontr√© exactamente lo que busc√°s, pero probando con otra palabra o viendo nuestras categor√≠as seguro lo hallamos. üîé\" };\n        }\n\n        if (isBuying && topMatches.length > 0) {\n            const best = topMatches[0];\n            addToCart(best, qty);\n\n            const suggestions = safeProducts\n                .filter(p => p.id !== best.id && (Number(p.stock) || 0) > 0 && p.isActive !== false)\n                .sort(() => 0.5 - Math.random())\n                .slice(0, 3);\n\n            if (suggestions.length > 0) {\n                setLastContext({ type: 'suggest_cross_sell', data: suggestions });\n                return {\n                    text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí\\n\\n¬øTe gustar√≠a ver algunos productos destacados para complementar tu compra? üëÄ`,\n                    products: [best]\n                };\n            }\n\n            return {\n                text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí ¬øAlgo m√°s?`,\n                products: [best]\n            };\n        }\n\n        let msg = \"Encontr√© estas opciones. ¬øQuer√©s que te muestre m√°s o me dec√≠s un presupuesto?\";\n        if (targetCategory) msg = `Encontr√© esto en la categor√≠a ${targetCategory}:`;\n        if (isCheaper) msg = \"Las opciones m√°s econ√≥micas:\";\n\n        return {\n            text: msg,\n            products: topMatches\n        };\n    };\n\n    const withTimeout = async (promise, ms) => {\n        let timeoutId = null;\n        const timeoutPromise = new Promise((_, reject) => {\n            timeoutId = setTimeout(() => reject(new Error('timeout')), ms);\n        });\n        try {\n            return await Promise.race([promise, timeoutPromise]);\n        } finally {\n            if (timeoutId) clearTimeout(timeoutId);\n        }\n    };\n\n    const sendText = async (rawText, opts = {}) => {\n        const alreadyAddedUser = !!opts.alreadyAddedUser;\n        const text = String(rawText || '').trim().slice(0, 300);\n        if (!text) return;\n        if (inFlightRef.current) {\n            if (!alreadyAddedUser) {\n                const newMsgUserQueued = { role: 'client', text };\n                setMessages(prev => [...prev, newMsgUserQueued]);\n            }\n            pendingTextRef.current = { text, alreadyAddedUser: true };\n            return;\n        }\n\n        inFlightRef.current = true;\n        setInputValue('');\n\n        const newMsgUser = alreadyAddedUser ? null : { role: 'client', text };\n        const updatedHistory = [...(messagesRef.current || []), ...(newMsgUser ? [newMsgUser] : [])];\n\n        if (newMsgUser) {\n            setMessages(prev => [...prev, newMsgUser]);\n        }\n        setIsTyping(true);\n\n        try {\n            const localResponse = await withTimeout(callLocalBrain(text, updatedHistory), 12000);\n            if (!isMountedRef.current) return;\n            let finalText = localResponse?.text && typeof localResponse.text === 'string'\n                ? localResponse.text\n                : \"Perd√≥n, tuve un problema procesando eso. ¬øPod√©s reformularlo?\";\n            const safeProducts = Array.isArray(localResponse?.products) ? localResponse.products : undefined;\n\n            const shouldAskExternal = aiEnabled && (!safeProducts || safeProducts.length === 0) && /no encontr[e√©]|no tengo eso|no lo tengo|probando con otra palabra/i.test(finalText);\n            if (shouldAskExternal) {\n                const controller = new AbortController();\n                const id = setTimeout(() => controller.abort(), 8500);\n                try {\n                    const aiRes = await callExternalAI({ userText: text, history: updatedHistory, signal: controller.signal });\n                    if (aiRes?.text) finalText = aiRes.text;\n                } catch { }\n                clearTimeout(id);\n            }\n\n            setMessages(prev => [...prev, {\n                role: 'model',\n                text: finalText,\n                products: safeProducts\n            }]);\n        } catch (e) {\n            if (!isMountedRef.current) return;\n            const fallback = settings?.whatsappLink\n                ? `Uy, se me trab√≥ por un momento. Si quer√©s, habl√° por WhatsApp: ${settings.whatsappLink}`\n                : \"Uy, se me trab√≥ por un momento. ¬øProbamos de nuevo?\";\n            setMessages(prev => [...prev, { role: 'model', text: fallback }]);\n        } finally {\n            if (isMountedRef.current) setIsTyping(false);\n            inFlightRef.current = false;\n            const pending = pendingTextRef.current;\n            if (pending && pending.text) {\n                pendingTextRef.current = null;\n                setTimeout(() => sendText(pending.text, { alreadyAddedUser: pending.alreadyAddedUser === true }), 0);\n            }\n        }\n    };\n\n    const handleSend = async () => {\n        return sendText(inputValue);\n    };\n\n    const handleQuickAction = (value) => {\n        const text = String(value || '').trim();\n        if (!text) return;\n        sendText(text);\n    };\n\n    const clearChat = () => {\n        try {\n            localStorage.removeItem(chatStorageKey);\n        } catch { }\n        setLastContext(null);\n        setMessages([defaultBotMessage]);\n    };\n\n    const quickActions = [\n        { label: 'Ofertas', value: 'Mostrame ofertas' },\n        { label: 'Cupones', value: 'Ten√©s cupones?' },\n        { label: 'Env√≠o', value: 'C√≥mo es el env√≠o?' },\n        { label: 'Pagos', value: 'Qu√© medios de pago hay?' },\n        { label: 'Categor√≠as', value: 'Qu√© categor√≠as ten√©s?' },\n        { label: 'WhatsApp', value: 'Necesito hablar con una persona' }\n    ];\n\n    return (\n        <div className=\"fixed bottom-4 right-4 z-[9999] flex flex-col items-end pointer-events-none\">\n            {isOpen && (\n                <div className=\"bg-[#0f0f0f]/95 backdrop-blur-2xl border border-white/10 rounded-[2rem] w-[calc(100vw-2rem)] sm:w-80 md:w-96 h-[min(600px,80dvh)] shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col mb-4 animate-fade-up overflow-hidden font-sans pointer-events-auto ring-1 ring-white/10 relative mr-0 sm:mr-0\">\n                    <div className=\"bg-gradient-to-r from-yellow-500 to-amber-600 p-5 flex justify-between items-center relative z-10\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-1 bg-white/20 rounded-full backdrop-blur-md overflow-hidden border border-white/30\">\n                                <img src={botImage} className=\"w-9 h-9 object-cover rounded-full\" alt=\"SustIA\" />\n                            </div>\n                            <div>\n                                <h3 className=\"font-black text-white text-sm tracking-tight\">SustIA AI</h3>\n                                <p className=\"text-[10px] text-white/90 font-bold flex items-center gap-1.5\">\n                                    <span className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_rgba(74,222,128,0.8)]\"></span>\n                                    En l√≠nea\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                            <button onClick={clearChat} className=\"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors\" title=\"Limpiar chat\">\n                                <Trash2 className=\"w-5 h-5\" />\n                            </button>\n                            <button onClick={() => setIsOpen(false)} className=\"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors\" title=\"Cerrar\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-[#111] px-4 py-2 border-b border-white/5\">\n                        <div className=\"flex gap-2 overflow-x-auto pb-1 custom-scrollbar\">\n                            {quickActions.map(a => (\n                                <button\n                                    key={a.label}\n                                    type=\"button\"\n                                    data-testid={`quick-action-${a.label.toLowerCase()}`}\n                                    onClick={() => {\n                                        handleQuickAction(a.value);\n                                    }}\n                                    className={\n                                        isDarkMode\n                                            ? \"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-white/10 bg-[#1a1a1a] text-white hover:bg-[#222] transition\"\n                                            : \"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-slate-200 bg-white text-slate-800 hover:bg-slate-50 transition\"\n                                    }\n                                >\n                                    <span className={isDarkMode ? \"text-white\" : \"text-slate-800\"}>{a.label}</span>\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-5 space-y-6 bg-[#0a0a0a]/50 custom-scrollbar relative\">\n                        {messages.map((m, i) => (\n                            <div key={i} className={`flex flex-col ${m.role === 'client' ? 'items-end' : 'items-start'} animate-fade-in`}>\n                                <div className={`max-w-[85%] p-4 rounded-2xl text-[13px] leading-relaxed shadow-lg ${m.role === 'client'\n                                    ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white rounded-tr-none border border-white/10'\n                                    : 'bg-[#1a1a1a] text-slate-200 rounded-tl-none border border-white/5'\n                                    }`}>\n                                    <p className=\"whitespace-pre-wrap\">{m.text}</p>\n                                </div>\n\n                                {m.products && m.products.length > 0 && (\n                                    <div className=\"mt-3 flex gap-3 overflow-x-auto pb-2 w-full custom-scrollbar pl-1 snap-x\">\n                                        {m.products.map(product => (\n                                            <BotProductCard\n                                                key={product.id}\n                                                product={product}\n                                                onAdd={(p, qty) => {\n                                                    addToCart(p, qty);\n                                                    setMessages(prev => [...prev, { role: 'model', text: `Agregado ${qty}x ${p.name} al carrito! üõí` }]);\n                                                }}\n                                            />\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n                        {isTyping && (\n                            <div className=\"flex justify-start\">\n                                <div className=\"bg-[#1a1a1a] p-3 rounded-2xl rounded-bl-none border border-white/5 flex gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\"></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></span>\n                                </div>\n                            </div>\n                        )}\n                        <div ref={messagesEndRef} />\n                    </div>\n\n                    <div className=\"p-3 bg-[#0a0a0a] border-t border-white/10 relative z-0\">\n                        <form onSubmit={(e) => { e.preventDefault(); handleSend(); }} className=\"flex gap-2 items-center\">\n                            <input\n                                className=\"flex-1 bg-[#1a1a1a] border border-white/10 rounded-full px-4 py-2.5 text-sm text-white focus:border-yellow-500/50 outline-none transition placeholder:text-slate-600\"\n                                placeholder=\"Escribe aqu√≠...\"\n                                value={inputValue}\n                                onChange={e => setInputValue(e.target.value)}\n                            />\n                            <button type=\"submit\" className=\"p-2.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full transition shadow-lg shadow-yellow-600/20 disabled:opacity-50 disabled:cursor-not-allowed\" disabled={isTyping || !inputValue.trim()}>\n                                <Send className=\"w-4 h-4\" />\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            )}\n\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"pointer-events-auto w-14 h-14 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(234,179,8,0.4)] hover:scale-110 transition-transform group relative z-50\"\n            >\n                {isOpen ? <X className=\"w-6 h-6 text-white\" /> : (\n                    <div className=\"w-full h-full p-1\">\n                        <img src=\"sustia-ai-v2.jpg\" className=\"w-full h-full object-cover rounded-full opacity-95 group-hover:scale-110 transition-transform duration-300\" alt=\"SustIA\" />\n                    </div>\n                )}\n                {!isOpen && (\n                    <span className=\"absolute -top-1 -right-1 flex h-4 w-4\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-4 w-4 bg-yellow-500 border border-black\"></span>\n                    </span>\n                )}\n            </button>\n        </div>\n    );\n}, (prevProps, nextProps) => {\n    if (prevProps.settings?.subscriptionPlan !== nextProps.settings?.subscriptionPlan) return false;\n    if (prevProps.products !== nextProps.products) return false;\n    return true;\n});\n\nexport default SustIABot;\n"],
  "mappings": "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",
  "names": ["React", "useState", "useEffect", "useRef", "useMemo", "Send", "X", "Trash2", "Plus", "BotProductCard", "product", "onAdd", "qty", "setQty", "finalPrice", "SustIABot", "settings", "products", "addToCart", "controlPanel", "coupons", "appId", "isOpen", "setIsOpen", "isDarkMode", "setIsDarkMode", "botImage", "chatStorageKey", "defaultBotMessage", "messages", "setMessages", "inputValue", "setInputValue", "isTyping", "setIsTyping", "lastContext", "setLastContext", "messagesEndRef", "messagesRef", "inFlightRef", "pendingTextRef", "isMountedRef", "safeProducts", "safeCoupons", "aiEnabled", "check", "obs", "normalizeText", "value", "tokenize", "t", "raw", "stop", "w", "parseHumanNumber", "rawNumber", "contextText", "n", "parseQuantity", "text", "m1", "m2", "m3", "getProductCategories", "p", "cats", "c", "getProductFinalPrice", "base", "disc", "aiContext", "storeName", "aboutUsText", "deliveryEnabled", "pickupEnabled", "deliveryFee", "freeAbove", "pickupAddress", "shippingParts", "hasCard", "hasTransfer", "hasCash", "payParts", "categories", "productHints", "a", "b", "callExternalAI", "userText", "history", "signal", "res", "data", "fuzzySearch", "query", "str", "patt", "matches", "lastIndex", "char", "index", "callLocalBrain", "currentMessages", "resolve", "prodCats", "about", "lines", "wantsTransferData", "options", "holderName", "alias", "cbu", "o", "activeCoupons", "deals", "ctx", "isCheaper", "isExpensive", "isBuying", "minPrice", "maxPrice", "lessThanMatch", "parsed", "betweenMatch", "parsedMin", "parsedMax", "detectedCategoryVal", "targetCategory", "synonyms", "keywords", "k", "alt", "candidates", "fp", "topMatches", "score", "pName", "pDesc", "s", "best", "suggestions", "msg", "withTimeout", "promise", "ms", "timeoutId", "timeoutPromise", "_", "reject", "sendText", "rawText", "opts", "alreadyAddedUser", "newMsgUserQueued", "prev", "newMsgUser", "updatedHistory", "localResponse", "finalText", "controller", "id", "aiRes", "fallback", "pending", "handleSend", "handleQuickAction", "m", "i", "e", "prevProps", "nextProps", "SustIABot_default"]
}
