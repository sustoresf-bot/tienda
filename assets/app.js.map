{
  "version": 3,
  "sources": ["../script.js"],
  "sourcesContent": ["\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFFimport React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport {\n    ShoppingBag, X, User, Search, Zap, CheckCircle, MessageCircle, Instagram, Minus, Heart, Tag,\n    Plus, Trash2, Edit, AlertTriangle, RefreshCw, Bot, Send, LogIn, LogOut, Mail, CreditCard, Menu, Home,\n    Info, FileQuestion, Users, Package, LayoutDashboard, Settings, Ticket, Truck, PieChart, Wallet,\n    FileText, ArrowRight, ArrowLeft, DollarSign, BarChart3, ChevronRight, TrendingUp, TrendingDown,\n    Briefcase, Calculator, Save, AlertCircle, Phone, MapPin, Copy, ExternalLink, Shield, Trophy,\n    ShoppingCart, Archive, Play, FolderPlus, Eye, EyeOff, Clock, Calendar, Gift, Lock, Loader2, Star, Percent, Sparkles,\n    Flame, Image as ImageIcon, Filter, ChevronDown, ChevronUp, Store, BarChart, Globe, Headphones, Palette, Share2, Cog, Facebook, Twitter, Linkedin, Youtube, Bell, Music, Building, Banknote, Smartphone, UserPlus, Maximize2, Settings2, Sun, Moon, Upload\n} from 'lucide-react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, sendPasswordResetEmail, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'firebase/auth';\nimport {\n    getFirestore, collection, addDoc, onSnapshot, query, updateDoc, doc, getDocs, deleteDoc,\n    where, writeBatch, getDoc, increment, setDoc, arrayUnion, arrayRemove, orderBy, limit, startAfter\n} from 'firebase/firestore';\n\n// --- CONFIGURACI√ìN FIREBASE (PROYECTO: sustore-63266) ---\n// Nota: esta es la configuraci√≥n p√∫blica del SDK web. NO incluyas aqu√≠ el JSON de service account.\nconst firebaseConfig = {\n    apiKey: \"AIzaSyAfllte-D_I3h3TwBaiSL4KVfWrCSVh9ro\",\n    authDomain: \"sustore-63266.firebaseapp.com\",\n    projectId: \"sustore-63266\",\n    storageBucket: \"sustore-63266.firebasestorage.app\",\n    messagingSenderId: \"684651914850\",\n    appId: \"1:684651914850:web:f3df09e5caf6e50e9e533b\",\n    measurementId: \"G-X3K7XGYPRD\"\n};\n\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n// ID interno de la app (no es el appId de Firebase). Puedes cambiarlo si quieres diferenciar entornos.\nconst DEFAULT_APP_ID = \"sustore-63266-prod\";\nconst APP_VERSION = \"3.0.0\";\n\nlet mpPublicKeyPromise = null;\nasync function getMercadoPagoPublicKey() {\n    if (mpPublicKeyPromise) return mpPublicKeyPromise;\n    mpPublicKeyPromise = (async () => {\n        try {\n            const res = await fetch('/api/checkout?action=public_config', { method: 'GET' });\n            if (!res.ok) return null;\n            const data = await res.json().catch(() => ({}));\n            const key = String(data?.mpPublicKey || '').trim();\n            return key || null;\n        } catch (e) {\n            return null;\n        }\n    })();\n    return mpPublicKeyPromise;\n}\n\nconst setupSmoothWheelScroll = () => {\n    if (typeof window === 'undefined' || typeof document === 'undefined') return;\n    if (window.__smoothWheelScrollEnabled) return;\n    window.__smoothWheelScrollEnabled = true;\n\n    const reduceMotion = typeof window.matchMedia === 'function' && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    if (reduceMotion) return;\n\n    const getDocumentScrollingElement = () => document.scrollingElement || document.documentElement;\n    const elementStates = new WeakMap();\n\n    const clamp = (value, min, max) => Math.min(max, Math.max(min, value));\n    const maxScrollTopForEl = (el) => Math.max(0, el.scrollHeight - el.clientHeight);\n\n    const isScrollable = (el) => {\n        if (!el || !(el instanceof Element)) return false;\n        const style = window.getComputedStyle(el);\n        const overflowY = style.overflowY;\n        if (overflowY === 'hidden' || overflowY === 'visible') return false;\n        return el.scrollHeight > el.clientHeight + 1;\n    };\n\n    const findScrollableAncestor = (startEl) => {\n        let el = startEl;\n        while (el && el instanceof Element && el !== document.body && el !== document.documentElement) {\n            if (isScrollable(el)) return el;\n            el = el.parentElement;\n        }\n        return null;\n    };\n\n    const getState = (el) => {\n        const existing = elementStates.get(el);\n        if (existing) return existing;\n        const state = { rafId: null, velocity: 0, lastTs: 0 };\n        elementStates.set(el, state);\n        return state;\n    };\n\n    const animateElement = (el, ts) => {\n        const state = getState(el);\n        if (!state.lastTs) state.lastTs = ts;\n        const dt = Math.min(48, ts - state.lastTs);\n        state.lastTs = ts;\n\n        const frictionPerFrame = 0.86;\n        const friction = Math.pow(frictionPerFrame, dt / 16.67);\n\n        const current = el.scrollTop;\n        const next = clamp(current + state.velocity * (dt / 16.67), 0, maxScrollTopForEl(el));\n        el.scrollTop = next;\n\n        if (next === 0 || next === maxScrollTopForEl(el)) {\n            state.velocity *= 0.5;\n        }\n\n        state.velocity *= friction;\n\n        if (Math.abs(state.velocity) < 0.1) {\n            state.rafId = null;\n            state.velocity = 0;\n            state.lastTs = 0;\n            return;\n        }\n\n        state.rafId = window.requestAnimationFrame((nextTs) => animateElement(el, nextTs));\n    };\n\n    const onWheel = (e) => {\n        if (e.defaultPrevented) return;\n        if (e.ctrlKey || e.metaKey || e.shiftKey) return;\n        const targetEl = e.target instanceof Element ? e.target : null;\n        const scrollEl = (targetEl && findScrollableAncestor(targetEl)) || getDocumentScrollingElement();\n\n        const deltaX = e.deltaX;\n        let deltaY = e.deltaY;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) return;\n        if (!Number.isFinite(deltaY) || Math.abs(deltaY) < 0.01) return;\n\n        e.preventDefault();\n\n        if (e.deltaMode === 1) deltaY *= 40;\n        else if (e.deltaMode === 2) deltaY *= window.innerHeight;\n\n        const state = getState(scrollEl);\n        const strength = 0.9;\n        state.velocity += deltaY * strength;\n        state.velocity = clamp(state.velocity, -4500, 4500);\n        if (state.rafId === null) state.rafId = window.requestAnimationFrame((ts) => animateElement(scrollEl, ts));\n    };\n\n    const onResize = () => {\n        const docEl = getDocumentScrollingElement();\n        const state = getState(docEl);\n        state.velocity = clamp(state.velocity, -4500, 4500);\n    };\n\n    document.addEventListener('wheel', onWheel, { passive: false, capture: true });\n    window.addEventListener('resize', onResize, { passive: true });\n};\n\ntry { setupSmoothWheelScroll(); } catch (e) { }\n\n// === SEGURIDAD: Email de Super Admin ofuscado (m√∫ltiples capas) ===\nconst _sa = ['bGF1dGFyb2NvcmF6emE2M0BnbWFpbC5jb20=']; // Base64\nconst SUPER_ADMIN_EMAIL = (() => { try { return atob(_sa[0]); } catch (e) { return ''; } })();\n\n// === SEGURIDAD: Sistema Anti-Manipulaci√≥n Avanzado ===\nconst SecurityManager = {\n    sessionToken: null,\n    loginAttempts: {},\n    maxAttempts: 5,\n    lockoutTime: 300000, // 5 minutos\n    integrityChecks: {},\n\n    // Salt din√°mico basado en timestamp (m√°s seguro que salt fijo)\n    _generateSalt() {\n        const base = 'tienda_secure_2024';\n        const timestamp = Math.floor(Date.now() / 86400000); // Cambia cada d√≠a\n        return base + '_' + timestamp;\n    },\n\n    // Hash seguro para contrase√±as (SHA-256 con salt din√°mico)\n    async hashPassword(password) {\n        const encoder = new TextEncoder();\n        const salt = this._generateSalt();\n        const data = encoder.encode(password + salt);\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n    },\n\n    // Verificar contrase√±a hasheada\n    async verifyPassword(password, hash) {\n        const inputHash = await this.hashPassword(password);\n        return inputHash === hash;\n    },\n\n    // Rate limiting mejorado para login\n    canAttemptLogin(email) {\n        const key = this._hashKey(email.toLowerCase());\n        const now = Date.now();\n        const record = this.loginAttempts[key];\n\n        if (record && record.lockedUntil > now) {\n            return { allowed: false, remainingTime: Math.ceil((record.lockedUntil - now) / 1000) };\n        }\n\n        if (record && record.lockedUntil && record.lockedUntil < now) {\n            delete this.loginAttempts[key];\n        }\n\n        return { allowed: true };\n    },\n\n    // Hash de claves para no exponer emails en memoria\n    _hashKey(str) {\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            const char = str.charCodeAt(i);\n            hash = ((hash << 5) - hash) + char;\n            hash = hash & hash;\n        }\n        return 'k_' + Math.abs(hash).toString(36);\n    },\n\n    // Registrar intento fallido\n    recordFailedAttempt(email) {\n        const key = this._hashKey(email.toLowerCase());\n        if (!this.loginAttempts[key]) {\n            this.loginAttempts[key] = { count: 0, firstAttempt: Date.now() };\n        }\n        this.loginAttempts[key].count++;\n\n        if (this.loginAttempts[key].count >= this.maxAttempts) {\n            this.loginAttempts[key].lockedUntil = Date.now() + this.lockoutTime;\n            // Log seguro sin exponer email\n            console.warn('[Security] Account locked - too many failed attempts');\n        }\n    },\n\n    // Limpiar intentos despu√©s de login exitoso\n    clearAttempts(email) {\n        const key = this._hashKey(email.toLowerCase());\n        delete this.loginAttempts[key];\n    },\n\n    // Generar token de sesi√≥n con firma criptogr√°fica\n    generateSessionToken(userId) {\n        const payload = {\n            uid: userId,\n            iat: Date.now(),\n            exp: Date.now() + 86400000, // 24 horas\n            nonce: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)\n        };\n        const token = btoa(JSON.stringify(payload));\n        const signature = this._signToken(token);\n        const fullToken = token + '.' + signature;\n        this.sessionToken = fullToken;\n        sessionStorage.setItem('_st', fullToken);\n        return fullToken;\n    },\n\n    // Firma simple del token\n    _signToken(token) {\n        let hash = 0;\n        const secret = 'tienda_secret_key_2024';\n        const toSign = token + secret;\n        for (let i = 0; i < toSign.length; i++) {\n            hash = ((hash << 5) - hash) + toSign.charCodeAt(i);\n            hash = hash & hash;\n        }\n        return Math.abs(hash).toString(36);\n    },\n\n    // Verificar token de sesi√≥n con validaci√≥n de expiraci√≥n\n    verifySession() {\n        const stored = sessionStorage.getItem('_st');\n        if (!stored || stored !== this.sessionToken) return false;\n\n        try {\n            const [payloadB64] = stored.split('.');\n            const payload = JSON.parse(atob(payloadB64));\n            // Verificar expiraci√≥n\n            if (payload.exp && payload.exp < Date.now()) {\n                this.invalidateSession();\n                return false;\n            }\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    // Invalidar sesi√≥n\n    invalidateSession() {\n        this.sessionToken = null;\n        sessionStorage.removeItem('_st');\n        localStorage.removeItem('sustore_user_data');\n    },\n\n    // Detectar manipulaci√≥n de React DevTools\n    detectManipulation() {\n        const stored = localStorage.getItem('sustore_user_data');\n        if (stored) {\n            try {\n                const userData = JSON.parse(stored);\n                // Verificar estructura v√°lida\n                if (!userData.id || userData.id.length < 10 ||\n                    !userData.email || !userData.email.includes('@')) {\n                    console.warn('[Security] Invalid session data detected');\n                    localStorage.removeItem('sustore_user_data');\n                    return true;\n                }\n                // Verificar que el rol no fue manipulado a admin ilegalmente\n                if (userData.role === 'admin' && !this._validateAdminClaim(userData)) {\n                    console.warn('[Security] Admin role manipulation detected');\n                    userData.role = 'user';\n                    localStorage.setItem('sustore_user_data', JSON.stringify(userData));\n                    return true;\n                }\n            } catch (e) {\n                localStorage.removeItem('sustore_user_data');\n                return true;\n            }\n        }\n        return false;\n    },\n\n    // Validar claim de admin (requiere verificaci√≥n del servidor)\n    _validateAdminClaim(userData) {\n        // 1. Permitir siempre al Super Admin (Hardcoded)\n        if (userData.email === SUPER_ADMIN_EMAIL) return true;\n\n        // 2. Permitir si tiene la flag de verificaci√≥n (seteada al loguear/cargar desde DB)\n        return userData._adminVerified === true;\n    },\n\n    // Sanitizar entrada del usuario (Anti-XSS)\n    sanitizeInput(input) {\n        if (typeof input !== 'string') return input;\n        return input\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#x27;')\n            .replace(/\\//g, '&#x2F;')\n            .replace(/javascript:/gi, '')\n            .replace(/on\\w+=/gi, '');\n    },\n\n    // Validar email\n    isValidEmail(email) {\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return emailRegex.test(email) && email.length <= 254;\n    },\n\n    // Validar fortaleza de contrase√±a\n    isStrongPassword(password) {\n        return password.length >= 8 &&\n            /[A-Z]/.test(password) &&\n            /[a-z]/.test(password) &&\n            /[0-9]/.test(password);\n    },\n\n    // Protecci√≥n contra ataques de timing\n    async secureCompare(a, b) {\n        if (typeof a !== 'string' || typeof b !== 'string') return false;\n        const encoder = new TextEncoder();\n        const aBytes = encoder.encode(a);\n        const bBytes = encoder.encode(b);\n        if (aBytes.length !== bBytes.length) return false;\n\n        let result = 0;\n        for (let i = 0; i < aBytes.length; i++) {\n            result |= aBytes[i] ^ bBytes[i];\n        }\n        return result === 0;\n    },\n\n    // Bloquear acceso a consola en producci√≥n (anti-debugging)\n    protectConsole() {\n        if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('127.0.0.1')) {\n            // Desactivar console.log en producci√≥n para no exponer info\n            const noop = () => { };\n            ['log', 'debug', 'info', 'table', 'dir'].forEach(method => {\n                console[method] = noop;\n            });\n            // Mantener warn y error para debugging cr√≠tico\n        }\n    },\n\n    // Detectar DevTools abierto\n    detectDevTools() {\n        const threshold = 160;\n        const check = () => {\n            const widthDiff = window.outerWidth - window.innerWidth > threshold;\n            const heightDiff = window.outerHeight - window.innerHeight > threshold;\n            if (widthDiff || heightDiff) {\n                // DevTools detectado - no hacer nada visible pero loguear\n                // console.warn('[Security] DevTools detected');\n            }\n        };\n        // Verificar peri√≥dicamente\n        setInterval(check, 5000);\n    },\n\n    // Inicializar todas las protecciones\n    init() {\n        this.detectManipulation();\n        this.protectConsole();\n        this.detectDevTools();\n\n        // Limpiar datos sensibles de window\n        Object.defineProperty(window, 'SUPER_ADMIN_EMAIL', {\n            get: () => undefined,\n            configurable: false\n        });\n    }\n};\n\n// Inicializar protecciones de seguridad\nSecurityManager.init();\n\n// Configuraci√≥n por defecto\nconst defaultSettings = {\n    // --- Identidad de la Tienda ---\n    storeName: \"Tienda Online\",\n    primaryColor: \"#f97316\",\n    currency: \"$\",\n\n    ticket: {\n        brandName: \"\",\n        whatsappLink: \"\",\n        siteUrl: \"\"\n    },\n\n    // --- Administraci√≥n ---\n    admins: SUPER_ADMIN_EMAIL,\n    team: [{ email: SUPER_ADMIN_EMAIL, role: \"admin\", name: \"Administrador\" }],\n\n    // --- Contacto ---\n    sellerEmail: \"\",\n    instagramUser: \"\",\n    instagramLink: \"\",\n    whatsappLink: \"\",\n    showWhatsapp: false,\n    showFloatingWhatsapp: false,\n    showCartWhatsappCheckout: false,\n    showInstagram: false,\n\n    paymentTransfer: {\n        enabled: false,\n        holderName: \"\",\n        alias: \"\",\n        cbu: \"\"\n    },\n    paymentCash: false,\n    paymentMercadoPago: {\n        enabled: false\n    },\n\n    // --- Im√°genes ---\n    logoUrl: \"\",\n    heroUrl: \"\",\n    showHomeBannerCarousel: true,\n    homeBannerAutoplayMs: 5000,\n\n    // --- Configuraci√≥n de Tienda ---\n    markupPercentage: 0,\n    announcementMessage: \"\",\n    categories: [\"General\"],\n    aboutUsText: \"Bienvenido a nuestra tienda. Ofrecemos productos de calidad con env√≠o a todo el pa√≠s.\",\n\n    // --- SEO (Search Engine Optimization) ---\n    seoTitle: \"\",\n    seoDescription: \"Tu tienda online de confianza. Calidad y vanguardia en cada producto. Env√≠os a todo el pa√≠s.\",\n    seoKeywords: \"tienda online, productos, comprar, env√≠os\",\n    seoAuthor: \"\",\n    seoUrl: \"\",\n    seoImage: \"\",\n\n    // --- Textos de Carga ---\n    loadingTitle: \"\",\n    loadingText: \"Cargando sistema...\"\n};\n\n// --- COMPONENTES DE UI ---\n\n// Componente de Imagen con Lazy Loading\nconst LazyImage = ({ src, alt, className, placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhMWExYSIvPjwvc3ZnPg==' }) => {\n    const [isLoaded, setIsLoaded] = useState(false);\n    const [isInView, setIsInView] = useState(false);\n    const imgRef = useRef(null);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            ([entry]) => {\n                if (entry.isIntersecting) {\n                    setIsInView(true);\n                    observer.disconnect();\n                }\n            },\n            { rootMargin: '100px', threshold: 0.1 }\n        );\n\n        if (imgRef.current) {\n            observer.observe(imgRef.current);\n        }\n\n        return () => observer.disconnect();\n    }, []);\n\n    return (\n        <img\n            ref={imgRef}\n            src={isInView ? src : placeholder}\n            alt={alt}\n            className={`${className} transition-opacity duration-300 ${isLoaded ? 'opacity-100' : 'opacity-0'}`}\n            onLoad={() => setIsLoaded(true)}\n            loading=\"lazy\"\n        />\n    );\n};\n\nconst HomeBannerCarouselBackground = ({ settingsLoaded, banners, fallbackUrl, autoplayMs, darkMode, onBannerClick }) => {\n    const slides = useMemo(() => {\n        if (!Array.isArray(banners)) return [];\n        return banners.filter(b => b && b.enabled !== false && typeof b.imageUrl === 'string' && b.imageUrl.trim().length > 0);\n    }, [banners]);\n\n    const [activeIndex, setActiveIndex] = useState(0);\n    const [isPaused, setIsPaused] = useState(false);\n\n    useEffect(() => {\n        if (activeIndex >= slides.length) setActiveIndex(0);\n    }, [activeIndex, slides.length]);\n\n    const effectiveAutoplayMs = Number(autoplayMs);\n    const shouldAutoplay = settingsLoaded && !isPaused && slides.length > 1 && Number.isFinite(effectiveAutoplayMs) && effectiveAutoplayMs >= 1500;\n\n    useEffect(() => {\n        if (!shouldAutoplay) return;\n        const id = setInterval(() => {\n            setActiveIndex(i => (i + 1) % slides.length);\n        }, effectiveAutoplayMs);\n        return () => clearInterval(id);\n    }, [shouldAutoplay, slides.length, effectiveAutoplayMs]);\n\n    useEffect(() => {\n        if (slides.length <= 1) return;\n        const next = slides[(activeIndex + 1) % slides.length];\n        if (!next?.imageUrl) return;\n        const img = new Image();\n        img.src = next.imageUrl;\n    }, [slides, activeIndex]);\n\n    const activeSlide = slides[activeIndex] || null;\n    const hasTarget = (() => {\n        const type = activeSlide?.targetType || (activeSlide?.promoId ? 'promo' : activeSlide?.productId ? 'product' : 'none');\n        const id = activeSlide?.targetId || activeSlide?.promoId || activeSlide?.productId || '';\n        return type !== 'none' && !!id;\n    })();\n    const imageOpacity = 0.15;\n    const imageClass = `w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`;\n\n    const goPrev = () => {\n        setActiveIndex(i => {\n            const next = i - 1;\n            return next < 0 ? slides.length - 1 : next;\n        });\n    };\n\n    const goNext = () => {\n        setActiveIndex(i => (i + 1) % slides.length);\n    };\n\n    if (!settingsLoaded) {\n        return <div className=\"absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 animate-pulse\"></div>;\n    }\n\n    if (slides.length === 0) {\n        return fallbackUrl ? (\n            <img src={fallbackUrl} style={{ opacity: imageOpacity }} className={`absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`} />\n        ) : (\n            <div className={`absolute inset-0 opacity-60 ${darkMode ? 'bg-gradient-to-br from-orange-900/40 via-[#0a0a0a] to-slate-900/40' : 'bg-gradient-to-br from-orange-200/60 via-white to-slate-200/60'}`}>\n                <div className={`absolute inset-0 bg-[url('/noise.svg')] ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className={`absolute inset-0 overflow-hidden ${hasTarget ? 'cursor-pointer' : ''}`}\n            onClick={() => hasTarget && onBannerClick?.(activeSlide)}\n            onMouseEnter={() => setIsPaused(true)}\n            onMouseLeave={() => setIsPaused(false)}\n        >\n            <div\n                className=\"h-full w-full flex transition-transform duration-700 ease-in-out\"\n                style={{ transform: `translate3d(-${activeIndex * 100}%, 0, 0)`, willChange: 'transform' }}\n            >\n                {slides.map((slide, idx) => (\n                    <div key={slide.id || `${idx}-${slide.targetId || slide.productId || slide.promoId || 'slide'}`} className=\"w-full h-full flex-shrink-0 relative\">\n                        <img src={slide.imageUrl} style={{ opacity: imageOpacity }} className={imageClass} />\n                    </div>\n                ))}\n            </div>\n\n            {slides.length > 1 && (\n                <>\n                    <button\n                        type=\"button\"\n                        className=\"absolute left-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goPrev(); }}\n                        aria-label=\"Banner anterior\"\n                    >\n                        <ArrowLeft className=\"w-5 h-5\" />\n                    </button>\n                    <button\n                        type=\"button\"\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goNext(); }}\n                        aria-label=\"Banner siguiente\"\n                    >\n                        <ArrowRight className=\"w-5 h-5\" />\n                    </button>\n                    <div className=\"absolute bottom-4 inset-x-0 z-20 flex items-center justify-center gap-2 pointer-events-auto\" onClick={(e) => e.stopPropagation()}>\n                        {slides.map((_, idx) => (\n                            <button\n                                key={`dot-${idx}`}\n                                type=\"button\"\n                                aria-label={`Ir al banner ${idx + 1}`}\n                                className={`h-2.5 rounded-full transition-all duration-300 ${idx === activeIndex ? 'w-8 bg-white' : 'w-2.5 bg-white/40 hover:bg-white/70'}`}\n                                onClick={() => setActiveIndex(idx)}\n                            />\n                        ))}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n\n// Componente de Notificaci√≥n (Toast)\nconst Toast = ({ message, type, onClose }) => {\n    let containerClass = \"fixed top-24 right-4 z-[9999] flex items-center gap-4 p-5 rounded-2xl border-l-4 backdrop-blur-xl animate-fade-up shadow-2xl transition-all duration-300\";\n    let iconContainerClass = \"p-2 rounded-full\";\n    let IconComponent = Info;\n\n    if (type === 'success') {\n        containerClass += \" border-green-500 text-green-400 bg-black/90 shadow-[0_0_20px_rgba(34,197,94,0.3)]\";\n        iconContainerClass += \" bg-green-500/20\";\n        IconComponent = CheckCircle;\n    } else if (type === 'error') {\n        containerClass += \" border-red-500 text-red-400 bg-black/90 shadow-[0_0_20px_rgba(239,68,68,0.3)]\";\n        iconContainerClass += \" bg-red-500/20\";\n        IconComponent = AlertCircle;\n    } else if (type === 'warning') {\n        containerClass += \" border-yellow-500 text-yellow-400 bg-black/90 shadow-[0_0_20px_rgba(234,179,8,0.3)]\";\n        iconContainerClass += \" bg-yellow-500/20\";\n        IconComponent = AlertTriangle;\n    } else {\n        containerClass += \" border-orange-500 text-orange-400 bg-black/90 shadow-[0_0_20px_rgba(249,115,22,0.3)]\";\n        iconContainerClass += \" bg-orange-500/20\";\n        IconComponent = Info;\n    }\n\n    useEffect(() => {\n        const t = setTimeout(onClose, 4000);\n        return () => clearTimeout(t);\n    }, [onClose]);\n\n    return (\n        <div className={containerClass}>\n            <div className={iconContainerClass}>\n                <IconComponent className=\"w-5 h-5\" />\n            </div>\n            <div>\n                <p className=\"font-bold text-sm tracking-wide\">{message}</p>\n            </div>\n            <button onClick={onClose} className=\"ml-2 text-white/50 hover:text-white transition\">\n                <X className=\"w-4 h-4\" />\n            </button>\n        </div>\n    );\n};\n\n// Componente Modal de Confirmaci√≥n\nconst ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = \"Confirmar\", cancelText = \"Cancelar\", isDangerous = false }) => {\n    if (!isOpen) return null;\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-up p-4\">\n            <div className={`glass p-8 rounded-[2rem] max-w-sm w-full border ${isDangerous ? 'border-red-500/50 shadow-[0_0_30px_rgba(220,38,38,0.2)]' : 'border-slate-700 shadow-2xl'}`}>\n                <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto ${isDangerous ? 'bg-red-900/20 text-red-500' : 'bg-orange-900/20 text-orange-500'}`}>\n                    {isDangerous ? <AlertTriangle className=\"w-8 h-8\" /> : <Info className=\"w-8 h-8\" />}\n                </div>\n                <h3 className=\"text-xl font-black text-center mb-2 text-white\">{title}</h3>\n                <p className=\"text-slate-400 text-center mb-8 text-sm leading-relaxed\">{message}</p>\n                <div className=\"flex gap-3\">\n                    <button onClick={onCancel} className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\">{cancelText}</button>\n                    <button onClick={onConfirm} className={`flex-1 py-3 text-white rounded-xl font-bold transition shadow-lg ${isDangerous ? 'bg-red-600 hover:bg-red-500 shadow-red-600/30' : 'bg-orange-600 hover:bg-orange-500 shadow-orange-600/30'}`}>{confirmText}</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// Error Boundary\nclass ErrorBoundary extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = { hasError: false, error: null, errorInfo: null };\n    }\n    static getDerivedStateFromError(error) { return { hasError: true }; }\n    componentDidCatch(error, errorInfo) {\n        this.setState({ error, errorInfo });\n        console.error(\"Uncaught error:\", error, errorInfo);\n    }\n    render() {\n        if (this.state.hasError) {\n            return (\n                <div className=\"min-h-screen bg-black text-red-500 p-10 font-mono\">\n                    <h1 className=\"text-4xl font-bold mb-4\">CRITICAL SYSTEM FAILURE</h1>\n                    <div className=\"border border-red-900 bg-red-900/10 p-6 rounded-xl overflow-auto\">\n                        <h2 className=\"text-xl font-bold mb-2\">{this.state.error?.toString()}</h2>\n                        <pre className=\"text-xs text-red-400/70 whitespace-pre-wrap\">{this.state.errorInfo?.componentStack}</pre>\n                    </div>\n                    <button onClick={() => window.location.reload()} className=\"mt-8 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-500 font-bold\">REINICIAR SISTEMA</button>\n                </div>\n            );\n        }\n        return this.props.children;\n    }\n}\n\n// Componente Auxiliar para Bot√≥n de Agregar R√°pido\nconst QuickAddButton = ({ product, onAdd, darkMode }) => {\n    const [qty, setQty] = useState(1);\n    const [added, setAdded] = useState(false);\n\n    const handleAdd = (e) => {\n        e.stopPropagation();\n        onAdd(product, qty);\n        setAdded(true);\n        setTimeout(() => setAdded(false), 2000);\n        setQty(1);\n    };\n\n    const isMax = qty >= product.stock;\n    const isMin = qty <= 1;\n\n    return (\n        <div className=\"flex flex-col items-end gap-2\" onClick={(e) => e.stopPropagation()}>\n            <div className={`flex items-center rounded-lg ${darkMode ? 'bg-zinc-800' : 'bg-slate-100'} p-0.5 border ${darkMode ? 'border-zinc-700' : 'border-slate-200'}`}>\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                    disabled={isMin}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMin ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Minus className=\"w-3 h-3\" /></button>\n\n                <span className={`w-8 text-center text-xs font-bold font-mono ${darkMode ? 'text-white' : 'text-slate-900'}`}>{qty}</span>\n\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.min(product.stock, qty + 1)); }}\n                    disabled={isMax}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMax ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Plus className=\"w-3 h-3\" /></button>\n            </div>\n\n            <button\n                onClick={handleAdd}\n                className={`w-full py-1.5 px-3 rounded-xl transition-all duration-300 shadow-md flex items-center justify-center gap-1.5 active:scale-95 ${added\n                    ? 'bg-green-500 text-white shadow-green-500/30'\n                    : darkMode\n                        ? 'bg-white text-black hover:bg-orange-400 hover:text-black shadow-white/10'\n                        : 'bg-orange-500 text-white hover:bg-orange-600 shadow-orange-500/20'\n                    }`}\n            >\n                {added ? (\n                    <CheckCircle className=\"w-4 h-4\" />\n                ) : (\n                    <>\n                        <Plus className=\"w-5 h-5 md:w-4 md:h-4\" />\n                    </>\n                )}\n            </button>\n        </div>\n    );\n};\n\n// --- COMPONENTE PRODUCT CARD OPTIMIZADO (MEMOIZED) ---\nconst ProductCard = React.memo(({ p, settings, currentUser, toggleFavorite, setSelectedProduct, manageCart, calculateItemPrice, darkMode }) => {\n    // Clases din√°micas basadas en el tema\n    const cardBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const cardBorder = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n    const cardHoverBorder = darkMode ? 'hover:border-orange-500/50' : 'hover:border-orange-400';\n    const cardShadow = darkMode ? 'hover:shadow-[0_0_30px_rgba(249,115,22,0.1)]' : 'shadow-md hover:shadow-xl hover:shadow-orange-100';\n    const imageBg = darkMode ? 'bg-gradient-to-b from-slate-900 to-[#0a0a0a]' : 'bg-gradient-to-b from-slate-100 to-white';\n    const textPrimary = darkMode ? 'text-white' : 'text-slate-900';\n    const textSecondary = darkMode ? 'text-slate-400' : 'text-slate-600';\n    const infoBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const borderColor = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n\n    return (\n        <div className={`${cardBg} rounded-2xl sm:rounded-3xl border ${cardBorder} overflow-hidden group ${cardHoverBorder} ${cardShadow} transition duration-500 relative flex flex-col h-full animate-fade-in content-visibility-auto contain-content`}>\n\n            {/* Imagen y Badges */}\n            <div className={`h-56 sm:h-80 ${imageBg} m-2 sm:m-3 p-2 sm:p-3 flex items-center justify-center relative overflow-hidden cursor-zoom-in transition-all duration-500`} onClick={() => setSelectedProduct(p)}>\n                {/* Efecto Glow Fondo */}\n                <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition duration-500\"></div>\n\n                {p.image ? (\n                    <div className=\"w-full h-full flex items-center justify-center overflow-hidden\">\n                        <img\n                            src={p.image}\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                            onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.nextSibling.style.display = 'flex'; }}\n                            className={`max-w-full max-h-full rounded-xl sm:rounded-2xl border-4 ${darkMode ? 'border-cyan-500/30' : 'border-orange-300'} shadow-lg z-10 transition-transform duration-700 group-hover:scale-105 ${p.stock <= 0 ? 'grayscale opacity-50' : ''}`}\n                        />\n                    </div>\n                ) : null}\n\n\n                {/* Bot√≥n Ver (Visible en Mobile/Touch) */}\n                <button\n                    onClick={(e) => {\n                        e.stopPropagation();\n                        setSelectedProduct(p);\n                    }}\n                    className={`absolute bottom-2 right-2 sm:bottom-4 sm:right-4 z-30 ${darkMode ? 'bg-black/60 border-white/20' : 'bg-white/90 border-slate-200'} backdrop-blur-md p-2 sm:p-3 rounded-full ${darkMode ? 'text-white' : 'text-slate-700'} border md:hidden`}\n                >\n                    <Maximize2 className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                </button>\n\n                {/* Fallback Icon */}\n                <div className=\"hidden w-full h-full flex items-center justify-center z-0 absolute inset-0\" style={{ display: p.image ? 'none' : 'flex' }}>\n                    <div className={`flex flex-col items-center justify-center ${darkMode ? 'text-slate-700' : 'text-slate-400'}`}>\n                        <ImageIcon className=\"w-12 h-12 sm:w-16 sm:h-16 mb-2 opacity-50\" />\n                        <span className=\"text-[10px] sm:text-xs font-bold uppercase tracking-widest opacity-50\">Sin Imagen</span>\n                    </div>\n                </div>\n\n                {/* OVERLAY AGOTADO (Mejorado) */}\n                {p.stock <= 0 && (\n                    <div className={`absolute inset-0 z-30 flex items-center justify-center ${darkMode ? 'bg-black/40' : 'bg-white/60'} backdrop-blur-[2px]`}>\n                        <div className=\"border-4 border-red-500 p-2 sm:p-4 -rotate-12 bg-black/80 shadow-[0_0_30px_rgba(239,68,68,0.5)] transform scale-90 sm:scale-110\">\n                            <span className=\"text-red-500 font-black text-lg sm:text-2xl md:text-3xl tracking-[0.15em] sm:tracking-[0.2em] uppercase\">AGOTADO</span>\n                        </div>\n                    </div>\n                )}\n\n                {/* BADGE: DESTACADO */}\n                {p.isFeatured && p.stock > 0 && (\n                    <div className=\"absolute top-0 left-0 bg-gradient-to-r from-yellow-500 to-orange-500 text-black text-[9px] sm:text-[10px] font-black px-2 sm:px-4 py-1 sm:py-1.5 rounded-br-xl sm:rounded-br-2xl uppercase tracking-wider z-20 shadow-lg flex items-center gap-1\">\n                        <Star className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 fill-current\" /> Destacado\n                    </div>\n                )}\n\n                {/* Descuento Badge */}\n                {p.discount > 0 && p.stock > 0 && !p.isFeatured && (\n                    <span className=\"absolute top-2 left-2 sm:top-4 sm:left-4 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg shadow-lg z-20 shadow-red-600/20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Combined Badge (Featured + Discount) */}\n                {p.discount > 0 && p.stock > 0 && p.isFeatured && (\n                    <span className=\"absolute top-8 sm:top-10 left-0 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-0.5 sm:py-1 rounded-r-lg shadow-lg z-20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Bot√≥n Favorito (Funcional) */}\n                <button\n                    onClick={(e) => { e.stopPropagation(); toggleFavorite(p) }}\n                    className={`absolute top-2 right-2 sm:top-4 sm:right-4 p-2 sm:p-3 rounded-full z-20 transition shadow-lg backdrop-blur-sm border ${currentUser?.favorites?.includes(p.id) ? 'bg-red-500 text-white border-red-500 shadow-red-500/30' : darkMode ? 'bg-white/10 text-slate-300 border-white/10 hover:bg-white hover:text-red-500' : 'bg-slate-100 text-slate-500 border-slate-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200'}`}\n                >\n                    <Heart className={`w-4 h-4 sm:w-5 sm:h-5 ${currentUser?.favorites?.includes(p.id) ? 'fill-current' : ''}`} />\n                </button>\n\n\n            </div>\n\n            {/* Informaci√≥n */}\n            <div className={`p-3 sm:p-4 flex-1 flex flex-col relative z-10 ${infoBg}`}>\n                <div className=\"flex justify-between items-start mb-2 sm:mb-3\">\n                    <p className={`text-[9px] sm:text-[10px] text-orange-500 font-black uppercase tracking-widest ${darkMode ? 'border-orange-900/30 bg-orange-900/10' : 'border-orange-200 bg-orange-50'} border px-1.5 sm:px-2 py-0.5 sm:py-1 rounded`}>\n                        {Array.isArray(p.categories) ? (p.categories.length > 0 ? p.categories[0] : p.category || 'Sin categor√≠a') : (p.category || 'Sin categor√≠a')}\n                    </p>\n                    {/* Estado de Stock */}\n                    {settings?.showStockCount !== false && p.stock > 0 && p.stock <= (settings?.lowStockThreshold || 5) ? (\n                        <span className=\"text-[9px] sm:text-[10px] text-red-500 font-bold flex items-center gap-1\">\n                            <AlertCircle className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" /> √öltimos {p.stock}\n                        </span>\n                    ) : null}\n                </div>\n\n                <h3 className={`${textPrimary} font-bold text-sm sm:text-base leading-tight mb-2 sm:mb-4 group-hover:text-orange-600 transition line-clamp-2 min-h-[2rem] sm:min-h-[2.5rem]`}>\n                    {p.name}\n                </h3>\n\n                <div className={`mt-auto pt-2 sm:pt-4 border-t ${borderColor} flex items-end justify-between`}>\n                    <div className=\"flex flex-col\">\n                        {p.discount > 0 && (\n                            <span className={`text-[10px] sm:text-xs ${textSecondary} line-through font-medium mb-0.5 sm:mb-1`}>\n                                ${p.basePrice.toLocaleString()}\n                            </span>\n                        )}\n                        <span className={`text-lg sm:text-2xl font-black ${textPrimary} tracking-tight flex items-center gap-1`}>\n                            ${calculateItemPrice(p.basePrice, p.discount).toLocaleString()}\n                        </span>\n                    </div>\n\n                    {/* Add to Cart with Quantity */}\n                    {p.stock > 0 && (\n                        <div\n                            className=\"flex items-center gap-2\"\n                            onClick={(e) => e.stopPropagation()}\n                        >\n                            <QuickAddButton\n                                product={p}\n                                onAdd={(product, qty) => manageCart(product, qty)}\n                                darkMode={darkMode}\n                            />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div >\n    );\n}, (prev, next) => {\n    return (\n        prev.p.id === next.p.id &&\n        prev.p.stock === next.p.stock &&\n        prev.p.basePrice === next.p.basePrice &&\n        prev.p.name === next.p.name &&\n        prev.p.image === next.p.image &&\n        prev.currentUser?.favorites?.includes(prev.p.id) === next.currentUser?.favorites?.includes(next.p.id)\n    );\n});\n\n\n// --- Bot Product Card Component ---\nconst BotProductCard = ({ product, onAdd }) => {\n    const [qty, setQty] = useState(1);\n    const hasStock = product.stock > 0;\n\n    return (\n        <div className=\"min-w-[140px] w-[140px] bg-[#1a1a1a] border border-white/10 rounded-xl overflow-hidden shadow-lg snap-start flex-shrink-0 group flex flex-col\">\n            <div className=\"h-28 bg-white relative overflow-hidden\">\n                <img\n                    src={product.image || 'https://via.placeholder.com/150'}\n                    alt={product.name}\n                    className={`w-full h-full object-contain p-2 transition duration-300 ${hasStock ? 'group-hover:scale-110' : 'grayscale opacity-50'}`}\n                />\n                {!hasStock && (\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\n                        <span className=\"text-white text-[10px] font-bold bg-red-600 px-2 py-1 rounded\">AGOTADO</span>\n                    </div>\n                )}\n            </div>\n            <div className=\"p-2 flex-1 flex flex-col\">\n                <h4 className=\"text-white text-xs font-bold truncate mb-1\">{product.name}</h4>\n                <div className=\"flex justify-between items-center mb-2\">\n                    <p className=\"text-yellow-500 text-xs font-black\">${parseInt(product.basePrice).toLocaleString()}</p>\n                    {product.discount > 0 && <span className=\"text-[10px] text-red-400 font-bold\">-{product.discount}%</span>}\n                </div>\n\n                {hasStock ? (\n                    <div className=\"mt-auto space-y-2\">\n                        <div className=\"flex items-center justify-between bg-zinc-800 rounded-lg p-1 mb-2\">\n                            <button\n                                onClick={() => setQty(Math.max(1, qty - 1))}\n                                className=\"w-6 h-6 flex items-center justify-center text-white hover:bg-zinc-700 rounded transition font-bold\"\n                            >-</button>\n                            <span className=\"text-white text-xs font-mono font-bold\">{qty}</span>\n                            <button\n                                onClick={() => setQty(Math.min(product.stock, qty + 1))}\n                                className=\"w-6 h-6 flex items-center justify-center text-white hover:bg-zinc-700 rounded transition font-bold\"\n                            >+</button>\n                        </div>\n                        <button\n                            onClick={() => onAdd(product, qty)}\n                            className=\"w-full bg-yellow-600 hover:bg-yellow-500 text-white text-[10px] py-1.5 rounded-lg transition font-medium flex items-center justify-center gap-1 active:scale-95\"\n                        >\n                            Agregar <span className=\"text-xs\">+</span>\n                        </button>\n                    </div>\n                ) : (\n                    <button disabled className=\"w-full mt-auto bg-slate-700 text-slate-400 text-[10px] py-1.5 rounded-lg cursor-not-allowed\">\n                        Sin Stock\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n};\n\n// --- COMPONENTE SUSTIA (AI ASSISTANT) ---\nconst SustIABot = React.memo(({ settings, products, addToCart, controlPanel, coupons }) => {\n    // 1. Verificaci√≥n de Plan - Solo disponible en Plan Premium\n    const forceEnabled = (() => {\n        try {\n            const href = String(window.location.href || '');\n            if (href.includes('sustia=1')) return true;\n            return new URLSearchParams(window.location.search).get('sustia') === '1';\n        } catch { return false; }\n    })();\n    if (!forceEnabled && settings?.subscriptionPlan !== 'premium') return null;\n\n    const [isOpen, setIsOpen] = useState(false);\n\n    // Custom Bot Image (Configurable)\n    const botImage = settings?.botImage || \"sustia-ai-v2.jpg\";\n\n    const chatStorageKey = `sustore_sustia_chat_${DEFAULT_APP_ID}`;\n    const defaultBotMessage = { role: 'model', text: '¬°Hola! Soy SustIA ü§ñ, tu asistente personal. ¬øBuscas algo especial hoy? Puedo verificar stock y agregar productos a tu carrito.' };\n    const [messages, setMessages] = useState([defaultBotMessage]);\n    const [inputValue, setInputValue] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    const [lastContext, setLastContext] = useState(null); // Para manejar contexto (S√≠/No)\n    const messagesEndRef = useRef(null);\n    const messagesRef = useRef(messages);\n    const inFlightRef = useRef(false);\n    const pendingTextRef = useRef(null);\n    const isMountedRef = useRef(true);\n\n    const safeProducts = Array.isArray(products) ? products : [];\n    const safeCoupons = Array.isArray(coupons) ? coupons : [];\n    const aiEnabled = !!settings?.aiAssistant?.enabled;\n\n    const normalizeText = (value) => {\n        if (value === null || value === undefined) return '';\n        return String(value).toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").trim();\n    };\n\n    const tokenize = (value) => {\n        const t = normalizeText(value);\n        if (!t) return [];\n        const raw = t.split(/[\\s,.;:!?/()\\\\[\\]{}\"‚Äú‚Äù'‚Äô\\-+*_]+/).filter(Boolean);\n        const stop = new Set([\n            'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas',\n            'de', 'del', 'en', 'con', 'sin', 'para', 'por', 'a', 'al',\n            'que', 'como', 'cual', 'cuales', 'donde', 'cuando', 'quien', 'quienes',\n            'hola', 'buenas', 'buenos', 'dia', 'dias', 'tardes', 'noches',\n            'busco', 'buscar', 'tenes', 'tienes', 'precio', 'vale', 'cuesta',\n            'quiero', 'necesito', 'hay', 'me', 'te', 'mi', 'mis', 'tu', 'tus',\n            'agrega', 'agregar', 'agregame', 'agregalo', 'sumar', 'sumame', 'poner', 'pone',\n            'comprar', 'compralo', 'llevo', 'carrito', 'bolsa', 'cesta',\n            'mas', 'menos', 'muy', 'super', 're'\n        ]);\n        return raw.filter(w => w.length > 1 && !stop.has(w) && !/^\\d+$/.test(w));\n    };\n\n    const parseHumanNumber = (rawNumber, contextText) => {\n        if (!rawNumber) return null;\n        const n = parseFloat(String(rawNumber).replace(',', '.'));\n        if (!Number.isFinite(n)) return null;\n        const hasK = contextText.includes(`${rawNumber}k`) || contextText.includes(`${rawNumber} k`) || contextText.includes(`${rawNumber}mil`) || contextText.includes(`${rawNumber} mil`);\n        if (hasK) return n * 1000;\n        return n;\n    };\n\n    const parseQuantity = (t) => {\n        const text = normalizeText(t);\n        const m1 = text.match(/\\b(?:x|por)\\s*(\\d{1,3})\\b/);\n        if (m1) return Math.max(1, Math.min(99, parseInt(m1[1], 10)));\n        const m2 = text.match(/\\b(\\d{1,3})\\s*(?:u|ud|uds|unidad|unidades|pcs|piezas)\\b/);\n        if (m2) return Math.max(1, Math.min(99, parseInt(m2[1], 10)));\n        const m3 = text.match(/\\b(\\d{1,2})\\b/);\n        if (m3 && text.match(/\\b(agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|quiero|llevo|comprar)\\b/)) {\n            return Math.max(1, Math.min(99, parseInt(m3[1], 10)));\n        }\n        return 1;\n    };\n\n    const getProductCategories = (p) => {\n        const cats = [];\n        if (Array.isArray(p?.categories)) cats.push(...p.categories);\n        if (typeof p?.category === 'string' && p.category.trim()) cats.push(p.category);\n        return cats\n            .filter(Boolean)\n            .map(c => String(c).trim())\n            .filter(Boolean);\n    };\n\n    const getProductFinalPrice = (p) => {\n        const base = Number(p?.basePrice) || 0;\n        const disc = Number(p?.discount) || 0;\n        if (typeof calculateItemPrice === 'function') return calculateItemPrice(base, disc);\n        return base * (1 - disc / 100);\n    };\n\n    const aiContext = useMemo(() => {\n        const storeName = settings?.storeName ? String(settings.storeName) : '';\n        const aboutUsText = settings?.aboutUsText ? String(settings.aboutUsText) : '';\n\n        const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n        const pickupEnabled = !!settings?.shippingPickup?.enabled;\n        const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n        const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n        const pickupAddress = settings?.shippingPickup?.address || '';\n        const shippingParts = [];\n        if (pickupEnabled) shippingParts.push(`Retiro en local: ${pickupAddress ? pickupAddress : 'a coordinar'}.`);\n        if (deliveryEnabled) {\n            if (freeAbove > 0) shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n            else shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n        }\n\n        const hasCard = !!settings?.paymentMercadoPago?.enabled;\n        const hasTransfer = !!settings?.paymentTransfer?.enabled;\n        const hasCash = !!settings?.paymentCash && pickupEnabled;\n        const payParts = [];\n        if (hasCard) payParts.push('Tarjeta (Mercado Pago)');\n        if (hasTransfer) payParts.push('Transferencia');\n        if (hasCash) payParts.push('Efectivo (solo retiro en local)');\n\n        const categories = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...safeProducts.flatMap(p => getProductCategories(p))])]\n            .map(c => String(c).trim())\n            .filter(Boolean)\n            .slice(0, 20);\n\n        const productHints = safeProducts\n            .filter(p => p && (Number(p.stock) || 0) > 0 && p.isActive !== false)\n            .map(p => ({\n                name: String(p.name || '').trim(),\n                price: getProductFinalPrice(p),\n                discount: Number(p.discount) || 0,\n                featured: !!p.isFeatured,\n                cats: getProductCategories(p).slice(0, 2).join(', ')\n            }))\n            .filter(p => p.name)\n            .sort((a, b) => (b.discount - a.discount) || (Number(b.featured) - Number(a.featured)) || (a.price - b.price))\n            .slice(0, 25)\n            .map(p => `${p.name} ‚Äî $${Math.round(p.price).toLocaleString()}${p.cats ? ` ‚Äî ${p.cats}` : ''}`);\n\n        return {\n            storeName,\n            aboutUsText,\n            shipping: shippingParts.join(' '),\n            payments: payParts.join(', '),\n            categories,\n            productHints\n        };\n    }, [settings, safeProducts]);\n\n    const callExternalAI = async ({ userText, history, signal }) => {\n        const res = await fetch('/api/ai/chat', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                userText,\n                messages: Array.isArray(history) ? history : [],\n                context: aiContext\n            }),\n            signal\n        });\n        const data = await res.json().catch(() => ({}));\n        if (!res.ok) throw new Error(data?.error || 'ai_error');\n        if (!data?.text || typeof data.text !== 'string') throw new Error('ai_invalid');\n        return { text: data.text };\n    };\n\n    // Auto-scroll al √∫ltimo mensaje\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isOpen]);\n\n    useEffect(() => {\n        messagesRef.current = messages;\n    }, [messages]);\n\n    useEffect(() => {\n        return () => { isMountedRef.current = false; };\n    }, []);\n\n    // --- HERRAMIENTA DE B√öSQUEDA INTELIGENTE (FUZZY) ---\n    const fuzzySearch = (text, query) => {\n        if (!query || typeof query !== 'string') return false;\n        if (!text || typeof text !== 'string') return false;\n\n        const str = normalizeText(text);\n        const patt = normalizeText(query);\n\n        if (str.includes(patt)) return true; // Coincidencia exacta parcial\n\n        // Coincidencia aproximada simple (para Typos)\n        // Si m√°s del 70% de los caracteres est√°n presentes en orden relativo\n        let matches = 0;\n        let lastIndex = -1;\n        for (let char of patt) {\n            const index = str.indexOf(char, lastIndex + 1);\n            if (index > -1) {\n                matches++;\n                lastIndex = index;\n            }\n        }\n        return (matches / patt.length) > 0.75;\n    };\n\n    // --- CEREBRO LOCAL AVANZADO V5 (Universal & Contextual) ---\n    const callLocalBrain = async (userText, currentMessages) => {\n        await new Promise(resolve => setTimeout(resolve, 800)); // Simular pensamiento\n        const text = normalizeText(userText);\n        const qty = parseQuantity(text);\n\n        // 0. Detectar Saludos\n        if (text.match(/\\b(hola|holas|buen dia|buenos dias|buenas tardes|buenas noches|buenas|hello|hi|hey|que tal|como estas|como va|todo bien)\\b/)) {\n            return { text: \"¬°Hola! üëã ¬øQu√© quer√©s hacer? Pod√©s pedirme productos, ofertas, cupones, env√≠o, pagos o que agregue algo al carrito.\" };\n        }\n\n        if (text.match(/\\b(quien sos|que sos|que haces|sos real|sos un bot|asistente)\\b/)) {\n            const storeName = settings?.storeName ? ` de **${settings.storeName}**` : '';\n            return { text: `Soy SustIA${storeName}. Puedo ayudarte a encontrar productos, ver ofertas/cupones y armar el carrito m√°s r√°pido.` };\n        }\n\n        if (text.match(/\\b(categorias|categoria|rubros|rubro|secciones)\\b/)) {\n            const prodCats = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n            const cats = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...prodCats])]\n                .map(c => String(c).trim())\n                .filter(Boolean);\n            if (cats.length === 0) return { text: \"Todav√≠a no tengo categor√≠as configuradas. Decime qu√© est√°s buscando y lo resuelvo igual.\" };\n            const top = cats.slice(0, 10);\n            return { text: `Tenemos estas categor√≠as:\\n\\n${top.map(c => `- ${c}`).join('\\n')}\\n\\nDecime cu√°l te interesa y te muestro opciones.` };\n        }\n\n        if (text.match(/\\b(sobre|info|informacion|quienes somos|about)\\b/)) {\n            const about = settings?.aboutUsText || '';\n            if (about.trim()) return { text: about.trim() };\n            return { text: \"Esta tienda todav√≠a no carg√≥ su secci√≥n ‚ÄúSobre nosotros‚Äù. ¬øQuer√©s que te ayude a encontrar un producto?\" };\n        }\n\n        // 0.1 Comandos de Sistema (Universal)\n        if (controlPanel) {\n            if (text.match(/modo\\s*(?:oscuro|noche|dark)/)) {\n                controlPanel.setDarkMode(true);\n                return { text: \"He activado el modo oscuro üåô. ¬øMejor para tus ojos?\" };\n            }\n            if (text.match(/modo\\s*(?:claro|dia|light)/)) {\n                controlPanel.setDarkMode(false);\n                return { text: \"He activado el modo claro ‚òÄÔ∏è.\" };\n            }\n            if (text.match(/(?:ver|abrir|ir al)\\s*(?:carrito|bolsa|cesta)/)) {\n                controlPanel.openCart();\n                return { text: \"Abriendo tu carrito de compras... üõí\" };\n            }\n        }\n\n        if (text.match(/\\b(envio|envios|entrega|delivery|domicilio|retiro|retirar|local|pickup)\\b/)) {\n            const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n            const pickupEnabled = !!settings?.shippingPickup?.enabled;\n            const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n            const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n            const pickupAddress = settings?.shippingPickup?.address || '';\n\n            const lines = [];\n            if (pickupEnabled) {\n                lines.push(`üìç Retiro en local: ${pickupAddress ? `**${pickupAddress}**` : 'a coordinar'}.`);\n            }\n            if (deliveryEnabled) {\n                if (freeAbove > 0) {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n                } else {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n                }\n            }\n            if (!pickupEnabled && !deliveryEnabled) {\n                lines.push(\"Todav√≠a no tengo configurado el m√©todo de entrega para esta tienda.\");\n            }\n            lines.push(\"Si me dec√≠s tu ciudad/zona, te digo lo mejor para vos.\");\n            return { text: lines.join('\\n') };\n        }\n\n        if (text.match(/\\b(pago|pagos|tarjeta|mercado\\s*pago|transferencia|cbu|alias|efectivo)\\b/)) {\n            const hasCard = !!settings?.paymentMercadoPago?.enabled;\n            const hasTransfer = !!settings?.paymentTransfer?.enabled;\n            const hasCash = !!settings?.paymentCash && !!settings?.shippingPickup?.enabled;\n            const wantsTransferData = hasTransfer && text.match(/\\b(alias|cbu|transferencia)\\b/);\n            const options = [];\n            if (hasCard) options.push(\"üí≥ Tarjeta (Mercado Pago)\");\n            if (hasTransfer) options.push(\"üè¶ Transferencia\");\n            if (hasCash) options.push(\"üíµ Efectivo (solo retiro en local)\");\n\n            if (options.length === 0) {\n                return { text: \"Todav√≠a no tengo m√©todos de pago configurados para esta tienda. Si quer√©s, te paso WhatsApp para coordinar.\" };\n            }\n            if (wantsTransferData) {\n                const holderName = settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName).trim() : '';\n                const alias = settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias).trim() : '';\n                const cbu = settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu).trim() : '';\n                const lines = [\"Para transferir, us√° estos datos:\"];\n                if (holderName) lines.push(`- Titular: ${holderName}`);\n                if (alias) lines.push(`- Alias: ${alias}`);\n                if (cbu) lines.push(`- CBU: ${cbu}`);\n                if (!holderName && !alias && !cbu) {\n                    lines.push(\"- A√∫n no est√°n cargados los datos de transferencia para esta tienda.\");\n                }\n                return { text: lines.join('\\n') };\n            }\n            return { text: `Pod√©s pagar con:\\n\\n${options.map(o => `- ${o}`).join('\\n')}\\n\\n¬øCon cu√°l prefer√≠s?` };\n        }\n\n        // 0.2 Detectar Ayuda/Contacto\n        if (text.match(/\\b(ayuda|soporte|contacto|human|persona|asesor)\\b/)) {\n            if (settings?.whatsappLink) {\n                return { text: `Claro. Si necesitas asistencia personalizada con un humano üßë‚Äçüíª, escr√≠benos a nuestro WhatsApp: ${settings.whatsappLink} üì≤` };\n            }\n            return { text: \"Estoy dise√±ado para ayudarte a encontrar productos las 24hs. ü§ñ ¬øBuscas algo en espec√≠fico?\" };\n        }\n\n        // 0.3 Detectar Promociones/Cupones\n        if (text.match(/\\b(descuento|promo|cupon|oferta|codigo|rebaja)\\b/)) {\n            const activeCoupons = safeCoupons.filter(c => c?.active);\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0);\n\n            if (activeCoupons.length > 0) {\n                const couponText = activeCoupons\n                    .filter(c => c?.code)\n                    .map(c => `üé´ **${c.code}** (${c.discountType === 'percentage' ? c.value + '%' : '$' + c.value} OFF)`)\n                    .join(\"\\n\");\n                return { text: `¬°S√≠! Tenemos estos cupones disponibles para ti:\\n\\n${couponText}\\n\\n¬°√ösalos al finalizar tu compra! üõí` };\n            } else if (deals.length > 0) {\n                setLastContext({ type: 'show_deals', data: deals.sort(() => 0.5 - Math.random()).slice(0, 5) });\n                return { text: `No tengo c√≥digos de cup√≥n activos ahora, pero s√≠ tenemos **${deals.length}** productos con descuento. ¬øQuer√©s que te muestre los mejores? üè∑Ô∏è` };\n            } else {\n                return { text: \"Por el momento no tengo c√≥digos promocionales activos, pero nuestros precios son los mejores del mercado. üòâ\" };\n            }\n        }\n\n        // 1. Manejo de Contexto (Conversacional)\n        if (lastContext) {\n            if (text.match(/\\b(si|claro|dale|bueno|yes|por favor|obvio)\\b/)) {\n                const ctx = lastContext;\n                setLastContext(null);\n                if (ctx.type === 'suggest_cross_sell') {\n                    return {\n                        text: \"¬°Excelente! Mira estas oportunidades que seleccion√© para ti: üî•\",\n                        products: ctx.data\n                    };\n                }\n                if (ctx.type === 'show_deals') {\n                    return {\n                        text: \"Listo. Estas son algunas ofertas que valen la pena ahora mismo:\",\n                        products: ctx.data\n                    };\n                }\n            } else if (text.match(/\\b(no|gracias|paso|cancelar|asi esta bien)\\b/)) {\n                setLastContext(null);\n                return { text: \"Entendido. ¬øNecesitas ayuda con algo m√°s? üòä\" };\n            }\n        }\n\n        // 2. Detectar Intenciones\n        const isCheaper = text.match(/(?:mas|muy|super)\\s*(?:barato|economico|bajo)|oferta|menos|mas\\s*economico/);\n        const isExpensive = text.match(/(?:mas|muy|super)\\s*(?:caro|mejor|calidad|top|premium)|costoso|lujo/);\n        const isBuying = text.match(/(?:agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|comprar|quiero|dame|carrito|llevo|lo quiero)/);\n\n        // 2.1 Filtros de Precio Inteligentes (NUEVO)\n        let minPrice = 0;\n        let maxPrice = Infinity;\n\n        // Detectar \"menos de X\"\n        const lessThanMatch = text.match(/(?:menos|menor|bajo)\\s*(?:de|a|que)?\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (lessThanMatch) {\n            const parsed = parseHumanNumber(lessThanMatch[1], text);\n            if (parsed !== null) maxPrice = parsed;\n        }\n\n        // Detectar \"entre X y Y\"\n        const betweenMatch = text.match(/entre\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?\\s*y\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (betweenMatch) {\n            const parsedMin = parseHumanNumber(betweenMatch[1], text);\n            const parsedMax = parseHumanNumber(betweenMatch[2], text);\n            if (parsedMin !== null) minPrice = parsedMin;\n            if (parsedMax !== null) maxPrice = parsedMax;\n        }\n\n        // 3. Detectar Categor√≠a (Fuzzy)\n        const availableCategories = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n        const detectedCategoryVal = availableCategories.find(c => fuzzySearch(c, text) || fuzzySearch(text, c));\n        const targetCategory = detectedCategoryVal ? detectedCategoryVal.toLowerCase() : null;\n\n        // 4. B√∫squeda y Scoring de Productos\n        const synonyms = new Map([\n            ['celu', 'celular'],\n            ['cel', 'celular'],\n            ['tele', 'televisor'],\n            ['tv', 'televisor'],\n            ['compu', 'computadora'],\n            ['notebook', 'laptop'],\n            ['auris', 'auriculares'],\n            ['zapas', 'zapatillas'],\n            ['remera', 'camiseta'],\n            ['remeras', 'camisetas']\n        ]);\n        const keywords = tokenize(text).flatMap(k => {\n            const alt = synonyms.get(k);\n            return alt ? [k, alt] : [k];\n        });\n\n        let candidates = safeProducts.filter(p => (Number(p?.stock) || 0) > 0 && p?.isActive !== false);\n\n        // Aplicar filtros de precio\n        candidates = candidates.filter(p => {\n            const fp = getProductFinalPrice(p);\n            return fp >= minPrice && fp <= maxPrice;\n        });\n\n        // Filtro por categor√≠a detectada\n        if (targetCategory) {\n            candidates = candidates.filter(p => getProductCategories(p).some(c => normalizeText(c) === targetCategory));\n        }\n\n        // Scoring\n        if (keywords.length > 0) {\n            candidates = candidates.map(p => {\n                let score = 0;\n                const pName = normalizeText(p?.name || \"\");\n                const pDesc = normalizeText(p?.description || \"\");\n                const pCats = getProductCategories(p).map(c => normalizeText(c));\n\n                keywords.forEach(k => {\n                    if (!k) return;\n                    if (pName.includes(k)) score += 12;\n                    else if (fuzzySearch(pName, k)) score += 6;\n\n                    if (pDesc.includes(k)) score += 4;\n                    else if (fuzzySearch(pDesc, k)) score += 2;\n\n                    if (pCats.some(c => c.includes(k))) score += 6;\n                });\n                if ((Number(p?.discount) || 0) > 0) score += 2;\n                if (p?.isFeatured) score += 2;\n                return { ...p, score };\n            }).filter(p => p.score > 0);\n\n            // Ordenar por relevancia\n            candidates.sort((a, b) => b.score - a.score);\n        }\n\n        // 4.1 Recuperaci√≥n Contextual (Si el usuario dice \"agregalo\" y no hay keywords de producto)\n        // Buscamos en el historial previo si se mostraron productos\n        if (candidates.length === 0 && isBuying) {\n            // Buscar el √∫ltimo mensaje del modelo que tuviera productos\n            // currentMessages incluye el mensaje actual del usuario al final.\n            const history = [...currentMessages].reverse();\n            // history[0] es el mensaje del usuario actual\n            // history[1] deber√≠a ser el √∫ltimo del modelo\n            const lastModelMsg = history.find(m => m.role === 'model' && m.products && m.products.length > 0);\n\n            if (lastModelMsg) {\n                // Asumimos el primero de la lista anterior como el deseado\n                candidates = [lastModelMsg.products[0]];\n            }\n        }\n\n        // Ordenamiento por precio (secundario)\n        if (isCheaper) candidates.sort((a, b) => getProductFinalPrice(a) - getProductFinalPrice(b));\n        if (isExpensive) candidates.sort((a, b) => getProductFinalPrice(b) - getProductFinalPrice(a));\n\n        // 5. Respuesta\n        if (candidates.length === 0) {\n            // Inteligencia Proactiva: Si no hay match, ofrecer ofertas o destacados\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0).slice(0, 3);\n            if (deals.length > 0) {\n                setLastContext({ type: 'suggest_cross_sell', data: deals });\n                return { text: \"Mmm, no encontr√© exactamente eso ü§î. ¬øPero te gustar√≠a ver nuestras ofertas del d√≠a? üè∑Ô∏è\" };\n            }\n            // Dynamic \"Smart\" Suggestions\n            let suggestionText = \"No encontr√© nada parecido. üòÖ\";\n\n            if (availableCategories.length > 0) {\n                // Get 3 random unique categories\n                const shuffled = availableCategories.sort(() => 0.5 - Math.random());\n                const topCats = shuffled.slice(0, 3).join(\", \");\n                suggestionText = `No tengo eso por ahora. Pero mira, en esta tienda tenemos cosas de: **${topCats}**. ¬øTe sirve algo de eso?`;\n            } else {\n                suggestionText = \"No encontr√© nada con ese nombre. ¬øQuiz√°s probando con otra palabra m√°s simple?\";\n            }\n\n            return { text: suggestionText };\n        }\n\n        const topMatches = candidates.slice(0, 5);\n\n        // Acci√≥n de Compra\n        if (isBuying && topMatches.length > 0) {\n            const best = topMatches[0];\n            addToCart(best, qty);\n\n            // --- CROSS-SELLING UNIVERSAL ---\n            // Buscar productos complementarios (Destacados o con Descuento que NO sean el que acaba de comprar)\n            // Esto funciona para cualquier tienda\n            const suggestions = safeProducts\n                .filter(p => (p.isFeatured || p.discount > 0) && p.id !== best.id && p.stock > 0)\n                .sort(() => 0.5 - Math.random()) // Mezclar\n                .slice(0, 3);\n\n            if (suggestions.length > 0) {\n                setLastContext({ type: 'suggest_cross_sell', data: suggestions });\n                return {\n                    text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí\\n\\n¬øTe gustar√≠a ver algunos productos destacados para complementar tu compra? üëÄ`,\n                    products: [best]\n                };\n            }\n\n            return {\n                text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí ¬øAlgo m√°s?`,\n                products: [best]\n            };\n        }\n\n        let msg = \"Aqu√≠ tienes algunas opciones:\";\n        if (targetCategory) msg = `Encontr√© esto en la categor√≠a ${targetCategory}:`;\n        if (isCheaper) msg = \"Las opciones m√°s econ√≥micas:\";\n\n        return {\n            text: msg,\n            products: topMatches\n        };\n    };\n\n    const withTimeout = async (promise, ms) => {\n        let timeoutId = null;\n        const timeoutPromise = new Promise((_, reject) => {\n            timeoutId = setTimeout(() => reject(new Error('timeout')), ms);\n        });\n        try {\n            return await Promise.race([promise, timeoutPromise]);\n        } finally {\n            if (timeoutId) clearTimeout(timeoutId);\n        }\n    };\n\n    const sendText = async (rawText, opts = {}) => {\n        const alreadyAddedUser = !!opts.alreadyAddedUser;\n        const text = String(rawText || '').trim().slice(0, 300);\n        if (!text) return;\n        if (inFlightRef.current) {\n            if (!alreadyAddedUser) {\n                const newMsgUserQueued = { role: 'client', text };\n                setMessages(prev => [...prev, newMsgUserQueued]);\n            }\n            pendingTextRef.current = { text, alreadyAddedUser: true };\n            return;\n        }\n\n        inFlightRef.current = true;\n        setInputValue('');\n\n        const newMsgUser = alreadyAddedUser ? null : { role: 'client', text };\n        const updatedHistory = [...(messagesRef.current || []), ...(newMsgUser ? [newMsgUser] : [])];\n\n        if (newMsgUser) {\n            setMessages(prev => [...prev, newMsgUser]);\n        }\n        setIsTyping(true);\n\n        try {\n            const localResponse = await withTimeout(callLocalBrain(text, updatedHistory), 12000);\n            if (!isMountedRef.current) return;\n            let finalText = localResponse?.text && typeof localResponse.text === 'string'\n                ? localResponse.text\n                : \"Perd√≥n, tuve un problema procesando eso. ¬øPod√©s reformularlo?\";\n            const safeProducts = Array.isArray(localResponse?.products) ? localResponse.products : undefined;\n\n            const shouldAskExternal = aiEnabled && (!safeProducts || safeProducts.length === 0) && /no encontr[e√©]|no tengo eso|no lo tengo|probando con otra palabra/i.test(finalText);\n            if (shouldAskExternal) {\n                const controller = new AbortController();\n                const id = setTimeout(() => controller.abort(), 8500);\n                try {\n                    const aiRes = await callExternalAI({ userText: text, history: updatedHistory, signal: controller.signal });\n                    if (aiRes?.text) finalText = aiRes.text;\n                } catch { }\n                clearTimeout(id);\n            }\n\n            setMessages(prev => [...prev, {\n                role: 'model',\n                text: finalText,\n                products: safeProducts\n            }]);\n        } catch (e) {\n            if (!isMountedRef.current) return;\n            const fallback = settings?.whatsappLink\n                ? `Uy, se me trab√≥ por un momento. Si quer√©s, habl√° por WhatsApp: ${settings.whatsappLink}`\n                : \"Uy, se me trab√≥ por un momento. ¬øProbamos de nuevo?\";\n            setMessages(prev => [...prev, { role: 'model', text: fallback }]);\n        } finally {\n            if (isMountedRef.current) setIsTyping(false);\n            inFlightRef.current = false;\n            const pending = pendingTextRef.current;\n            if (pending && pending.text) {\n                pendingTextRef.current = null;\n                setTimeout(() => sendText(pending.text, { alreadyAddedUser: pending.alreadyAddedUser === true }), 0);\n            }\n        }\n    };\n\n    const handleSend = async () => {\n        return sendText(inputValue);\n    };\n\n    const handleQuickAction = (value) => {\n        const text = String(value || '').trim();\n        if (!text) return;\n        sendText(text);\n    };\n\n    const clearChat = () => {\n        try {\n            localStorage.removeItem(chatStorageKey);\n        } catch { }\n        setLastContext(null);\n        setMessages([defaultBotMessage]);\n    };\n\n    const quickActions = [\n        { label: 'Ofertas', value: 'Mostrame ofertas' },\n        { label: 'Cupones', value: 'Ten√©s cupones?' },\n        { label: 'Env√≠o', value: 'C√≥mo es el env√≠o?' },\n        { label: 'Pagos', value: 'Qu√© medios de pago hay?' },\n        { label: 'Categor√≠as', value: 'Qu√© categor√≠as ten√©s?' },\n        { label: 'WhatsApp', value: 'Necesito hablar con una persona' }\n    ];\n\n\n\n    return (\n        <div className=\"fixed bottom-6 right-6 left-3 sm:left-auto z-[9999] flex flex-col items-end pointer-events-none\">\n            {isOpen && (\n                <div className=\"bg-[#0a0a0a] border border-yellow-500/30 rounded-2xl w-full max-w-sm sm:max-w-none sm:w-80 md:w-96 h-[min(550px,75dvh)] shadow-2xl flex flex-col mb-4 animate-fade-up overflow-hidden font-sans pointer-events-auto\">\n                    <div className=\"bg-gradient-to-r from-yellow-600 to-amber-600 p-4 flex justify-between items-center shadow-md relative z-10\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-1 bg-white/10 rounded-full backdrop-blur-sm overflow-hidden border border-white/20\">\n                                <img src={botImage} className=\"w-8 h-8 object-cover rounded-full opacity-90\" alt=\"SustIA\" />\n                            </div>\n                            <div>\n                                <h3 className=\"font-bold text-white text-sm\">SustIA</h3>\n                                <p className=\"text-[10px] text-white/80 flex items-center gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse\"></span>\n                                    Asistente Virtual\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <button onClick={clearChat} className=\"text-white/80 hover:text-white p-1 hover:bg-white/10 rounded-lg transition\" title=\"Limpiar chat\">\n                                <Trash2 className=\"w-5 h-5\" />\n                            </button>\n                            <button onClick={() => setIsOpen(false)} className=\"text-white/80 hover:text-white p-1 hover:bg-white/10 rounded-lg transition\" title=\"Cerrar\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-[#111] px-4 py-2 border-b border-white/5\">\n                        <div className=\"flex gap-2 overflow-x-auto pb-1 custom-scrollbar\">\n                            {quickActions.map(a => (\n                                <button\n                                    key={a.label}\n                                    type=\"button\"\n                                    data-testid={`quick-action-${a.label.toLowerCase()}`}\n                                    onClick={() => {\n                                        console.log(\"CLICKED ACTION\", a.value);\n                                        handleQuickAction(a.value);\n                                    }}\n                                    className=\"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-white/10 bg-[#1a1a1a] text-white/90 hover:bg-[#222] transition\"\n                                >\n                                    {a.label}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-5 bg-[#111] custom-scrollbar relative\">\n                        {messages.map((m, i) => (\n                            <div key={i} className={`flex flex-col ${m.role === 'client' ? 'items-end' : 'items-start'}`}>\n                                <div className={`max-w-[85%] p-3.5 rounded-2xl text-sm shadow-sm ${m.role === 'client'\n                                    ? 'bg-yellow-600 text-white rounded-br-sm'\n                                    : 'bg-[#1a1a1a] text-slate-200 rounded-bl-sm border border-white/5'\n                                    }`}>\n                                    <p className=\"whitespace-pre-wrap leading-relaxed\">{m.text}</p>\n                                </div>\n\n                                {m.products && m.products.length > 0 && (\n                                    <div className=\"mt-3 flex gap-3 overflow-x-auto pb-2 w-full custom-scrollbar pl-1 snap-x\">\n                                        {m.products.map(product => (\n                                            <BotProductCard\n                                                key={product.id}\n                                                product={product}\n                                                onAdd={(p, qty) => {\n                                                    addToCart(p, qty);\n                                                    setMessages(prev => [...prev, { role: 'model', text: `Agregado ${qty}x ${p.name} al carrito! üõí` }]);\n                                                }}\n                                            />\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n                        {isTyping && (\n                            <div className=\"flex justify-start\">\n                                <div className=\"bg-[#1a1a1a] p-3 rounded-2xl rounded-bl-none border border-white/5 flex gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\"></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></span>\n                                </div>\n                            </div>\n                        )}\n                        <div ref={messagesEndRef} />\n                    </div>\n\n                    <div className=\"p-3 bg-[#0a0a0a] border-t border-white/10 relative z-0\">\n                        <form onSubmit={(e) => { e.preventDefault(); handleSend(); }} className=\"flex gap-2 items-center\">\n                            <input\n                                className=\"flex-1 bg-[#1a1a1a] border border-white/10 rounded-full px-4 py-2.5 text-sm text-white focus:border-yellow-500/50 outline-none transition placeholder:text-slate-600\"\n                                placeholder=\"Escribe aqu√≠...\"\n                                value={inputValue}\n                                onChange={e => setInputValue(e.target.value)}\n                            />\n                            <button type=\"submit\" className=\"p-2.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full transition shadow-lg shadow-yellow-600/20 disabled:opacity-50 disabled:cursor-not-allowed\" disabled={isTyping || !inputValue.trim()}>\n                                <Send className=\"w-4 h-4\" />\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            )}\n\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"pointer-events-auto w-14 h-14 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(234,179,8,0.4)] hover:scale-110 transition-transform group relative z-50\"\n            >\n                {isOpen ? <X className=\"w-6 h-6 text-white\" /> : <img src=\"sustia-ai-v2.jpg\" className=\"w-full h-full object-cover rounded-full opacity-95 hover:scale-110 transition-transform duration-300\" alt=\"SustIA\" />}\n                {!isOpen && (\n                    <span className=\"absolute -top-1 -right-1 flex h-4 w-4\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-4 w-4 bg-yellow-500 border border-black\"></span>\n                    </span>\n                )}\n            </button>\n        </div>\n    );\n}, (prevProps, nextProps) => {\n    // Custom comparison for performance optimization\n    // Only re-render if isOpen state changes internally (handled by internal state mainly)\n    // or if critical props change deep inside\n    if (prevProps.settings?.subscriptionPlan !== nextProps.settings?.subscriptionPlan) return false;\n    if (prevProps.products !== nextProps.products) return false;\n    // Don't re-render on addToCart change (function ref usually stable but check if it matters)\n    return true;\n});\n\nconst CategoryModal = ({ isOpen, onClose, categories, onAdd, onRemove }) => {\n    const [catName, setCatName] = React.useState('');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (catName.trim()) {\n            onAdd(catName.trim());\n            setCatName('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[10010] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in p-4\">\n            <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] max-w-md w-full relative\">\n                <button onClick={onClose} className=\"absolute top-4 right-4 text-slate-500 hover:text-white transition\">\n                    <X className=\"w-6 h-6\" />\n                </button>\n                <h3 className=\"text-2xl font-bold text-white mb-6 flex items-center gap-2\">\n                    <FolderPlus className=\"w-6 h-6 text-orange-400\" /> Gestionar Categor√≠as\n                </h3>\n\n                <form onSubmit={handleSubmit} className=\"flex gap-2 mb-6\">\n                    <input\n                        className=\"input-cyber flex-1 p-3\"\n                        placeholder=\"Nueva categor√≠a...\"\n                        value={catName}\n                        onChange={(e) => setCatName(e.target.value)}\n                        autoFocus\n                    />\n                    <button type=\"submit\" className=\"bg-orange-600 hover:bg-orange-500 text-white p-3 rounded-xl font-bold transition\">\n                        <Plus className=\"w-5 h-5\" />\n                    </button>\n                </form>\n\n                <div className=\"space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar\">\n                    {categories.map((cat, index) => (\n                        <div key={index} className=\"flex items-center justify-between p-3 bg-slate-900/50 rounded-xl border border-slate-800 group hover:border-slate-700 transition\">\n                            <span className=\"text-slate-300 font-medium\">{cat}</span>\n                            <button\n                                onClick={() => onRemove(cat)}\n                                className=\"text-slate-600 hover:text-red-500 transition opacity-0 group-hover:opacity-100\"\n                            >\n                                <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                        </div>\n                    ))}\n                    {categories.length === 0 && (\n                        <p className=\"text-center text-slate-600 italic py-4\">No hay categor√≠as definidas</p>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst ADMIN_PANEL_GUIDES = {\n    dashboard: {\n        title: 'Inicio (Panel de Control)',\n        description: 'Ac√° ten√©s el resumen general de tu tienda: ventas, ingresos y m√©tricas para tomar decisiones r√°pidas.',\n        sections: [\n            {\n                title: 'Qu√© mirar primero',\n                bullets: [\n                    'Ingresos brutos y beneficio neto estimado para ver c√≥mo viene el mes.',\n                    'Rendimiento mensual para comparar meses recientes.',\n                    'Movimientos recientes para detectar ingresos/gastos r√°pido.'\n                ]\n            },\n            {\n                title: 'Acciones t√≠picas',\n                bullets: [\n                    'Us√° los botones/atajos del panel para ver detalles de m√©tricas y reportes.',\n                    'Registr√° ventas manuales si vendiste fuera del checkout (mostrador / en casa).'\n                ]\n            }\n        ]\n    },\n    orders: {\n        title: 'Pedidos',\n        description: 'Gestion√° los pedidos que entran: ver detalle, finalizar y eliminar.',\n        sections: [\n            {\n                title: 'C√≥mo operar',\n                bullets: [\n                    'Abr√≠ un pedido con el √≠cono de ojo para ver productos, datos del cliente y totales.',\n                    'Marc√° como finalizado con el √≠cono de tilde cuando ya est√© entregado/pagado.',\n                    'Elimin√° con el √≠cono de papelera solo si fue un pedido inv√°lido o duplicado.'\n                ]\n            },\n            {\n                title: 'Notificaci√≥n',\n                bullets: [\n                    'El bot√≥n ‚ÄúNotificaci√≥n pedidos‚Äù activa o mutea el sonido/alerta de nuevos pedidos (solo admins).'\n                ]\n            }\n        ]\n    },\n    products: {\n        title: 'Productos',\n        description: 'Administr√° tu cat√°logo: altas, edici√≥n, categor√≠as, stock y visibilidad.',\n        sections: [\n            {\n                title: 'Crear y organizar',\n                bullets: [\n                    'Us√° ‚ÄúAgregar Producto‚Äù para cargar nombre, imagen, precio y stock.',\n                    'Us√° ‚ÄúCategor√≠as‚Äù para crear/editar categor√≠as y ordenar el cat√°logo.'\n                ]\n            },\n            {\n                title: 'Stock y visibilidad',\n                bullets: [\n                    'Revis√° el stock para evitar vender sin disponibilidad.',\n                    'Si un producto est√° desactivado, no aparece en la tienda hasta reactivarlo.'\n                ]\n            },\n            {\n                title: 'L√≠mites de plan',\n                bullets: [\n                    'El contador muestra cu√°ntos productos ten√©s seg√∫n el plan; si est√°s cerca del l√≠mite, te avisa.'\n                ]\n            }\n        ]\n    },\n    promos: {\n        title: 'Promos',\n        description: 'Cre√° combos/promociones armando un paquete de productos con un precio final.',\n        sections: [\n            {\n                title: 'Crear una promo',\n                bullets: [\n                    'Pon√© nombre, precio e imagen (opcional) para mostrarla atractiva.',\n                    'Agreg√° productos al combo y ajust√° cantidades.',\n                    'Guard√° y revis√° que el precio final tenga sentido vs. el costo.'\n                ]\n            },\n            {\n                title: 'Edici√≥n y limpieza',\n                bullets: [\n                    'Edit√° una promo existente cuando cambien productos o precios.',\n                    'Elimin√° promos viejas para mantener el panel ordenado.'\n                ]\n            }\n        ]\n    },\n    coupons: {\n        title: 'Cupones',\n        description: 'Cre√° cupones de descuento por porcentaje o monto fijo, con l√≠mites y vencimiento.',\n        sections: [\n            {\n                title: 'Configurar un cup√≥n',\n                bullets: [\n                    'Defin√≠ el c√≥digo (en may√∫sculas), el tipo (porcentaje/fijo) y el valor.',\n                    'Opcional: m√≠nimo de compra, l√≠mite de usos y fecha de vencimiento.',\n                    'Eleg√≠ si es p√∫blico (para redes) o para un email espec√≠fico.'\n                ]\n            },\n            {\n                title: 'Usarlo y compartirlo',\n                bullets: [\n                    'Copi√° el c√≥digo con el bot√≥n de copiar y pasalo por WhatsApp/Instagram.',\n                    'Elimin√° cupones vencidos o que ya no quieras ofrecer.'\n                ]\n            },\n            {\n                title: 'Planes',\n                bullets: [\n                    'Si tu plan no habilita cupones, vas a ver el panel bloqueado y un acceso a planes.'\n                ]\n            }\n        ]\n    },\n    suppliers: {\n        title: 'Proveedores',\n        description: 'Guard√° proveedores y vinculalos a los productos que te abastecen.',\n        sections: [\n            {\n                title: 'Alta y datos',\n                bullets: [\n                    'Cre√° un proveedor con nombre, contacto, tel√©fono, IG y direcci√≥n (si aplica).',\n                    'Asoci√° productos para tener referencia r√°pida de qu√© compra va con qui√©n.'\n                ]\n            },\n            {\n                title: 'Mantenimiento',\n                bullets: [\n                    'Edit√° cuando cambie un contacto o dato fiscal.',\n                    'Elimin√° si ya no trabaj√°s con ese proveedor.'\n                ]\n            }\n        ]\n    },\n    purchases: {\n        title: 'Compras / Stock',\n        description: 'Registr√° reposiciones de stock y llev√° historial de compras a proveedores.',\n        sections: [\n            {\n                title: 'Registrar reposici√≥n',\n                bullets: [\n                    'Eleg√≠ el producto existente, pon√© cantidad y seleccion√° el proveedor.',\n                    'El sistema calcula un costo estimado y ajusta el stock al guardar.'\n                ]\n            },\n            {\n                title: 'Historial y correcciones',\n                bullets: [\n                    'Us√° el historial para revisar compras pasadas.',\n                    'Editar una compra puede ajustar el stock autom√°ticamente: revisalo antes de guardar.'\n                ]\n            }\n        ]\n    },\n    finance: {\n        title: 'Finanzas',\n        description: 'Registr√° inversiones/aportes y gastos para entender el capital y la rentabilidad.',\n        sections: [\n            {\n                title: 'Registrar movimientos',\n                bullets: [\n                    'Carg√° inversiones/aportes con socio, monto y fecha.',\n                    'Carg√° gastos/egresos con descripci√≥n, categor√≠a y fecha.'\n                ]\n            },\n            {\n                title: 'Lectura',\n                bullets: [\n                    'Us√° los totales para ver capital, egresos e impacto en el resultado.',\n                    'Manten√© al d√≠a los gastos para que el beneficio estimado sea realista.'\n                ]\n            }\n        ]\n    },\n    users: {\n        title: 'Usuarios',\n        description: 'Administr√° cuentas: b√∫squeda, roles y auditor√≠a para soporte.',\n        sections: [\n            {\n                title: 'Buscar y filtrar',\n                bullets: [\n                    'Busc√° por nombre, email o usuario desde la barra.',\n                    'Filtr√° por rol para encontrar r√°pido admins/usuarios.'\n                ]\n            },\n            {\n                title: 'Gesti√≥n',\n                bullets: [\n                    'Edit√° el perfil o permisos seg√∫n necesidad.',\n                    'Us√° la auditor√≠a para entender carritos/actividad si hay reclamos.'\n                ]\n            }\n        ]\n    }\n};\n\nfunction AdminHowToUse({ guideKey }) {\n    const [isOpen, setIsOpen] = useState(false);\n    const guide = ADMIN_PANEL_GUIDES[guideKey];\n    if (!guide) return null;\n\n    return (\n        <>\n            <button\n                onClick={() => setIsOpen(true)}\n                className=\"px-4 py-2 rounded-xl bg-slate-900/60 hover:bg-slate-900 text-slate-300 hover:text-white border border-slate-800 transition flex items-center gap-2 font-black text-[10px] uppercase tracking-widest\"\n                type=\"button\"\n            >\n                <FileQuestion className=\"w-4 h-4\" />\n                C√≥mo usar\n            </button>\n\n            {isOpen && (\n                <div\n                    className=\"fixed inset-0 z-[20050] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in\"\n                    onClick={() => setIsOpen(false)}\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                >\n                    <div\n                        className=\"w-full max-w-2xl bg-[#0a0a0a] border border-slate-700 rounded-[2rem] shadow-2xl overflow-hidden\"\n                        onClick={(e) => e.stopPropagation()}\n                    >\n                        <div className=\"flex items-start justify-between gap-4 p-6 border-b border-slate-800\">\n                            <div>\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Gu√≠a r√°pida</p>\n                                <h2 className=\"text-2xl font-black text-white mt-1\">C√≥mo usar: {guide.title}</h2>\n                                <p className=\"text-slate-400 text-sm mt-2\">{guide.description}</p>\n                            </div>\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"p-2 rounded-xl bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white border border-slate-800 transition\"\n                                type=\"button\"\n                                aria-label=\"Cerrar\"\n                            >\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 max-h-[70vh] overflow-y-auto custom-scrollbar space-y-6\">\n                            {(guide.sections || []).map((section, idx) => (\n                                <div key={idx} className=\"bg-slate-900/20 border border-slate-800 rounded-2xl p-5\">\n                                    <h3 className=\"text-white font-black\">{section.title}</h3>\n                                    <ul className=\"list-disc pl-5 mt-3 space-y-2 text-sm text-slate-300\">\n                                        {(section.bullets || []).map((b, i) => (\n                                            <li key={i}>{b}</li>\n                                        ))}\n                                    </ul>\n                                </div>\n                            ))}\n                        </div>\n\n                        <div className=\"p-6 border-t border-slate-800 flex justify-end\">\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"px-5 py-3 rounded-xl bg-orange-600 hover:bg-orange-500 text-white font-black transition\"\n                                type=\"button\"\n                            >\n                                Entendido\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </>\n    );\n}\n\n// --- APLICACI√ìN PRINCIPAL ---\nfunction App() {\n    // --- GESTI√ìN DE ESTADO (EXPANDIDA) ---\n\n    // Navegaci√≥n y UI\n    const [view, setView] = useState('store'); // store, cart, checkout, profile, login, register, admin, about, guide\n    const [adminTab, setAdminTab] = useState('dashboard');\n    const [expenses, setExpenses] = useState([]);\n    const [investments, setInvestments] = useState([]);\n    const [purchases, setPurchases] = useState([]);\n    const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: null }); // dashboard, products, coupons, users, suppliers, settings, finance\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [isAdminMenuOpen, setIsAdminMenuOpen] = useState(false);\n    const [darkMode, setDarkMode] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_dark_mode');\n            return saved !== null ? JSON.parse(saved) : false; // Default to light mode (blanco)\n        } catch (e) { return false; }\n    });\n    const [appId, setAppId] = useState(null);\n    const [storeResolution, setStoreResolution] = useState({ status: 'resolving', hostname: '', normalizedHostname: '', storeId: null, error: null });\n    const [storeSetupStoreIdInput, setStoreSetupStoreIdInput] = useState('');\n    const [isStoreSetupSaving, setIsStoreSetupSaving] = useState(false);\n    const [isExportingBackup, setIsExportingBackup] = useState(false);\n    const [isImportingBackup, setIsImportingBackup] = useState(false);\n\n    // Usuarios y Autenticaci√≥n\n    const [currentUser, setCurrentUser] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_user_data');\n            if (!saved) return null;\n\n            const userData = JSON.parse(saved);\n\n            // Validar que el usuario tenga los campos m√≠nimos requeridos\n            // Si no tiene id, email o name, es un usuario inv√°lido o corrupto\n            if (!userData || !userData.id || !userData.email || !userData.name) {\n                // Limpiar datos corruptos o incompletos\n                localStorage.removeItem('sustore_user_data');\n                return null;\n            }\n\n            return userData;\n        } catch (e) {\n            // Si hay error al parsear, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n            return null;\n        }\n    });\n    const [systemUser, setSystemUser] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isProcessingOrder, setIsProcessingOrder] = useState(false);\n    const [toasts, setToasts] = useState([]);\n\n    const [adminOrderAlarmMuted, setAdminOrderAlarmMuted] = useState(() => {\n        try {\n            return localStorage.getItem('sustore_admin_order_alarm_muted') === '1';\n        } catch (e) { return false; }\n    });\n\n    const orderAlarmContextRef = useRef(null);\n    const orderAlarmIntervalRef = useRef(null);\n    const orderAlarmActiveRef = useRef(false);\n    const orderAlarmToastShownRef = useRef(false);\n    const orderAlarmUnlockListenerActiveRef = useRef(false);\n    const lastOrdersSeenWriteRef = useRef(null);\n\n\n    // Datos Principales\n    const [products, setProducts] = useState([]);\n    const [promos, setPromos] = useState([]); // Nuevo estado para Promos\n    const [homeBanners, setHomeBanners] = useState([]);\n    const [cart, setCart] = useState(() => {\n        try {\n            const saved = JSON.parse(localStorage.getItem('sustore_cart'));\n            return Array.isArray(saved) ? saved : [];\n        } catch (e) { return []; }\n    });\n    const cartHydratedFromRemoteRef = useRef(false);\n    const [liveCarts, setLiveCarts] = useState([]); // Monitor de carritos en tiempo real\n    const [orders, setOrders] = useState([]);\n    const [users, setUsers] = useState([]);\n    const [coupons, setCoupons] = useState([]);\n    const [suppliers, setSuppliers] = useState([]);\n\n    const [settings, setSettings] = useState(defaultSettings);\n    const [settingsLoaded, setSettingsLoaded] = useState(false); // Indica si los settings ya se cargaron de Firebase\n\n    // Estados de Interfaz de Usuario\n    const [searchQuery, setSearchQuery] = useState('');\n    const [selectedCategory, setSelectedCategory] = useState('');\n\n    // --- DRAG TO SCROLL (Categor√≠as) ---\n    const categoriesScrollRef = useRef(null);\n    const [isDraggingCategories, setIsDraggingCategories] = useState(false);\n    const [startXCategories, setStartXCategories] = useState(0);\n    const [scrollLeftCategories, setScrollLeftCategories] = useState(0);\n\n    const handleMouseDownCategories = (e) => {\n        setIsDraggingCategories(true);\n        setStartXCategories(e.pageX - categoriesScrollRef.current.offsetLeft);\n        setScrollLeftCategories(categoriesScrollRef.current.scrollLeft);\n    };\n\n    const handleMouseLeaveCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseUpCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseMoveCategories = (e) => {\n        if (!isDraggingCategories) return;\n        e.preventDefault();\n        const x = e.pageX - categoriesScrollRef.current.offsetLeft;\n        const walk = (x - startXCategories) * 2; // Velocidad de desplazamiento\n        categoriesScrollRef.current.scrollLeft = scrollLeftCategories - walk;\n    };\n\n\n    // Formularios de Autenticaci√≥n\n    const [authData, setAuthData] = useState({\n        email: '',\n        password: '',\n        name: '',\n        username: '',\n        dni: '',\n        phone: ''\n    });\n    const [loginMode, setLoginMode] = useState(true);\n\n    // Estados para Nuevos Formularios (Finanzas y Compras)\n    const [newExpense, setNewExpense] = useState({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n    const [newInvestment, setNewInvestment] = useState({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n    const [newPurchase, setNewPurchase] = useState({ productId: '', supplierId: '', quantity: 1, cost: 0, isNewProduct: false });\n    const [newHomeBanner, setNewHomeBanner] = useState({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    const [editingHomeBannerId, setEditingHomeBannerId] = useState(null);\n\n    // Estado para Proveedores (Restaurado)\n    const [newSupplier, setNewSupplier] = useState({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n    const [editingSupplierId, setEditingSupplierId] = useState(null);\n    const [showSupplierModal, setShowSupplierModal] = useState(false);\n\n    // Estado para Carrito de Compras (Pedidos Mayoristas)\n    const [purchaseCart, setPurchaseCart] = useState([]);\n\n    // Estado para Modal de Crear Categor√≠a\n    const [showCategoryModal, setShowCategoryModal] = useState(false);\n\n    // Estado para Detalle de Producto / Promo (Zoom)\n    const [selectedProduct, setSelectedProduct] = useState(null);\n\n    // --- HELPERS ---\n\n    const openConfirm = (title, message, onConfirm) => {\n        setConfirmModal({\n            isOpen: true,\n            title,\n            message,\n            onConfirm: async () => {\n                await onConfirm();\n                setConfirmModal(prev => ({ ...prev, isOpen: false }));\n            },\n            onCancel: () => setConfirmModal(prev => ({ ...prev, isOpen: false }))\n        });\n    };\n\n    const downloadJsonFile = (filename, obj) => {\n        const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        setTimeout(() => URL.revokeObjectURL(url), 1000);\n    };\n\n    const exportBackup = async () => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n        setIsExportingBackup(true);\n        try {\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/export-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({}),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo exportar');\n            const safeDate = new Date().toISOString().replace(/[:.]/g, '-');\n            downloadJsonFile(`backup-${appId}-${safeDate}.json`, data);\n            showToast('Backup exportado.', 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo exportar', 'error');\n        } finally {\n            setIsExportingBackup(false);\n        }\n    };\n\n    const importBackupFile = async (file) => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n        setIsImportingBackup(true);\n        try {\n            const text = await file.text();\n            const parsed = JSON.parse(text);\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/import-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({ backup: parsed }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo importar');\n            showToast(`Backup importado (${data.written || 0} docs).`, 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo importar', 'error');\n        } finally {\n            setIsImportingBackup(false);\n        }\n    };\n\n    // --- FUNCI√ìN PARA MANEJAR CAMBIO DE PLAN (DOWNGRADE) ---\n    const getPlanLimit = (plan) => {\n        switch (plan) {\n            case 'premium': return Infinity;\n            case 'business': return 50;\n            case 'entrepreneur':\n            default: return 30;\n        }\n    };\n\n    const getPlanAllowsCoupons = (plan) => {\n        return plan === 'business' || plan === 'premium';\n    };\n\n    const handlePlanChange = async (newPlan) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const currentLimit = getPlanLimit(currentPlan);\n        const newLimit = getPlanLimit(newPlan);\n\n        // Si es upgrade (m√°s productos permitidos), simplemente cambiar\n        if (newLimit >= currentLimit) {\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`¬°Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}!`, 'success');\n            return;\n        }\n\n        // Es un DOWNGRADE - verificar l√≠mites\n        const activeProducts = products.filter(p => p.isActive !== false);\n        const productsToDeactivate = [];\n        const couponsToDeactivate = [];\n\n        // Si hay m√°s productos activos que el nuevo l√≠mite\n        if (activeProducts.length > newLimit) {\n            // Ordenar por ventas (m√°s vendidos quedan activos) o por fecha de creaci√≥n\n            const sortedProducts = [...activeProducts].sort((a, b) => {\n                // Priorizar productos m√°s vendidos\n                const salesA = orders.filter(o => o.items?.some(i => i.productId === a.id)).length;\n                const salesB = orders.filter(o => o.items?.some(i => i.productId === b.id)).length;\n                return salesB - salesA; // M√°s vendidos primero\n            });\n\n            // Los productos despu√©s del l√≠mite se desactivan\n            for (let i = newLimit; i < sortedProducts.length; i++) {\n                productsToDeactivate.push(sortedProducts[i]);\n            }\n        }\n\n        // Si el nuevo plan no permite cupones, desactivar todos los cupones activos\n        if (!getPlanAllowsCoupons(newPlan)) {\n            const activeCoupons = coupons.filter(c => c.isActive !== false);\n            couponsToDeactivate.push(...activeCoupons);\n        }\n\n        // Si hay productos/cupones a desactivar, mostrar confirmaci√≥n\n        if (productsToDeactivate.length > 0 || couponsToDeactivate.length > 0) {\n            const message = `\n                ${productsToDeactivate.length > 0 ? `‚Ä¢ ${productsToDeactivate.length} producto(s) ser√°n desactivados (se conservan los ${newLimit} m√°s vendidos)\\n` : ''}\n                ${couponsToDeactivate.length > 0 ? `‚Ä¢ ${couponsToDeactivate.length} cup√≥n(es) ser√°n desactivados (el plan ${newPlan === 'entrepreneur' ? 'Emprendedor' : ''} no incluye cupones)\\n` : ''}\n                \n                Los productos y cupones NO se eliminar√°n, solo se desactivar√°n. Podr√°s reactivarlos manualmente si mejoras tu plan.\n            `;\n\n            openConfirm(\n                '‚ö†Ô∏è Cambio de Plan - Atenci√≥n',\n                message,\n                async () => {\n                    try {\n                        // Desactivar productos excedentes\n                        for (const product of productsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Desactivar cupones si el plan no los soporta\n                        for (const coupon of couponsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', coupon.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Actualizar el plan\n                        setSettings({ ...settings, subscriptionPlan: newPlan });\n\n                        // Guardar info del downgrade para mostrar advertencias\n                        setPlanDowngradeInfo({\n                            showWarning: true,\n                            deactivatedProducts: productsToDeactivate.map(p => p.id),\n                            deactivatedCoupons: couponsToDeactivate.map(c => c.id),\n                            previousPlan: currentPlan,\n                            newPlan: newPlan\n                        });\n\n                        showToast(`Plan cambiado. ${productsToDeactivate.length} producto(s) y ${couponsToDeactivate.length} cup√≥n(es) fueron desactivados.`, 'warning');\n                    } catch (error) {\n                        console.error('Error al cambiar de plan:', error);\n                        showToast('Error al cambiar de plan', 'error');\n                    }\n                }\n            );\n        } else {\n            // No hay nada que desactivar, simplemente cambiar el plan\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}`, 'success');\n        }\n    };\n\n    // Funci√≥n para reactivar un producto manualmente (si mejora el plan)\n    const reactivateProduct = async (productId) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const limit = getPlanLimit(currentPlan);\n        const activeCount = products.filter(p => p.isActive !== false).length;\n\n        if (activeCount >= limit) {\n            showToast(`Has alcanzado el l√≠mite de ${limit} productos de tu plan. Mejora tu plan o desactiva otro producto primero.`, 'warning');\n            return;\n        }\n\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: true,\n                deactivatedByPlan: false,\n                reactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto reactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al reactivar producto:', error);\n            showToast('Error al reactivar producto', 'error');\n        }\n    };\n\n    // Funci√≥n para desactivar un producto manualmente\n    const deactivateProduct = async (productId) => {\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: false,\n                deactivatedManually: true,\n                deactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto desactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al desactivar producto:', error);\n            showToast('Error al desactivar producto', 'error');\n        }\n    };\n\n\n    // Formulario de Checkout\n    const [checkoutData, setCheckoutData] = useState({\n        address: '',\n        city: '',\n        province: '',\n        zipCode: '',\n        paymentChoice: '',\n        shippingMethod: 'Pickup' // Pickup or Delivery\n    });\n    const [appliedCoupon, setAppliedCoupon] = useState(null);\n    const [showCouponModal, setShowCouponModal] = useState(false);\n\n    // Auto-correcci√≥n de m√©todo de pago al cambiar env√≠o\n    useEffect(() => {\n        if (checkoutData.shippingMethod === 'Delivery' && checkoutData.paymentChoice === 'Efectivo') {\n            showToast('Pago en efectivo solo disponible con Retiro en Local.', 'info');\n            // Cambiar a otro m√©todo v√°lido autom√°ticamente\n            const hasTransfer = settings?.paymentTransfer?.enabled;\n            const hasCard = settings?.paymentMercadoPago?.enabled;\n            setCheckoutData(prev => ({\n                ...prev,\n                paymentChoice: hasTransfer ? 'Transferencia' : (hasCard ? 'Tarjeta' : '')\n            }));\n        }\n    }, [checkoutData.shippingMethod, settings]);\n\n    // --- ESTADOS DE ADMINISTRACI√ìN (DETALLADOS) ---\n\n    // Gesti√≥n de Productos\n    const [newProduct, setNewProduct] = useState({\n        name: '',\n        basePrice: '',\n        stock: '',\n        categories: [], // Cambio: Ahora es un array para m√∫ltiples categor√≠as\n        image: '',\n        description: '',\n        discount: 0,\n        purchasePrice: ''\n    });\n    const [editingId, setEditingId] = useState(null);\n    const [showProductForm, setShowProductForm] = useState(false);\n    const [settingsTab, setSettingsTab] = useState('store'); // store, appearance, social, payments, shipping, seo, advanced, team\n\n    // Gesti√≥n de Promos\n    const [newPromo, setNewPromo] = useState({\n        name: '',\n        price: '',\n        image: '',\n        description: '',\n        items: [] // Array de { productId, quantity }\n    });\n    const [promoSearch, setPromoSearch] = useState('');\n    const [selectedPromoProduct, setSelectedPromoProduct] = useState('');\n    const [promoProductQty, setPromoProductQty] = useState(1);\n    const [isEditingPromo, setIsEditingPromo] = useState(false);\n    const [editingPromoId, setEditingPromoId] = useState(null);\n\n    // Gesti√≥n Avanzada de Cupones (Restaurada la complejidad)\n    const [newCoupon, setNewCoupon] = useState({\n        code: '',\n        type: 'percentage', // percentage, fixed\n        value: 0,\n        minPurchase: 0,\n        maxDiscount: 0,\n        expirationDate: '',\n        targetType: 'global', // global, specific_user, specific_email\n        targetUser: '', // username o email espec√≠fico\n        usageLimit: '', // Limite total de usos\n        perUserLimit: 1, // Limite por usuario\n        isActive: true\n    });\n\n\n\n\n    // Estado para EDICI√ìN DE COMPRAS\n    const [editingPurchase, setEditingPurchase] = useState(null);\n\n    // Configuraci√≥n y Equipo\n    const [aboutText, setAboutText] = useState('');\n\n    const [newCategory, setNewCategory] = useState('');\n    const [newTeamMember, setNewTeamMember] = useState({ email: '', role: 'employee', name: '' });\n\n    // Estado para Detalle de Pedido (Modal)\n    const [selectedOrder, setSelectedOrder] = useState(null);\n\n    // Estados para Dashboard Avanzado (Venta Manual, Anal√≠ticas, Producto Menos Vendido)\n    const [showManualSaleModal, setShowManualSaleModal] = useState(false);\n    const [metricsDetail, setMetricsDetail] = useState(null); // { type: 'revenue' | 'net_income' }\n    const [showLeastSold, setShowLeastSold] = useState(false);\n\n    // Hoisted State for Manual Sale (So we can pre-fill it from Product List)\n    const [saleData, setSaleData] = useState({\n        productId: '',\n        quantity: 1,\n        price: 0,\n        customerName: 'Cliente Offline',\n        paymentMethod: 'Efectivo',\n        notes: 'Venta presencial'\n    });\n\n    // --- NUEVOS ESTADOS PARA GESTI√ìN DE USUARIOS (CARRITO, PASS Y EDICI√ìN) ---\n    const [viewUserCart, setViewUserCart] = useState(null); // Usuario seleccionado para ver carrito\n    const [userPassModal, setUserPassModal] = useState(null); // Usuario a cambiar contrase√±a\n    const [viewUserEdit, setViewUserEdit] = useState(null); // Usuario a editar perfil\n    const [newAdminPassword, setNewAdminPassword] = useState('');\n    const [userSearch, setUserSearch] = useState('');\n    const [userRoleFilter, setUserRoleFilter] = useState('all');\n\n    // Estado para Modal de Planes (cuando hacen clic en el overlay de restricci√≥n)\n    const [showPlansModal, setShowPlansModal] = useState(false);\n    const [selectedPlanOption, setSelectedPlanOption] = useState(null); // { plan: 'Emprendedor', cycle: 'Mensual', price: '$7.000' }\n\n    // Estado para Plan Downgrade - Productos/Cupones desactivados por l√≠mite\n    const [planDowngradeInfo, setPlanDowngradeInfo] = useState({\n        showWarning: false,\n        deactivatedProducts: [], // IDs de productos desactivados por l√≠mite\n        deactivatedCoupons: [], // IDs de cupones desactivados por l√≠mite\n        previousPlan: null,\n        newPlan: null\n    });\n\n    // --- ESTADOS PARA MERCADO PAGO CARD PAYMENT BRICK ---\n    const [mpBrickController, setMpBrickController] = useState(null);\n    const [isPaymentProcessing, setIsPaymentProcessing] = useState(false);\n    const [paymentError, setPaymentError] = useState(null);\n    const isInitializingBrick = useRef(false);\n    const cardPaymentBrickRef = useRef(null);\n\n\n    const openManualSaleModal = (product) => {\n        setSaleData({\n            productId: product.id,\n            quantity: 1,\n            price: Number(product.basePrice) || 0,\n            customerName: 'Cliente Offline',\n            paymentMethod: 'Efectivo',\n            notes: 'Venta presencial'\n        });\n        setShowManualSaleModal(true);\n    };\n\n    const confirmManualSale = async () => {\n        if (!saleData.productId) return;\n        if (saleData.quantity <= 0) {\n            showToast(\"La cantidad debe ser mayor a 0\", \"error\");\n            return;\n        }\n\n        setIsProcessingOrder(true);\n        try {\n            // 1. Verificar Stock Actualizado\n            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', saleData.productId);\n            const productSnap = await getDoc(productRef);\n\n            if (!productSnap.exists()) throw new Error(\"Producto no encontrado\");\n\n            const currentStock = Number(productSnap.data().stock) || 0;\n            if (currentStock < saleData.quantity) {\n                showToast(`Stock insuficiente. Solo quedan ${currentStock} unidades.`, \"error\");\n                setIsProcessingOrder(false);\n                return;\n            }\n\n            // 2. Crear Orden\n            const total = saleData.quantity * saleData.price;\n            const newOrder = {\n                orderId: Date.now().toString().slice(-6),\n                date: new Date().toISOString(),\n                status: 'Realizado',\n                source: 'manual_sale', // Identificador clave\n                userId: 'manual_admin',\n                customer: {\n                    name: saleData.customerName || 'Cliente Mostrador',\n                    email: '-',\n                    phone: '-',\n                    dni: '-'\n                },\n                items: [{\n                    id: saleData.productId,\n                    title: products.find(p => p.id === saleData.productId)?.name || 'Producto',\n                    quantity: saleData.quantity,\n                    unit_price: saleData.price,\n                    image: products.find(p => p.id === saleData.productId)?.image || ''\n                }],\n                total: total,\n                paymentMethod: saleData.paymentMethod,\n                notes: saleData.notes\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n            // 3. Descontar Stock\n            await updateDoc(productRef, {\n                stock: increment(-saleData.quantity)\n            });\n\n            showToast(\"Venta registrada exitosamente\", \"success\");\n            setShowManualSaleModal(false);\n\n        } catch (error) {\n            console.error(\"Error en venta manual:\", error);\n            showToast(\"Error al registrar venta: \" + error.message, \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // Referencias\n    const fileInputRef = useRef(null);\n\n    // --- FUNCIONES UTILITARIAS ---\n\n    // Mostrar notificaciones\n    const showToast = (msg, type = 'info') => {\n        const id = Date.now();\n        setToasts(prev => {\n            // Limitar a 3 toasts simult√°neos\n            const filtered = prev.filter(t => Date.now() - t.id < 3000);\n            return [...filtered, { id, message: msg, type }];\n        });\n    };\n\n    const removeToast = (id) => setToasts(p => p.filter(t => t.id !== id));\n\n    const handleHomeBannerClick = (slide) => {\n        const targetType = slide?.targetType || (slide?.promoId ? 'promo' : slide?.productId ? 'product' : 'none');\n        const targetId = slide?.targetId || slide?.promoId || slide?.productId || '';\n        if (!targetId || targetType === 'none') return;\n\n        if (targetType === 'product') {\n            const product = products.find(p => String(p.id).trim() === String(targetId).trim());\n            if (product) {\n                setSelectedProduct(product);\n                return;\n            }\n            showToast(\"Este banner apunta a un producto que ya no existe.\", \"warning\");\n            document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n            return;\n        }\n\n        if (targetType === 'promo') {\n            const promo = promos.find(p => String(p.id).trim() === String(targetId).trim());\n            if (!promo) {\n                showToast(\"Este banner apunta a una promo que ya no existe.\", \"warning\");\n                document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n                return;\n            }\n\n            let maxPurchasable = Infinity;\n            (promo.items || []).forEach(item => {\n                const p = products.find(prod => prod.id === item.productId);\n                const pStock = p ? (Number(p.stock) || 0) : 0;\n                const maxForThisItem = Math.floor(pStock / (Number(item.quantity) || 1));\n                if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n            });\n            if (!Number.isFinite(maxPurchasable)) maxPurchasable = 0;\n\n            setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable });\n        }\n    };\n\n    // Validar acceso por rol\n    const getRole = (email) => {\n        if (!email) return 'user';\n        const cleanEmail = email.trim().toLowerCase();\n\n        // Super Admin Hardcodeado (Prioridad M√°xima) - No depende de settings\n        if (cleanEmail === SUPER_ADMIN_EMAIL.toLowerCase()) return 'admin';\n\n        // 1. Verificar currentUser.role (Prioridad sobre equipo est√°tico)\n        // Esto permite promover usuarios desde el panel sin depender de settings.team\n        // Esta verificaci√≥n no depende de settings, solo de currentUser\n        if (currentUser && currentUser.email && currentUser.email.trim().toLowerCase() === cleanEmail && currentUser.role && currentUser.role !== 'user') {\n            return currentUser.role;\n        }\n\n        // Si settings a√∫n no est√° cargado, no podemos verificar team ni users\n        // Devolvemos 'loading' para indicar que no sabemos a√∫n el rol real\n        if (!settings || !settingsLoaded) return 'loading';\n\n        // 2. Buscar en el equipo (settings.team - Fallback/Hardcoded)\n        const team = settings?.team || [];\n        const member = team.find(m => m.email && m.email.trim().toLowerCase() === cleanEmail);\n        if (member) return member.role;\n\n        // 3. Buscar en la lista de usuarios (solo admins)\n        if (users && users.length > 0) {\n            const userDoc = users.find(u => u.email && u.email.trim().toLowerCase() === cleanEmail);\n            if (userDoc && userDoc.role) return userDoc.role;\n        }\n\n        return 'user';\n    };\n\n    const isAdmin = (email) => getRole(email) === 'admin';\n    const isEditor = (email) => getRole(email) === 'editor';\n    const isRoleLoading = (email) => getRole(email) === 'loading';\n    const hasAccess = (email) => {\n        const role = getRole(email);\n        // Si el rol a√∫n est√° cargando, no tiene acceso (se mostrar√° loading)\n        if (role === 'loading') return false;\n        return role === 'admin' || role === 'editor' || role === 'employee';\n    };\n\n    const isAdminUser = isAdmin(systemUser?.email || currentUser?.email);\n    const isSuperAdminSession = !!(systemUser?.email && SUPER_ADMIN_EMAIL && systemUser.email.trim().toLowerCase() === SUPER_ADMIN_EMAIL.trim().toLowerCase());\n    const latestOrderIso = useMemo(() => {\n        if (!isAdminUser) return null;\n        const v = orders?.[0]?.date;\n        return typeof v === 'string' ? v : null;\n    }, [isAdminUser, orders]);\n    const ordersLastSeenIso = typeof settings?.ordersLastSeenIso === 'string' ? settings.ordersLastSeenIso : null;\n    const hasUnseenOrders = !!(latestOrderIso && (!ordersLastSeenIso || latestOrderIso > ordersLastSeenIso));\n\n    const toggleAdminOrderAlarmMuted = useCallback(() => {\n        setAdminOrderAlarmMuted(prev => {\n            const next = !prev;\n            try {\n                localStorage.setItem('sustore_admin_order_alarm_muted', next ? '1' : '0');\n            } catch (e) { }\n            return next;\n        });\n    }, []);\n\n    const stopOrderAlarm = useCallback(async () => {\n        orderAlarmActiveRef.current = false;\n        if (orderAlarmIntervalRef.current) {\n            clearInterval(orderAlarmIntervalRef.current);\n            orderAlarmIntervalRef.current = null;\n        }\n        const ctx = orderAlarmContextRef.current;\n        orderAlarmContextRef.current = null;\n        if (ctx) {\n            try {\n                await ctx.close();\n            } catch (e) { }\n        }\n    }, []);\n\n    const markOrdersSeen = useCallback(async (iso) => {\n        if (!isAdminUser) return;\n        if (!appId) return;\n        const value = typeof iso === 'string' && iso ? iso : new Date().toISOString();\n        if (lastOrdersSeenWriteRef.current === value) return;\n        lastOrdersSeenWriteRef.current = value;\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), { ordersLastSeenIso: value });\n        } catch (e) { }\n    }, [isAdminUser, appId]);\n\n    const startOrderAlarm = useCallback(async () => {\n        if (!isAdminUser) return;\n        if (adminOrderAlarmMuted) return;\n        if (orderAlarmActiveRef.current) return;\n\n        const AudioContextCtor = window.AudioContext || window.webkitAudioContext;\n        if (!AudioContextCtor) return;\n\n        const ctx = orderAlarmContextRef.current || new AudioContextCtor();\n        orderAlarmContextRef.current = ctx;\n\n        const scheduleBeep = (at) => {\n            const osc = ctx.createOscillator();\n            const gain = ctx.createGain();\n            osc.type = 'triangle';\n            osc.frequency.value = 880;\n            gain.gain.setValueAtTime(0.0001, at);\n            gain.gain.exponentialRampToValueAtTime(0.12, at + 0.01);\n            gain.gain.exponentialRampToValueAtTime(0.0001, at + 0.09);\n            osc.connect(gain);\n            gain.connect(ctx.destination);\n            osc.start(at);\n            osc.stop(at + 0.1);\n        };\n\n        const tick = () => {\n            const now = ctx.currentTime;\n            scheduleBeep(now);\n            scheduleBeep(now + 0.18);\n        };\n\n        try {\n            if (ctx.state === 'suspended') {\n                await ctx.resume();\n            }\n        } catch (e) { }\n\n        if (ctx.state !== 'running') {\n            if (!orderAlarmToastShownRef.current) {\n                showToast('Pedido nuevo: toc√°/clic para habilitar sonido', 'warning');\n                orderAlarmToastShownRef.current = true;\n            }\n            if (!orderAlarmUnlockListenerActiveRef.current) {\n                orderAlarmUnlockListenerActiveRef.current = true;\n                window.addEventListener('pointerdown', async () => {\n                    orderAlarmUnlockListenerActiveRef.current = false;\n                    try {\n                        if (orderAlarmContextRef.current?.state === 'suspended') {\n                            await orderAlarmContextRef.current.resume();\n                        }\n                    } catch (e) { }\n                    if (hasUnseenOrders && !(view === 'admin' && adminTab === 'orders') && !adminOrderAlarmMuted) {\n                        startOrderAlarm();\n                    }\n                }, { once: true, capture: true });\n            }\n            return;\n        }\n\n        orderAlarmActiveRef.current = true;\n        tick();\n        orderAlarmIntervalRef.current = setInterval(tick, 2000);\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab]);\n\n    useEffect(() => {\n        const rawHostname = (typeof window !== 'undefined' && window.location && window.location.hostname)\n            ? String(window.location.hostname).trim().toLowerCase()\n            : '';\n        const normalizedHostname = rawHostname.startsWith('www.') ? rawHostname.slice(4) : rawHostname;\n\n        if (!normalizedHostname) {\n            setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: 'hostname-empty' });\n            setAppId(null);\n            return;\n        }\n\n        if (normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1') {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        if (normalizedHostname.endsWith('.vercel.app')) {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        setStoreResolution({ status: 'resolving', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n\n        let cancelled = false;\n        const resolve = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'storesIndex', normalizedHostname));\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const data = snap.data() || {};\n                    const storeId = typeof data.storeId === 'string' ? data.storeId.trim() : '';\n                    if (storeId) {\n                        setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId, error: null });\n                        setAppId(storeId);\n                        return;\n                    }\n                }\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n                setAppId(null);\n            } catch (e) {\n                if (cancelled) return;\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: e?.message || 'resolve-error' });\n                setAppId(null);\n            }\n        };\n        resolve();\n        return () => { cancelled = true; };\n    }, []);\n\n    const createStoreId = useCallback(() => {\n        const clean = (value) => String(value || '').trim().toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');\n        const base = clean(storeResolution.normalizedHostname || storeResolution.hostname || 'store');\n        const rand = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'\n            ? crypto.randomUUID().split('-')[0]\n            : Math.random().toString(36).slice(2, 8);\n        return `${base}-${rand}`.slice(0, 80);\n    }, [storeResolution.hostname, storeResolution.normalizedHostname]);\n\n    const bootstrapStoreData = useCallback(async (storeId) => {\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'data', 'settings', 'config'), { ...defaultSettings, createdAt: nowIso, updatedAt: nowIso }, { merge: true });\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'config'), { version: APP_VERSION, updatedAt: nowIso }, { merge: true });\n    }, []);\n\n    const registerHostname = useCallback(async (storeId) => {\n        const hostname = storeResolution.normalizedHostname;\n        if (!hostname) throw new Error('Dominio inv√°lido');\n        const normalizedStoreId = String(storeId || '').trim();\n        if (!normalizedStoreId) throw new Error('StoreId inv√°lido');\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'storesIndex', hostname), { storeId: normalizedStoreId, hostname, updatedAt: nowIso, updatedBy: systemUser?.email || null, createdAt: nowIso }, { merge: true });\n        await bootstrapStoreData(normalizedStoreId);\n        setAppId(normalizedStoreId);\n        setStoreResolution((prev) => ({ ...prev, status: 'resolved', storeId: normalizedStoreId, error: null }));\n    }, [bootstrapStoreData, storeResolution.normalizedHostname, systemUser?.email]);\n\n    // --- EFECTOS DE SINCRONIZACI√ìN (FIREBASE) ---\n\n    // 0. Sincronizar Dark Mode con el DOM y localStorage\n    useEffect(() => {\n        // Aplicar/remover clase dark-mode en el body\n        if (darkMode) {\n            document.documentElement.classList.add('dark-mode');\n            document.body.classList.add('dark-mode');\n        } else {\n            document.documentElement.classList.remove('dark-mode');\n            document.body.classList.remove('dark-mode');\n        }\n        // Guardar preferencia en localStorage\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n    }, [darkMode]);\n\n    // 1. Sincronizar Carrito Local y Remoto (Live Cart)\n    useEffect(() => {\n        localStorage.setItem('sustore_cart', JSON.stringify(cart));\n\n        // Si hay usuario, subir carrito a DB para monitor de admin\n        if (appId && currentUser && currentUser.id) {\n            const syncCartToDB = async () => {\n                try {\n                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n                        userId: currentUser.id,\n                        userName: currentUser.name || 'Usuario', // Guardamos nombre (con fallback) para evitar errores\n                        items: cart.map(item => ({\n                            productId: item.product.id,\n                            quantity: item.quantity,\n                            name: item.product.name,\n                            price: item.product.basePrice\n                        })),\n                        lastUpdated: new Date().toISOString()\n                    }, { merge: true });\n                } catch (e) {\n                    console.error(\"Error syncing cart\", e);\n                }\n            };\n            // Debounce para no saturar escrituras (optimizado a 800ms)\n            const debounceTimer = setTimeout(syncCartToDB, 800);\n            return () => clearTimeout(debounceTimer);\n        }\n    }, [cart, currentUser, appId]);\n\n    useEffect(() => {\n        if (!currentUser?.id) return;\n        if (!appId) return;\n        if (cartHydratedFromRemoteRef.current) return;\n\n        let cancelled = false;\n        const hydrateCartFromRemote = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id));\n                if (!snap.exists()) return;\n                const data = snap.data() || {};\n                const remoteItems = Array.isArray(data.items) ? data.items : [];\n                if (remoteItems.length === 0) return;\n\n                const normalizedRemote = remoteItems\n                    .filter(i => i && i.productId && Number(i.quantity) > 0)\n                    .map(i => ({\n                        product: {\n                            id: i.productId,\n                            name: typeof i.name === 'string' ? i.name : '',\n                            basePrice: Number(i.price) || 0,\n                            image: '',\n                            category: ''\n                        },\n                        quantity: Number(i.quantity) || 1\n                    }));\n\n                if (normalizedRemote.length === 0) return;\n\n                const localSignature = (cart || []).map(i => `${i?.product?.id || ''}:${Number(i?.quantity) || 0}`).sort().join('|');\n                const remoteSignature = normalizedRemote.map(i => `${i.product.id}:${i.quantity}`).sort().join('|');\n                if (localSignature && localSignature === remoteSignature) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n\n                if (!cancelled) {\n                    setCart(normalizedRemote);\n                    cartHydratedFromRemoteRef.current = true;\n                }\n            } catch (e) { }\n        };\n\n        hydrateCartFromRemote();\n        return () => { cancelled = true; };\n    }, [appId, currentUser?.id, cart]);\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n\n        if (typeof settings?.ordersLastSeenIso !== 'string' && settingsLoaded && orders.length > 0 && latestOrderIso) {\n            markOrdersSeen(latestOrderIso);\n        }\n    }, [isAdminUser, settingsLoaded, settings?.ordersLastSeenIso, orders.length, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n        if (adminOrderAlarmMuted) {\n            stopOrderAlarm();\n            return;\n        }\n\n        const inOrdersTab = view === 'admin' && adminTab === 'orders';\n        if (hasUnseenOrders && !inOrdersTab) {\n            startOrderAlarm();\n        } else {\n            stopOrderAlarm();\n        }\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab, startOrderAlarm, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) return;\n        if (view !== 'admin' || adminTab !== 'orders') return;\n        if (!latestOrderIso) return;\n        markOrdersSeen(latestOrderIso);\n        stopOrderAlarm();\n    }, [isAdminUser, view, adminTab, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    // 1.1 Sincronizar precios y datos del carrito con productos actualizados\n    useEffect(() => {\n        if (products.length > 0 && cart.length > 0) {\n            setCart(prevCart => {\n                let hasChanges = false;\n                const newCart = prevCart.map(item => {\n                    // Buscar el producto actual en la lista maestra\n                    const currentProduct = products.find(p => p.id === item.product.id);\n\n                    if (currentProduct) {\n                        // Si el precio, nombre o imagen cambiaron, actualizamos el item del carrito\n                        if (currentProduct.basePrice !== (item.product?.basePrice ?? 0) ||\n                            currentProduct.name !== (item.product?.name ?? '') ||\n                            currentProduct.image !== (item.product?.image ?? '')) {\n                            hasChanges = true;\n                            return {\n                                ...item,\n                                product: {\n                                    ...currentProduct,\n                                    // Aseguramos que mantenemos la consistencia de tipos\n                                    basePrice: Number(currentProduct.basePrice) || 0\n                                }\n                            };\n                        }\n                    }\n                    return item;\n                });\n                return hasChanges ? newCart : prevCart;\n            });\n        }\n    }, [products]);\n\n\n\n    // 3. Sistema de Auto-Update\n    useEffect(() => {\n        if (!appId) return;\n        const configRef = doc(db, 'artifacts', appId, 'public', 'config');\n        const unsubscribe = onSnapshot(configRef, (snap) => {\n            if (snap.exists()) {\n                const data = snap.data();\n                if (data.version && data.version !== APP_VERSION) {\n                    console.log(`Nueva versi√≥n detectada: ${data.version}. Actualizando...`);\n                    window.location.reload();\n                }\n            }\n        });\n        return () => unsubscribe();\n    }, [appId]);\n    // 2. Persistencia Detallada y Session\n    useEffect(() => {\n        // Solo guardar usuarios con datos v√°lidos completos\n        if (currentUser && currentUser.id && currentUser.email && currentUser.name) {\n            localStorage.setItem('sustore_user_data', JSON.stringify(currentUser));\n            // Pre-llenar checkout si hay datos\n            setCheckoutData(prev => ({\n                ...prev,\n                address: currentUser.address || prev.address,\n                city: currentUser.city || prev.city,\n                province: currentUser.province || prev.province,\n                zipCode: currentUser.zipCode || prev.zipCode\n            }));\n        } else if (!currentUser) {\n            // Si no hay usuario, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n        }\n        // Si currentUser existe pero no tiene datos v√°lidos, no guardamos nada\n        // Esto evita persistir usuarios \"fantasma\" incompletos\n    }, [currentUser]);\n\n    // 3. Inicializaci√≥n de Firebase Auth\n    useEffect(() => {\n        let didBootstrap = false;\n        let isBootstrapping = false;\n\n        const bootstrapAuth = async () => {\n            if (isBootstrapping) return;\n            isBootstrapping = true;\n            try {\n                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {\n                    await signInWithCustomToken(auth, __initial_auth_token);\n                } else {\n                    await signInAnonymously(auth);\n                }\n            } catch (e) {\n                console.error(\"Error en bootstrap Auth:\", e);\n            } finally {\n                isBootstrapping = false;\n            }\n        };\n\n        return onAuthStateChanged(auth, async (user) => {\n            setSystemUser(user);\n\n            if (!didBootstrap) {\n                didBootstrap = true;\n                if (!user) {\n                    setCurrentUser(null);\n                    await bootstrapAuth();\n                    setTimeout(() => setIsLoading(false), 300);\n                    return;\n                }\n            }\n\n            if (!user || user.isAnonymous) {\n                setCurrentUser(null);\n            }\n\n            setTimeout(() => setIsLoading(false), 300);\n        });\n    }, []);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (!systemUser || systemUser.isAnonymous) return;\n        let cancelled = false;\n        const loadProfile = async () => {\n            try {\n                const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', systemUser.uid);\n                const snap = await getDoc(userDocRef);\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const userData = { id: snap.id, ...snap.data() };\n                    if (userData.role === 'admin') userData._adminVerified = true;\n                    setCurrentUser(userData);\n                } else {\n                    setCurrentUser(null);\n                }\n            } catch {\n                if (!cancelled) setCurrentUser(null);\n            }\n        };\n        loadProfile();\n        return () => { cancelled = true; };\n    }, [appId, systemUser?.uid, systemUser?.isAnonymous]);\n\n    // CSS Variable Injection for Dynamic Theme Colors\n    useEffect(() => {\n        if (settings) {\n            const primaryColor = settings.primaryColor || '#f97316';\n            const secondaryColor = settings.secondaryColor || '#8b5cf6';\n            const accentColor = settings.accentColor || '#22c55e';\n\n            // Create or update the dynamic theme style element\n            let styleEl = document.getElementById('dynamic-theme-styles');\n            if (!styleEl) {\n                styleEl = document.createElement('style');\n                styleEl.id = 'dynamic-theme-styles';\n                document.head.appendChild(styleEl);\n            }\n\n            // Generate comprehensive CSS overrides for the theme\n            styleEl.textContent = `\n                :root {\n                    --color-primary: ${primaryColor};\n                    --color-secondary: ${secondaryColor};\n                    --color-accent: ${accentColor};\n                }\n                \n                /* Primary color overrides */\n                .text-orange-400, .text-orange-500 { color: ${primaryColor} !important; }\n                .bg-orange-400, .bg-orange-500 { background-color: ${primaryColor} !important; }\n                .bg-orange-900\\\\/10, .bg-orange-900\\\\/20 { background-color: ${primaryColor}1a !important; }\n                .border-orange-500, .border-orange-500\\\\/20, .border-orange-500\\\\/30, .border-orange-500\\\\/50 { border-color: ${primaryColor} !important; }\n                .hover\\\\:text-orange-400:hover { color: ${primaryColor} !important; }\n                .hover\\\\:bg-orange-400:hover, .hover\\\\:bg-orange-500:hover { background-color: ${primaryColor} !important; }\n                .hover\\\\:border-orange-500:hover, .hover\\\\:border-orange-500\\\\/30:hover, .hover\\\\:border-orange-500\\\\/50:hover { border-color: ${primaryColor} !important; }\n                .focus-within\\\\:border-orange-500\\\\/50:focus-within { border-color: ${primaryColor}80 !important; }\n                .from-orange-400 { --tw-gradient-from: ${primaryColor} !important; }\n                .to-orange-500 { --tw-gradient-to: ${primaryColor} !important; }\n                .shadow-orange-500\\\\/30, .shadow-orange-600\\\\/30 { --tw-shadow-color: ${primaryColor}4d !important; }\n                .ring-orange-500 { --tw-ring-color: ${primaryColor} !important; }\n                .selection\\\\:bg-orange-500\\\\/30 ::selection { background-color: ${primaryColor}4d !important; }\n                .selection\\\\:text-orange-200 ::selection { color: ${primaryColor} !important; }\n                \n                /* Secondary color overrides */\n                .text-purple-400, .text-purple-500 { color: ${secondaryColor} !important; }\n                .bg-purple-400, .bg-purple-500 { background-color: ${secondaryColor} !important; }\n                .bg-purple-900\\\\/10, .bg-purple-900\\\\/20 { background-color: ${secondaryColor}1a !important; }\n                .border-purple-500, .border-purple-500\\\\/20 { border-color: ${secondaryColor} !important; }\n                .hover\\\\:text-purple-400:hover { color: ${secondaryColor} !important; }\n                .from-purple-500, .from-purple-600 { --tw-gradient-from: ${secondaryColor} !important; }\n                \n                /* Accent color overrides */\n                .text-green-400, .text-green-500 { color: ${accentColor} !important; }\n                .bg-green-400, .bg-green-500, .bg-green-600 { background-color: ${accentColor} !important; }\n                .bg-green-900\\\\/10 { background-color: ${accentColor}1a !important; }\n                .border-green-500, .border-green-500\\\\/20, .border-green-500\\\\/30 { border-color: ${accentColor} !important; }\n                .hover\\\\:text-green-400:hover { color: ${accentColor} !important; }\n                .hover\\\\:bg-green-400:hover, .hover\\\\:bg-green-500:hover { background-color: ${accentColor} !important; }\n                .shadow-green-500\\\\/30, .shadow-green-600\\\\/30 { --tw-shadow-color: ${accentColor}4d !important; }\n                \n                /* Neon text effect with primary color */\n                .neon-text {\n                    text-shadow: 0 0 10px ${primaryColor}40, 0 0 20px ${primaryColor}20, 0 0 30px ${primaryColor}10 !important;\n                }\n            `;\n        }\n    }, [settings?.primaryColor, settings?.secondaryColor, settings?.accentColor]);\n\n    // Dark/Light Mode Effect\n    useEffect(() => {\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n\n        let lightModeStyle = document.getElementById('light-mode-styles');\n        if (!lightModeStyle) {\n            lightModeStyle = document.createElement('style');\n            lightModeStyle.id = 'light-mode-styles';\n            document.head.appendChild(lightModeStyle);\n        }\n\n        if (view === 'admin') {\n            lightModeStyle.textContent = '';\n            return;\n        }\n\n        if (!darkMode) {\n            // Light mode styles\n            lightModeStyle.textContent = `\n                /* Light Mode Overrides */\n                body, .bg-\\\\[\\\\#050505\\\\], .bg-\\\\[\\\\#0a0a0a\\\\], .bg-\\\\[\\\\#080808\\\\], .bg-\\\\[\\\\#111\\\\], .bg-black {\n                    background-color: #f8fafc !important;\n                }\n                .bg-\\\\[\\\\#1a1a1a\\\\], .bg-zinc-800 { background-color: #ffffff !important; }\n                .hover\\\\:bg-zinc-700:hover { background-color: #e2e8f0 !important; }\n                .bg-grid {\n                    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),\n                                      linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px) !important;\n                }\n                .text-white { color: #0f172a !important; }\n                .text-white\\\\/50, .text-white\\\\/60, .text-white\\\\/70, .text-white\\\\/80 { color: #475569 !important; }\n                .hover\\\\:text-white:hover { color: #0f172a !important; }\n                .text-slate-200 { color: #334155 !important; }\n                .text-slate-300, .text-slate-400, .text-slate-500, .text-slate-600 { color: #64748b !important; }\n                .bg-slate-900, .bg-slate-900\\\\/50, .bg-slate-800 { background-color: #ffffff !important; }\n                .bg-slate-900\\\\/30 { background-color: rgba(255,255,255,0.8) !important; }\n                .border-slate-700, .border-slate-700\\\\/50, .border-slate-800, .border-slate-800\\\\/50, .border-slate-900 { \n                    border-color: #e2e8f0 !important; \n                }\n                .border-white\\\\/5, .border-white\\\\/10, .border-white\\\\/20 { border-color: #e2e8f0 !important; }\n                .fill-white { fill: #0f172a !important; }\n                .stroke-white { stroke: #0f172a !important; }\n                .glass {\n                    background: rgba(255, 255, 255, 0.95) !important;\n                    border-color: #e2e8f0 !important;\n                }\n                .input-cyber {\n                    background-color: #f1f5f9 !important;\n                    border-color: #e2e8f0 !important;\n                    color: #0f172a !important;\n                }\n                .input-cyber::placeholder { color: #94a3b8 !important; }\n                .input-cyber:focus { border-color: var(--color-primary, #f97316) !important; }\n                \n                /* Cards and containers */\n                .rounded-\\\\[2rem\\\\], .rounded-\\\\[2\\\\.5rem\\\\], .rounded-\\\\[1\\\\.5rem\\\\] {\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.05) !important;\n                }\n                \n                /* Footer */\n                footer.bg-\\\\[\\\\#050505\\\\] { background-color: #0f172a !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900, \n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900\\\\/50,\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-800 { background-color: rgba(255,255,255,0.06) !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .border-slate-800 { border-color: rgba(255,255,255,0.10) !important; }\n                footer .text-white { color: #ffffff !important; }\n                footer .text-slate-500, footer .text-slate-400, footer .text-slate-600 { color: #94a3b8 !important; }\n                \n                /* Admin panel stays dark */\n                [class*=\"admin\"] .bg-\\\\[\\\\#050505\\\\] { background-color: #050505 !important; }\n            `;\n        } else {\n            lightModeStyle.textContent = '';\n        }\n    }, [darkMode, view]);\n\n    // 4. Suscripciones a Colecciones (Snapshot Listeners)\n    // - P√∫blico: se mantiene realtime solo donde aporta (products + settings)\n    // - Resto: se carga por demanda inicial (getDocs) para evitar listeners extra\n    // - Admin: listeners solo cuando el panel Admin est√° activo (view === 'admin')\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const unsubscribeFunctions = [];\n        let cancelled = false;\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'products'), (snapshot) => {\n                const productsData = snapshot.docs.map(d => {\n                    const data = d.data();\n                    return { id: d.id, ...data, stock: Number(data.stock) || 0 };\n                });\n                setProducts(productsData);\n                if (cart.length === 0) setIsLoading(false);\n            }, (error) => {\n                console.error(\"Error fetching products:\", error);\n                if (error?.code === 'permission-denied' || String(error?.message || '').includes('permission')) {\n                    showToast(\"Error de permisos. Reiniciando sesi√≥n...\", \"warning\");\n                    setTimeout(() => {\n                        auth.signOut().then(() => window.location.reload());\n                    }, 2000);\n                } else {\n                    showToast(\"Error al cargar productos: \" + (error?.message || 'error'), \"error\");\n                }\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), (snap) => {\n                if (snap.exists()) {\n                    const data = snap.data();\n                    const team = data.team || defaultSettings.team;\n                    const teamRoles = (data.teamRoles && typeof data.teamRoles === 'object')\n                        ? data.teamRoles\n                        : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n\n                    const mergedSettings = {\n                        ...defaultSettings,\n                        ...data,\n                        team,\n                        teamRoles,\n                        categories: data.categories || defaultSettings.categories\n                    };\n\n                    setSettings(mergedSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(data.aboutUsText || defaultSettings.aboutUsText);\n                } else {\n                    setSettings(defaultSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(defaultSettings.aboutUsText);\n                }\n            })\n        );\n\n        (async () => {\n            try {\n                const promosSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'promos'));\n                if (!cancelled) setPromos(promosSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setPromos([]);\n            }\n\n            try {\n                const bannersSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'));\n                if (!cancelled) {\n                    const banners = bannersSnap.docs.map(d => ({ id: d.id, ...d.data() }));\n                    banners.sort((a, b) => {\n                        const ao = Number.isFinite(Number(a.order)) ? Number(a.order) : 0;\n                        const bo = Number.isFinite(Number(b.order)) ? Number(b.order) : 0;\n                        if (ao !== bo) return ao - bo;\n                        const ad = typeof a.createdAt === 'string' ? a.createdAt : '';\n                        const bd = typeof b.createdAt === 'string' ? b.createdAt : '';\n                        return ad.localeCompare(bd);\n                    });\n                    setHomeBanners(banners);\n                }\n            } catch {\n                if (!cancelled) setHomeBanners([]);\n            }\n\n            try {\n                const couponsSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'));\n                if (!cancelled) setCoupons(couponsSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setCoupons([]);\n            }\n        })();\n\n        return () => {\n            cancelled = true;\n            unsubscribeFunctions.forEach(unsub => unsub());\n        };\n    }, [systemUser, appId]);\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const isAuthenticatedUser = systemUser && !systemUser.isAnonymous;\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n\n        if (!isAuthenticatedUser) {\n            setOrders([]);\n            return;\n        }\n\n        if (isAdminUser && !isAdminViewActive) {\n            setOrders([]);\n            return;\n        }\n\n        const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');\n        const ordersQuery = isAdminUser\n            ? query(ordersRef, orderBy('date', 'desc'), limit(100))\n            : query(ordersRef, where('customerId', '==', systemUser.uid), limit(50));\n\n        return onSnapshot(ordersQuery, (snapshot) => {\n            const ordersData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n            if (!isAdminUser) {\n                const getDateMs = (value) => {\n                    if (!value) return 0;\n                    if (typeof value?.toMillis === 'function') return value.toMillis();\n                    const ms = Date.parse(String(value));\n                    return Number.isFinite(ms) ? ms : 0;\n                };\n                ordersData.sort((a, b) => getDateMs(b.date) - getDateMs(a.date));\n            }\n            setOrders(ordersData);\n        });\n    }, [systemUser, currentUser?.role, appId, view]);\n\n    useEffect(() => {\n        if (!appId) return;\n\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n        if (!(isAdminUser && isAdminViewActive)) {\n            setUsers([]);\n            setSuppliers([]);\n            setExpenses([]);\n            setPurchases([]);\n            setInvestments([]);\n            setLiveCarts([]);\n            return;\n        }\n\n        const unsubscribeFunctions = [];\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'users'), snapshot => {\n                setUsers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), snapshot => {\n                setSuppliers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), snapshot => {\n                setExpenses(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), snapshot => {\n                setPurchases(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), snapshot => {\n                setInvestments(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'carts'), snapshot => {\n                const activeCarts = snapshot.docs\n                    .map(d => ({ id: d.id, ...d.data() }))\n                    .filter(c => c.items && c.items.length > 0);\n                setLiveCarts(activeCarts);\n            })\n        );\n\n        return () => unsubscribeFunctions.forEach(unsub => unsub());\n    }, [currentUser?.role, appId, view]);\n\n    // --- VALIDACI√ìN INTELIGENTE DEL CARRITO ---\n    // Elimina autom√°ticamente productos que ya no existen o no tienen stock\n    const productsById = useMemo(() => {\n        const map = new Map();\n        for (const p of products) map.set(String(p.id).trim(), p);\n        return map;\n    }, [products]);\n\n    const lastSyncedCartRef = useRef(null);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (products.length === 0) return;\n        if (!currentUser) return;\n        if (cart.length === 0) return;\n\n        let changed = false;\n        const removed = [];\n\n        const validated = cart.filter(item => {\n            const itemId = String(item.product?.id || '').trim();\n            const productInStore = productsById.get(itemId);\n            if (!productInStore) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Producto eliminado)`);\n                return false;\n            }\n            if (productInStore.isActive === false) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (No disponible actualmente)`);\n                return false;\n            }\n            if (productInStore.isPromo && Array.isArray(productInStore.items)) {\n                const ok = productInStore.items.every(comp => {\n                    const cid = String(comp?.productId || '').trim();\n                    const cp = productsById.get(cid);\n                    return !!cp && cp.isActive !== false;\n                });\n                if (!ok) {\n                    changed = true;\n                    removed.push(`${item.product?.name || 'Promo'} (Componente inv√°lido)`);\n                    return false;\n                }\n            }\n            if (!(Number(productInStore.stock) > 0)) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Sin Stock)`);\n                return false;\n            }\n            return true;\n        }).map(item => {\n            const fresh = productsById.get(String(item.product?.id || '').trim());\n            if (fresh && ((item.product?.basePrice ?? 0) !== fresh.basePrice || (item.product?.discount ?? 0) !== fresh.discount)) {\n                changed = true;\n            }\n            return { ...item, product: fresh || item.product };\n        });\n\n        if (!changed) return;\n\n        setCart(validated);\n\n        const payload = JSON.stringify(validated.map(i => ({ id: String(i.product?.id || ''), q: i.quantity, p: i.product?.basePrice, d: i.product?.discount })));\n        if (lastSyncedCartRef.current === payload) return;\n        lastSyncedCartRef.current = payload;\n\n        setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n            userId: currentUser.id,\n            items: validated\n        }, { merge: true });\n\n        if (removed.length > 0) {\n            showToast(`Tu carrito se actualiz√≥: ${removed.join(', ')}`, 'info');\n        }\n    }, [productsById, currentUser?.id, cart, appId]);\n\n    // --- EFECTO VISUAL: SEO, FAVICON Y T√çTULO DIN√ÅMICO ---\n\n    const lastSavedSettingsRef = useRef(null);\n\n    // Actualiza todas las meta tags de SEO seg√∫n la configuraci√≥n de la tienda\n    useEffect(() => {\n        // IMPORTANTE: Esperar a que la configuraci√≥n cargue realmente para evitar \"parpadeo\" del logo default\n        if (!appId) return;\n        if (!settingsLoaded || !settings) return;\n\n        const currentSettingsStr = JSON.stringify(settings);\n\n        // Prevent infinite loop: Only save if content changed\n        if (lastSavedSettingsRef.current === currentSettingsStr) {\n            return;\n        }\n\n        // Auto-Save Settings Logic (Debounced)\n        const autoSaveTimer = setTimeout(async () => {\n            try {\n                if (currentUser?.role !== 'admin') {\n                    lastSavedSettingsRef.current = currentSettingsStr;\n                    return;\n                }\n                const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                const team = settings?.team || defaultSettings.team;\n                const teamRoles = (settings?.teamRoles && typeof settings.teamRoles === 'object')\n                    ? settings.teamRoles\n                    : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n                const settingsToSave = { ...settings, teamRoles };\n                // Use merge true to be safe, though we usually have the full object\n                await setDoc(settingsRef, settingsToSave, { merge: true });\n\n                // Update the ref to match what we just saved\n                lastSavedSettingsRef.current = JSON.stringify(settingsToSave);\n\n                console.log(\"[AutoSave] Settings saved successfully.\");\n            } catch (error) {\n                console.error(\"[AutoSave] Error saving settings:\", error);\n            }\n        }, 2000); // 2 seconds debounce\n\n        // Helper para actualizar meta tags de forma segura\n        const updateMetaTag = (selector, content) => {\n            const element = document.querySelector(selector);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateMetaTagById = (id, content) => {\n            const element = document.getElementById(id);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateLinkTag = (id, href) => {\n            const element = document.getElementById(id);\n            if (element && href) {\n                element.setAttribute('href', href);\n            }\n        };\n\n        // 1. T√≠tulo de la Pesta√±a\n        const pageTitle = settings.seoTitle || (settings.storeName ? `${settings.storeName} - Tienda Online` : 'Tienda Online');\n        document.title = pageTitle;\n\n        // 2. Meta Description\n        const description = settings.seoDescription || `${settings.storeName || 'Tienda'} - Tu tienda online de confianza.`;\n        updateMetaTagById('meta-description', description);\n\n        // 3. Meta Keywords\n        const keywords = settings.seoKeywords || `${settings.storeName || 'tienda'}, productos, comprar, env√≠os`;\n        updateMetaTagById('meta-keywords', keywords);\n\n        // 4. Meta Author\n        const author = settings.seoAuthor || settings.storeName || 'Tienda Online';\n        updateMetaTagById('meta-author', author);\n\n        // 5. Apple Mobile Web App Title\n        updateMetaTagById('meta-apple-title', settings.storeName || 'Tienda');\n\n        // 6. Theme Color\n        if (settings.primaryColor) {\n            updateMetaTagById('meta-theme-color', settings.primaryColor);\n        }\n\n        // 7. Canonical URL\n        if (settings.seoUrl) {\n            updateLinkTag('link-canonical', settings.seoUrl);\n        }\n\n        // 8. Open Graph Tags\n        const ogImage = settings.seoImage || settings.logoUrl || settings.heroUrl || '';\n        updateMetaTagById('og-title', pageTitle);\n        updateMetaTagById('og-description', description);\n        updateMetaTagById('og-site-name', settings.storeName || 'Tienda Online');\n        if (settings.seoUrl) {\n            updateMetaTagById('og-url', settings.seoUrl);\n        }\n        if (ogImage) {\n            updateMetaTagById('og-image', ogImage);\n        }\n\n        // 9. Twitter Card Tags\n        updateMetaTagById('twitter-title', pageTitle);\n        updateMetaTagById('twitter-description', description);\n        if (ogImage) {\n            updateMetaTagById('twitter-image', ogImage);\n        }\n\n        // 10. Favicon (Icono de Pesta√±a) - Auto Circular\n        const link = document.getElementById('dynamic-favicon') || document.querySelector(\"link[rel*='icon']\");\n        if (link) {\n            if (settings.logoUrl) {\n                // Intentar recortar la imagen en c√≠rculo para el favicon\n                const img = new Image();\n                img.crossOrigin = 'Anonymous';\n                img.onload = () => {\n                    try {\n                        const canvas = document.createElement('canvas');\n                        canvas.width = 64;\n                        canvas.height = 64;\n                        const ctx = canvas.getContext('2d');\n                        // Crear c√≠rculo\n                        ctx.beginPath();\n                        ctx.arc(32, 32, 32, 0, Math.PI * 2);\n                        ctx.closePath();\n                        ctx.clip();\n                        // Dibujar imagen\n                        ctx.drawImage(img, 0, 0, 64, 64);\n                        link.href = canvas.toDataURL('image/png');\n                    } catch (e) {\n                        // Fallback si falla canvas (ej: CORS estricto)\n                        link.href = settings.logoUrl;\n                    }\n                };\n                img.onerror = () => { link.href = settings.logoUrl; };\n                img.src = settings.logoUrl;\n            } else {\n                // Si no hay logo configurado, usar el default circular\n                link.href = '/icon-192.png';\n            }\n        }\n\n        console.log('[SEO & AutoSave] Updated and Autosaved.');\n\n        return () => clearTimeout(autoSaveTimer);\n    }, [settings, settingsLoaded, currentUser?.role]);\n\n    // ‚ö†Ô∏è [PAUSA POR SEGURIDAD] - El c√≥digo contin√∫a con la l√≥gica expandida. Escribe \"continuar\" para la siguiente parte.\n    // --- L√ìGICA DE NEGOCIO Y FUNCIONES PRINCIPALES ---\n\n    // 1. L√≥gica de Autenticaci√≥n (Firebase Auth + Perfil en Firestore)\n    const handleAuth = async (isRegister) => {\n        setIsLoading(true);\n        try {\n            const superAdminAttempt = String(authData.email || '').trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n            const normalizedHostname = String(window.location.hostname || '').trim().toLowerCase();\n            const isLocalhost = normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1' || normalizedHostname === '::1';\n            if (!appId && !superAdminAttempt) {\n                throw new Error('Tienda no configurada para este dominio.');\n            }\n            const usersPath = appId ? ['artifacts', appId, 'public', 'data', 'users'] : null;\n\n            const fetchProfile = async (uid) => {\n                if (!usersPath) return null;\n                const snap = await getDoc(doc(db, ...usersPath, uid));\n                return snap.exists() ? { id: snap.id, ...snap.data() } : null;\n            };\n\n            const setupProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                const res = await fetch('/api/auth/setup-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({\n                        name: authData.name,\n                        username: authData.username,\n                        dni: authData.dni,\n                        phone: authData.phone\n                    })\n                });\n                const data = await res.json().catch(() => ({}));\n                if (!res.ok) throw new Error(data.error || 'Error al crear el perfil');\n            };\n\n            const claimLegacyProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                await fetch('/api/auth/claim-legacy-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({})\n                });\n            };\n\n            if (isRegister) {\n                const normalizedEmail = authData.email.trim().toLowerCase();\n                if (!authData.name || authData.name.trim().length < 3) throw new Error(\"El nombre es muy corto.\");\n                if (!authData.username || authData.username.trim().length < 3) throw new Error(\"Debes elegir un nombre de usuario.\");\n                if (!normalizedEmail || !normalizedEmail.includes('@')) throw new Error(\"Email inv√°lido.\");\n                if (!authData.password || authData.password.length < 6) throw new Error(\"La contrase√±a debe tener al menos 6 caracteres.\");\n                if (!authData.dni || authData.dni.trim().length < 6) throw new Error(\"Debes ingresar tu DNI (m√≠nimo 6 d√≠gitos).\");\n                if (!authData.phone || authData.phone.trim().length < 8) throw new Error(\"Debes ingresar tu tel√©fono (m√≠nimo 8 d√≠gitos).\");\n\n                const userCredential = await createUserWithEmailAndPassword(auth, normalizedEmail, authData.password);\n                try {\n                    await setupProfile(userCredential.user);\n                } catch (e) {\n                    try { await userCredential.user.delete(); } catch { }\n                    throw e;\n                }\n\n                const profile = await fetchProfile(userCredential.user.uid);\n                if (!profile) throw new Error('No se pudo cargar el perfil');\n\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(\"¬°Cuenta creada exitosamente! Bienvenido.\", \"success\");\n            } else {\n                const input = authData.email.trim();\n                if (!input) throw new Error(\"Ingresa tu email o usuario.\");\n                if (!authData.password) throw new Error(\"Ingresa tu contrase√±a.\");\n\n                let emailToUse = input.toLowerCase();\n                let authUser = null;\n\n                if (!input.includes('@')) {\n                    const res = await fetch('/api/auth/username-lookup', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                        body: JSON.stringify({ username: input })\n                    });\n                    const data = await res.json().catch(() => ({}));\n                    if (!res.ok) throw new Error(\"Usuario no encontrado.\");\n                    emailToUse = String(data.email || '').toLowerCase();\n                }\n\n                try {\n                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                    authUser = userCredential.user;\n                } catch (e) {\n                    const code = e?.code || '';\n                    const invalidCredentialCodes = new Set(['auth/invalid-credential', 'auth/invalid-login-credentials']);\n                    if (code === 'auth/user-not-found' || invalidCredentialCodes.has(code)) {\n                        const res = await fetch('/api/auth/legacy-login', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                            body: JSON.stringify({ identifier: input, password: authData.password })\n                        });\n                        const raw = await res.text().catch(() => '');\n                        let data = {};\n                        try { data = raw ? JSON.parse(raw) : {}; } catch { data = {}; }\n                        if (!res.ok || !data?.token) {\n                            if (res.status === 401) {\n                                const looksLikeVercel = /<html/i.test(raw) || /login\\s*‚Äì\\s*vercel/i.test(raw) || /vercel/i.test(raw);\n                                if (looksLikeVercel) {\n                                    throw new Error('Tu despliegue est√° respondiendo 401 (Vercel protegido). Desactiv√° Deployment Protection / Vercel Authentication o hac√© el sitio p√∫blico.');\n                                }\n                                throw new Error('Credenciales incorrectas.');\n                            }\n                            if (data?.code === 'firebase_admin_not_configured') {\n                                throw new Error(data.error || 'Backend no configurado (Firebase Admin)');\n                            }\n                            if (superAdminAttempt) {\n                                if (!isLocalhost) {\n                                    throw new Error('El Super Admin no se inicializa desde Vercel. Crealo en Firebase Auth (Authentication > Users) o inicializalo en localhost.');\n                                }\n                                const bootRes = await fetch('/api/auth/bootstrap-super-admin', {\n                                    method: 'POST',\n                                    headers: { 'Content-Type': 'application/json' },\n                                    body: JSON.stringify({ email: emailToUse, password: authData.password })\n                                });\n                                if (bootRes.ok) {\n                                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                                    authUser = userCredential.user;\n                                } else {\n                                    const bootData = await bootRes.json().catch(() => ({}));\n                                    throw new Error(bootData?.error || 'No se pudo inicializar el Super Admin');\n                                }\n                            }\n                            if (!authUser) {\n                                throw new Error(data.error || 'No se pudo recuperar tu cuenta legacy');\n                            }\n                        }\n                        const userCredential = await signInWithCustomToken(auth, data.token);\n                        authUser = userCredential.user;\n                    } else if (code === 'auth/wrong-password') {\n                        throw new Error(\"La contrase√±a es incorrecta.\");\n                    } else if (code === 'auth/too-many-requests') {\n                        throw new Error(\"Demasiados intentos fallidos. Intenta m√°s tarde o restablece tu contrase√±a.\");\n                    } else {\n                        throw e;\n                    }\n                }\n\n                if (!authUser) throw new Error('Error al iniciar sesi√≥n');\n\n                if (!usersPath) {\n                    const normalizedEmailLower = String(authUser.email || emailToUse).toLowerCase();\n                    const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                    setCurrentUser({\n                        id: authUser.uid,\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: superEmailLower && normalizedEmailLower === superEmailLower ? 'admin' : 'user',\n                    });\n                    showToast('Sesi√≥n iniciada. Vincul√° el dominio para cargar la tienda.', 'success');\n                    setView('store');\n                    setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n                    return;\n                }\n\n                let profile = await fetchProfile(authUser.uid);\n                if (!profile) {\n                    await claimLegacyProfile(authUser);\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                if (!profile) {\n                    const minimal = {\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: String(authUser.email || emailToUse).trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase() ? 'admin' : 'user',\n                        createdAt: new Date().toISOString()\n                    };\n                    await setDoc(doc(db, ...usersPath, authUser.uid), minimal, { merge: true });\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                await updateDoc(doc(db, ...usersPath, authUser.uid), { lastLogin: new Date().toISOString() }).catch(() => { });\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(`¬°Hola de nuevo, ${profile?.name || 'Usuario'}!`, \"success\");\n            }\n\n            setView('store');\n            setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n        } catch (error) {\n            console.error(\"Error de autenticaci√≥n:\", error);\n            showToast(error.message || 'Error de autenticaci√≥n', \"error\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 1.1 Recuperar Contrase√±a\n    const handleForgotPassword = async () => {\n        if (!authData.email || !authData.email.includes('@')) {\n            showToast(\"Ingresa tu email en el campo de arriba para recuperar la contrase√±a.\", \"warning\");\n            return;\n        }\n        setIsLoading(true);\n        try {\n            await sendPasswordResetEmail(auth, authData.email);\n            showToast(\"¬°Listo! Revisa tu email (y spam) para restablecer tu contrase√±a.\", \"success\");\n        } catch (e) {\n            console.error(\"Error reset pass:\", e);\n            if (e.code === 'auth/user-not-found') {\n                showToast(\"No existe una cuenta registrada con este email.\", \"error\");\n            } else {\n                showToast(\"Error al enviar email: \" + e.message, \"error\");\n            }\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 2. Gesti√≥n de Favoritos (Wishlist)\n    const toggleFavorite = async (product) => {\n        if (!currentUser) {\n            showToast(\"Debes iniciar sesi√≥n para guardar favoritos.\", \"info\");\n            return;\n        }\n\n        const currentFavs = currentUser.favorites || [];\n        const isAlreadyFav = currentFavs.includes(product.id);\n        let newFavs = [];\n\n        if (isAlreadyFav) {\n            // Eliminar de favoritos\n            newFavs = currentFavs.filter(id => id !== product.id);\n            showToast(\"Eliminado de tus favoritos.\", \"info\");\n        } else {\n            // Agregar a favoritos\n            newFavs = [...currentFavs, product.id];\n            showToast(\"¬°Guardado en favoritos!\", \"success\");\n        }\n\n        // Actualizaci√≥n Optimista (UI instant√°nea)\n        setCurrentUser(prev => ({ ...prev, favorites: newFavs }));\n\n        // Persistencia en Firebase\n        try {\n            const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', currentUser.id);\n            await updateDoc(userRef, { favorites: newFavs });\n        } catch (e) {\n            console.error(\"Error guardando favorito:\", e);\n            // Revertir si falla (opcional, por simplicidad no lo incluimos pero ser√≠a ideal)\n        }\n    };\n\n    // 3. Gesti√≥n del Carrito\n    const manageCart = (product, quantityDelta) => {\n        setCart(prevCart => {\n            const existingItemIndex = prevCart.findIndex(item => item.product.id === product.id);\n            const currentQuantity = existingItemIndex >= 0 ? prevCart[existingItemIndex].quantity : 0;\n            const newQuantity = currentQuantity + quantityDelta;\n\n            // Validaciones de Stock (Manejo Dual: Producto Normal vs Promo)\n            let currentStock = 0;\n\n            if (product.isPromo) {\n                // Recalcular stock virtual al momento de agregar (por seguridad)\n                let maxPurchasable = Infinity;\n                product.items.forEach(item => {\n                    const p = products.find(prod => prod.id === item.productId);\n                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                });\n                currentStock = maxPurchasable;\n            } else {\n                currentStock = Number(product.stock);\n            }\n\n            if (newQuantity > currentStock) {\n                showToast(`Lo sentimos, el stock m√°ximo disponible es ${currentStock}.`, \"warning\");\n                return prevCart;\n            }\n\n            // Eliminar item si cantidad llega a 0\n            if (newQuantity <= 0) {\n                if (existingItemIndex >= 0) {\n                    showToast(\"Producto eliminado del carrito.\", \"info\");\n                    return prevCart.filter(item => item.product.id !== product.id);\n                }\n                return prevCart;\n            }\n\n            // Actualizar o Agregar\n            if (existingItemIndex >= 0) {\n                // Actualizar cantidad existente\n                const updatedCart = [...prevCart];\n                updatedCart[existingItemIndex] = { ...updatedCart[existingItemIndex], quantity: newQuantity };\n                return updatedCart;\n            } else {\n                // Agregar nuevo item\n                showToast(\"¬°Producto agregado al carrito!\", \"success\");\n                return [...prevCart, { product: product, quantity: newQuantity }];\n            }\n        });\n    };\n\n    // 4. C√°lculos de Precios y Descuentos\n    const calculateItemPrice = (basePrice, discount) => {\n        if (!discount || discount <= 0) return Number(basePrice);\n        const discounted = Number(basePrice) * (1 - discount / 100);\n        return Math.ceil(discounted);\n    };\n\n    const cartSubtotal = useMemo(() => {\n        return cart.reduce((total, item) => {\n            const price = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            return total + (price * (item.quantity || 0));\n        }, 0);\n    }, [cart]);\n\n    // Aplicar l√≥gica compleja de cupones\n    const calculateDiscountAmount = (total, coupon) => {\n        if (!coupon) return 0;\n\n        // Validar expiraci√≥n y l√≠mites nuevamente por seguridad\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return 0;\n\n        let discountValue = 0;\n\n        if (coupon.type === 'fixed') {\n            discountValue = coupon.value;\n            // No descontar m√°s que el total\n            if (discountValue > total) discountValue = total;\n        } else if (coupon.type === 'percentage') {\n            discountValue = total * (coupon.value / 100);\n            // Aplicar tope si existe\n            if (coupon.maxDiscount && coupon.maxDiscount > 0) {\n                if (discountValue > coupon.maxDiscount) {\n                    discountValue = coupon.maxDiscount;\n                }\n            }\n        }\n\n        return Math.ceil(discountValue);\n    };\n\n    const buildWhatsappUrl = (baseLink, message) => {\n        const trimmed = (baseLink || '').trim();\n        if (!trimmed) return null;\n        try {\n            const url = new URL(trimmed);\n            url.searchParams.set('text', message);\n            return url.toString();\n        } catch {\n            const digits = trimmed.replace(/[^\\d]/g, '');\n            if (!digits) return null;\n            return `https://wa.me/${digits}?text=${encodeURIComponent(message)}`;\n        }\n    };\n\n    const isCouponValidForWhatsapp = (coupon) => {\n        if (!coupon) return false;\n        if (coupon.targetType === 'specific_email' && currentUser?.email) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) return false;\n        }\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return false;\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) return false;\n        if (cartSubtotal < (coupon.minPurchase || 0)) return false;\n        if (!currentUser?.dni) return false;\n        return true;\n    };\n\n    const buildWhatsappCartMessage = () => {\n        const currency = settings?.currency || '$';\n        const storeName = settings?.storeName || 'la tienda';\n\n        const lines = [];\n        lines.push(`Hola, quiero terminar mi compra por WhatsApp en ${storeName}.`);\n\n        if (currentUser?.name) {\n            const userBits = [currentUser.name];\n            if (currentUser.email) userBits.push(currentUser.email);\n            if (currentUser.phone) userBits.push(currentUser.phone);\n            lines.push(`Cliente: ${userBits.join(' - ')}`);\n        } else if (currentUser?.email) {\n            lines.push(`Cliente: ${currentUser.email}`);\n        }\n\n        lines.push('');\n        lines.push('Mi carrito:');\n\n        cart.forEach((item) => {\n            const name = item.product?.name || 'Producto';\n            const quantity = Number(item.quantity) || 0;\n            const unit = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            const lineTotal = Math.ceil(unit * quantity);\n            lines.push(`- ${quantity} x ${name} ‚Äî ${currency}${unit.toLocaleString()} c/u ‚Äî ${currency}${lineTotal.toLocaleString()}`);\n        });\n\n        const couponToUse = isCouponValidForWhatsapp(appliedCoupon) ? appliedCoupon : null;\n        const couponDiscount = couponToUse ? calculateDiscountAmount(cartSubtotal, couponToUse) : 0;\n        const messageSubtotal = Math.max(0, Number(cartSubtotal) || 0);\n        const messageShipping = Math.max(0, Number(shippingFee) || 0);\n        const messageTotal = Math.max(0, messageSubtotal - couponDiscount + messageShipping);\n\n        lines.push('');\n        lines.push(`Subtotal: ${currency}${messageSubtotal.toLocaleString()}`);\n\n        if (couponToUse && couponDiscount > 0) {\n            lines.push(`Cup√≥n: ${couponToUse.code}`);\n            lines.push(`Descuento: -${currency}${couponDiscount.toLocaleString()}`);\n        }\n\n        const shippingLabel = checkoutData.shippingMethod === 'Delivery' ? 'Env√≠o a domicilio' : 'Retiro en local';\n        lines.push(`${shippingLabel}: ${messageShipping > 0 ? `${currency}${messageShipping.toLocaleString()}` : 'Gratis'}`);\n        lines.push(`Total estimado: ${currency}${messageTotal.toLocaleString()}`);\n\n        return lines.join('\\n');\n    };\n\n    const discountAmount = appliedCoupon ? calculateDiscountAmount(cartSubtotal, appliedCoupon) : 0;\n\n    const shippingFee = useMemo(() => {\n        if (checkoutData.shippingMethod !== 'Delivery') return 0;\n        const deliverySettings = settings?.shippingDelivery;\n        if (!deliverySettings?.enabled) return 0;\n        if (deliverySettings.freeAbove > 0 && cartSubtotal >= deliverySettings.freeAbove) return 0;\n        return Number(deliverySettings.fee) || 0;\n    }, [checkoutData.shippingMethod, cartSubtotal, settings?.shippingDelivery]);\n\n    const finalTotal = Math.max(0, cartSubtotal - discountAmount + shippingFee);\n\n    // Selecci√≥n de Cup√≥n\n    const selectCoupon = async (coupon) => {\n        // Validaciones previas\n        if (coupon.targetType === 'specific_email' && currentUser) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) {\n                return showToast(\"Este cup√≥n no est√° disponible para tu cuenta.\", \"error\");\n            }\n        }\n        if (new Date(coupon.expirationDate) < new Date()) {\n            return showToast(\"Este cup√≥n ha vencido.\", \"error\");\n        }\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) {\n            return showToast(\"Este cup√≥n ha agotado sus usos totales.\", \"error\");\n        }\n        if (cartSubtotal < (coupon.minPurchase || 0)) {\n            return showToast(`El monto m√≠nimo para este cup√≥n es $${coupon.minPurchase}.`, \"warning\");\n        }\n\n        if (!currentUser?.dni) {\n            return showToast(\"Debes actualizar tu DNI en el perfil para usar cupones.\", \"warning\");\n        }\n\n        setAppliedCoupon(coupon);\n        setShowCouponModal(false);\n\n        let msg = \"¬°Cup√≥n aplicado correctamente!\";\n        if (coupon.type === 'percentage' && coupon.maxDiscount > 0) {\n            msg += ` (Tope de reintegro: $${coupon.maxDiscount})`;\n        }\n        showToast(msg, \"success\");\n    };\n\n    // Enviar correo autom√°tico via Backend\n    const sendOrderConfirmationEmail = async (orderData, discountDetails) => {\n        try {\n            await fetch('/api/payment', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                },\n                body: JSON.stringify({\n                    orderId: orderData.orderId,\n                    customer: orderData.customer,\n                    items: orderData.items,\n                    total: orderData.total,\n                    subtotal: orderData.subtotal,\n                    discountDetails: discountDetails,\n                    shipping: orderData.shippingAddress,\n                    shippingFee: orderData.shippingFee,\n                    shippingMethod: orderData.shippingMethod,\n                    paymentMethod: orderData.paymentMethod,\n                    date: orderData.date\n                }),\n            });\n            console.log(\"Correo de confirmaci√≥n enviado enviada API.\");\n        } catch (error) {\n            console.error(\"Error al enviar email autom√°tico:\", error);\n            // No bloqueamos el flujo si falla el email, solo logueamos\n        }\n    };\n\n    const getAuthenticatedUser = async () => {\n        const existing = auth.currentUser;\n        if (existing && !existing.isAnonymous) return existing;\n\n        const hydrated = await new Promise((resolve) => {\n            let unsub = null;\n            const timeoutId = setTimeout(() => {\n                if (unsub) unsub();\n                resolve(auth.currentUser);\n            }, 1200);\n            unsub = onAuthStateChanged(auth, (user) => {\n                clearTimeout(timeoutId);\n                unsub();\n                resolve(user);\n            });\n        });\n\n        if (hydrated && !hydrated.isAnonymous) return hydrated;\n        return null;\n    };\n\n    // 5. Confirmaci√≥n de Pedido (Checkout)\n    const confirmOrder = async () => {\n        if (isProcessingOrder) return;\n\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesi√≥n para finalizar la compra.\", \"info\");\n            }\n\n            let effectiveUser = currentUser;\n            if (!effectiveUser && appId) {\n                try {\n                    const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', authUser.uid));\n                    if (snap.exists()) {\n                        const userData = { id: snap.id, ...snap.data() };\n                        if (userData.role === 'admin') userData._adminVerified = true;\n                        setCurrentUser(userData);\n                        effectiveUser = userData;\n                    }\n                } catch { }\n            }\n\n            if (!effectiveUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesi√≥n para finalizar la compra.\", \"info\");\n            }\n\n            if (!effectiveUser.name || !effectiveUser.phone || !effectiveUser.dni) {\n                setView('profile');\n                return showToast(\"Por favor completa tus datos personales (Nombre, Tel√©fono y DNI) en tu perfil antes de comprar.\", \"warning\");\n            }\n\n            if (checkoutData.shippingMethod === 'Delivery' && (!checkoutData.address || !checkoutData.city || !checkoutData.province || !checkoutData.zipCode)) {\n                return showToast(\"Por favor completa TODOS los datos de env√≠o.\", \"warning\");\n            }\n\n            if (!checkoutData.paymentChoice) {\n                return showToast(\"Selecciona un m√©todo de pago.\", \"warning\");\n            }\n\n            if (checkoutData.paymentChoice === 'Tarjeta') {\n                throw new Error('Para pagar con tarjeta us√° el formulario de Mercado Pago.');\n            }\n\n            setIsProcessingOrder(true);\n            showToast(\"Procesando tu pedido, por favor espera...\", \"info\");\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: checkoutData.paymentChoice,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) {\n                setView('login');\n                throw new Error('Tu sesi√≥n venci√≥. Inici√° sesi√≥n nuevamente para finalizar la compra.');\n            }\n            if (!res.ok) throw new Error(data.error || 'Error al procesar el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            setView('profile');\n            showToast(\"¬°Pedido realizado con √©xito! Te enviamos un email con el detalle.\", \"success\");\n        } catch (e) {\n            console.error(\"Error al procesar pedido:\", e);\n            showToast(e.message || \"Ocurri√≥ un error al procesar el pedido.\", \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // --- FUNCIONES DE MERCADO PAGO CARD PAYMENT BRICK ---\n\n    // Inicializar el Card Payment Brick cuando se selecciona Mercado Pago\n    const initializeCardPaymentBrick = async () => {\n        if (isInitializingBrick.current) return;\n\n        // Resetear estados al iniciar por si quedaron de una compra anterior\n        setIsPaymentProcessing(false);\n        setPaymentError(null);\n\n        console.log('üíé Mercado Pago: Iniciando Brick. Total a cobrar:', finalTotal);\n\n        if (!window.MercadoPago) {\n            try {\n                await (async () => {\n                    if (window.MercadoPago) return;\n                    await new Promise((resolve, reject) => {\n                        const s = document.createElement('script');\n                        s.src = 'https://sdk.mercadopago.com/js/v2';\n                        s.async = true;\n                        s.onload = resolve;\n                        s.onerror = reject;\n                        document.head.appendChild(s);\n                    });\n                })();\n            } catch {\n                setPaymentError('No se pudo cargar el sistema de pagos. Intent√° nuevamente.');\n                return;\n            }\n        }\n\n        // Sanitizar el monto total para evitar errores de precisi√≥n flotante\n        const safeAmount = Number(parseFloat(finalTotal).toFixed(2));\n        if (isNaN(safeAmount) || safeAmount <= 0) {\n            console.error('‚ùå Error: Monto inv√°lido para pago:', finalTotal);\n            return;\n        }\n\n        const container = document.getElementById('cardPaymentBrick_container');\n        if (!container) return;\n\n        isInitializingBrick.current = true;\n\n        // Timeout de seguridad: si en 10 segundos no carg√≥, permitir reintentar\n        const safetyTimeout = setTimeout(() => {\n            if (isInitializingBrick.current) {\n                console.warn('‚ö†Ô∏è Mercado Pago: La inicializaci√≥n est√° tardando demasiado. Liberando bloqueo...');\n                isInitializingBrick.current = false;\n            }\n        }, 10000);\n\n        // Limpiar brick anterior si existe\n        if (mpBrickController) {\n            try {\n                await mpBrickController.unmount();\n            } catch (e) {\n                console.warn('Error unmounting:', e);\n            }\n            setMpBrickController(null);\n        }\n\n        // Limpiar el contenedor f√≠sicamente por si quedaron restos\n        const containerElem = document.getElementById('cardPaymentBrick_container');\n        if (containerElem) {\n            containerElem.innerHTML = '';\n            // Forzar un reflow/render\n            containerElem.style.display = 'none';\n            containerElem.offsetHeight;\n            containerElem.style.display = 'block';\n        }\n\n        // Limpiar errores previos\n        setPaymentError(null);\n\n        const publicKey = await getMercadoPagoPublicKey();\n        if (!publicKey) {\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            setPaymentError('Mercado Pago no est√° configurado. Verific√° la clave p√∫blica en el servidor.');\n            return;\n        }\n        const mp = new window.MercadoPago(publicKey, {\n            locale: 'es-AR',\n        });\n\n        const bricksBuilder = mp.bricks();\n\n        try {\n            const controller = await bricksBuilder.create('cardPayment', 'cardPaymentBrick_container', {\n                initialization: {\n                    amount: safeAmount, // Total validado y formateado\n                },\n                customization: {\n                    visual: {\n                        style: {\n                            theme: 'default',\n                            customVariables: {\n                                formBackgroundColor: '#0f172a',\n                                baseColor: '#f97316',\n                                borderRadiusMedium: '12px',\n                                borderRadiusLarge: '16px',\n                                textPrimaryColor: '#000000',\n                                textSecondaryColor: '#334155',\n                            },\n                        },\n                    },\n                    paymentMethods: {\n                        maxInstallments: 12,\n                    },\n                },\n                callbacks: {\n                    onReady: () => {\n                        console.log('‚úÖ Mercado Pago: Card Payment Brick cargado.');\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                    },\n                    onSubmit: async (cardFormData) => {\n                        console.log('üöÄ Mercado Pago: Procesando pago...');\n\n                        // Bloquear clics dobles pero permitir reintentos si falla\n                        setIsPaymentProcessing(true);\n                        setPaymentError(null);\n\n                        // Validar datos cr√≠ticos antes de enviar\n                        if (!cardFormData.token) {\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error en los datos de la tarjeta. Por favor intent√° nuevamente.');\n                            showToast('Error al procesar los datos de la tarjeta.', 'error');\n                            return;\n                        }\n\n                        try {\n                            const response = await fetch('/api/checkout', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    action: 'process_payment',\n                                    paymentData: {\n                                        token: cardFormData.token,\n                                        transaction_amount: safeAmount,\n                                        description: `Compra en ${settings?.storeName || 'Tienda Online'}`,\n                                        installments: cardFormData.installments || 1,\n                                        payment_method_id: cardFormData.payment_method_id || '',\n                                        issuer_id: cardFormData.issuer_id || '',\n                                    },\n                                    payer: {\n                                        email: currentUser?.email || 'sin-email@tienda.com',\n                                        identificationType: cardFormData.payer?.identification?.type || 'DNI',\n                                        identificationNumber: cardFormData.payer?.identification?.number || '00000000',\n                                    },\n                                }),\n                            });\n\n                            const result = await response.json().catch(() => ({}));\n                            console.log('üì¶ Respuesta:', result);\n\n                            if (!response.ok) {\n                                const message = result?.error || result?.message || `Error procesando pago (${response.status})`;\n                                throw new Error(message);\n                            }\n\n                            if (result.status === 'approved' || result.status === 'in_process' || result.status === 'pending') {\n                                await confirmOrderAfterPayment(result.id);\n                                showToast('¬°Compra realizada!', 'success');\n                                setIsPaymentProcessing(false);\n                                isInitializingBrick.current = false;\n                                // Limpiar controlador de MP para que la pr√≥xima compra reinicie de cero\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(e); }\n                                    setMpBrickController(null);\n                                }\n                            } else {\n                                // ERROR DE NEGOCIO (Pago rechazado, tarjeta inv√°lida, etc)\n                                const mpErrorMap = {\n                                    'cc_rejected_high_risk': 'El pago fue rechazado por controles de seguridad de Mercado Pago. Te recomendamos probar con otra tarjeta o medio de pago.',\n                                    'cc_rejected_insufficient_amount': 'Tu tarjeta no tiene fondos suficientes.',\n                                    'cc_rejected_bad_filled_other': 'Revis√° los datos de tu tarjeta.',\n                                    'cc_rejected_bad_filled_date': 'La fecha de vencimiento es incorrecta.',\n                                    'cc_rejected_bad_filled_security_code': 'El c√≥digo de seguridad es incorrecto.',\n                                    'cc_rejected_call_for_authorize': 'Deb√©s autorizar el pago llamando a tu banco.',\n                                    'cc_rejected_card_disabled': 'Tu tarjeta est√° inactiva. Llam√° a tu banco para activarla.',\n                                    'cc_rejected_max_attempts': 'Llegaste al l√≠mite de intentos permitidos. Us√° otra tarjeta.',\n                                    'cc_rejected_duplicated_payment': 'Ya hiciste un pago similar recientemente. Esper√° unos minutos.'\n                                };\n                                const detailedError = mpErrorMap[result.status_detail] || result.status_detail || result.error || 'Pago rechazado';\n                                console.error('‚ùå Motivo del rechazo:', detailedError);\n\n                                // IMPORTANTE: Si el pago falla, destruimos el brick para que al reintentar se cree uno nuevo y limpio\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(\"Error al desmontar brick tras falla:\", e); }\n                                    setMpBrickController(null);\n                                }\n                                isInitializingBrick.current = false;\n\n                                setIsPaymentProcessing(false);\n                                // Mensaje de m√°xima tranquilidad para el cliente\n                                setPaymentError(`${detailedError}`); // Mensaje limpio y directo\n                                showToast('El pago no se pudo completar. Revis√° los detalles.', 'error');\n                            }\n                        } catch (error) {\n                            // ERROR DE CONEXI√ìN\n                            console.error('‚ùå Error de conexi√≥n:', error);\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error de conexi√≥n con el servidor. Revis√° tu internet e intent√° de nuevo.');\n                            showToast('Error de conexi√≥n.', 'error');\n                        }\n                    },\n                    onError: (error) => {\n                        console.error('‚ùå Mercado Pago Error:', error);\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                        // No mostrar error si es solo por AdBlock\n                        if (error && error.message && error.message.includes('melidata')) return;\n                        setPaymentError('Error en el formulario. Verific√° tus claves de producci√≥n.');\n                    },\n                },\n            });\n\n            setMpBrickController(controller);\n        } catch (error) {\n            console.error('Error creating brick:', error);\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            showToast('Error al cargar el formulario de pago.', 'error');\n        }\n    };\n\n    // Confirmar orden despu√©s de pago exitoso con MP\n    const confirmOrderAfterPayment = async (mpPaymentId) => {\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                throw new Error('Sesi√≥n inv√°lida. Reinici√° e intent√° de nuevo.');\n            }\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: 'Tarjeta',\n                    mpPaymentId,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) throw new Error('Tu sesi√≥n venci√≥. Inici√° sesi√≥n nuevamente e intent√° otra vez.');\n            if (!res.ok) throw new Error(data.error || 'Error guardando el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            if (mpBrickController) {\n                try { mpBrickController.unmount(); } catch (e) { }\n            }\n            setMpBrickController(null);\n            setView('profile');\n        } catch (error) {\n            console.error('Error creating order after payment:', error);\n            showToast('El pago fue exitoso pero hubo un error guardando el pedido. Contacta soporte.', 'warning');\n        }\n    };\n\n    // Effect para inicializar el Brick cuando se selecciona MP\n    useEffect(() => {\n        const isCheckoutView = view === 'checkout';\n        const isMP = checkoutData.paymentChoice === 'Tarjeta';\n\n        if (isCheckoutView && isMP && finalTotal > 0 && currentUser && cart.length > 0) {\n            // Validar que el usuario tenga datos completos antes de mostrar formulario de pago\n            if (!currentUser.name || !currentUser.phone || !currentUser.dni) {\n                showToast(\"Por favor complet√° tus datos personales antes de pagar con tarjeta.\", \"warning\");\n                setView('profile');\n                return;\n            }\n\n            // Peque√±o delay para asegurar que el DOM est√° listo\n            const timer = setTimeout(() => {\n                const container = document.getElementById('cardPaymentBrick_container');\n                if (container) {\n                    initializeCardPaymentBrick();\n                }\n            }, 300);\n            return () => clearTimeout(timer);\n        } else if (mpBrickController && (!isCheckoutView || !isMP)) {\n            // Limpiar brick si se cambia de m√©todo de pago O de vista\n            console.log('Sweep: Limpiando Brick por cambio de vista o m√©todo.');\n            try {\n                mpBrickController.unmount();\n            } catch (e) { }\n            setMpBrickController(null);\n            isInitializingBrick.current = false;\n        }\n    }, [checkoutData.paymentChoice, finalTotal, currentUser, cart.length, view]);\n\n    // --- FUNCIONES DE ADMINISTRACI√ìN ---\n\n    // 6. Guardar Producto\n    const saveProductFn = async () => {\n        // Validaciones b√°sicas\n        if (!newProduct.name) return showToast(\"El nombre del producto es obligatorio.\", \"warning\");\n\n        // --- PRODUCT LIMIT CHECK (SUBSCRIPTION) ---\n        const MAX_PRODUCTS_ENTREPRENEUR = 30;\n        const MAX_PRODUCTS_BUSINESS = 50;\n\n        // Check limits only when creating new product\n        if (!editingId) {\n            const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n            const isEntrepreneur = currentPlan === 'entrepreneur';\n            const isBusiness = currentPlan === 'business';\n\n            if (isEntrepreneur && products.length >= MAX_PRODUCTS_ENTREPRENEUR) {\n                return showToast(`Has alcanzado el l√≠mite de ${MAX_PRODUCTS_ENTREPRENEUR} productos del Plan Emprendedor. ¬°Mejora tu plan para seguir creciendo!`, \"error\");\n            }\n\n            if (isBusiness && products.length >= MAX_PRODUCTS_BUSINESS) {\n                return showToast(`Has alcanzado el l√≠mite de ${MAX_PRODUCTS_BUSINESS} productos del Plan Negocio. ¬°P√°sate a Premium para productos ilimitados!`, \"error\");\n            }\n        }\n\n        if (!newProduct.basePrice || Number(newProduct.basePrice) <= 0) return showToast(\"El precio debe ser mayor a 0.\", \"warning\");\n\n        // Validaci√≥n de categor√≠as (array)\n        const categories = Array.isArray(newProduct.categories) ? newProduct.categories :\n            (newProduct.category ? [newProduct.category] : []);\n        if (categories.length === 0) return showToast(\"Selecciona al menos una categor√≠a.\", \"warning\");\n\n        const productData = {\n            ...newProduct,\n            categories: categories, // Guardar como array\n            basePrice: Number(newProduct.basePrice) || 0,\n            purchasePrice: Number(newProduct.purchasePrice || 0),\n            stock: Number(newProduct.stock) || 0,\n            discount: Number(newProduct.discount || 0),\n            image: newProduct.image || 'https://via.placeholder.com/150',\n            lastUpdated: new Date().toISOString()\n        };\n\n        // Eliminar propiedad legacy para evitar error de \"undefined\" en Firestore\n        if ('category' in productData) delete productData.category;\n\n        try {\n            if (editingId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', editingId), productData);\n                showToast(\"Producto actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), {\n                    ...productData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Producto creado correctamente.\", \"success\");\n            }\n            // Resetear formulario\n            setNewProduct({ name: '', basePrice: '', purchasePrice: '', stock: '', categories: [], image: '', description: '', discount: 0 });\n            setEditingId(null);\n            setShowProductForm(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar el producto.\", \"error\");\n        }\n    };\n\n    // 6.4. Image Upload Handler (Base64 for Vercel)\n    // 6.4. Image Upload Handler (Optimized with Canvas Resize)\n    const handleImageUpload = (e, setTargetState, imageField = 'image', maxWidth = 800) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n            return showToast(\"Por favor selecciona una imagen v√°lida.\", \"warning\");\n        }\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            const img = new Image();\n            img.onload = () => {\n                const canvas = document.createElement('canvas');\n                const MAX_WIDTH = maxWidth;\n                const MAX_HEIGHT = maxWidth;\n                let width = img.width;\n                let height = img.height;\n\n                if (width > height) {\n                    if (width > MAX_WIDTH) {\n                        height *= MAX_WIDTH / width;\n                        width = MAX_WIDTH;\n                    }\n                } else {\n                    if (height > MAX_HEIGHT) {\n                        width *= MAX_HEIGHT / height;\n                        height = MAX_HEIGHT;\n                    }\n                }\n\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(img, 0, 0, width, height);\n\n                const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n                setTargetState(prev => ({ ...prev, [imageField]: dataUrl }));\n                showToast(\"Imagen optimizada y cargada.\", \"success\");\n            };\n            img.src = event.target.result;\n        };\n        reader.readAsDataURL(file);\n    };\n\n    const resetHomeBannerForm = () => {\n        setEditingHomeBannerId(null);\n        setNewHomeBanner({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    };\n\n    const editHomeBannerFn = (banner) => {\n        if (!banner) return;\n        setEditingHomeBannerId(banner.id);\n        const targetType = banner.targetType || (banner.promoId ? 'promo' : banner.productId ? 'product' : 'none');\n        const targetId = banner.targetId || banner.promoId || banner.productId || '';\n        setNewHomeBanner({\n            imageUrl: banner.imageUrl || '',\n            targetType,\n            targetId,\n            enabled: banner.enabled !== false,\n            order: Number.isFinite(Number(banner.order)) ? Number(banner.order) : 0,\n        });\n    };\n\n    const saveHomeBannerFn = async () => {\n        if (!newHomeBanner?.imageUrl) return showToast(\"Sub√≠ una imagen para el banner.\", \"warning\");\n        const targetType = newHomeBanner?.targetType || 'none';\n        const targetId = newHomeBanner?.targetId || '';\n        if (targetType !== 'none' && !targetId) return showToast(\"Seleccion√° el destino del banner.\", \"warning\");\n\n        const orderValue = Number.isFinite(Number(newHomeBanner.order)) ? Number(newHomeBanner.order) : 0;\n        const payload = {\n            imageUrl: newHomeBanner.imageUrl,\n            enabled: newHomeBanner.enabled !== false,\n            order: orderValue,\n            targetType,\n            targetId: targetType === 'none' ? '' : String(targetId),\n            productId: targetType === 'product' ? String(targetId) : '',\n            promoId: targetType === 'promo' ? String(targetId) : '',\n        };\n\n        try {\n            if (editingHomeBannerId) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', editingHomeBannerId), payload);\n                showToast(\"Banner actualizado.\", \"success\");\n            } else {\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'), {\n                    ...payload,\n                    createdAt: new Date().toISOString(),\n                });\n                showToast(\"Banner creado.\", \"success\");\n            }\n            resetHomeBannerForm();\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error guardando banner: \" + (e?.message || \"error\"), \"error\");\n        }\n    };\n\n    const deleteHomeBannerFn = (banner) => {\n        if (!banner?.id) return;\n        openConfirm(\"Eliminar Banner\", \"¬øEliminar este banner del carrusel?\", async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', banner.id));\n                showToast(\"Banner eliminado.\", \"success\");\n                if (editingHomeBannerId === banner.id) resetHomeBannerForm();\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error eliminando banner: \" + (e?.message || \"error\"), \"error\");\n            }\n        });\n    };\n\n    // 6.5. Eliminar Producto\n    const deleteProductFn = (product) => {\n        openConfirm(\"Eliminar Producto\", `¬øEst√°s seguro de eliminar el producto \"${product.name}\"?`, async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id));\n                showToast(\"Producto eliminado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar el producto.\", \"error\");\n            }\n        });\n    };\n\n    // 6.6. Venta Manual (Fuera de P√°gina)\n    const handleManualSale = (product) => {\n        if (product.stock <= 0) return showToast(\"No hay stock para vender.\", \"warning\");\n\n        openConfirm(\"Venta Manual\", `¬øRegistrar venta manual de 1 unidad de \"${product.name}\"?`, async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-1)\n                });\n                showToast(\"Venta registrada. Stock actualizado.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        });\n    };\n\n    // 6.7. Gesti√≥n de Pedidos (Finalizar/Eliminar)\n    const finalizeOrderFn = (orderId) => {\n        openConfirm(\"Finalizar Pedido\", \"¬øMarcar este pedido como REALIZADO/ENTREGADO?\", async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId), {\n                    status: 'Realizado',\n                    lastUpdate: new Date().toISOString()\n                });\n                showToast(\"Pedido finalizado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al finalizar pedido.\", \"error\");\n            }\n        });\n    };\n\n    const deleteOrderFn = (orderId) => {\n        openConfirm(\"Eliminar Pedido\", \"¬øEliminar este pedido permanentemente? El stock de los productos ser√° devuelto al inventario.\", async () => {\n            try {\n                // 1. Obtener datos del pedido antes de eliminar\n                const orderRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId);\n                const orderSnap = await getDoc(orderRef);\n\n                if (!orderSnap.exists()) {\n                    throw new Error(\"El pedido no existe o ya fue eliminado.\");\n                }\n\n                const orderData = orderSnap.data();\n\n                // 2. Devolver Stock (Iterar items)\n                if (orderData.items && Array.isArray(orderData.items)) {\n                    for (const item of orderData.items) {\n                        if (item.productId && item.quantity > 0) {\n                            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                            try {\n                                await updateDoc(productRef, {\n                                    stock: increment(item.quantity)\n                                });\n                            } catch (ignore) {\n                                // Si el producto ya no existe, ignoramos el error para permitir borrar el pedido\n                                console.warn(`Producto ${item.productId} no encontrado, no se restaur√≥ stock.`);\n                            }\n                        }\n                    }\n                }\n\n                // 3. Eliminar Documento\n                await deleteDoc(orderRef);\n                showToast(\"Pedido eliminado y stock restaurado exitosamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar pedido: \" + e.message, \"error\");\n            }\n        });\n    };\n\n    // 7. Guardar Cup√≥n (COMPLEJO y DETALLADO)\n    const saveCouponFn = async () => {\n        // Validaciones exhaustivas\n        if (!newCoupon.code || newCoupon.code.length < 3) return showToast(\"El c√≥digo del cup√≥n debe tener al menos 3 caracteres.\", \"warning\");\n        if (!newCoupon.value || Number(newCoupon.value) <= 0) return showToast(\"El valor del descuento debe ser mayor a 0.\", \"warning\");\n\n        if (newCoupon.type === 'percentage' && Number(newCoupon.value) > 100) return showToast(\"El porcentaje no puede ser mayor a 100%.\", \"warning\");\n\n        if (newCoupon.targetType === 'specific_user' && !newCoupon.targetUser.includes('@')) {\n            return showToast(\"Si el cup√≥n es para un usuario espec√≠fico, ingresa un email v√°lido.\", \"warning\");\n        }\n\n        try {\n            const couponData = {\n                ...newCoupon,\n                code: newCoupon.code.toUpperCase().trim(),\n                value: Number(newCoupon.value),\n                minPurchase: Number(newCoupon.minPurchase || 0),\n                maxDiscount: Number(newCoupon.maxDiscount || 0),\n                usageLimit: Number(newCoupon.usageLimit || 0),\n                perUserLimit: Number(newCoupon.perUserLimit || 1),\n                targetUser: newCoupon.targetType === 'global' ? '' : newCoupon.targetUser,\n                createdAt: new Date().toISOString(),\n                usedBy: [] // Inicializar array de usos\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'), couponData);\n\n            // Resetear formulario completamente\n            setNewCoupon({\n                code: '', type: 'percentage', value: 0, minPurchase: 0, maxDiscount: 0,\n                expirationDate: '', targetType: 'global', targetUser: '', usageLimit: '', perUserLimit: 1\n            });\n            showToast(\"Cup√≥n de descuento creado exitosamente.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear el cup√≥n.\", \"error\");\n        }\n    };\n\n    // 8. Guardar Proveedor (Crear / Editar)\n    const saveSupplierFn = async () => {\n        if (!newSupplier.name) return showToast(\"El nombre de la empresa es obligatorio.\", \"warning\");\n\n        // Validaci√≥n: Debe tener al menos UN m√©todo de contacto\n        if (!newSupplier.phone && !newSupplier.ig) {\n            return showToast(\"Debes ingresar al menos un m√©todo de contacto (Tel√©fono o Instagram).\", \"warning\");\n        }\n\n        const supplierData = {\n            ...newSupplier,\n            associatedProducts: newSupplier.associatedProducts || [],\n            lastUpdated: new Date().toISOString()\n        };\n\n        try {\n            if (editingSupplierId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', editingSupplierId), supplierData);\n                showToast(\"Proveedor actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), {\n                    ...supplierData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Proveedor registrado correctamente.\", \"success\");\n            }\n\n            setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n            setEditingSupplierId(null);\n            setShowSupplierModal(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar proveedor.\", \"error\");\n        }\n    };\n\n    // 9. Configuraci√≥n y Equipo (Settings)\n\n\n    // 10. Gesti√≥n de Compras (Editar/Eliminar con l√≥gica de Stock)\n    const deletePurchaseFn = (purchase) => {\n        openConfirm(\"Eliminar Compra\", `¬øEliminar registro de compra? Se descontar√°n ${purchase.quantity} unidades del stock del producto.`, async () => {\n            try {\n                // 1. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', purchase.productId), {\n                    stock: increment(-purchase.quantity)\n                });\n                // 2. Eliminar Compra\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', purchase.id));\n                showToast(\"Compra eliminada y stock revertido.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar compra.\", \"error\");\n            }\n        });\n    };\n\n    const updatePurchaseFn = async (pId, oldData, newData) => {\n        const qtyDiff = (newData.quantity || 0) - (oldData.quantity || 0);\n\n        try {\n            // 1. Actualizar Stock si cambi√≥ la cantidad\n            if (qtyDiff !== 0) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', oldData.productId), {\n                    stock: increment(qtyDiff)\n                });\n            }\n            // 2. Actualizar Registro\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', pId), {\n                quantity: newData.quantity,\n                cost: newData.cost,\n                supplierId: newData.supplierId\n            });\n            setEditingPurchase(null);\n            showToast(\"Compra actualizada y stock ajustado.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al actualizar la compra.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA GESTI√ìN DE CATEGOR√çAS ---\n    const createCategoryFn = async () => {\n        if (!newCategory.trim()) return showToast(\"Ingresa un nombre para la categor√≠a.\", \"warning\");\n\n        try {\n            const updatedCategories = [...(settings.categories || []), newCategory.trim()];\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), {\n                categories: updatedCategories\n            });\n            setNewCategory('');\n            setShowCategoryModal(false);\n            showToast(`Categor√≠a \"${newCategory}\" creada.`, \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear categor√≠a.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA CARRITO DE COMPRAS (PEDIDOS MAYORISTAS) ---\n    const addToPurchaseCart = (productId, quantity, supplierId) => {\n        if (!productId || !supplierId || quantity <= 0) {\n            return showToast(\"Completa todos los campos.\", \"warning\");\n        }\n\n        const product = products.find(p => p.id === productId);\n        if (!product) return showToast(\"Producto no encontrado.\", \"error\");\n\n        const productPrice = product.purchasePrice || product.basePrice || 0;\n        const cost = productPrice * quantity;\n\n        const existingIndex = purchaseCart.findIndex(item => item.productId === productId);\n\n        if (existingIndex >= 0) {\n            // Actualizar cantidad si ya existe\n            const updated = [...purchaseCart];\n            updated[existingIndex].quantity += quantity;\n            updated[existingIndex].cost = (product.purchasePrice || product.basePrice || 0) * updated[existingIndex].quantity;\n            setPurchaseCart(updated);\n            showToast(`Cantidad actualizada: ${product.name}`, \"success\");\n        } else {\n            // Agregar nuevo item\n            setPurchaseCart([...purchaseCart, {\n                productId,\n                productName: product.name,\n                productImage: product.image,\n                quantity,\n                unitPrice: productPrice,\n                cost,\n                supplierId\n            }]);\n            showToast(`Agregado al pedido: ${product.name}`, \"success\");\n        }\n\n        // Resetear formulario\n        setNewPurchase({ productId: '', supplierId: supplierId, quantity: 1, cost: 0, isNewProduct: false });\n    };\n\n    const removeFromPurchaseCart = (index) => {\n        const updated = purchaseCart.filter((_, i) => i !== index);\n        setPurchaseCart(updated);\n        showToast(\"Producto eliminado del pedido.\", \"info\");\n    };\n\n    const updatePurchaseCartItem = (index, newQuantity) => {\n        const updated = [...purchaseCart];\n        updated[index].quantity = newQuantity;\n        updated[index].cost = updated[index].unitPrice * newQuantity;\n        setPurchaseCart(updated);\n    };\n\n    const finalizePurchaseOrder = async () => {\n        if (purchaseCart.length === 0) {\n            return showToast(\"El carrito de compras est√° vac√≠o.\", \"warning\");\n        }\n\n        try {\n            const batch = writeBatch(db);\n            const batchId = `BATCH - ${Date.now()}`;\n            const timestamp = new Date().toISOString();\n\n            // Registrar cada compra y actualizar stock en Lote (Batch)\n            for (const item of purchaseCart) {\n                // 1. Crear Referencia para Nueva Compra\n                const newPurchaseRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'));\n                batch.set(newPurchaseRef, {\n                    productId: item.productId,\n                    supplierId: item.supplierId,\n                    quantity: item.quantity,\n                    cost: item.cost,\n                    batchId: batchId,\n                    date: timestamp\n                });\n\n                // 2. Actualizar Stock del Producto (Fixing NaN issues on the fly)\n                const product = products.find(p => p.id === item.productId);\n                const currentStock = isNaN(Number(product?.stock)) ? 0 : Number(product.stock);\n                const newStock = currentStock + item.quantity;\n\n                const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                batch.update(productRef, {\n                    stock: newStock\n                });\n            }\n\n            await batch.commit();\n\n            setPurchaseCart([]);\n            showToast(`Pedido finalizado: ${purchaseCart.length} productos registrados.`, \"success\");\n        } catch (e) {\n            console.error(\"Error in batch purchase:\", e);\n            showToast(\"Error al finalizar el pedido: \" + e.message, \"error\");\n        }\n    };\n\n    // --- C√ÅLCULOS DEL DASHBOARD (CENTRALIZADOS) ---\n    const dashboardMetrics = useMemo(() => {\n        // 1. Demanda en Vivo y Favoritos (Trending) + VENTAS REALES\n        const productStats = {}; // { id: { cart: 0, fav: 0, sales: 0, total: 0 } }\n\n        // Helper para inicializar stats\n        const initStats = (id) => {\n            if (!productStats[id]) productStats[id] = { cart: 0, fav: 0, sales: 0, total: 0 };\n        };\n\n        // Contar apariciones en Carritos Activos (LiveCarts)\n        liveCarts.forEach(cart => {\n            if (cart.items) {\n                cart.items.forEach(item => {\n                    initStats(item.productId);\n                    productStats[item.productId].cart += 1;\n                    productStats[item.productId].total += 1;\n                });\n            }\n        });\n\n        // Contar apariciones en Favoritos de Usuarios\n        users.forEach(u => {\n            if (u.favorites) {\n                u.favorites.forEach(pid => {\n                    initStats(pid);\n                    productStats[pid].fav += 1;\n                    productStats[pid].total += 1;\n                });\n            }\n        });\n\n        // 2. Finanzas y Ventas Confirmadas (Updated: Solo contar \"Realizado\")\n        const validOrders = orders.filter(o => o.status === 'Realizado');\n        const revenue = validOrders.reduce((acc, o) => acc + (o.total || 0), 0);\n        const expensesTotal = expenses?.reduce((acc, e) => acc + (e.amount || 0), 0) || 0;\n        const purchasesTotal = purchases?.reduce((acc, p) => acc + (p.cost || 0), 0) || 0;\n        const netIncome = revenue - expensesTotal - purchasesTotal;\n\n        // 3. Producto Estrella y Menos Vendido (Ventas reales confirmadas)\n        const salesCount = {}; // { productId: quantity }\n        const productMetadata = {}; // { productId: { name, image } } -> Fallback para productos eliminados\n\n        validOrders.forEach(o => {\n            if (o.items && Array.isArray(o.items)) {\n                o.items.forEach(i => {\n                    const pid = i.productId;\n                    const qty = Number(i.quantity) || 0;\n\n                    // Acumular Ventas\n                    salesCount[pid] = (salesCount[pid] || 0) + qty;\n\n                    // Guardar Metadata (Nombre/Imagen) del item por si el producto ya no existe\n                    if (!productMetadata[pid]) {\n                        productMetadata[pid] = { name: i.title || i.name || 'Producto Desconocido', image: i.image };\n                    }\n\n                    // Sumar a Estad√≠sticas de Tendencia (Peso x5 para ventas reales)\n                    initStats(pid);\n                    productStats[pid].sales += qty;\n                    productStats[pid].total += (qty * 5);\n                });\n            }\n        });\n\n        // Ordenar productos por \"calor\" (total de inter√©s)\n        const trendingProducts = Object.entries(productStats)\n            .map(([id, stats]) => {\n                // Intentar buscar en productos vivos, sino usar metadata del pedido\n                const liveProd = products.find(p => p.id === id);\n                const meta = productMetadata[id] || {};\n\n                // Si el producto no existe en el inventario actual (fue eliminado), no mostrarlo en tendencias\n                if (!liveProd) return null;\n\n                return {\n                    id: id,\n                    name: liveProd.name,\n                    image: liveProd.image,\n                    stock: liveProd.stock,\n                    stats\n                };\n            })\n            .filter(Boolean)\n            .sort((a, b) => b.stats.total - a.stats.total)\n            .slice(0, 5); // Top 5\n\n        // Estrella (M√°s Vendido)\n        let starProductId = null;\n        let maxSales = -1;\n        Object.entries(salesCount).forEach(([id, count]) => {\n            if (count > maxSales) {\n                maxSales = count;\n                starProductId = id;\n            }\n        });\n\n        // Resolver objeto completo para Estrella\n        let starProduct = null;\n        if (starProductId) {\n            const liveStar = products.find(p => p.id === starProductId);\n            const meta = productMetadata[starProductId];\n            if (liveStar || meta) {\n                starProduct = {\n                    id: starProductId,\n                    name: liveStar ? liveStar.name : meta.name,\n                    image: liveStar ? liveStar.image : meta.image,\n                    sales: maxSales,\n                    stock: liveStar ? liveStar.stock : 0\n                };\n            }\n        }\n\n        // Menos Vendido (Peor Producto) - Buscar el m√≠nimo entre TODOS los productos activos\n        // Nota: Solo consideramos productos que A√öN existen en inventario para \"Menos Vendido\"\n        let leastSoldProductId = null;\n        let minSales = Infinity;\n\n        products.forEach(p => {\n            const count = salesCount[p.id] || 0;\n            if (count < minSales) {\n                minSales = count;\n                leastSoldProductId = p.id;\n            }\n        });\n        const leastSoldProduct = leastSoldProductId ? products.find(p => p.id === leastSoldProductId) : null;\n\n        // 4. Anal√≠tica Temporal (Timeline)\n        const timeline = { daily: {}, monthly: {}, yearly: {} };\n        const categoryStats = {}; // { catName: { revenue: 0, items: 0 } }\n\n        validOrders.forEach(o => {\n            const d = new Date(o.date);\n            const dayKey = d.toISOString().split('T')[0]; // YYYY-MM-DD\n            const monthKey = d.toISOString().slice(0, 7); // YYYY-MM\n            const yearKey = d.getFullYear().toString(); // YYYY\n\n            const agg = (obj, key, amount) => {\n                if (!obj[key]) obj[key] = { date: key, revenue: 0, orders: 0 };\n                obj[key].revenue += amount;\n                obj[key].orders += 1;\n            };\n\n            agg(timeline.daily, dayKey, o.total);\n            agg(timeline.monthly, monthKey, o.total);\n            agg(timeline.yearly, yearKey, o.total);\n\n            // Sales By Category\n            if (o.items) {\n                o.items.forEach(item => {\n                    const prod = products.find(p => p.id === item.productId || p.id === item.id);\n                    const cat = prod ? prod.category : 'Otros';\n                    if (!categoryStats[cat]) categoryStats[cat] = { name: cat, revenue: 0, items: 0, percentage: 0 };\n                    categoryStats[cat].revenue += (item.unit_price * item.quantity);\n                    categoryStats[cat].items += item.quantity;\n                });\n            }\n        });\n\n        const analytics = {\n            daily: Object.values(timeline.daily).sort((a, b) => a.date.localeCompare(b.date)),\n            monthly: Object.values(timeline.monthly).sort((a, b) => a.date.localeCompare(b.date)),\n            yearly: Object.values(timeline.yearly).sort((a, b) => a.date.localeCompare(b.date))\n        };\n\n        // Format salesByCategory\n        const totalSalesVolume = Object.values(categoryStats).reduce((acc, c) => acc + c.items, 0);\n        const salesByCategory = Object.values(categoryStats)\n            .map(c => ({\n                ...c,\n                percentage: totalSalesVolume > 0 ? Math.round((c.items / totalSalesVolume) * 100) : 0\n            }))\n            .sort((a, b) => b.items - a.items);\n\n        // 5. Low Stock Alerts\n        const lowStockThreshold = settings?.lowStockThreshold || 5;\n        const lowStockProducts = products.filter(p => !p.promoItems && (Number(p.stock) <= lowStockThreshold));\n\n        // 6. Recent Activity\n        const recentActivity = [...orders].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);\n\n        // 7. Financial Transactions (Ledger)\n        const transactions = [\n            ...validOrders.map(o => ({ id: o.id || o.orderId, type: 'income', category: 'Venta', date: o.date, amount: o.total, description: `Orden #${o.orderId}`, status: o.status })),\n            ...expenses.map(e => ({ id: e.id, type: 'expense', category: e.category || 'Gasto', date: e.date, amount: e.amount, description: e.description, status: 'Pagado' })),\n            ...(purchases || []).map(p => ({ id: p.id, type: 'expense', category: 'Compra Stock', date: p.date, amount: p.cost, description: `Prov: ${p.supplier || 'General'}`, status: 'Completado' })),\n            ...(investments || []).map(i => ({ id: i.id, type: 'income', category: 'Inversi√≥n', date: i.date, amount: i.amount, description: `Inv: ${i.investor}`, status: 'Recibido' }))\n        ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 100);\n\n        return {\n            revenue,\n            expensesTotal,\n            purchasesTotal,\n            netIncome,\n            trendingProducts,\n            starProduct,\n            leastSoldProduct,\n            salesCount,\n            analytics,\n            salesByCategory,\n            lowStockProducts,\n            recentActivity,\n            transactions,\n            totalOrders: orders.length,\n            totalUsers: users.length\n        };\n    }, [orders, expenses, purchases, products, liveCarts, users, settings]);\n\n    // ‚ö†Ô∏è [PAUSA POR SEGURIDAD] - El c√≥digo contin√∫a con la Interfaz Gr√°fica completa y detallada. Por favor escribe \"continuar\".\n    // --- COMPONENTES UI: MODALES DETALLADOS ---\n\n    // Modal de Detalles de Pedido (Visor Completo)\n    const OrderDetailsModal = ({ order, onClose }) => {\n        if (!order) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\">\n                <div className=\"glass rounded-[2rem] w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] shadow-2xl border border-slate-800 relative\">\n                    {/* Header del Modal */}\n                    <div className=\"p-8 border-b border-slate-800 flex justify-between items-center bg-slate-900/50\">\n                        <div>\n                            <h3 className=\"text-2xl font-black text-white flex items-center gap-2 neon-text\">\n                                DETALLE DE PEDIDO <span className=\"text-orange-400\">#{order.orderId}</span>\n                            </h3>\n                            <div className=\"flex items-center gap-4 mt-2\">\n                                <span className=\"text-slate-400 text-xs flex items-center gap-1 font-bold tracking-wider\">\n                                    <Clock className=\"w-3 h-3\" /> {new Date(order.date).toLocaleString()}\n                                </span>\n                                <span className={`text-[10px] px-2 py-0.5 rounded border uppercase font-black tracking-widest ${order.status === 'Realizado' ? 'bg-green-900/30 text-green-400 border-green-500/30' : 'bg-yellow-900/30 text-yellow-400 border-yellow-500/30'}`}>\n                                    {order.status}\n                                </span>\n                            </div>\n                        </div>\n                        <button onClick={onClose} className=\"p-3 bg-slate-800 rounded-full hover:bg-slate-700 hover:text-white transition shadow-lg border border-slate-700\">\n                            <X className=\"w-5 h-5 text-slate-400\" />\n                        </button>\n                    </div>\n\n                    {/* Contenido Scrollable */}\n                    <div className=\"p-8 overflow-y-auto space-y-8 custom-scrollbar bg-[#050505]\">\n\n                        {/* Estado Visual */}\n                        <div className=\"flex justify-between items-center bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-inner\">\n                            <div className=\"flex items-center gap-4\">\n                                <div className={`p-4 rounded-full shadow-lg ${order.status === 'Realizado' ? 'bg-green-500/20 text-green-400 shadow-[0_0_15px_rgba(34,197,94,0.2)]' : 'bg-yellow-500/20 text-yellow-400 shadow-[0_0_15px_rgba(234,179,8,0.2)]'}`}>\n                                    {order.status === 'Realizado' ? <CheckCircle className=\"w-8 h-8\" /> : <Clock className=\"w-8 h-8\" />}\n                                </div>\n                                <div>\n                                    <p className=\"text-xs text-slate-500 uppercase font-bold tracking-widest mb-1\">Estado Actual</p>\n                                    <p className={`text-xl font-black ${order.status === 'Realizado' ? 'text-green-400' : 'text-yellow-400'}`}>\n                                        {order.status === 'Realizado' ? 'Entregado / Finalizado' : 'Pendiente de Pago/Env√≠o'}\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Columnas de Info */}\n                        <div className=\"grid md:grid-cols-2 gap-6\">\n                            {/* Cliente */}\n                            <div className=\"bg-slate-900/30 p-6 rounded-2xl border border-slate-800 hover:border-slate-700 transition\">\n                                <h4 className=\"text-slate-500 text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b border-slate-800 pb-2\">\n                                    <User className=\"w-4 h-4\" /> Datos del Cliente\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className=\"text-white font-bold text-lg\">{order.customer.name}</p>\n                                    <div className=\"space-y-1\">\n                                        <p className=\"text-slate-400 text-sm flex justify-between border-b border-dashed border-slate-800/50 pb-1\">\n                                            <span>Email:</span> <span className=\"text-white font-medium\">{order.customer.email}</span>\n                                        </p>\n                                        <p className=\"text-slate-400 text-sm flex justify-between border-b border-dashed border-slate-800/50 pb-1\">\n                                            <span>Tel√©fono:</span> <span className=\"text-white font-medium\">{order.customer.phone || '-'}</span>\n                                        </p>\n                                        <p className=\"text-slate-400 text-sm flex justify-between\">\n                                            <span>DNI:</span> <span className=\"text-white font-medium\">{order.customer.dni || '-'}</span>\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Env√≠o */}\n                            <div className=\"bg-slate-900/30 p-6 rounded-2xl border border-slate-800 hover:border-slate-700 transition\">\n                                <h4 className=\"text-slate-500 text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b border-slate-800 pb-2\">\n                                    <Truck className=\"w-4 h-4\" /> Datos de Entrega\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className=\"text-white font-medium text-sm leading-relaxed min-h-[3rem]\">\n                                        {order.shippingAddress || 'Retiro en sucursal'}\n                                    </p>\n                                    <div className=\"pt-2 mt-2 border-t border-slate-800/50\">\n                                        <p className=\"text-slate-400 text-xs uppercase font-bold mb-1\">M√©todo de Pago</p>\n                                        <div className=\"flex items-center gap-2\">\n                                            <CreditCard className=\"w-4 h-4 text-orange-400\" />\n                                            <p className=\"text-orange-400 font-black text-sm uppercase\">{order.paymentMethod}</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Lista de Productos */}\n                        <div>\n                            <h4 className=\"text-slate-500 text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b border-slate-800 pb-2\">\n                                <Package className=\"w-4 h-4\" /> Productos ({order.items.length})\n                            </h4>\n                            <div className=\"space-y-3\">\n                                {order.items.map((item, idx) => (\n                                    <div key={idx} className=\"flex justify-between items-center bg-slate-900/40 p-4 rounded-xl border border-slate-800 hover:border-orange-900/30 transition group\">\n                                        <div className=\"flex items-center gap-4\">\n                                            <div className=\"bg-white w-12 h-12 flex items-center justify-center rounded-lg p-1 shadow-md group-hover:scale-105 transition\">\n                                                {item.image ? <img src={item.image} className=\"w-full h-full object-contain\" /> : <Package className=\"text-black\" />}\n                                            </div>\n                                            <div>\n                                                <p className=\"text-white font-bold text-sm\">{item.title}</p>\n                                                <p className=\"text-slate-500 text-xs flex items-center gap-2\">\n                                                    <span className=\"bg-slate-800 text-slate-300 px-1.5 rounded text-[10px] font-bold\">x{item.quantity}</span>\n                                                    <span>${item.unit_price.toLocaleString()} c/u</span>\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <span className=\"text-white font-mono font-bold text-lg tracking-tight\">\n                                            ${(item.unit_price * item.quantity).toLocaleString()}\n                                        </span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Resumen Financiero */}\n                        <div className=\"bg-slate-900 p-6 rounded-2xl border border-slate-800 space-y-3 shadow-lg\">\n                            <div className=\"flex justify-between text-slate-400 text-sm font-medium\">\n                                <span>Subtotal Productos</span>\n                                <span>${(order.subtotal || order.total).toLocaleString()}</span>\n                            </div>\n\n                            {order.discount > 0 && (\n                                <div className=\"flex justify-between text-green-400 text-sm font-bold bg-green-900/10 p-2 rounded-lg border border-green-900/30 dashed-border\">\n                                    <span className=\"flex items-center gap-2\">\n                                        <Ticket className=\"w-3 h-3\" /> Descuento ({order.discountCode || 'Cup√≥n'})\n                                    </span>\n                                    <span>-${order.discount.toLocaleString()}</span>\n                                </div>\n                            )}\n\n                            <div className=\"flex justify-between items-center mt-4 pt-4 border-t border-slate-800 border-dashed\">\n                                <span className=\"text-white font-bold text-lg\">Total Abonado</span>\n                                <span className=\"text-3xl font-black text-orange-400 neon-text tracking-tighter\">\n                                    ${order.total.toLocaleString()}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal Selector de Cupones (Visualmente Rico)\n    const CouponSelectorModal = () => {\n        if (!showCouponModal) return null;\n\n        // Filtrado de cupones v√°lidos\n        const availableCoupons = coupons.filter(c => {\n            const isNotExpired = !c.expirationDate || new Date(c.expirationDate) > new Date();\n            const isUserTarget = !c.targetUser || (currentUser && c.targetUser === currentUser.email);\n            const isGlobal = c.targetType === 'global';\n            const usedCount = c.usedBy ? c.usedBy.length : 0;\n            const notExhausted = !c.usageLimit || usedCount < c.usageLimit;\n            const userNotUsed = currentUser && c.usedBy && !c.usedBy.includes(currentUser.id);\n\n            return isNotExpired && (isUserTarget || isGlobal) && notExhausted && userNotUsed;\n        });\n\n        return (\n            <div className=\"fixed inset-0 z-[150] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\">\n                <div className=\"glass rounded-[2rem] w-full max-w-lg overflow-hidden relative shadow-2xl border border-purple-500/20 bg-[#050505]\">\n                    <button onClick={() => setShowCouponModal(false)} className=\"absolute top-6 right-6 p-2 bg-slate-900 rounded-full text-slate-400 hover:text-white transition z-10 hover:bg-slate-800\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className=\"p-8 bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-b border-slate-800\">\n                        <h3 className=\"text-2xl font-black text-white mb-2 flex items-center gap-3\">\n                            <div className=\"bg-purple-900/20 p-2 rounded-lg border border-purple-500/30\">\n                                <Gift className=\"w-6 h-6 text-purple-400\" />\n                            </div>\n                            Mis Beneficios\n                        </h3>\n                        <p className=\"text-slate-400 text-sm\">Selecciona un cup√≥n para aplicar el descuento a tu compra.</p>\n                    </div>\n\n                    <div className=\"p-8 space-y-4 max-h-[50vh] overflow-y-auto custom-scrollbar bg-[#050505]\">\n                        {availableCoupons.length === 0 ? (\n                            <div className=\"text-center py-12 border-2 border-dashed border-slate-800 rounded-2xl\">\n                                <Ticket className=\"w-16 h-16 text-slate-700 mx-auto mb-4\" />\n                                <p className=\"text-slate-400 font-bold text-lg\">No tienes cupones disponibles.</p>\n                                <p className=\"text-slate-600 text-sm mt-2\">Mantente atento a nuestras redes sociales.</p>\n                            </div>\n                        ) : availableCoupons.map(c => {\n                            const canApply = cartSubtotal >= (c.minPurchase || 0);\n                            return (\n                                <div key={c.id} onClick={() => canApply && selectCoupon(c)} className={`relative overflow-hidden rounded-2xl border transition-all duration-300 group ${canApply ? 'bg-slate-900 border-slate-700 hover:border-purple-500 cursor-pointer hover:shadow-[0_0_20px_rgba(168,85,247,0.15)] hover:scale-[1.02]' : 'bg-slate-900/50 border-slate-800 opacity-50 cursor-not-allowed grayscale'}`}>\n                                    {/* Decoraci√≥n lateral */}\n                                    <div className={`absolute top-0 left-0 w-2 h-full ${canApply ? 'bg-purple-500' : 'bg-slate-700'}`}></div>\n\n                                    <div className=\"p-5 pl-8 flex justify-between items-center\">\n                                        <div className=\"flex-1\">\n                                            <div className=\"flex items-center gap-3 mb-2\">\n                                                <span className=\"font-black text-xl text-white tracking-widest font-mono\">{c.code}</span>\n                                                <span className=\"text-[10px] bg-purple-900/30 text-purple-300 px-2 py-0.5 rounded border border-purple-500/30 uppercase font-bold\">\n                                                    {c.type === 'fixed' ? 'DESCUENTO FIJO' : 'PORCENTAJE'}\n                                                </span>\n                                            </div>\n                                            <p className=\"text-purple-400 font-bold text-sm\">\n                                                {c.type === 'fixed' ? `Ahorra $${c.value}` : `${c.value}% de Descuento`}\n                                                {c.maxDiscount > 0 && <span className=\"text-slate-500 text-xs ml-1 font-normal\">(Tope ${c.maxDiscount})</span>}\n                                            </p>\n\n                                            {/* Validaci√≥n visual de m√≠nimo de compra */}\n                                            {c.minPurchase > 0 && (\n                                                <p className={`text-xs mt-3 font-bold flex items-center gap-1 ${canApply ? 'text-slate-500' : 'text-red-400'}`}>\n                                                    {canApply ? <CheckCircle className=\"w-3 h-3\" /> : <AlertCircle className=\"w-3 h-3\" />}\n                                                    Compra m√≠nima: ${c.minPurchase}\n                                                </p>\n                                            )}\n                                        </div>\n\n                                        {/* Bot√≥n de acci√≥n */}\n                                        {canApply && (\n                                            <div className=\"w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white shadow-lg transform group-hover:scale-110 transition ml-4\">\n                                                <Plus className=\"w-6 h-6\" />\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n    // Modal de Detalle de Producto / Promo (Versi√≥n Premium)\n    const ProductDetailModal = () => {\n        if (!selectedProduct) return null;\n\n        const [qty, setQty] = useState(1);\n        const [added, setAdded] = useState(false);\n\n        const isPromo = selectedProduct.isPromo || !!selectedProduct.items;\n        const stockLimit = isPromo ? Number(selectedProduct.stock) : Number(selectedProduct.stock);\n\n        // Calcular stock real disponible restando lo que ya est√° en carrito\n        const cartItem = cart.find(item => item.product.id === selectedProduct.id);\n        const inCartQty = cartItem ? cartItem.quantity : 0;\n        const availableToAdd = Math.max(0, stockLimit - inCartQty);\n\n        const hasStock = stockLimit > 0;\n        const isMaxInCart = availableToAdd === 0 && hasStock;\n        const displayPrice = isPromo ? Number(selectedProduct.price || selectedProduct.basePrice) : calculateItemPrice(selectedProduct.basePrice, selectedProduct.discount);\n\n        const handleAdd = (e) => {\n            e.stopPropagation();\n            if (!hasStock) return;\n\n            const itemToAdd = isPromo ? {\n                id: selectedProduct.id,\n                name: selectedProduct.name,\n                basePrice: selectedProduct.price || selectedProduct.basePrice,\n                image: selectedProduct.image,\n                isPromo: true,\n                items: selectedProduct.items,\n                stock: selectedProduct.stock\n            } : selectedProduct;\n\n            manageCart(itemToAdd, qty);\n            setAdded(true);\n            setTimeout(() => setAdded(false), 2000);\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[20000] flex items-center justify-center bg-black/90 backdrop-blur-xl animate-fade-in p-4\" onClick={() => setSelectedProduct(null)}>\n                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] max-w-4xl w-full overflow-hidden flex flex-col md:flex-row shadow-2xl animate-scale-up relative h-full md:h-auto overflow-y-auto md:overflow-hidden\" onClick={e => e.stopPropagation()}>\n\n                    {/* Imagen con Zoom y Efectos */}\n                    <div className=\"md:w-1/2 h-72 md:h-[550px] bg-gradient-to-b from-slate-900 to-[#0a0a0a] p-8 md:p-12 flex items-center justify-center relative overflow-hidden group\">\n                        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/5 to-transparent opacity-50 group-hover:opacity-100 transition duration-500\"></div>\n                        <img\n                            src={selectedProduct.image}\n                            className=\"w-full h-full object-contain drop-shadow-[0_0_50px_rgba(255,255,255,0.15)] z-10 transition-transform duration-700 hover:scale-110\"\n                        />\n                        {/* Badges de Estado */}\n                        {!hasStock && (\n                            <div className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-[2px]\">\n                                <div className=\"border-4 border-red-500 p-4 -rotate-12 bg-black shadow-2xl\">\n                                    <span className=\"text-red-500 font-black text-2xl tracking-widest uppercase\">AGOTADO</span>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Panel de Informaci√≥n y Acci√≥n */}\n                    <div className=\"md:w-1/2 p-8 md:p-12 flex flex-col bg-[#080808]\">\n                        <div className=\"mb-8\">\n                            <span className=\"inline-block px-3 py-1 bg-orange-500/10 text-orange-400 text-[10px] font-black uppercase tracking-[0.2em] rounded mb-4 border border-orange-500/20\">\n                                {isPromo ? 'COMBOS & PROMOCIONES' : selectedProduct.category}\n                            </span>\n                            <h2 className=\"text-3xl md:text-4xl font-black text-white leading-[1.1] mb-6 neon-text-small\">{selectedProduct.name}</h2>\n                            <p className=\"text-slate-400 text-sm md:text-base leading-relaxed line-clamp-4\">\n                                {selectedProduct.description || ''}\n                            </p>\n                        </div>\n\n                        {/* Lista de productos para Promos */}\n                        {isPromo && selectedProduct.items && (\n                            <div className=\"mb-8 space-y-3 bg-purple-500/5 p-6 rounded-2xl border border-purple-500/20 shadow-inner\">\n                                <p className=\"text-[10px] uppercase font-black text-purple-400 tracking-[0.2em] flex items-center gap-2\">\n                                    <Sparkles className=\"w-3 h-3\" /> Este pack incluye:\n                                </p>\n                                <div className=\"space-y-2\">\n                                    {selectedProduct.items.map((item, idx) => {\n                                        const p = products.find(prod => prod.id === item.productId);\n                                        return (\n                                            <div key={idx} className=\"flex items-center gap-3 text-sm text-slate-300 group/item\">\n                                                <div className=\"w-6 h-6 rounded-lg bg-purple-500/20 flex items-center justify-center text-[10px] font-black text-purple-400 group-hover/item:bg-purple-500 group-hover/item:text-white transition\">\n                                                    {item.quantity}x\n                                                </div>\n                                                <span className=\"font-bold group-hover/item:text-white transition\">{p?.name || 'Producto del Packs'}</span>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Footer con Precio y Carrito */}\n                        <div className=\"mt-auto pt-8 border-t border-white/5 flex flex-col gap-6\">\n                            <div className=\"flex items-end justify-between\">\n                                <div className=\"flex flex-col\">\n                                    <span className=\"text-slate-500 text-xs font-bold uppercase tracking-wider mb-1\">Inversi√≥n Total</span>\n                                    <div className=\"flex items-center gap-3\">\n                                        {selectedProduct.discount > 0 && !isPromo && (\n                                            <span className=\"text-sm text-slate-600 line-through font-bold\">${(selectedProduct.basePrice * qty).toLocaleString()}</span>\n                                        )}\n                                        <span className=\"text-4xl font-black text-white tracking-tighter\">\n                                            ${(displayPrice * qty).toLocaleString()}\n                                        </span>\n                                    </div>\n                                </div>\n                                {selectedProduct.discount > 0 && !isPromo && (\n                                    <div className=\"px-3 py-1 bg-red-500 text-white rounded-lg text-[10px] font-black animate-pulse\">\n                                        -{selectedProduct.discount}% OFF\n                                    </div>\n                                )}\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                {/* Selector de Cantidad */}\n                                <div className=\"flex items-center gap-3 bg-slate-900 rounded-2xl p-2 border border-slate-800\">\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                                        disabled={qty <= 1}\n                                        className=\"w-12 h-12 flex items-center justify-center hover:bg-slate-800 rounded-xl text-slate-400 hover:text-white transition disabled:opacity-30 disabled:cursor-not-allowed\"\n                                    >\n                                        <Minus className=\"w-5 h-5\" />\n                                    </button>\n                                    <span className=\"text-xl font-bold w-8 text-center text-white font-mono\">{qty}</span>\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.min(availableToAdd, qty + 1)); }}\n                                        disabled={qty >= availableToAdd}\n                                        className=\"w-12 h-12 flex items-center justify-center hover:bg-slate-800 rounded-xl text-slate-400 hover:text-white transition disabled:opacity-30 disabled:cursor-not-allowed\"\n                                    >\n                                        <Plus className=\"w-5 h-5\" />\n                                    </button>\n                                </div>\n\n                                <button\n                                    onClick={handleAdd}\n                                    disabled={!hasStock || isMaxInCart}\n                                    className={`flex-1 py-5 rounded-2xl font-black transition flex items-center justify-center gap-3 shadow-2xl ${added\n                                        ? 'bg-green-500 text-white'\n                                        : (hasStock && !isMaxInCart)\n                                            ? 'bg-white text-black hover:bg-orange-400 hover:text-white hover:scale-[1.02] active:scale-[0.98]'\n                                            : 'bg-slate-900 text-slate-600 border border-slate-800 cursor-not-allowed'\n                                        }`}\n                                >\n                                    {added ? (\n                                        <><CheckCircle className=\"w-6 h-6\" /> LISTO</>\n                                    ) : isMaxInCart ? (\n                                        <><AlertCircle className=\"w-6 h-6\" /> MAX EN CARRITO</>\n                                    ) : hasStock ? (\n                                        <><ShoppingCart className=\"w-6 h-6\" /> AGREGAR</>\n                                    ) : (\n                                        <><AlertCircle className=\"w-6 h-6\" /> AGOTADO</>\n                                    )}\n                                </button>\n                            </div>\n                        </div>\n\n\n                        {/* Bot√≥n Cerrar */}\n                        <button\n                            onClick={() => setSelectedProduct(null)}\n                            className=\"absolute top-4 right-4 md:top-6 md:right-6 p-4 bg-black/60 md:bg-white/5 hover:bg-white/10 text-white md:text-slate-400 hover:text-white rounded-full transition-all border border-white/20 md:border-white/5 z-[30] shadow-2xl backdrop-blur-md\"\n                            title=\"Cerrar detalle\"\n                        >\n                            <X className=\"w-6 h-6 md:w-5 md:h-5\" />\n                        </button>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Venta Manual (Offline / \"En Casa\")\n    const ManualSaleModal = () => {\n        // State is now hoisted to App (saleData, setSaleData)\n\n        if (!showManualSaleModal) return null;\n\n        const product = products.find(p => p.id === saleData.productId);\n\n        const handleProductChange = (e) => {\n            const pid = e.target.value;\n            const prod = products.find(p => p.id === pid);\n            setSaleData({\n                ...saleData,\n                productId: pid,\n                price: prod ? Number(prod.basePrice) : 0\n            });\n        };\n\n        const handleSubmit = async (e) => {\n            e.preventDefault();\n            if (!product) return showToast(\"Selecciona un producto.\", \"warning\");\n            if (saleData.quantity <= 0) return showToast(\"Cantidad inv√°lida.\", \"warning\");\n\n            try {\n                // Verificar Stock\n                const currentStock = Number(product.stock) || 0;\n                if (saleData.quantity > currentStock) {\n                    return showToast(`Stock insuficiente (Disponible: ${currentStock}).`, \"error\");\n                }\n\n                // Crear Orden \"Offline\"\n                const orderId = `man-${Date.now().toString().slice(-6)}`;\n                const total = saleData.quantity * saleData.price;\n\n                const newOrder = {\n                    orderId: orderId,\n                    userId: 'manual_admin', // Usuario sistema\n                    customer: {\n                        name: saleData.customerName || 'Cliente Mostrador',\n                        email: 'offline@store.com',\n                        phone: '-',\n                        dni: '-'\n                    },\n                    items: [{\n                        productId: product.id,\n                        title: product.name,\n                        quantity: Number(saleData.quantity),\n                        unit_price: Number(saleData.price),\n                        image: product.image\n                    }],\n                    subtotal: total,\n                    discount: 0,\n                    total: total,\n                    status: 'Realizado', // Ya entregado\n                    date: new Date().toISOString(),\n                    shippingAddress: 'Entrega Presencial (Offline)',\n                    paymentMethod: saleData.paymentMethod,\n                    source: 'manual_sale',\n                    notes: saleData.notes\n                };\n\n                // 1. Guardar Pedido\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n                // 2. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-Number(saleData.quantity))\n                });\n\n                showToast(\"Venta registrada correctamente.\", \"success\");\n                setShowManualSaleModal(false);\n            } catch (err) {\n                console.error(err);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\">\n                <div className=\"bg-[#0a0a0a] rounded-[2rem] w-full max-w-lg border border-slate-800 shadow-2xl relative overflow-hidden\">\n                    <button onClick={() => setShowManualSaleModal(false)} className=\"absolute top-6 right-6 p-2 bg-slate-900 rounded-full text-slate-400 hover:text-white transition z-10\">\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className=\"p-8 border-b border-slate-800\">\n                        <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                            <Store className=\"w-6 h-6 text-green-400\" /> Registrar Venta Manual\n                        </h3>\n                        <p className=\"text-slate-500 text-sm mt-1\">Para ventas fuera de la plataforma web.</p>\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"p-8 space-y-4\">\n                        <div>\n                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-1\">Producto</label>\n                            <select\n                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white focus:border-green-500 outline-none\"\n                                value={saleData.productId}\n                                onChange={handleProductChange}\n                            >\n                                <option value=\"\">-- Seleccionar Producto --</option>\n                                {products.map(p => (\n                                    <option key={p.id} value={p.id}>\n                                        {p.name} (Stock: {p.stock})\n                                    </option>\n                                ))}\n                            </select>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-1\">Cantidad</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"1\"\n                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white focus:border-green-500 outline-none\"\n                                    value={saleData.quantity}\n                                    onChange={e => setSaleData({ ...saleData, quantity: Number(e.target.value) })}\n                                />\n                            </div>\n                            <div>\n                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-1\">Precio Unit. ($)</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"0\"\n                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white focus:border-green-500 outline-none\"\n                                    value={saleData.price}\n                                    onChange={e => setSaleData({ ...saleData, price: Number(e.target.value) })}\n                                />\n                            </div>\n                        </div>\n\n                        <div>\n                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-1\">Cliente / Notas</label>\n                            <input\n                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white focus:border-green-500 outline-none\"\n                                value={saleData.customerName}\n                                onChange={e => setSaleData({ ...saleData, customerName: e.target.value })}\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-1\">M√©todo de Pago</label>\n                            <select\n                                className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white focus:border-green-500 outline-none\"\n                                value={saleData.paymentMethod}\n                                onChange={e => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                            >\n                                <option value=\"Efectivo\">Efectivo</option>\n                                <option value=\"Transferencia\">Transferencia</option>\n                                <option value=\"Tarjeta\">Tarjeta (POS)</option>\n                            </select>\n                        </div>\n\n                        <button type=\"submit\" className=\"w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-900/20 transition transform hover:-translate-y-1 mt-4\">\n                            REGISTRAR VENTA\n                        </button>\n                    </form>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Anal√≠ticas Detalladas (Drill-down)\n    const MetricsDetailModal = () => {\n        const [timeframe, setTimeframe] = useState('monthly'); // daily, monthly, yearly\n        if (!metricsDetail) return null;\n\n        const data = dashboardMetrics.analytics[timeframe] || [];\n        const title = metricsDetail.type === 'revenue' ? 'Ingresos Brutos' : 'Beneficio Neto';\n        const colorClass = metricsDetail.type === 'revenue' ? 'text-green-400' : 'text-orange-400';\n\n        // Calcular mejores/peores\n        const sortedByVal = [...data].sort((a, b) => b.revenue - a.revenue);\n        const bestPeriod = sortedByVal[0];\n        const worstPeriod = sortedByVal[sortedByVal.length - 1];\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\">\n                <div className=\"bg-[#050505] rounded-[2.5rem] w-full max-w-4xl max-h-[90vh] flex flex-col border border-slate-800 shadow-2xl relative overflow-hidden\">\n                    {/* Header */}\n                    <div className=\"p-8 border-b border-slate-800 bg-slate-900/20 flex justify-between items-center\">\n                        <div>\n                            <h3 className={`text-3xl font-black ${colorClass} flex items-center gap-3`}>\n                                <BarChart className=\"w-8 h-8\" /> {title} - Anal√≠tica\n                            </h3>\n                            <p className=\"text-slate-500 text-sm mt-1\">Desglose detallado de tu rendimiento.</p>\n                        </div>\n                        <button onClick={() => setMetricsDetail(null)} className=\"p-3 bg-slate-900 rounded-full text-slate-400 hover:text-white transition border border-slate-700\">\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n\n                    {/* Controls */}\n                    <div className=\"p-6 flex gap-4 bg-slate-900/10 border-b border-slate-800/50 justify-center\">\n                        {['daily', 'monthly', 'yearly'].map(t => (\n                            <button\n                                key={t}\n                                onClick={() => setTimeframe(t)}\n                                className={`px-6 py-2 rounded-full text-xs font-black uppercase tracking-widest transition ${timeframe === t ? 'bg-slate-100 text-black' : 'bg-slate-900 text-slate-500 hover:text-white border border-slate-800'}`}\n                            >\n                                {t === 'daily' ? 'Diario' : t === 'monthly' ? 'Mensual' : 'Anual'}\n                            </button>\n                        ))}\n                    </div>\n\n                    {/* Stats Highlights */}\n                    <div className=\"grid grid-cols-2 gap-4 p-6 bg-slate-900/5\">\n                        <div className=\"bg-green-900/10 border border-green-500/20 p-4 rounded-2xl flex items-center gap-4\">\n                            <div className=\"p-3 bg-green-500/20 rounded-xl text-green-400\">\n                                <TrendingUp className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Mejor Periodo</p>\n                                <p className=\"text-green-400 font-black text-lg\">\n                                    {bestPeriod ? `$${bestPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{bestPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                        <div className=\"bg-red-900/10 border border-red-500/20 p-4 rounded-2xl flex items-center gap-4\">\n                            <div className=\"p-3 bg-red-500/20 rounded-xl text-red-400\">\n                                <TrendingDown className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Peor Periodo</p>\n                                <p className=\"text-red-400 font-black text-lg\">\n                                    {worstPeriod ? `$${worstPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{worstPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* CSS Bar Chart */}\n                    <div className=\"flex-1 p-6 relative flex items-end justify-between gap-2 overflow-x-auto custom-scrollbar\">\n                        {data.length === 0 ? (\n                            <div className=\"w-full text-center text-slate-500 my-auto\">No hay datos para mostrar el gr√°fico.</div>\n                        ) : (\n                            (() => {\n                                const maxVal = Math.max(...data.map(d => d.revenue), 1); // Avoid div/0\n                                return data.slice().map((item, idx) => {\n                                    const heightPct = (item.revenue / maxVal) * 100;\n                                    const isPositive = metricsDetail.type !== 'net_income' || item.revenue >= 0;\n                                    // For net income, handle negative later if needed, assuming revenue is always positive here\n\n                                    return (\n                                        <div key={idx} className=\"flex flex-col items-center justify-end h-full gap-2 group min-w-[60px] cursor-pointer hover:bg-slate-900/30 rounded-xl p-1 transition-all\">\n                                            {/* Tooltip on Hover */}\n                                            <div className=\"opacity-0 group-hover:opacity-100 absolute bottom-full mb-2 bg-slate-900 border border-slate-700 px-3 py-2 rounded-xl pointer-events-none transition z-50 shadow-xl max-w-[min(240px,70vw)] whitespace-normal break-words\">\n                                                <p className=\"text-white font-bold\">{item.date}</p>\n                                                <p className={`font-black ${colorClass}`}>${item.revenue.toLocaleString()}</p>\n                                                <p className=\"text-[10px] text-slate-500\">{item.orders} Pedidos</p>\n                                            </div>\n\n                                            {/* Bar */}\n                                            <div\n                                                className={`w-4 bg-gradient-to-t ${metricsDetail.type === 'revenue' ? 'from-green-900/50 to-green-500' : 'from-orange-900/50 to-orange-500'} rounded-t-full relative transition-all duration-500 group-hover:w-6 group-hover:brightness-125`}\n                                                style={{ height: `${Math.max(heightPct, 5)}%` }} // Min height 5%\n                                            >\n                                                {/* Glow alignment */}\n                                                <div className={`absolute top-0 left-0 right-0 h-4 rounded-full ${metricsDetail.type === 'revenue' ? 'bg-green-400' : 'bg-orange-400'} blur-md opacity-20`}></div>\n                                            </div>\n\n                                            {/* Label */}\n                                            <p className=\"text-[10px] text-slate-600 font-bold -rotate-45 group-hover:rotate-0 group-hover:text-white transition origin-center mt-2 truncate w-full text-center\">\n                                                {timeframe === 'monthly' ? item.date.slice(5) : timeframe === 'daily' ? item.date.slice(5) : item.date}\n                                            </p>\n                                        </div>\n                                    );\n                                })\n                            })()\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n\n    // --- SUB-COMPONENTS FOR ADMIN DRAWER ---\n\n    const UserCartView = ({ cartItems, isLoading }) => {\n        if (isLoading) {\n            return (\n                <div className=\"py-20 flex flex-col items-center gap-4 opacity-50\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-orange-400\" />\n                    <p className=\"text-xs font-black tracking-widest text-slate-500\">SINCRONIZANDO DATOS...</p>\n                </div>\n            );\n        }\n        if (cartItems.length === 0) {\n            return (\n                <div className=\"py-20 text-center flex flex-col items-center gap-6\">\n                    <div className=\"p-6 rounded-full bg-white/5 border border-white/5\">\n                        <ShoppingCart className=\"w-12 h-12 text-slate-700\" />\n                    </div>\n                    <p className=\"text-sm font-black uppercase tracking-widest text-slate-500 italic\">No hay productos activos</p>\n                </div>\n            );\n        }\n        return (\n            <>\n                <div className=\"flex justify-between items-center px-2\">\n                    <p className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest\">Contenido del Carrito</p>\n                    <p className=\"text-xs font-bold text-orange-400 bg-orange-400/10 px-3 py-1 rounded-full\">{cartItems.length} ITEMS</p>\n                </div>\n                <div className=\"space-y-3\">\n                    {cartItems.map((item, idx) => (\n                        <div key={idx} className=\"bg-white/[0.03] border border-white/10 p-4 rounded-2xl flex gap-4 transition hover:bg-white/[0.05] hover:border-orange-500/20 group animate-fade-up\" style={{ animationDelay: `${idx * 0.05}s` }}>\n                            <div className=\"w-16 h-16 bg-[#0a0a0a] rounded-xl overflow-hidden shadow-inner border border-white/5 flex-shrink-0\">\n                                <img src={item.image || 'https://images.unsplash.com/photo-1581404917879-53e19259fdda?w=100'} className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\" />\n                            </div>\n                            <div className=\"flex-1 flex flex-col justify-center\">\n                                <p className=\"font-bold text-white text-sm leading-tight mb-1\">{item.name}</p>\n                                <div className=\"flex justify-between items-center\">\n                                    <p className=\"text-xs text-slate-500\">Cant: <span className=\"text-white font-mono font-bold\">{item.quantity}</span></p>\n                                    <p className=\"text-orange-400 font-black font-mono text-xs\">${Number(item.price).toLocaleString()}</p>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n                <div className=\"pt-6 border-t border-white/5\">\n                    <div className=\"flex justify-between items-center bg-orange-500/5 p-6 rounded-2xl border border-orange-500/20\">\n                        <p className=\"text-slate-400 font-bold\">Valor Total</p>\n                        <p className=\"text-2xl font-black text-white font-mono\">${cartItems.reduce((acc, i) => acc + (Number(i.price) * i.quantity), 0).toLocaleString()}</p>\n                    </div>\n                </div>\n            </>\n        );\n    };\n\n    const UserEditForm = ({ user, currentUser, initialData, onSubmit, onDelete, isSaving }) => {\n        const [formData, setFormData] = useState(initialData);\n        const SUPER_ADMIN_EMAIL = 'lautarocorazza63@gmail.com';\n        const isSuperAdminProfile = user.email === SUPER_ADMIN_EMAIL;\n\n        // Update local state when initialData changes\n        useEffect(() => {\n            setFormData(initialData);\n        }, [initialData]);\n\n        const handleSubmit = (e) => {\n            e.preventDefault();\n            onSubmit(formData);\n        };\n\n        return (\n            <form onSubmit={handleSubmit} className=\"space-y-8 animate-fade-in\">\n                {/* Datos de Identidad */}\n                <div className=\"space-y-6\">\n                    <p className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2\">\n                        <User className=\"w-3 h-3\" /> Datos Identidad\n                    </p>\n                    <div className=\"grid grid-cols-1 gap-6\">\n                        <div>\n                            <input\n                                className=\"input-cyber w-full p-4 text-sm\"\n                                placeholder=\"Nombre Completo\"\n                                value={formData.name}\n                                onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                required\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className=\"input-cyber w-full p-4 text-sm font-mono\"\n                                placeholder=\"Username / Alias\"\n                                value={formData.username}\n                                onChange={e => setFormData({ ...formData, username: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className={`input-cyber w-full p-4 text-sm font-mono ${isSuperAdminProfile ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                placeholder=\"Email de la cuenta (Principal)\"\n                                value={formData.email}\n                                onChange={e => setFormData({ ...formData, email: e.target.value })}\n                                required\n                                disabled={isSuperAdminProfile}\n                                title={isSuperAdminProfile ? \"No se puede modificar el email del Super Admin\" : \"\"}\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <input\n                                className=\"input-cyber w-full p-4 text-sm font-mono\"\n                                placeholder=\"DNI\"\n                                value={formData.dni}\n                                onChange={e => setFormData({ ...formData, dni: e.target.value })}\n                            />\n                            <input\n                                className=\"input-cyber w-full p-4 text-sm font-mono\"\n                                placeholder=\"Tel√©fono\"\n                                value={formData.phone}\n                                onChange={e => setFormData({ ...formData, phone: e.target.value })}\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Seguridad y Rol */}\n                <div className=\"space-y-6 pt-4\">\n                    <p className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2\">\n                        <Lock className=\"w-3 h-3\" /> Seguridad & Rol\n                    </p>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <div className=\"relative group\">\n                                <input\n                                    type=\"password\"\n                                    className=\"input-cyber w-full p-4 text-sm font-mono\"\n                                    placeholder=\"Nueva Contrase√±a (Dejar vac√≠o para no cambiar)\"\n                                    value={formData.newPassword}\n                                    onChange={e => setFormData({ ...formData, newPassword: e.target.value })}\n                                />\n                            </div>\n                            <p className=\"text-[9px] text-slate-600 mt-2 ml-1 italic\">M√≠nimo 6 caracteres para actualizar.</p>\n                        </div>\n\n                        <div className={`flex bg-slate-900/50 p-1.5 rounded-2xl border border-white/5 ${isSuperAdminProfile ? 'opacity-50 pointer-events-none' : ''}`}>\n                            {['user', 'editor', 'admin'].map(r => (\n                                <button\n                                    key={r}\n                                    type=\"button\"\n                                    onClick={() => setFormData({ ...formData, role: r })}\n                                    className={`flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${formData.role === r ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20' : 'text-slate-500 hover:text-slate-300'\n                                        }`}\n                                >\n                                    {r}\n                                </button>\n                            ))}\n                        </div>\n                        {isSuperAdminProfile && <p className=\"text-[9px] text-orange-400 mt-1 ml-1\">Rol de Super Admin inmutable.</p>}\n                    </div>\n                </div>\n\n                <div className=\"space-y-4 pt-6\">\n                    <button\n                        type=\"submit\"\n                        disabled={isSaving}\n                        className=\"w-full py-5 bg-gradient-to-r from-indigo-600 to-orange-600 hover:from-indigo-500 hover:to-orange-500 text-white font-black rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50\"\n                    >\n                        {isSaving ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <Save className=\"w-6 h-6\" />}\n                        SINCRONIZAR CAMBIOS\n                    </button>\n\n                    {!isSuperAdminProfile && (\n                        <button\n                            type=\"button\"\n                            onClick={onDelete}\n                            className=\"w-full py-4 border border-red-500/30 bg-red-500/5 text-red-500 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-500/10 transition flex items-center justify-center gap-2\"\n                        >\n                            <Trash2 className=\"w-4 h-4\" /> Eliminar Cuenta Permanente\n                        </button>\n                    )}\n                </div>\n            </form>\n        );\n    };\n\n    // Unified Right Sidebar Drawer (Admin)\n    const AdminUserDrawer = () => {\n        const [userCartItems, setUserCartItems] = useState([]);\n        const [isLoadingCart, setIsLoadingCart] = useState(false);\n        const [isSaving, setIsSaving] = useState(false);\n        const active = viewUserCart || userPassModal || viewUserEdit;\n\n        // Determinamos el tipo basado en qu√© activ√≥ el drawer: 'cart', 'edit', o 'password'\n        const type = viewUserCart ? 'cart' : (userPassModal ? 'password' : 'edit');\n        const user = viewUserCart || userPassModal || viewUserEdit;\n\n        const [initialFormState, setInitialFormState] = useState({\n            name: '',\n            username: '',\n            email: '',\n            phone: '',\n            dni: '',\n            role: 'user',\n            newPassword: ''\n        });\n\n        // Effect to update initial form state and fetch cart\n        useEffect(() => {\n            if (active && user) {\n                if (type === 'cart') {\n                    const fetchCart = async () => {\n                        setIsLoadingCart(true);\n                        try {\n                            const cartDoc = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', user.id));\n                            setUserCartItems(cartDoc.exists() ? (cartDoc.data().items || []) : []);\n                        } catch (e) { setUserCartItems([]); }\n                        setIsLoadingCart(false);\n                    };\n                    fetchCart();\n                }\n\n                setInitialFormState({\n                    name: user.name || '',\n                    username: user.username || '',\n                    email: user.email || '',\n                    phone: user.phone || '',\n                    dni: user.dni || '',\n                    role: user.role || 'user',\n                    newPassword: ''\n                });\n            }\n        }, [active, user, type]);\n\n\n        const closeDrawer = () => {\n            setViewUserCart(null);\n            setUserPassModal(null);\n            setViewUserEdit(null);\n        };\n\n        const handleEditSubmit = async (formData) => {\n            setIsSaving(true);\n            try {\n                if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n                const token = await auth.currentUser.getIdToken();\n                // 1. Actualizaci√≥n Cr√≠tica (Auth) v√≠a API si cambi√≥ email o password\n                const authUpdate = {};\n                if (formData.email !== user.email) authUpdate.email = formData.email;\n                if (formData.newPassword) authUpdate.password = formData.newPassword;\n\n                if (Object.keys(authUpdate).length > 0) {\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'update', uid: user.id, ...authUpdate })\n                    });\n                    const result = await res.json();\n                    if (!res.ok) throw new Error(result.error);\n                }\n\n                // 2. Actualizaci√≥n de Perfil (Firestore)\n                const firestoreUpdate = {\n                    name: formData.name,\n                    username: formData.username,\n                    email: formData.email,\n                    emailLower: formData.email.toLowerCase(),\n                    phone: formData.phone,\n                    dni: formData.dni,\n                    role: formData.role,\n                    lastModifiedBy: currentUser.email,\n                    updatedAt: new Date().toISOString()\n                };\n\n                // Si cambi√≥ la contrase√±a, tambi√©n actualizarla en Firestore\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id), firestoreUpdate);\n\n                // Si estamos editando nuestro propio usuario, actualizar el estado global inmediatamente\n                if (currentUser && currentUser.id === user.id) {\n                    setCurrentUser(prev => ({ ...prev, ...firestoreUpdate }));\n                }\n\n                showToast(\"Perfil de usuario actualizado correctamente.\", \"success\");\n                closeDrawer();\n\n            } catch (e) {\n                console.error(e);\n                showToast(e.message || \"Error al actualizar perfil.\", \"error\");\n            }\n            setIsSaving(false);\n        };\n\n        const handleDeleteUser = async () => {\n            if (user.email === currentUser.email) {\n                return showToast(\"Autoprotecci√≥n activa: No puedes eliminar tu propia cuenta.\", \"warning\");\n            }\n\n            openConfirm(\"ELIMINAR USUARIO\", `¬øEst√°s seguro de eliminar a ${user.name}? Esta acci√≥n es irreversible y borrar√° su acceso y datos.`, async () => {\n                setIsSaving(true);\n                try {\n                    if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n                    const token = await auth.currentUser.getIdToken();\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'delete', uid: user.id })\n                    });\n                    if (!res.ok) throw new Error(\"Error eliminando acceso de Auth\");\n\n                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id));\n\n                    showToast(\"Usuario eliminado definitivamente.\", \"success\");\n                    closeDrawer();\n                } catch (e) {\n                    console.error(e);\n                    showToast(\"Fallo al eliminar usuario.\", \"error\");\n                }\n                setIsSaving(false);\n            });\n        };\n\n        if (!active) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[1000] flex justify-end animate-fade-in pointer-events-none\">\n                <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto\" onClick={closeDrawer} />\n\n                <div className=\"w-full max-w-xl bg-[#0a0a0a] border-l border-white/10 shadow-[-20px_0_50px_rgba(0,0,0,0.5)] flex flex-col h-full pointer-events-auto relative overflow-hidden animate-slide-left\">\n                    <div className=\"absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-600 via-orange-500 to-pink-600\"></div>\n\n                    <div className=\"p-8 border-b border-white/5 flex justify-between items-center bg-white/[0.02]\">\n                        <div>\n                            <h2 className=\"text-xl font-black text-white tracking-widest uppercase\">\n                                {type === 'cart' ? 'Auditor√≠a de Carrito' : 'Configurar Cuenta'}\n                            </h2>\n                            <p className=\"text-[10px] font-bold text-slate-500 mt-1 tracking-widest flex items-center gap-2\">\n                                <span className=\"w-1.5 h-1.5 rounded-full bg-orange-400 animate-pulse\"></span>\n                                ID: {user.id.slice(-8).toUpperCase()} ‚Ä¢ {user.email}\n                            </p>\n                        </div>\n                        <button onClick={closeDrawer} className=\"p-3 bg-white/5 hover:bg-white/10 rounded-2xl transition-all border border-white/5 group\">\n                            <X className=\"w-5 h-5 text-slate-400 group-hover:text-white\" />\n                        </button>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-8 custom-scrollbar space-y-8\">\n                        {type === 'cart' && <UserCartView cartItems={userCartItems} isLoading={isLoadingCart} />}\n                        {(type === 'edit' || type === 'password') && (\n                            <UserEditForm\n                                user={user}\n                                currentUser={currentUser}\n                                initialData={initialFormState}\n                                onSubmit={handleEditSubmit}\n                                onDelete={handleDeleteUser}\n                                isSaving={isSaving}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Estado de Carga Inicial\n    if (isLoading && view === 'store') {\n        const loadingPrimaryColor = settings?.primaryColor || '#f97316';\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white px-4\">\n                <div className=\"relative\">\n                    <div className=\"w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: loadingPrimaryColor }}></div>\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 animate-pulse\" style={{ color: loadingPrimaryColor }} />\n                    </div>\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-3xl font-black tracking-[0.1em] sm:tracking-[0.2em] md:tracking-[0.3em] mt-6 sm:mt-8 animate-pulse text-center max-w-[90vw]\" style={{ color: loadingPrimaryColor, textShadow: `0 0 20px ${loadingPrimaryColor}40` }}>\n                    {settings?.loadingTitle || settings?.storeName || ''}\n                </h1>\n                <p className=\"text-slate-500 text-xs sm:text-sm mt-3 sm:mt-4 font-mono uppercase tracking-wider sm:tracking-widest text-center\">\n                    {settings?.loadingText || 'Cargando sistema...'}\n                </p>\n            </div>\n        );\n    }\n\n    // Modo Mantenimiento\n    if (settings?.maintenanceMode && !isAdmin(currentUser?.email)) {\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white p-4 sm:p-6 text-center\">\n                <div className=\"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mb-6 sm:mb-8 border border-red-900/50 animate-pulse\">\n                    <AlertTriangle className=\"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12\" />\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-4xl font-black mb-3 sm:mb-4 tracking-tight uppercase\">Sistema en Mantenimiento</h1>\n                <p className=\"text-slate-400 max-w-sm sm:max-w-md mx-auto leading-relaxed text-sm sm:text-base\">\n                    Estamos realizando mejoras para brindarte una experiencia premium.\n                    ¬°Te mandamos un saludo y esperamos que vuelvas prontamente!\n                </p>\n                <div className=\"mt-8 sm:mt-12 pt-8 sm:pt-12 border-t border-slate-900 w-full max-w-xs\">\n                    <p className=\"text-[10px] sm:text-xs text-slate-600 font-mono italic\">{settings?.storeName || ''} - Modo Mantenimiento Activo</p>\n                </div>\n            </div>\n        );\n    }\n\n    // --- L√ìGICA DE FILTRADO Y ORDENAMIENTO INTELIGENTE ---\n    const filteredProducts = products\n        .filter(p => {\n            // Excluir productos desactivados de la tienda p√∫blica\n            if (p.isActive === false) return false;\n\n            const matchesSearch = (p.name || '').toLowerCase().includes(searchQuery.toLowerCase());\n\n            // L√≥gica de Categor√≠as Especiales\n            if (selectedCategory === 'Promos') return false; // El grid est√°ndar se oculta para Promos\n            if (selectedCategory === 'Ofertas') {\n                return matchesSearch && (p.discount > 0);\n            }\n\n            // NUEVO: Soporte para m√∫ltiples categor√≠as\n            // Verificar si el producto tiene el array categories o el campo legacy category\n            const matchesCategory = (() => {\n                // Sin filtro seleccionado - mostrar todos\n                if (selectedCategory === '') return true;\n\n                // Producto con m√∫ltiples categor√≠as (nuevo sistema)\n                if (Array.isArray(p.categories)) {\n                    return p.categories.includes(selectedCategory);\n                }\n\n                // Producto con categor√≠a antigua (retrocompatibilidad)\n                if (p.category) {\n                    return p.category.trim() === selectedCategory;\n                }\n\n                // Sin categor√≠a asignada\n                return false;\n            })();\n\n            return matchesSearch && matchesCategory;\n        })\n        .sort((a, b) => {\n            // Prioridad 1: Productos Destacados primero\n            if (a.isFeatured && !b.isFeatured) return -1;\n            if (!a.isFeatured && b.isFeatured) return 1;\n            // Prioridad 2: M√°s vendidos\n            const salesA = dashboardMetrics?.salesCount?.[a.id] || 0;\n            const salesB = dashboardMetrics?.salesCount?.[b.id] || 0;\n            return salesB - salesA;\n        });\n\n    // --- RENDERIZADO PRINCIPAL (RETURN) ---\n    return (\n\n        <div className={`min-h-screen flex flex-col relative w-full bg-grid font-sans selection:bg-orange-500/30 selection:text-orange-200 transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-slate-50'}`}>\n            {/* DEBUGGER VISUAL (SOLO DESARROLLO) */}\n            {view === 'store' && currentUser?.role === 'admin' && (\n                <div className=\"fixed bottom-4 left-4 z-[9999] bg-black/80 text-green-400 font-mono text-xs p-2 rounded border border-green-900 pointer-events-none\">\n                    [DEBUG] Total: {products.length} | Filtro: {filteredProducts.length} | Cat: {selectedCategory || 'ALL'}\n                </div>\n            )}\n\n            {/* Efectos de Fondo Globales */}\n            <div className=\"fixed inset-0 pointer-events-none z-0\">\n                <div className=\"absolute top-[-10%] left-[-10%] w-[60%] h-[60%] bg-purple-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n                <div className=\"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-orange-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n            </div>\n\n\n            {/* Contenedores Globales (Toasts y Modales) */}\n            <div className=\"fixed top-24 right-4 z-[20001] space-y-3 pointer-events-none\">\n                {/* Toasts necesitan pointer-events-auto para poder cerrarlos */}\n                <div className=\"pointer-events-auto space-y-3\">\n                    {toasts.map(t => (\n                        <Toast key={t.id} message={t.message} type={t.type} onClose={() => removeToast(t.id)} />\n                    ))}\n                </div>\n            </div>\n\n            {storeResolution.status !== 'resolved' && (\n                <div className=\"fixed inset-0 z-[10000] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4\">\n                    <div className=\"w-full max-w-xl rounded-3xl border border-white/10 bg-[#050505] p-8 shadow-2xl\">\n                        {storeResolution.status === 'resolving' ? (\n                            <div className=\"flex items-center gap-4\">\n                                <Loader2 className=\"w-7 h-7 animate-spin text-orange-500\" />\n                                <div>\n                                    <p className=\"text-white font-black text-xl tracking-tight\">Detectando tienda‚Ä¶</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">{storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-6\">\n                                <div className=\"space-y-2\">\n                                    <p className=\"text-white font-black text-2xl tracking-tight\">Tienda no configurada</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">Dominio: {storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n\n                                {!systemUser || systemUser.isAnonymous ? (\n                                    <div className=\"space-y-4\">\n                                        <p className=\"text-slate-400 text-sm\">Inici√° sesi√≥n para configurar este dominio.</p>\n                                        <button\n                                            onClick={() => setView('login')}\n                                            className=\"w-full py-4 rounded-2xl bg-gradient-to-r from-orange-600 to-purple-600 text-white font-black uppercase tracking-widest text-xs hover:from-orange-500 hover:to-purple-500 transition\"\n                                        >\n                                            Iniciar sesi√≥n\n                                        </button>\n                                    </div>\n                                ) : !isSuperAdminSession ? (\n                                    <div className=\"space-y-3\">\n                                        <p className=\"text-slate-400 text-sm\">Este dominio solo puede registrarlo el Super Admin.</p>\n                                        <p className=\"text-slate-600 text-xs font-mono\">Sesi√≥n: {systemUser?.email || systemUser?.uid}</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-5\">\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-300 text-sm\">Eleg√≠ c√≥mo quer√©s vincular este dominio:</p>\n                                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            const newStoreId = createStoreId();\n                                                            await registerHostname(newStoreId);\n                                                            showToast(`Dominio vinculado a ${newStoreId}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo crear la tienda', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-[10px] uppercase tracking-widest hover:bg-white/10 transition disabled:opacity-50\"\n                                                >\n                                                    Crear tienda nueva\n                                                </button>\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(DEFAULT_APP_ID);\n                                                            showToast(`Dominio vinculado a ${DEFAULT_APP_ID}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-orange-500/10 border border-orange-500/20 text-orange-400 font-black text-[10px] uppercase tracking-widest hover:bg-orange-500/20 transition disabled:opacity-50\"\n                                                >\n                                                    Usar tienda default\n                                                </button>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-500 text-xs font-mono\">O peg√° un storeId existente:</p>\n                                            <div className=\"flex gap-2\">\n                                                <input\n                                                    value={storeSetupStoreIdInput}\n                                                    onChange={(e) => setStoreSetupStoreIdInput(e.target.value)}\n                                                    className=\"input-cyber flex-1 p-4 text-sm font-mono\"\n                                                    placeholder=\"storeId (ej: cliente-abc123)\"\n                                                />\n                                                <button\n                                                    disabled={isStoreSetupSaving || !storeSetupStoreIdInput.trim()}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(storeSetupStoreIdInput.trim());\n                                                            showToast('Dominio vinculado', 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"px-5 rounded-2xl bg-indigo-600 text-white font-black text-[10px] uppercase tracking-widest hover:bg-indigo-500 transition disabled:opacity-50\"\n                                                >\n                                                    Vincular\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n\n\n            <OrderDetailsModal order={selectedOrder} onClose={() => setSelectedOrder(null)} />\n            <CouponSelectorModal />\n            <ProductDetailModal />\n\n            {/* --- BARRA DE NAVEGACI√ìN (NAVBAR) --- */}\n            {view !== 'admin' && (\n                <nav className={`fixed top-0 w-full h-16 sm:h-20 z-50 px-3 sm:px-6 md:px-12 flex items-center justify-between backdrop-blur-xl transition-all duration-300 ${darkMode ? 'glass border-b border-slate-800/50' : 'bg-white/95 border-b border-slate-200 shadow-sm'}`}>\n                    {/* Logo y Men√∫ */}\n                    <div className=\"flex items-center gap-2 sm:gap-6\">\n                        <button onClick={() => setIsMenuOpen(true)} className={`p-2 sm:p-3 rounded-lg sm:rounded-xl transition border group ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                            <Menu className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                        </button>\n                        <div className=\"cursor-pointer group flex items-center gap-2 sm:gap-3\" onClick={() => setView('store')}>\n                            {settings?.logoUrl && (\n                                <div className={`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full overflow-hidden border-2 bg-white p-0.5 flex-shrink-0 shadow-lg group-hover:border-orange-500 transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                    <img src={settings.logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover rounded-full\" />\n                                </div>\n                            )}\n                            <div className=\"flex flex-col\">\n                                <span className={`text-xl sm:text-2xl md:text-4xl font-black tracking-tighter italic group-hover:text-orange-500 transition-all duration-300 leading-none ${darkMode ? 'text-white' : 'text-white drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] filter'}`}>\n                                    {!settingsLoaded ? (\n                                        <span className={`inline-block h-6 sm:h-8 w-20 sm:w-32 rounded animate-pulse ${darkMode ? 'bg-slate-700/50' : 'bg-slate-200'}`}></span>\n                                    ) : (settings?.storeName || '')}\n                                </span>\n                                <div className=\"h-0.5 sm:h-1 w-1/2 bg-orange-500 rounded-full group-hover:w-full transition-all duration-500 mt-0.5 sm:mt-1 shadow-sm\"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Barra de B√∫squeda (Visible en Desktop) */}\n                    <div className={`hidden lg:flex items-center rounded-2xl px-6 py-3 w-1/3 transition shadow-inner group ${darkMode ? 'bg-slate-900/50 border border-slate-700/50 focus-within:border-orange-500/50 focus-within:bg-slate-900' : 'bg-slate-100 border border-slate-200 focus-within:border-orange-400 focus-within:bg-white focus-within:shadow-md'}`}>\n                        <Search className={`w-5 h-5 mr-3 group-focus-within:text-orange-500 transition ${darkMode ? 'text-slate-400' : 'text-slate-500'}`} />\n                        <input\n                            className={`bg-transparent outline-none text-sm w-full font-medium ${darkMode ? 'text-white placeholder-slate-500' : 'text-slate-900 placeholder-slate-400'}`}\n                            placeholder=\"¬øQu√© est√°s buscando hoy?\"\n                            value={searchQuery}\n                            onChange={e => setSearchQuery(e.target.value)}\n                        />\n                    </div>\n\n                    {/* Acciones de Usuario */}\n                    <div className=\"flex items-center gap-4\">\n                        {/* Botones de Contacto */}\n                        <div className=\"hidden md:flex items-center gap-2\">\n                            {settings?.showWhatsapp !== false && settings?.whatsappLink && (\n                                <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-green-900/10 text-green-400 hover:bg-green-500 hover:text-white border border-green-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(34,197,94,0.3)]\">\n                                    <MessageCircle className=\"w-5 h-5\" /> WhatsApp\n                                </button>\n                            )}\n                            {settings?.showInstagram !== false && settings?.instagramLink && (\n                                <button onClick={() => window.open(settings?.instagramLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-pink-900/10 text-pink-400 hover:bg-pink-500 hover:text-white border border-pink-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(236,72,153,0.3)]\">\n                                    <Instagram className=\"w-5 h-5\" /> Instagram\n                                </button>\n                            )}\n                        </div>\n\n                        {/* Bot√≥n Modo Claro/Oscuro */}\n                        <button\n                            onClick={() => setDarkMode(!darkMode)}\n                            className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group overflow-hidden border ${darkMode ? 'bg-slate-900/50 text-yellow-400 hover:bg-slate-800 border-slate-700/50' : 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100 border-yellow-200'}`}\n                            title={darkMode ? 'Activar modo claro' : 'Activar modo oscuro'}\n                        >\n                            <div className={`transform transition-all duration-500 ${darkMode ? 'rotate-0 scale-100' : 'rotate-180 scale-0 absolute'}`}>\n                                <Moon className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                            <div className={`transform transition-all duration-500 ${!darkMode ? 'rotate-0 scale-100' : '-rotate-180 scale-0 absolute'}`}>\n                                <Sun className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                        </button>\n\n                        {/* Bot√≥n Carrito */}\n                        <button onClick={() => setView('cart')} className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group border ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50 hover:border-orange-500/30' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200 hover:border-orange-400'}`}>\n                            <ShoppingBag className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                            {cart.length > 0 && (\n                                <span className={`absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 bg-orange-500 text-white text-[9px] sm:text-[10px] font-black w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center shadow-lg border-2 animate-bounce-short ${darkMode ? 'border-[#050505]' : 'border-white'}`}>\n                                    {cart.length}\n                                </span>\n                            )}\n                        </button>\n\n                        {/* Perfil / Login - Solo mostrar perfil si el usuario tiene datos v√°lidos */}\n                        {currentUser && currentUser.id && currentUser.email && currentUser.name ? (\n                            <button onClick={() => setView('profile')} className={`flex items-center gap-2 sm:gap-3 pl-2 pr-3 sm:pr-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl border transition group ${darkMode ? 'bg-slate-900/50 border-slate-700/50 hover:border-orange-500/50' : 'bg-slate-100 border-slate-200 hover:border-orange-400'}`}>\n                                <div className=\"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center text-white font-bold shadow-lg text-xs sm:text-sm group-hover:scale-105 transition\">\n                                    {currentUser.name.charAt(0)}\n                                </div>\n                                <div className=\"text-left hidden md:block\">\n                                    <p className={`text-[9px] sm:text-[10px] uppercase font-bold tracking-wider ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Hola,</p>\n                                    <p className={`text-xs sm:text-sm font-bold leading-none group-hover:text-orange-500 transition ${darkMode ? 'text-white' : 'text-slate-900'}`}>{currentUser.name.split(' ')[0]}</p>\n                                </div>\n                            </button>\n                        ) : (\n                            <button onClick={() => setView('login')} className={`px-3 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-black transition shadow-lg flex items-center gap-1 sm:gap-2 transform hover:-translate-y-0.5 ${darkMode ? 'bg-white text-black hover:bg-orange-500 hover:text-white' : 'bg-orange-500 text-white hover:bg-orange-600'}`}>\n                                <User className=\"w-4 h-4 sm:w-5 sm:h-5\" /> <span className=\"hidden sm:inline\">INGRESAR</span><span className=\"sm:hidden\">Entrar</span>\n                            </button>\n                        )}\n                    </div>\n                </nav>\n            )}\n\n            {/* --- MEN√ö M√ìVIL (DETALLADO Y EXPL√çCITO) --- */}\n            {isMenuOpen && (\n                <div className=\"fixed inset-0 z-[10000] flex justify-start\">\n                    {/* Backdrop */}\n                    <div className={`fixed inset-0 backdrop-blur-sm transition-opacity ${darkMode ? 'bg-black/90' : 'bg-black/50'}`} onClick={() => setIsMenuOpen(false)}></div>\n\n                    {/* Panel Lateral */}\n                    <div className={`relative w-72 sm:w-80 h-full p-6 sm:p-8 animate-fade-in-right flex flex-col shadow-2xl z-[10001] ${darkMode ? 'bg-[#0a0a0a] border-r border-slate-800' : 'bg-white border-r border-slate-200'}`}>\n                        <div className={`flex justify-between items-center mb-8 sm:mb-10 border-b pb-4 sm:pb-6 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <h2 className={`text-2xl sm:text-3xl font-black tracking-tight drop-shadow-md ${darkMode ? 'text-white' : 'text-slate-900'}`}>MEN√ö</h2>\n                            <button onClick={() => setIsMenuOpen(false)} className={`p-2 sm:p-3 rounded-full transition border ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                                <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                            </button>\n                        </div>\n\n                        {/* Lista de Botones */}\n                        <div className=\"space-y-2 sm:space-y-3 flex-1 overflow-y-auto custom-scrollbar pr-2\">\n                            <button onClick={() => { setView('store'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Home className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Inicio\n                            </button>\n\n                            <button onClick={() => { setView('profile'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <User className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Mi Perfil\n                            </button>\n\n                            <button onClick={() => { setView('cart'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <div className=\"relative\">\n                                    <ShoppingBag className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                    {cart.length > 0 && <span className=\"absolute -top-2 -right-2 bg-orange-500 text-[10px] text-white rounded-full w-4 h-4 flex items-center justify-center font-bold\">{cart.length}</span>}\n                                </div>\n                                Mi Carrito\n                            </button>\n\n                            <div className={`h-px my-3 sm:my-4 mx-4 ${darkMode ? 'bg-slate-800' : 'bg-slate-200'}`}></div>\n\n                            <button onClick={() => { setView('about'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Info className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Sobre Nosotros\n                            </button>\n\n                            {settings?.showGuideLink !== false && (\n                                <button onClick={() => { setView('guide'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                    <FileQuestion className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> {settings?.guideTitle || 'C√≥mo Comprar'}\n                                </button>\n                            )}\n\n                            {/* Panel Admin (Solo si tiene permisos) */}\n                            {hasAccess(currentUser?.email) && (\n                                <button onClick={() => { setView('admin'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold text-orange-500 mt-4 sm:mt-6 pt-4 sm:pt-6 flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl transition border ${darkMode ? 'border-t border-slate-800 bg-orange-900/10 hover:bg-orange-900/20 border-orange-500/20' : 'border-t border-slate-200 bg-orange-50 hover:bg-orange-100 border-orange-200'}`}>\n                                    <Shield className=\"w-5 h-5 sm:w-6 sm:h-6\" /> Admin Panel\n                                </button>\n                            )}\n                        </div>\n\n                        <div className={`mt-6 sm:mt-8 pt-6 sm:pt-8 border-t text-center ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-widest ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>{settings?.menuCopyright || settings.storeName}</p>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Espaciador para el Navbar Fixed */}\n            {view !== 'admin' && <div className=\"h-16 sm:h-20 md:h-24\"></div>}\n\n            {/* --- CONTENIDO PRINCIPAL (VIEW SWITCHER) --- */}\n            <main className={`flex-grow relative z-10 ${view === 'admin' ? 'min-h-screen min-full-viewport flex overflow-hidden' : 'p-4 md:p-8'}`}>\n\n                {/* 1. VISTA TIENDA (HOME) */}\n                {view === 'store' && (\n                    <div className=\"max-w-[1400px] mx-auto pb-32 min-h-screen block\">\n\n                        {/* Anuncio Global (Marquesina) - Solo mostrar cuando settings est√°n cargados */}\n                        {settingsLoaded && settings?.showAnnouncementBanner !== false && settings?.announcementMessage && (\n                            <div className=\"w-full bg-gradient-to-r from-orange-900/20 to-red-900/20 border border-orange-500/20 rounded-xl p-3 mb-8 text-center animate-pulse relative overflow-hidden group\">\n                                <div className=\"absolute inset-0 bg-white/5 skew-x-12 -translate-x-full group-hover:translate-x-full transition duration-1000\"></div>\n                                <p className=\"text-orange-400 font-black text-xs md:text-sm tracking-[0.2em] uppercase flex items-center justify-center gap-3\">\n                                    <Flame className=\"w-4 h-4 text-orange-500\" /> {settings.announcementMessage} <Flame className=\"w-4 h-4 text-orange-500\" />\n                                </p>\n                            </div>\n                        )}\n\n                        {/* Brand Ticker (Futuristic) - Solo mostrar cuando settings est√°n cargados */}\n                        {settingsLoaded && settings?.showBrandTicker !== false && (\n                            <div className={`mb-8 w-full overflow-hidden border-y backdrop-blur-sm py-2 ${darkMode ? 'border-slate-800/50 bg-[#0a0a0a]/50' : 'border-slate-200 bg-slate-100/50'}`}>\n                                <div className=\"ticker-wrap\">\n                                    <div className={`ticker-content font-mono text-xs md:text-sm tracking-[0.2em] md:tracking-[0.5em] uppercase flex items-center gap-6 md:gap-12 ${darkMode ? 'text-orange-500/50' : 'text-orange-600/70'}`}>\n                                        {[1, 2, 3, 4].map((i) => (\n                                            <React.Fragment key={i}>\n                                                <span className=\"whitespace-nowrap\">{settings?.tickerText || `${settings?.storeName || ''} Tech ‚Ä¢ Futuro ‚Ä¢ Calidad Premium ‚Ä¢ Innovaci√≥n`}</span>\n                                                <span>‚Ä¢</span>\n                                            </React.Fragment>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Banner Hero */}\n                        <div className={`relative w-full h-[30vh] md:h-[350px] 2xl:h-[450px] rounded-[2rem] overflow-hidden shadow-2xl mb-8 border group relative container-tv ${darkMode ? 'border-slate-800 bg-[#080808]' : 'border-slate-200 bg-white'}`}>\n                            <div className={`absolute inset-0 bg-[url('/noise.svg')] z-0 ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n                            <HomeBannerCarouselBackground\n                                settingsLoaded={settingsLoaded}\n                                banners={settings?.showHomeBannerCarousel === false ? [] : homeBanners}\n                                fallbackUrl={settings?.heroUrl}\n                                autoplayMs={settings?.homeBannerAutoplayMs || 5000}\n                                darkMode={darkMode}\n                                onBannerClick={handleHomeBannerClick}\n                            />\n\n                            {/* Overlay de Texto */}\n                            <div className={`absolute inset-0 flex flex-col justify-center px-8 md:px-20 z-10 p-12 pointer-events-none ${darkMode ? 'bg-gradient-to-t md:bg-gradient-to-r from-[#050505] via-[#050505]/80 to-transparent' : 'bg-gradient-to-t md:bg-gradient-to-r from-white/25 via-white/10 to-transparent'}`}>\n                                <div className=\"max-w-2xl animate-fade-up\">\n                                    {/* Skeleton/Loading mientras no se cargan los settings */}\n                                    {!settingsLoaded ? (\n                                        <>\n                                            <div className=\"h-6 w-32 bg-slate-700/50 rounded-md mb-4 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-64 md:w-80 bg-slate-700/50 rounded-lg mb-2 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-48 md:w-64 bg-slate-700/50 rounded-lg mb-4 animate-pulse\"></div>\n                                            <div className=\"h-4 w-72 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                            <div className=\"h-4 w-56 bg-slate-700/50 rounded mb-6 animate-pulse\"></div>\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"h-12 w-40 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                                <div className=\"h-10 w-24 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                            </div>\n                                        </>\n                                    ) : (\n                                        <>\n                                            <span className=\"bg-orange-500 text-black px-3 py-1 rounded-md text-[10px] font-black uppercase tracking-widest shadow-[0_0_15px_rgba(255,255,255,0.1)] mb-4 inline-block\">\n                                                {settings?.heroBadge || ''}\n                                            </span>\n                                            <h1 className={`text-3xl md:text-5xl lg:text-6xl text-tv-huge font-black leading-[0.9] mb-4 ${darkMode ? 'text-white drop-shadow-2xl neon-text' : 'text-slate-900'}`}>\n                                                {settings?.heroTitle1 || ''} <br />\n                                                <span className={`text-transparent bg-clip-text bg-gradient-to-r ${darkMode ? 'from-orange-400 to-blue-600' : 'from-orange-600 to-blue-700'}`}>\n                                                    {settings?.heroTitle2 || ''}\n                                                </span>\n                                            </h1>\n                                            <p className={`text-sm md:text-base lg:text-lg mb-6 max-w-md font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                                {settings?.heroSubtitle || ''}\n                                            </p>\n                                            <div className=\"flex items-center gap-4\">\n                                                <button onClick={() => document.getElementById('catalog').scrollIntoView({ behavior: 'smooth' })} className=\"px-8 py-4 bg-white text-black font-black rounded-xl hover:bg-orange-400 transition shadow-[0_0_30px_rgba(255,255,255,0.1)] flex items-center justify-center gap-2 group/btn pointer-events-auto\">\n                                                    VER CAT√ÅLOGO <ArrowRight className=\"w-5 h-5 group-hover/btn:translate-x-1 transition\" />\n                                                </button>\n                                                <button onClick={() => setView('guide')} className={`px-6 py-2.5 rounded-xl flex items-center gap-2 transition font-bold text-xs group pointer-events-auto ${darkMode ? 'bg-white/5 backdrop-blur-md border border-white/10 hover:bg-white/10 text-white' : 'bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-900'}`}>\n                                                    <Info className={`w-4 h-4 ${darkMode ? 'text-orange-400' : 'text-orange-600'}`} /> Ayuda\n                                                </button>\n                                            </div>\n                                        </>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Why Choose Us Section */}\n                        {/* Why Choose Us Section (Editable) - Respeta toggles de configuraci√≥n */}\n                        {settingsLoaded && settings?.showFeaturesSection !== false && (\n                            <div className={`grid grid-cols-1 ${[settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 1 ? 'md:grid-cols-1 max-w-md mx-auto' :\n                                [settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 2 ? 'md:grid-cols-2 max-w-2xl mx-auto' :\n                                    'md:grid-cols-3'\n                                } gap-4 md:gap-8 mb-12 container-tv`}>\n                                {!settingsLoaded ? (\n                                    <>\n                                        {/* Skeleton para las tarjetas */}\n                                        {[1, 2, 3].map((i) => (\n                                            <div key={i} className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center\">\n                                                <div className=\"w-10 h-10 rounded-full bg-slate-700/50 mb-3 animate-pulse\"></div>\n                                                <div className=\"h-5 w-32 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                                <div className=\"h-3 w-48 bg-slate-700/50 rounded mb-1 animate-pulse\"></div>\n                                                <div className=\"h-3 w-40 bg-slate-700/50 rounded animate-pulse\"></div>\n                                            </div>\n                                        ))}\n                                    </>\n                                ) : (\n                                    <>\n                                        {/* Beneficio 1 */}\n                                        {settings?.showFeature1 !== false && (\n                                            <div className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center tech-glow hover:bg-slate-900/50 transition duration-500 group\">\n                                                <div className=\"w-10 h-10 rounded-full bg-orange-900/20 flex items-center justify-center mb-3 group-hover:scale-110 transition\">\n                                                    <Zap className=\"w-5 h-5 text-orange-400\" />\n                                                </div>\n                                                <h3 className=\"text-base font-bold text-white mb-1\">{settings?.feature1Title || ''}</h3>\n                                                <p className=\"text-slate-400 text-[11px]\">{settings?.feature1Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 2 */}\n                                        {settings?.showFeature2 !== false && (\n                                            <div className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center tech-glow hover:bg-slate-900/50 transition duration-500 group\">\n                                                <div className=\"w-10 h-10 rounded-full bg-purple-900/20 flex items-center justify-center mb-3 group-hover:scale-110 transition\">\n                                                    <Shield className=\"w-5 h-5 text-purple-400\" />\n                                                </div>\n                                                <h3 className=\"text-base font-bold text-white mb-1\">{settings?.feature2Title || ''}</h3>\n                                                <p className=\"text-slate-400 text-[11px]\">{settings?.feature2Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 3 */}\n                                        {settings?.showFeature3 !== false && (\n                                            <div className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center tech-glow hover:bg-slate-900/50 transition duration-500 group\">\n                                                <div className=\"w-10 h-10 rounded-full bg-green-900/20 flex items-center justify-center mb-3 group-hover:scale-110 transition\">\n                                                    <Headphones className=\"w-5 h-5 text-green-400\" />\n                                                </div>\n                                                <h3 className=\"text-base font-bold text-white mb-1\">{settings?.feature3Title || ''}</h3>\n                                                <p className=\"text-slate-400 text-[11px]\">{settings?.feature3Desc || ''}</p>\n                                            </div>\n                                        )}\n                                    </>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Filtros de Categor√≠a */}\n                        <div id=\"catalog\" className={`sticky top-16 sm:top-20 z-40 backdrop-blur-xl py-3 sm:py-4 mb-6 sm:mb-8 -mx-4 px-4 border-y ${darkMode ? 'bg-[#050505]/80 border-slate-800/50' : 'bg-white/80 border-slate-200'}`}>\n                            <div\n                                ref={categoriesScrollRef}\n                                onMouseDown={handleMouseDownCategories}\n                                onMouseLeave={handleMouseLeaveCategories}\n                                onMouseUp={handleMouseUpCategories}\n                                onMouseMove={handleMouseMoveCategories}\n                                className={`flex items-center gap-2 overflow-x-auto pb-1 ${isDraggingCategories ? 'cursor-grabbing scroll-auto' : 'cursor-grab scroll-smooth'}`}\n                                style={{ scrollbarWidth: 'none', msOverflowStyle: 'none', WebkitOverflowScrolling: 'touch' }}\n                            >\n                                <Filter className={`w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n\n                                {/* BOT√ìN PROMOS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Promos')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-black text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 group relative overflow-hidden flex-shrink-0 ${selectedCategory === 'Promos' ? 'text-white border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.5)]' : darkMode ? 'bg-slate-900 border-slate-800 text-purple-400 hover:text-white hover:border-purple-500/50' : 'bg-purple-50 border-purple-200 text-purple-600 hover:bg-purple-100 hover:border-purple-300'}`}\n                                >\n                                    {selectedCategory === 'Promos' && <div className=\"absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 animate-gradient-xy\"></div>}\n                                    <span className=\"relative z-10 flex items-center gap-1.5 sm:gap-2\"><Sparkles className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> PROMOS</span>\n                                </button>\n\n                                {/* BOT√ìN OFERTAS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Ofertas')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 flex-shrink-0 ${selectedCategory === 'Ofertas' ? 'bg-red-600/20 text-red-500 border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-red-400 hover:text-white hover:border-red-500/50' : 'bg-red-50 border-red-200 text-red-600 hover:bg-red-100 hover:border-red-300'}`}\n                                >\n                                    <Percent className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> OFERTAS\n                                </button>\n\n                                <button onClick={() => setSelectedCategory('')} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === '' ? darkMode ? 'bg-white text-black border-white shadow-[0_0_15px_rgba(255,255,255,0.2)]' : 'bg-slate-900 text-white border-slate-900 shadow-md' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}`}>\n                                    Todos\n                                </button>\n                                {settings?.categories?.map(c => (\n                                    <button key={c} onClick={() => setSelectedCategory(c)} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === c ? 'bg-orange-500 text-white border-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-orange-50 hover:border-orange-300 hover:text-orange-600'}`}>\n                                        {c}\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n\n\n                        {/* SECCI√ìN PROMOS (NUEVO) */}\n                        {/* SECCI√ìN PROMOS (TAB VIEW) */}\n                        {selectedCategory === 'Promos' && (\n                            <div className=\"mb-16 animate-fade-in\">\n                                {promos.length > 0 ? (\n                                    <>\n                                        <h2 className={`text-3xl font-black mb-8 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            <Tag className=\"w-8 h-8 text-purple-500 animate-pulse\" /> PROMOCIONES ESPECIALES\n                                        </h2>\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                                            {promos.map(promo => {\n                                                // Calcular si hay stock para esta promo\n                                                // La disponibilidad depende del \"item\" con menor stock relativo\n                                                let maxPurchasable = Infinity;\n                                                promo.items.forEach(item => {\n                                                    const p = products.find(prod => prod.id === item.productId);\n                                                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                                                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                                                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                                                });\n\n                                                const hasStock = maxPurchasable > 0;\n\n                                                return (\n                                                    <div key={promo.id} className=\"bg-gradient-to-br from-purple-900/10 to-blue-900/10 rounded-[2.5rem] border border-purple-500/30 overflow-hidden group shadow-[0_0_30px_rgba(168,85,247,0.1)] hover:shadow-[0_0_50px_rgba(168,85,247,0.2)] transition duration-500 relative flex flex-col\">\n                                                        <div\n                                                            className=\"aspect-square bg-slate-900/50 flex items-center justify-center relative overflow-hidden cursor-zoom-in\"\n                                                            onClick={() => setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable })}\n                                                        >\n                                                            <img src={promo.image} className=\"w-full h-full object-contain transition duration-700 group-hover:scale-110\" />\n                                                            <div className=\"absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-transparent to-transparent\"></div>\n                                                            <div className=\"absolute top-4 right-4 bg-purple-600 text-white text-xs font-black px-3 py-1 rounded-full uppercase tracking-wider shadow-lg\">\n                                                                Oferta Limitada\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"p-8 flex-1 flex flex-col\">\n                                                            <h3 className=\"text-2xl font-black text-white mb-2 leading-tight\">{promo.name}</h3>\n                                                            <p className=\"text-purple-300 text-sm mb-6 flex-1\">{promo.description}</p>\n\n                                                            {/* Lista de productos incluidos */}\n                                                            <div className=\"mb-6 space-y-2\">\n                                                                <p className=\"text-[10px] uppercase font-bold text-slate-500 tracking-widest\">Incluye:</p>\n                                                                {promo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    return (\n                                                                        <div key={idx} className=\"flex items-center gap-2 text-sm text-slate-400\">\n                                                                            <CheckCircle className=\"w-3 h-3 text-purple-500\" />\n                                                                            <span className=\"text-white font-bold\">{item.quantity}x</span> {p ? p.name : 'Producto'}\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                            </div>\n\n                                                            <div className=\"flex items-center justify-between mt-auto pt-6 border-t border-white/5\">\n                                                                <div className=\"flex flex-col\">\n                                                                    <span className=\"text-slate-500 text-xs font-bold line-through decoration-red-500 decoration-2\">\n                                                                        ${promo.items.reduce((acc, item) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                        }, 0).toLocaleString()}\n                                                                    </span>\n                                                                    <span className=\"text-3xl font-black text-white neon-text text-purple-400\">\n                                                                        ${Number(promo.price).toLocaleString()}\n                                                                    </span>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!hasStock) return showToast(\"Sin stock disponible para esta promo.\", \"warning\");\n                                                                        // L√≥gica especial para agregar Promo al carrito\n                                                                        // Tratamos la promo como un \"producto\" pero con un flag especial\n                                                                        const promoProduct = {\n                                                                            id: promo.id,\n                                                                            name: promo.name,\n                                                                            basePrice: promo.price,\n                                                                            image: promo.image,\n                                                                            isPromo: true,\n                                                                            items: promo.items, // Guardamos la def de items para validar stock\n                                                                            stock: maxPurchasable // Stock virtual calculado\n                                                                        };\n                                                                        manageCart(promoProduct, 1);\n                                                                    }}\n                                                                    disabled={!hasStock}\n                                                                    className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition shadow-lg ${hasStock ? 'bg-white text-black hover:bg-purple-400 hover:text-white hover:scale-105' : 'bg-slate-800 text-slate-500 cursor-not-allowed'}`}\n                                                                >\n                                                                    {hasStock ? <ShoppingCart className=\"w-5 h-5\" /> : <X className=\"w-5 h-5\" />}\n                                                                    {hasStock ? 'AGREGAR' : 'AGOTADO'}\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                );\n                                            })}\n                                        </div>\n                                    </>\n                                ) : (\n                                    <div className=\"flex flex-col items-center justify-center p-20 text-center border border-dashed border-slate-800 rounded-[3rem] bg-slate-950/30\">\n                                        <div className=\"p-8 bg-slate-900 rounded-full mb-6 shadow-2xl border border-slate-800\">\n                                            <Tag className=\"w-16 h-16 text-slate-600\" />\n                                        </div>\n                                        <h3 className=\"text-2xl font-black text-white mb-2\">Sin Promociones Activas</h3>\n                                        <p className=\"text-slate-500 max-w-sm\">No hay promociones disponibles en este momento. ¬°Volv√© pronto!</p>\n                                        <button\n                                            onClick={() => setSelectedCategory('')}\n                                            className=\"mt-6 px-6 py-3 bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 rounded-xl font-bold transition border border-orange-500/20\"\n                                        >\n                                            Ver Todo el Cat√°logo\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Grid de Productos - Filtrando productos inv√°lidos (ej: tests) */}\n                        {products.filter(p => p.isActive !== false).length === 0 ? (\n                            // Empty State expl√≠cito (sin componente externo para \"bulk\")\n                            <div className=\"flex flex-col items-center justify-center p-20 text-center border-2 border-dashed border-slate-800 rounded-[3rem] bg-slate-950/30\">\n                                <div className=\"p-8 bg-slate-900 rounded-full mb-6 shadow-2xl border border-slate-800\">\n                                    <Package className=\"w-16 h-16 text-slate-600\" />\n                                </div>\n                                <h3 className=\"text-2xl font-black text-white mb-2\">Cat√°logo Vac√≠o</h3>\n                                <p className=\"text-slate-500 max-w-sm\">No hay productos disponibles en este momento. Por favor revisa m√°s tarde o contacta soporte.</p>\n                            </div>\n                        ) : (\n                            <>\n                                {filteredProducts.length === 0 && selectedCategory !== 'Promos' && (\n                                    <div className=\"flex flex-col items-center justify-center p-20 text-center col-span-full animate-fade-in w-full\">\n                                        <div className=\"p-6 bg-slate-900/50 rounded-full mb-4 inline-block border border-slate-800\">\n                                            <Search className=\"w-12 h-12 text-slate-500\" />\n                                        </div>\n                                        <h3 className=\"text-xl font-bold text-white mb-2\">No se encontraron resultados</h3>\n                                        <p className=\"text-slate-500 mb-6 max-w-md mx-auto\">\n                                            No hay productos que coincidan con <span className=\"text-white font-bold\">\"{searchQuery}\"</span>\n                                            {selectedCategory && <span> en la categor√≠a <span className=\"text-white font-bold\">{selectedCategory}</span></span>}.\n                                        </p>\n                                        <button\n                                            onClick={() => { setSearchQuery(''); setSelectedCategory(''); }}\n                                            className=\"px-6 py-3 bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 rounded-xl font-bold transition border border-orange-500/20\"\n                                        >\n                                            Limpiar filtros\n                                        </button>\n                                    </div>\n                                )}\n                                <div className=\"grid grid-cols-1 min-[380px]:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 min-[1920px]:grid-cols-5 gap-3 sm:gap-6 md:gap-8 pb-32\">\n                                    {filteredProducts.map(p => (\n                                        <ProductCard\n                                            key={p.id}\n                                            p={p}\n                                            settings={settings}\n                                            currentUser={currentUser}\n                                            toggleFavorite={toggleFavorite}\n                                            setSelectedProduct={setSelectedProduct}\n                                            manageCart={manageCart}\n                                            calculateItemPrice={calculateItemPrice}\n                                            darkMode={darkMode}\n                                        />\n                                    ))}\n                                </div>\n\n                            </>\n                        )}\n                    </div>\n                )}\n\n                {/* 2. VISTA DEL CARRITO DE COMPRAS */}\n                {view === 'cart' && (\n                    <div className=\"max-w-6xl mx-auto animate-fade-up px-4 md:px-8 pb-20\">\n                        <div className=\"flex flex-col gap-4 mb-8 pt-8 sm:flex-row sm:items-center sm:justify-between\">\n                            <div className=\"flex items-center gap-4\">\n                                <button onClick={() => setView('store')} className=\"p-3 bg-slate-900 rounded-full text-slate-400 hover:text-white transition hover:bg-slate-800 group\">\n                                    <ArrowLeft className=\"w-6 h-6 group-hover:-translate-x-1 transition\" />\n                                </button>\n                                <h1 className={`text-4xl font-black flex items-center gap-3 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                    <ShoppingBag className=\"w-10 h-10 text-orange-500\" /> Mi Carrito\n                                </h1>\n                            </div>\n\n                            {cart.length > 0 && settings?.showCartWhatsappCheckout === true && (\n                                <button\n                                    onClick={() => {\n                                        const url = buildWhatsappUrl(settings?.whatsappLink, buildWhatsappCartMessage());\n                                        if (!url) {\n                                            showToast('Configura el enlace de WhatsApp en Admin ‚Üí Configuraci√≥n ‚Üí Social.', 'warning');\n                                            return;\n                                        }\n                                        window.open(url, '_blank');\n                                    }}\n                                    className=\"w-full sm:w-auto px-5 py-3 bg-green-600 hover:bg-green-500 text-white rounded-2xl font-black transition shadow-lg hover:shadow-green-500/30 flex items-center justify-center gap-2\"\n                                >\n                                    <MessageCircle className=\"w-5 h-5\" /> Terminar compra por WhatsApp\n                                </button>\n                            )}\n                        </div>\n\n                        {cart.length === 0 ? (\n                            <div className={`flex flex-col items-center justify-center p-16 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                <div className={`p-8 rounded-full mb-6 shadow-xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <ShoppingCart className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                </div>\n                                <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Tu carrito est√° vac√≠o</h3>\n                                <p className=\"text-slate-500 text-sm max-w-xs mb-8 leading-relaxed\">\n                                    ¬°Es un buen momento para buscar ese producto que tanto quieres!\n                                </p>\n                                <button onClick={() => setView('store')} className=\"px-8 py-4 bg-orange-600 text-white rounded-xl font-bold transition shadow-lg hover:bg-orange-500 hover:shadow-orange-500/30 flex items-center gap-2\">\n                                    Ir a la Tienda <ArrowRight className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        ) : (\n                            <div className=\"grid lg:grid-cols-3 gap-8\">\n                                {/* Lista de Items */}\n                                <div className=\"lg:col-span-2 space-y-4\">\n                                    {cart.map((item) => (\n                                        <div key={item.product.id} className=\"bg-[#0a0a0a] border border-slate-800 p-4 md:p-6 rounded-3xl flex flex-col md:flex-row gap-6 items-center group relative overflow-hidden hover:border-orange-900/50 transition duration-300\">\n                                            {/* Imagen */}\n                                            <div className=\"w-full md:w-32 h-32 bg-white rounded-2xl flex items-center justify-center p-2 flex-shrink-0 shadow-lg\">\n                                                <img src={item.product.image} alt={item.product.name} className=\"w-full h-full object-contain\" />\n                                            </div>\n\n                                            {/* Info */}\n                                            <div className=\"flex-1 w-full text-center md:text-left z-10\">\n                                                <div className=\"flex justify-between items-start w-full\">\n                                                    <h3 className=\"font-bold text-white text-lg truncate mb-1 pr-4\">{item.product.name}</h3>\n                                                    <button onClick={() => manageCart(item.product, -item.quantity)} className=\"text-slate-600 hover:text-red-500 transition p-2 bg-slate-900 rounded-lg hover:bg-red-900/20\">\n                                                        <Trash2 className=\"w-5 h-5\" />\n                                                    </button>\n                                                </div>\n\n                                                <p className=\"text-orange-400 font-bold text-sm mb-4\">\n                                                    ${calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0).toLocaleString()} <span className=\"text-slate-600 font-normal\">unitario</span>\n                                                </p>\n\n                                                {/* Controles de Cantidad */}\n                                                <div className=\"flex items-center justify-center md:justify-start gap-4\">\n                                                    <div className=\"flex items-center gap-3 bg-slate-900 rounded-xl p-1 border border-slate-700\">\n                                                        <button onClick={() => manageCart(item.product, -1)} className=\"w-10 h-10 flex items-center justify-center hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition\">\n                                                            <Minus className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <span className=\"text-base font-bold w-8 text-center text-white\">{item.quantity}</span>\n                                                        <button onClick={() => manageCart(item.product, 1)} className=\"w-10 h-10 flex items-center justify-center hover:bg-slate-800 rounded-lg text-slate-400 hover:text-white transition\">\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                    <div className=\"hidden md:block h-8 w-px bg-slate-800 mx-2\"></div>\n                                                    <p className=\"text-xs text-slate-500 font-bold uppercase hidden md:block\">\n                                                        Subtotal: <span className=\"text-white text-lg ml-1\">${(calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0) * (item.quantity || 0)).toLocaleString()}</span>\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n\n                                {/* Resumen y Checkout */}\n                                <div className={`border p-8 rounded-[2.5rem] h-fit sticky top-28 shadow-2xl ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`text-2xl font-black mb-8 border-b pb-4 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>Resumen de Compra</h3>\n\n                                    {/* Secci√≥n de Cupones */}\n                                    <div className=\"mb-8\">\n                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 block flex items-center gap-2\">\n                                            <Tag className=\"w-4 h-4\" /> Cup√≥n de Descuento\n                                        </label>\n                                        {appliedCoupon ? (\n                                            <div className=\"bg-purple-900/20 border border-purple-500/30 p-4 rounded-2xl flex justify-between items-center relative overflow-hidden group animate-fade-up\">\n                                                <div className=\"absolute inset-0 bg-purple-500/5 group-hover:bg-purple-500/10 transition\"></div>\n                                                <div className=\"relative z-10\">\n                                                    <p className=\"font-black text-purple-300 text-lg tracking-widest\">{appliedCoupon.code}</p>\n                                                    <p className=\"text-xs text-purple-400 font-bold\">\n                                                        {appliedCoupon.type === 'fixed' ? `$${appliedCoupon.value} OFF` : `${appliedCoupon.value}% OFF`}\n                                                    </p>\n                                                </div>\n                                                <button onClick={() => setAppliedCoupon(null)} className=\"p-2 bg-slate-900/50 rounded-full text-purple-300 hover:text-red-400 hover:bg-red-900/30 transition relative z-10 border border-transparent hover:border-red-500/30\">\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                </button>\n                                            </div>\n                                        ) : (\n                                            <button onClick={() => setShowCouponModal(true)} className=\"w-full py-4 border border-dashed border-slate-700 hover:border-purple-500 bg-slate-900/30 hover:bg-purple-900/10 text-slate-400 hover:text-purple-300 rounded-2xl transition flex items-center justify-center gap-2 text-sm font-bold group\">\n                                                <Ticket className=\"w-5 h-5 group-hover:rotate-12 transition\" /> Ver cupones disponibles\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Desglose de Precios */}\n                                    <div className={`space-y-4 border-b pb-8 mb-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                        <div className={`flex justify-between font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Subtotal</span>\n                                            <span className={`font-mono font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n                                        <div className={`flex justify-between text-sm font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Env√≠o {checkoutData.shippingMethod === 'Delivery' ? '(A domicilio)' : '(Retiro)'}</span>\n                                            <span className=\"text-orange-500 font-bold flex items-center gap-1\">\n                                                <Truck className=\"w-3 h-3\" />\n                                                {shippingFee > 0 ? `$${shippingFee.toLocaleString()}` : (checkoutData.shippingMethod === 'Pickup' ? 'Gratis' : '¬°Env√≠o Gratis!')}\n                                            </span>\n                                        </div>\n                                        {appliedCoupon && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold text-sm animate-pulse bg-purple-900/10 p-2 rounded-lg\">\n                                                <span>Descuento aplicado</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Total Final */}\n                                    <div className=\"flex justify-between items-end mb-8\">\n                                        <span className={`font-bold text-lg ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total Final</span>\n                                        <span className={`text-4xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                            ${finalTotal.toLocaleString()}\n                                        </span>\n                                    </div>\n\n                                    {/* Bot√≥n Acci√≥n */}\n                                    <button onClick={() => setView('checkout')} className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-5 text-white font-bold text-lg rounded-2xl shadow-[0_0_25px_rgba(249,115,22,0.3)] hover:shadow-[0_0_35px_rgba(249,115,22,0.5)] transition-all flex items-center justify-center gap-3 transform hover:-translate-y-1\">\n                                        Iniciar Compra <ArrowRight className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                )}\n\n                {/* 3. VISTA DE CHECKOUT (FINALIZAR COMPRA) */}\n                {view === 'checkout' && (\n                    <div className=\"max-w-5xl mx-auto pb-20 animate-fade-up px-4 md:px-8\">\n                        <button onClick={() => setView('cart')} className=\"mb-8 mt-8 text-slate-400 hover:text-white flex items-center gap-2 font-bold transition\">\n                            <ArrowLeft className=\"w-5 h-5\" /> Volver al Carrito\n                        </button>\n\n                        <div className=\"grid md:grid-cols-5 gap-8\">\n                            {/* Columna Izquierda: Formularios */}\n                            <div className=\"md:col-span-3 space-y-8\">\n\n                                {/* Opciones de Entrega */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <Truck className=\"text-orange-500 w-6 h-6\" /> M√©todo de Entrega\n                                    </h2>\n                                    <div className=\"grid grid-cols-2 gap-4 relative z-10 mb-6\">\n                                        {settings?.shippingPickup?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Pickup' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Pickup' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Pickup' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <MapPin className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Retiro en Local</span>\n                                            </button>\n                                        )}\n                                        {settings?.shippingDelivery?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Delivery' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Delivery' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Delivery' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <Truck className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Env√≠o a Domicilio</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {checkoutData.shippingMethod === 'Pickup' && (\n                                        <div className=\"p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl animate-fade-up flex gap-3\">\n                                            <Info className=\"w-5 h-5 text-orange-400 shrink-0\" />\n                                            <p className=\"text-xs text-orange-200\">Retira tu pedido en: <span className=\"font-bold\">{settings?.shippingPickup?.address || 'Direcci√≥n a coordinar'}</span></p>\n                                        </div>\n                                    )}\n\n                                    {checkoutData.shippingMethod === 'Delivery' && (\n                                        <div className=\"space-y-5 relative z-10 animate-fade-up mt-4\">\n                                            <h3 className=\"text-sm font-bold text-slate-400 uppercase tracking-widest pl-2\">Datos de Destino</h3>\n                                            <div>\n                                                <label className=\"text-xs font-bold text-slate-500 uppercase ml-2 mb-1 block\">Direcci√≥n y Altura</label>\n                                                <input\n                                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-600 focus:border-orange-500 focus:ring-1 focus:ring-orange-500 outline-none transition font-medium\"\n                                                    placeholder=\"Ej: Av. Santa Fe 1234\"\n                                                    value={checkoutData.address || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, address: e.target.value })}\n                                                />\n                                            </div>\n                                            <div className=\"grid grid-cols-2 gap-5\">\n                                                <div>\n                                                    <label className=\"text-xs font-bold text-slate-500 uppercase ml-2 mb-1 block\">Ciudad</label>\n                                                    <input\n                                                        className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-600 focus:border-orange-500 outline-none transition font-medium\"\n                                                        placeholder=\"Ej: Rosario\"\n                                                        value={checkoutData.city || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, city: e.target.value })}\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <label className=\"text-xs font-bold text-slate-500 uppercase ml-2 mb-1 block\">Provincia</label>\n                                                    <input\n                                                        className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-600 focus:border-orange-500 outline-none transition font-medium\"\n                                                        placeholder=\"Ej: Santa Fe\"\n                                                        value={checkoutData.province || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, province: e.target.value })}\n                                                    />\n                                                </div>\n                                            </div>\n                                            <div>\n                                                <label className=\"text-xs font-bold text-slate-500 uppercase ml-2 mb-1 block\">C√≥digo Postal</label>\n                                                <input\n                                                    className=\"w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-white placeholder-slate-600 focus:border-orange-500 outline-none transition font-medium\"\n                                                    placeholder=\"Ej: 2000\"\n                                                    value={checkoutData.zipCode || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, zipCode: e.target.value })}\n                                                />\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* M√©todo de Pago */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <CreditCard className=\"text-orange-500 w-6 h-6\" /> M√©todo de Pago\n                                    </h2>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10\">\n                                        {settings?.paymentMercadoPago?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Tarjeta' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Tarjeta' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Tarjeta' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <CreditCard className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Tarjeta</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentTransfer?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Transferencia' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Transferencia' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Transferencia' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <RefreshCw className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Transferencia</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentCash && checkoutData.shippingMethod !== 'Delivery' && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Efectivo' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Efectivo' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Efectivo' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <Banknote className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Efectivo</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Card Payment Brick Container - Solo para Tarjeta */}\n                                    {checkoutData.paymentChoice === 'Tarjeta' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/30\">\n                                                <h3 className=\"text-white font-bold mb-4 flex items-center gap-2\">\n                                                    <CreditCard className=\"w-5 h-5 text-orange-400\" />\n                                                    Ingres√° los datos de tu tarjeta\n                                                </h3>\n                                                <p className=\"text-slate-400 text-sm mb-4\">\n                                                    Pag√° de forma segura con Visa, MasterCard, AMEX y m√°s.\n                                                </p>\n\n                                                {/* WARNING: AD BLOCKER */}\n                                                <div className=\"mb-6 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <AlertCircle className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        <strong className=\"text-orange-400 block mb-1\">ATENCI√ìN:</strong>\n                                                        Si ten√©s activado un <span className=\"text-white font-bold\">AdBlocker/Bloqueador de Anuncios</span>, por favor desactivalo temporalmente.\n                                                        Es posible que el pago no se concrete si el bloqueador interfiere con la seguridad del banco.\n                                                    </p>\n                                                </div>\n\n                                                {/* Contenedor del Card Payment Brick de Mercado Pago */}\n                                                <div id=\"cardPaymentBrick_container\" ref={cardPaymentBrickRef} className=\"min-h-[400px]\"></div>\n\n                                                {/* Mensaje de error si hay */}\n                                                {paymentError && (\n                                                    <div className=\"mt-4 space-y-3\">\n                                                        <div className=\"p-4 bg-red-900/20 border border-red-500/30 rounded-xl text-red-400 text-sm flex items-center gap-3\">\n                                                            <AlertTriangle className=\"w-5 h-5 flex-shrink-0\" />\n                                                            {paymentError}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => {\n                                                                setPaymentError(null);\n                                                                initializeCardPaymentBrick();\n                                                            }}\n                                                            className=\"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2\"\n                                                        >\n                                                            <RefreshCw className=\"w-4 h-4\" />\n                                                            Reintentar Pago\n                                                        </button>\n                                                    </div>\n                                                )}\n\n                                                {/* Indicador de procesamiento */}\n                                                {isPaymentProcessing && (\n                                                    <div className=\"mt-4 p-4 bg-orange-900/20 border border-orange-500/30 rounded-xl text-orange-400 text-sm flex items-center gap-3\">\n                                                        <Loader2 className=\"w-5 h-5 animate-spin flex-shrink-0\" />\n                                                        Procesando tu pago, por favor esper√°...\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    )}\n                                    {checkoutData.paymentChoice === 'Transferencia' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/20\">\n                                                <h3 className=\"text-white font-bold mb-3 flex items-center gap-2\">\n                                                    <Building className=\"w-5 h-5 text-orange-400\" />\n                                                    Datos para transferir\n                                                </h3>\n                                                <div className=\"space-y-2 text-sm\">\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Titular</span>\n                                                        <span className=\"text-white font-medium text-right break-all\">{settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Alias</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">CBU</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu) : 'Sin configurar'}</span>\n                                                    </div>\n                                                </div>\n                                                <div className=\"mt-4 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <Info className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        Una vez realizada la transferencia, confirm√° el pedido. Si necesit√°s coordinar el comprobante, te contactamos por WhatsApp si est√° disponible.\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna Derecha: Confirmaci√≥n */}\n                            <div className=\"md:col-span-2\">\n                                <div className={`border p-8 rounded-[2.5rem] sticky top-28 shadow-2xl ${darkMode ? 'bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`font-black mb-8 text-xl border-b pb-4 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-100'}`}>Resumen Final</h3>\n\n                                    <div className=\"space-y-4 mb-8\">\n                                        <div className={`flex justify-between ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                            <span>Productos ({cart.length})</span>\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n\n                                        {discountAmount > 0 && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold\">\n                                                <span>Descuento</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n\n                                        <div className={`h-px my-4 border-t border-dashed ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}></div>\n\n                                        <div className=\"flex justify-between items-end\">\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total a Pagar</span>\n                                            <span className={`text-3xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>${finalTotal.toLocaleString()}</span>\n                                        </div>\n                                    </div>\n\n                                    {/* Bot√≥n Confirmar - Solo para Efectivo o Transferencia (NO para Tarjeta) */}\n                                    {checkoutData.paymentChoice && checkoutData.paymentChoice !== 'Tarjeta' ? (\n                                        <>\n                                            <button\n                                                onClick={confirmOrder}\n                                                disabled={isProcessingOrder}\n                                                className={`w-full py-5 text-white font-bold text-lg rounded-2xl shadow-xl flex items-center justify-center gap-3 transition-all ${isProcessingOrder ? 'bg-slate-700 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500 shadow-green-900/20 hover:scale-[1.02]'}`}\n                                            >\n                                                {isProcessingOrder ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <CheckCircle className=\"w-6 h-6\" />}\n                                                {isProcessingOrder ? 'Procesando...' : 'Confirmar Pedido'}\n                                            </button>\n\n                                            <p className=\"text-center text-slate-600 text-xs mt-6 leading-relaxed px-4\">\n                                                Al confirmar, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad.\n                                            </p>\n                                        </>\n                                    ) : checkoutData.paymentChoice === 'Tarjeta' ? (\n                                        <div className=\"bg-orange-900/10 border border-orange-500/20 p-4 rounded-2xl text-center\">\n                                            <p className=\"text-orange-400 text-sm font-medium flex items-center justify-center gap-2\">\n                                                <CreditCard className=\"w-4 h-4\" />\n                                                Complet√° los datos de tu tarjeta arriba para pagar\n                                            </p>\n                                            <p className=\"text-slate-500 text-xs mt-2\">\n                                                Tu compra quedar√° confirmada autom√°ticamente al procesar el pago.\n                                            </p>\n                                        </div>\n                                    ) : null}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 4. VISTA DE PERFIL (HISTORIAL Y FAVORITOS) - Solo si el usuario tiene datos v√°lidos */}\n                {view === 'profile' && currentUser && currentUser.id && currentUser.email && currentUser.name && (\n                    <div className=\"max-w-6xl mx-auto pt-8 animate-fade-up px-4 md:px-8 pb-20\">\n                        {/* Tarjeta de Usuario */}\n                        <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 md:p-12 rounded-[3rem] mb-12 flex flex-col md:flex-row items-center gap-8 relative overflow-hidden shadow-2xl\">\n                            {/* Decoraci√≥n Fondo */}\n                            {/* Decoraci√≥n Fondo */}\n                            <div className=\"absolute top-0 right-0 w-96 h-96 bg-orange-500/5 rounded-full blur-[120px] pointer-events-none\"></div>\n                            <div className=\"absolute bottom-0 left-0 w-64 h-64 bg-blue-600/5 rounded-full blur-[100px] pointer-events-none\"></div>\n\n                            {/* Avatar */}\n                            <div className=\"w-28 h-28 rounded-[2rem] bg-gradient-to-br from-orange-500 to-blue-600 flex items-center justify-center text-5xl font-black text-white shadow-2xl z-10 transform rotate-3 border-4 border-[#0a0a0a]\">\n                                {currentUser.name.charAt(0)}\n                            </div>\n\n                            {/* Info */}\n                            <div className=\"text-center md:text-left z-10 flex-1\">\n                                <h2 className=\"text-4xl md:text-5xl font-black text-white mb-2 tracking-tight\">{currentUser.name}</h2>\n                                <p className=\"text-slate-400 flex items-center justify-center md:justify-start gap-2 font-medium mb-4\">\n                                    <Mail className=\"w-4 h-4 text-orange-500\" /> {currentUser.email}\n                                </p>\n                                <div className=\"flex flex-wrap gap-4 justify-center md:justify-start\">\n                                    <span className=\"bg-slate-900 border border-slate-800 px-4 py-2 rounded-xl text-xs text-slate-500 font-mono flex items-center gap-2\">\n                                        <User className=\"w-3 h-3\" /> {currentUser.dni || 'Sin DNI'}\n                                    </span>\n                                    <span className=\"bg-slate-900 border border-slate-800 px-4 py-2 rounded-xl text-xs text-slate-500 font-mono flex items-center gap-2\">\n                                        <Phone className=\"w-3 h-3\" /> {currentUser.phone || 'Sin Tel√©fono'}\n                                    </span>\n                                    <span className=\"bg-slate-900 border border-slate-800 px-4 py-2 rounded-xl text-xs text-slate-500 font-mono flex items-center gap-2\">\n                                        <Shield className=\"w-3 h-3\" /> {getRole(currentUser.email).toUpperCase()}\n                                    </span>\n                                </div>\n                            </div>\n\n                            {/* Acciones */}\n                            <div className=\"flex flex-col gap-3 z-10 w-full md:w-auto\">\n                                {hasAccess(currentUser.email) && (\n                                    <button onClick={() => setView('admin')} className=\"px-6 py-4 bg-slate-900 border border-orange-500/30 text-orange-400 hover:bg-orange-900/20 rounded-2xl font-bold transition flex items-center justify-center gap-2 shadow-lg hover:shadow-orange-500/10\">\n                                        <Shield className=\"w-5 h-5\" /> Panel Admin\n                                    </button>\n                                )}\n                                <button onClick={() => { localStorage.removeItem('sustore_user_data'); setCurrentUser(null); setView('store') }} className=\"px-6 py-4 bg-red-900/10 border border-red-500/20 text-red-500 hover:bg-red-900/20 rounded-2xl font-bold transition flex items-center justify-center gap-2 hover:border-red-500/40\">\n                                    <LogOut className=\"w-5 h-5\" /> Cerrar Sesi√≥n\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* SECCI√ìN: MIS CUPONES (NUEVO) */}\n                        <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] mb-12 shadow-2xl animate-fade-up\">\n                            <h3 className=\"text-2xl font-black text-white mb-6 flex items-center gap-3\">\n                                <Ticket className=\"text-purple-400 w-6 h-6\" /> Mis Cupones Disponibles\n                            </h3>\n\n                            <div className=\"grid md:grid-cols-2 gap-8\">\n                                <div className=\"space-y-4\">\n                                    {/* Mostrar cupones GLOBALES (targetType='global') y ESPECIFICOS para este usuario */}\n                                    {(() => {\n                                        const myCoupons = coupons.filter(c =>\n                                            (c.targetType === 'global') ||\n                                            (c.targetType === 'specific_email' && c.targetUser === currentUser.email)\n                                        );\n\n                                        if (myCoupons.length === 0) return <p className=\"text-slate-500 italic\">No tienes cupones disponibles en este momento.</p>;\n\n                                        return myCoupons.map(c => (\n                                            <div key={c.id} className=\"bg-slate-900/50 border border-slate-800 p-4 rounded-xl flex items-center justify-between group hover:border-purple-500/30 transition\">\n                                                <div>\n                                                    <p className=\"font-black text-white text-lg tracking-widest\">{c.code}</p>\n                                                    <p className=\"text-purple-400 text-sm font-bold\">\n                                                        {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                    </p>\n                                                    {c.expirationDate && <p className=\"text-[10px] text-slate-500 mt-1\">Vence: {c.expirationDate}</p>}\n                                                </div>\n                                                <button\n                                                    onClick={() => {\n                                                        navigator.clipboard.writeText(c.code);\n                                                        showToast(\"C√≥digo copiado\", \"success\");\n                                                    }}\n                                                    className=\"px-4 py-2 bg-purple-900/20 text-purple-400 rounded-lg text-xs font-bold hover:bg-purple-500 hover:text-white transition border border-purple-500/20\"\n                                                >\n                                                    COPIAR\n                                                </button>\n                                            </div>\n                                        ));\n                                    })()}\n                                </div>\n\n                                <div className=\"bg-slate-900/30 p-6 rounded-2xl border border-slate-800\">\n                                    <h4 className=\"font-bold text-white mb-4 text-sm uppercase tracking-wider\">Canjear C√≥digo</h4>\n                                    <div className=\"flex gap-2\">\n                                        <input\n                                            className=\"flex-1 bg-slate-950 border border-slate-800 rounded-xl p-3 text-white focus:border-purple-500 outline-none uppercase font-mono\"\n                                            placeholder=\"C√ìDIGO\"\n                                            id=\"couponRedeemInput\"\n                                        />\n                                        <button\n                                            onClick={() => {\n                                                const input = document.getElementById('couponRedeemInput');\n                                                const code = String(input?.value || '').trim().toUpperCase();\n                                                if (!code) return showToast(\"Ingresa un c√≥digo\", \"warning\");\n                                                const coupon = coupons.find(c => c.code === code);\n                                                if (coupon) {\n                                                    showToast(\"¬°Cup√≥n v√°lido! √ösalo en el checkout.\", \"success\");\n                                                } else {\n                                                    showToast(\"Cup√≥n no encontrado o inv√°lido\", \"error\");\n                                                }\n                                            }}\n                                            className=\"bg-purple-600 px-6 rounded-xl text-white font-bold hover:bg-purple-500 transition shadow-lg\"\n                                        >\n                                            Validar\n                                        </button>\n                                    </div>\n                                    <p className=\"text-xs text-slate-500 mt-3 leading-relaxed\">\n                                        Ingresa el c√≥digo aqu√≠ para verificar si es v√°lido. Ll√©valo al checkout para aplicar el descuento.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"grid lg:grid-cols-2 gap-10\">\n                            {/* Columna Izquierda: Historial de Pedidos */}\n                            <div className=\"space-y-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                        <ShoppingBag className=\"text-orange-400 w-6 h-6\" /> Tus Compras\n                                    </h3>\n                                </div>\n\n                                {(() => {\n                                    const completedOrders = orders.filter(o => o.userId === currentUser.id && o.status === 'Realizado');\n                                    // Flatten all items from completed orders\n                                    const purchasedItems = completedOrders.flatMap(o => o.items.map(item => ({ ...item, date: o.date })));\n\n                                    if (purchasedItems.length === 0) {\n                                        return (\n                                            <div className=\"p-12 border-2 border-dashed border-slate-800 rounded-[2rem] text-center text-slate-500 bg-slate-900/20\">\n                                                <ShoppingBag className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                                <p className=\"font-bold\">A√∫n no tienes compras finalizadas.</p>\n                                                <button onClick={() => setView('store')} className=\"mt-4 text-orange-400 hover:underline text-sm font-bold\">Ir a la tienda</button>\n                                            </div>\n                                        );\n                                    }\n\n                                    return (\n                                        <div className=\"grid grid-cols-1 gap-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                            {purchasedItems.sort((a, b) => new Date(b.date) - new Date(a.date)).map((item, idx) => (\n                                                <div key={idx} className=\"bg-[#0a0a0a] border border-slate-800 p-4 rounded-2xl flex items-center gap-4 group hover:border-orange-500/50 transition duration-300\">\n                                                    <div className=\"w-16 h-16 bg-white rounded-xl p-1 flex-shrink-0\">\n                                                        <img src={item.image} className=\"w-full h-full object-contain\" alt={item.title} />\n                                                    </div>\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <h4 className=\"text-white font-bold text-sm truncate group-hover:text-orange-400 transition\">{item.title}</h4>\n                                                        <p className=\"text-xs text-slate-500 font-mono mt-1\">{new Date(item.date).toLocaleDateString()}</p>\n                                                    </div>\n                                                    <div className=\"text-right flex flex-col items-end gap-1\">\n                                                        <p className=\"text-white font-black\">${item.unit_price.toLocaleString()}</p>\n                                                        {item.quantity > 1 && (\n                                                            <span className=\"text-[10px] text-slate-500 font-bold\">x{item.quantity} und.</span>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })()}\n                            </div>\n\n                            {/* Columna Derecha: Favoritos */}\n                            <div className=\"space-y-6\">\n\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                        <Heart className=\"text-red-500 w-6 h-6 fill-current\" /> Mis Favoritos\n                                    </h3>\n                                    <span className=\"text-xs font-bold text-slate-500 bg-slate-900 px-3 py-1 rounded-full\">\n                                        {currentUser.favorites?.length || 0} Guardados\n                                    </span>\n                                </div>\n\n                                {!currentUser.favorites || currentUser.favorites.length === 0 ? (\n                                    <div className=\"p-12 border-2 border-dashed border-slate-800 rounded-[2rem] text-center text-slate-500 bg-slate-900/20\">\n                                        <Heart className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                        <p className=\"font-bold\">Tu lista de deseos est√° vac√≠a.</p>\n                                        <p className=\"text-xs mt-2 max-w-xs mx-auto\">Guarda productos haciendo click en el coraz√≥n de las tarjetas.</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                        {currentUser.favorites.map(fid => {\n                                            const p = products.find(prod => prod.id === fid);\n                                            if (!p) return null;\n                                            return (\n                                                <div key={fid} className=\"bg-[#0a0a0a] border border-slate-800 p-4 rounded-2xl flex items-center gap-4 relative group hover:border-slate-600 transition\">\n                                                    <div className=\"w-16 h-16 bg-white rounded-xl p-1 flex-shrink-0\">\n                                                        <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                    </div>\n\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <p className=\"font-bold text-white line-clamp-1 group-hover:text-orange-400 transition\">{p.name}</p>\n                                                        <p className=\"text-orange-400 font-bold text-sm mt-1\">${p.basePrice.toLocaleString()}</p>\n                                                    </div>\n\n                                                    <div className=\"flex gap-2\">\n                                                        <button\n                                                            onClick={() => toggleFavorite(p)}\n                                                            className=\"p-3 bg-slate-900 text-red-400 hover:bg-red-900/20 rounded-xl transition border border-slate-800 hover:border-red-500/30\"\n                                                            title=\"Eliminar de favoritos\"\n                                                        >\n                                                            <Trash2 className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => manageCart(p, 1)}\n                                                            className=\"p-3 bg-slate-900 text-orange-400 hover:bg-orange-900/20 rounded-xl transition border border-slate-800 hover:border-orange-500/30\"\n                                                            title=\"Agregar al carrito\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Fallback: Si intenta acceder a profile sin usuario v√°lido, mostrar login */}\n                {view === 'profile' && (!currentUser || !currentUser.id || !currentUser.email || !currentUser.name) && (\n                    <div className=\"max-w-md mx-auto pt-20 animate-fade-up px-4 text-center\">\n                        <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] shadow-2xl\">\n                            <User className=\"w-16 h-16 mx-auto mb-6 text-orange-500 opacity-50\" />\n                            <h2 className=\"text-2xl font-black text-white mb-4\">Inicia Sesi√≥n</h2>\n                            <p className=\"text-slate-400 mb-8\">Debes iniciar sesi√≥n o registrarte para acceder a tu perfil.</p>\n                            <button\n                                onClick={() => setView('login')}\n                                className=\"w-full py-4 bg-gradient-to-r from-orange-500 to-blue-600 text-white rounded-2xl font-black hover:from-orange-400 hover:to-blue-500 transition shadow-lg\"\n                            >\n                                INICIAR SESI√ìN\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 5. MODAL DE AUTENTICACI√ìN (LOGIN/REGISTER) */}\n                {(view === 'login' || view === 'register') && (\n                    <div className=\"fixed inset-0 z-[20002] flex items-center justify-center bg-[#050505]/95 p-4 animate-fade-up backdrop-blur-xl\">\n\n                        <div className=\"bg-[#0a0a0a] p-8 md:p-12 rounded-[3rem] w-full max-w-md shadow-2xl border border-slate-800 relative overflow-hidden\">\n                            {/* Bot√≥n Cerrar (Dentro de la tarjeta) */}\n                            <button onClick={() => setView('store')} className=\"absolute top-6 right-6 p-2 bg-slate-900/50 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition z-20\">\n                                <X className=\"w-6 h-6\" />\n                            </button>\n\n                            <div className=\"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 via-orange-600 to-red-600\"></div>\n\n                            <h2 className=\"text-4xl font-black text-white mb-2 text-center tracking-tight\">\n                                {loginMode ? 'Bienvenido' : 'Crear Cuenta'}\n                            </h2>\n                            <p className=\"text-slate-500 text-center mb-8 text-sm\">\n                                {loginMode ? 'Ingresa a tu cuenta para continuar.' : '√önete a nosotros hoy mismo.'}\n                            </p>\n\n                            <form onSubmit={(e) => { e.preventDefault(); handleAuth(!loginMode) }} className=\"space-y-4\">\n                                {!loginMode && (\n                                    <div className=\"space-y-4 animate-fade-up\">\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre Completo *\" value={authData.name} onChange={e => setAuthData({ ...authData, name: e.target.value })} required />\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de Usuario *\" value={authData.username} onChange={e => setAuthData({ ...authData, username: e.target.value })} required />\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <input className=\"input-cyber p-4\" placeholder=\"DNI *\" value={authData.dni} onChange={e => setAuthData({ ...authData, dni: e.target.value })} required />\n                                            <input className=\"input-cyber p-4\" placeholder=\"Tel√©fono *\" value={authData.phone} onChange={e => setAuthData({ ...authData, phone: e.target.value })} required />\n                                        </div>\n                                    </div>\n                                )}\n\n                                <div className=\"space-y-4\">\n                                    <input className=\"input-cyber w-full p-4\" placeholder={loginMode ? \"Email o Usuario\" : \"Email *\"} value={authData.email} onChange={e => setAuthData({ ...authData, email: e.target.value })} required />\n                                    <input className=\"input-cyber w-full p-4\" type=\"password\" placeholder={loginMode ? \"Contrase√±a\" : \"Contrase√±a *\"} value={authData.password} onChange={e => setAuthData({ ...authData, password: e.target.value })} required />\n                                </div>\n\n                                <button type=\"submit\" className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-4 text-white rounded-xl font-bold mt-6 transition transform hover:-translate-y-1 shadow-lg flex items-center justify-center gap-2\">\n                                    {isLoading ? <Loader2 className=\"animate-spin w-5 h-5\" /> : (loginMode ? 'INGRESAR' : 'REGISTRARSE')}\n                                </button>\n                            </form>\n\n                            <button onClick={() => setLoginMode(!loginMode)} className=\"w-full text-center text-slate-500 text-sm mt-8 font-bold hover:text-orange-400 transition border-t border-slate-800 pt-6\">\n                                {loginMode ? '¬øNo tienes cuenta? Reg√≠strate gratis' : '¬øYa tienes cuenta? Inicia sesi√≥n'}\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 6. VISTAS EST√ÅTICAS (ABOUT & GUIDE) */}\n                {view === 'about' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Info className=\"text-orange-500 w-12 h-12\" /> Sobre Nosotros\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] text-xl leading-relaxed whitespace-pre-wrap shadow-2xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"absolute top-0 right-0 w-64 h-64 bg-purple-500/10 rounded-full blur-[100px] pointer-events-none\"></div>\n                            <p className=\"relative z-10\">{settings.aboutUsText}</p>\n\n                            <div className={`mt-12 pt-12 border-t flex flex-col md:flex-row gap-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Shield className=\"text-orange-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Garant√≠a Oficial</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Productos de calidad</p></div>\n                                </div>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Truck className=\"text-purple-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Env√≠os Seguros</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>A todo el pa√≠s</p></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {view === 'guide' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <FileQuestion className=\"text-orange-500 w-12 h-12\" /> {settings?.guideTitle || 'C√≥mo Comprar'}\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            {[\n                                { title: settings?.guideStep1Title || \"Selecciona Productos\", text: settings?.guideStep1Text || \"Navega por nuestro cat√°logo y a√±ade lo que te guste al carrito con el bot√≥n '+'.\" },\n                                { title: settings?.guideStep2Title || \"Revisa tu Carrito\", text: settings?.guideStep2Text || \"Verifica las cantidades. Si tienes un cup√≥n de descuento, ¬°es el momento de usarlo!\" },\n                                { title: settings?.guideStep3Title || \"Datos de Env√≠o\", text: settings?.guideStep3Text || \"Completa la informaci√≥n de entrega. Hacemos env√≠os a todo el pa√≠s.\" },\n                                { title: settings?.guideStep4Title || \"Pago y Confirmaci√≥n\", text: settings?.guideStep4Text || \"Elige tu m√©todo de pago preferido. Si es transferencia, recibir√°s los datos por email.\" },\n                                { title: settings?.guideStep5Title || \"¬°Listo!\", text: settings?.guideStep5Text || \"Recibir√°s un correo con el seguimiento de tu pedido. ¬°Disfruta tu compra!\" }\n                            ].filter((step, idx) => {\n                                // Filtrar pasos que est√°n desactivados\n                                if (idx === 0 && settings?.showGuideStep1 === false) return false;\n                                if (idx === 1 && settings?.showGuideStep2 === false) return false;\n                                if (idx === 2 && settings?.showGuideStep3 === false) return false;\n                                if (idx === 3 && settings?.showGuideStep4 === false) return false;\n                                if (idx === 4 && settings?.showGuideStep5 === false) return false;\n                                return true;\n                            }).map((step, idx) => (\n                                <div key={idx} className=\"flex gap-6 items-start\">\n                                    <div className={`w-10 h-10 rounded-full font-black flex items-center justify-center border flex-shrink-0 mt-1 ${darkMode ? 'bg-orange-900/20 text-orange-400 border-orange-500/20' : 'bg-orange-100 text-orange-600 border-orange-200'}`}>\n                                        {idx + 1}\n                                    </div>\n                                    <div>\n                                        <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{step.title}</h3>\n                                        <p className={`leading-relaxed ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{step.text}</p>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {view === 'privacy' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Shield className=\"text-orange-500 w-12 h-12\" /> Pol√≠tica de Privacidad\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"prose prose-invert max-w-none\">\n                                <p className={`text-sm mb-8 italic ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>√öltima actualizaci√≥n: 07 de enero de 2026</p>\n\n                                <p>Este Aviso de Privacidad para <strong>{settings?.storeName || 'Sustore'}</strong> (\"nosotros\", \"nos\" o \"nuestro\"), describe c√≥mo y por qu√© podr√≠amos acceder, recopilar, almacenar, usar y/o compartir (\"proceso\") su informaci√≥n personal cuando utiliza nuestros servicios (\"Servicios\"), incluso cuando:</p>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Visita nuestro sitio web en <a href=\"https://sustore.vercel.app\" className=\"text-orange-500 hover:underline\">https://sustore.vercel.app</a> o cualquier sitio web nuestro que enlace a este Aviso de Privacidad.</li>\n                                    <li>Interact√∫e con nosotros de otras maneras relacionadas, incluido cualquier marketing o evento.</li>\n                                </ul>\n\n                                <div className={`p-6 rounded-2xl border my-8 ${darkMode ? 'bg-slate-900/50 border-slate-800 text-slate-300' : 'bg-slate-50 border-slate-200 text-slate-700'}`}>\n                                    <h3 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-slate-900'}`}>RESUMEN DE PUNTOS CLAVE</h3>\n                                    <ul className=\"space-y-4 text-sm\">\n                                        <li><strong>¬øQu√© informaci√≥n personal procesamos?</strong> Informaci√≥n proporcionada al registrarse o comprar.</li>\n                                        <li><strong>¬øProcesamos informaci√≥n confidencial?</strong> No.</li>\n                                        <li><strong>¬øRecopilamos informaci√≥n de terceros?</strong> No.</li>\n                                        <li><strong>¬øC√≥mo procesamos su informaci√≥n?</strong> Para gestionar pedidos, seguridad y mejora del servicio.</li>\n                                        <li><strong>¬øCompartimos informaci√≥n?</strong> Solo en situaciones espec√≠ficas como transferencias comerciales o requisitos legales.</li>\n                                    </ul>\n                                </div>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>1. ¬øQU√â INFORMACI√ìN RECOPILAMOS?</h3>\n                                <p>Recopilamos informaci√≥n que usted nos proporciona voluntariamente: nombres, tel√©fonos, emails, direcciones, nombres de usuario y contrase√±as.</p>\n                                <p>Tambi√©n recopilamos datos t√©cnicos autom√°ticamente (IP, tipo de navegador) para seguridad y an√°lisis del sitio.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>2. ¬øC√ìMO PROCESAMOS TU INFORMACI√ìN?</h3>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Facilitar creaci√≥n y administraci√≥n de cuentas.</li>\n                                    <li>Gestionar pedidos, pagos y env√≠os.</li>\n                                    <li>Proteger nuestros servicios contra fraude.</li>\n                                    <li>Evaluar y mejorar la experiencia del usuario.</li>\n                                </ul>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>3. ¬øCU√ÅNTO TIEMPO CONSERVAMOS TU INFORMACI√ìN?</h3>\n                                <p>Conservamos su informaci√≥n mientras tenga una cuenta activa con nosotros o seg√∫n lo exija la ley para fines contables o legales.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>4. ¬øCU√ÅLES SON SUS DERECHOS?</h3>\n                                <p>Puede revisar, cambiar o cancelar su cuenta en cualquier momento desde su perfil o contact√°ndonos directamente.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>5. CONTACTO</h3>\n                                <p>Para preguntas sobre este aviso, puede escribirnos a:</p>\n                                <div className={`p-6 rounded-xl border font-mono text-sm leading-relaxed ${darkMode ? 'bg-slate-950 border-slate-800' : 'bg-white border-slate-200 shadow-sm'}`}>\n                                    <strong>{settings?.storeName || 'Sustore'}</strong><br />\n                                    Saavedra 7568<br />\n                                    Santa Fe, 3000<br />\n                                    Argentina<br />\n                                    <a href={`https://mail.google.com/mail/?view=cm&fs=1&to=${settings?.sellerEmail}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-orange-500 hover:underline\">{settings?.sellerEmail || '[Email de contacto]'}</a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 7. PANEL DE ADMINISTRACI√ìN (COMPLETO Y DETALLADO) */}\n                {view === 'admin' && (\n                    // === Verificaci√≥n de carga antes de verificar acceso ===\n                    // Si los settings no est√°n cargados o el rol est√° indeterminado, mostrar loading\n                    (!settingsLoaded || isRoleLoading(currentUser?.email)) ? (\n                        <div className=\"min-h-screen bg-[#050505] flex items-center justify-center\">\n                            <div className=\"text-center\">\n                                <div className=\"relative\">\n                                    <div className=\"w-16 h-16 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: '#f97316' }}></div>\n                                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                                        <Shield className=\"w-6 h-6 text-orange-500 animate-pulse\" />\n                                    </div>\n                                </div>\n                                <p className=\"text-slate-500 text-xs mt-4 font-mono uppercase tracking-widest\">Verificando permisos...</p>\n                            </div>\n                        </div>\n                    ) :\n                        // === SEGURIDAD: Triple verificaci√≥n de acceso ===\n                        // 1. Verificar que tiene permisos por rol\n                        // 2. Verificar que el usuario tiene un ID v√°lido\n                        // 3. Verificar que la sesi√≥n no fue manipulada\n                        (hasAccess(currentUser?.email) &&\n                            currentUser?.id &&\n                            currentUser?.id.length >= 10 &&\n                            !SecurityManager.detectManipulation()) ? (\n                            <div className=\"flex min-h-screen min-full-viewport bg-[#050505] overflow-hidden animate-fade-up relative w-full font-sans\">\n\n                                {/* Overlay para cerrar el men√∫ en m√≥vil */}\n                                {isAdminMenuOpen && (\n                                    <div\n                                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-30 md:hidden animate-fade-in\"\n                                        onClick={() => setIsAdminMenuOpen(false)}\n                                    />\n                                )}\n\n                                {/* 7.1 Sidebar Admin */}\n                                <div className={`fixed inset-y-0 left-0 z-40 w-[280px] bg-[#0a0a0a] border-r border-slate-800 flex flex-col transition-transform duration-300 ease-out ${isAdminMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'} md:static md:w-72 shadow-2xl`}>\n                                    <div className=\"p-6 md:p-8 border-b border-slate-900 flex items-center justify-between\">\n                                        <div>\n                                            <h2 className=\"text-xl md:text-2xl font-black text-white tracking-tight flex items-center gap-3\">\n                                                <div className=\"w-9 h-9 md:w-10 md:h-10 bg-orange-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-orange-900/20\">\n                                                    <Shield className=\"w-5 h-5 md:w-6 md:h-6\" />\n                                                </div>\n                                                ADMIN\n                                            </h2>\n                                            <p className=\"text-[10px] md:text-xs text-slate-500 mt-1.5 font-mono ml-1\">v3.0.0 PRO</p>\n                                        </div>\n                                        {/* Bot√≥n cerrar en m√≥vil */}\n                                        <button\n                                            onClick={() => setIsAdminMenuOpen(false)}\n                                            className=\"md:hidden p-2 bg-slate-900 hover:bg-slate-800 rounded-xl text-slate-400 hover:text-white transition border border-slate-800\"\n                                        >\n                                            <X className=\"w-5 h-5\" />\n                                        </button>\n                                    </div>\n\n                                    <nav className=\"flex-1 p-3 md:p-4 space-y-1.5 md:space-y-2 overflow-y-auto custom-scrollbar\">\n                                        <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-1\">Principal</p>\n\n                                        <button onClick={() => { setAdminTab('dashboard'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'dashboard' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <LayoutDashboard className=\"w-5 h-5\" /> Inicio\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('orders'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'orders' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <ShoppingBag className=\"w-5 h-5\" /> Pedidos\n                                            {isAdminUser && hasUnseenOrders && (\n                                                <span className=\"ml-auto text-[10px] px-2 py-1 rounded-full bg-red-900/30 text-red-300 border border-red-500/30 font-black uppercase tracking-widest\">\n                                                    Nuevo\n                                                </span>\n                                            )}\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('products'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'products' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <Package className=\"w-5 h-5\" /> Productos\n                                        </button>\n\n                                        {/* Promos - Available for editors and admins */}\n                                        {(isAdmin(currentUser?.email) || isEditor(currentUser?.email)) && (\n                                            <button onClick={() => { setAdminTab('promos'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'promos' ? 'bg-purple-900/20 text-purple-400 border border-purple-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                <Tag className=\"w-5 h-5\" /> Promos\n                                            </button>\n                                        )}\n\n                                        {isAdmin(currentUser?.email) && (\n                                            <>\n                                                <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-4 md:mt-6\">Gesti√≥n</p>\n\n                                                <button onClick={() => { setAdminTab('coupons'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'coupons' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Ticket className=\"w-5 h-5\" /> Cupones\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('suppliers'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'suppliers' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Truck className=\"w-5 h-5\" /> Proveedores\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('purchases'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'purchases' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <ShoppingCart className=\"w-5 h-5\" /> Compras\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('finance'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'finance' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Wallet className=\"w-5 h-5\" /> Finanzas\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('settings'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'settings' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Settings className=\"w-5 h-5\" /> Configuraci√≥n\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('users'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'users' ? 'bg-pink-900/20 text-pink-400 border border-pink-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Users className=\"w-5 h-5\" /> Usuarios\n                                                </button>\n                                            </>\n                                        )}\n                                    </nav>\n\n                                    <div className=\"p-4 md:p-6 border-t border-slate-900\">\n                                        <button onClick={() => { setView('store'); setIsAdminMenuOpen(false); }} className=\"w-full py-3.5 md:py-4 bg-slate-900 rounded-xl text-slate-400 hover:text-white hover:bg-slate-800 transition font-bold text-sm flex items-center justify-center gap-2 group border border-slate-800\">\n                                            <LogOut className=\"w-4 h-4 group-hover:-translate-x-1 transition\" /> Volver a Tienda\n                                        </button>\n                                    </div>\n                                </div>\n\n                                {/* 7.2 Contenido Principal Admin */}\n                                <div className=\"flex-1 bg-[#050505] overflow-y-auto relative w-full p-4 md:p-10 custom-scrollbar\">\n                                    <button onClick={() => setIsAdminMenuOpen(true)} className=\"md:hidden mb-4 p-3 bg-slate-900 hover:bg-slate-800 rounded-xl text-white border border-slate-800 flex items-center gap-2 font-bold text-sm transition\">\n                                        <Menu className=\"w-5 h-5\" /> Men√∫\n                                    </button>\n\n                                    {/* TAB: DASHBOARD */}\n                                    {adminTab === 'dashboard' && (\n                                        <div className=\"max-w-[1600px] mx-auto animate-fade-up space-y-8 pb-20\">\n                                            <ManualSaleModal />\n                                            <MetricsDetailModal />\n                                            {/* Modales Admin Users */}\n\n\n                                            <div className=\"flex flex-col md:flex-row justify-between items-end mb-4 gap-4\">\n                                                <div>\n                                                    <h1 className=\"text-4xl font-black text-white neon-text\">Panel de Control</h1>\n                                                    <p className=\"text-slate-500 mt-2\">Resumen administrativo y financiero.</p>\n                                                </div>\n                                                <div className=\"flex items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"dashboard\" />\n                                                    <div className=\"hidden md:block bg-slate-900 px-4 py-2 rounded-lg text-xs text-slate-400 font-mono border border-slate-800\">\n                                                        {new Date().toLocaleDateString('es-AR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 1: ANAL√çTICA FINANCIERA (Lista Gr√°fica) */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                {/* INGRESOS BRUTOS */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-green-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Ingresos Brutos</p>\n                                                            <h2 className=\"text-4xl font-black text-white tracking-tighter\">${dashboardMetrics.revenue.toLocaleString()}</h2>\n                                                        </div>\n                                                        <div className=\"p-4 bg-green-900/20 text-green-400 rounded-2xl\">\n                                                            <DollarSign className=\"w-8 h-8\" />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gr√°fica (Ultimos 6 meses) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Rendimiento Mensual</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            const maxRev = Math.max(...dashboardMetrics.analytics.monthly.map(x => x.revenue));\n                                                            const percentage = maxRev > 0 ? (m.revenue / maxRev) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-white font-bold\">${m.revenue.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div\n                                                                            className=\"h-full bg-gradient-to-r from-green-600 to-emerald-400 rounded-full transition-all duration-1000 group-hover/item:brightness-125\"\n                                                                            style={{ width: `${percentage}%` }}\n                                                                        ></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n\n                                                {/* BENEFICIO NETO */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-orange-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Beneficio Neto (Estimado)</p>\n                                                            <h2 className={`text-4xl font-black tracking-tighter ${dashboardMetrics.netIncome >= 0 ? 'text-orange-400' : 'text-red-500'}`}>\n                                                                ${dashboardMetrics.netIncome.toLocaleString()}\n                                                            </h2>\n                                                        </div>\n                                                        <div className={`p-4 rounded-2xl ${dashboardMetrics.netIncome >= 0 ? 'bg-orange-900/20 text-orange-400' : 'bg-red-900/20 text-red-500'}`}>\n                                                            {dashboardMetrics.netIncome >= 0 ? <TrendingUp className=\"w-8 h-8\" /> : <TrendingDown className=\"w-8 h-8\" />}\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gr√°fica (Comparativa Ingreso vs Gasto) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Ingresos vs Gastos (√öltimos Meses)</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            // Estimaci√≥n simplificada de gastos mensuales (proporcional solo para visualizaci√≥n si no hay data exacta mensual de gastos guardada historica)\n                                                            // En una real app, se calcular√≠a real desde expenses.\n                                                            // Como `expenses` tiene fecha, podemos calcularlo.\n                                                            const monthExpenses = expenses.filter(e => e.date.startsWith(m.date)).reduce((acc, c) => acc + c.amount, 0)\n                                                                + (purchases || []).filter(p => p.date.startsWith(m.date)).reduce((acc, c) => acc + c.cost, 0);\n\n                                                            const totalVol = m.revenue + monthExpenses;\n                                                            const revPct = totalVol > 0 ? (m.revenue / totalVol) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-orange-400 font-bold\">+${(m.revenue - monthExpenses).toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div title={`Ingresos: $${m.revenue}`} className=\"h-full bg-orange-500 transition-all duration-1000\" style={{ width: `${revPct}%` }}></div>\n                                                                        <div title={`Gastos: $${monthExpenses}`} className=\"h-full bg-red-500 transition-all duration-1000\" style={{ width: `${100 - revPct}%` }}></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 2: KPIs R√ÅPIDOS */}\n                                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Usuarios Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalUsers}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Pedidos Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalOrders}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Ticket Promedio</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">\n                                                        ${dashboardMetrics.totalOrders > 0 ? Math.round(dashboardMetrics.revenue / dashboardMetrics.totalOrders).toLocaleString() : 0}\n                                                    </p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Stock Bajo</p>\n                                                    <p className={`font-black text-2xl text-center mt-1 ${dashboardMetrics.lowStockProducts.length > 0 ? 'text-red-500' : 'text-green-500'}`}>\n                                                        {dashboardMetrics.lowStockProducts.length}\n                                                    </p>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 2.5: MEJORES Y PEORES (NUEVO) */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                {/* BEST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-yellow-500/30 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <Star className=\"w-32 h-32 text-yellow-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <Star className=\"w-4 h-4 text-yellow-500\" /> Producto Estrella\n                                                    </p>\n                                                    {dashboardMetrics.starProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg flex-shrink-0\">\n                                                                <img src={dashboardMetrics.starProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.starProduct.name}</h3>\n                                                                <p className=\"text-yellow-400 font-bold text-lg\">{dashboardMetrics.starProduct.sales} Und. vendidas</p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Stock actual: {dashboardMetrics.starProduct.stock}</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">No hay datos de ventas a√∫n.</p>\n                                                    )}\n                                                </div>\n\n                                                {/* WORST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-slate-600 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <AlertCircle className=\"w-32 h-32 text-slate-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <TrendingDown className=\"w-4 h-4 text-slate-500\" /> Menos Vendido (En Stock)\n                                                    </p>\n                                                    {dashboardMetrics.leastSoldProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg grayscale flex-shrink-0\">\n                                                                <img src={dashboardMetrics.leastSoldProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.leastSoldProduct.name}</h3>\n                                                                <p className=\"text-slate-400 font-bold text-lg\">\n                                                                    {dashboardMetrics.salesCount[dashboardMetrics.leastSoldProduct.id] || 0} Und. vendidas\n                                                                </p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Hay que rotar este stock.</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">Todos los productos tienen buena rotaci√≥n.</p>\n                                                    )}\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 3: LIBRO MAYOR (REGISTRO ADMINISTRATIVO) */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 overflow-hidden shadow-2xl\">\n                                                <h3 className=\"text-xl font-black text-white mb-6 flex items-center gap-2\">\n                                                    <FileText className=\"w-6 h-6 text-purple-400\" /> Registro de Movimientos\n                                                </h3>\n\n                                                <div className=\"overflow-x-auto\">\n                                                    <table className=\"w-full text-left border-collapse\">\n                                                        <thead>\n                                                            <tr className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-slate-800\">\n                                                                <th className=\"pb-4 pl-4\">Fecha</th>\n                                                                <th className=\"pb-4\">Tipo</th>\n                                                                <th className=\"pb-4\">Concepto</th>\n                                                                <th className=\"pb-4\">Estado</th>\n                                                                <th className=\"pb-4 text-right pr-4\">Monto</th>\n                                                            </tr>\n                                                        </thead>\n                                                        <tbody className=\"text-sm font-medium\">\n                                                            {dashboardMetrics.transactions.map((t, idx) => (\n                                                                <tr key={`${t.type}-${idx}`} className=\"border-b border-slate-800/50 hover:bg-slate-900/20 transition group\">\n                                                                    <td className=\"py-4 pl-4 text-slate-400 font-mono text-xs\">{new Date(t.date).toLocaleDateString()}</td>\n                                                                    <td className=\"py-4\">\n                                                                        <span className={`px-2 py-1 rounded text-[10px] font-black uppercase tracking-wider ${t.type === 'income' ? 'bg-green-900/20 text-green-400 border border-green-500/20' : 'bg-red-900/20 text-red-400 border border-red-500/20'\n                                                                            }`}>\n                                                                            {t.category}\n                                                                        </span>\n                                                                    </td>\n                                                                    <td className=\"py-4 text-white group-hover:text-purple-300 transition\">\n                                                                        {t.description}\n                                                                    </td>\n                                                                    <td className=\"py-4 text-xs text-slate-500\">\n                                                                        {t.status}\n                                                                    </td>\n                                                                    <td className={`py-4 text-right pr-4 font-mono font-bold ${t.type === 'income' ? 'text-green-400' : 'text-red-400'}`}>\n                                                                        {t.type === 'income' ? '+' : '-'}${t.amount.toLocaleString()}\n                                                                    </td>\n                                                                </tr>\n                                                            ))}\n                                                            {dashboardMetrics.transactions.length === 0 && (\n                                                                <tr><td colSpan=\"5\" className=\"text-center py-8 text-slate-500\">Sin movimientos registrados.</td></tr>\n                                                            )}\n                                                        </tbody>\n                                                    </table>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CONFIGURACI√ìN (BLINDADA) - REMOVED (Consolidated in main Settings tab below) */}\n\n\n                                    {/* TAB: PROVEEDORES (CON SELECTOR VISUAL) */}\n                                    {adminTab === 'suppliers' && (\n                                        <div className=\"max-w-6xl mx-auto space-y-8 animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                                                <h1 className=\"text-3xl font-black text-white\">Proveedores</h1>\n                                                <div className=\"flex items-center gap-2\">\n                                                    <AdminHowToUse guideKey=\"suppliers\" />\n                                                    <button onClick={() => { setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] }); setEditingSupplierId(null); setShowSupplierModal(true); }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:-translate-y-1\">\n                                                        <Plus className=\"w-5 h-5\" /> Nuevo Proveedor\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {suppliers.map((s, idx) => (\n                                                    <div key={s.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-[2rem] hover:border-slate-600 transition duration-300 group animate-fade-up\">\n                                                        <div className=\"flex justify-between items-start mb-6\">\n                                                            <div className=\"p-4 bg-slate-900 rounded-xl text-slate-400 group-hover:text-orange-400 transition group-hover:bg-orange-900/20\">\n                                                                <Truck className=\"w-8 h-8\" />\n                                                            </div>\n                                                            <div className=\"flex gap-2\">\n                                                                <button\n                                                                    onClick={() => { setNewSupplier(s); setEditingSupplierId(s.id); setShowSupplierModal(true); }}\n                                                                    className=\"text-slate-600 hover:text-orange-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Editar\"\n                                                                >\n                                                                    <Edit className=\"w-5 h-5\" />\n                                                                </button>\n                                                                <button\n                                                                    onClick={() => openConfirm(\"Eliminar Proveedor\", \"¬øEliminar proveedor?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', s.id)))}\n                                                                    className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Eliminar\"\n                                                                >\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n\n                                                        <h3 className=\"text-2xl font-bold text-white mb-2\">{s.name}</h3>\n\n                                                        <div className=\"space-y-3 mb-6 p-4 bg-slate-900/30 rounded-xl border border-slate-800/50\">\n                                                            <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                <User className=\"w-4 h-4 text-slate-500\" /> {s.contact}\n                                                            </p>\n                                                            {s.phone && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Phone className=\"w-4 h-4 text-slate-500\" /> {s.phone}\n                                                                </p>\n                                                            )}\n                                                            {s.ig && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Instagram className=\"w-4 h-4 text-slate-500\" /> {s.ig}\n                                                                </p>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"pt-4 border-t border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider\">Productos Suministrados</p>\n                                                            <div className=\"flex flex-wrap gap-2\">\n                                                                {(s.associatedProducts && s.associatedProducts.length > 0) ? (\n                                                                    s.associatedProducts.map(pid => {\n                                                                        const p = products.find(prod => prod.id === pid);\n                                                                        if (!p) return null;\n                                                                        return (\n                                                                            <div key={pid} className=\"w-10 h-10 rounded-lg bg-white p-1 flex items-center justify-center border border-slate-600 tooltip-container\" title={p.name}>\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                ) : (\n                                                                    <span className=\"text-xs text-slate-600 italic\">No hay productos asignados</span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: COMPRAS (STOCK) */}\n                                    {adminTab === 'purchases' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Stock y Compras</h1>\n                                                <AdminHowToUse guideKey=\"purchases\" />\n                                            </div>\n\n                                            {/* Formulario de Compra Unificado */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] mb-10 shadow-xl overflow-hidden relative\">\n\n                                                {/* Header / Solo Reposici√≥n de Stock */}\n                                                <div className=\"flex border-b border-slate-800\">\n                                                    <div className=\"flex-1 p-6 text-center font-bold tracking-wider bg-orange-900/20 text-orange-400\">\n                                                        <Package className=\"w-5 h-5 inline-block mr-2\" /> REGISTRAR REPOSICI√ìN DE STOCK\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"p-8\">\n                                                    {(() => {\n                                                        const selectedProduct = products.find(p => p.id === newPurchase.productId);\n                                                        const productPrice = selectedProduct?.purchasePrice || selectedProduct?.basePrice || 0;\n                                                        const autoCost = productPrice * newPurchase.quantity;\n\n                                                        return (\n                                                            <div className=\"space-y-6 animate-fade-in\">\n                                                                {/* Preview del Producto Seleccionado (REMOVIDO de aqu√≠ para moverlo junto al input) */}\n\n                                                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                                    <div className=\"md:col-span-2\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Producto Existente</label>\n                                                                        <div className=\"flex gap-4 items-center\">\n                                                                            {selectedProduct && (\n                                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                                    <img src={selectedProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                                </div>\n                                                                            )}\n                                                                            <div className=\"flex-1\">\n                                                                                <select className=\"input-cyber w-full p-4\" value={newPurchase.productId} onChange={e => setNewPurchase({ ...newPurchase, productId: e.target.value })}>\n                                                                                    <option value=\"\">Seleccionar Producto...</option>\n                                                                                    {products.map(p => (\n                                                                                        <option key={p.id} value={p.id}>\n                                                                                            {p.name} (Stock: {isNaN(Number(p.stock)) ? 0 : p.stock})\n                                                                                        </option>\n                                                                                    ))}\n                                                                                </select>\n                                                                                {selectedProduct && (\n                                                                                    <p className=\"text-xs text-orange-400 mt-2 font-bold\">\n                                                                                        Stock Actual: {isNaN(Number(selectedProduct.stock)) ? 0 : selectedProduct.stock} | Costo Total Estimado: ${autoCost.toLocaleString()}\n                                                                                    </p>\n                                                                                )}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    <div>\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cantidad</label>\n                                                                        <input type=\"number\" className=\"input-cyber w-full p-4\" placeholder=\"0\" value={newPurchase.quantity} onChange={e => setNewPurchase({ ...newPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                                    </div>\n                                                                    <div className=\"md:col-span-3\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Proveedor</label>\n                                                                        <select className=\"input-cyber w-full p-4\" value={newPurchase.supplierId} onChange={e => setNewPurchase({ ...newPurchase, supplierId: e.target.value })}>\n                                                                            <option value=\"\">Seleccionar...</option>\n                                                                            {suppliers.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\n                                                                        </select>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        )\n                                                    })()}\n\n\n                                                    <button\n                                                        onClick={async () => {\n                                                            // Validaciones\n                                                            if (!newPurchase.productId) return showToast(\"Selecciona un producto existente.\", \"warning\");\n                                                            if (newPurchase.quantity <= 0) return showToast(\"La cantidad debe ser mayor a 0.\", \"warning\");\n                                                            if (newPurchase.cost < 0) return showToast(\"El costo no puede ser negativo.\", \"warning\");\n\n                                                            try {\n                                                                const selectedProd = products.find(p => p.id === newPurchase.productId);\n                                                                const targetProductName = selectedProd?.name || \"Desconocido\";\n\n                                                                // Auto-calcular costo: precio de compra √ó cantidad\n                                                                const productPrice = selectedProd?.purchasePrice || selectedProd?.basePrice || 0;\n                                                                const calculatedCost = productPrice * newPurchase.quantity;\n\n                                                                // REGISTRAR COMPRA\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), {\n                                                                    productId: newPurchase.productId,\n                                                                    supplierId: newPurchase.supplierId || '',\n                                                                    quantity: newPurchase.quantity,\n                                                                    cost: calculatedCost,\n                                                                    date: new Date().toISOString()\n                                                                });\n\n                                                                // ACTUALIZAR STOCK\n                                                                const currentStock = isNaN(Number(selectedProd?.stock)) ? 0 : Number(selectedProd.stock);\n                                                                const newStock = currentStock + newPurchase.quantity;\n\n                                                                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', newPurchase.productId), {\n                                                                    stock: newStock\n                                                                });\n\n                                                                // Resetear Formulario\n                                                                setNewPurchase({\n                                                                    isNewProduct: false, productId: '', supplierId: '', quantity: 1, cost: 0,\n                                                                    newProdName: '', newProdPrice: 0, newProdImage: '', newProdCategory: ''\n                                                                });\n                                                                showToast(`Compra de \"${targetProductName}\" registrada exitosamente.`, \"success\");\n\n                                                            } catch (e) {\n                                                                console.error(\"Error stock update:\", e);\n                                                                showToast(\"Error: \" + (e.message || \"Operaci√≥n fallida\"), \"error\");\n                                                            }\n                                                        }}\n                                                        className=\"w-full mt-8 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-black py-5 rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <Save className=\"w-6 h-6\" /> REGISTRAR REPOSICI√ìN DE STOCK\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* CARRITO DE COMPRAS */}\n                                            {purchaseCart.length > 0 && (\n                                                <div className=\"bg-gradient-to-br from-orange-900/20 to-red-900/20 border border-orange-800 rounded-[2.5rem] p-8 mb-10 animate-fade-up\">\n                                                    <div className=\"flex items-center justify-between mb-6\">\n                                                        <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <ShoppingCart className=\"w-6 h-6 text-orange-400\" />\n                                                            Carrito de Compras ({purchaseCart.length} {purchaseCart.length === 1 ? 'producto' : 'productos'})\n                                                        </h3>\n                                                        <p className=\"text-orange-400 font-black text-2xl\">\n                                                            TOTAL: ${purchaseCart.reduce((acc, item) => acc + item.cost, 0).toLocaleString()}\n                                                        </p>\n                                                    </div>\n\n                                                    <div className=\"space-y-4 mb-6\">\n                                                        {purchaseCart.map((item, index) => (\n                                                            <div key={index} className=\"flex items-center gap-6 bg-slate-900/50 p-4 rounded-xl border border-slate-700\">\n                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0\">\n                                                                    <img src={item.productImage} className=\"w-full h-full object-contain\" alt={item.productName} />\n                                                                </div>\n                                                                <div className=\"flex-1\">\n                                                                    <p className=\"font-bold text-white\">{item.productName}</p>\n                                                                    <p className=\"text-xs text-slate-400\">Precio Unit.: ${item.unitPrice.toLocaleString()}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-3\">\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        value={item.quantity}\n                                                                        onChange={(e) => updatePurchaseCartItem(index, parseInt(e.target.value) || 1)}\n                                                                        className=\"w-20 bg-slate-800 border border-slate-700 text-white px-3 py-2 rounded-lg text-center font-bold\"\n                                                                        min=\"1\"\n                                                                    />\n                                                                    <p className=\"text-orange-400 font-bold w-28 text-right\">${item.cost.toLocaleString()}</p>\n                                                                    <button\n                                                                        onClick={() => removeFromPurchaseCart(index)}\n                                                                        className=\"p-2 bg-red-900/20 hover:bg-red-900/40 text-red-400 rounded-lg transition\"\n                                                                    >\n                                                                        <Trash2 className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        ))}\n                                                    </div>\n\n                                                    <button\n                                                        onClick={finalizePurchaseOrder}\n                                                        className=\"w-full py-5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-black rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <CheckCircle className=\"w-6 h-6\" /> FINALIZAR PEDIDO\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Historial */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6\">Historial de Compras</h3>\n                                                <div className=\"space-y-4\">\n                                                    {purchases.sort((a, b) => new Date(b.date) - new Date(a.date)).map((p, idx) => {\n                                                        const prod = products.find(prod => prod.id === p.productId);\n                                                        const sup = suppliers.find(s => s.id === p.supplierId);\n                                                        return (\n                                                            <div key={p.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"flex justify-between items-center bg-slate-900/40 p-4 rounded-xl border border-slate-800 hover:border-slate-600 transition group animate-fade-up\">\n                                                                <div className=\"flex items-center gap-4 flex-1\">\n                                                                    {/* Image Preview */}\n                                                                    <div className=\"w-12 h-12 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                        {prod?.image ? (\n                                                                            <img src={prod.image} className=\"w-full h-full object-contain\" alt={prod.name} />\n                                                                        ) : (\n                                                                            <Package className=\"w-full h-full text-slate-400 p-2\" />\n                                                                        )}\n                                                                    </div>\n\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white flex items-center gap-2\">\n                                                                            {prod?.name || 'Producto Eliminado'}\n                                                                            <span className=\"text-[10px] bg-slate-800 px-2 py-0.5 rounded text-slate-400\">STOCK ACTUAL: {prod?.stock || 0}</span>\n                                                                        </p>\n                                                                        <p className=\"text-xs text-slate-500\">{new Date(p.date).toLocaleDateString()} {sup ? `- Prov: ${sup.name}` : ''}</p>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex items-center gap-6\">\n                                                                    <div className=\"text-right\">\n                                                                        <p className=\"text-orange-400 font-bold\">+{p.quantity} u.</p>\n                                                                        <p className=\"text-slate-400 text-xs font-mono\">${(p.cost || 0).toLocaleString()}</p>\n                                                                    </div>\n                                                                    <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                                        <button onClick={() => setEditingPurchase(p)} className=\"p-2 bg-slate-800 hover:bg-blue-900/30 text-slate-400 hover:text-blue-400 rounded-lg transition\">\n                                                                            <Edit className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                        <button onClick={() => deletePurchaseFn(p)} className=\"p-2 bg-slate-800 hover:bg-red-900/30 text-slate-400 hover:text-red-400 rounded-lg transition\">\n                                                                            <Trash2 className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        );\n                                                    })}\n                                                </div>\n                                            </div>\n\n                                            {/* Modal Edici√≥n Compra */}\n                                            {editingPurchase && (\n                                                <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-in\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-700 rounded-3xl p-8 w-full max-w-lg shadow-2xl relative\">\n                                                        <button onClick={() => setEditingPurchase(null)} className=\"absolute top-4 right-4 p-2 text-slate-500 hover:text-white\"><X className=\"w-6 h-6\" /></button>\n                                                        <h3 className=\"text-2xl font-bold text-white mb-6\">Editar Compra</h3>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Cantidad comprada</label>\n                                                                <div className=\"text-xs text-yellow-500 mb-2\">‚ö† Modificar esto ajustar√° el stock del producto autom√°ticamente.</div>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.quantity} onChange={e => setEditingPurchase({ ...editingPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Costo Total ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.cost} onChange={e => setEditingPurchase({ ...editingPurchase, cost: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => {\n                                                                const original = purchases.find(x => x.id === editingPurchase.id);\n                                                                if (original) updatePurchaseFn(editingPurchase.id, original, editingPurchase);\n                                                            }}\n                                                            className=\"w-full mt-6 bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl transition shadow-lg\"\n                                                        >\n                                                            Guardar Cambios\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: FINANZAS (GASTOS E INVERSIONES) */}\n                                    {adminTab === 'finance' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-4xl font-black text-white neon-text\">Finanzas y Capital</h1>\n                                                <AdminHowToUse guideKey=\"finance\" />\n                                            </div>\n\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* SECCI√ìN: REGISTRAR INVERSI√ìN (NUEVO) */}\n                                                <div className=\"bg-[#0a0a0a] border border-orange-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <TrendingUp className=\"w-5 h-5 text-orange-400\" /> Registrar Inversi√≥n / Aporte\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Inversor (Socio)</label>\n                                                            <div className=\"relative\">\n                                                                <Users className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500 w-4 h-4\" />\n                                                                <select\n                                                                    className=\"input-cyber w-full pl-12 p-4 appearance-none\"\n                                                                    value={newInvestment.investor}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                >\n                                                                    <option value=\"\">Seleccionar Socio...</option>\n                                                                    {(settings?.team || []).map((member, idx) => (\n                                                                        <option key={idx} value={member.name || member.email}>\n                                                                            {member.name || member.email}\n                                                                        </option>\n                                                                    ))}\n                                                                    <option value=\"other\">Otro / Externo</option>\n                                                                </select>\n                                                            </div>\n                                                            {newInvestment.investor === 'other' && (\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4 mt-2\"\n                                                                    placeholder=\"Nombre del Inversor Externo\"\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                />\n                                                            )}\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4 font-mono font-bold text-orange-400\"\n                                                                    placeholder=\"0.00\"\n                                                                    value={newInvestment.amount}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, amount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Fecha</label>\n                                                                <input\n                                                                    type=\"date\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={newInvestment.date}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, date: e.target.value })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Notas (Opcional)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Ej: Inversi√≥n Inicial, Refuerzo de capital...\"\n                                                                value={newInvestment.notes}\n                                                                onChange={e => setNewInvestment({ ...newInvestment, notes: e.target.value })}\n                                                            />\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newInvestment.investor || newInvestment.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), {\n                                                                    ...newInvestment,\n                                                                    timestamp: new Date().toISOString()\n                                                                });\n                                                                setNewInvestment({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n                                                                showToast(\"Inversi√≥n registrada correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-orange-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Aporte\n                                                        </button>\n                                                    </div>\n                                                </div>\n\n                                                {/* SECCI√ìN: REGISTRAR GASTO */}\n                                                <div className=\"bg-[#0a0a0a] border border-red-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-red-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <Wallet className=\"w-5 h-5 text-red-400\" /> Registrar Gasto / Egreso\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Ej: Pago de Internet, Alquiler...\" value={newExpense.description} onChange={e => setNewExpense({ ...newExpense, description: e.target.value })} />\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-4 font-mono font-bold text-red-400\" placeholder=\"0.00\" value={newExpense.amount} onChange={e => setNewExpense({ ...newExpense, amount: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Categor√≠a</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newExpense.category} onChange={e => setNewExpense({ ...newExpense, category: e.target.value })}>\n                                                                    <option>General</option>\n                                                                    <option>Servicios</option>\n                                                                    <option>Impuestos</option>\n                                                                    <option>Mantenimiento</option>\n                                                                    <option>Marketing</option>\n                                                                    <option>Sueldos</option>\n                                                                    <option>Otros</option>\n                                                                </select>\n                                                            </div>\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newExpense.description || newExpense.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), {\n                                                                    ...newExpense,\n                                                                    date: new Date().toISOString()\n                                                                });\n                                                                setNewExpense({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n                                                                showToast(\"Gasto registrado correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-red-900/50 hover:bg-red-900 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-red-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Gasto\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* TABLAS DETALLADAS */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* Historial de Inversiones */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Inversiones</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {investments.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin inversiones registradas.</p> :\n                                                            investments.sort((a, b) => new Date(b.date) - new Date(a.date)).map((inv, idx) => (\n                                                                <div key={inv.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-orange-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{inv.investor}</p>\n                                                                        <p className=\"text-slate-500 text-xs\">{new Date(inv.date).toLocaleDateString()} {inv.notes && `- ${inv.notes}`}</p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-orange-400 font-mono font-bold\">+${inv.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Inversi√≥n\", \"¬øDeseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'investments', inv.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n\n                                                {/* Historial de Gastos */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Gastos</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {expenses.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin gastos registrados.</p> :\n                                                            expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map((ex, idx) => (\n                                                                <div key={ex.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-red-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{ex.description}</p>\n                                                                        <p className=\"text-slate-500 text-xs flex gap-2\">\n                                                                            <span className=\"text-red-300 font-bold bg-red-900/20 px-1.5 rounded\">{ex.category}</span>\n                                                                            <span>{new Date(ex.date).toLocaleDateString()}</span>\n                                                                        </p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-red-400 font-mono font-bold\">-${ex.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Gasto\", \"¬øDeseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'expenses', ex.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN: DISTRIBUCI√ìN DE GANANCIAS (AUTOM√ÅTICA) */}\n                                            <div className=\"animate-fade-up pt-12 border-t border-slate-800\">\n                                                <div className=\"flex justify-between items-center mb-8\">\n                                                    <div>\n                                                        <h2 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <DollarSign className=\"w-8 h-8 text-green-500\" /> Distribuci√≥n de Ganancias\n                                                        </h2>\n                                                        <p className=\"text-slate-500 mt-1\">C√°lculo autom√°tico basado en las inversiones registradas.</p>\n                                                    </div>\n                                                    <div className=\"text-right\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Beneficio Neto</p>\n                                                        <p className={`text-3xl font-black ${dashboardMetrics.netIncome >= 0 ? 'text-green-400' : 'text-red-500'}`}>\n                                                            ${dashboardMetrics.netIncome.toLocaleString()}\n                                                        </p>\n                                                    </div>\n                                                </div>\n\n                                                {/* Gr√°fico y Tabla */}\n                                                <div className=\"flex flex-col gap-8 bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                    {(() => {\n                                                        const team = settings?.team || [];\n                                                        // Calcular Total Invertido por Miembro desde la colecci√≥n 'investments'\n                                                        const memberInvestments = team.map(member => {\n                                                            const totalInv = investments\n                                                                .filter(inv => inv.investor === member.name || inv.investor === member.email) // Match by Name or Email\n                                                                .reduce((acc, inv) => acc + (Number(inv.amount) || 0), 0);\n                                                            return { ...member, totalInv };\n                                                        });\n\n                                                        const totalCapital = memberInvestments.reduce((acc, m) => acc + m.totalInv, 0);\n\n                                                        if (totalCapital === 0) return <p className=\"text-slate-500 text-center py-12\">Registra inversiones para ver la distribuci√≥n de ganancias.</p>;\n\n                                                        return (\n                                                            <>\n                                                                {/* Barra de Progreso Distribuci√≥n */}\n                                                                <div className=\"w-full h-8 bg-slate-900 rounded-full flex overflow-hidden\">\n                                                                    {memberInvestments.map((member, idx) => {\n                                                                        const pct = totalCapital > 0 ? (member.totalInv / totalCapital) * 100 : 0;\n                                                                        const colors = ['bg-green-500', 'bg-orange-500', 'bg-purple-500', 'bg-pink-500', 'bg-yellow-500', 'bg-red-500'];\n                                                                        if (pct <= 0) return null;\n                                                                        return (\n                                                                            <div key={idx} className={`${colors[idx % colors.length]} h-full transition-all duration-500`} style={{ width: `${pct}%` }} title={`${member.name}: ${pct.toFixed(1)}%`}></div>\n                                                                        );\n                                                                    })}\n                                                                </div>\n\n                                                                {/* Tabla de Distribuci√≥n */}\n                                                                <div className=\"overflow-x-auto\">\n                                                                    <table className=\"w-full text-left border-collapse\">\n                                                                        <thead>\n                                                                            <tr className=\"bg-slate-900/50 border-b border-slate-800\">\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest\">Socio</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right\">Capital Aportado</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-center\">% Part.</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right text-green-500\">Ganancia Est.</th>\n                                                                            </tr>\n                                                                        </thead>\n                                                                        <tbody className=\"divide-y divide-slate-800/50\">\n                                                                            {memberInvestments.map((member, idx) => {\n                                                                                const sharePercentage = totalCapital > 0 ? ((member.totalInv / totalCapital) * 100) : 0;\n                                                                                const memberProfit = (dashboardMetrics.netIncome * sharePercentage) / 100;\n                                                                                const colors = ['text-green-500', 'text-orange-500', 'text-purple-500', 'text-pink-500', 'text-yellow-500', 'text-red-500'];\n\n                                                                                return (\n                                                                                    <tr key={idx} className=\"hover:bg-slate-900/20 transition\">\n                                                                                        <td className=\"p-5\">\n                                                                                            <div className=\"flex items-center gap-3\">\n                                                                                                <div className={`w-3 h-3 rounded-full ${colors[idx % colors.length].replace('text-', 'bg-')}`}></div>\n                                                                                                <div>\n                                                                                                    <p className=\"font-bold text-white\">{member.name || 'Sin Nombre'}</p>\n                                                                                                    <p className=\"text-xs text-slate-500\">{member.email}</p>\n                                                                                                </div>\n                                                                                            </div>\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-bold text-white\">\n                                                                                            ${member.totalInv.toLocaleString()}\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-center font-mono text-slate-300 font-bold\">\n                                                                                            {sharePercentage.toFixed(1)}%\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-black text-green-400 text-lg\">\n                                                                                            ${memberProfit.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                                                                                        </td>\n                                                                                    </tr>\n                                                                                );\n                                                                            })}\n                                                                        </tbody>\n                                                                        <tfoot className=\"bg-slate-900/30 border-t border-slate-800\">\n                                                                            <tr>\n                                                                                <td className=\"p-6 font-black text-white text-right\">TOTAL CAPITAL</td>\n                                                                                <td className=\"p-6 text-right font-black text-orange-400 text-lg\">\n                                                                                    ${totalCapital.toLocaleString()}\n                                                                                </td>\n                                                                                <td className=\"p-6 text-center font-bold text-slate-500\">100%</td>\n                                                                                <td className=\"p-6 text-right font-black text-green-500 text-xl\">\n                                                                                    ${dashboardMetrics.netIncome.toLocaleString()}\n                                                                                </td>\n                                                                            </tr>\n                                                                        </tfoot>\n                                                                    </table>\n                                                                </div>\n                                                            </>\n                                                        );\n                                                    })()}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CUPONES (GESTI√ìN AVANZADA) */}\n                                    {adminTab === 'coupons' && (\n                                        <div className=\"max-w-5xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Overlay for Entrepreneur Plan */}\n                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                <button\n                                                    onClick={() => setShowPlansModal(true)}\n                                                    className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-md rounded-[2.5rem] cursor-pointer hover:bg-black/70 transition group\"\n                                                >\n                                                    <div className=\"text-center p-8 max-w-md\">\n                                                        <div className=\"w-20 h-20 mx-auto mb-6 bg-purple-500/20 rounded-full flex items-center justify-center border border-purple-500/30 group-hover:scale-110 transition\">\n                                                            <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-2xl font-black text-white mb-4\">Cupones Bloqueados</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Los cupones de descuento est√°n disponibles a partir del <span className=\"text-purple-400 font-bold\">Plan Negocio</span>.</p>\n                                                        <p className=\"text-sm text-white/60 group-hover:text-white transition\">Clic para ver planes disponibles</p>\n                                                    </div>\n                                                </button>\n                                            )}\n\n                                            <div className=\"relative z-30 flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Cupones</h1>\n                                                <AdminHowToUse guideKey=\"coupons\" />\n                                            </div>\n\n                                            {/* Formulario de Creaci√≥n */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] mb-10 shadow-xl\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                    <Plus className=\"w-5 h-5 text-purple-400\" /> Crear Nuevo Cup√≥n\n                                                </h3>\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                    {/* Columna 1 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">C√≥digo del Cup√≥n</label>\n                                                            <input className=\"input-cyber w-full p-4 font-mono text-lg uppercase tracking-widest\" placeholder=\"Ej: VERANO2024\" value={newCoupon.code} onChange={e => setNewCoupon({ ...newCoupon, code: e.target.value.toUpperCase() })} />\n                                                        </div>\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newCoupon.type} onChange={e => setNewCoupon({ ...newCoupon, type: e.target.value })}>\n                                                                    <option value=\"percentage\">Porcentaje (%)</option>\n                                                                    <option value=\"fixed\">Fijo ($)</option>\n                                                                </select>\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Valor</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"0\" value={newCoupon.value} onChange={e => setNewCoupon({ ...newCoupon, value: e.target.value })} />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Columna 2 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">M√≠nimo de Compra</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0\" value={newCoupon.minPurchase} onChange={e => setNewCoupon({ ...newCoupon, minPurchase: e.target.value })} />\n                                                            </div>\n                                                            {newCoupon.type === 'percentage' && (\n                                                                <div className=\"flex-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tope Reintegro</label>\n                                                                    <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0 (Opcional)\" value={newCoupon.maxDiscount} onChange={e => setNewCoupon({ ...newCoupon, maxDiscount: e.target.value })} />\n                                                                </div>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">L√≠mite Usos (Total)</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Ej: 100\" value={newCoupon.usageLimit} onChange={e => setNewCoupon({ ...newCoupon, usageLimit: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Vencimiento</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"date\" value={newCoupon.expirationDate} onChange={e => setNewCoupon({ ...newCoupon, expirationDate: e.target.value })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"md:col-span-2\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                Tipo de Cup√≥n\n                                                            </label>\n                                                            <select\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={newCoupon.targetType}\n                                                                onChange={e => setNewCoupon({ ...newCoupon, targetType: e.target.value })}\n                                                            >\n                                                                <option value=\"global\">üåç P√∫blico / Canjeable (Redes Sociales)</option>\n                                                                <option value=\"specific_email\">üë§ Usuario Espec√≠fico (Email)</option>\n                                                            </select>\n                                                        </div>\n\n                                                        {newCoupon.targetType === 'specific_email' && (\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Email del Usuario\n                                                                </label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"usuario@ejemplo.com\"\n                                                                    value={newCoupon.targetUser || ''}\n                                                                    onChange={e => setNewCoupon({ ...newCoupon, targetUser: e.target.value })}\n                                                                />\n                                                                <p className=\"text-xs text-slate-400 mt-1\">Solo este usuario podr√° usar el cup√≥n</p>\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                                <button onClick={saveCouponFn} className=\"w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2\">\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cup√≥n\n                                                </button>\n                                            </div>\n\n                                            {/* Lista de Cupones Activos */}\n                                            <div className=\"grid gap-4\">\n                                                {coupons.map((c, idx) => (\n                                                    <div key={c.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col md:flex-row justify-between items-center group hover:border-slate-700 transition animate-fade-up\">\n                                                        <div className=\"flex items-center gap-6 mb-4 md:mb-0 w-full md:w-auto\">\n                                                            <div className=\"w-16 h-16 bg-slate-900 rounded-xl flex items-center justify-center border border-slate-800 text-purple-400 font-black text-2xl\">\n                                                                %\n                                                            </div>\n                                                            <div>\n                                                                <h4 className=\"text-white font-black text-xl tracking-wider\">{c.code}</h4>\n                                                                <p className=\"text-purple-400 font-bold text-sm\">\n                                                                    {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                                    <span className=\"text-slate-500 font-normal ml-2\">\n                                                                        (Min: ${c.minPurchase})\n                                                                    </span>\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-600 mt-1 flex gap-3\">\n                                                                    <span>Usado: {c.usedBy ? c.usedBy.length : 0} veces</span>\n                                                                    {c.usageLimit && <span>L√≠mite: {c.usageLimit}</span>}\n                                                                    {c.expirationDate && <span>Vence: {c.expirationDate}</span>}\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 md:mt-0\">\n                                                            {c.targetType === 'global' && (\n                                                                <div className=\"bg-purple-900/30 text-purple-400 px-3 py-1 rounded-lg border border-purple-500/30 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest\">\n                                                                    <Globe className=\"w-3 h-3\" /> Social\n                                                                </div>\n                                                            )}\n                                                            <button\n                                                                onClick={() => {\n                                                                    navigator.clipboard.writeText(c.code);\n                                                                    showToast(\"C√≥digo copiado al portapapeles\", \"success\");\n                                                                }}\n                                                                className=\"bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white p-3 rounded-xl transition border border-slate-800\"\n                                                                title=\"Copiar C√≥digo\"\n                                                            >\n                                                                <Copy className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button\n                                                                onClick={() => openConfirm(\"Eliminar Cup√≥n\", \"¬øEliminar este cup√≥n?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', c.id)))}\n                                                                className=\"bg-slate-900 hover:bg-red-900/20 text-slate-500 hover:text-red-400 p-3 rounded-xl transition border border-slate-800\"\n                                                            >\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: USERS (NUEVO) */}\n\n                                    {adminTab === 'users' && (() => {\n                                        const filteredUsers = users.filter(u => {\n                                            const query = userSearch.toLowerCase();\n                                            const matchesSearch = (u.name || '').toLowerCase().includes(query) ||\n                                                (u.email || '').toLowerCase().includes(query) ||\n                                                (u.username || '').toLowerCase().includes(query);\n                                            const matchesRole = userRoleFilter === 'all' || u.role === userRoleFilter;\n                                            return matchesSearch && matchesRole;\n                                        });\n\n                                        return (\n                                            <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                                <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10\">\n                                                    <div>\n                                                        <h1 className=\"text-4xl font-black text-white tracking-tighter flex items-center gap-4\">\n                                                            <div className=\"w-12 h-12 rounded-2xl bg-pink-500/20 flex items-center justify-center border border-pink-500/30\">\n                                                                <Users className=\"w-6 h-6 text-pink-400\" />\n                                                            </div>\n                                                            Gesti√≥n de Usuarios\n                                                        </h1>\n                                                        <p className=\"text-slate-500 mt-2 font-medium\">Control total sobre cuentas, roles y auditor√≠a de carritos.</p>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto\">\n                                                        <div className=\"w-full sm:w-auto flex justify-end\">\n                                                            <AdminHowToUse guideKey=\"users\" />\n                                                        </div>\n                                                        <div className=\"relative w-full sm:w-64 group\">\n                                                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 group-focus-within:text-orange-400 transition\" />\n                                                            <input\n                                                                className=\"input-cyber w-full pl-11 pr-4 py-3 text-sm\"\n                                                                placeholder=\"Buscar por nombre, email...\"\n                                                                value={userSearch}\n                                                                onChange={e => setUserSearch(e.target.value)}\n                                                            />\n                                                        </div>\n                                                        <div className=\"flex bg-slate-900/50 p-1 rounded-xl border border-white/5\">\n                                                            {['all', 'admin', 'user'].map(role => (\n                                                                <button\n                                                                    key={role}\n                                                                    onClick={() => setUserRoleFilter(role)}\n                                                                    className={`px-4 py-2 rounded-lg text-xs font-black uppercase transition-all ${userRoleFilter === role ? 'bg-white/10 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\n                                                                >\n                                                                    {role === 'all' ? 'Todos' : role}\n                                                                </button>\n                                                            ))}\n                                                        </div>\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"bg-[#050505] border border-white/5 rounded-[2.5rem] overflow-hidden shadow-2xl\">\n                                                    <div className=\"overflow-x-auto overflow-y-visible\">\n                                                        <table className=\"w-full text-left border-collapse\">\n                                                            <thead>\n                                                                <tr className=\"bg-white/[0.02] border-b border-white/5\">\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Identidad</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-center\">Actividad & Stats</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Rango</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-right\">Acciones</th>\n                                                                </tr>\n                                                            </thead>\n                                                            <tbody className=\"divide-y divide-white/5\">\n                                                                {filteredUsers.length === 0 ? (\n                                                                    <tr>\n                                                                        <td colSpan=\"4\" className=\"p-20 text-center\">\n                                                                            <div className=\"flex flex-col items-center gap-4 opacity-20\">\n                                                                                <UserPlus className=\"w-16 h-16\" />\n                                                                                <p className=\"font-black uppercase tracking-widest\">No se encontraron usuarios</p>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ) : filteredUsers.map((u, idx) => (\n                                                                    <tr key={u.id} style={{ animationDelay: `${idx * 0.03}s` }} className=\"group hover:bg-white/[0.01] transition-all animate-fade-up\">\n                                                                        <td className=\"p-5\">\n                                                                            <div className=\"flex items-center gap-5\">\n                                                                                <div className=\"relative group/avatar\">\n                                                                                    <div className=\"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl blur-lg opacity-20 group-hover/avatar:opacity-40 transition\" />\n                                                                                    <div className=\"relative w-14 h-14 rounded-2xl bg-[#0a0a0a] border border-white/10 flex items-center justify-center text-xl font-black text-white overflow-hidden shadow-xl\">\n                                                                                        {u.image ? <img src={u.image} className=\"w-full h-full object-cover\" /> : (u.name || '?').charAt(0).toUpperCase()}\n                                                                                    </div>\n                                                                                </div>\n                                                                                <div>\n                                                                                    <div className=\"flex items-center gap-2\">\n                                                                                        <p className=\"font-bold text-white text-lg tracking-tight\">{u.name}</p>\n                                                                                        {u.isVerified && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 font-mono\">{u.email}</p>\n                                                                                    <div className=\"flex items-center gap-3 mt-2\">\n                                                                                        <span className=\"text-[9px] font-black text-slate-600 uppercase tracking-widest bg-white/5 px-2 py-0.5 rounded-md\">ID: {u.id.slice(-6)}</span>\n                                                                                        <span className=\"text-[9px] font-bold text-slate-500 uppercase\">INC. {new Date(u.joinDate).toLocaleDateString()}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8 relative\">\n                                                                            {/* Blur Overlay for Entrepreneur Plan */}\n                                                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                                                <button\n                                                                                    onClick={() => setShowPlansModal(true)}\n                                                                                    className=\"absolute inset-0 z-10 flex items-center justify-center bg-black/60 backdrop-blur-sm rounded-xl cursor-pointer hover:bg-black/70 transition group\"\n                                                                                >\n                                                                                    <div className=\"text-center\">\n                                                                                        <Lock className=\"w-6 h-6 text-yellow-500 mx-auto mb-2 group-hover:scale-110 transition\" />\n                                                                                        <p className=\"text-xs font-black text-yellow-400 uppercase tracking-wider\">Plan Negocio</p>\n                                                                                        <p className=\"text-[10px] text-slate-400 group-hover:text-white transition\">Clic para ver planes</p>\n                                                                                    </div>\n                                                                                </button>\n                                                                            )}\n                                                                            <div className={`flex flex-col items-center gap-3 ${(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) ? 'filter blur-sm pointer-events-none' : ''}`}>\n                                                                                <div className=\"flex gap-2\">\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Favoritos\">\n                                                                                        <Heart className={`w-4 h-4 ${u.favorites?.length > 0 ? 'text-pink-500 fill-pink-500' : 'text-slate-600'}`} />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.favorites ? u.favorites.length : 0}</span>\n                                                                                    </div>\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Pedidos Realizados\">\n                                                                                        <ShoppingBag className=\"w-4 h-4 text-orange-500\" />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.ordersCount || 0}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                                <button\n                                                                                    onClick={() => setViewUserCart(u)}\n                                                                                    className=\"w-full py-2.5 rounded-xl border border-orange-500/20 bg-orange-500/5 text-orange-400 hover:bg-orange-500/20 text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2\"\n                                                                                >\n                                                                                    <Maximize2 className=\"w-3 h-3\" /> Ver Carrito en Vivo\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.1em] border shadow-inner ${u.role === 'admin'\n                                                                                ? 'bg-purple-500/10 text-purple-400 border-purple-500/30'\n                                                                                : 'bg-slate-900/50 text-slate-500 border-white/5'\n                                                                                }`}>\n                                                                                {u.role === 'admin' ? <Shield className=\"w-3 h-3\" /> : <User className=\"w-3 h-3\" />}\n                                                                                {u.role}\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className=\"flex justify-end gap-3 translate-x-2 opacity-60 group-hover:opacity-100 transition-opacity\">\n                                                                                <button\n                                                                                    onClick={() => setViewUserEdit(u)}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-orange-400 hover:border-orange-500/40 hover:bg-orange-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Gestionar Perfil\"\n                                                                                >\n                                                                                    <Edit className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                                <button\n                                                                                    onClick={() => {\n                                                                                        setNewAdminPassword('');\n                                                                                        setUserPassModal(u);\n                                                                                    }}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-pink-400 hover:border-pink-500/40 hover:bg-pink-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Seguridad & Acceso\"\n                                                                                >\n                                                                                    <Lock className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ))}\n                                                            </tbody>\n                                                        </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        );\n                                    })()}\n\n\n                                    {/* TAB: PROMOS (NUEVO) */}\n                                    {adminTab === 'promos' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white flex items-center gap-3\">\n                                                    <Tag className=\"w-8 h-8 text-purple-500\" /> Gesti√≥n de Promos\n                                                </h1>\n                                                <AdminHowToUse guideKey=\"promos\" />\n                                            </div>\n\n                                            {/* Formulario Nueva Promo */}\n                                            {/* Formulario Nueva Promo o Banner Upgrade */}\n                                            {(!((settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && promos.length >= 1) || isEditingPromo) ? (\n                                                <div className=\"bg-[#0a0a0a] border border-purple-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        {isEditingPromo ? <Edit className=\"w-5 h-5 text-purple-400\" /> : <Plus className=\"w-5 h-5 text-green-400\" />}\n                                                        {isEditingPromo ? 'Editar Promo' : 'Crear Nueva Promo'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                        {/* Datos B√°sicos */}\n                                                        <div className=\"space-y-4\">\n                                                            <input\n                                                                type=\"text\"\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Nombre de la Promo\"\n                                                                value={newPromo.name}\n                                                                onChange={e => setNewPromo({ ...newPromo, name: e.target.value })}\n                                                            />\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <div className=\"relative\">\n                                                                    <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\">$</span>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        className=\"input-cyber w-full p-4 pl-8\"\n                                                                        placeholder=\"Precio\"\n                                                                        value={newPromo.price}\n                                                                        onChange={e => setNewPromo({ ...newPromo, price: e.target.value })}\n                                                                    />\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900 rounded-xl border border-slate-700 text-slate-400 font-mono text-sm flex items-center\">\n                                                                    Costo: ${newPromo.items.reduce((acc, item) => {\n                                                                        const p = products.find(prod => prod.id === item.productId);\n                                                                        return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                    }, 0).toLocaleString()}\n                                                                </div>\n                                                            </div>\n                                                            <div className=\"mb-4\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de la Promo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={e => handleImageUpload(e, setNewPromo)}\n                                                                />\n                                                                {newPromo.image && (\n                                                                    <div className=\"mt-2 relative group w-32 aspect-video overflow-hidden rounded-xl border border-slate-700\">\n                                                                        <img src={newPromo.image} className=\"w-full h-full object-cover\" />\n                                                                        <button onClick={() => setNewPromo({ ...newPromo, image: '' })} className=\"absolute top-1 right-1 bg-black/50 p-1 rounded-full text-white hover:bg-red-500 transition opacity-0 group-hover:opacity-100\">\n                                                                            <X className=\"w-3 h-3\" />\n                                                                        </button>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                placeholder=\"Descripci√≥n breve...\"\n                                                                value={newPromo.description}\n                                                                onChange={e => setNewPromo({ ...newPromo, description: e.target.value })}\n                                                            />\n                                                        </div>\n\n                                                        {/* Constructor de Bundle */}\n                                                        <div className=\"bg-slate-900/40 p-6 rounded-2xl border border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                                                <Package className=\"w-4 h-4\" /> Productos Incluidos\n                                                            </p>\n\n                                                            <div className=\"grid grid-cols-1 sm:grid-cols-[1fr_5rem_auto] gap-2 mb-4\">\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3 text-sm min-w-0\"\n                                                                    value={selectedPromoProduct}\n                                                                    onChange={e => setSelectedPromoProduct(e.target.value)}\n                                                                >\n                                                                    <option value=\"\">Agregar producto...</option>\n                                                                    {products.map(p => (\n                                                                        <option key={p.id} value={p.id}>{p.name} (${Number(p.basePrice)})</option>\n                                                                    ))}\n                                                                </select>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full sm:w-20 p-3 text-sm text-center\"\n                                                                    value={promoProductQty}\n                                                                    min=\"1\"\n                                                                    onChange={e => setPromoProductQty(Math.max(1, parseInt(e.target.value) || 1))}\n                                                                />\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!selectedPromoProduct) return;\n                                                                        const exists = newPromo.items.find(i => i.productId === selectedPromoProduct);\n                                                                        if (exists) {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: newPromo.items.map(i => i.productId === selectedPromoProduct ? { ...i, quantity: i.quantity + promoProductQty } : i)\n                                                                            });\n                                                                        } else {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: [...newPromo.items, { productId: selectedPromoProduct, quantity: promoProductQty }]\n                                                                            });\n                                                                        }\n                                                                        setSelectedPromoProduct('');\n                                                                        setPromoProductQty(1);\n                                                                    }}\n                                                                    className=\"h-[46px] w-full sm:w-auto px-4 bg-purple-600 hover:bg-purple-500 text-white rounded-xl transition flex items-center justify-center\"\n                                                                >\n                                                                    <Plus className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n\n                                                            <div className=\"space-y-2 max-h-[150px] overflow-y-auto custom-scrollbar\">\n                                                                {newPromo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    if (!p) return null;\n                                                                    return (\n                                                                        <div key={idx} className=\"flex justify-between items-center bg-slate-900 p-3 rounded-lg border border-slate-700\">\n                                                                            <div className=\"flex items-center gap-3\">\n                                                                                <img src={p.image} className=\"w-8 h-8 rounded bg-white object-contain p-0.5\" />\n                                                                                <div>\n                                                                                    <p className=\"text-sm font-bold text-white truncate max-w-[200px] sm:max-w-none\">{p.name}</p>\n                                                                                    <p className=\"text-xs text-slate-500\">{item.quantity} un. x ${p.basePrice}</p>\n                                                                                </div>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewPromo({ ...newPromo, items: newPromo.items.filter((_, i) => i !== idx) })}\n                                                                                className=\"text-red-500 hover:text-red-400 p-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-4 h-4\" />\n                                                                            </button>\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                                {newPromo.items.length === 0 && (\n                                                                    <div className=\"text-center py-6 text-slate-600 italic text-sm border border-dashed border-slate-800 rounded-lg\">\n                                                                        Agrega productos para armar el combo\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end mt-6\">\n                                                        {isEditingPromo && (\n                                                            <button\n                                                                onClick={() => {\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                }}\n                                                                className=\"w-full sm:w-auto px-6 py-3 rounded-xl border border-slate-800 bg-slate-900/40 text-slate-300 hover:text-white hover:bg-slate-900 transition font-bold\"\n                                                            >\n                                                                Cancelar\n                                                            </button>\n                                                        )}\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newPromo.name || !newPromo.price || newPromo.items.length === 0) {\n                                                                    return showToast(\"Completa nombre, precio y agrega productos.\", \"warning\");\n                                                                }\n\n                                                                setIsLoading(true);\n                                                                try {\n                                                                    if (isEditingPromo && editingPromoId) {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', editingPromoId), newPromo);\n                                                                        showToast(\"Promo actualizada\", \"success\");\n                                                                    } else {\n                                                                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'promos'), {\n                                                                            ...newPromo,\n                                                                            createdAt: new Date().toISOString()\n                                                                        });\n                                                                        showToast(\"Promo creada exitosamente\", \"success\");\n                                                                    }\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                } catch (e) {\n                                                                    console.error(e);\n                                                                    showToast(\"Error al guardar promo\", \"error\");\n                                                                } finally {\n                                                                    setIsLoading(false);\n                                                                }\n                                                            }}\n                                                            className=\"w-full sm:w-auto px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center\"\n                                                        >\n                                                            {isEditingPromo ? 'Guardar Cambios' : 'Crear Promo'}\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            ) : (\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] mb-10 shadow-xl flex flex-col items-center justify-center text-center animate-fade-up\">\n                                                    <div className=\"w-20 h-20 bg-purple-500/20 rounded-full flex items-center justify-center mb-6 border border-purple-500/30\">\n                                                        <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                    </div>\n                                                    <h3 className=\"text-2xl font-black text-white mb-2\">L√≠mite de Promos Alcanzado</h3>\n                                                    <p className=\"text-slate-400 max-w-md mb-8\">\n                                                        Tu plan actual te permite tener hasta <strong className=\"text-white\">1 promo activa</strong>.\n                                                        Para crear m√°s promociones ilimitadas, actualiza tu plan.\n                                                    </p>\n                                                    <button\n                                                        onClick={() => setShowPlansModal(true)}\n                                                        className=\"px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg shadow-purple-600/20 transition flex items-center gap-2\"\n                                                    >\n                                                        <Zap className=\"w-5 h-5\" /> Mejorar mi Plan\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Promos */}\n                                            {/* Lista de Promos */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {promos.map(promo => {\n                                                    const totalCost = (promo.items || []).reduce((acc, item) => {\n                                                        const p = products.find(prod => prod.id === item.productId);\n                                                        return acc + ((Number(p?.purchasePrice) || 0) * item.quantity);\n                                                    }, 0);\n                                                    const price = Number(promo.price) || 0;\n                                                    const profit = price - totalCost;\n                                                    const margin = price > 0 ? ((profit / price) * 100).toFixed(1) : 0;\n                                                    const isProfitable = profit > 0;\n\n                                                    return (\n                                                        <div key={promo.id} className=\"bg-[#0a0a0a] border border-slate-800 rounded-2xl overflow-hidden hover:border-purple-500/30 transition group flex flex-col\">\n                                                            <div className=\"aspect-video relative overflow-hidden\">\n                                                                <img src={promo.image || 'https://via.placeholder.com/400'} className=\"w-full h-full object-cover transition duration-500 group-hover:scale-105\" />\n                                                                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent\"></div>\n                                                                <div className=\"absolute bottom-4 left-4 right-4 bg-black/55 backdrop-blur-sm rounded-2xl p-4 border border-white/10\">\n                                                                    <h4 className=\"text-xl font-black text-white mb-1 leading-tight\">{promo.name}</h4>\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <p className=\"text-3xl text-purple-400 font-black\">${price.toLocaleString()}</p>\n                                                                        {totalCost > 0 && (\n                                                                            <div className={`px-2 py-1 rounded text-xs font-bold border ${isProfitable ? 'bg-green-900/30 border-green-500/30 text-green-400' : 'bg-red-900/30 border-red-500/30 text-red-400'}`}>\n                                                                                {margin}% MG\n                                                                            </div>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"p-6 flex-1 flex flex-col\">\n                                                                {/* Productos Incluidos con Miniaturas */}\n                                                                <div className=\"mb-6 flex-1\">\n                                                                    <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Incluye:</p>\n                                                                    <div className=\"flex flex-col gap-2\">\n                                                                        {(promo.items || []).map((item, i) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return (\n                                                                                <div key={i} className=\"flex items-center gap-3 p-2 rounded-lg bg-slate-900/50 border border-slate-800/50\">\n                                                                                    <div className=\"w-10 h-10 bg-white rounded-lg p-0.5 flex-shrink-0\">\n                                                                                        <img src={p?.image} className=\"w-full h-full object-contain\" />\n                                                                                    </div>\n                                                                                    <div className=\"flex-1 min-w-0\">\n                                                                                        <p className=\"text-sm font-bold text-white truncate\">{p?.name || 'Producto Eliminado'}</p>\n                                                                                        <p className=\"text-xs text-slate-500\">{item.quantity} x ${Number(p?.basePrice || 0).toLocaleString()} (Costo)</p>\n                                                                                    </div>\n                                                                                </div>\n                                                                            )\n                                                                        })}\n                                                                    </div>\n                                                                </div>\n\n                                                                {/* An√°lisis de Rentabilidad */}\n                                                                <div className=\"mb-6 p-4 bg-slate-900/40 rounded-xl border border-dashed border-slate-800\">\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Costo Real:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${totalCost.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Precio Venta:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${price.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"border-t border-slate-800 my-2\"></div>\n                                                                    <div className=\"flex justify-between text-sm font-bold\">\n                                                                        <span className={isProfitable ? \"text-green-500\" : \"text-red-500\"}>Ganancia Neta:</span>\n                                                                        <span className={`font-mono ${isProfitable ? \"text-green-400\" : \"text-red-400\"}`}>\n                                                                            {isProfitable ? '+' : ''}${profit.toLocaleString()}\n                                                                        </span>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex gap-3 mt-auto\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            setNewPromo({\n                                                                                name: promo.name,\n                                                                                price: promo.price,\n                                                                                image: promo.image,\n                                                                                description: promo.description || '',\n                                                                                items: promo.items || []\n                                                                            });\n                                                                            setEditingPromoId(promo.id);\n                                                                            setIsEditingPromo(true);\n                                                                            window.scrollTo({ top: 0, behavior: 'smooth' });\n                                                                        }}\n                                                                        className=\"flex-1 py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-bold transition border border-slate-700 flex items-center justify-center gap-2 group-hover:border-purple-500/30\"\n                                                                    >\n                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                    </button>\n                                                                    <button\n                                                                        onClick={() => openConfirm('Eliminar Promo', '¬øEst√°s seguro? Esto no se puede deshacer.', async () => {\n                                                                            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', promo.id));\n                                                                            showToast(\"Promo eliminada\", \"info\");\n                                                                        })}\n                                                                        className=\"px-4 py-3 bg-red-900/20 hover:bg-red-900/40 text-red-500 rounded-xl transition border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PEDIDOS (RESTAURADO) */}\n                                    {adminTab === 'orders' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Pedidos</h1>\n                                                <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"orders\" />\n                                                    <button onClick={() => toggleAdminOrderAlarmMuted()} className={`px-5 py-3 rounded-xl font-black transition border flex items-center gap-3 ${adminOrderAlarmMuted ? 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800' : 'bg-green-900/10 text-green-400 border-green-500/20 hover:bg-green-600 hover:text-white'}`}>\n                                                        <Bell className={`w-5 h-5 ${adminOrderAlarmMuted ? 'opacity-40' : ''}`} />\n                                                        Notificaci√≥n pedidos\n                                                        <span className={`text-[10px] px-2 py-1 rounded-full border font-black uppercase tracking-widest ${adminOrderAlarmMuted ? 'bg-slate-900/60 text-slate-400 border-slate-700' : 'bg-green-900/20 text-green-400 border-green-500/30'}`}>\n                                                            {adminOrderAlarmMuted ? 'Muteada' : 'Activa'}\n                                                        </span>\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {orders.length === 0 ? (\n                                                <div className=\"text-center py-20 border border-dashed border-slate-800 rounded-[3rem] bg-slate-900/20\">\n                                                    <ShoppingBag className=\"w-20 h-20 mx-auto mb-4 text-slate-700\" />\n                                                    <p className=\"text-xl text-slate-500 font-bold\">No hay pedidos registrados a√∫n.</p>\n                                                </div>\n                                            ) : (\n                                                <div className=\"space-y-4\">\n                                                    {orders.map((o, idx) => (\n                                                        <div\n                                                            key={o.id}\n                                                            style={{ animationDelay: `${idx * 0.05}s` }}\n                                                            className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col lg:flex-row justify-between items-center gap-6 hover:border-slate-700 transition group animate-fade-up\"\n                                                        >\n                                                            {/* Info Principal */}\n                                                            <div className=\"flex-1 w-full lg:w-auto\">\n                                                                <div className=\"flex items-center gap-4 mb-2\">\n                                                                    <span className=\"bg-slate-900 text-orange-400 px-3 py-1 rounded-lg text-sm font-black tracking-widest border border-slate-800\">\n                                                                        #{o.orderId}\n                                                                    </span>\n                                                                    <span className={`text-[10px] px-2 py-1 rounded-full uppercase font-bold border ${o.status === 'Realizado' ? 'bg-green-900/20 text-green-400 border-green-500/30' : 'bg-yellow-900/20 text-yellow-400 border-yellow-500/30'}`}>\n                                                                        {o.status}\n                                                                    </span>\n                                                                </div>\n                                                                <h4 className=\"text-white font-bold text-lg mb-1\">{o.customer.name}</h4>\n                                                                <p className=\"text-slate-500 text-xs flex items-center gap-2\">\n                                                                    <Clock className=\"w-3 h-3\" /> {new Date(o.date).toLocaleString()}\n                                                                    <span className=\"w-1 h-1 bg-slate-700 rounded-full\"></span>\n                                                                    <span className=\"text-slate-400 font-mono\">${o.total.toLocaleString()}</span>\n                                                                </p>\n                                                            </div>\n\n                                                            {/* Items Preview */}\n                                                            <div className=\"flex -space-x-2\">\n                                                                {o.items.slice(0, 4).map((i, idx) => (\n                                                                    <div key={idx} className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center overflow-hidden\" title={i.title}>\n                                                                        {i.image ? <img src={i.image} className=\"w-full h-full object-cover\" /> : <Package className=\"w-4 h-4 text-slate-500\" />}\n                                                                    </div>\n                                                                ))}\n                                                                {o.items.length > 4 && (\n                                                                    <div className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center text-xs text-white font-bold\">\n                                                                        +{o.items.length - 4}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Acciones */}\n                                                            <div className=\"flex items-center gap-3 w-full lg:w-auto justify-end\">\n                                                                <button onClick={() => setSelectedOrder(o)} className=\"p-3 bg-slate-900 hover:bg-slate-800 text-slate-300 hover:text-white rounded-xl transition border border-slate-800\" title=\"Ver Detalles\">\n                                                                    <Eye className=\"w-5 h-5\" />\n                                                                </button>\n\n                                                                {o.status !== 'Realizado' && (\n                                                                    <button onClick={() => finalizeOrderFn(o.id)} className=\"p-3 bg-green-900/10 hover:bg-green-600 text-green-500 hover:text-white rounded-xl transition border border-green-500/20\" title=\"Marcar como Finalizado\">\n                                                                        <CheckCircle className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                )}\n\n                                                                <button onClick={() => deleteOrderFn(o.id)} className=\"p-3 bg-red-900/10 hover:bg-red-600 text-red-500 hover:text-white rounded-xl transition border border-red-500/20\" title=\"Eliminar Pedido\">\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PRODUCTOS (LISTA Y FORMULARIO) */}\n                                    {adminTab === 'products' && (\n                                        <div className=\"max-w-7xl mx-auto animate-fade-in pb-20\">\n                                            <div className=\"flex justify-between items-center mb-8\">\n                                                <div>\n                                                    <h1 className=\"text-3xl font-black text-white\">Inventario</h1>\n                                                    {(() => {\n                                                        const plan = settings?.subscriptionPlan || 'entrepreneur';\n                                                        const limit = plan === 'premium' ? '‚àû' : plan === 'business' ? 50 : 30;\n                                                        const current = products.length;\n                                                        const isNearLimit = plan !== 'premium' && current >= limit * 0.8;\n                                                        return (\n                                                            <p className={`text-sm font-bold mt-1 ${isNearLimit ? 'text-yellow-400' : 'text-slate-500'}`}>\n                                                                {current} / {limit} productos\n                                                                {isNearLimit && plan !== 'premium' && <span className=\"text-yellow-500 ml-2\">‚ö† Cerca del l√≠mite</span>}\n                                                            </p>\n                                                        );\n                                                    })()}\n                                                </div>\n                                                <div className=\"flex gap-2\">\n                                                    <AdminHowToUse guideKey=\"products\" />\n                                                    <button onClick={() => setShowCategoryModal(true)} className=\"bg-slate-800 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-slate-700 transition transform hover:scale-105 active:scale-95 border border-slate-700\">\n                                                        <FolderPlus className=\"w-5 h-5\" /> Categor√≠as\n                                                    </button>\n                                                    <button onClick={() => { setNewProduct({}); setEditingId(null); setShowProductForm(true) }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:scale-105 active:scale-95\">\n                                                        <Plus className=\"w-5 h-5\" /> Agregar Producto\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* Banner de advertencia si hay productos desactivados por l√≠mite de plan */}\n                                            {(() => {\n                                                const deactivatedByPlan = products.filter(p => p.isActive === false && p.deactivatedByPlan);\n                                                const deactivatedManually = products.filter(p => p.isActive === false && !p.deactivatedByPlan);\n                                                const totalDeactivated = products.filter(p => p.isActive === false);\n\n                                                if (totalDeactivated.length > 0) {\n                                                    return (\n                                                        <div className=\"bg-yellow-900/20 border border-yellow-500/30 p-4 rounded-2xl mb-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n                                                            <div className=\"flex items-start gap-3\">\n                                                                <AlertTriangle className=\"w-6 h-6 text-yellow-400 flex-shrink-0 mt-0.5\" />\n                                                                <div>\n                                                                    <p className=\"font-bold text-yellow-400\">\n                                                                        {totalDeactivated.length} producto(s) desactivado(s)\n                                                                    </p>\n                                                                    <p className=\"text-sm text-yellow-200/70\">\n                                                                        {deactivatedByPlan.length > 0 && `${deactivatedByPlan.length} por l√≠mite de plan. `}\n                                                                        {deactivatedManually.length > 0 && `${deactivatedManually.length} desactivado(s) manualmente. `}\n                                                                        Los productos desactivados no se muestran en la tienda.\n                                                                    </p>\n                                                                </div>\n                                                            </div>\n                                                            <button\n                                                                onClick={() => showToast(\"Usa el bot√≥n de ojo (üëÅ) en cada producto para activar/desactivar\", \"info\")}\n                                                                className=\"px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-xl font-bold text-sm hover:bg-yellow-500/30 transition border border-yellow-500/30 whitespace-nowrap\"\n                                                            >\n                                                                Ver desactivados\n                                                            </button>\n                                                        </div>\n                                                    );\n                                                }\n                                                return null;\n                                            })()}\n\n                                            {/* Formulario Productos (Expandido) */}\n                                            {showProductForm && (\n                                                <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl relative\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6\">\n                                                        {editingId ? 'Editar Producto' : 'Nuevo Producto'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                        <div className=\"space-y-4\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Producto\" value={newProduct.name || ''} onChange={e => setNewProduct({ ...newProduct, name: e.target.value })} />\n                                                            <div className=\"flex gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Precio Venta ($)\" value={newProduct.basePrice || ''} onChange={e => setNewProduct({ ...newProduct, basePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Costo Compra ($)\" value={newProduct.purchasePrice || ''} onChange={e => setNewProduct({ ...newProduct, purchasePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Stock\" value={newProduct.stock || ''} onChange={e => setNewProduct({ ...newProduct, stock: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"space-y-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2\">\n                                                                    Categor√≠as (Selecciona una o m√°s)\n                                                                </label>\n                                                                <div className=\"bg-slate-900/50 border border-slate-700 rounded-xl p-4 max-h-64 overflow-y-auto custom-scrollbar\">\n                                                                    {(settings?.categories || []).length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 py-4 text-sm\">\n                                                                            No hay categor√≠as disponibles. Agr√©galas abajo.\n                                                                        </p>\n                                                                    ) : (\n                                                                        (settings?.categories || []).map(cat => {\n                                                                            // Soporte retrocompatible: verificar tanto categories (array) como category (string)\n                                                                            const isSelected = Array.isArray(newProduct.categories)\n                                                                                ? newProduct.categories.includes(cat)\n                                                                                : (newProduct.category === cat);\n\n                                                                            return (\n                                                                                <label\n                                                                                    key={cat}\n                                                                                    className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all group hover:bg-slate-800 mb-2 last:mb-0 ${isSelected ? 'bg-orange-900/20 border border-orange-500/30' : 'border border-transparent'\n                                                                                        }`}\n                                                                                >\n                                                                                    <input\n                                                                                        type=\"checkbox\"\n                                                                                        checked={isSelected}\n                                                                                        onChange={(e) => {\n                                                                                            if (e.target.checked) {\n                                                                                                // Agregar categor√≠a\n                                                                                                const current = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories\n                                                                                                    : (newProduct.category ? [newProduct.category] : []);\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: [...current, cat],\n                                                                                                    category: undefined // Eliminar el campo antiguo\n                                                                                                });\n                                                                                            } else {\n                                                                                                // Remover categor√≠a\n                                                                                                const updated = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories.filter(c => c !== cat)\n                                                                                                    : [];\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: updated\n                                                                                                });\n                                                                                            }\n                                                                                        }}\n                                                                                        className=\"w-4 h-4 text-orange-600 bg-slate-900 border-slate-600 rounded focus:ring-orange-500 focus:ring-2\"\n                                                                                    />\n                                                                                    <span className={`flex-1 text-sm font-medium transition-colors ${isSelected ? 'text-orange-400' : 'text-slate-300 group-hover:text-white'\n                                                                                        }`}>\n                                                                                        {cat}\n                                                                                    </span>\n                                                                                    {isSelected && (\n                                                                                        <span className=\"text-xs font-bold text-orange-500 bg-orange-500/10 px-2 py-0.5 rounded flex items-center gap-1\">\n                                                                                            <CheckCircle className=\"w-3 h-3\" />\n                                                                                        </span>\n                                                                                    )}\n                                                                                </label>\n                                                                            );\n                                                                        })\n                                                                    )}\n                                                                </div>\n                                                                {/* Mostrar categor√≠as seleccionadas como tags */}\n                                                                {newProduct.categories && newProduct.categories.length > 0 && (\n                                                                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                                                                        {newProduct.categories.map(cat => (\n                                                                            <span\n                                                                                key={cat}\n                                                                                className=\"bg-orange-500/20 text-orange-400 text-xs font-bold px-3 py-1.5 rounded-full border border-orange-500/30 flex items-center gap-2\"\n                                                                            >\n                                                                                {cat}\n                                                                                <button\n                                                                                    type=\"button\"\n                                                                                    onClick={() => {\n                                                                                        setNewProduct({\n                                                                                            ...newProduct,\n                                                                                            categories: newProduct.categories.filter(c => c !== cat)\n                                                                                        });\n                                                                                    }}\n                                                                                    className=\"hover:text-orange-300 transition\"\n                                                                                >\n                                                                                    <X className=\"w-3 h-3\" />\n                                                                                </button>\n                                                                            </span>\n                                                                        ))}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <button\n                                                                type=\"button\"\n                                                                onClick={() => setShowCategoryModal(true)}\n                                                                className=\"w-full mt-2 py-2 bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 rounded-xl font-bold transition flex items-center justify-center gap-2 text-sm border border-orange-800\"\n                                                            >\n                                                                <FolderPlus className=\"w-4 h-4\" /> Nueva Categor√≠a\n                                                            </button>\n                                                        </div>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Imagen del Producto\n                                                                </label>\n                                                                <div className=\"space-y-3\">\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewProduct)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newProduct.image && (\n                                                                        <div className=\"bg-white rounded-xl p-3 w-32 h-32\">\n                                                                            <img src={newProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Descuento (%)\n                                                                </label>\n                                                                <p className=\"text-xs text-slate-400 mb-2\">Porcentaje de descuento sobre el precio base (0-100)</p>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    min=\"0\"\n                                                                    max=\"100\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"0\"\n                                                                    value={newProduct.discount || 0}\n                                                                    onChange={e => setNewProduct({ ...newProduct, discount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <textarea className=\"input-cyber w-full h-32 p-4 mb-6 resize-none\" placeholder=\"Descripci√≥n detallada del producto...\" value={newProduct.description || ''} onChange={e => setNewProduct({ ...newProduct, description: e.target.value })} />\n\n                                                    <div className=\"flex gap-4 justify-end\">\n                                                        <button onClick={() => setShowProductForm(false)} className=\"px-6 py-3 text-slate-400 font-bold hover:text-white transition\">Cancelar</button>\n                                                        <button onClick={saveProductFn} className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\">Guardar Producto</button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Productos */}\n                                            <div className=\"grid gap-3\">\n                                                {products.map((p, idx) => (\n                                                    <div\n                                                        key={p.id}\n                                                        style={{ animationDelay: `${idx * 0.05}s` }}\n                                                        className={`bg-[#0a0a0a] border p-4 rounded-xl flex flex-col sm:flex-row justify-between items-center group hover:border-orange-900/50 transition animate-fade-up ${p.isActive === false ? 'border-yellow-500/30 opacity-60' : 'border-slate-800'}`}\n                                                    >\n                                                        <div className=\"flex items-center gap-6 w-full sm:w-auto\">\n                                                            <div className={`w-16 h-16 bg-white rounded-lg p-2 flex-shrink-0 relative ${p.isActive === false ? 'grayscale' : ''}`}>\n                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                {p.isFeatured && (\n                                                                    <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg\">\n                                                                        <Star className=\"w-3 h-3 text-black fill-current\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-lg flex items-center gap-2\">\n                                                                    {p.name}\n                                                                    {p.isFeatured && <span className=\"text-[10px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full font-bold\">DESTACADO</span>}\n                                                                    {p.isActive === false && <span className=\"text-[10px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full font-bold\">OCULTO{p.deactivatedByPlan ? ' (L√çMITE)' : ''}</span>}\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-500 font-mono\">\n                                                                    Stock: <span className={(p.stock || 0) < (settings?.lowStockThreshold || 5) ? 'text-red-400 font-bold animate-pulse' : 'text-slate-400'}>{p.stock || 0}</span> |\n                                                                    <span className=\"text-orange-400 font-bold ml-2\" title=\"Precio Venta\">${Number(p.basePrice).toLocaleString()}</span> |\n                                                                    <span className=\"text-slate-500 ml-2 font-mono\" title=\"Costo Adquisici√≥n\">Costo: ${Number(p.purchasePrice || 0).toLocaleString()}</span>\n                                                                    {Number(p.basePrice) > 0 && (\n                                                                        <span className={`ml-2 text-[10px] font-black px-1.5 py-0.5 rounded border ${((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) < 0.3 ? 'bg-red-900/20 text-red-400 border-red-500/20' : 'bg-green-900/20 text-green-400 border-green-500/20'}`}>\n                                                                            {(((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) * 100).toFixed(0)}%\n                                                                        </span>\n                                                                    )} |\n                                                                    <span className=\"text-green-400 ml-2\">Ventas: {(dashboardMetrics?.salesCount?.[p.id] || 0)}</span>\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto justify-end items-center\">\n                                                            {/* Toggle Featured */}\n                                                            <button\n                                                                onClick={async () => {\n                                                                    try {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', p.id), {\n                                                                            isFeatured: !p.isFeatured\n                                                                        });\n                                                                        showToast(p.isFeatured ? \"Producto quitado de destacados\" : \"Producto marcado como destacado\", \"success\");\n                                                                    } catch (e) {\n                                                                        console.error(e);\n                                                                        showToast(\"Error al actualizar\", \"error\");\n                                                                    }\n                                                                }}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isFeatured ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30 hover:bg-yellow-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-yellow-400 hover:border-yellow-500/30'}`}\n                                                                title={p.isFeatured ? \"Quitar de Destacados\" : \"Marcar como Destacado\"}\n                                                            >\n                                                                <Star className={`w-5 h-5 ${p.isFeatured ? 'fill-current' : ''}`} />\n                                                            </button>\n                                                            {/* Toggle Activar/Desactivar */}\n                                                            <button\n                                                                onClick={() => p.isActive === false ? reactivateProduct(p.id) : deactivateProduct(p.id)}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isActive === false ? 'bg-red-500/20 text-red-400 border-red-500/30 hover:bg-green-500/20 hover:text-green-400 hover:border-green-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-red-400 hover:border-red-500/30'}`}\n                                                                title={p.isActive === false ? \"Activar Producto (hacerlo visible en tienda)\" : \"Desactivar Producto (ocultarlo de la tienda)\"}\n                                                            >\n                                                                {p.isActive === false ? <Eye className=\"w-5 h-5\" /> : <EyeOff className=\"w-5 h-5\" />}\n                                                            </button>\n                                                            <button onClick={() => openManualSaleModal(p)} className=\"p-3 bg-slate-900 rounded-xl text-green-400 hover:bg-green-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\" title=\"Venta Manual (Descontar 1)\">\n                                                                <DollarSign className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => { setNewProduct(p); setEditingId(p.id); setShowProductForm(true) }} className=\"p-3 bg-slate-900 rounded-xl text-orange-400 hover:bg-orange-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Edit className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => deleteProductFn(p)} className=\"p-3 bg-slate-900 rounded-xl text-red-400 hover:bg-red-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n\n\n                                    {/* TAB: CONFIGURACI√ìN AVANZADA (NEW) */}\n                                    {adminTab === 'settings' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Developer-Only Access Block */}\n                                            {currentUser?.email !== SUPER_ADMIN_EMAIL && (\n                                                <div className=\"absolute inset-0 z-30 flex items-center justify-center bg-black/90 backdrop-blur-md rounded-[2.5rem]\">\n                                                    <div className=\"text-center p-8 max-w-lg\">\n                                                        <div className=\"w-24 h-24 mx-auto mb-6 bg-red-500/20 rounded-full flex items-center justify-center border border-red-500/30\">\n                                                            <Shield className=\"w-12 h-12 text-red-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-3xl font-black text-white mb-4\">Acceso Restringido</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Esta secci√≥n est√° reservada √∫nicamente para el <span className=\"text-orange-400 font-bold\">desarrollador</span> de la plataforma.</p>\n                                                        <div className=\"bg-slate-900/50 p-4 rounded-xl border border-slate-800 mb-6\">\n                                                            <p className=\"text-sm text-slate-500 mb-2\">Para solicitar cambios en la configuraci√≥n, contacta a:</p>\n                                                            <p className=\"text-orange-400 font-bold text-lg\">lautarocorazza63@gmail.com</p>\n                                                        </div>\n                                                        <p className=\"text-xs text-slate-600\">Si necesitas modificar tu tienda, env√≠a un email detallando los cambios que deseas realizar.</p>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            <h1 className=\"text-4xl font-black text-white neon-text mb-8 flex items-center gap-3\">\n                                                <Settings className=\"w-8 h-8 text-orange-500 animate-spin-slow\" /> Configuraci√≥n General\n                                            </h1>\n\n                                            {/* Sub-Navigation Tabs */}\n                                            <div className=\"flex flex-wrap gap-2 mb-8 pb-4 border-b border-slate-800\">\n                                                {[\n                                                    { id: 'store', label: 'Tienda', icon: Store },\n                                                    { id: 'appearance', label: 'Apariencia', icon: Palette },\n                                                    { id: 'social', label: 'Redes', icon: Share2 },\n                                                    { id: 'payments', label: 'Pagos', icon: CreditCard },\n                                                    { id: 'ticket', label: 'Ticket', icon: Ticket },\n                                                    { id: 'shipping', label: 'Env√≠os', icon: Truck },\n                                                    { id: 'seo', label: 'SEO', icon: Globe },\n                                                    { id: 'advanced', label: 'Avanzado', icon: Cog },\n                                                    { id: 'team', label: 'Equipo', icon: Users },\n                                                    // Only show Subscription tab to Super Admin\n                                                    ...(currentUser?.email === SUPER_ADMIN_EMAIL ? [{ id: 'subscription', label: 'Suscripciones', icon: Zap }] : [])\n                                                ].map(tab => (\n                                                    <button\n                                                        key={tab.id}\n                                                        onClick={() => setSettingsTab(tab.id)}\n                                                        className={`px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 transition-all duration-300 border ${settingsTab === tab.id ? 'bg-orange-600 text-white shadow-[0_0_20px_rgba(8,145,178,0.4)] border-orange-400 transform scale-105' : 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800'}`}\n                                                    >\n                                                        <tab.icon className={`w-4 h-4 ${settingsTab === tab.id ? 'animate-pulse' : ''}`} /> {tab.label}\n                                                    </button>\n                                                ))}\n                                            </div>\n\n                                            {/* === SUBSCRIPTION MANAGEMENT (SUPER ADMIN ONLY) === */}\n                                            {settingsTab === 'subscription' && currentUser?.email === SUPER_ADMIN_EMAIL && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] shadow-[0_0_50px_rgba(249,115,22,0.1)]\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 flex items-center gap-3\">\n                                                            <Zap className=\"w-6 h-6 text-yellow-500 fill-current\" />\n                                                            Modelos de Suscripci√≥n\n                                                        </h3>\n\n                                                        <div className=\"mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl flex items-center gap-4\">\n                                                            <AlertTriangle className=\"w-8 h-8 text-yellow-500\" />\n                                                            <div>\n                                                                <p className=\"font-bold text-yellow-500\">Zona de Peligro: Super Admin</p>\n                                                                <p className=\"text-sm text-yellow-200\">Cambiar el plan afecta inmediatamente los l√≠mites y funcionalidades de la tienda.</p>\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"mb-8 p-6 bg-slate-900/40 border border-slate-800 rounded-2xl\">\n                                                            <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                                                                <div>\n                                                                    <p className=\"text-white font-black text-lg\">Backup de Tienda</p>\n                                                                    <p className=\"text-slate-500 text-xs font-mono\">storeId: {appId || '‚Äî'}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-2\">\n                                                                    <button\n                                                                        disabled={isExportingBackup || !appId}\n                                                                        onClick={exportBackup}\n                                                                        className=\"px-4 py-3 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 font-black text-[10px] uppercase tracking-widest hover:bg-green-500/20 transition disabled:opacity-50\"\n                                                                    >\n                                                                        {isExportingBackup ? 'Exportando‚Ä¶' : 'Exportar'}\n                                                                    </button>\n                                                                    <label className={`px-4 py-3 rounded-xl bg-indigo-600/20 border border-indigo-500/30 text-indigo-200 font-black text-[10px] uppercase tracking-widest hover:bg-indigo-600/30 transition ${isImportingBackup || !appId ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                        {isImportingBackup ? 'Importando‚Ä¶' : 'Importar'}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"application/json\"\n                                                                            className=\"hidden\"\n                                                                            onChange={(e) => {\n                                                                                const file = e.target.files && e.target.files[0];\n                                                                                if (file) importBackupFile(file);\n                                                                                e.target.value = '';\n                                                                            }}\n                                                                        />\n                                                                    </label>\n                                                                </div>\n                                                            </div>\n                                                            <p className=\"text-slate-600 text-xs mt-4\">Importar escribe con merge (no borra por defecto). Usalo con cuidado.</p>\n                                                        </div>\n\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            {/* Plan Emprendedor */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('entrepreneur')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan ? 'bg-slate-900 border-orange-500 shadow-[0_0_30px_rgba(249,115,22,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Store className=\"w-6 h-6 text-orange-400\" />\n                                                                    </div>\n                                                                    {(settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan) && <div className=\"bg-orange-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Emprendedor</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">El esencial para arrancar s√≥lido pero econ√≥mico.</p>\n                                                                <div className=\"text-2xl font-black text-orange-400 mb-6\">$7.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Hasta 30 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Dominio Vercel</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Mercado Pago Directo</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Negocio */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('business')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'business' ? 'bg-slate-900 border-purple-500 shadow-[0_0_30px_rgba(168,85,247,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Briefcase className=\"w-6 h-6 text-purple-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'business' && <div className=\"bg-purple-500 text-white text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Negocio</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Para marcas con identidad definida.</p>\n                                                                <div className=\"text-2xl font-black text-purple-400 mb-6\">$14.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Hasta 50 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Personalizaci√≥n Visual</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Bot√≥n WhatsApp</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Premium */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('premium')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'premium' ? 'bg-slate-900 border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Sparkles className=\"w-6 h-6 text-yellow-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'premium' && <div className=\"bg-yellow-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Premium</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Servicio Full con IA.</p>\n                                                                <div className=\"text-2xl font-black text-yellow-400 mb-6\">$22.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Ilimitado / Full IA</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Carga Inicial (10)</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Mantenimiento Mensual</li>\n                                                                </ul>\n                                                            </button>\n                                                        </div>\n\n                                                        {/* Billing Cycle Selection */}\n                                                        <div className=\"mt-8 pt-8 border-t border-slate-800/50\">\n                                                            <h4 className=\"text-lg font-bold text-slate-300 mb-4 flex items-center gap-2\">\n                                                                <Calendar className=\"w-5 h-5 text-green-400\" /> Ciclo de Facturaci√≥n\n                                                            </h4>\n                                                            <div className=\"grid grid-cols-3 gap-4\">\n                                                                {[\n                                                                    { id: 'Semanal', label: 'Semanal' },\n                                                                    { id: 'Mensual', label: 'Mensual' },\n                                                                    { id: 'Anual', label: 'Anual' }\n                                                                ].map(cycle => (\n                                                                    <button\n                                                                        key={cycle.id}\n                                                                        onClick={() => setSettings({ ...settings, subscriptionBillingCycle: cycle.id })}\n                                                                        className={`p-3 rounded-xl border transition-all font-bold ${settings?.subscriptionBillingCycle === cycle.id\n                                                                            ? 'bg-green-500 text-black border-green-400 shadow-lg shadow-green-500/20'\n                                                                            : 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800'\n                                                                            }`}\n                                                                    >\n                                                                        {cycle.label}\n                                                                    </button>\n                                                                ))}\n                                                            </div>\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Define la frecuencia de cobro para este plan.</p>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'store' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Informaci√≥n de la Tienda\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre de la Tienda</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeName || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeName: e.target.value })}\n                                                                    placeholder=\"Mi Tienda\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Email de Contacto</label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeEmail || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                    placeholder=\"contacto@mitienda.com\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tel√©fono</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storePhone || ''}\n                                                                    onChange={e => setSettings({ ...settings, storePhone: e.target.value })}\n                                                                    placeholder=\"+54 11 1234-5678\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Direcci√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeAddress || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeAddress: e.target.value })}\n                                                                    placeholder=\"Av. Corrientes 1234, CABA\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n de la Tienda</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-24 resize-none\"\n                                                                value={settings?.storeDescription || ''}\n                                                                onChange={e => setSettings({ ...settings, storeDescription: e.target.value })}\n                                                                placeholder=\"Breve descripci√≥n de tu tienda...\"\n                                                            />\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto de Nosotros</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-32 resize-none\"\n                                                                value={settings?.aboutUsText || ''}\n                                                                onChange={e => setSettings({ ...settings, aboutUsText: e.target.value })}\n                                                                placeholder=\"Historia de tu marca, valores, misi√≥n...\"\n                                                            />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Copyright Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-orange-400\" /> Textos de Copyright\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Men√∫ Lateral</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.menuCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, menuCopyright: e.target.value })}\n                                                                    placeholder={`${settings?.storeName || 'Mi Tienda'} ¬© ${new Date().getFullYear()}`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece al final del men√∫ hamburguesa</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Footer</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerCopyright: e.target.value })}\n                                                                    placeholder={`¬© ${new Date().getFullYear()} ${settings?.storeName || 'Mi Tienda'}. All rights reserved.`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en la barra inferior del sitio</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Gu√≠a \"C√≥mo Comprar\" Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileQuestion className=\"w-5 h-5 text-orange-400\" /> Gu√≠a \"C√≥mo Comprar\"\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar la p√°gina */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar en Men√∫</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar enlace \"C√≥mo Comprar\" en el men√∫ lateral</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showGuideLink: settings?.showGuideLink === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showGuideLink !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideLink !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* T√≠tulo de la p√°gina */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo de la P√°gina</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.guideTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, guideTitle: e.target.value })}\n                                                                    placeholder=\"C√≥mo Comprar\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Paso 1 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">1</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 1</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep1: settings?.showGuideStep1 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep1 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Title: e.target.value })}\n                                                                        placeholder=\"Selecciona Productos\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 2 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">2</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 2</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep2: settings?.showGuideStep2 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep2 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep2 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Title: e.target.value })}\n                                                                        placeholder=\"Revisa tu Carrito\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 3 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">3</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 3</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep3: settings?.showGuideStep3 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep3 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep3 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Title: e.target.value })}\n                                                                        placeholder=\"Datos de Env√≠o\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 4 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">4</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 4</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep4: settings?.showGuideStep4 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep4 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep4 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep4 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Title: e.target.value })}\n                                                                        placeholder=\"Pago y Confirmaci√≥n\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 5 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">5</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 5</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep5: settings?.showGuideStep5 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep5 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep5 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep5 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Title: e.target.value })}\n                                                                        placeholder=\"¬°Listo!\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Bell className=\"w-5 h-5 text-yellow-400\" /> Anuncios\n                                                        </h3>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Anuncio (Banner superior)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={settings?.announcementMessage || ''}\n                                                                onChange={e => setSettings({ ...settings, announcementMessage: e.target.value })}\n                                                                placeholder=\"üî• ¬°Env√≠o gratis en compras mayores a $50.000!\"\n                                                            />\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Dejar vac√≠o para ocultar el banner.</p>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Zap className=\"w-5 h-5 text-yellow-500\" /> Pantalla de Carga\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingTitle: e.target.value })}\n                                                                    placeholder={settings?.storeName || \"SUSTORE\"}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en grande (ej. SUSTORE).</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Texto peque√±o debajo del t√≠tulo.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === APPEARANCE === */}\n                                            {settingsTab === 'appearance' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Im√°genes\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen Hero (Banner Principal)</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Logo de la Tienda</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'logoUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                />\n                                                                {settings?.logoUrl && (\n                                                                    <div className=\"mt-4 w-24 h-24 rounded-xl overflow-hidden border border-slate-700 bg-white p-2\">\n                                                                        <img src={settings.logoUrl} className=\"w-full h-full object-contain\" alt=\"Logo Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Play className=\"w-5 h-5 text-orange-400\" /> Carrusel Home\n                                                        </h3>\n\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Mostrar carrusel</p>\n                                                                        <p className=\"text-xs text-slate-500\">Si est√° apagado, se usa la imagen Hero tradicional.</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showHomeBannerCarousel: settings?.showHomeBannerCarousel === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.showHomeBannerCarousel !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showHomeBannerCarousel !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cambio autom√°tico (segundos)</label>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        min=\"1\"\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={Number.isFinite(Number(settings?.homeBannerAutoplayMs)) ? Math.max(1, Math.round(Number(settings.homeBannerAutoplayMs) / 1000)) : 5}\n                                                                        onChange={(e) => {\n                                                                            const seconds = Number(e.target.value);\n                                                                            const safeSeconds = Number.isFinite(seconds) ? Math.max(1, seconds) : 5;\n                                                                            setSettings({ ...settings, homeBannerAutoplayMs: Math.round(safeSeconds * 1000) });\n                                                                        }}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                                                                <div className=\"lg:col-span-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen del slide</label>\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewHomeBanner, 'imageUrl', 1400)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newHomeBanner?.imageUrl && (\n                                                                        <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-28\">\n                                                                            <img src={newHomeBanner.imageUrl} className=\"w-full h-full object-cover\" alt=\"Banner preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n\n                                                                <div className=\"lg:col-span-2 space-y-4\">\n                                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Acci√≥n al hacer click</label>\n                                                                            <select\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={newHomeBanner?.targetType || 'none'}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetType: e.target.value, targetId: '' }))}\n                                                                            >\n                                                                                <option value=\"none\">Solo mostrar (sin link)</option>\n                                                                                <option value=\"product\">Abrir producto</option>\n                                                                                <option value=\"promo\">Abrir promo</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Orden (0 = primero)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={Number.isFinite(Number(newHomeBanner?.order)) ? Number(newHomeBanner.order) : 0}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, order: e.target.value }))}\n                                                                            />\n                                                                            <p className=\"text-xs text-slate-500 mt-2\">Menor n√∫mero aparece primero (0, 1, 2...).</p>\n                                                                        </div>\n                                                                    </div>\n\n                                                                    {newHomeBanner?.targetType !== 'none' && (\n                                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                            <div>\n                                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                                    {newHomeBanner?.targetType === 'promo' ? 'Promo al hacer click' : 'Producto al hacer click'}\n                                                                                </label>\n                                                                                <select\n                                                                                    className=\"input-cyber w-full p-3\"\n                                                                                    value={newHomeBanner?.targetId || ''}\n                                                                                    onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetId: e.target.value }))}\n                                                                                >\n                                                                                    <option value=\"\">Seleccionar...</option>\n                                                                                    {(newHomeBanner?.targetType === 'promo' ? [...promos] : [...products])\n                                                                                        .sort((a, b) => (a?.name || '').localeCompare(b?.name || ''))\n                                                                                        .map(item => (\n                                                                                            <option key={item.id} value={item.id}>{item.name}</option>\n                                                                                        ))}\n                                                                                </select>\n                                                                            </div>\n                                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 flex items-center gap-4\">\n                                                                                {(() => {\n                                                                                    const isPromo = newHomeBanner?.targetType === 'promo';\n                                                                                    const item = isPromo\n                                                                                        ? promos.find(p => p.id === newHomeBanner?.targetId)\n                                                                                        : products.find(p => p.id === newHomeBanner?.targetId);\n                                                                                    const img = isPromo ? item?.image : item?.image;\n                                                                                    return (\n                                                                                        <>\n                                                                                            <div className=\"w-16 h-16 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                                {img ? <img src={img} className=\"w-full h-full object-cover\" alt=\"Preview\" /> : <ImageIcon className=\"w-6 h-6 text-slate-600\" />}\n                                                                                            </div>\n                                                                                            <div className=\"min-w-0\">\n                                                                                                <p className=\"text-xs text-slate-500 font-bold uppercase tracking-wider\">Vista previa</p>\n                                                                                                <p className=\"font-black text-white truncate\">{item?.name || 'Sin selecci√≥n'}</p>\n                                                                                            </div>\n                                                                                        </>\n                                                                                    );\n                                                                                })()}\n                                                                            </div>\n                                                                        </div>\n                                                                    )}\n\n                                                                    <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\n                                                                        <div className=\"flex items-center justify-between flex-1 p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                            <div>\n                                                                                <p className=\"font-bold text-white\">Slide habilitado</p>\n                                                                                <p className=\"text-xs text-slate-500\">Si est√° apagado no se muestra.</p>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewHomeBanner(prev => ({ ...prev, enabled: prev?.enabled === false ? true : false }))}\n                                                                                className={`w-14 h-8 rounded-full transition relative ${newHomeBanner?.enabled !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                            >\n                                                                                <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${newHomeBanner?.enabled !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                            </button>\n                                                                        </div>\n\n                                                                        <div className=\"flex gap-3\">\n                                                                            {editingHomeBannerId && (\n                                                                                <button\n                                                                                    onClick={resetHomeBannerForm}\n                                                                                    className=\"px-6 py-3 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition\"\n                                                                                >\n                                                                                    Cancelar\n                                                                                </button>\n                                                                            )}\n                                                                            <button\n                                                                                onClick={saveHomeBannerFn}\n                                                                                className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\"\n                                                                            >\n                                                                                {editingHomeBannerId ? 'Guardar Slide' : 'Agregar Slide'}\n                                                                            </button>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"space-y-3\">\n                                                                {homeBanners.length === 0 ? (\n                                                                    <p className=\"text-slate-500 text-sm\">Todav√≠a no hay slides en el carrusel.</p>\n                                                                ) : (\n                                                                    homeBanners.map(b => {\n                                                                        const targetType = b.targetType || (b.promoId ? 'promo' : b.productId ? 'product' : 'none');\n                                                                        const targetId = b.targetId || b.promoId || b.productId || '';\n                                                                        const targetItem = targetType === 'promo'\n                                                                            ? promos.find(p => p.id === targetId)\n                                                                            : targetType === 'product'\n                                                                                ? products.find(p => p.id === targetId)\n                                                                                : null;\n                                                                        const targetName = targetType === 'none'\n                                                                            ? 'Solo imagen'\n                                                                            : targetItem?.name || (targetType === 'promo' ? 'Promo inexistente' : 'Producto inexistente');\n                                                                        const isEnabled = b?.enabled !== false;\n                                                                        return (\n                                                                            <div key={b.id} className=\"flex flex-col md:flex-row md:items-center gap-4 p-4 bg-slate-900/40 rounded-2xl border border-slate-800\">\n                                                                                <div className=\"w-full md:w-40 h-20 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex-shrink-0\">\n                                                                                    {b?.imageUrl ? (\n                                                                                        <img src={b.imageUrl} className=\"w-full h-full object-cover\" alt=\"Slide\" />\n                                                                                    ) : null}\n                                                                                </div>\n                                                                                <div className=\"flex-1 min-w-0\">\n                                                                                    <div className=\"flex items-center gap-3 flex-wrap\">\n                                                                                        <div className=\"w-10 h-10 rounded-lg overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                            {targetItem?.image ? <img src={targetItem.image} className=\"w-full h-full object-cover\" alt=\"Target\" /> : <ImageIcon className=\"w-4 h-4 text-slate-600\" />}\n                                                                                        </div>\n                                                                                        <p className=\"font-black text-white truncate\">{targetName}</p>\n                                                                                        <span className={`text-[10px] font-black px-2 py-1 rounded-lg border ${isEnabled ? 'text-green-400 border-green-500/30 bg-green-500/10' : 'text-slate-400 border-slate-700 bg-slate-800/30'}`}>\n                                                                                            {isEnabled ? 'ACTIVO' : 'PAUSADO'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            {targetType === 'promo' ? 'PROMO' : targetType === 'product' ? 'PRODUCTO' : 'SIN LINK'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            ORDEN {Number.isFinite(Number(b.order)) ? Number(b.order) : 0}\n                                                                                        </span>\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 mt-1 truncate\">{targetType === 'none' ? 'Click desactivado' : targetId}</p>\n                                                                                </div>\n                                                                                <div className=\"flex items-center gap-2\">\n                                                                                    <button\n                                                                                        onClick={() => editHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                                    </button>\n                                                                                    <button\n                                                                                        onClick={() => deleteHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-red-500/30 text-red-400 hover:bg-red-500/10 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Trash2 className=\"w-4 h-4\" /> Eliminar\n                                                                                    </button>\n                                                                                </div>\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Palette className=\"w-5 h-5 text-pink-400\" /> Colores del Tema\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Primario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Secundario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Acento</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Brand Ticker Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-orange-400\" /> Ticker de Marca\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Ticker</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activar/desactivar la cinta de texto animada.</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Ticker</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.tickerText || ''}\n                                                                    onChange={e => setSettings({ ...settings, tickerText: e.target.value })}\n                                                                    placeholder=\"TECNOLOG√çA ‚Ä¢ INNOVACI√ìN ‚Ä¢ CALIDAD PREMIUM ‚Ä¢ FUTURO\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Este texto se repetir√° en bucle.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Hero Banner Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Banner Principal (Hero)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Badge/Etiqueta</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.heroBadge || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroBadge: e.target.value })}\n                                                                    placeholder=\"Nueva Colecci√≥n 2026\"\n                                                                />\n                                                            </div>\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo L√≠nea 1</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle1 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle1: e.target.value })}\n                                                                        placeholder=\"TECNOLOG√çA\"\n                                                                    />\n                                                                </div>\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo L√≠nea 2</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle2 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle2: e.target.value })}\n                                                                        placeholder=\"DEL FUTURO\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Subt√≠tulo</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-20 resize-none\"\n                                                                    value={settings?.heroSubtitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroSubtitle: e.target.value })}\n                                                                    placeholder=\"Explora nuestra selecci√≥n premium. Calidad garantizada y soporte t√©cnico especializado.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de Fondo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl', 1920)}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Recomendado: 1920x800 px m√≠nimo</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Features Section Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Star className=\"w-5 h-5 text-yellow-400\" /> Beneficios Destacados\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar toda la secci√≥n */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Secci√≥n de Beneficios</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva toda la secci√≥n de beneficios</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFeaturesSection: settings?.showFeaturesSection === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showFeaturesSection !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeaturesSection !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Feature 1 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Zap className=\"w-4 h-4 text-orange-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 1 (Rayo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature1: settings?.showFeature1 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature1 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Title: e.target.value })}\n                                                                        placeholder=\"Env√≠o Ultra R√°pido\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 2 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Shield className=\"w-4 h-4 text-purple-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 2 (Escudo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature2: settings?.showFeature2 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature2 !== false ? 'bg-purple-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature2 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Title: e.target.value })}\n                                                                        placeholder=\"Garant√≠a Extendida\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 3 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Headphones className=\"w-4 h-4 text-green-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 3 (Soporte)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature3: settings?.showFeature3 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature3 !== false ? 'bg-green-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature3 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Title: e.target.value })}\n                                                                        placeholder=\"Soporte 24/7\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Contact Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <MessageCircle className=\"w-5 h-5 text-green-400\" /> Secci√≥n Contacto (Footer)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Secci√≥n</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva la secci√≥n de contacto en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFooterContact: settings?.showFooterContact === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showFooterContact !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showFooterContact !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactTitle: e.target.value })}\n                                                                    placeholder=\"Contacto\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactDescription: e.target.value })}\n                                                                    placeholder=\"¬øTienes alguna duda? Estamos aqu√≠ para ayudarte.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Bot√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactButtonText || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactButtonText: e.target.value })}\n                                                                    placeholder=\"Contactar Soporte\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo de Contacto</label>\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactType || 'whatsapp'}\n                                                                    onChange={e => setSettings({ ...settings, footerContactType: e.target.value })}\n                                                                >\n                                                                    <option value=\"whatsapp\">WhatsApp</option>\n                                                                    <option value=\"instagram\">Instagram</option>\n                                                                    <option value=\"email\">Email</option>\n                                                                </select>\n\n                                                                {/* Conditional Input based on Type */}\n                                                                {(!settings?.footerContactType || settings?.footerContactType === 'whatsapp') && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1 block\">Enlace de WhatsApp</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-green-500/30 focus:border-green-500\"\n                                                                            value={settings?.whatsappLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                            placeholder=\"https://wa.me/54911...\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'instagram' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-pink-500 uppercase tracking-wider mb-1 block\">Perfil de Instagram</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-pink-500/30 focus:border-pink-500\"\n                                                                            value={settings?.instagramLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                            placeholder=\"https://instagram.com/usuario\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'email' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-blue-500 uppercase tracking-wider mb-1 block\">Email de Soporte</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-blue-500/30 focus:border-blue-500\"\n                                                                            value={settings?.storeEmail || ''}\n                                                                            onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                            placeholder=\"soporte@tienda.com\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Brand Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Marca en Footer\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Sufijo del Nombre</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerSuffix || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerSuffix: e.target.value })}\n                                                                    placeholder=\".SF\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece junto al nombre de la tienda (ej: SUSTORE.SF)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-24 resize-none\"\n                                                                    value={settings?.footerDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerDescription: e.target.value })}\n                                                                    placeholder=\"Tu destino premium para tecnolog√≠a de vanguardia...\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Legal Links Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-slate-400\" /> Links Legales\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Pol√≠tica de Privacidad</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showPrivacyPolicy: settings?.showPrivacyPolicy === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showPrivacyPolicy !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showPrivacyPolicy !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Terms of Service</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showTermsOfService: settings?.showTermsOfService === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showTermsOfService !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showTermsOfService !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'ticket' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Ticket className=\"w-5 h-5 text-orange-400\" /> Ticket / Comprobante\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Estos datos se usan en el comprobante que se env√≠a por email al confirmar la compra.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre que aparece en el ticket</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.brandName || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, brandName: e.target.value } })}\n                                                                    placeholder={settings?.storeName || 'Mi Tienda'}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de WhatsApp (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, whatsappLink: e.target.value } })}\n                                                                    placeholder={settings?.whatsappLink || 'https://wa.me/5491112345678'}\n                                                                />\n                                                            </div>\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de la p√°gina (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.siteUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, siteUrl: e.target.value } })}\n                                                                    placeholder={settings?.seoUrl || ''}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SOCIAL MEDIA === */}\n                                            {settingsTab === 'social' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Share2 className=\"w-5 h-5 text-blue-400\" /> Redes Sociales\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Configura los enlaces y activa/desactiva la visibilidad de cada red social en el footer.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            {/* WhatsApp */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <MessageCircle className=\"w-4 h-4 text-green-400\" /> WhatsApp\n                                                                    </label>\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"text-[10px] text-slate-500 font-mono uppercase\">Footer</span>\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, showWhatsapp: !settings?.showWhatsapp })}\n                                                                            className={`w-10 h-5 rounded-full transition relative ${settings?.showWhatsapp === true ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                        >\n                                                                            <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showWhatsapp === true ? '22px' : '2px' }}></div>\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm mb-3\"\n                                                                    value={settings?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                    placeholder=\"https://wa.me/5491112345678\"\n                                                                />\n\n                                                                {/* Floating Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold flex items-center gap-2\">\n                                                                            Bot√≥n Flotante\n                                                                            {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                                <Lock className=\"w-3 h-3 text-yellow-500\" />\n                                                                            )}\n                                                                        </p>\n                                                                        {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                            <p className=\"text-[9px] text-yellow-500/80 mt-0.5\">Requiere Plan Negocio</p>\n                                                                        )}\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if (['business', 'premium'].includes(settings?.subscriptionPlan)) {\n                                                                                setSettings({ ...settings, showFloatingWhatsapp: !settings?.showFloatingWhatsapp });\n                                                                            } else {\n                                                                                setShowPlansModal(true);\n                                                                            }\n                                                                        }}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showFloatingWhatsapp ? 'bg-green-500' : 'bg-slate-700'} ${(!['business', 'premium'].includes(settings?.subscriptionPlan)) ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showFloatingWhatsapp ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Cart Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 mt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold\">Bot√≥n en Carrito</p>\n                                                                        <p className=\"text-[9px] text-slate-500 mt-0.5\">‚ÄúTerminar compra por WhatsApp‚Äù</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showCartWhatsappCheckout: !settings?.showCartWhatsappCheckout })}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showCartWhatsappCheckout ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showCartWhatsappCheckout ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                            {/* Instagram */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Instagram className=\"w-4 h-4 text-pink-400\" /> Instagram\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showInstagram: settings?.showInstagram === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showInstagram !== false ? 'bg-pink-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showInstagram !== false ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.instagramLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                    placeholder=\"https://instagram.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Facebook */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Facebook className=\"w-4 h-4 text-blue-500\" /> Facebook\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFacebook: !settings?.showFacebook })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showFacebook ? 'bg-blue-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showFacebook ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.facebookLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, facebookLink: e.target.value })}\n                                                                    placeholder=\"https://facebook.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Twitter */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Twitter className=\"w-4 h-4 text-sky-400\" /> Twitter/X\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTwitter: !settings?.showTwitter })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTwitter ? 'bg-sky-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTwitter ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.twitterLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, twitterLink: e.target.value })}\n                                                                    placeholder=\"https://twitter.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* TikTok */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Music className=\"w-4 h-4 text-rose-400\" /> TikTok\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTiktok: !settings?.showTiktok })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTiktok ? 'bg-rose-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTiktok ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.tiktokLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, tiktokLink: e.target.value })}\n                                                                    placeholder=\"https://tiktok.com/@mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* YouTube */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Youtube className=\"w-4 h-4 text-red-500\" /> YouTube\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showYoutube: !settings?.showYoutube })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showYoutube ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showYoutube ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.youtubeLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, youtubeLink: e.target.value })}\n                                                                    placeholder=\"https://youtube.com/c/mitienda\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === PAYMENTS === */}\n                                            {settingsTab === 'payments' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <CreditCard className=\"w-5 h-5 text-green-400\" /> M√©todos de Pago\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Transfer */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Building className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Transferencia Bancaria</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, enabled: !settings?.paymentTransfer?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentTransfer?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentTransfer?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.paymentTransfer?.enabled && (\n                                                                    <div className=\"mt-5 grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Titular</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.holderName || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, holderName: e.target.value } })}\n                                                                                placeholder=\"Nombre y apellido\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Alias</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.alias || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, alias: e.target.value } })}\n                                                                                placeholder=\"alias.ejemplo\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">CBU</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.cbu || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, cbu: e.target.value } })}\n                                                                                placeholder=\"0000000000000000000000\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Cash */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Banknote className=\"w-6 h-6 text-green-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Efectivo</p>\n                                                                            <p className=\"text-xs text-slate-500\">Pago al recibir</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            // Validar que Retiro en Local est√© activo\n                                                                            if (!settings?.shippingPickup?.enabled) {\n                                                                                showToast('Debes activar \"Retiro en Local\" (Env√≠os) para habilitar efectivo.', 'warning');\n                                                                                return;\n                                                                            }\n                                                                            setSettings({ ...settings, paymentCash: !settings?.paymentCash });\n                                                                        }}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'} ${!settings?.shippingPickup?.enabled ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {!settings?.shippingPickup?.enabled && (\n                                                                    <p className=\"text-[10px] text-orange-400/80 mt-2 flex items-center gap-1\">\n                                                                        <AlertTriangle className=\"w-3 h-3\" /> Requiere activar Retiro en Local\n                                                                    </p>\n                                                                )}\n                                                            </div>\n\n                                                            {/* MercadoPago (Tarjeta) */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <CreditCard className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Tarjeta (Mercado Pago)</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentMercadoPago: { ...settings?.paymentMercadoPago, enabled: !settings?.paymentMercadoPago?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentMercadoPago?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentMercadoPago?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n\n\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SHIPPING === */}\n                                            {settingsTab === 'shipping' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Truck className=\"w-5 h-5 text-orange-400\" /> Opciones de Env√≠o\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Pickup */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <MapPin className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Retiro en Local</p>\n                                                                            <p className=\"text-xs text-slate-500\">El cliente pasa a buscar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, enabled: !settings?.shippingPickup?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingPickup?.enabled && (\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-4\"\n                                                                        value={settings?.shippingPickup?.address || ''}\n                                                                        onChange={e => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, address: e.target.value } })}\n                                                                        placeholder=\"Direcci√≥n de retiro: Av. Corrientes 1234\"\n                                                                    />\n                                                                )}\n                                                            </div>\n\n                                                            {/* Delivery */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Package className=\"w-6 h-6 text-purple-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Env√≠o a Domicilio</p>\n                                                                            <p className=\"text-xs text-slate-500\">Delivery est√°ndar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, enabled: !settings?.shippingDelivery?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingDelivery?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingDelivery?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingDelivery?.enabled && (\n                                                                    <div className=\"grid grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Costo de Env√≠o ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.fee || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, fee: parseFloat(e.target.value) || 0 } })}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Gratis desde ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.freeAbove || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, freeAbove: parseFloat(e.target.value) || 0 } })}\n                                                                                placeholder=\"0 = nunca gratis\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SEO === */}\n                                            {settingsTab === 'seo' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Globe className=\"w-5 h-5 text-green-400\" /> Optimizaci√≥n SEO\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo del Sitio</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoTitle: e.target.value })}\n                                                                    placeholder=\"Mi Tienda Online | Los Mejores Productos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece en la pesta√±a del navegador</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Meta Descripci√≥n</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                    value={settings?.seoDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoDescription: e.target.value })}\n                                                                    placeholder=\"Tienda online de productos de alta calidad. Env√≠os a todo el pa√≠s. ¬°Visitanos!\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Descripci√≥n que aparece en Google (max 160 caracteres)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Palabras Clave</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoKeywords || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoKeywords: e.target.value })}\n                                                                    placeholder=\"tienda online, productos, ofertas, descuentos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Separadas por comas</p>\n                                                            </div>\n\n                                                            {/* URL Can√≥nica */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">URL del Sitio (Can√≥nica)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoUrl: e.target.value })}\n                                                                    placeholder=\"https://mitienda.vercel.app\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">URL oficial de tu tienda (aparece en Google y redes sociales)</p>\n                                                            </div>\n\n                                                            {/* Autor */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Autor / Empresa</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoAuthor || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoAuthor: e.target.value })}\n                                                                    placeholder=\"Mi Empresa S.A.\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Nombre que aparece como autor del sitio</p>\n                                                            </div>\n\n                                                            {/* OG Image Upload */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen para Redes Sociales (OG:Image)</label>\n                                                                <div className=\"flex items-center gap-4\">\n                                                                    <div className=\"relative group w-32 h-32 bg-slate-900 rounded-xl border-2 border-dashed border-slate-700 hover:border-orange-500 transition flex items-center justify-center overflow-hidden cursor-pointer\">\n                                                                        {settings?.seoImage ? (\n                                                                            <img src={settings.seoImage} alt=\"SEO Preview\" className=\"w-full h-full object-cover\" />\n                                                                        ) : (\n                                                                            <ImageIcon className=\"w-8 h-8 text-slate-600 group-hover:text-orange-500 transition\" />\n                                                                        )}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"image/*\"\n                                                                            className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                            onChange={(e) => handleImageUpload(e, setSettings, 'seoImage', 1200)}\n                                                                        />\n                                                                        {/* Overlay al hacer hover para indicar cambio */}\n                                                                        <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                            <Upload className=\"w-6 h-6 text-white\" />\n                                                                        </div>\n                                                                    </div>\n                                                                    <div className=\"flex-1\">\n                                                                        <p className=\"text-sm text-slate-400 mb-2\">Sube una imagen atractiva (ej: logo con fondo, banner).</p>\n                                                                        <p className=\"text-xs text-slate-600\">Recomendado: 1200x630 p√≠xeles para mejor visualizaci√≥n en Facebook/WhatsApp.</p>\n                                                                        {settings?.seoImage && (\n                                                                            <button\n                                                                                onClick={() => setSettings({ ...settings, seoImage: '' })}\n                                                                                className=\"mt-2 text-xs text-red-400 hover:text-red-300 flex items-center gap-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-3 h-3\" /> Eliminar imagen\n                                                                            </button>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Links Status */}\n                                                            <div className=\"pt-4 border-t border-slate-800 grid grid-cols-2 gap-4\">\n                                                                <a href=\"/sitemap.xml\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Sitemap.xml</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                                <a href=\"/robots.txt\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Robots.txt</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === ADVANCED === */}\n                                            {settingsTab === 'advanced' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Cog className=\"w-5 h-5 text-slate-400\" /> Configuraci√≥n Avanzada\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            {/* Maintenance Mode */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Modo Mantenimiento</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar p√°gina de \"Volvemos pronto\"</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, maintenanceMode: !settings?.maintenanceMode })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.maintenanceMode ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.maintenanceMode ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* PWA & Performance Controls */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 space-y-4\">\n                                                                <h4 className=\"text-sm font-bold text-orange-400 uppercase tracking-wider mb-2\">Rendimiento & PWA</h4>\n\n                                                                {/* Lazy Loading */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Carga Diferida (Lazy Load)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Mejora velocidad cargando im√°genes al hacer scroll</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enableLazyLoad: settings?.enableLazyLoad === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enableLazyLoad !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enableLazyLoad !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* PWA Service Worker */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Modo Offline (PWA)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Permite instalar la app y uso sin internet</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enablePWA: settings?.enablePWA === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enablePWA !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enablePWA !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Clear Cache Button */}\n                                                                <div className=\"pt-2 border-t border-slate-700\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if ('caches' in window) {\n                                                                                caches.keys().then(names => {\n                                                                                    names.forEach(name => caches.delete(name));\n                                                                                    showToast('Cach√© limpiada. Recargando...', 'success');\n                                                                                    setTimeout(() => window.location.reload(), 1500);\n                                                                                });\n                                                                            } else {\n                                                                                showToast('Tu navegador no soporta gesti√≥n de cach√©', 'warning');\n                                                                            }\n                                                                        }}\n                                                                        className=\"w-full py-2 px-4 bg-slate-800 hover:bg-slate-700 text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-2\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" /> Forzar Limpieza de Cach√© y Recargar\n                                                                    </button>\n                                                                    <p className=\"text-xs text-slate-500 mt-2 text-center\">Usar si ves errores gr√°ficos o versiones antiguas.</p>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Loading Text */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"mb-3\">\n                                                                    <p className=\"font-bold text-white\">Texto de Carga</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mensaje que aparece mientras carga la p√°gina</p>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Show Announcement Banner */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Banner de Anuncio</p>\n                                                                    <p className=\"text-xs text-slate-500\">Barra superior con mensaje promocional</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showAnnouncementBanner: settings?.showAnnouncementBanner === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showAnnouncementBanner !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showAnnouncementBanner !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Brand Ticker */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Ticker de Marca</p>\n                                                                    <p className=\"text-xs text-slate-500\">Texto en movimiento debajo del anuncio</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Stock */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Stock Disponible</p>\n                                                                    <p className=\"text-xs text-slate-500\">Los clientes ven cu√°ntas unidades hay</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showStockCount: settings?.showStockCount === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showStockCount !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showStockCount !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require Phone */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir Tel√©fono</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requirePhone: settings?.requirePhone === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requirePhone !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requirePhone !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require DNI */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir DNI</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requireDNI: settings?.requireDNI === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requireDNI !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requireDNI !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Low Stock Threshold */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Umbral de Stock Bajo</p>\n                                                                        <p className=\"text-xs text-slate-500\">Alerta cuando el stock es menor a este valor</p>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.lowStockThreshold || 5}\n                                                                    onChange={e => setSettings({ ...settings, lowStockThreshold: parseInt(e.target.value) || 5 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* AI Config Block (SustIA) */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-yellow-500\" /> Personalizaci√≥n IA\n                                                        </h3>\n                                                        <div className=\"flex items-center gap-6\">\n                                                            <div className=\"relative group w-24 h-24 bg-slate-900 rounded-full border-2 border-dashed border-slate-700 hover:border-yellow-500 transition flex items-center justify-center overflow-hidden cursor-pointer shrink-0 shadow-xl\">\n                                                                {settings?.botImage ? (\n                                                                    <img src={settings.botImage} alt=\"Bot Preview\" className=\"w-full h-full object-cover\" />\n                                                                ) : (\n                                                                    <Sparkles className=\"w-8 h-8 text-slate-600 group-hover:text-yellow-500 transition\" />\n                                                                )}\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'botImage', 300)}\n                                                                />\n                                                                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                    <Upload className=\"w-6 h-6 text-white\" />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-base mb-1\">Avatar del Asistente</p>\n                                                                <p className=\"text-xs text-slate-500 mb-3 max-w-xs leading-relaxed\">Sube una imagen personalizada para el bot (PNG/JPG). Se recomienda formato cuadrado.</p>\n                                                                {settings?.botImage ? (\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, botImage: '' })}\n                                                                        className=\"text-xs bg-red-900/20 text-red-400 hover:bg-red-900/40 px-3 py-1.5 rounded-lg transition flex items-center gap-2 border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-3 h-3\" /> Restaurar Default\n                                                                    </button>\n                                                                ) : (\n                                                                    <span className=\"text-xs text-yellow-600 bg-yellow-900/20 px-3 py-1 rounded-lg border border-yellow-700/30\">\n                                                                        Usando imagen por defecto\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FolderPlus className=\"w-5 h-5 text-orange-400\" /> Categor√≠as de Productos\n                                                        </h3>\n                                                        <div className=\"flex flex-wrap gap-2 mb-4\">\n                                                            {(settings?.categories || []).map((cat, idx) => (\n                                                                <div key={idx} className=\"bg-slate-900 text-white px-4 py-2 rounded-lg flex items-center gap-2 border border-slate-700\">\n                                                                    <span>{cat}</span>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, categories: (settings?.categories || []).filter((_, i) => i !== idx) })}\n                                                                        className=\"text-red-400 hover:text-red-300\"\n                                                                    >\n                                                                        <X className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            ))}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => setShowCategoryModal(true)}\n                                                            className=\"px-4 py-2 bg-orange-900/20 text-orange-400 rounded-lg font-bold text-sm border border-orange-500/30 hover:bg-orange-900/40 transition flex items-center gap-2\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" /> Agregar Categor√≠a\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === TEAM === */}\n                                            {settingsTab === 'team' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Users className=\"w-5 h-5 text-purple-400\" /> Equipo y Accesos\n                                                        </h3>\n                                                        <p className=\"text-slate-500 mb-6\">Gestiona los miembros del equipo, sus roles de acceso y participaci√≥n en ganancias.</p>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            {(settings?.team || []).map((member, idx) => (\n                                                                <div key={idx} className=\"flex flex-col md:flex-row md:items-center gap-4 bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                    <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg flex-shrink-0\">\n                                                                        {member.name?.charAt(0)?.toUpperCase() || '?'}\n                                                                    </div>\n                                                                    <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Nombre</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-2 text-sm\"\n                                                                                value={member.name || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], name: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"Nombre\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Email (Acceso)</label>\n                                                                            <input\n                                                                                type=\"email\"\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.email || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], email: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"usuario@email.com\"\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Rol</label>\n                                                                            <select\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.role || 'employee'}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], role: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            >\n                                                                                <option value=\"employee\">Empleado</option>\n                                                                                <option value=\"admin\">Admin</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Total Invertido</label>\n                                                                            <div className=\"input-cyber w-full p-2 text-sm bg-slate-900/50 text-slate-400 flex items-center cursor-not-allowed\">\n                                                                                $ {investments.filter(inv => inv.investor === member.name || inv.investor === member.email).reduce((acc, curr) => acc + (Number(curr.amount) || 0), 0).toLocaleString()}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    {member.email !== SUPER_ADMIN_EMAIL && (\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, team: (settings?.team || []).filter((_, i) => i !== idx) })}\n                                                                            className=\"p-3 bg-red-900/20 text-red-400 hover:bg-red-900/40 rounded-xl transition flex-shrink-0\"\n                                                                            title=\"Eliminar Miembro\"\n                                                                        >\n                                                                            <Trash2 className=\"w-5 h-5\" />\n                                                                        </button>\n                                                                    )}\n                                                                </div>\n                                                            ))}\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => setSettings({ ...settings, team: [...(settings?.team || []), { name: '', email: '', role: 'employee', investment: 0 }] })}\n                                                            className=\"px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold shadow-lg shadow-purple-600/30 flex items-center gap-2 transition\"\n                                                        >\n                                                            <UserPlus className=\"w-5 h-5\" /> Agregar Nuevo Miembro\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Save Button */}\n                                            <div className=\"fixed bottom-8 right-8 z-50\">\n                                                <button\n                                                    onClick={async () => {\n                                                        try {\n                                                            setIsLoading(true);\n                                                            const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                                                            await setDoc(settingsRef, settings, { merge: true });\n                                                            showToast(\"Configuraci√≥n guardada exitosamente\", \"success\");\n                                                        } catch (e) {\n                                                            console.error(e);\n                                                            showToast(\"Error al guardar\", \"error\");\n                                                        } finally {\n                                                            setIsLoading(false);\n                                                        }\n                                                    }}\n                                                    className=\"px-8 py-4 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-bold rounded-2xl shadow-2xl shadow-orange-900/30 flex items-center gap-3 transition transform hover:scale-105\"\n                                                >\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cambios\n                                                </button>\n                                            </div>\n                                        </div>\n                                    )\n                                    }\n\n                                    {/* 7.3 Modal Proveedores (Selector Visual) */}\n                                    {\n                                        showSupplierModal && (\n                                            <div className=\"fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-scale\">\n                                                <div className=\"bg-[#0a0a0a] border border-slate-700 p-8 rounded-[2.5rem] w-full max-w-lg shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh]\">\n                                                    <div className=\"overflow-y-auto custom-scrollbar pr-2 pb-20\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 sticky top-0 bg-[#0a0a0a] py-2 z-10\">\n                                                            {editingSupplierId ? 'Editar' : 'Nuevo'} Proveedor\n                                                        </h3>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de la Empresa\" value={newSupplier.name} onChange={e => setNewSupplier({ ...newSupplier, name: e.target.value })} />\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Contacto\" value={newSupplier.contact} onChange={e => setNewSupplier({ ...newSupplier, contact: e.target.value })} />\n\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Tel√©fono\" value={newSupplier.phone} onChange={e => setNewSupplier({ ...newSupplier, phone: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Instagram (sin @)\" value={newSupplier.ig} onChange={e => setNewSupplier({ ...newSupplier, ig: e.target.value })} />\n                                                            </div>\n\n                                                            {/* Selector Visual de Productos */}\n                                                            <div className=\"border-t border-slate-800 pt-6 mt-6\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 block\">\n                                                                    Asignar Productos Suministrados\n                                                                </label>\n                                                                <div className=\"h-48 overflow-y-auto bg-slate-900/50 rounded-xl p-2 border border-slate-800 custom-scrollbar\">\n                                                                    {products.length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 text-xs py-4\">Carga productos primero.</p>\n                                                                    ) : products.map(p => (\n                                                                        <div\n                                                                            key={p.id}\n                                                                            onClick={() => {\n                                                                                const prev = newSupplier.associatedProducts || [];\n                                                                                const exists = prev.includes(p.id);\n                                                                                setNewSupplier({\n                                                                                    ...newSupplier,\n                                                                                    associatedProducts: exists ? prev.filter(x => x !== p.id) : [...prev, p.id]\n                                                                                });\n                                                                            }}\n                                                                            className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer mb-1 transition ${newSupplier.associatedProducts?.includes(p.id) ? 'bg-orange-900/30 border border-orange-500/30' : 'hover:bg-slate-800 border border-transparent'}`}\n                                                                        >\n                                                                            <div className=\"w-8 h-8 bg-white rounded p-0.5 flex-shrink-0\">\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                            <span className=\"text-xs text-white truncate flex-1 font-medium\">{p.name}</span>\n                                                                            {newSupplier.associatedProducts?.includes(p.id) && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                        </div>\n                                                                    ))}\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Botones Fixed */}\n                                                    <div className=\"absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a] to-transparent flex gap-4\">\n                                                        <button onClick={() => setShowSupplierModal(false)} className=\"flex-1 py-4 text-slate-400 font-bold hover:text-white transition bg-slate-900 rounded-xl\">Cancelar</button>\n                                                        <button onClick={saveSupplierFn} className=\"flex-1 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold shadow-lg transition\">Guardar</button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        )\n                                    }\n                                </div >\n                            </div >\n                        ) : (\n                            <AccessDenied onBack={() => setView('store')} />\n                        ))\n                }\n\n                {/* 8. VISTA POL√çTICA DE PRIVACIDAD */}\n                {\n                    view === 'privacy' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Pol√≠tica de <span className=\"text-orange-500 text-6xl\">Privacidad</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 text-lg leading-relaxed\">\n                                        En <strong>{settings?.storeName || 'SUSTORE'}</strong>, valoramos tu privacidad y nos comprometemos a proteger tus datos personales. Esta pol√≠tica describe c√≥mo recolectamos, usamos y resguardamos tu informaci√≥n.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">1. Informaci√≥n Recolectada</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Recolectamos datos b√°sicos como nombre, correo electr√≥nico y n√∫mero de tel√©fono √∫nicamente cuando te registras o realizas un pedido para procesar tu compra correctamente.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">2. Uso de los Datos</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Tu informaci√≥n se utiliza exclusivamente para:\n                                    </p>\n                                    <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                        <li>Gestionar tus pedidos y entregas.</li>\n                                        <li>Enviar actualizaciones sobre el estado de tu compra.</li>\n                                        <li>Mejorar nuestros servicios y experiencia de usuario.</li>\n                                    </ul>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">3. Seguridad</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Implementamos medidas de seguridad robustas y encriptaci√≥n de datos para asegurar que tu informaci√≥n est√© protegida contra accesos no autorizados.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">4. Contacto</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed mb-12\">\n                                        Si tienes dudas sobre nuestra pol√≠tica de privacidad, cont√°ctanos a <span className=\"text-orange-400\">{settings?.storeEmail || 'soporte@tuempresa.com'}</span>.\n                                    </p>\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n                {/* 9. VISTA T√âRMINOS Y CONDICIONES */}\n                {\n                    view === 'terms' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Condiciones de <span className=\"text-orange-500 text-6xl\">Uso</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 font-bold mb-8\">√öltima actualizaci√≥n: 07 de enero de 2026</p>\n\n                                    <h3 className=\"text-xl font-bold text-white mt-8 mb-4\">ACUERDO CON NUESTROS T√âRMINOS LEGALES</h3>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Nosotros somos <strong>{settings?.storeName || 'Sustore'}</strong> (\"<strong>Empresa</strong>\", \"<strong>nosotros</strong>\", \"<strong>nos</strong>\", \"<strong>nuestro</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Operamos el sitio web <a href=\"https://sustore.vercel.app\" className=\"text-orange-400 hover:underline\">https://sustore.vercel.app</a> (el \"<strong>Sitio</strong>\"), as√≠ como cualquier otro producto y servicio relacionado que haga referencia o se vincule con estos t√©rminos legales (los \"<strong>T√©rminos Legales</strong>\") (colectivamente, los \"<strong>Servicios</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Puede contactarnos por correo electr√≥nico a la direcci√≥n proporcionada al final de este documento.\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Estos T√©rminos Legales constituyen un acuerdo legalmente vinculante celebrado entre usted, ya sea personalmente o en nombre de una entidad (\"<strong>usted</strong>\"), y Sustore, en relaci√≥n con su acceso y uso de los Servicios. Usted acepta que al acceder a los Servicios, ha le√≠do, comprendido y aceptado estar sujeto a todos estos T√©rminos Legales. <strong className=\"text-red-400\">SI NO EST√Å DE ACUERDO CON TODOS ESTOS T√âRMINOS LEGALES, ENTONCES TIENE EXPRESAMENTE PROHIBIDO UTILIZAR LOS SERVICIOS Y DEBE DEJAR DE UTILIZARLOS INMEDIATAMENTE.</strong>\n                                    </p>\n\n                                    <div className=\"bg-slate-900/50 p-8 rounded-3xl border border-slate-800 my-10\">\n                                        <h3 className=\"text-lg font-black text-white uppercase tracking-widest mb-6\">√çNDICE</h3>\n                                        <ul className=\"space-y-2 text-sm text-orange-400 font-medium\">\n                                            <li><a href=\"#section1\" className=\"hover:text-orange-300 transition\">1. NUESTROS SERVICIOS</a></li>\n                                            <li><a href=\"#section2\" className=\"hover:text-orange-300 transition\">2. DERECHOS DE PROPIEDAD INTELECTUAL</a></li>\n                                            <li><a href=\"#section3\" className=\"hover:text-orange-300 transition\">3. REPRESENTACIONES DE USUARIOS</a></li>\n                                            <li><a href=\"#section4\" className=\"hover:text-orange-300 transition\">4. ACTIVIDADES PROHIBIDAS</a></li>\n                                            <li><a href=\"#section5\" className=\"hover:text-orange-300 transition\">5. CONTRIBUCIONES GENERADAS POR EL USUARIO</a></li>\n                                            <li><a href=\"#section6\" className=\"hover:text-orange-300 transition\">6. LICENCIA DE CONTRIBUCI√ìN</a></li>\n                                            <li><a href=\"#section7\" className=\"hover:text-orange-300 transition\">7. GESTI√ìN DE SERVICIOS</a></li>\n                                            <li><a href=\"#section8\" className=\"hover:text-orange-300 transition\">8. PLAZO Y TERMINACI√ìN</a></li>\n                                            <li><a href=\"#section9\" className=\"hover:text-orange-300 transition\">9. MODIFICACIONES E INTERRUPCIONES</a></li>\n                                            <li><a href=\"#section10\" className=\"hover:text-orange-300 transition\">10. LEY APLICABLE</a></li>\n                                            <li><a href=\"#section11\" className=\"hover:text-orange-300 transition\">11. RESOLUCI√ìN DE DISPUTAS</a></li>\n                                            <li><a href=\"#section12\" className=\"hover:text-orange-300 transition\">12. CORRECCIONES</a></li>\n                                            <li><a href=\"#section13\" className=\"hover:text-orange-300 transition\">13. DESCARGO DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section14\" className=\"hover:text-orange-300 transition\">14. LIMITACIONES DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section15\" className=\"hover:text-orange-300 transition\">15. INDEMNIZACI√ìN</a></li>\n                                            <li><a href=\"#section16\" className=\"hover:text-orange-300 transition\">16. DATOS DEL USUARIO</a></li>\n                                            <li><a href=\"#section17\" className=\"hover:text-orange-300 transition\">17. COMUNICACIONES ELECTR√ìNICAS</a></li>\n                                            <li><a href=\"#section18\" className=\"hover:text-orange-300 transition\">18. VARIOS</a></li>\n                                            <li><a href=\"#section19\" className=\"hover:text-orange-300 transition\">19. CONT√ÅCTENOS</a></li>\n                                        </ul>\n                                    </div>\n\n                                    <section id=\"section1\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">1. NUESTROS SERVICIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            La informaci√≥n proporcionada al utilizar los Servicios no est√° destinada a ser distribuida o utilizada por ninguna persona o entidad en ninguna jurisdicci√≥n o pa√≠s donde dicha distribuci√≥n o uso ser√≠a contrario a la ley o regulaci√≥n o que nos someter√≠a a cualquier requisito de registro dentro de dicha jurisdicci√≥n o pa√≠s. En consecuencia, aquellas personas que eligen acceder a los Servicios desde otras ubicaciones lo hacen por iniciativa propia y son las √∫nicas responsables del cumplimiento de las leyes locales, si y en la medida en que sean aplicables.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section2\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">2. DERECHOS DE PROPIEDAD INTELECTUAL</h2>\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Nuestra propiedad intelectual</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Somos propietarios o licenciatarios de todos los derechos de propiedad intelectual de nuestros Servicios, incluido todo el c√≥digo fuente, bases de datos, funcionalidad, software, dise√±os de sitios web, audio, video, texto, fotograf√≠as y gr√°ficos de los Servicios (colectivamente, el \"Contenido\"), as√≠ como las marcas comerciales, marcas de servicio y logotipos contenidos en ellas (las \"Marcas\").\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Nuestro Contenido y Marcas est√°n protegidos por leyes de derechos de autor y marcas registradas (y varias otras leyes de derechos de propiedad intelectual y competencia desleal) y tratados alrededor del mundo.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            El Contenido y las Marcas se proporcionan en o a trav√©s de los Servicios \"TAL CUAL\" para su uso personal, no comercial o finalidad empresarial interna.\n                                        </p>\n\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Su uso de nuestros Servicios</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Sujeto a su cumplimiento de estos T√©rminos Legales, incluidos los \"ACTIVIDADES PROHIBIDAS\" en la secci√≥n siguiente, le otorgamos un contrato no exclusivo, intransferible y revocable licencia para:\n                                        </p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2 mb-4\">\n                                            <li>acceder a los Servicios; y</li>\n                                            <li>descargar o imprimir una copia de cualquier parte del Contenido al que haya obtenido acceso correctamente,</li>\n                                        </ul>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">√∫nicamente para tu uso personal, no comercial o finalidad empresarial interna.</p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Salvo lo establecido en esta secci√≥n o en otra parte de nuestros T√©rminos Legales, ninguna parte de los Servicios ni ning√∫n Contenido o Marca podr√°n copiarse ni reproducirse, agregado, republicado, cargado, publicado, mostrado p√∫blicamente, codificado, traducido, transmitido, distribuido, vendido, licenciado o explotado de otro modo para cualquier fin comercial, sin nuestro expreso previo escrito permiso.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Si desea hacer alg√∫n uso de los Servicios, Contenido o Marcas que no sea el establecido en esta secci√≥n o en otra parte de nuestros T√©rminos Legales, dirija su solicitud a nuestro correo de contacto.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section3\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">3. REPRESENTACIONES DE USUARIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Al utilizar los Servicios, usted declara y garantiza que: (1) usted tiene la capacidad legal y acepta cumplir con estos T√©rminos Legales; (2) no eres un menor de edad en la jurisdicci√≥n en la que usted reside; (3) no acceder√°s a los Servicios a trav√©s de medios automatizados o no humanos, ya sea a trav√©s de un bot, script o de otro modo; (4) no utilizar√° los Servicios para ninguna actividad ilegal o no autorizado prop√≥sito; y (5) su uso de los Servicios no violar√° ninguna ley o regulaci√≥n aplicable.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section4\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">4. ACTIVIDADES PROHIBIDAS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            No puede acceder ni utilizar los Servicios para ning√∫n otro prop√≥sito que no sea aquel para el cual los ponemos a disposici√≥n. Los Servicios no podr√°n utilizarse en relaci√≥n con ning√∫n negocio comercial esfuerzo excepto aquellos que est√©n espec√≠ficamente respaldados o aprobados por nosotros.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">Como usuario de los Servicios, usted acepta no:</p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                            <li>Recuperar sistem√°ticamente datos u otro contenido de los Servicios para crear o compilar, directa o indirectamente, una colecci√≥n, compilaci√≥n, base de datos o directorio sin nuestro permiso por escrito.</li>\n                                            <li>Enga√±arnos, defraudarnos o enga√±arnos a nosotros y a otros usuarios, especialmente en cualquier intento de obtener informaci√≥n confidencial de la cuenta, como las contrase√±as de los usuarios.</li>\n                                            <li>Eludir, deshabilitar o interferir de otro modo con las caracter√≠sticas relacionadas con la seguridad de los Servicios.</li>\n                                            <li>Menospreciar, empa√±ar o da√±ar de otro modo, en nuestra opini√≥n, a nosotros y/o a los Servicios.</li>\n                                            <li>Utilizar cualquier informaci√≥n obtenida de los Servicios para acosar, abusar o da√±ar a otra persona.</li>\n                                            <li>Hacer un uso indebido de nuestros servicios de soporte o presentar informes falsos de abuso o mala conducta.</li>\n                                            <li>Utilice los Servicios de una manera incompatible con las leyes o regulaciones aplicables.</li>\n                                        </ul>\n                                    </section>\n\n                                    <section id=\"section13\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">13. DESCARGO DE RESPONSABILIDAD</h2>\n                                        <p className=\"text-slate-500 leading-relaxed text-xs uppercase tracking-wide border-l-4 border-red-500/50 pl-4 py-2 bg-red-900/5\">\n                                            LOS SERVICIOS SE PRESTAN TAL CUAL Y SEG√öN EST√â DISPONIBLE. USTED ACEPTA QUE SU USO DE LOS SERVICIOS SER√Å BAJO SU PROPIO RIESGO. EN LA M√ÅXIMA MEDIDA PERMITIDA POR LA LEY, RENUNCIAMOS A TODAS LAS GARANT√çAS, EXPRESAS O IMPL√çCITAS, EN RELACI√ìN CON LOS SERVICIOS Y SU USO DE LOS MISMOS.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section19\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">19. CONT√ÅCTENOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Para resolver una queja con respecto a los Servicios o para recibir m√°s informaci√≥n sobre el uso de los Servicios, cont√°ctenos en:\n                                        </p>\n                                        <p className=\"text-2xl font-black text-orange-400\">\n                                            {settings?.storeEmail || 'soporte@tuempresa.com'}\n                                        </p>\n                                    </section>\n\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700 mt-12\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n            </main >\n\n            {/* FOOTER PROFESIONAL (Visible solo fuera del Admin y Auth) */}\n            {\n                view !== 'admin' && view !== 'login' && view !== 'register' && (\n                    <footer className=\"bg-[#050505] border-t border-slate-900 pt-16 pb-8 relative overflow-hidden\">\n                        {/* Decoraci√≥n de Fondo */}\n                        <div className=\"absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-orange-900/50 to-transparent\"></div>\n                        <div className=\"absolute -top-40 -right-40 w-96 h-96 bg-blue-900/5 rounded-full blur-[100px] pointer-events-none\"></div>\n\n                        <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 grid grid-cols-1 md:grid-cols-4 gap-12 mb-16 relative z-10\">\n                            {/* Columna 1: Marca */}\n                            <div className=\"md:col-span-2 space-y-6\">\n                                <h2 className=\"text-3xl font-black text-white tracking-tighter italic\">\n                                    {settingsLoaded ? (settings?.storeName || '') : ''}\n                                    <span className=\"text-orange-500\">{settings?.footerSuffix || '.SF'}</span>\n                                </h2>\n                                <p className=\"text-slate-500 max-w-sm leading-relaxed text-sm\">\n                                    {settings?.footerDescription || 'Tu destino premium para tecnolog√≠a de vanguardia. Ofrecemos los mejores productos con garant√≠a y soporte especializado. Elevamos tu experiencia digital.'}\n                                </p>\n                                <div className=\"flex gap-3 pt-2 flex-wrap\">\n                                    {settings?.showInstagram !== false && settings?.instagramLink && (\n                                        <button onClick={() => window.open(settings?.instagramLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-pink-400 hover:bg-pink-900/10 transition border border-slate-800 hover:border-pink-500/30\">\n                                            <Instagram className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showWhatsapp === true && settings?.whatsappLink && (\n                                        <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-green-400 hover:bg-green-900/10 transition border border-slate-800 hover:border-green-500/30\">\n                                            <MessageCircle className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showFacebook && settings?.facebookLink && (\n                                        <button onClick={() => window.open(settings?.facebookLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-blue-400 hover:bg-blue-900/10 transition border border-slate-800 hover:border-blue-500/30\">\n                                            <Facebook className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTwitter && settings?.twitterLink && (\n                                        <button onClick={() => window.open(settings?.twitterLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-sky-400 hover:bg-sky-900/10 transition border border-slate-800 hover:border-sky-500/30\">\n                                            <Twitter className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTiktok && settings?.tiktokLink && (\n                                        <button onClick={() => window.open(settings?.tiktokLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-rose-400 hover:bg-rose-900/10 transition border border-slate-800 hover:border-rose-500/30\">\n                                            <Music className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showYoutube && settings?.youtubeLink && (\n                                        <button onClick={() => window.open(settings?.youtubeLink, '_blank')} className=\"p-2 bg-slate-900 rounded-lg text-slate-400 hover:text-red-400 hover:bg-red-900/10 transition border border-slate-800 hover:border-red-500/30\">\n                                            <Youtube className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna 2: Quick Links */}\n                            <div className=\"space-y-6\">\n                                <h3 className=\"text-white font-bold uppercase tracking-widest text-xs\">Enlaces R√°pidos</h3>\n                                <ul className=\"space-y-3 text-sm text-slate-500 font-medium\">\n                                    <li>\n                                        <button onClick={() => setView('store')} className=\"hover:text-orange-400 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-400 transition-all duration-300\"></span> Inicio\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('profile')} className=\"hover:text-orange-400 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-400 transition-all duration-300\"></span> Mi Cuenta\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('guide')} className=\"hover:text-orange-400 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-400 transition-all duration-300\"></span> Ayuda & Soporte\n                                        </button>\n                                    </li>\n                                </ul>\n                            </div>\n\n                            {/* Columna 3: Soporte */}\n                            {settings?.showFooterContact !== false && (\n                                <div className=\"space-y-6\">\n                                    <h3 className=\"text-white font-bold uppercase tracking-widest text-xs\">\n                                        {settings?.footerContactTitle || 'Contacto'}\n                                    </h3>\n                                    <p className=\"text-slate-500 text-sm leading-relaxed mb-4\">\n                                        {settings?.footerContactDescription || '¬øTienes alguna duda? Estamos aqu√≠ para ayudarte.'}\n                                    </p>\n                                    <button\n                                        onClick={() => {\n                                            const type = settings?.footerContactType || 'whatsapp';\n                                            if (type === 'whatsapp' && settings?.whatsappLink) {\n                                                window.open(settings.whatsappLink, '_blank');\n                                            } else if (type === 'instagram' && settings?.instagramLink) {\n                                                window.open(settings.instagramLink, '_blank');\n                                            } else if (type === 'email' && settings?.storeEmail) {\n                                                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${settings.storeEmail}`, '_blank');\n                                            }\n                                        }}\n                                        className=\"px-6 py-3 bg-orange-900/10 text-orange-400 rounded-xl text-sm font-bold border border-orange-500/20 hover:bg-orange-500 hover:text-white transition w-full md:w-auto\"\n                                    >\n                                        {settings?.footerContactButtonText || 'Contactar Soporte'}\n                                    </button>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Copyright Bar */}\n                        <div className=\"border-t border-slate-900 bg-[#020202]\">\n                            <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 py-6 flex flex-col md:flex-row justify-between items-center gap-4\">\n                                <p className=\"text-slate-600 text-xs font-mono\">\n                                    ¬© 2026 Sustore. Todos los derechos reservados.\n                                </p>\n                                <div className=\"flex gap-6\">\n                                    {settings?.showPrivacyPolicy !== false && (\n                                        <span onClick={() => setView('privacy')} className=\"text-slate-700 text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-slate-400 transition underline decoration-slate-900 underline-offset-4\">Privacy Policy</span>\n                                    )}\n                                    {settings?.showTermsOfService !== false && (\n                                        <span onClick={() => setView('terms')} className=\"text-slate-700 text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-slate-400 transition underline decoration-slate-900 underline-offset-4\">Terms of Service</span>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    </footer>\n                )\n            }\n\n            {/* MODAL: CREAR CATEGOR√çA */}\n            {\n                showCategoryModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-orange-800 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-orange-900/20 text-orange-500\">\n                                <FolderPlus className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-6 text-white\">Nueva Categor√≠a</h3>\n                            <input\n                                type=\"text\"\n                                value={newCategory}\n                                onChange={(e) => setNewCategory(e.target.value)}\n                                className=\"input-cyber w-full p-4 mb-6\"\n                                placeholder=\"Nombre de la categor√≠a\"\n                                autoFocus\n                            />\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => { setNewCategory(''); setShowCategoryModal(false); }}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={createCategoryFn}\n                                    className=\"flex-1 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold transition shadow-lg shadow-orange-600/30\"\n                                >\n                                    Crear\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            {/* MODAL: VENTA MANUAL */}\n            {\n                showManualSaleModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-green-900 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-green-900/20 text-green-500\">\n                                <DollarSign className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-2 text-white\">Venta Manual</h3>\n                            <p className=\"text-center text-slate-400 mb-6\">\n                                {products.find(p => p.id === saleData.productId)?.name}\n                            </p>\n\n                            <div className=\"space-y-4 mb-8\">\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Cantidad</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.quantity}\n                                            onChange={(e) => setSaleData({ ...saleData, quantity: parseInt(e.target.value) || 1 })}\n                                            min=\"1\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Precio Unit.</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.price}\n                                            onChange={(e) => setSaleData({ ...saleData, price: parseFloat(e.target.value) || 0 })}\n                                        />\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">M√©todo de Pago</label>\n                                    <select\n                                        className=\"input-cyber w-full p-3\"\n                                        value={saleData.paymentMethod}\n                                        onChange={(e) => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                                    >\n                                        <option value=\"Efectivo\">Efectivo</option>\n                                        <option value=\"Transferencia\">Transferencia</option>\n                                        <option value=\"Tarjeta\">Tarjeta</option>\n                                    </select>\n                                </div>\n                                <div className=\"bg-slate-900 p-4 rounded-xl flex justify-between items-center border border-slate-800\">\n                                    <span className=\"text-slate-400 font-bold\">Total:</span>\n                                    <span className=\"text-2xl font-black text-green-400\">${(saleData.quantity * saleData.price).toLocaleString()}</span>\n                                </div>\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => setShowManualSaleModal(false)}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={confirmManualSale}\n                                    disabled={isProcessingOrder}\n                                    className=\"flex-1 py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold transition shadow-lg shadow-green-600/30 flex items-center justify-center gap-2\"\n                                >\n                                    {isProcessingOrder ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <CheckCircle className=\"w-5 h-5\" />}\n                                    Confirmar\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n            {/* BOT√ìN FLOTANTE DE WHATSAPP (Solo Plan Negocio/Premium) */}\n            {\n                settings?.showFloatingWhatsapp && settings?.whatsappLink && ['business', 'premium'].includes(settings?.subscriptionPlan) && view !== 'admin' && (\n                    <button\n                        onClick={() => window.open(settings.whatsappLink, '_blank')}\n                        className=\"fixed bottom-24 right-6 z-50 p-4 bg-green-500 rounded-full shadow-[0_0_20px_rgba(34,197,94,0.4)] hover:scale-110 hover:shadow-[0_0_30px_rgba(34,197,94,0.6)] transition-all animate-bounce-slow\"\n                        title=\"Chatea con nosotros\"\n                    >\n                        <MessageCircle className=\"w-8 h-8 text-white fill-white\" />\n                    </button>\n                )\n            }\n\n            <AdminUserDrawer />\n            {/* MODAL: VER PLANES DE SUSCRIPCI√ìN */}\n            {\n                showPlansModal && (\n                    <PlansModalContent settings={settings} onClose={() => setShowPlansModal(false)} />\n                )\n            }\n            {\n                false && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-0 md:p-4 overflow-hidden\">\n                        <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full md:h-auto md:max-h-[90vh] md:max-w-6xl md:rounded-[2.5rem] border-0 md:border md:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n                            {/* Scrollable Content */}\n                            <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6 md:p-10 pb-20\">\n                                {/* Header */}\n                                <div className=\"flex justify-between items-start mb-6\">\n                                    <div>\n                                        <h2 className=\"text-3xl md:text-4xl font-black text-white flex items-center gap-3 mb-2\">\n                                            <div className=\"p-2 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl\">\n                                                <Zap className=\"w-6 h-6 md:w-8 md:h-8 text-white fill-current\" />\n                                            </div>\n                                            Planes Disponibles\n                                        </h2>\n                                        <p className=\"text-slate-500\">Tu plan actual: <span className=\"text-orange-400 font-bold uppercase bg-orange-500/10 px-3 py-1 rounded-full text-sm\">{settings?.subscriptionPlan === 'business' ? 'üöÄ Negocio' : settings?.subscriptionPlan === 'premium' ? 'üíé Premium' : 'üè™ Emprendedor'}</span></p>\n                                    </div>\n                                    <button onClick={() => setShowPlansModal(false)} className=\"p-3 bg-slate-900 hover:bg-slate-800 rounded-2xl text-slate-400 hover:text-white transition-all duration-300 hover:rotate-90\">\n                                        <X className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n\n                                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12\">\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN EMPRENDEDOR */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan\n                                        ? 'bg-gradient-to-b from-orange-950/40 to-slate-950 border-orange-500 shadow-[0_0_40px_rgba(249,115,22,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-orange-500/50'\n                                        }`}>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-orange-400 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-orange-600 to-orange-500 rounded-2xl shadow-lg shadow-orange-500/30\">\n                                                    <Store className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üöÄ Emprendedor</h4>\n                                                    <p className=\"text-sm text-orange-400 font-medium leading-tight\">Impulso inicial</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$7.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Carga de hasta <strong className=\"text-white\">30 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Integraci√≥n <strong className=\"text-white\">Mercado Pago</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">1 promoci√≥n</strong> activa</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-orange-500/50 open:shadow-[0_0_20px_rgba(249,115,22,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-orange-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-orange-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$2.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$7.000', label: 'Pago Mensual', sub: 'M√°s equilibrado' },\n                                                        { cycle: 'Anual', price: '$70.000', label: 'Pago Anual', sub: 'Ahorr√°s $14.000 üéÅ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Emprendedor', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-orange-500 text-black border-orange-400 shadow-lg ring-2 ring-orange-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-orange-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN NEGOCIO */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'business'\n                                        ? 'bg-gradient-to-b from-purple-950/40 to-slate-950 border-purple-500 shadow-[0_0_40px_rgba(168,85,247,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-purple-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-purple-600 to-fuchsia-600 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20 animate-pulse\">‚≠ê M√ÅS POPULAR</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'business' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-purple-400 text-white text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-purple-600 to-fuchsia-600 rounded-2xl shadow-lg shadow-purple-500/30\">\n                                                    <Briefcase className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üöÄ Negocio</h4>\n                                                    <p className=\"text-sm text-purple-400 font-medium leading-tight\">Escala tu marca</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$13.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span>Hasta <strong className=\"text-white\">50 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">5 promociones</strong> simult√°neas</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Cupones</strong> de descuento</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Anal√≠tica</strong> de clientes</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-purple-500/50 open:shadow-[0_0_20px_rgba(168,85,247,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-purple-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-purple-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$4.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$13.000', label: 'Pago Mensual', sub: 'Ideal gesti√≥n mensual' },\n                                                        { cycle: 'Anual', price: '$117.000', label: 'Pago Anual', sub: '3 MESES GRATIS üéâ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Negocio', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-purple-600 text-white border-purple-500 shadow-lg ring-2 ring-purple-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-purple-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle ? 'text-white/80' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN PREMIUM */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'premium'\n                                        ? 'bg-gradient-to-b from-yellow-950/40 to-slate-950 border-yellow-500 shadow-[0_0_40px_rgba(234,179,8,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-yellow-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-yellow-500 to-amber-600 text-black text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20\">üíé VIP</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-yellow-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'premium' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-yellow-500 to-amber-500 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-2xl shadow-lg shadow-yellow-500/30\">\n                                                    <Sparkles className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üíé Premium</h4>\n                                                    <p className=\"text-sm text-yellow-400 font-medium leading-tight\">Liderazgo total</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$22.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Ilimitados</strong> productos y promos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Asistente IA</strong> 24/7</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Carga VIP</strong> 10 productos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Mantenimiento</strong> Full Mensual</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-yellow-500/50 open:shadow-[0_0_20px_rgba(234,179,8,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-yellow-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-yellow-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$6.500', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$22.000', label: 'Pago Mensual', sub: 'Equilibrio perfecto' },\n                                                        { cycle: 'Anual', price: '$198.000', label: 'Pago Anual', sub: '3 MESES GRATIS üéÅ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Premium', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-yellow-500 text-black border-yellow-400 shadow-lg ring-2 ring-yellow-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-yellow-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n                                </div>\n\n                            </div>\n\n                            {/* Sticky Footer */}\n                            <div className=\"border-t border-slate-800 bg-[#0a0a0a] p-6 z-20 shrink-0\">\n                                <div className={`p-4 md:p-6 rounded-2xl border transition-all duration-500 relative overflow-hidden group ${selectedPlanOption\n                                    ? 'bg-gradient-to-r from-green-900/80 to-emerald-900/80 border-green-500 shadow-[0_0_40px_rgba(34,197,94,0.3)]'\n                                    : 'bg-slate-900 border-slate-700 opacity-90'\n                                    }`}>\n                                    <div className=\"absolute inset-0 bg-[url('/noise.svg')] opacity-20\"></div>\n\n                                    <div className=\"relative z-10 flex flex-col md:flex-row items-center justify-between gap-6\">\n                                        <div className=\"flex items-center gap-4 text-left\">\n                                            <div className={`p-3 rounded-full shadow-lg transition-colors duration-300 ${selectedPlanOption ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-400'}`}>\n                                                {selectedPlanOption ? <CheckCircle className=\"w-8 h-8\" /> : <Zap className=\"w-8 h-8\" />}\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-xl font-bold text-white mb-1\">\n                                                    {selectedPlanOption\n                                                        ? `¬°Excelente elecci√≥n! üöÄ`\n                                                        : 'Seleccion√° una opci√≥n para continuar'}\n                                                </h3>\n                                                <p className={`text-sm ${selectedPlanOption ? 'text-green-300' : 'text-slate-400'}`}>\n                                                    {selectedPlanOption\n                                                        ? <span>Est√°s a un paso de activar tu <strong>Plan {selectedPlanOption.plan}</strong> con pago <strong>{selectedPlanOption.cycle}</strong>.</span>\n                                                        : 'Hac√© clic en una de las opciones de arriba para ver los detalles.'}\n                                                </p>\n                                            </div>\n                                        </div>\n\n                                        {selectedPlanOption && (\n                                            <a\n                                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero suscribirme al *Plan ${selectedPlanOption.plan}* con pago *${selectedPlanOption.cycle}* de ${selectedPlanOption.price}. ¬øC√≥mo seguimos?`)}`}\n                                                target=\"_blank\"\n                                                rel=\"noopener noreferrer\"\n                                                className=\"w-full md:w-auto px-8 py-4 bg-green-500 hover:bg-green-400 text-black font-black text-lg rounded-xl transition-all duration-300 hover:scale-105 shadow-xl shadow-green-500/30 flex items-center justify-center gap-2 animate-bounce-subtle\"\n                                            >\n                                                <MessageCircle className=\"w-6 h-6 fill-current\" />\n                                                Confirmar por WhatsApp\n                                                <ArrowRight className=\"w-5 h-5\" />\n                                            </a>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            <ConfirmModal\n                isOpen={confirmModal.isOpen}\n                title={confirmModal.title}\n                message={confirmModal.message}\n                onConfirm={confirmModal.onConfirm}\n                onCancel={confirmModal.onCancel || (() => setConfirmModal(prev => ({ ...prev, isOpen: false })))}\n                isDangerous={true}\n            />\n            {/* --- SUSTIA CHATBOT (AI) --- */}\n            <CategoryModal\n                isOpen={showCategoryModal}\n                onClose={() => setShowCategoryModal(false)}\n                categories={settings?.categories || []}\n                onAdd={(newCat) => setSettings({ ...settings, categories: [...(settings?.categories || []), newCat] })}\n                onRemove={(cat) => setSettings({ ...settings, categories: (settings?.categories || []).filter(c => c !== cat) })}\n            />\n            <SustIABot\n                settings={settings}\n                products={products}\n                addToCart={(p, q = 1) => manageCart(p, q)}\n                controlPanel={{\n                    setDarkMode: setDarkMode,\n                    openCart: () => setView('cart')\n                }}\n                coupons={coupons}\n            />\n        </div >\n    );\n}\n\n// === COMPONENTE MODAL DE PLANES REFACTORIZADO ===\nconst PlansModalContent = ({ settings, onClose }) => {\n    const [activePlanId, setActivePlanId] = React.useState(null);\n    const [selectedOption, setSelectedOption] = React.useState(null);\n\n    // Clases de color est√°ticas para Tailwind (no interpolar)\n    const colorClasses = {\n        purple: {\n            iconBg: 'bg-purple-600',\n            iconText: 'text-purple-400',\n            price: 'text-purple-400',\n            check: 'text-purple-500',\n            activeBg: 'bg-purple-500',\n            activeBorder: 'border-purple-400',\n            gradient: 'from-purple-900/40 to-slate-900',\n            border: 'border-purple-500/50'\n        },\n        orange: {\n            iconBg: 'bg-orange-600',\n            iconText: 'text-orange-400',\n            price: 'text-orange-400',\n            check: 'text-orange-500',\n            activeBg: 'bg-orange-500',\n            activeBorder: 'border-orange-400',\n            gradient: 'from-orange-900/40 to-slate-900',\n            border: 'border-orange-500/50'\n        },\n        yellow: {\n            iconBg: 'bg-yellow-500',\n            iconText: 'text-yellow-400',\n            price: 'text-yellow-400',\n            check: 'text-yellow-500',\n            activeBg: 'bg-yellow-500',\n            activeBorder: 'border-yellow-400',\n            gradient: 'from-yellow-900/40 to-slate-900',\n            border: 'border-yellow-500/50'\n        }\n    };\n\n    const PLANS = [\n        {\n            id: 'entrepreneur',\n            name: 'Plan Emprendedor',\n            emoji: 'üè™',\n            subtitle: 'El impulso que tu negocio necesita para despegar.',\n            price: '$7.000',\n            features: [\n                'üì¶ Carga de hasta 30 productos',\n                'üí≥ Integraci√≥n con Mercado Pago',\n                'üî• 1 Promoci√≥n activa',\n                'üìä Panel de Control completo',\n                'üìß Soporte t√©cnico v√≠a Gmail'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$2.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$7.000', sub: 'Opci√≥n equilibrada' },\n                { id: 'annual', label: 'Anual', price: '$70.000', sub: 'üéÅ 2 MESES GRATIS' }\n            ],\n            color: 'orange',\n            icon: Store\n        },\n        {\n            id: 'business',\n            name: 'Plan Negocio',\n            emoji: 'üöÄ',\n            subtitle: 'Para marcas con identidad que buscan escalar.',\n            price: '$13.000',\n            popular: true,\n            features: [\n                'üì¶ Hasta 50 productos',\n                'üî• 5 Promociones simult√°neas',\n                'üé´ Sistema de cupones',\n                'üìä Anal√≠tica de clientes',\n                'üì≤ Bot√≥n WhatsApp flotante'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$4.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$13.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$117.000', sub: 'üéÅ 3 MESES GRATIS' }\n            ],\n            color: 'purple',\n            icon: Briefcase\n        },\n        {\n            id: 'premium',\n            name: 'Plan Premium',\n            emoji: 'üíé',\n            subtitle: 'Automatizaci√≥n total y cero preocupaciones.',\n            price: '$22.000',\n            features: [\n                'üöÄ Productos ilimitados',\n                'ü§ñ Asistente IA 24/7',\n                '‚ú® Carga VIP (10 productos)',\n                'üõ†Ô∏è Mantenimiento mensual',\n                'üì≤ Omnicanalidad total'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$6.500', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$22.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$198.000', sub: 'üéÅ 3 MESES GRATIS' }\n            ],\n            color: 'yellow',\n            icon: Sparkles\n        }\n    ];\n\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-2 sm:p-4 overflow-hidden\">\n            <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full sm:h-auto sm:max-h-[95vh] sm:max-w-5xl sm:rounded-3xl border-0 sm:border sm:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n\n                {/* Header */}\n                <div className=\"flex justify-between items-center p-4 sm:p-6 border-b border-slate-800/50 shrink-0\">\n                    <div>\n                        <h2 className=\"text-xl sm:text-3xl font-black text-white flex items-center gap-2 sm:gap-3\">\n                            <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 text-yellow-500 fill-current\" /> Planes Disponibles\n                        </h2>\n                        <p className=\"text-slate-500 text-xs sm:text-sm mt-1\">Eleg√≠ un plan y seleccion√° tu forma de pago</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 sm:p-3 bg-slate-800 hover:bg-slate-700 rounded-full text-white transition-all hover:rotate-90\">\n                        <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                    </button>\n                </div>\n\n                {/* Scrollable Content */}\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-5\">\n                        {PLANS.map(plan => {\n                            const isActive = activePlanId === plan.id;\n                            const isCurrentPlan = settings?.subscriptionPlan === plan.id || (!settings?.subscriptionPlan && plan.id === 'entrepreneur');\n                            const Icon = plan.icon;\n                            const colors = colorClasses[plan.color];\n\n                            return (\n                                <div\n                                    key={plan.id}\n                                    onClick={() => setActivePlanId(isActive ? null : plan.id)}\n                                    className={`relative rounded-2xl sm:rounded-3xl border-2 transition-all duration-300 overflow-hidden cursor-pointer flex flex-col\n                                        ${isActive\n                                            ? `bg-gradient-to-b ${colors.gradient} ${colors.border} shadow-xl scale-[1.01]`\n                                            : 'bg-[#111] border-slate-800 hover:border-slate-600'\n                                        }`}\n                                >\n                                    {/* Popular Badge */}\n                                    {plan.popular && (\n                                        <div className=\"absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] font-black px-3 py-1 rounded-bl-xl\">\n                                            POPULAR\n                                        </div>\n                                    )}\n\n                                    {/* Current Plan Badge */}\n                                    {isCurrentPlan && (\n                                        <div className=\"absolute top-0 left-1/2 -translate-x-1/2 bg-white/10 backdrop-blur text-white text-[10px] font-bold px-3 py-1 rounded-b-lg border border-white/20\">\n                                            ‚úì TU PLAN\n                                        </div>\n                                    )}\n\n                                    <div className=\"p-4 sm:p-5 flex-1 flex flex-col\">\n                                        {/* Header */}\n                                        <div className=\"flex items-center gap-3 mb-3\">\n                                            <div className={`p-2.5 sm:p-3 rounded-xl ${colors.iconBg} shadow-lg`}>\n                                                <Icon className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-lg sm:text-xl font-black text-white\">{plan.name}</h3>\n                                                <p className=\"text-[11px] sm:text-xs text-slate-500\">{plan.subtitle}</p>\n                                            </div>\n                                        </div>\n\n                                        {/* Price */}\n                                        <div className={`text-2xl sm:text-3xl font-black ${colors.price} mb-4`}>\n                                            {plan.price} <span className=\"text-sm text-slate-500 font-normal\">/mes</span>\n                                        </div>\n\n                                        {/* Features */}\n                                        <div className=\"space-y-2 mb-4 flex-1\">\n                                            {plan.features.map((feat, i) => (\n                                                <div key={i} className=\"flex items-start gap-2 text-xs sm:text-sm text-slate-300\">\n                                                    <CheckCircle className={`w-3.5 h-3.5 sm:w-4 sm:h-4 ${colors.check} shrink-0 mt-0.5`} />\n                                                    <span>{feat}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n\n                                        {/* Expand/Collapse Indicator */}\n                                        <button\n                                            className={`w-full py-2 text-xs font-bold uppercase tracking-wider rounded-lg transition-all flex items-center justify-center gap-2\n                                                ${isActive ? 'bg-white/5 text-white' : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'}`}\n                                        >\n                                            {isActive ? 'Eleg√≠ tu forma de pago' : 'Ver opciones de pago'}\n                                            <ChevronDown className={`w-4 h-4 transition-transform ${isActive ? 'rotate-180' : ''}`} />\n                                        </button>\n\n                                        {/* Payment Options (Expandable) */}\n                                        <div className={`transition-all duration-300 overflow-hidden ${isActive ? 'max-h-[400px] opacity-100 mt-4' : 'max-h-0 opacity-0'}`}>\n                                            <div className=\"space-y-2 pt-4 border-t border-white/10\">\n                                                {plan.cycles.map(cycle => {\n                                                    const isSelected = selectedOption?.price === cycle.price && selectedOption?.plan === plan.name;\n                                                    return (\n                                                        <button\n                                                            key={cycle.id}\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setSelectedOption({ plan: plan.name, cycle: cycle.label, price: cycle.price, sub: cycle.sub, emoji: plan.emoji });\n                                                            }}\n                                                            className={`w-full text-left p-3 rounded-xl border-2 transition-all flex justify-between items-center\n                                                                ${isSelected\n                                                                    ? `${colors.activeBg} text-black ${colors.activeBorder} shadow-lg`\n                                                                    : 'bg-slate-900/50 border-slate-700 hover:bg-slate-800 text-slate-300 hover:border-slate-500'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{cycle.label}</div>\n                                                                <div className={`text-[10px] ${isSelected ? 'text-black/70' : 'text-slate-500'}`}>{cycle.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-base sm:text-lg\">{cycle.price}</div>\n                                                        </button>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n\n                {/* Sticky Footer CTA */}\n                {selectedOption && (\n                    <div className=\"border-t border-slate-800 bg-gradient-to-r from-green-900/30 to-emerald-900/30 p-3 sm:p-5 shrink-0 animate-slide-up\">\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3 max-w-4xl mx-auto\">\n                            <div className=\"text-center sm:text-left\">\n                                <p className=\"text-white text-sm sm:text-base font-bold\">\n                                    {selectedOption.emoji} {selectedOption.plan} ‚Ä¢ <span className=\"text-green-400\">{selectedOption.cycle}</span>\n                                </p>\n                                <p className=\"text-slate-400 text-xs\">{selectedOption.sub} ‚Ä¢ {selectedOption.price}</p>\n                            </div>\n                            <a\n                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero contratar el *${selectedOption.plan}* con pago *${selectedOption.cycle}* (${selectedOption.price}). ¬øC√≥mo sigo?`)}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"w-full sm:w-auto px-6 py-3 bg-green-500 hover:bg-green-400 text-black font-black text-sm sm:text-base rounded-xl transition shadow-lg shadow-green-500/30 flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5 fill-current\" /> Confirmar por WhatsApp\n                            </a>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\n// Fallback para Acceso Denegado\nconst AccessDenied = ({ onBack }) => (\n    <div className=\"min-h-screen bg-black flex items-center justify-center p-4 animate-fade-in\">\n        <div className=\"text-center max-w-md\">\n            <div className=\"w-20 h-20 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-900/50\">\n                <Shield className=\"w-10 h-10\" />\n            </div>\n            <h1 className=\"text-3xl font-black text-white mb-2\">ACCESO DENEGADO</h1>\n            <p className=\"text-slate-500 mb-8\">No tienes los permisos necesarios para acceder al Panel de Administraci√≥n.</p>\n            <button onClick={onBack} className=\"px-8 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition flex items-center gap-2 mx-auto border border-slate-700\">\n                <ArrowLeft className=\"w-4 h-4\" /> Volver a la Tienda\n            </button>\n        </div>\n    </div>\n);\n\n// Renderizado Final\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n    throw new Error('No se encontr√≥ el contenedor #root');\n}\nconst root = createRoot(rootElement);\nroot.render(\n    <ErrorBoundary>\n        <App />\n    </ErrorBoundary>\n);\n"],
  "mappings": "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QAAS,CACL,sFACA,+EACA,8EACJ,CACJ,EACA,CACI,MAAO,eACP,QAAS,CACL,kGACJ,CACJ,CACJ,CACJ,EACA,SAAU,CACN,MAAO,YACP,YAAa,2EACb,SAAU,CACN,CACI,MAAO,oBACP,QAAS,CACL,qEACA,sEACJ,CACJ,EACA,CACI,MAAO,sBACP,QAAS,CACL,yDACA,6EACJ,CACJ,EACA,CACI,MAAO,kBACP,QAAS,CACL,iGACJ,CACJ,CACJ,CACJ,EACA,OAAQ,CACJ,MAAO,SACP,YAAa,+EACb,SAAU,CACN,CACI,MAAO,kBACP,QAAS,CACL,oEACA,iDACA,iEACJ,CACJ,EACA,CACI,MAAO,qBACP,QAAS,CACL,gEACA,wDACJ,CACJ,CACJ,CACJ,EACA,QAAS,CACL,MAAO,UACP,YAAa,oFACb,SAAU,CACN,CACI,MAAO,sBACP,QAAS,CACL,0EACA,qEACA,8DACJ,CACJ,EACA,CACI,MAAO,uBACP,QAAS,CACL,0EACA,uDACJ,CACJ,EACA,CACI,MAAO,SACP,QAAS,CACL,oFACJ,CACJ,CACJ,CACJ,EACA,UAAW,CACP,MAAO,cACP,YAAa,oEACb,SAAU,CACN,CACI,MAAO,eACP,QAAS,CACL,gFACA,2EACJ,CACJ,EACA,CACI,MAAO,gBACP,QAAS,CACL,iDACA,8CACJ,CACJ,CACJ,CACJ,EACA,UAAW,CACP,MAAO,kBACP,YAAa,6EACb,SAAU,CACN,CACI,MAAO,uBACP,QAAS,CACL,wEACA,oEACJ,CACJ,EACA,CACI,MAAO,2BACP,QAAS,CACL,iDACA,sFACJ,CACJ,CACJ,CACJ,EACA,QAAS,CACL,MAAO,WACP,YAAa,oFACb,SAAU,CACN,CACI,MAAO,wBACP,QAAS,CACL,sDACA,0DACJ,CACJ,EACA,CACI,MAAO,UACP,QAAS,CACL,uEACA,wEACJ,CACJ,CACJ,CACJ,EACA,MAAO,CACH,MAAO,WACP,YAAa,gEACb,SAAU,CACN,CACI,MAAO,mBACP,QAAS,CACL,oDACA,uDACJ,CACJ,EACA,CACI,MAAO,UACP,QAAS,CACL,8CACA,oEACJ,CACJ,CACJ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",
  "names": ["React", "useState", "useEffect", "useRef", "useMemo", "useCallback", "createRoot", "ShoppingBag", "X", "User", "Search", "Zap", "CheckCircle", "MessageCircle", "Instagram", "Minus", "Heart", "Tag", "Plus", "Trash2", "Edit", "AlertTriangle", "RefreshCw", "Send", "LogOut", "Mail", "CreditCard", "Menu", "Home", "Info", "FileQuestion", "Users", "Package", "LayoutDashboard", "Settings", "Ticket", "Truck", "Wallet", "FileText", "ArrowRight", "ArrowLeft", "DollarSign", "TrendingUp", "TrendingDown", "Briefcase", "Save", "AlertCircle", "Phone", "MapPin", "Copy", "ExternalLink", "Shield", "ShoppingCart", "Play", "FolderPlus", "Eye", "EyeOff", "Clock", "Calendar", "Gift", "Lock", "Loader2", "Star", "Percent", "Sparkles", "Flame", "ImageIcon", "Filter", "ChevronDown", "Store", "BarChart", "Globe", "Headphones", "Palette", "Share2", "Cog", "Facebook", "Twitter", "Youtube", "Bell", "Music", "Building", "Banknote", "UserPlus", "Maximize2", "Sun", "Moon", "Upload", "initializeApp", "getAuth", "signInAnonymously", "onAuthStateChanged", "signInWithCustomToken", "sendPasswordResetEmail", "signInWithEmailAndPassword", "createUserWithEmailAndPassword", "getFirestore", "collection", "addDoc", "onSnapshot", "query", "updateDoc", "doc", "getDocs", "deleteDoc", "where", "writeBatch", "getDoc", "increment", "setDoc", "orderBy", "limit", "firebaseConfig", "app", "auth", "db", "DEFAULT_APP_ID", "APP_VERSION", "mpPublicKeyPromise", "getMercadoPagoPublicKey", "res", "data", "setupSmoothWheelScroll", "getDocumentScrollingElement", "elementStates", "clamp", "value", "min", "max", "maxScrollTopForEl", "el", "isScrollable", "overflowY", "findScrollableAncestor", "startEl", "getState", "existing", "state", "animateElement", "ts", "dt", "friction", "current", "next", "nextTs", "onWheel", "e", "targetEl", "scrollEl", "deltaX", "deltaY", "strength", "onResize", "docEl", "_sa", "SUPER_ADMIN_EMAIL", "SecurityManager", "base", "timestamp", "password", "encoder", "salt", "hashBuffer", "b", "hash", "email", "key", "now", "record", "str", "i", "char", "userId", "payload", "token", "signature", "fullToken", "toSign", "stored", "payloadB64", "userData", "input", "a", "aBytes", "bBytes", "result", "noop", "method", "widthDiff", "heightDiff", "defaultSettings", "LazyImage", "src", "alt", "className", "placeholder", "isLoaded", "setIsLoaded", "isInView", "setIsInView", "imgRef", "observer", "entry", "HomeBannerCarouselBackground", "settingsLoaded", "banners", "fallbackUrl", "autoplayMs", "darkMode", "onBannerClick", "slides", "activeIndex", "setActiveIndex", "isPaused", "setIsPaused", "effectiveAutoplayMs", "shouldAutoplay", "id", "img", "activeSlide", "hasTarget", "type", "imageOpacity", "imageClass", "goPrev", "goNext", "slide", "idx", "Toast", "message", "onClose", "containerClass", "iconContainerClass", "IconComponent", "t", "ConfirmModal", "isOpen", "title", "onConfirm", "onCancel", "confirmText", "cancelText", "isDangerous", "ErrorBoundary", "props", "error", "errorInfo", "_a", "_b", "QuickAddButton", "product", "onAdd", "qty", "setQty", "added", "setAdded", "handleAdd", "isMax", "isMin", "ProductCard", "p", "settings", "currentUser", "toggleFavorite", "setSelectedProduct", "manageCart", "calculateItemPrice", "cardBg", "cardBorder", "cardHoverBorder", "cardShadow", "imageBg", "textPrimary", "textSecondary", "infoBg", "borderColor", "prev", "_c", "_d", "BotProductCard", "hasStock", "SustIABot", "products", "addToCart", "controlPanel", "coupons", "setIsOpen", "botImage", "chatStorageKey", "defaultBotMessage", "messages", "setMessages", "inputValue", "setInputValue", "isTyping", "setIsTyping", "lastContext", "setLastContext", "messagesEndRef", "messagesRef", "inFlightRef", "pendingTextRef", "isMountedRef", "safeProducts", "safeCoupons", "aiEnabled", "normalizeText", "tokenize", "raw", "stop", "w", "parseHumanNumber", "rawNumber", "contextText", "n", "parseQuantity", "text", "m1", "m2", "m3", "getProductCategories", "cats", "c", "getProductFinalPrice", "disc", "aiContext", "_e", "_f", "_g", "storeName", "aboutUsText", "deliveryEnabled", "pickupEnabled", "deliveryFee", "freeAbove", "pickupAddress", "shippingParts", "hasCard", "hasTransfer", "hasCash", "payParts", "categories", "productHints", "callExternalAI", "userText", "history", "signal", "fuzzySearch", "patt", "matches", "lastIndex", "index", "callLocalBrain", "currentMessages", "_h", "_i", "_j", "_k", "resolve", "prodCats", "about", "lines", "wantsTransferData", "options", "holderName", "alias", "cbu", "o", "activeCoupons", "deals", "ctx", "isCheaper", "isExpensive", "isBuying", "minPrice", "maxPrice", "lessThanMatch", "parsed", "betweenMatch", "parsedMin", "parsedMax", "availableCategories", "detectedCategoryVal", "targetCategory", "synonyms", "keywords", "k", "candidates", "fp", "score", "pName", "pDesc", "pCats", "lastModelMsg", "m", "suggestionText", "topMatches", "best", "suggestions", "msg", "withTimeout", "promise", "ms", "timeoutId", "timeoutPromise", "_", "reject", "sendText", "rawText", "opts", "alreadyAddedUser", "newMsgUserQueued", "newMsgUser", "updatedHistory", "localResponse", "finalText", "controller", "aiRes", "fallback", "pending", "handleSend", "handleQuickAction", "prevProps", "nextProps", "CategoryModal", "onRemove", "catName", "setCatName", "cat", "ADMIN_PANEL_GUIDES", "AdminHowToUse", "guideKey", "guide", "section", "App", "_l", "_m", "_n", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "_v", "_w", "_x", "_y", "_z", "_A", "_B", "_C", "_D", "_E", "_F", "_G", "_H", "_I", "view", "setView", "adminTab", "setAdminTab", "expenses", "setExpenses", "investments", "setInvestments", "purchases", "setPurchases", "confirmModal", "setConfirmModal", "isMenuOpen", "setIsMenuOpen", "isAdminMenuOpen", "setIsAdminMenuOpen", "setDarkMode", "saved", "appId", "setAppId", "storeResolution", "setStoreResolution", "storeSetupStoreIdInput", "setStoreSetupStoreIdInput", "isStoreSetupSaving", "setIsStoreSetupSaving", "isExportingBackup", "setIsExportingBackup", "isImportingBackup", "setIsImportingBackup", "setCurrentUser", "systemUser", "setSystemUser", "isLoading", "setIsLoading", "isProcessingOrder", "setIsProcessingOrder", "toasts", "setToasts", "adminOrderAlarmMuted", "setAdminOrderAlarmMuted", "orderAlarmContextRef", "orderAlarmIntervalRef", "orderAlarmActiveRef", "orderAlarmToastShownRef", "orderAlarmUnlockListenerActiveRef", "lastOrdersSeenWriteRef", "setProducts", "promos", "setPromos", "homeBanners", "setHomeBanners", "cart", "setCart", "cartHydratedFromRemoteRef", "liveCarts", "setLiveCarts", "orders", "setOrders", "users", "setUsers", "setCoupons", "suppliers", "setSuppliers", "setSettings", "setSettingsLoaded", "searchQuery", "setSearchQuery", "selectedCategory", "setSelectedCategory", "categoriesScrollRef", "isDraggingCategories", "setIsDraggingCategories", "startXCategories", "setStartXCategories", "scrollLeftCategories", "setScrollLeftCategories", "handleMouseDownCategories", "handleMouseLeaveCategories", "handleMouseUpCategories", "handleMouseMoveCategories", "walk", "authData", "setAuthData", "loginMode", "setLoginMode", "newExpense", "setNewExpense", "newInvestment", "setNewInvestment", "newPurchase", "setNewPurchase", "newHomeBanner", "setNewHomeBanner", "editingHomeBannerId", "setEditingHomeBannerId", "newSupplier", "setNewSupplier", "editingSupplierId", "setEditingSupplierId", "showSupplierModal", "setShowSupplierModal", "purchaseCart", "setPurchaseCart", "showCategoryModal", "setShowCategoryModal", "selectedProduct", "openConfirm", "downloadJsonFile", "filename", "obj", "blob", "url", "exportBackup", "safeDate", "showToast", "importBackupFile", "file", "getPlanLimit", "plan", "getPlanAllowsCoupons", "handlePlanChange", "newPlan", "currentPlan", "currentLimit", "newLimit", "activeProducts", "productsToDeactivate", "couponsToDeactivate", "sortedProducts", "salesA", "coupon", "setPlanDowngradeInfo", "reactivateProduct", "productId", "deactivateProduct", "checkoutData", "setCheckoutData", "appliedCoupon", "setAppliedCoupon", "showCouponModal", "setShowCouponModal", "newProduct", "setNewProduct", "editingId", "setEditingId", "showProductForm", "setShowProductForm", "settingsTab", "setSettingsTab", "newPromo", "setNewPromo", "promoSearch", "setPromoSearch", "selectedPromoProduct", "setSelectedPromoProduct", "promoProductQty", "setPromoProductQty", "isEditingPromo", "setIsEditingPromo", "editingPromoId", "setEditingPromoId", "newCoupon", "setNewCoupon", "editingPurchase", "setEditingPurchase", "aboutText", "setAboutText", "newCategory", "setNewCategory", "newTeamMember", "setNewTeamMember", "selectedOrder", "setSelectedOrder", "showManualSaleModal", "setShowManualSaleModal", "metricsDetail", "setMetricsDetail", "showLeastSold", "setShowLeastSold", "saleData", "setSaleData", "viewUserCart", "setViewUserCart", "userPassModal", "setUserPassModal", "viewUserEdit", "setViewUserEdit", "newAdminPassword", "setNewAdminPassword", "userSearch", "setUserSearch", "userRoleFilter", "setUserRoleFilter", "showPlansModal", "setShowPlansModal", "selectedPlanOption", "setSelectedPlanOption", "planDowngradeInfo", "mpBrickController", "setMpBrickController", "isPaymentProcessing", "setIsPaymentProcessing", "paymentError", "setPaymentError", "isInitializingBrick", "cardPaymentBrickRef", "openManualSaleModal", "confirmManualSale", "productRef", "productSnap", "currentStock", "total", "newOrder", "fileInputRef", "removeToast", "handleHomeBannerClick", "targetType", "targetId", "promo", "maxPurchasable", "item", "prod", "pStock", "maxForThisItem", "getRole", "cleanEmail", "member", "userDoc", "u", "isAdmin", "isEditor", "isRoleLoading", "hasAccess", "role", "isAdminUser", "isSuperAdminSession", "latestOrderIso", "v", "ordersLastSeenIso", "hasUnseenOrders", "toggleAdminOrderAlarmMuted", "stopOrderAlarm", "markOrdersSeen", "iso", "startOrderAlarm", "AudioContextCtor", "scheduleBeep", "at", "osc", "gain", "tick", "rawHostname", "normalizedHostname", "cancelled", "snap", "storeId", "createStoreId", "rand", "bootstrapStoreData", "nowIso", "registerHostname", "hostname", "normalizedStoreId", "debounceTimer", "remoteItems", "normalizedRemote", "localSignature", "remoteSignature", "prevCart", "hasChanges", "newCart", "currentProduct", "configRef", "unsubscribe", "didBootstrap", "isBootstrapping", "bootstrapAuth", "user", "userDocRef", "primaryColor", "secondaryColor", "accentColor", "styleEl", "lightModeStyle", "unsubscribeFunctions", "snapshot", "productsData", "d", "team", "teamRoles", "mergedSettings", "promosSnap", "bannersSnap", "ao", "bo", "ad", "bd", "couponsSnap", "unsub", "isAuthenticatedUser", "isAdminViewActive", "ordersRef", "ordersQuery", "ordersData", "getDateMs", "activeCarts", "productsById", "map", "lastSyncedCartRef", "changed", "removed", "validated", "itemId", "productInStore", "comp", "cid", "cp", "fresh", "lastSavedSettingsRef", "currentSettingsStr", "autoSaveTimer", "settingsRef", "settingsToSave", "updateMetaTag", "selector", "content", "element", "updateMetaTagById", "updateLinkTag", "href", "pageTitle", "description", "author", "ogImage", "link", "canvas", "handleAuth", "isRegister", "superAdminAttempt", "isLocalhost", "usersPath", "fetchProfile", "uid", "setupProfile", "firebaseUser", "claimLegacyProfile", "normalizedEmail", "userCredential", "profile", "normalizedEmailLower", "superEmailLower", "normalizedProfile", "emailToUse", "authUser", "code", "bootRes", "bootData", "minimal", "handleForgotPassword", "currentFavs", "isAlreadyFav", "newFavs", "userRef", "quantityDelta", "existingItemIndex", "newQuantity", "updatedCart", "basePrice", "discount", "discounted", "cartSubtotal", "price", "calculateDiscountAmount", "discountValue", "buildWhatsappUrl", "baseLink", "trimmed", "digits", "isCouponValidForWhatsapp", "buildWhatsappCartMessage", "currency", "userBits", "name", "quantity", "unit", "lineTotal", "couponToUse", "couponDiscount", "messageSubtotal", "messageShipping", "shippingFee", "messageTotal", "shippingLabel", "discountAmount", "deliverySettings", "finalTotal", "selectCoupon", "sendOrderConfirmationEmail", "orderData", "discountDetails", "getAuthenticatedUser", "hydrated", "confirmOrder", "effectiveUser", "initializeCardPaymentBrick", "s", "safeAmount", "safetyTimeout", "containerElem", "publicKey", "bricksBuilder", "cardFormData", "response", "confirmOrderAfterPayment", "detailedError", "mpPaymentId", "isCheckoutView", "isMP", "timer", "saveProductFn", "MAX_PRODUCTS_ENTREPRENEUR", "MAX_PRODUCTS_BUSINESS", "isEntrepreneur", "isBusiness", "productData", "handleImageUpload", "setTargetState", "imageField", "maxWidth", "reader", "event", "MAX_WIDTH", "MAX_HEIGHT", "width", "height", "dataUrl", "resetHomeBannerForm", "editHomeBannerFn", "banner", "saveHomeBannerFn", "orderValue", "deleteHomeBannerFn", "deleteProductFn", "handleManualSale", "finalizeOrderFn", "orderId", "deleteOrderFn", "orderRef", "orderSnap", "saveCouponFn", "couponData", "saveSupplierFn", "supplierData", "deletePurchaseFn", "purchase", "updatePurchaseFn", "pId", "oldData", "newData", "qtyDiff", "createCategoryFn", "updatedCategories", "addToPurchaseCart", "supplierId", "productPrice", "cost", "existingIndex", "updated", "removeFromPurchaseCart", "updatePurchaseCartItem", "finalizePurchaseOrder", "batch", "batchId", "newPurchaseRef", "newStock", "dashboardMetrics", "productStats", "initStats", "pid", "validOrders", "revenue", "acc", "expensesTotal", "purchasesTotal", "netIncome", "salesCount", "productMetadata", "trendingProducts", "stats", "liveProd", "meta", "starProductId", "maxSales", "count", "starProduct", "liveStar", "leastSoldProductId", "minSales", "leastSoldProduct", "timeline", "categoryStats", "dayKey", "monthKey", "yearKey", "agg", "amount", "analytics", "totalSalesVolume", "salesByCategory", "lowStockThreshold", "lowStockProducts", "recentActivity", "transactions", "OrderDetailsModal", "order", "CouponSelectorModal", "availableCoupons", "isNotExpired", "isUserTarget", "isGlobal", "usedCount", "notExhausted", "userNotUsed", "canApply", "ProductDetailModal", "isPromo", "stockLimit", "cartItem", "inCartQty", "availableToAdd", "isMaxInCart", "displayPrice", "itemToAdd", "ManualSaleModal", "handleProductChange", "err", "MetricsDetailModal", "timeframe", "setTimeframe", "colorClass", "sortedByVal", "bestPeriod", "worstPeriod", "maxVal", "heightPct", "isPositive", "UserCartView", "cartItems", "UserEditForm", "initialData", "onSubmit", "onDelete", "isSaving", "formData", "setFormData", "isSuperAdminProfile", "r", "AdminUserDrawer", "userCartItems", "setUserCartItems", "isLoadingCart", "setIsLoadingCart", "setIsSaving", "active", "initialFormState", "setInitialFormState", "cartDoc", "closeDrawer", "handleEditSubmit", "authUpdate", "firestoreUpdate", "handleDeleteUser", "loadingPrimaryColor", "filteredProducts", "matchesSearch", "matchesCategory", "newStoreId", "promoProduct", "myCoupons", "purchasedItems", "fid", "step", "maxRev", "x", "percentage", "monthExpenses", "totalVol", "revPct", "autoCost", "selectedProd", "targetProductName", "calculatedCost", "sup", "original", "inv", "ex", "memberInvestments", "totalInv", "totalCapital", "pct", "colors", "sharePercentage", "memberProfit", "filteredUsers", "matchesRole", "exists", "totalCost", "profit", "margin", "isProfitable", "isNearLimit", "deactivatedByPlan", "deactivatedManually", "totalDeactivated", "isSelected", "tab", "cycle", "seconds", "safeSeconds", "targetItem", "targetName", "isEnabled", "names", "curr", "AccessDenied", "PlansModalContent", "newCat", "q", "activePlanId", "setActivePlanId", "selectedOption", "setSelectedOption", "colorClasses", "isActive", "isCurrentPlan", "Icon", "feat", "onBack", "rootElement", "root"]
}
