{
  "version": 3,
  "sources": ["../components/SustIABot.js"],
  "sourcesContent": ["import React, { useState, useEffect, useRef } from 'react';\nimport { Send, X, Trash2, CheckCircle, Plus, Info, Star } from 'lucide-react';\n\nconst BotProductCard = ({ product, onAdd }) => {\n    const [qty, setQty] = useState(1);\n    const finalPrice = product.basePrice * (1 - (product.discount || 0) / 100);\n\n    return (\n        <div className=\"min-w-[200px] max-w-[200px] bg-[#1a1a1a] rounded-2xl border border-white/5 overflow-hidden flex flex-col group snap-center\">\n            <div className=\"relative h-28 bg-white p-2\">\n                <img src={product.image} className=\"w-full h-full object-contain group-hover:scale-110 transition duration-500\" alt={product.name} />\n                {product.discount > 0 && (\n                    <div className=\"absolute top-2 left-2 bg-red-600 text-white text-[10px] font-black px-2 py-0.5 rounded-full shadow-lg\">\n                        -{product.discount}%\n                    </div>\n                )}\n            </div>\n            <div className=\"p-3 flex-1 flex flex-col\">\n                <h4 className=\"text-white font-bold text-xs line-clamp-2 mb-2 leading-tight h-8\">{product.name}</h4>\n                <div className=\"mt-auto\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                        <span className=\"text-yellow-500 font-black text-sm\">${Math.round(finalPrice).toLocaleString()}</span>\n                        {product.discount > 0 && (\n                            <span className=\"text-slate-500 text-[10px] line-through\">${product.basePrice.toLocaleString()}</span>\n                        )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        <div className=\"flex bg-black/40 rounded-lg border border-white/5 overflow-hidden\">\n                            <button\n                                onClick={() => setQty(Math.max(1, qty - 1))}\n                                className=\"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition\"\n                            >\n                                -\n                            </button>\n                            <span className=\"px-2 py-1 text-xs text-white font-bold min-w-[24px] text-center\">{qty}</span>\n                            <button\n                                onClick={() => setQty(Math.min(product.stock || 99, qty + 1))}\n                                className=\"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition\"\n                            >\n                                +\n                            </button>\n                        </div>\n                        <button\n                            onClick={() => onAdd(product, qty)}\n                            className=\"flex-1 bg-yellow-600 hover:bg-yellow-500 text-white py-1.5 rounded-lg text-[10px] font-black transition flex items-center justify-center gap-1 shadow-lg shadow-yellow-900/20\"\n                        >\n                            <Plus className=\"w-3 h-3\" /> LISTO\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst SustIABot = React.memo(({ settings, products, addToCart, controlPanel, coupons, appId }) => {\n    // 1. Verificaci√≥n de Plan - Solo disponible en Plan Premium\n    const forceEnabled = (() => {\n        try {\n            const href = String(window.location.href || '');\n            if (href.includes('sustia=1')) return true;\n            return new URLSearchParams(window.location.search).get('sustia') === '1';\n        } catch { return false; }\n    })();\n    if (!forceEnabled && settings?.subscriptionPlan !== 'premium') return null;\n\n    const [isOpen, setIsOpen] = useState(false);\n    const [isDarkMode, setIsDarkMode] = useState(false);\n\n    // Custom Bot Image (Configurable)\n    const botImage = settings?.botImage || \"sustia-ai-v2.jpg\";\n\n    const chatStorageKey = `sustore_sustia_chat_${appId}`;\n    const defaultBotMessage = { role: 'model', text: '¬°Hola! Soy SustIA ü§ñ, tu asistente personal. ¬øBuscas algo especial hoy? Puedo verificar stock y agregar productos a tu carrito.' };\n    const [messages, setMessages] = useState([defaultBotMessage]);\n    const [inputValue, setInputValue] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    const topicRef = useRef(null);\n    const messagesEndRef = useRef(null);\n    const messagesRef = useRef(messages);\n    const inFlightRef = useRef(false);\n    const pendingTextRef = useRef(null);\n    const isMountedRef = useRef(true);\n\n    const safeProducts = Array.isArray(products) ? products : [];\n    const safeCoupons = Array.isArray(coupons) ? coupons : [];\n\n    useEffect(() => {\n        const check = () => {\n            try {\n                setIsDarkMode(document?.documentElement?.classList?.contains('dark-mode') === true);\n            } catch {\n                setIsDarkMode(false);\n            }\n        };\n        check();\n\n        let obs;\n        try {\n            obs = new MutationObserver(() => check());\n            if (document?.documentElement) obs.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });\n        } catch { }\n\n        return () => {\n            try { obs?.disconnect?.(); } catch { }\n        };\n    }, []);\n\n    const normalizeText = (value) => {\n        if (value === null || value === undefined) return '';\n        return String(value).toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").trim();\n    };\n\n    const tokenize = (value) => {\n        const t = normalizeText(value);\n        if (!t) return [];\n        const raw = t.split(/[\\s,.;:!?/()\\\\[\\]{}\"‚Äú‚Äù'‚Äô\\-+*_]+/).filter(Boolean);\n        const stop = new Set([\n            'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas',\n            'de', 'del', 'en', 'con', 'sin', 'para', 'por', 'a', 'al',\n            'que', 'como', 'cual', 'cuales', 'donde', 'cuando', 'quien', 'quienes',\n            'hola', 'buenas', 'buenos', 'dia', 'dias', 'tardes', 'noches',\n            'busco', 'buscar', 'tenes', 'tienes', 'precio', 'vale', 'cuesta',\n            'quiero', 'necesito', 'hay', 'me', 'te', 'mi', 'mis', 'tu', 'tus',\n            'agrega', 'agregar', 'agregame', 'agregalo', 'sumar', 'sumame', 'poner', 'pone',\n            'comprar', 'compralo', 'llevo', 'carrito', 'bolsa', 'cesta',\n            'mas', 'menos', 'muy', 'super', 're'\n        ]);\n        return raw.filter(w => w.length > 1 && !stop.has(w) && !/^\\d+$/.test(w));\n    };\n\n    const parseHumanNumber = (rawNumber, contextText) => {\n        if (!rawNumber) return null;\n        const n = parseFloat(String(rawNumber).replace(',', '.'));\n        if (!Number.isFinite(n)) return null;\n        const hasK = contextText.includes(`${rawNumber}k`) || contextText.includes(`${rawNumber} k`) || contextText.includes(`${rawNumber}mil`) || contextText.includes(`${rawNumber} mil`);\n        if (hasK) return n * 1000;\n        return n;\n    };\n\n    const parseQuantity = (t) => {\n        const text = normalizeText(t);\n        const m1 = text.match(/\\b(?:x|por)\\s*(\\d{1,3})\\b/);\n        if (m1) return Math.max(1, Math.min(99, parseInt(m1[1], 10)));\n        const m2 = text.match(/\\b(\\d{1,3})\\s*(?:u|ud|uds|unidad|unidades|pcs|piezas)\\b/);\n        if (m2) return Math.max(1, Math.min(99, parseInt(m2[1], 10)));\n        const m3 = text.match(/\\b(\\d{1,2})\\b/);\n        if (m3 && text.match(/\\b(agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|quiero|llevo|comprar)\\b/)) {\n            return Math.max(1, Math.min(99, parseInt(m3[1], 10)));\n        }\n        return 1;\n    };\n\n    const getProductCategories = (p) => {\n        const cats = [];\n        if (Array.isArray(p?.categories)) cats.push(...p.categories);\n        if (typeof p?.category === 'string' && p.category.trim()) cats.push(p.category);\n        return cats\n            .filter(Boolean)\n            .map(c => String(c).trim())\n            .filter(Boolean);\n    };\n\n    const getProductFinalPrice = (p) => {\n        const base = Number(p?.basePrice) || 0;\n        const disc = Number(p?.discount) || 0;\n        return base * (1 - disc / 100);\n    };\n\n    // Auto-scroll al √∫ltimo mensaje\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isOpen]);\n\n    useEffect(() => {\n        messagesRef.current = messages;\n    }, [messages]);\n\n    useEffect(() => {\n        return () => { isMountedRef.current = false; };\n    }, []);\n\n    // --- HERRAMIENTA DE B√öSQUEDA INTELIGENTE (FUZZY) ---\n    const fuzzySearch = (text, query) => {\n        if (!query || typeof query !== 'string') return false;\n        if (!text || typeof text !== 'string') return false;\n\n        const str = normalizeText(text);\n        const patt = normalizeText(query);\n\n        if (str.includes(patt)) return true; // Coincidencia exacta parcial\n\n        // Coincidencia aproximada simple (para Typos)\n        // Si m√°s del 70% de los caracteres est√°n presentes en orden relativo\n        let matches = 0;\n        let lastIndex = -1;\n        for (let char of patt) {\n            const index = str.indexOf(char, lastIndex + 1);\n            if (index > -1) {\n                matches++;\n                lastIndex = index;\n            }\n        }\n        return (matches / patt.length) > 0.75;\n    };\n\n    // --- CEREBRO LOCAL AVANZADO V6 (Contextual & Inteligente) ---\n    const callLocalBrain = async (userText, currentMessages) => {\n        await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 500));\n        const text = normalizeText(userText);\n        const rawText = String(userText || '').trim();\n        const qty = parseQuantity(text);\n        const topic = topicRef.current;\n\n        if (topic && Date.now() - (topic.ts || 0) > 300000) topicRef.current = null;\n        const setTopic = (t) => { topicRef.current = { ...t, ts: Date.now() }; };\n        const clearTopic = () => { topicRef.current = null; };\n\n        // --- Mensajes muy cortos ---\n        if (text.length <= 1) {\n            if (topicRef.current) return { text: \"No entend√≠ bien, ¬øpod√©s escribir un poco m√°s?\" };\n            return { text: \"Te le√≠, pero me falta info üòä. ¬øQu√© est√°s buscando? (ej: 'auriculares', 'zapatillas', 'env√≠o', 'pagos')\" };\n        }\n\n        // --- Agradecimiento / Despedida ---\n        if (text.match(/\\b(gracias|gracia|muchas gracias|thx|thanks)\\b/) && text.length < 40) {\n            clearTopic();\n            return { text: \"¬°De nada! Si necesit√°s algo m√°s, ac√° estoy üòä\" };\n        }\n        if (text.match(/\\b(chau|adios|bye|nos vemos|hasta luego)\\b/) && text.length < 30) {\n            clearTopic();\n            return { text: \"¬°Hasta la pr√≥xima! üëã Cuando quieras, estoy ac√°.\" };\n        }\n\n        // --- Saludos (limpian el tema) ---\n        if (text.match(/\\b(hola|holas|buen dia|buenos dias|buenas tardes|buenas noches|buenas|hello|hi|hey|que tal|como estas|como va|todo bien)\\b/) && text.length < 40) {\n            clearTopic();\n            return { text: \"¬°Hola! üëã ¬øQu√© quer√©s hacer? Pod√©s pedirme productos, ofertas, cupones, env√≠o, pagos o que agregue algo al carrito.\" };\n        }\n\n        // --- Identidad ---\n        if (text.match(/\\b(quien sos|que sos|que haces|sos real|sos un bot|asistente)\\b/)) {\n            const storeName = settings?.storeName ? ` de **${settings.storeName}**` : '';\n            return { text: `Soy SustIA${storeName}. Puedo ayudarte a encontrar productos, ver ofertas/cupones y armar el carrito m√°s r√°pido.` };\n        }\n\n        // --- Comandos de Sistema ---\n        if (controlPanel) {\n            if (text.match(/modo\\s*(?:oscuro|noche|dark)/)) { controlPanel.setDarkMode(true); return { text: \"He activado el modo oscuro üåô\" }; }\n            if (text.match(/modo\\s*(?:claro|dia|light)/)) { controlPanel.setDarkMode(false); return { text: \"He activado el modo claro ‚òÄÔ∏è\" }; }\n            if (text.match(/(?:ver|abrir|ir al)\\s*(?:carrito|bolsa|cesta)/)) { controlPanel.openCart(); return { text: \"Abriendo tu carrito üõí\" }; }\n        }\n\n        // === DETECCI√ìN DE INTENTS EXPL√çCITOS ===\n        const hasShippingKw = !!text.match(/\\b(envio|envios|entrega|delivery|domicilio|retiro|retirar|pickup|como llega|cuando llega|hacen envios|mandan)\\b/);\n        const hasPaymentKw = !!text.match(/\\b(pago|pagos|tarjeta|mercado\\s*pago|transferencia|cbu|alias|efectivo|como pago|formas? de pago|metodos? de pago)\\b/);\n        const hasCouponKw = !!text.match(/\\b(descuento|descuentos|promo|promos|cupon|cupones|oferta|ofertas|codigo|rebaja|rebajas)\\b/);\n        const hasCategoryKw = !!text.match(/\\b(categorias|categoria|rubros|rubro|secciones)\\b/);\n        const hasHelpKw = !!text.match(/\\b(ayuda|soporte|contacto|human|persona|asesor|whatsapp)\\b/);\n        const hasAboutKw = !!text.match(/\\b(quienes somos|about)\\b/) || (!!text.match(/\\b(sobre|informacion)\\b/) && !text.match(/\\bsobre\\s+(un|el|la|este|esta|ese|esa|esto)\\b/));\n        const hasExplicitIntent = hasShippingKw || hasPaymentKw || hasCouponKw || hasCategoryKw || hasHelpKw || hasAboutKw;\n\n        // === FOLLOW-UPS CONTEXTUALES ===\n        if (topicRef.current && !hasExplicitIntent) {\n            const t = topicRef.current;\n            const isYes = !!text.match(/\\b(si|sip|sep|claro|dale|bueno|yes|por favor|obvio|ok|sale|va|vamos|manda|quiero|mostrame|show)\\b/);\n            const isNo = !!text.match(/\\b(no|nah|paso|cancelar|nada|asi esta bien|despues|luego|no gracias|esta bien asi)\\b/);\n\n            // --- Env√≠o: el bot pidi√≥ ciudad/zona ---\n            if (t.action === 'asked_location') {\n                clearTopic();\n                const loc = rawText;\n                const { deliveryEnabled, pickupEnabled, deliveryFee, freeAbove, pickupAddress } = t.data || {};\n                const pickupNorm = normalizeText(pickupAddress);\n                const locNorm = normalizeText(loc);\n                const sameZone = pickupNorm && (pickupNorm.includes(locNorm) || locNorm.includes((pickupNorm.split(',')[0] || '').trim()));\n                const lines = [`üìç Para **${loc}**:`];\n                if (pickupEnabled && sameZone) {\n                    lines.push(`‚úÖ Pod√©s retirar en nuestro local: **${pickupAddress}**.`);\n                } else if (pickupEnabled) {\n                    lines.push(`üè™ Tenemos retiro en local en **${pickupAddress || 'direcci√≥n a coordinar'}**, pero queda en otra zona.`);\n                }\n                if (deliveryEnabled) {\n                    const feeText = deliveryFee > 0 ? `$${deliveryFee.toLocaleString()}` : 'sin costo';\n                    lines.push(`üöö Hacemos env√≠os a domicilio (${feeText}${freeAbove > 0 ? `, gratis superando $${freeAbove.toLocaleString()}` : ''}).`);\n                    lines.push(`Para confirmar costo exacto a ${loc}, avanz√° al checkout o consultanos.`);\n                }\n                if (!pickupEnabled && !deliveryEnabled) {\n                    lines.push('Todav√≠a no tenemos env√≠o configurado. Consultanos para coordinar.');\n                }\n                if (settings?.whatsappLink) lines.push(`\\nüí¨ Coordin√° por WhatsApp: ${settings.whatsappLink}`);\n                lines.push('\\n¬øNecesit√°s algo m√°s? Puedo mostrarte productos, ofertas o medios de pago.');\n                return { text: lines.join('\\n') };\n            }\n\n            // --- Productos mostrados: referencia, compra, refinamiento ---\n            if (t.action === 'showed_products' && Array.isArray(t.shownProducts) && t.shownProducts.length > 0) {\n                const shown = t.shownProducts;\n\n                // Detectar referencia ordinal\n                const ordinals = [\n                    { p: /\\b(primero|primer|1ro|1ero|1¬∞)\\b/, i: 0 },\n                    { p: /\\b(segundo|2do|2¬∞)\\b/, i: 1 },\n                    { p: /\\b(tercero|tercer|3ro|3ero|3¬∞)\\b/, i: 2 },\n                    { p: /\\b(cuarto|4to|4¬∞)\\b/, i: 3 },\n                    { p: /\\b(ultimo|quinto|5to|5¬∞)\\b/, i: shown.length - 1 },\n                ];\n                let refProd = null;\n                for (const o of ordinals) { if (text.match(o.p) && shown[o.i]) { refProd = shown[o.i]; break; } }\n                if (!refProd && text.match(/\\b(ese|este|eso|esto)\\b/)) refProd = shown[0];\n                if (!refProd) {\n                    const numRef = text.match(/\\b(?:el|la|n[u√∫]mero)\\s*(\\d)\\b/);\n                    if (numRef && shown[parseInt(numRef[1], 10) - 1]) refProd = shown[parseInt(numRef[1], 10) - 1];\n                }\n                if (!refProd && text.length > 3) {\n                    refProd = shown.find(p => {\n                        const pn = normalizeText(p.name);\n                        return pn.includes(text) || text.includes(pn.split(' ')[0]);\n                    });\n                }\n\n                // Intent de compra\n                const isBuyIntent = !!text.match(/\\b(agrega|agregar|agregame|agregalo|sum[a√°]|sumale|pone|poner|met[e√©]|comprar|compralo|quiero|dame|llevo|lo quiero|al carrito|sumalo|mandalo)\\b/);\n                if (isBuyIntent) {\n                    const target = refProd || shown[0];\n                    addToCart(target, qty);\n                    const others = shown.filter(p => p.id !== target.id).slice(0, 3);\n                    if (others.length > 0) {\n                        setTopic({ action: 'asked_yes_no', subAction: 'cross_sell', data: others, shownProducts: others });\n                        return { text: `¬°Listo! Agregu√© **${qty}x ${target.name}** al carrito üõí\\n\\n¬øQuer√©s ver algo m√°s para complementar?`, products: [target] };\n                    }\n                    clearTopic();\n                    return { text: `¬°Listo! Agregu√© **${qty}x ${target.name}** al carrito üõí ¬øAlgo m√°s?`, products: [target] };\n                }\n\n                // M√°s info sobre un producto referenciado\n                if (refProd && text.match(/\\b(info|detalle|detalles|especif|descrip|cuenta|contame|mas sobre)\\b/)) {\n                    const p = refProd;\n                    const price = getProductFinalPrice(p);\n                    const cats = getProductCategories(p);\n                    const lines = [`üì¶ **${p.name}**`, `üí∞ $${Math.round(price).toLocaleString()}${(p.discount || 0) > 0 ? ` (${p.discount}% OFF)` : ''}`];\n                    if (p.description) lines.push(`üìù ${String(p.description).slice(0, 200)}`);\n                    if (cats.length > 0) lines.push(`üè∑Ô∏è ${cats.join(', ')}`);\n                    lines.push(`üìä Stock: ${p.stock || 0} unidades`);\n                    lines.push(`\\n¬øLo agregamos al carrito?`);\n                    setTopic({ action: 'asked_yes_no', subAction: 'add_product', data: p, shownProducts: shown });\n                    return { text: lines.join('\\n'), products: [p] };\n                }\n\n                // Si referenci√≥ un producto sin intent claro, preguntar\n                if (refProd) {\n                    const p = refProd;\n                    const price = getProductFinalPrice(p);\n                    setTopic({ action: 'asked_yes_no', subAction: 'add_product', data: p, shownProducts: shown });\n                    return { text: `**${p.name}** ‚Äî $${Math.round(price).toLocaleString()}${(p.discount || 0) > 0 ? ` (${p.discount}% OFF)` : ''}\\n\\n¬øLo agrego al carrito?`, products: [p] };\n                }\n\n                // \"m√°s barato\" / \"m√°s caro\"\n                if (text.match(/\\b(barato|economico|baratos|economicos|menor precio)\\b/)) {\n                    const cheaper = [...shown].sort((a, b) => getProductFinalPrice(a) - getProductFinalPrice(b));\n                    setTopic({ action: 'showed_products', shownProducts: cheaper, searchKeywords: t.searchKeywords });\n                    return { text: \"Ordenados de m√°s econ√≥mico a m√°s caro:\", products: cheaper };\n                }\n                if (text.match(/\\b(caro|caros|premium|mejor calidad|top|mejor)\\b/)) {\n                    const pricier = [...shown].sort((a, b) => getProductFinalPrice(b) - getProductFinalPrice(a));\n                    setTopic({ action: 'showed_products', shownProducts: pricier, searchKeywords: t.searchKeywords });\n                    return { text: \"Las opciones de mayor precio/calidad:\", products: pricier };\n                }\n\n                // \"otro\", \"m√°s opciones\"\n                if (text.match(/\\b(otro|otros|otras|mas opciones|ver mas|siguiente|siguientes|que mas hay|hay mas)\\b/)) {\n                    const shownIds = new Set(shown.map(p => p.id));\n                    let more = safeProducts.filter(p => !shownIds.has(p.id) && (Number(p.stock) || 0) > 0 && p.isActive !== false);\n                    if (Array.isArray(t.searchKeywords) && t.searchKeywords.length > 0) {\n                        const filtered = more.filter(p => {\n                            const pn = normalizeText(p.name);\n                            return t.searchKeywords.some(k => pn.includes(k) || fuzzySearch(pn, k));\n                        });\n                        if (filtered.length > 0) more = filtered;\n                    }\n                    const moreSlice = more.slice(0, 5);\n                    if (moreSlice.length > 0) {\n                        setTopic({ action: 'showed_products', shownProducts: moreSlice, searchKeywords: t.searchKeywords });\n                        return { text: \"M√°s opciones:\", products: moreSlice };\n                    }\n                    return { text: \"No tengo m√°s opciones con ese criterio. ¬øQuer√©s buscar otra cosa?\" };\n                }\n            }\n\n            // --- S√≠/No gen√©rico ---\n            if (t.action === 'asked_yes_no') {\n                if (isYes) {\n                    clearTopic();\n                    if (t.subAction === 'cross_sell' && Array.isArray(t.data)) {\n                        return { text: \"¬°Mir√° estas opciones! üî•\", products: t.data };\n                    }\n                    if (t.subAction === 'show_deals' && Array.isArray(t.data)) {\n                        return { text: \"Las mejores ofertas ahora mismo:\", products: t.data };\n                    }\n                    if (t.subAction === 'add_product' && t.data) {\n                        addToCart(t.data, qty);\n                        return { text: `¬°Listo! Agregu√© **${qty}x ${t.data.name}** al carrito üõí ¬øAlgo m√°s?`, products: [t.data] };\n                    }\n                }\n                if (isNo) {\n                    clearTopic();\n                    return { text: \"Perfecto. ¬øNecesit√°s algo m√°s? üòä\" };\n                }\n            }\n\n            // --- Categor√≠a: el bot pidi√≥ que elija una ---\n            if (t.action === 'asked_category') {\n                const allCats = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...safeProducts.flatMap(p => getProductCategories(p))])];\n                const matchedCat = allCats.find(c => fuzzySearch(normalizeText(c), text) || fuzzySearch(text, normalizeText(c)));\n                if (matchedCat) {\n                    const catProds = safeProducts\n                        .filter(p => (Number(p.stock) || 0) > 0 && p.isActive !== false && getProductCategories(p).some(c => c.toLowerCase() === matchedCat.toLowerCase()))\n                        .slice(0, 5);\n                    if (catProds.length > 0) {\n                        setTopic({ action: 'showed_products', shownProducts: catProds, searchKeywords: [] });\n                        return { text: `Productos en **${matchedCat}**:`, products: catProds };\n                    }\n                    return { text: `No hay productos disponibles en \"${matchedCat}\" ahora. ¬øBuscamos otra categor√≠a?` };\n                }\n            }\n        }\n\n        // === HANDLERS DE INTENTS EXPL√çCITOS ===\n\n        // Categor√≠as\n        if (hasCategoryKw) {\n            const prodCats = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n            const cats = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...prodCats])]\n                .map(c => String(c).trim()).filter(Boolean);\n            if (cats.length === 0) return { text: \"Todav√≠a no tengo categor√≠as configuradas. Decime qu√© est√°s buscando y lo resuelvo igual.\" };\n            setTopic({ action: 'asked_category' });\n            return { text: `Tenemos estas categor√≠as:\\n\\n${cats.slice(0, 10).map(c => `- ${c}`).join('\\n')}\\n\\nDecime cu√°l te interesa y te muestro opciones.` };\n        }\n\n        // Sobre nosotros\n        if (hasAboutKw) {\n            const about = settings?.aboutUsText || '';\n            if (about.trim()) return { text: about.trim() };\n            return { text: \"Esta tienda todav√≠a no carg√≥ su secci√≥n \\u201cSobre nosotros\\u201d. ¬øQuer√©s que te ayude a encontrar un producto?\" };\n        }\n\n        // Env√≠o\n        if (hasShippingKw) {\n            const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n            const pickupEnabled = !!settings?.shippingPickup?.enabled;\n            const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n            const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n            const pickupAddress = settings?.shippingPickup?.address || '';\n            const lines = [];\n            if (pickupEnabled) lines.push(`üìç Retiro en local: ${pickupAddress ? `**${pickupAddress}**` : 'a coordinar'}.`);\n            if (deliveryEnabled) {\n                if (freeAbove > 0) lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n                else lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n            }\n            if (!pickupEnabled && !deliveryEnabled) lines.push(\"Todav√≠a no tengo configurado el m√©todo de entrega.\");\n            lines.push(\"Si me dec√≠s tu ciudad/zona, te digo lo mejor para vos.\");\n            setTopic({ action: 'asked_location', data: { deliveryEnabled, pickupEnabled, deliveryFee, freeAbove, pickupAddress } });\n            return { text: lines.join('\\n') };\n        }\n\n        // Pagos\n        if (hasPaymentKw) {\n            const hasCard = !!settings?.paymentMercadoPago?.enabled;\n            const hasTransfer = !!settings?.paymentTransfer?.enabled;\n            const hasCash = !!settings?.paymentCash && !!settings?.shippingPickup?.enabled;\n            const wantsTransferData = hasTransfer && text.match(/\\b(alias|cbu|transferencia)\\b/);\n            const options = [];\n            if (hasCard) options.push(\"üí≥ Tarjeta (Mercado Pago)\");\n            if (hasTransfer) options.push(\"üè¶ Transferencia\");\n            if (hasCash) options.push(\"üíµ Efectivo (solo retiro en local)\");\n            if (options.length === 0) return { text: \"Todav√≠a no tengo m√©todos de pago configurados.\" };\n            if (wantsTransferData) {\n                const holderName = settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName).trim() : '';\n                const alias = settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias).trim() : '';\n                const cbu = settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu).trim() : '';\n                const lines = [\"Para transferir, us√° estos datos:\"];\n                if (holderName) lines.push(`- Titular: ${holderName}`);\n                if (alias) lines.push(`- Alias: ${alias}`);\n                if (cbu) lines.push(`- CBU: ${cbu}`);\n                if (!holderName && !alias && !cbu) lines.push(\"- A√∫n no est√°n cargados los datos.\");\n                return { text: lines.join('\\n') };\n            }\n            return { text: `Pod√©s pagar con:\\n\\n${options.map(o => `- ${o}`).join('\\n')}\\n\\n¬øCon cu√°l prefer√≠s?` };\n        }\n\n        // Ayuda/Contacto\n        if (hasHelpKw) {\n            if (settings?.whatsappLink) return { text: `Claro. Si necesitas asistencia personalizada üßë‚Äçüíª, escribinos a WhatsApp: ${settings.whatsappLink} üì≤` };\n            return { text: \"Estoy dise√±ado para ayudarte las 24hs ü§ñ. ¬øBusc√°s algo en espec√≠fico?\" };\n        }\n\n        // Cupones/Promociones\n        if (hasCouponKw) {\n            const activeCoupons = safeCoupons.filter(c => {\n                if (!c?.code) return false;\n                const isNotExpired = !c.expirationDate || new Date(c.expirationDate) > new Date();\n                const usedCount = Array.isArray(c.usedBy) ? c.usedBy.length : 0;\n                const notExhausted = !c.usageLimit || usedCount < c.usageLimit;\n                return isNotExpired && notExhausted;\n            });\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0);\n            if (activeCoupons.length > 0) {\n                const couponText = activeCoupons\n                    .map(c => `üé´ **${c.code}** (${c.type === 'percentage' ? c.value + '%' : '$' + c.value} OFF)`)\n                    .join(\"\\n\");\n                return { text: `¬°S√≠! Tenemos estos cupones:\\n\\n${couponText}\\n\\n¬°Usalos al finalizar tu compra! üõí` };\n            } else if (deals.length > 0) {\n                setTopic({ action: 'asked_yes_no', subAction: 'show_deals', data: deals.sort(() => 0.5 - Math.random()).slice(0, 5) });\n                return { text: `No tengo cupones activos, pero hay **${deals.length}** productos con descuento. ¬øQuer√©s verlos? üè∑Ô∏è` };\n            }\n            return { text: \"No tengo promociones activas ahora, pero nuestros precios son los mejores üòâ\" };\n        }\n\n        // === B√öSQUEDA DE PRODUCTOS ===\n        const isCheaper = text.match(/(?:mas|muy|super)\\s*(?:barato|economico|bajo)|mas\\s*economico/);\n        const isExpensive = text.match(/(?:mas|muy|super)\\s*(?:caro|mejor|calidad|top|premium)|costoso|lujo/);\n        const isBuying = text.match(/(?:agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|comprar|quiero|dame|carrito|llevo|lo quiero)/);\n\n        let minPrice = 0;\n        let maxPrice = Infinity;\n        const lessThanMatch = text.match(/(?:menos|menor|bajo)\\s*(?:de|a|que)?\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (lessThanMatch) { const p = parseHumanNumber(lessThanMatch[1], text); if (p !== null) maxPrice = p; }\n        const betweenMatch = text.match(/entre\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?\\s*y\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (betweenMatch) {\n            const pMin = parseHumanNumber(betweenMatch[1], text); const pMax = parseHumanNumber(betweenMatch[2], text);\n            if (pMin !== null) minPrice = pMin; if (pMax !== null) maxPrice = pMax;\n        }\n\n        const availableCategories = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n        const detectedCategoryVal = availableCategories.find(c => fuzzySearch(c, text) || fuzzySearch(text, c));\n        const targetCategory = detectedCategoryVal ? detectedCategoryVal.toLowerCase() : null;\n\n        const synonyms = new Map([\n            ['celu', 'celular'], ['cel', 'celular'], ['tele', 'televisor'],\n            ['tv', 'televisor'], ['compu', 'computadora'], ['notebook', 'laptop'],\n            ['auris', 'auriculares'], ['zapas', 'zapatillas'],\n            ['remera', 'camiseta'], ['remeras', 'camisetas'],\n            ['funda', 'funda'], ['cable', 'cable'], ['cargador', 'cargador'],\n            ['protector', 'protector'], ['vidrio', 'vidrio templado']\n        ]);\n        const keywords = tokenize(text).flatMap(k => { const alt = synonyms.get(k); return alt ? [k, alt] : [k]; });\n\n        if (keywords.length === 0 && !targetCategory && !isCheaper && !isExpensive && !isBuying) {\n            const lastResort = safeProducts\n                .filter(p => (Number(p.stock) || 0) > 0 && p.isActive !== false)\n                .find(p => fuzzySearch(normalizeText(p.name), text));\n            if (lastResort) {\n                setTopic({ action: 'showed_products', shownProducts: [lastResort], searchKeywords: [text] });\n                return { text: `¬øBusc√°s esto?`, products: [lastResort] };\n            }\n            return { text: \"¬øMe dec√≠s qu√© producto o categor√≠a quer√©s ver? Tambi√©n pod√©s preguntar por env√≠o, pagos o cupones.\" };\n        }\n\n        let candidates = safeProducts.filter(p => (Number(p?.stock) || 0) > 0 && p?.isActive !== false);\n        candidates = candidates.filter(p => { const fp = getProductFinalPrice(p); return fp >= minPrice && fp <= maxPrice; });\n        if (targetCategory) candidates = candidates.filter(p => getProductCategories(p).some(c => c.toLowerCase() === targetCategory));\n\n        const scores = candidates.map(p => {\n            let score = 0;\n            const pName = normalizeText(p.name);\n            const pDesc = normalizeText(p.description);\n            keywords.forEach(k => {\n                if (pName.includes(k)) score += 10;\n                else if (fuzzySearch(pName, k)) score += 5;\n                if (pDesc.includes(k)) score += 2;\n            });\n            if (targetCategory && !keywords.length) score += 5;\n            if (p.isFeatured) score += 5;\n            if (p.discount > 0) score += 3;\n            if (isCheaper) score += (1 / (getProductFinalPrice(p) || 1)) * 10000;\n            if (isExpensive) score += getProductFinalPrice(p) / 100;\n            return { product: p, score };\n        });\n\n        const sorted = scores.filter(s => s.score > 0).sort((a, b) => b.score - a.score);\n        const topMatches = sorted.slice(0, 5).map(s => s.product);\n\n        if (topMatches.length === 0) {\n            const allDeals = safeProducts.filter(p => (Number(p.discount) || 0) > 0 && (Number(p.stock) || 0) > 0).slice(0, 3);\n            if (allDeals.length > 0) {\n                setTopic({ action: 'showed_products', shownProducts: allDeals, searchKeywords: keywords });\n                return { text: \"No encontr√© eso exactamente, pero mir√° estas opciones con descuento:\", products: allDeals };\n            }\n            return { text: \"No encontr√© lo que busc√°s. Prob√° con otra palabra o preguntame por categor√≠as üîé\" };\n        }\n\n        if (isBuying && topMatches.length > 0) {\n            const best = topMatches[0];\n            addToCart(best, qty);\n            const suggestions = safeProducts\n                .filter(p => p.id !== best.id && (Number(p.stock) || 0) > 0 && p.isActive !== false)\n                .sort(() => 0.5 - Math.random()).slice(0, 3);\n            if (suggestions.length > 0) {\n                setTopic({ action: 'asked_yes_no', subAction: 'cross_sell', data: suggestions, shownProducts: suggestions });\n                return { text: `¬°Listo! Agregu√© **${qty}x ${best.name}** al carrito üõí\\n\\n¬øQuer√©s ver algo para complementar? üëÄ`, products: [best] };\n            }\n            clearTopic();\n            return { text: `¬°Listo! Agregu√© **${qty}x ${best.name}** al carrito üõí ¬øAlgo m√°s?`, products: [best] };\n        }\n\n        setTopic({ action: 'showed_products', shownProducts: topMatches, searchKeywords: keywords });\n        let msg = \"Encontr√© estas opciones. ¬øQuer√©s que te muestre m√°s o me dec√≠s un presupuesto?\";\n        if (targetCategory) msg = `Encontr√© esto en **${detectedCategoryVal}**:`;\n        if (isCheaper) msg = \"Las opciones m√°s econ√≥micas:\";\n        if (topMatches.length === 1) msg = \"Encontr√© esto para vos:\";\n\n        return { text: msg, products: topMatches };\n    };\n\n    const withTimeout = async (promise, ms) => {\n        let timeoutId = null;\n        const timeoutPromise = new Promise((_, reject) => {\n            timeoutId = setTimeout(() => reject(new Error('timeout')), ms);\n        });\n        try {\n            return await Promise.race([promise, timeoutPromise]);\n        } finally {\n            if (timeoutId) clearTimeout(timeoutId);\n        }\n    };\n\n    const sendText = async (rawText, opts = {}) => {\n        const alreadyAddedUser = !!opts.alreadyAddedUser;\n        const text = String(rawText || '').trim().slice(0, 300);\n        if (!text) return;\n        if (inFlightRef.current) {\n            if (!alreadyAddedUser) {\n                const newMsgUserQueued = { role: 'client', text };\n                setMessages(prev => [...prev, newMsgUserQueued]);\n            }\n            pendingTextRef.current = { text, alreadyAddedUser: true };\n            return;\n        }\n\n        inFlightRef.current = true;\n        setInputValue('');\n\n        const newMsgUser = alreadyAddedUser ? null : { role: 'client', text };\n        const updatedHistory = [...(messagesRef.current || []), ...(newMsgUser ? [newMsgUser] : [])];\n\n        if (newMsgUser) {\n            setMessages(prev => [...prev, newMsgUser]);\n        }\n        setIsTyping(true);\n\n        try {\n            const localResponse = await withTimeout(callLocalBrain(text, updatedHistory), 12000);\n            if (!isMountedRef.current) return;\n            let finalText = localResponse?.text && typeof localResponse.text === 'string'\n                ? localResponse.text\n                : \"Perd√≥n, tuve un problema procesando eso. ¬øPod√©s reformularlo?\";\n            const safeProducts = Array.isArray(localResponse?.products) ? localResponse.products : undefined;\n\n            setMessages(prev => [...prev, {\n                role: 'model',\n                text: finalText,\n                products: safeProducts\n            }]);\n        } catch (e) {\n            if (!isMountedRef.current) return;\n            const fallback = settings?.whatsappLink\n                ? `Uy, se me trab√≥ por un momento. Si quer√©s, habl√° por WhatsApp: ${settings.whatsappLink}`\n                : \"Uy, se me trab√≥ por un momento. ¬øProbamos de nuevo?\";\n            setMessages(prev => [...prev, { role: 'model', text: fallback }]);\n        } finally {\n            if (isMountedRef.current) setIsTyping(false);\n            inFlightRef.current = false;\n            const pending = pendingTextRef.current;\n            if (pending && pending.text) {\n                pendingTextRef.current = null;\n                setTimeout(() => sendText(pending.text, { alreadyAddedUser: pending.alreadyAddedUser === true }), 0);\n            }\n        }\n    };\n\n    const handleSend = async () => {\n        return sendText(inputValue);\n    };\n\n    const handleQuickAction = (value) => {\n        const text = String(value || '').trim();\n        if (!text) return;\n        sendText(text);\n    };\n\n    const clearChat = () => {\n        try {\n            localStorage.removeItem(chatStorageKey);\n        } catch { }\n        topicRef.current = null;\n        setMessages([defaultBotMessage]);\n    };\n\n    const quickActions = [\n        { label: 'Ofertas', value: 'Mostrame ofertas' },\n        { label: 'Cupones', value: 'Ten√©s cupones?' },\n        { label: 'Env√≠o', value: 'C√≥mo es el env√≠o?' },\n        { label: 'Pagos', value: 'Qu√© medios de pago hay?' },\n        { label: 'Categor√≠as', value: 'Qu√© categor√≠as ten√©s?' },\n        { label: 'WhatsApp', value: 'Necesito hablar con una persona' }\n    ];\n\n    return (\n        <div className=\"fixed bottom-4 right-4 z-[9999] flex flex-col items-end pointer-events-none\">\n            {isOpen && (\n                <div className=\"bg-[#0f0f0f]/95 backdrop-blur-2xl border border-white/10 rounded-[2rem] w-[calc(100vw-2rem)] sm:w-80 md:w-96 h-[min(600px,80dvh)] shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col mb-4 animate-fade-up overflow-hidden font-sans pointer-events-auto ring-1 ring-white/10 relative mr-0 sm:mr-0\">\n                    <div className=\"bg-gradient-to-r from-yellow-500 to-amber-600 p-5 flex justify-between items-center relative z-10\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-1 bg-white/20 rounded-full backdrop-blur-md overflow-hidden border border-white/30\">\n                                <img src={botImage} className=\"w-9 h-9 object-cover rounded-full\" alt=\"SustIA\" />\n                            </div>\n                            <div>\n                                <h3 className=\"font-black text-white text-sm tracking-tight\">SustIA AI</h3>\n                                <p className=\"text-[10px] text-white/90 font-bold flex items-center gap-1.5\">\n                                    <span className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_rgba(74,222,128,0.8)]\"></span>\n                                    En l√≠nea\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                            <button onClick={clearChat} className=\"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors\" title=\"Limpiar chat\">\n                                <Trash2 className=\"w-5 h-5\" />\n                            </button>\n                            <button onClick={() => setIsOpen(false)} className=\"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors\" title=\"Cerrar\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>\n\n                    <div className={`px-4 py-2 border-b ${isDarkMode ? 'bg-[#111] border-white/5' : 'bg-slate-50 border-slate-200'}`}>\n                        <div className=\"flex gap-2 overflow-x-auto pb-1 custom-scrollbar\">\n                            {quickActions.map(a => (\n                                <button\n                                    key={a.label}\n                                    type=\"button\"\n                                    data-testid={`quick-action-${a.label.toLowerCase()}`}\n                                    onClick={() => {\n                                        handleQuickAction(a.value);\n                                    }}\n                                    className={\n                                        isDarkMode\n                                            ? \"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-white/10 bg-[#1a1a1a] text-white hover:bg-[#222] transition\"\n                                            : \"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-slate-200 bg-white text-slate-800 hover:bg-slate-50 transition\"\n                                    }\n                                >\n                                    <span className={isDarkMode ? \"text-white\" : \"text-slate-800\"}>{a.label}</span>\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-5 space-y-6 bg-[#0a0a0a]/50 custom-scrollbar relative\">\n                        {messages.map((m, i) => (\n                            <div key={i} className={`flex flex-col ${m.role === 'client' ? 'items-end' : 'items-start'} animate-fade-in`}>\n                                <div className={`max-w-[85%] p-4 rounded-2xl text-[13px] leading-relaxed shadow-lg ${m.role === 'client'\n                                    ? 'bg-gradient-to-br from-yellow-500 to-amber-600 text-white rounded-tr-none border border-white/10'\n                                    : 'bg-[#1a1a1a] text-slate-200 rounded-tl-none border border-white/5'\n                                    }`}>\n                                    <p className=\"whitespace-pre-wrap\">{m.text}</p>\n                                </div>\n\n                                {m.products && m.products.length > 0 && (\n                                    <div className=\"mt-3 flex gap-3 overflow-x-auto pb-2 w-full custom-scrollbar pl-1 snap-x\">\n                                        {m.products.map(product => (\n                                            <BotProductCard\n                                                key={product.id}\n                                                product={product}\n                                                onAdd={(p, qty) => {\n                                                    addToCart(p, qty);\n                                                    setMessages(prev => [...prev, { role: 'model', text: `Agregado ${qty}x ${p.name} al carrito! üõí` }]);\n                                                }}\n                                            />\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n                        {isTyping && (\n                            <div className=\"flex justify-start\">\n                                <div className=\"bg-[#1a1a1a] p-3 rounded-2xl rounded-bl-none border border-white/5 flex gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\"></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></span>\n                                </div>\n                            </div>\n                        )}\n                        <div ref={messagesEndRef} />\n                    </div>\n\n                    <div className=\"p-3 bg-[#0a0a0a] border-t border-white/10 relative z-0\">\n                        <form onSubmit={(e) => { e.preventDefault(); handleSend(); }} className=\"flex gap-2 items-center\">\n                            <input\n                                className=\"flex-1 bg-[#1a1a1a] border border-white/10 rounded-full px-4 py-2.5 text-sm text-white focus:border-yellow-500/50 outline-none transition placeholder:text-slate-600\"\n                                placeholder=\"Escribe aqu√≠...\"\n                                value={inputValue}\n                                onChange={e => setInputValue(e.target.value)}\n                            />\n                            <button type=\"submit\" className=\"p-2.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full transition shadow-lg shadow-yellow-600/20 disabled:opacity-50 disabled:cursor-not-allowed\" disabled={isTyping || !inputValue.trim()}>\n                                <Send className=\"w-4 h-4\" />\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            )}\n\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"pointer-events-auto w-14 h-14 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(234,179,8,0.4)] hover:scale-110 transition-transform group relative z-50\"\n            >\n                {isOpen ? <X className=\"w-6 h-6 text-white\" /> : (\n                    <div className=\"w-full h-full p-1\">\n                        <img src=\"sustia-ai-v2.jpg\" className=\"w-full h-full object-cover rounded-full opacity-95 group-hover:scale-110 transition-transform duration-300\" alt=\"SustIA\" />\n                    </div>\n                )}\n                {!isOpen && (\n                    <span className=\"absolute -top-1 -right-1 flex h-4 w-4\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-4 w-4 bg-yellow-500 border border-black\"></span>\n                    </span>\n                )}\n            </button>\n        </div>\n    );\n}, (prevProps, nextProps) => {\n    if (prevProps.settings?.subscriptionPlan !== nextProps.settings?.subscriptionPlan) return false;\n    if (prevProps.products !== nextProps.products) return false;\n    return true;\n});\n\nexport default SustIABot;\n"],
  "mappings": "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",
  "names": ["React", "useState", "useEffect", "useRef", "Send", "X", "Trash2", "Plus", "BotProductCard", "product", "onAdd", "qty", "setQty", "finalPrice", "SustIABot", "settings", "products", "addToCart", "controlPanel", "coupons", "appId", "isOpen", "setIsOpen", "isDarkMode", "setIsDarkMode", "botImage", "chatStorageKey", "defaultBotMessage", "messages", "setMessages", "inputValue", "setInputValue", "isTyping", "setIsTyping", "topicRef", "messagesEndRef", "messagesRef", "inFlightRef", "pendingTextRef", "isMountedRef", "safeProducts", "safeCoupons", "check", "obs", "normalizeText", "value", "tokenize", "t", "raw", "stop", "w", "parseHumanNumber", "rawNumber", "contextText", "n", "parseQuantity", "text", "m1", "m2", "m3", "getProductCategories", "p", "cats", "c", "getProductFinalPrice", "base", "disc", "fuzzySearch", "query", "str", "patt", "matches", "lastIndex", "char", "index", "callLocalBrain", "userText", "currentMessages", "resolve", "rawText", "topic", "setTopic", "clearTopic", "hasShippingKw", "hasPaymentKw", "hasCouponKw", "hasCategoryKw", "hasHelpKw", "hasAboutKw", "hasExplicitIntent", "isYes", "isNo", "loc", "deliveryEnabled", "pickupEnabled", "deliveryFee", "freeAbove", "pickupAddress", "pickupNorm", "locNorm", "sameZone", "lines", "feeText", "shown", "ordinals", "refProd", "o", "numRef", "pn", "target", "others", "price", "cheaper", "a", "b", "pricier", "shownIds", "more", "filtered", "k", "moreSlice", "matchedCat", "catProds", "prodCats", "about", "hasCard", "hasTransfer", "hasCash", "wantsTransferData", "options", "holderName", "alias", "cbu", "activeCoupons", "isNotExpired", "usedCount", "notExhausted", "deals", "isCheaper", "isExpensive", "isBuying", "minPrice", "maxPrice", "lessThanMatch", "betweenMatch", "pMin", "pMax", "detectedCategoryVal", "targetCategory", "synonyms", "keywords", "alt", "lastResort", "candidates", "fp", "topMatches", "score", "pName", "pDesc", "s", "allDeals", "best", "suggestions", "msg", "withTimeout", "promise", "ms", "timeoutId", "timeoutPromise", "_", "reject", "sendText", "opts", "alreadyAddedUser", "newMsgUserQueued", "prev", "newMsgUser", "updatedHistory", "localResponse", "finalText", "fallback", "pending", "handleSend", "handleQuickAction", "m", "i", "e", "prevProps", "nextProps", "SustIABot_default"]
}
