import o,{useState as M,useEffect as H,useRef as L}from"react";import{Send as De,X as we,Trash2 as Ke,Plus as Oe}from"lucide-react";var Ue=({product:n,onAdd:j})=>{let[k,_]=M(1),O=n.basePrice*(1-(n.discount||0)/100);return o.createElement("div",{className:"min-w-[200px] max-w-[200px] bg-[#1a1a1a] rounded-2xl border border-white/5 overflow-hidden flex flex-col group snap-center"},o.createElement("div",{className:"relative h-28 bg-white p-2"},o.createElement("img",{src:n.image,className:"w-full h-full object-contain group-hover:scale-110 transition duration-500",alt:n.name}),n.discount>0&&o.createElement("div",{className:"absolute top-2 left-2 bg-red-600 text-white text-[10px] font-black px-2 py-0.5 rounded-full shadow-lg"},"-",n.discount,"%")),o.createElement("div",{className:"p-3 flex-1 flex flex-col"},o.createElement("h4",{className:"text-white font-bold text-xs line-clamp-2 mb-2 leading-tight h-8"},n.name),o.createElement("div",{className:"mt-auto"},o.createElement("div",{className:"flex items-center gap-2 mb-3"},o.createElement("span",{className:"text-yellow-500 font-black text-sm"},"$",Math.round(O).toLocaleString()),n.discount>0&&o.createElement("span",{className:"text-slate-500 text-[10px] line-through"},"$",n.basePrice.toLocaleString())),o.createElement("div",{className:"flex items-center gap-2"},o.createElement("div",{className:"flex bg-black/40 rounded-lg border border-white/5 overflow-hidden"},o.createElement("button",{onClick:()=>_(Math.max(1,k-1)),className:"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition"},"-"),o.createElement("span",{className:"px-2 py-1 text-xs text-white font-bold min-w-[24px] text-center"},k),o.createElement("button",{onClick:()=>_(Math.min(n.stock||99,k+1)),className:"px-2 py-1 text-slate-400 hover:text-white hover:bg-white/5 transition"},"+")),o.createElement("button",{onClick:()=>j(n,k),className:"flex-1 bg-yellow-600 hover:bg-yellow-500 text-white py-1.5 rounded-lg text-[10px] font-black transition flex items-center justify-center gap-1 shadow-lg shadow-yellow-900/20"},o.createElement(Oe,{className:"w-3 h-3"})," LISTO")))))},Fe=o.memo(({settings:n,products:j,addToCart:k,controlPanel:_,coupons:O,appId:ye})=>{if(!(()=>{try{return String(window.location.href||"").includes("sustia=1")?!0:new URLSearchParams(window.location.search).get("sustia")==="1"}catch{return!1}})()&&n?.subscriptionPlan!=="premium")return null;let[I,re]=M(!1),[V,se]=M(!1),Ne=n?.botImage||"sustia-ai-v2.jpg",Ae=`sustore_sustia_chat_${ye}`,ne={role:"model",text:"Â¡Hola! Soy SustIA ðŸ¤–, tu asistente personal. Â¿Buscas algo especial hoy? Puedo verificar stock y agregar productos a tu carrito."},[E,z]=M([ne]),[G,ie]=M(""),[le,ce]=M(!1),S=L(null),ue=L(null),de=L(E),X=L(!1),Y=L(null),U=L(!0),A=Array.isArray(j)?j:[],ke=Array.isArray(O)?O:[];H(()=>{let t=()=>{try{se(document?.documentElement?.classList?.contains("dark-mode")===!0)}catch{se(!1)}};t();let i;try{i=new MutationObserver(()=>t()),document?.documentElement&&i.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}catch{}return()=>{try{i?.disconnect?.()}catch{}}},[]);let v=t=>t==null?"":String(t).toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),$e=t=>{let i=v(t);if(!i)return[];let a=i.split(/[\s,.;:!?/()\\[\]{}"â€œâ€'â€™\-+*_]+/).filter(Boolean),p=new Set(["el","la","los","las","un","una","unos","unas","de","del","en","con","sin","para","por","a","al","que","como","cual","cuales","donde","cuando","quien","quienes","hola","buenas","buenos","dia","dias","tardes","noches","busco","buscar","tenes","tienes","precio","vale","cuesta","quiero","necesito","hay","me","te","mi","mis","tu","tus","agrega","agregar","agregame","agregalo","sumar","sumame","poner","pone","comprar","compralo","llevo","carrito","bolsa","cesta","mas","menos","muy","super","re"]);return a.filter(u=>u.length>1&&!p.has(u)&&!/^\d+$/.test(u))},Z=(t,i)=>{if(!t)return null;let a=parseFloat(String(t).replace(",","."));return Number.isFinite(a)?i.includes(`${t}k`)||i.includes(`${t} k`)||i.includes(`${t}mil`)||i.includes(`${t} mil`)?a*1e3:a:null},Se=t=>{let i=v(t),a=i.match(/\b(?:x|por)\s*(\d{1,3})\b/);if(a)return Math.max(1,Math.min(99,parseInt(a[1],10)));let p=i.match(/\b(\d{1,3})\s*(?:u|ud|uds|unidad|unidades|pcs|piezas)\b/);if(p)return Math.max(1,Math.min(99,parseInt(p[1],10)));let u=i.match(/\b(\d{1,2})\b/);return u&&i.match(/\b(agrega|agregar|agregame|sum[aÃ¡]|pone|poner|met[eÃ©]|quiero|llevo|comprar)\b/)?Math.max(1,Math.min(99,parseInt(u[1],10))):1},C=t=>{let i=[];return Array.isArray(t?.categories)&&i.push(...t.categories),typeof t?.category=="string"&&t.category.trim()&&i.push(t.category),i.filter(Boolean).map(a=>String(a).trim()).filter(Boolean)},$=t=>{let i=Number(t?.basePrice)||0,a=Number(t?.discount)||0;return i*(1-a/100)},Pe=["buenos aires","caba","capital federal","ciudad autonoma","ciudad de buenos aires","catamarca","chaco","chubut","cordoba","corrientes","entre rios","formosa","jujuy","la pampa","la rioja","mendoza","misiones","neuquen","rio negro","salta","san juan","san luis","santa cruz","santa fe","santiago del estero","tierra del fuego","tucuman"],je=["adrogue","avellaneda","bahia blanca","banfield","bariloche","bernal","berazategui","burzaco","caleta olivia","campana","caseros","cipolletti","comodoro rivadavia","concordia","devoto","el calafate","el palomar","escobar","ezeiza","florencio varela","general roca","gualeguaychu","hurlingham","iguazu","ituzaingo","jose c paz","junin","la plata","lanus","lomas de zamora","lujan","mar del plata","marcos paz","mercedes","merlo","monte grande","moron","necochea","olavarria","parana","pergamino","pilar","pinamar","posadas","presidencia roque saenz pena","quilmes","rafaela","rawson","reconquista","resistencia","rio cuarto","rio gallegos","rosario","san fernando","san isidro","san justo","san martin","san miguel","san miguel de tucuman","san nicolas","san rafael","san salvador de jujuy","santa rosa","tandil","temperley","tigre","trelew","ushuaia","venado tuerto","villa carlos paz","villa maria","villa mercedes","wilde","zarate","gonzalez catan","virrey del pino","laferrere","rafael castillo","isidro casanova","ciudad evita","aldo bonzi","tapiales","villa luzuriaga","ramos mejia","haedo","castelar","ciudadela","liniers","mataderos","lugano","flores","caballito","almagro","boedo","palermo","belgrano","nunez","recoleta","retiro","microcentro","san telmo","la boca","barracas","constitucion","once","congreso","tribunales","villa crespo","villa urquiza","villa devoto","villa del parque","versalles","monte castro","floresta","velez sarsfield","parque chacabuco","pompeya","soldati","villa lugano","villa riachuelo","liniers","mataderos","parque avellaneda","villa luro","agronomia","chacarita","paternal","villa ortuzar","coghlan","saavedra","villa pueyrredon","parque chas","villa real","puerto madero","san cristobal","balvanera","monserrat","san nicolas barrio","olivos","martinez","acassuso","beccar","boulogne","munro","florida","vicente lopez","don torcuato","el talar","garin","grand bourg","ingeniero maschwitz","los polvorines","pablo nogues","tortuguitas","william morris","general pacheco","benavidez","nordelta","rincon de milberg","dique lujan","general rodriguez","moreno","paso del rey","trujui","francisco alvarez","la reja","guernica","alejandro korn","domselaar","san vicente","canning","esteban echeverria","el jaguel","luis guillon","longchamps","glew","claypole","almirante brown","villa gesell","miramar","necochea","tres arroyos","azul","olavarria","bragado","chivilcoy","chacabuco","pehuajo","trenque lauquen","general villegas","nueve de julio","bolivar","saladillo","lobos","canuelas","san antonio de areco","carmen de areco","capitan sarmiento","san pedro","baradero","ramallo","villa constitucion","san lorenzo","casilda","firmat","chabas","rufino","general pico","rio tercero","villa allende","unquillo","jesus maria","alta gracia","cosquin","la falda","villa giardino","dean funes","cruz del eje","bell ville","marcos juarez","laboulaye","san francisco"],_e=[...Pe,...je],ze=new Set(["caca","culo","teta","tetas","pija","pito","mierda","puta","puto","concha","pelotudo","pelotuda","boludo","boluda","forro","forra","verga","poronga","ojete","orto","pete","garcha","cogida","cogido","coger","chupar","chuparla","chupame","chupala","mamada","mogolico","mogolica","tarado","tarada","imbecil","idiota","estupido","estupida","hdp","lcdtm","ctm","ptm","sorete","trola","trolo","gil","gila","pajero","pajera","nabo","naba","salame","bobo","boba","banana","zapallo","pichipe"]),Ce=t=>{let p=v(t).split(/\s+/).filter(Boolean).filter(u=>u.length>1);return p.length===0?!0:p.every(u=>ze.has(u))},Te=t=>{let i=v(t);return i.length<2||i.length>60?!1:_e.some(a=>a.includes(i)||i.includes(a)?!0:P(a,i)&&i.length>=3)};H(()=>{ue.current?.scrollIntoView({behavior:"smooth"})},[E,I]),H(()=>{de.current=E},[E]),H(()=>()=>{U.current=!1},[]);let P=(t,i)=>{if(!i||typeof i!="string"||!t||typeof t!="string")return!1;let a=v(t),p=v(i);if(a.includes(p))return!0;let u=0,w=-1;for(let d of p){let b=a.indexOf(d,w+1);b>-1&&(u++,w=b)}return u/p.length>.75},qe=async(t,i)=>{await new Promise(e=>setTimeout(e,500+Math.random()*500));let a=v(t),p=String(t||"").trim(),u=Se(a),w=S.current;w&&Date.now()-(w.ts||0)>3e5&&(S.current=null);let d=e=>{S.current={...e,ts:Date.now()}},b=()=>{S.current=null};if(a.length<=1)return S.current?{text:"No entendÃ­ bien, Â¿podÃ©s escribir un poco mÃ¡s?"}:{text:"Te leÃ­, pero me falta info ðŸ˜Š. Â¿QuÃ© estÃ¡s buscando? (ej: 'auriculares', 'zapatillas', 'envÃ­o', 'pagos')"};if(Ce(t))return{text:"No entendÃ­ eso ðŸ˜…. Â¿En quÃ© puedo ayudarte? PodÃ©s preguntarme por productos, envÃ­o, pagos o cupones."};if(a.match(/\b(gracias|gracia|muchas gracias|thx|thanks)\b/)&&a.length<40)return b(),{text:"Â¡De nada! Si necesitÃ¡s algo mÃ¡s, acÃ¡ estoy ðŸ˜Š"};if(a.match(/\b(chau|adios|bye|nos vemos|hasta luego)\b/)&&a.length<30)return b(),{text:"Â¡Hasta la prÃ³xima! ðŸ‘‹ Cuando quieras, estoy acÃ¡."};if(a.match(/\b(hola|holas|buen dia|buenos dias|buenas tardes|buenas noches|buenas|hello|hi|hey|que tal|como estas|como va|todo bien)\b/)&&a.length<40)return b(),{text:"Â¡Hola! ðŸ‘‹ Â¿QuÃ© querÃ©s hacer? PodÃ©s pedirme productos, ofertas, cupones, envÃ­o, pagos o que agregue algo al carrito."};if(a.match(/\b(quien sos|que sos|que haces|sos real|sos un bot|asistente)\b/))return{text:`Soy SustIA${n?.storeName?` de **${n.storeName}**`:""}. Puedo ayudarte a encontrar productos, ver ofertas/cupones y armar el carrito mÃ¡s rÃ¡pido.`};if(_){if(a.match(/modo\s*(?:oscuro|noche|dark)/))return _.setDarkMode(!0),{text:"He activado el modo oscuro ðŸŒ™"};if(a.match(/modo\s*(?:claro|dia|light)/))return _.setDarkMode(!1),{text:"He activado el modo claro â˜€ï¸"};if(a.match(/(?:ver|abrir|ir al)\s*(?:carrito|bolsa|cesta)/))return _.openCart(),{text:"Abriendo tu carrito ðŸ›’"}}let T=!!a.match(/\b(envio|envios|entrega|delivery|domicilio|retiro|retirar|pickup|como llega|cuando llega|hacen envios|mandan)\b/),F=!!a.match(/\b(pago|pagos|tarjeta|mercado\s*pago|transferencia|cbu|alias|efectivo|como pago|formas? de pago|metodos? de pago)\b/),me=!!a.match(/\b(descuento|descuentos|promo|promos|cupon|cupones|oferta|ofertas|codigo|rebaja|rebajas)\b/),pe=!!a.match(/\b(categorias|categoria|rubros|rubro|secciones)\b/),he=!!a.match(/\b(ayuda|soporte|contacto|human|persona|asesor|whatsapp)\b/),fe=!!a.match(/\b(quienes somos|about)\b/)||!!a.match(/\b(sobre|informacion)\b/)&&!a.match(/\bsobre\s+(un|el|la|este|esta|ese|esa|esto)\b/),Ee=T||F||me||pe||he||fe;if(S.current&&!Ee){let e=S.current,s=!!a.match(/\b(si|sip|sep|claro|dale|bueno|yes|por favor|obvio|ok|sale|va|vamos|manda|quiero|mostrame|show)\b/),m=!!a.match(/\b(no|nah|paso|cancelar|nada|asi esta bien|despues|luego|no gracias|esta bien asi)\b/);if(e.action==="asked_location"){let c=p;if(!Te(c))return{text:"No reconozco esa ubicaciÃ³n ðŸ¤”. Decime tu ciudad o provincia de Argentina (ej: *CÃ³rdoba*, *Rosario*, *CABA*, *Mar del Plata*)."};b();let{deliveryEnabled:f,pickupEnabled:l,deliveryFee:y,freeAbove:r,pickupAddress:h}=e.data||{},x=v(h),g=v(c),te=x&&(x.includes(g)||g.includes((x.split(",")[0]||"").trim())),N=[`ðŸ“ Para **${c}**:`];if(l&&te?N.push(`âœ… PodÃ©s retirar en nuestro local: **${h}**.`):l&&N.push(`ðŸª Tenemos retiro en local en **${h||"direcciÃ³n a coordinar"}**, pero queda en otra zona.`),f){let W=y>0?`$${y.toLocaleString()}`:"sin costo";N.push(`ðŸšš Hacemos envÃ­os a domicilio (${W}${r>0?`, gratis superando $${r.toLocaleString()}`:""}).`),N.push(`Para confirmar costo exacto a ${c}, avanzÃ¡ al checkout o consultanos.`)}return!l&&!f&&N.push("TodavÃ­a no tenemos envÃ­o configurado. Consultanos para coordinar."),n?.whatsappLink&&N.push(`
[WSP_BUTTON]`),N.push(`
Â¿NecesitÃ¡s algo mÃ¡s? Puedo mostrarte productos, ofertas o medios de pago.`),{text:N.join(`
`)}}if(e.action==="showed_products"&&Array.isArray(e.shownProducts)&&e.shownProducts.length>0){let c=e.shownProducts,f=[{p:/\b(primero|primer|1ro|1ero|1Â°)\b/,i:0},{p:/\b(segundo|2do|2Â°)\b/,i:1},{p:/\b(tercero|tercer|3ro|3ero|3Â°)\b/,i:2},{p:/\b(cuarto|4to|4Â°)\b/,i:3},{p:/\b(ultimo|quinto|5to|5Â°)\b/,i:c.length-1}],l=null;for(let r of f)if(a.match(r.p)&&c[r.i]){l=c[r.i];break}if(!l&&a.match(/\b(ese|este|eso|esto)\b/)&&(l=c[0]),!l){let r=a.match(/\b(?:el|la|n[uÃº]mero)\s*(\d)\b/);r&&c[parseInt(r[1],10)-1]&&(l=c[parseInt(r[1],10)-1])}if(!l&&a.length>3&&(l=c.find(r=>{let h=v(r.name);return h.includes(a)||a.includes(h.split(" ")[0])})),!!a.match(/\b(agrega|agregar|agregame|agregalo|sum[aÃ¡]|sumale|pone|poner|met[eÃ©]|comprar|compralo|quiero|dame|llevo|lo quiero|al carrito|sumalo|mandalo)\b/)){let r=l||c[0];k(r,u);let h=c.filter(x=>x.id!==r.id).slice(0,3);return h.length>0?(d({action:"asked_yes_no",subAction:"cross_sell",data:h,shownProducts:h}),{text:`Â¡Listo! AgreguÃ© **${u}x ${r.name}** al carrito ðŸ›’

Â¿QuerÃ©s ver algo mÃ¡s para complementar?`,products:[r]}):(b(),{text:`Â¡Listo! AgreguÃ© **${u}x ${r.name}** al carrito ðŸ›’ Â¿Algo mÃ¡s?`,products:[r]})}if(l&&a.match(/\b(info|detalle|detalles|especif|descrip|cuenta|contame|mas sobre)\b/)){let r=l,h=$(r),x=C(r),g=[`ðŸ“¦ **${r.name}**`,`ðŸ’° $${Math.round(h).toLocaleString()}${(r.discount||0)>0?` (${r.discount}% OFF)`:""}`];return r.description&&g.push(`ðŸ“ ${String(r.description).slice(0,200)}`),x.length>0&&g.push(`ðŸ·ï¸ ${x.join(", ")}`),g.push(`ðŸ“Š Stock: ${r.stock||0} unidades`),g.push(`
Â¿Lo agregamos al carrito?`),d({action:"asked_yes_no",subAction:"add_product",data:r,shownProducts:c}),{text:g.join(`
`),products:[r]}}if(l){let r=l,h=$(r);return d({action:"asked_yes_no",subAction:"add_product",data:r,shownProducts:c}),{text:`**${r.name}** â€” $${Math.round(h).toLocaleString()}${(r.discount||0)>0?` (${r.discount}% OFF)`:""}

Â¿Lo agrego al carrito?`,products:[r]}}if(a.match(/\b(barato|economico|baratos|economicos|menor precio)\b/)){let r=[...c].sort((h,x)=>$(h)-$(x));return d({action:"showed_products",shownProducts:r,searchKeywords:e.searchKeywords}),{text:"Ordenados de mÃ¡s econÃ³mico a mÃ¡s caro:",products:r}}if(a.match(/\b(caro|caros|premium|mejor calidad|top|mejor)\b/)){let r=[...c].sort((h,x)=>$(x)-$(h));return d({action:"showed_products",shownProducts:r,searchKeywords:e.searchKeywords}),{text:"Las opciones de mayor precio/calidad:",products:r}}if(a.match(/\b(otro|otros|otras|mas opciones|ver mas|siguiente|siguientes|que mas hay|hay mas)\b/)){let r=new Set(c.map(g=>g.id)),h=A.filter(g=>!r.has(g.id)&&(Number(g.stock)||0)>0&&g.isActive!==!1);if(Array.isArray(e.searchKeywords)&&e.searchKeywords.length>0){let g=h.filter(te=>{let N=v(te.name);return e.searchKeywords.some(W=>N.includes(W)||P(N,W))});g.length>0&&(h=g)}let x=h.slice(0,5);return x.length>0?(d({action:"showed_products",shownProducts:x,searchKeywords:e.searchKeywords}),{text:"MÃ¡s opciones:",products:x}):{text:"No tengo mÃ¡s opciones con ese criterio. Â¿QuerÃ©s buscar otra cosa?"}}}if(e.action==="asked_yes_no"){if(s){if(b(),e.subAction==="cross_sell"&&Array.isArray(e.data))return{text:"Â¡MirÃ¡ estas opciones! ðŸ”¥",products:e.data};if(e.subAction==="show_deals"&&Array.isArray(e.data))return{text:"Las mejores ofertas ahora mismo:",products:e.data};if(e.subAction==="add_product"&&e.data)return k(e.data,u),{text:`Â¡Listo! AgreguÃ© **${u}x ${e.data.name}** al carrito ðŸ›’ Â¿Algo mÃ¡s?`,products:[e.data]}}if(m)return b(),{text:"Perfecto. Â¿NecesitÃ¡s algo mÃ¡s? ðŸ˜Š"}}if(e.action==="asked_category"){let f=[...new Set([...Array.isArray(n?.categories)?n.categories:[],...A.flatMap(l=>C(l))])].find(l=>P(v(l),a)||P(a,v(l)));if(f){let l=A.filter(y=>(Number(y.stock)||0)>0&&y.isActive!==!1&&C(y).some(r=>r.toLowerCase()===f.toLowerCase())).slice(0,5);return l.length>0?(d({action:"showed_products",shownProducts:l,searchKeywords:[]}),{text:`Productos en **${f}**:`,products:l}):{text:`No hay productos disponibles en "${f}" ahora. Â¿Buscamos otra categorÃ­a?`}}}}if(pe){let e=[...new Set(A.flatMap(m=>C(m)))],s=[...new Set([...Array.isArray(n?.categories)?n.categories:[],...e])].map(m=>String(m).trim()).filter(Boolean);return s.length===0?{text:"TodavÃ­a no tengo categorÃ­as configuradas. Decime quÃ© estÃ¡s buscando y lo resuelvo igual."}:(d({action:"asked_category"}),{text:`Tenemos estas categorÃ­as:

${s.slice(0,10).map(m=>`- ${m}`).join(`
`)}

Decime cuÃ¡l te interesa y te muestro opciones.`})}if(fe){let e=n?.aboutUsText||"";return e.trim()?{text:e.trim()}:{text:"Esta tienda todavÃ­a no cargÃ³ su secciÃ³n â€œSobre nosotrosâ€. Â¿QuerÃ©s que te ayude a encontrar un producto?"}}if(T){let e=!!n?.shippingDelivery?.enabled,s=!!n?.shippingPickup?.enabled,m=Number(n?.shippingDelivery?.fee)||0,c=Number(n?.shippingDelivery?.freeAbove)||0,f=n?.shippingPickup?.address||"",l=[];return s&&l.push(`ðŸ“ Retiro en local: ${f?`**${f}**`:"a coordinar"}.`),e&&(c>0?l.push(`ðŸšš EnvÃ­o a domicilio: $${m.toLocaleString()} (gratis desde $${c.toLocaleString()}).`):l.push(`ðŸšš EnvÃ­o a domicilio: $${m.toLocaleString()}.`)),!s&&!e&&l.push("TodavÃ­a no tengo configurado el mÃ©todo de entrega."),l.push("Si me decÃ­s tu ciudad/zona, te digo lo mejor para vos."),d({action:"asked_location",data:{deliveryEnabled:e,pickupEnabled:s,deliveryFee:m,freeAbove:c,pickupAddress:f}}),{text:l.join(`
`)}}if(F){let e=!!n?.paymentMercadoPago?.enabled,s=!!n?.paymentTransfer?.enabled,m=!!n?.paymentCash&&!!n?.shippingPickup?.enabled,c=s&&a.match(/\b(alias|cbu|transferencia)\b/),f=[];if(e&&f.push("ðŸ’³ Tarjeta (Mercado Pago)"),s&&f.push("ðŸ¦ Transferencia"),m&&f.push("ðŸ’µ Efectivo (solo retiro en local)"),f.length===0)return{text:"TodavÃ­a no tengo mÃ©todos de pago configurados."};if(c){let l=n?.paymentTransfer?.holderName?String(n.paymentTransfer.holderName).trim():"",y=n?.paymentTransfer?.alias?String(n.paymentTransfer.alias).trim():"",r=n?.paymentTransfer?.cbu?String(n.paymentTransfer.cbu).trim():"",h=["Para transferir, usÃ¡ estos datos:"];return l&&h.push(`- Titular: ${l}`),y&&h.push(`- Alias: ${y}`),r&&h.push(`- CBU: ${r}`),!l&&!y&&!r&&h.push("- AÃºn no estÃ¡n cargados los datos."),{text:h.join(`
`)}}return{text:`PodÃ©s pagar con:

${f.map(l=>`- ${l}`).join(`
`)}

Â¿Con cuÃ¡l preferÃ­s?`}}if(he)return n?.whatsappLink?{text:`Claro. Si necesitas asistencia personalizada ðŸ§‘â€ðŸ’», escribinos por WhatsApp ðŸ“²

[WSP_BUTTON]`}:{text:"Estoy diseÃ±ado para ayudarte las 24hs ðŸ¤–. Â¿BuscÃ¡s algo en especÃ­fico?"};if(me){let e=ke.filter(m=>{if(!m?.code)return!1;let c=!m.expirationDate||new Date(m.expirationDate)>new Date,f=Array.isArray(m.usedBy)?m.usedBy.length:0,l=!m.usageLimit||f<m.usageLimit;return c&&l}),s=A.filter(m=>(Number(m?.discount)||0)>0&&(Number(m?.stock)||0)>0);return e.length>0?{text:`Â¡SÃ­! Tenemos estos cupones:

${e.map(c=>`ðŸŽ« **${c.code}** (${c.type==="percentage"?c.value+"%":"$"+c.value} OFF)`).join(`
`)}

Â¡Usalos al finalizar tu compra! ðŸ›’`}:s.length>0?(d({action:"asked_yes_no",subAction:"show_deals",data:s.sort(()=>.5-Math.random()).slice(0,5)}),{text:`No tengo cupones activos, pero hay **${s.length}** productos con descuento. Â¿QuerÃ©s verlos? ðŸ·ï¸`}):{text:"No tengo promociones activas ahora, pero nuestros precios son los mejores ðŸ˜‰"}}let R=a.match(/(?:mas|muy|super)\s*(?:barato|economico|bajo)|mas\s*economico/),be=a.match(/(?:mas|muy|super)\s*(?:caro|mejor|calidad|top|premium)|costoso|lujo/),ge=a.match(/(?:agrega|agregar|agregame|sum[aÃ¡]|pone|poner|met[eÃ©]|comprar|quiero|dame|carrito|llevo|lo quiero)/),ve=0,ee=1/0,xe=a.match(/(?:menos|menor|bajo)\s*(?:de|a|que)?\s*\$?\s*(\d+(?:[.,]\d+)?)(?:\s*(?:k|mil))?/);if(xe){let e=Z(xe[1],a);e!==null&&(ee=e)}let ae=a.match(/entre\s*\$?\s*(\d+(?:[.,]\d+)?)(?:\s*(?:k|mil))?\s*y\s*\$?\s*(\d+(?:[.,]\d+)?)(?:\s*(?:k|mil))?/);if(ae){let e=Z(ae[1],a),s=Z(ae[2],a);e!==null&&(ve=e),s!==null&&(ee=s)}let oe=[...new Set(A.flatMap(e=>C(e)))].find(e=>P(e,a)||P(a,e)),B=oe?oe.toLowerCase():null,Be=new Map([["celu","celular"],["cel","celular"],["tele","televisor"],["tv","televisor"],["compu","computadora"],["notebook","laptop"],["auris","auriculares"],["zapas","zapatillas"],["remera","camiseta"],["remeras","camisetas"],["funda","funda"],["cable","cable"],["cargador","cargador"],["protector","protector"],["vidrio","vidrio templado"]]),D=$e(a).flatMap(e=>{let s=Be.get(e);return s?[e,s]:[e]});if(D.length===0&&!B&&!R&&!be&&!ge){let e=A.filter(s=>(Number(s.stock)||0)>0&&s.isActive!==!1).find(s=>P(v(s.name),a));return e?(d({action:"showed_products",shownProducts:[e],searchKeywords:[a]}),{text:"Â¿BuscÃ¡s esto?",products:[e]}):{text:"Â¿Me decÃ­s quÃ© producto o categorÃ­a querÃ©s ver? TambiÃ©n podÃ©s preguntar por envÃ­o, pagos o cupones."}}let K=A.filter(e=>(Number(e?.stock)||0)>0&&e?.isActive!==!1);K=K.filter(e=>{let s=$(e);return s>=ve&&s<=ee}),B&&(K=K.filter(e=>C(e).some(s=>s.toLowerCase()===B)));let q=K.map(e=>{let s=0,m=v(e.name),c=v(e.description);return D.forEach(f=>{m.includes(f)?s+=10:P(m,f)&&(s+=5),c.includes(f)&&(s+=2)}),B&&!D.length&&(s+=5),e.isFeatured&&(s+=5),e.discount>0&&(s+=3),R&&(s+=1/($(e)||1)*1e4),be&&(s+=$(e)/100),{product:e,score:s}}).filter(e=>e.score>0).sort((e,s)=>s.score-e.score).slice(0,5).map(e=>e.product);if(q.length===0){let e=A.filter(s=>(Number(s.discount)||0)>0&&(Number(s.stock)||0)>0).slice(0,3);return e.length>0?(d({action:"showed_products",shownProducts:e,searchKeywords:D}),{text:"No encontrÃ© eso exactamente, pero mirÃ¡ estas opciones con descuento:",products:e}):{text:"No encontrÃ© lo que buscÃ¡s. ProbÃ¡ con otra palabra o preguntame por categorÃ­as ðŸ”Ž"}}if(ge&&q.length>0){let e=q[0];k(e,u);let s=A.filter(m=>m.id!==e.id&&(Number(m.stock)||0)>0&&m.isActive!==!1).sort(()=>.5-Math.random()).slice(0,3);return s.length>0?(d({action:"asked_yes_no",subAction:"cross_sell",data:s,shownProducts:s}),{text:`Â¡Listo! AgreguÃ© **${u}x ${e.name}** al carrito ðŸ›’

Â¿QuerÃ©s ver algo para complementar? ðŸ‘€`,products:[e]}):(b(),{text:`Â¡Listo! AgreguÃ© **${u}x ${e.name}** al carrito ðŸ›’ Â¿Algo mÃ¡s?`,products:[e]})}d({action:"showed_products",shownProducts:q,searchKeywords:D});let Q="EncontrÃ© estas opciones. Â¿QuerÃ©s que te muestre mÃ¡s o me decÃ­s un presupuesto?";return B&&(Q=`EncontrÃ© esto en **${oe}**:`),R&&(Q="Las opciones mÃ¡s econÃ³micas:"),q.length===1&&(Q="EncontrÃ© esto para vos:"),{text:Q,products:q}},Le=async(t,i)=>{let a=null,p=new Promise((u,w)=>{a=setTimeout(()=>w(new Error("timeout")),i)});try{return await Promise.race([t,p])}finally{a&&clearTimeout(a)}},J=async(t,i={})=>{let a=!!i.alreadyAddedUser,p=String(t||"").trim().slice(0,300);if(!p)return;if(X.current){if(!a){let d={role:"client",text:p};z(b=>[...b,d])}Y.current={text:p,alreadyAddedUser:!0};return}X.current=!0,ie("");let u=a?null:{role:"client",text:p},w=[...de.current||[],...u?[u]:[]];u&&z(d=>[...d,u]),ce(!0);try{let d=await Le(qe(p,w),12e3);if(!U.current)return;let b=d?.text&&typeof d.text=="string"?d.text:"PerdÃ³n, tuve un problema procesando eso. Â¿PodÃ©s reformularlo?",T=Array.isArray(d?.products)?d.products:void 0;z(F=>[...F,{role:"model",text:b,products:T}])}catch{if(!U.current)return;let b=n?.whatsappLink?`Uy, se me trabÃ³ por un momento. Si querÃ©s, hablÃ¡ por WhatsApp:

[WSP_BUTTON]`:"Uy, se me trabÃ³ por un momento. Â¿Probamos de nuevo?";z(T=>[...T,{role:"model",text:b}])}finally{U.current&&ce(!1),X.current=!1;let d=Y.current;d&&d.text&&(Y.current=null,setTimeout(()=>J(d.text,{alreadyAddedUser:d.alreadyAddedUser===!0}),0))}},Me=async()=>J(G),Ie=t=>{let i=String(t||"").trim();i&&J(i)};return o.createElement("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col items-end pointer-events-none"},I&&o.createElement("div",{className:"bg-[#0f0f0f]/95 backdrop-blur-2xl border border-white/10 rounded-[2rem] w-[calc(100vw-2rem)] sm:w-80 md:w-96 h-[min(600px,80dvh)] shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex flex-col mb-4 animate-fade-up overflow-hidden font-sans pointer-events-auto ring-1 ring-white/10 relative mr-0 sm:mr-0"},o.createElement("div",{className:"bg-gradient-to-r from-yellow-500 to-amber-600 p-5 flex justify-between items-center relative z-10"},o.createElement("div",{className:"flex items-center gap-3"},o.createElement("div",{className:"p-1 bg-white/20 rounded-full backdrop-blur-md overflow-hidden border border-white/30"},o.createElement("img",{src:Ne,className:"w-9 h-9 object-cover rounded-full",alt:"SustIA"})),o.createElement("div",null,o.createElement("h3",{className:"font-black text-white text-sm tracking-tight"},"SustIA AI"),o.createElement("p",{className:"text-[10px] text-white/90 font-bold flex items-center gap-1.5"},o.createElement("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-[0_0_8px_rgba(74,222,128,0.8)]"}),"En lÃ­nea"))),o.createElement("div",{className:"flex items-center gap-1"},o.createElement("button",{onClick:()=>{try{localStorage.removeItem(Ae)}catch{}S.current=null,z([ne])},className:"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors",title:"Limpiar chat"},o.createElement(Ke,{className:"w-5 h-5"})),o.createElement("button",{onClick:()=>re(!1),className:"text-white/80 hover:text-white p-2 hover:bg-white/10 rounded-full transition-colors",title:"Cerrar"},o.createElement(we,{className:"w-5 h-5"})))),o.createElement("div",{className:`px-4 py-2 border-b ${V?"bg-[#111] border-white/5":"bg-slate-50 border-slate-200"}`},o.createElement("div",{className:"flex gap-2 overflow-x-auto pb-1 custom-scrollbar"},[{label:"Ofertas",value:"Mostrame ofertas"},{label:"Cupones",value:"TenÃ©s cupones?"},{label:"EnvÃ­o",value:"CÃ³mo es el envÃ­o?"},{label:"Pagos",value:"QuÃ© medios de pago hay?"},{label:"CategorÃ­as",value:"QuÃ© categorÃ­as tenÃ©s?"},{label:"WhatsApp",value:"Necesito hablar con una persona"}].map(t=>o.createElement("button",{key:t.label,type:"button","data-testid":`quick-action-${t.label.toLowerCase()}`,onClick:()=>{Ie(t.value)},className:V?"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-white/10 bg-[#1a1a1a] text-white hover:bg-[#222] transition":"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-slate-200 bg-white text-slate-800 hover:bg-slate-50 transition"},o.createElement("span",{className:V?"text-white":"text-slate-800"},t.label))))),o.createElement("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 bg-[#0a0a0a]/50 custom-scrollbar relative"},E.map((t,i)=>o.createElement("div",{key:i,className:`flex flex-col ${t.role==="client"?"items-end":"items-start"} animate-fade-in`},o.createElement("div",{className:`max-w-[85%] p-4 rounded-2xl text-[13px] leading-relaxed shadow-lg ${t.role==="client"?"bg-gradient-to-br from-yellow-500 to-amber-600 text-white rounded-tr-none border border-white/10":"bg-[#1a1a1a] text-slate-200 rounded-tl-none border border-white/5"}`},t.text&&t.text.includes("[WSP_BUTTON]")?o.createElement(o.Fragment,null,t.text.split("[WSP_BUTTON]").map((a,p,u)=>o.createElement(o.Fragment,{key:p},a&&o.createElement("p",{className:"whitespace-pre-wrap"},a),p<u.length-1&&n?.whatsappLink&&o.createElement("a",{href:n.whatsappLink,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 mt-2 mb-1 px-4 py-2 bg-green-600 hover:bg-green-500 text-white text-xs font-bold rounded-full transition shadow-lg shadow-green-900/30"},o.createElement("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor"},o.createElement("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})),"Ir a WhatsApp")))):o.createElement("p",{className:"whitespace-pre-wrap"},t.text)),t.products&&t.products.length>0&&o.createElement("div",{className:"mt-3 flex gap-3 overflow-x-auto pb-2 w-full custom-scrollbar pl-1 snap-x"},t.products.map(a=>o.createElement(Ue,{key:a.id,product:a,onAdd:(p,u)=>{k(p,u),z(w=>[...w,{role:"model",text:`Agregado ${u}x ${p.name} al carrito! ðŸ›’`}])}}))))),le&&o.createElement("div",{className:"flex justify-start"},o.createElement("div",{className:"bg-[#1a1a1a] p-3 rounded-2xl rounded-bl-none border border-white/5 flex gap-1"},o.createElement("span",{className:"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce"}),o.createElement("span",{className:"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),o.createElement("span",{className:"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}))),o.createElement("div",{ref:ue})),o.createElement("div",{className:"p-3 bg-[#0a0a0a] border-t border-white/10 relative z-0"},o.createElement("form",{onSubmit:t=>{t.preventDefault(),Me()},className:"flex gap-2 items-center"},o.createElement("input",{className:"flex-1 bg-[#1a1a1a] border border-white/10 rounded-full px-4 py-2.5 text-sm text-white focus:border-yellow-500/50 outline-none transition placeholder:text-slate-600",placeholder:"Escribe aquÃ­...",value:G,onChange:t=>ie(t.target.value)}),o.createElement("button",{type:"submit",className:"p-2.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full transition shadow-lg shadow-yellow-600/20 disabled:opacity-50 disabled:cursor-not-allowed",disabled:le||!G.trim()},o.createElement(De,{className:"w-4 h-4"}))))),o.createElement("button",{onClick:()=>re(!I),className:"pointer-events-auto w-14 h-14 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(234,179,8,0.4)] hover:scale-110 transition-transform group relative z-50"},I?o.createElement(we,{className:"w-6 h-6 text-white"}):o.createElement("div",{className:"w-full h-full p-1"},o.createElement("img",{src:"sustia-ai-v2.jpg",className:"w-full h-full object-cover rounded-full opacity-95 group-hover:scale-110 transition-transform duration-300",alt:"SustIA"})),!I&&o.createElement("span",{className:"absolute -top-1 -right-1 flex h-4 w-4"},o.createElement("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),o.createElement("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-yellow-500 border border-black"}))))},(n,j)=>!(n.settings?.subscriptionPlan!==j.settings?.subscriptionPlan||n.products!==j.products)),aa=Fe;export{aa as default};
//# sourceMappingURL=SustIABot-SCXYV562.js.map
