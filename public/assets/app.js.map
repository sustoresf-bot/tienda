{
  "version": 3,
  "sources": ["../script.js"],
  "sourcesContent": ["\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFFimport React, { useState, useEffect, useRef, useMemo, useCallback, Suspense, lazy } from 'react';\nimport { createRoot } from 'react-dom/client';\n\n// Lazy loaded components for code splitting\nconst SustIABot = lazy(() => import('./components/SustIABot.js'));\nconst AdminPanel = lazy(() => import('./components/AdminPanel.js'));\nconst CheckoutPanel = lazy(() => import('./components/CheckoutPanel.js'));\nimport {\n    ShoppingBag, X, User, Search, Zap, CheckCircle, MessageCircle, Instagram, Minus, Heart, Tag,\n    Plus, Trash2, Edit, AlertTriangle, RefreshCw, Bot, Send, LogIn, LogOut, Mail, CreditCard, Menu, Home,\n    Info, FileQuestion, Users, Package, LayoutDashboard, Settings, Ticket, Truck, PieChart, Wallet,\n    FileText, ArrowRight, ArrowLeft, DollarSign, BarChart3, ChevronLeft, ChevronRight, TrendingUp, TrendingDown,\n    Briefcase, Calculator, Save, AlertCircle, Phone, MapPin, Copy, ExternalLink, Shield, Trophy,\n    ShoppingCart, Archive, Play, FolderPlus, Eye, EyeOff, Clock, Calendar, Gift, Lock, Loader2, Star, Percent, Sparkles,\n    Flame, Image as ImageIcon, Filter, ChevronDown, ChevronUp, Store, BarChart, Globe, Headphones, Palette, Share2, Cog, Facebook, Twitter, Linkedin, Youtube, Bell, Music, Building, Banknote, Smartphone, UserPlus, Maximize2, Settings2, Sun, Moon, Upload\n} from 'lucide-react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, sendPasswordResetEmail, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'firebase/auth';\nimport {\n    getFirestore, collection, addDoc, onSnapshot, query, updateDoc, doc, getDocs, deleteDoc,\n    where, writeBatch, getDoc, increment, setDoc, arrayUnion, arrayRemove, orderBy, limit, startAfter\n} from 'firebase/firestore';\n\n// --- CONFIGURACIÓN FIREBASE (PROYECTO: sustore-63266) ---\n// Nota: esta es la configuración pública del SDK web. NO incluyas aquí el JSON de service account.\nconst firebaseConfig = {\n    apiKey: \"AIzaSyAfllte-D_I3h3TwBaiSL4KVfWrCSVh9ro\",\n    authDomain: \"sustore-63266.firebaseapp.com\",\n    projectId: \"sustore-63266\",\n    storageBucket: \"sustore-63266.firebasestorage.app\",\n    messagingSenderId: \"684651914850\",\n    appId: \"1:684651914850:web:f3df09e5caf6e50e9e533b\",\n    measurementId: \"G-X3K7XGYPRD\"\n};\n\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n// ID interno de la app (no es el appId de Firebase). Puedes cambiarlo si quieres diferenciar entornos.\nconst DEFAULT_APP_ID = \"sustore-63266-prod\";\nconst APP_VERSION = \"3.0.0\";\n\nlet mpPublicKeyPromise = null;\nasync function getMercadoPagoPublicKey() {\n    if (mpPublicKeyPromise) return mpPublicKeyPromise;\n    mpPublicKeyPromise = (async () => {\n        try {\n            const res = await fetch('/api/checkout?action=public_config', { method: 'GET' });\n            if (!res.ok) return null;\n            const data = await res.json().catch(() => ({}));\n            const key = String(data?.mpPublicKey || '').trim();\n            return key || null;\n        } catch (e) {\n            return null;\n        }\n    })();\n    return mpPublicKeyPromise;\n}\n\nconst setupSmoothWheelScroll = () => {\n    if (typeof window === 'undefined' || typeof document === 'undefined') return;\n    if (window.__smoothWheelScrollEnabled) return;\n    window.__smoothWheelScrollEnabled = true;\n\n    const reduceMotion = typeof window.matchMedia === 'function' && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    if (reduceMotion) return;\n\n    const getDocumentScrollingElement = () => document.scrollingElement || document.documentElement;\n    const elementStates = new WeakMap();\n\n    const clamp = (value, min, max) => Math.min(max, Math.max(min, value));\n    const maxScrollTopForEl = (el) => Math.max(0, el.scrollHeight - el.clientHeight);\n\n    const isScrollable = (el) => {\n        if (!el || !(el instanceof Element)) return false;\n        const style = window.getComputedStyle(el);\n        const overflowY = style.overflowY;\n        if (overflowY === 'hidden' || overflowY === 'visible') return false;\n        return el.scrollHeight > el.clientHeight + 1;\n    };\n\n    const findScrollableAncestor = (startEl) => {\n        let el = startEl;\n        while (el && el instanceof Element && el !== document.body && el !== document.documentElement) {\n            if (isScrollable(el)) return el;\n            el = el.parentElement;\n        }\n        return null;\n    };\n\n    const getState = (el) => {\n        const existing = elementStates.get(el);\n        if (existing) return existing;\n        const state = { rafId: null, velocity: 0, lastTs: 0 };\n        elementStates.set(el, state);\n        return state;\n    };\n\n    const animateElement = (el, ts) => {\n        const state = getState(el);\n        if (!state.lastTs) state.lastTs = ts;\n        const dt = Math.min(48, ts - state.lastTs);\n        state.lastTs = ts;\n\n        const frictionPerFrame = 0.86;\n        const friction = Math.pow(frictionPerFrame, dt / 16.67);\n\n        const current = el.scrollTop;\n        const next = clamp(current + state.velocity * (dt / 16.67), 0, maxScrollTopForEl(el));\n        el.scrollTop = next;\n\n        if (next === 0 || next === maxScrollTopForEl(el)) {\n            state.velocity *= 0.5;\n        }\n\n        state.velocity *= friction;\n\n        if (Math.abs(state.velocity) < 0.1) {\n            state.rafId = null;\n            state.velocity = 0;\n            state.lastTs = 0;\n            return;\n        }\n\n        state.rafId = window.requestAnimationFrame((nextTs) => animateElement(el, nextTs));\n    };\n\n    const onWheel = (e) => {\n        if (e.defaultPrevented) return;\n        if (e.ctrlKey || e.metaKey || e.shiftKey) return;\n        const targetEl = e.target instanceof Element ? e.target : null;\n        const scrollEl = (targetEl && findScrollableAncestor(targetEl)) || getDocumentScrollingElement();\n\n        const deltaX = e.deltaX;\n        let deltaY = e.deltaY;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) return;\n        if (!Number.isFinite(deltaY) || Math.abs(deltaY) < 0.01) return;\n\n        e.preventDefault();\n\n        if (e.deltaMode === 1) deltaY *= 40;\n        else if (e.deltaMode === 2) deltaY *= window.innerHeight;\n\n        const state = getState(scrollEl);\n        const strength = 0.9;\n        state.velocity += deltaY * strength;\n        state.velocity = clamp(state.velocity, -4500, 4500);\n        if (state.rafId === null) state.rafId = window.requestAnimationFrame((ts) => animateElement(scrollEl, ts));\n    };\n\n    const onResize = () => {\n        const docEl = getDocumentScrollingElement();\n        const state = getState(docEl);\n        state.velocity = clamp(state.velocity, -4500, 4500);\n    };\n\n    document.addEventListener('wheel', onWheel, { passive: false, capture: true });\n    window.addEventListener('resize', onResize, { passive: true });\n};\n\ntry { setupSmoothWheelScroll(); } catch (e) { }\n\n// === SEGURIDAD: Email de Super Admin ofuscado (múltiples capas) ===\nconst _sa = ['bGF1dGFyb2NvcmF6emE2M0BnbWFpbC5jb20=']; // Base64\nconst SUPER_ADMIN_EMAIL = (() => { try { return atob(_sa[0]); } catch (e) { return ''; } })();\n\n// === SEGURIDAD: Sistema Anti-Manipulación Avanzado ===\nconst SecurityManager = {\n    sessionToken: null,\n    loginAttempts: {},\n    maxAttempts: 5,\n    lockoutTime: 300000, // 5 minutos\n    integrityChecks: {},\n\n    // Salt dinámico basado en timestamp (más seguro que salt fijo)\n    _generateSalt() {\n        const base = 'tienda_secure_2024';\n        const timestamp = Math.floor(Date.now() / 86400000); // Cambia cada día\n        return base + '_' + timestamp;\n    },\n\n    // Hash seguro para contraseñas (SHA-256 con salt dinámico)\n    async hashPassword(password) {\n        const encoder = new TextEncoder();\n        const salt = this._generateSalt();\n        const data = encoder.encode(password + salt);\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n    },\n\n    // Verificar contraseña hasheada\n    async verifyPassword(password, hash) {\n        const inputHash = await this.hashPassword(password);\n        return inputHash === hash;\n    },\n\n    // Rate limiting mejorado para login\n    canAttemptLogin(email) {\n        const key = this._hashKey(email.toLowerCase());\n        const now = Date.now();\n        const record = this.loginAttempts[key];\n\n        if (record && record.lockedUntil > now) {\n            return { allowed: false, remainingTime: Math.ceil((record.lockedUntil - now) / 1000) };\n        }\n\n        if (record && record.lockedUntil && record.lockedUntil < now) {\n            delete this.loginAttempts[key];\n        }\n\n        return { allowed: true };\n    },\n\n    // Hash de claves para no exponer emails en memoria\n    _hashKey(str) {\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            const char = str.charCodeAt(i);\n            hash = ((hash << 5) - hash) + char;\n            hash = hash & hash;\n        }\n        return 'k_' + Math.abs(hash).toString(36);\n    },\n\n    // Registrar intento fallido\n    recordFailedAttempt(email) {\n        const key = this._hashKey(email.toLowerCase());\n        if (!this.loginAttempts[key]) {\n            this.loginAttempts[key] = { count: 0, firstAttempt: Date.now() };\n        }\n        this.loginAttempts[key].count++;\n\n        if (this.loginAttempts[key].count >= this.maxAttempts) {\n            this.loginAttempts[key].lockedUntil = Date.now() + this.lockoutTime;\n            // Log seguro sin exponer email\n            console.warn('[Security] Account locked - too many failed attempts');\n        }\n    },\n\n    // Limpiar intentos después de login exitoso\n    clearAttempts(email) {\n        const key = this._hashKey(email.toLowerCase());\n        delete this.loginAttempts[key];\n    },\n\n    // Generar token de sesión con firma criptográfica\n    generateSessionToken(userId) {\n        const payload = {\n            uid: userId,\n            iat: Date.now(),\n            exp: Date.now() + 86400000, // 24 horas\n            nonce: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)\n        };\n        const token = btoa(JSON.stringify(payload));\n        const signature = this._signToken(token);\n        const fullToken = token + '.' + signature;\n        this.sessionToken = fullToken;\n        sessionStorage.setItem('_st', fullToken);\n        return fullToken;\n    },\n\n    // Firma simple del token\n    _signToken(token) {\n        let hash = 0;\n        const secret = 'tienda_secret_key_2024';\n        const toSign = token + secret;\n        for (let i = 0; i < toSign.length; i++) {\n            hash = ((hash << 5) - hash) + toSign.charCodeAt(i);\n            hash = hash & hash;\n        }\n        return Math.abs(hash).toString(36);\n    },\n\n    // Verificar token de sesión con validación de expiración\n    verifySession() {\n        const stored = sessionStorage.getItem('_st');\n        if (!stored || stored !== this.sessionToken) return false;\n\n        try {\n            const [payloadB64] = stored.split('.');\n            const payload = JSON.parse(atob(payloadB64));\n            // Verificar expiración\n            if (payload.exp && payload.exp < Date.now()) {\n                this.invalidateSession();\n                return false;\n            }\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    // Invalidar sesión\n    invalidateSession() {\n        this.sessionToken = null;\n        sessionStorage.removeItem('_st');\n        localStorage.removeItem('sustore_user_data');\n    },\n\n    // Detectar manipulación de React DevTools\n    detectManipulation() {\n        const stored = localStorage.getItem('sustore_user_data');\n        if (stored) {\n            try {\n                const userData = JSON.parse(stored);\n                // Verificar estructura válida\n                if (!userData.id || userData.id.length < 10 ||\n                    !userData.email || !userData.email.includes('@')) {\n                    console.warn('[Security] Invalid session data detected');\n                    localStorage.removeItem('sustore_user_data');\n                    return true;\n                }\n                // Verificar que el rol no fue manipulado a admin ilegalmente\n                if (userData.role === 'admin' && !this._validateAdminClaim(userData)) {\n                    console.warn('[Security] Admin role manipulation detected');\n                    userData.role = 'user';\n                    localStorage.setItem('sustore_user_data', JSON.stringify(userData));\n                    return true;\n                }\n            } catch (e) {\n                localStorage.removeItem('sustore_user_data');\n                return true;\n            }\n        }\n        return false;\n    },\n\n    // Validar claim de admin (requiere verificación del servidor)\n    _validateAdminClaim(userData) {\n        // 1. Permitir siempre al Super Admin (Hardcoded)\n        if (userData.email === SUPER_ADMIN_EMAIL) return true;\n\n        // 2. Permitir si tiene la flag de verificación (seteada al loguear/cargar desde DB)\n        return userData._adminVerified === true;\n    },\n\n    // Sanitizar entrada del usuario (Anti-XSS)\n    sanitizeInput(input) {\n        if (typeof input !== 'string') return input;\n        return input\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#x27;')\n            .replace(/\\//g, '&#x2F;')\n            .replace(/javascript:/gi, '')\n            .replace(/on\\w+=/gi, '');\n    },\n\n    // Validar email\n    isValidEmail(email) {\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return emailRegex.test(email) && email.length <= 254;\n    },\n\n    // Validar fortaleza de contraseña\n    isStrongPassword(password) {\n        return password.length >= 8 &&\n            /[A-Z]/.test(password) &&\n            /[a-z]/.test(password) &&\n            /[0-9]/.test(password);\n    },\n\n    // Protección contra ataques de timing\n    async secureCompare(a, b) {\n        if (typeof a !== 'string' || typeof b !== 'string') return false;\n        const encoder = new TextEncoder();\n        const aBytes = encoder.encode(a);\n        const bBytes = encoder.encode(b);\n        if (aBytes.length !== bBytes.length) return false;\n\n        let result = 0;\n        for (let i = 0; i < aBytes.length; i++) {\n            result |= aBytes[i] ^ bBytes[i];\n        }\n        return result === 0;\n    },\n\n    // Bloquear acceso a consola en producción (anti-debugging)\n    protectConsole() {\n        if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('127.0.0.1')) {\n            // Desactivar console.log en producción para no exponer info\n            const noop = () => { };\n            ['log', 'debug', 'info', 'table', 'dir'].forEach(method => {\n                console[method] = noop;\n            });\n            // Mantener warn y error para debugging crítico\n        }\n    },\n\n    // Detectar DevTools abierto\n    detectDevTools() {\n        const threshold = 160;\n        const check = () => {\n            const widthDiff = window.outerWidth - window.innerWidth > threshold;\n            const heightDiff = window.outerHeight - window.innerHeight > threshold;\n            if (widthDiff || heightDiff) {\n                // DevTools detectado - no hacer nada visible pero loguear\n                // console.warn('[Security] DevTools detected');\n            }\n        };\n        // Verificar periódicamente\n        setInterval(check, 5000);\n    },\n\n    // Inicializar todas las protecciones\n    init() {\n        this.detectManipulation();\n        this.protectConsole();\n        this.detectDevTools();\n\n        // Limpiar datos sensibles de window\n        Object.defineProperty(window, 'SUPER_ADMIN_EMAIL', {\n            get: () => undefined,\n            configurable: false\n        });\n    }\n};\n\n// Inicializar protecciones de seguridad\nSecurityManager.init();\n\n// Configuración por defecto\nconst defaultSettings = {\n    // --- Identidad de la Tienda ---\n    storeName: \"Tienda Online\",\n    primaryColor: \"#f97316\",\n    currency: \"$\",\n\n    ticket: {\n        brandName: \"\",\n        whatsappLink: \"\",\n        siteUrl: \"\"\n    },\n\n    // --- Administración ---\n    admins: SUPER_ADMIN_EMAIL,\n    team: [{ email: SUPER_ADMIN_EMAIL, role: \"admin\", name: \"Administrador\" }],\n\n    // --- Contacto ---\n    sellerEmail: \"\",\n    instagramUser: \"\",\n    instagramLink: \"\",\n    whatsappLink: \"\",\n    showWhatsapp: false,\n    showFloatingWhatsapp: false,\n    showCartWhatsappCheckout: false,\n    showInstagram: false,\n\n    paymentTransfer: {\n        enabled: false,\n        holderName: \"\",\n        alias: \"\",\n        cbu: \"\"\n    },\n    paymentCash: false,\n    paymentMercadoPago: {\n        enabled: false\n    },\n\n    // --- Imágenes ---\n    logoUrl: \"\",\n    heroUrl: \"\",\n    showHomeBannerCarousel: true,\n    homeBannerAutoplayMs: 5000,\n\n    // --- Configuración de Tienda ---\n    markupPercentage: 0,\n    announcementMessage: \"\",\n    categories: [\"General\"],\n    aboutUsText: \"Bienvenido a nuestra tienda. Ofrecemos productos de calidad con envío a todo el país.\",\n\n    // --- SEO (Search Engine Optimization) ---\n    seoTitle: \"\",\n    seoDescription: \"Tu tienda online de confianza. Calidad y vanguardia en cada producto. Envíos a todo el país.\",\n    seoKeywords: \"tienda online, productos, comprar, envíos\",\n    seoAuthor: \"\",\n    seoUrl: \"\",\n    seoImage: \"\",\n\n    // --- Textos de Carga ---\n    loadingTitle: \"\",\n    loadingText: \"Cargando sistema...\"\n};\n\n// --- COMPONENTES DE UI ---\n\n// Componente de Imagen con Lazy Loading\nconst LazyImage = ({ src, alt, className, placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhMWExYSIvPjwvc3ZnPg==' }) => {\n    const [isLoaded, setIsLoaded] = useState(false);\n    const [isInView, setIsInView] = useState(false);\n    const imgRef = useRef(null);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            ([entry]) => {\n                if (entry.isIntersecting) {\n                    setIsInView(true);\n                    observer.disconnect();\n                }\n            },\n            { rootMargin: '100px', threshold: 0.1 }\n        );\n\n        if (imgRef.current) {\n            observer.observe(imgRef.current);\n        }\n\n        return () => observer.disconnect();\n    }, []);\n\n    return (\n        <img\n            ref={imgRef}\n            src={isInView ? src : placeholder}\n            alt={alt}\n            className={`${className} transition-opacity duration-300 ${isLoaded ? 'opacity-100' : 'opacity-0'}`}\n            onLoad={() => setIsLoaded(true)}\n            loading=\"lazy\"\n        />\n    );\n};\n\nconst HomeBannerCarouselBackground = ({ settingsLoaded, banners, fallbackUrl, autoplayMs, darkMode, onBannerClick }) => {\n    const slides = useMemo(() => {\n        if (!Array.isArray(banners)) return [];\n        return banners.filter(b => b && b.enabled !== false && typeof b.imageUrl === 'string' && b.imageUrl.trim().length > 0);\n    }, [banners]);\n\n    const [activeIndex, setActiveIndex] = useState(0);\n    const [isPaused, setIsPaused] = useState(false);\n\n    useEffect(() => {\n        if (activeIndex >= slides.length) setActiveIndex(0);\n    }, [activeIndex, slides.length]);\n\n    const effectiveAutoplayMs = Number(autoplayMs);\n    const shouldAutoplay = settingsLoaded && !isPaused && slides.length > 1 && Number.isFinite(effectiveAutoplayMs) && effectiveAutoplayMs >= 1500;\n\n    useEffect(() => {\n        if (!shouldAutoplay) return;\n        const id = setInterval(() => {\n            setActiveIndex(i => (i + 1) % slides.length);\n        }, effectiveAutoplayMs);\n        return () => clearInterval(id);\n    }, [shouldAutoplay, slides.length, effectiveAutoplayMs]);\n\n    useEffect(() => {\n        if (slides.length <= 1) return;\n        const next = slides[(activeIndex + 1) % slides.length];\n        if (!next?.imageUrl) return;\n        const img = new Image();\n        img.src = next.imageUrl;\n    }, [slides, activeIndex]);\n\n    const activeSlide = slides[activeIndex] || null;\n    const hasTarget = (() => {\n        const type = activeSlide?.targetType || (activeSlide?.promoId ? 'promo' : activeSlide?.productId ? 'product' : 'none');\n        const id = activeSlide?.targetId || activeSlide?.promoId || activeSlide?.productId || '';\n        return type !== 'none' && !!id;\n    })();\n    const imageOpacity = 0.85;\n    const imageClass = `w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`;\n\n    const goPrev = () => {\n        setActiveIndex(i => {\n            const next = i - 1;\n            return next < 0 ? slides.length - 1 : next;\n        });\n    };\n\n    const goNext = () => {\n        setActiveIndex(i => (i + 1) % slides.length);\n    };\n\n    if (!settingsLoaded) {\n        return <div className=\"absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 animate-pulse\"></div>;\n    }\n\n    if (slides.length === 0) {\n        return fallbackUrl ? (\n            <img src={fallbackUrl} style={{ opacity: imageOpacity }} className={`absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`} />\n        ) : (\n            <div className={`absolute inset-0 opacity-60 ${darkMode ? 'bg-gradient-to-br from-orange-900/40 via-[#0a0a0a] to-slate-900/40' : 'bg-gradient-to-br from-orange-200/60 via-white to-slate-200/60'}`}>\n                <div className={`absolute inset-0 bg-[url('/noise.svg')] ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className={`absolute inset-0 overflow-hidden ${hasTarget ? 'cursor-pointer' : ''}`}\n            onClick={() => hasTarget && onBannerClick?.(activeSlide)}\n            onMouseEnter={() => setIsPaused(true)}\n            onMouseLeave={() => setIsPaused(false)}\n        >\n            <div\n                className=\"h-full w-full flex transition-transform duration-700 ease-in-out\"\n                style={{ transform: `translate3d(-${activeIndex * 100}%, 0, 0)`, willChange: 'transform' }}\n            >\n                {slides.map((slide, idx) => (\n                    <div key={slide.id || `${idx}-${slide.targetId || slide.productId || slide.promoId || 'slide'}`} className=\"w-full h-full flex-shrink-0 relative\">\n                        <img src={slide.imageUrl} style={{ opacity: imageOpacity }} className={imageClass} />\n                    </div>\n                ))}\n            </div>\n\n            {slides.length > 1 && (\n                <>\n                    <button\n                        type=\"button\"\n                        className=\"absolute left-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goPrev(); }}\n                        aria-label=\"Banner anterior\"\n                    >\n                        <ArrowLeft className=\"w-5 h-5\" />\n                    </button>\n                    <button\n                        type=\"button\"\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goNext(); }}\n                        aria-label=\"Banner siguiente\"\n                    >\n                        <ArrowRight className=\"w-5 h-5\" />\n                    </button>\n                    <div className=\"absolute bottom-4 inset-x-0 z-20 flex items-center justify-center gap-2 pointer-events-auto\" onClick={(e) => e.stopPropagation()}>\n                        {slides.map((_, idx) => (\n                            <button\n                                key={`dot-${idx}`}\n                                type=\"button\"\n                                aria-label={`Ir al banner ${idx + 1}`}\n                                className={`h-2.5 rounded-full transition-all duration-300 ${idx === activeIndex ? 'w-8 bg-white' : 'w-2.5 bg-white/40 hover:bg-white/70'}`}\n                                onClick={() => setActiveIndex(idx)}\n                            />\n                        ))}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n\n// Componente de Notificación (Toast)\nconst Toast = ({ message, type, onClose }) => {\n    let containerClass = \"fixed top-24 right-4 z-[9999] flex items-center gap-4 p-5 rounded-2xl border-l-4 backdrop-blur-xl animate-fade-up shadow-2xl transition-all duration-300\";\n    let iconContainerClass = \"p-2 rounded-full\";\n    let IconComponent = Info;\n\n    if (type === 'success') {\n        containerClass += \" border-green-500 text-green-400 bg-black/90 shadow-[0_0_20px_rgba(34,197,94,0.3)]\";\n        iconContainerClass += \" bg-green-500/20\";\n        IconComponent = CheckCircle;\n    } else if (type === 'error') {\n        containerClass += \" border-red-500 text-red-400 bg-black/90 shadow-[0_0_20px_rgba(239,68,68,0.3)]\";\n        iconContainerClass += \" bg-red-500/20\";\n        IconComponent = AlertCircle;\n    } else if (type === 'warning') {\n        containerClass += \" border-yellow-500 text-yellow-400 bg-black/90 shadow-[0_0_20px_rgba(234,179,8,0.3)]\";\n        iconContainerClass += \" bg-yellow-500/20\";\n        IconComponent = AlertTriangle;\n    } else {\n        containerClass += \" border-orange-500 text-orange-400 bg-black/90 shadow-[0_0_20px_rgba(249,115,22,0.3)]\";\n        iconContainerClass += \" bg-orange-500/20\";\n        IconComponent = Info;\n    }\n\n    useEffect(() => {\n        const t = setTimeout(onClose, 4000);\n        return () => clearTimeout(t);\n    }, [onClose]);\n\n    return (\n        <div className={containerClass}>\n            <div className={iconContainerClass}>\n                <IconComponent className=\"w-5 h-5\" />\n            </div>\n            <div>\n                <p className=\"font-bold text-sm tracking-wide\">{message}</p>\n            </div>\n            <button onClick={onClose} className=\"ml-2 text-white/50 hover:text-white transition\">\n                <X className=\"w-4 h-4\" />\n            </button>\n        </div>\n    );\n};\n\n// Componente Modal de Confirmación\nconst ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = \"Confirmar\", cancelText = \"Cancelar\", isDangerous = false, darkMode = true }) => {\n    if (!isOpen) return null;\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-up p-4\">\n            <div className={`p-8 rounded-[2rem] max-w-sm w-full border transition-all duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 shadow-2xl' : 'bg-white border-slate-200 shadow-xl'} ${isDangerous && darkMode ? 'border-red-500/50 shadow-[0_0_30px_rgba(220,38,38,0.2)]' : isDangerous ? 'border-red-200 shadow-red-100' : ''}`}>\n                <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto transition-colors duration-300 ${isDangerous ? 'bg-red-500/20 text-red-500' : (darkMode ? 'bg-orange-900/20 text-orange-500' : 'bg-orange-50 text-orange-600')}`}>\n                    {isDangerous ? <AlertTriangle className=\"w-8 h-8\" /> : <Info className=\"w-8 h-8\" />}\n                </div>\n                <h3 className={`text-xl font-black text-center mb-2 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{title}</h3>\n                <p className={`text-center mb-8 text-sm leading-relaxed transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{message}</p>\n                <div className=\"flex gap-3\">\n                    <button onClick={onCancel} className={`flex-1 py-3 rounded-xl font-bold transition ${darkMode ? 'bg-slate-800 hover:bg-slate-700 text-slate-300' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}`}>{cancelText}</button>\n                    <button onClick={onConfirm} className={`flex-1 py-3 text-white rounded-xl font-bold transition shadow-lg ${isDangerous ? 'bg-red-600 hover:bg-red-500 shadow-red-600/30' : 'bg-orange-600 hover:bg-orange-500 shadow-orange-600/30'}`}>{confirmText}</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// Error Boundary\nclass ErrorBoundary extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = { hasError: false, error: null, errorInfo: null };\n    }\n    static getDerivedStateFromError(error) { return { hasError: true }; }\n    componentDidCatch(error, errorInfo) {\n        this.setState({ error, errorInfo });\n        console.error(\"Uncaught error:\", error, errorInfo);\n    }\n    render() {\n        if (this.state.hasError) {\n            return (\n                <div className=\"min-h-screen bg-black text-red-500 p-10 font-mono\">\n                    <h1 className=\"text-4xl font-bold mb-4\">CRITICAL SYSTEM FAILURE</h1>\n                    <div className=\"border border-red-900 bg-red-900/10 p-6 rounded-xl overflow-auto\">\n                        <h2 className=\"text-xl font-bold mb-2\">{this.state.error?.toString()}</h2>\n                        <pre className=\"text-xs text-red-400/70 whitespace-pre-wrap\">{this.state.errorInfo?.componentStack}</pre>\n                    </div>\n                    <button onClick={() => window.location.reload()} className=\"mt-8 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-500 font-bold\">REINICIAR SISTEMA</button>\n                </div>\n            );\n        }\n        return this.props.children;\n    }\n}\n\n// Componente Auxiliar para Botón de Agregar Rápido\nconst QuickAddButton = ({ product, onAdd, darkMode }) => {\n    const [qty, setQty] = useState(1);\n    const [added, setAdded] = useState(false);\n\n    const handleAdd = (e) => {\n        e.stopPropagation();\n        onAdd(product, qty);\n        setAdded(true);\n        setTimeout(() => setAdded(false), 2000);\n        setQty(1);\n    };\n\n    const isMax = qty >= product.stock;\n    const isMin = qty <= 1;\n\n    return (\n        <div className=\"flex flex-col items-end gap-2\" onClick={(e) => e.stopPropagation()}>\n            <div className={`flex items-center rounded-lg ${darkMode ? 'bg-zinc-800' : 'bg-slate-100'} p-0.5 border ${darkMode ? 'border-zinc-700' : 'border-slate-200'}`}>\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                    disabled={isMin}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMin ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Minus className=\"w-3 h-3\" /></button>\n\n                <span className={`w-8 text-center text-xs font-bold font-mono ${darkMode ? 'text-white' : 'text-slate-900'}`}>{qty}</span>\n\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.min(product.stock, qty + 1)); }}\n                    disabled={isMax}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMax ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Plus className=\"w-3 h-3\" /></button>\n            </div>\n\n            <button\n                onClick={handleAdd}\n                className={`w-full py-1.5 px-3 rounded-xl transition-all duration-300 shadow-md flex items-center justify-center gap-1.5 active:scale-95 ${added\n                    ? 'bg-green-500 text-white shadow-green-500/30'\n                    : darkMode\n                        ? 'bg-white text-black hover:bg-orange-400 hover:text-black shadow-white/10'\n                        : 'bg-orange-500 text-white hover:bg-orange-600 shadow-orange-500/20'\n                    }`}\n            >\n                {added ? (\n                    <CheckCircle className=\"w-4 h-4\" />\n                ) : (\n                    <>\n                        <Plus className=\"w-5 h-5 md:w-4 md:h-4\" />\n                    </>\n                )}\n            </button>\n        </div>\n    );\n};\n\n// --- COMPONENTE PRODUCT CARD OPTIMIZADO (MEMOIZED) ---\nconst ProductCard = React.memo(({ p, settings, currentUser, toggleFavorite, setSelectedProduct, manageCart, calculateItemPrice, darkMode }) => {\n    // Clases dinámicas basadas en el tema\n    const cardBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const cardBorder = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n    const cardHoverBorder = darkMode ? 'hover:border-orange-500/50' : 'hover:border-orange-400';\n    const cardShadow = darkMode ? 'hover:shadow-[0_0_30px_rgba(249,115,22,0.1)]' : 'shadow-sm hover:shadow-xl hover:shadow-orange-200/50';\n    const imageBg = darkMode ? 'bg-gradient-to-b from-slate-900 to-[#0a0a0a]' : 'bg-gradient-to-b from-slate-100 to-white';\n    const textPrimary = darkMode ? 'text-white' : 'text-slate-900';\n    const textSecondary = darkMode ? 'text-slate-400' : 'text-slate-600';\n    const infoBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const borderColor = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n\n    return (\n        <div className={`${cardBg} rounded-2xl sm:rounded-3xl border ${cardBorder} overflow-hidden group ${cardHoverBorder} ${cardShadow} transition duration-500 relative flex flex-col h-full animate-fade-in content-visibility-auto contain-content`}>\n\n            {/* Imagen y Badges */}\n            <div className={`h-56 sm:h-80 ${imageBg} m-2 sm:m-3 p-2 sm:p-3 flex items-center justify-center relative overflow-hidden cursor-zoom-in transition-all duration-500`} onClick={() => setSelectedProduct(p)}>\n                {/* Efecto Glow Fondo */}\n                <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition duration-500\"></div>\n\n                {p.image ? (\n                    <div className=\"w-full h-full flex items-center justify-center overflow-hidden\">\n                        <img\n                            src={p.image}\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                            onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.nextSibling.style.display = 'flex'; }}\n                            className={`max-w-full max-h-full rounded-xl sm:rounded-2xl border-2 ${darkMode ? 'border-orange-500/20' : 'border-slate-100'} shadow-lg z-10 transition-transform duration-700 group-hover:scale-105 ${p.stock <= 0 ? 'grayscale opacity-50' : ''}`}\n                        />\n                    </div>\n                ) : null}\n\n\n                {/* Botón Ver (Visible en Mobile/Touch) */}\n                <button\n                    onClick={(e) => {\n                        e.stopPropagation();\n                        setSelectedProduct(p);\n                    }}\n                    className={`absolute bottom-2 right-2 sm:bottom-4 sm:right-4 z-30 ${darkMode ? 'bg-black/60 border-white/20' : 'bg-white/90 border-slate-200'} backdrop-blur-md p-2 sm:p-3 rounded-full ${darkMode ? 'text-white' : 'text-slate-700'} border md:hidden`}\n                >\n                    <Maximize2 className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                </button>\n\n                {/* Fallback Icon */}\n                <div className=\"hidden w-full h-full flex items-center justify-center z-0 absolute inset-0\" style={{ display: p.image ? 'none' : 'flex' }}>\n                    <div className={`flex flex-col items-center justify-center ${darkMode ? 'text-slate-700' : 'text-slate-400'}`}>\n                        <ImageIcon className=\"w-12 h-12 sm:w-16 sm:h-16 mb-2 opacity-50\" />\n                        <span className=\"text-[10px] sm:text-xs font-bold uppercase tracking-widest opacity-50\">Sin Imagen</span>\n                    </div>\n                </div>\n\n                {/* OVERLAY AGOTADO (Mejorado) */}\n                {p.stock <= 0 && (\n                    <div className={`absolute inset-0 z-30 flex items-center justify-center ${darkMode ? 'bg-black/40' : 'bg-white/60'} backdrop-blur-[2px]`}>\n                        <div className=\"border-4 border-red-500 p-2 sm:p-4 -rotate-12 bg-black/80 shadow-[0_0_30px_rgba(239,68,68,0.5)] transform scale-90 sm:scale-110\">\n                            <span className=\"text-red-500 font-black text-lg sm:text-2xl md:text-3xl tracking-[0.15em] sm:tracking-[0.2em] uppercase\">AGOTADO</span>\n                        </div>\n                    </div>\n                )}\n\n                {/* BADGE: DESTACADO */}\n                {p.isFeatured && p.stock > 0 && (\n                    <div className=\"absolute top-0 left-0 bg-gradient-to-r from-yellow-500 to-orange-500 text-black text-[9px] sm:text-[10px] font-black px-2 sm:px-4 py-1 sm:py-1.5 rounded-br-xl sm:rounded-br-2xl uppercase tracking-wider z-20 shadow-lg flex items-center gap-1\">\n                        <Star className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 fill-current\" /> Destacado\n                    </div>\n                )}\n\n                {/* Descuento Badge */}\n                {p.discount > 0 && p.stock > 0 && !p.isFeatured && (\n                    <span className=\"absolute top-2 left-2 sm:top-4 sm:left-4 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg shadow-lg z-20 shadow-red-600/20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Combined Badge (Featured + Discount) */}\n                {p.discount > 0 && p.stock > 0 && p.isFeatured && (\n                    <span className=\"absolute top-8 sm:top-10 left-0 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-0.5 sm:py-1 rounded-r-lg shadow-lg z-20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Botón Favorito (Funcional) */}\n                <button\n                    onClick={(e) => { e.stopPropagation(); toggleFavorite(p) }}\n                    className={`absolute top-2 right-2 sm:top-4 sm:right-4 p-2 sm:p-3 rounded-full z-20 transition shadow-lg backdrop-blur-sm border ${currentUser?.favorites?.includes(p.id) ? 'bg-red-500 text-white border-red-500 shadow-red-500/30' : darkMode ? 'bg-white/10 text-slate-300 border-white/10 hover:bg-white hover:text-red-500' : 'bg-slate-100 text-slate-500 border-slate-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200'}`}\n                >\n                    <Heart className={`w-4 h-4 sm:w-5 sm:h-5 ${currentUser?.favorites?.includes(p.id) ? 'fill-current' : ''}`} />\n                </button>\n\n\n            </div>\n\n            {/* Información */}\n            <div className={`p-3 sm:p-4 flex-1 flex flex-col relative z-10 ${infoBg}`}>\n                <div className=\"flex justify-between items-start mb-2 sm:mb-3\">\n                    <p className={`text-[9px] sm:text-[10px] text-orange-500 font-black uppercase tracking-widest ${darkMode ? 'border-orange-900/30 bg-orange-900/10' : 'border-orange-200 bg-orange-50'} border px-1.5 sm:px-2 py-0.5 sm:py-1 rounded`}>\n                        {Array.isArray(p.categories) ? (p.categories.length > 0 ? p.categories[0] : p.category || 'Sin categoría') : (p.category || 'Sin categoría')}\n                    </p>\n                    {/* Estado de Stock */}\n                    {settings?.showStockCount !== false && p.stock > 0 && p.stock <= (settings?.lowStockThreshold || 5) ? (\n                        <span className=\"text-[9px] sm:text-[10px] text-red-500 font-bold flex items-center gap-1\">\n                            <AlertCircle className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" /> Últimos {p.stock}\n                        </span>\n                    ) : null}\n                </div>\n\n                <h3 className={`${textPrimary} font-bold text-sm sm:text-base leading-tight mb-2 sm:mb-4 group-hover:text-orange-600 transition line-clamp-2 min-h-[2rem] sm:min-h-[2.5rem]`}>\n                    {p.name}\n                </h3>\n\n                <div className={`mt-auto pt-2 sm:pt-4 border-t ${borderColor} flex items-end justify-between`}>\n                    <div className=\"flex flex-col\">\n                        {p.discount > 0 && (\n                            <span className={`text-[10px] sm:text-xs ${textSecondary} line-through font-medium mb-0.5 sm:mb-1`}>\n                                ${p.basePrice.toLocaleString()}\n                            </span>\n                        )}\n                        <span className={`text-lg sm:text-2xl font-black ${textPrimary} tracking-tight flex items-center gap-1`}>\n                            ${calculateItemPrice(p.basePrice, p.discount).toLocaleString()}\n                        </span>\n                    </div>\n\n                    {/* Add to Cart with Quantity */}\n                    {p.stock > 0 && (\n                        <div\n                            className=\"flex items-center gap-2\"\n                            onClick={(e) => e.stopPropagation()}\n                        >\n                            <QuickAddButton\n                                product={p}\n                                onAdd={(product, qty) => manageCart(product, qty)}\n                                darkMode={darkMode}\n                            />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}, (prev, next) => {\n    return (\n        prev.p.id === next.p.id &&\n        prev.p.stock === next.p.stock &&\n        prev.p.basePrice === next.p.basePrice &&\n        prev.p.name === next.p.name &&\n        prev.p.image === next.p.image &&\n        prev.currentUser?.favorites?.includes(prev.p.id) === next.currentUser?.favorites?.includes(next.p.id)\n    );\n});\n\n\n// --- Category Modal Component ---\nconst CategoryProductsModal = ({ isOpen, onClose, category, products, onAddToCart, darkMode }) => {\n    if (!isOpen) return null;\n\n    const categoryProducts = products.filter(p => {\n        const cats = Array.isArray(p.categories) ? p.categories : (p.category ? [p.category] : []);\n        return cats.includes(category);\n    });\n\n    return (\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4\">\n            <div\n                className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n                onClick={onClose}\n            />\n            <div className={`relative w-full max-w-2xl max-h-[80vh] overflow-hidden rounded-3xl shadow-2xl flex flex-col ${darkMode ? 'bg-slate-900 border border-white/10' : 'bg-white border border-slate-200'}`}>\n                <div className=\"p-6 border-b border-white/10 flex items-center justify-between\">\n                    <h2 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{category}</h2>\n                    <button\n                        onClick={onClose}\n                        className={`p-2 rounded-full hover:bg-white/10 transition ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}\n                    >\n                        <X className=\"w-6 h-6\" />\n                    </button>\n                </div>\n                <div className=\"p-6 overflow-y-auto grid grid-cols-2 sm:grid-cols-3 gap-4\">\n                    {categoryProducts.map(p => (\n                        <div key={p.id} className=\"group relative\">\n                            <div className=\"aspect-square rounded-2xl overflow-hidden mb-2\">\n                                <img\n                                    src={p.image || 'placeholder.jpg'}\n                                    alt={p.name}\n                                    className=\"w-full h-full object-cover group-hover:scale-110 transition duration-500\"\n                                />\n                            </div>\n                            <h3 className={`text-sm font-bold truncate ${darkMode ? 'text-white' : 'text-slate-900'}`}>{p.name}</h3>\n                            <p className={`text-xs ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>${p.basePrice.toLocaleString()}</p>\n                            <button\n                                onClick={() => onAddToCart(p)}\n                                className=\"mt-2 w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-xs font-bold transition shadow-lg\"\n                            >\n                                Agregar\n                            </button>\n                        </div>\n                    ))}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst CategoryModal = ({ isOpen, onClose, categories, onAdd, onRemove, darkMode = true }) => {\n    const [catName, setCatName] = React.useState('');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (catName.trim()) {\n            onAdd(catName.trim());\n            setCatName('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[10010] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in p-4\" onClick={onClose}>\n            <div className={`p-8 rounded-[2rem] max-w-md w-full relative border transition-all duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200 shadow-xl'}`} onClick={e => e.stopPropagation()}>\n                <button onClick={onClose} className={`absolute top-4 right-4 transition ${darkMode ? 'text-slate-500 hover:text-white' : 'text-slate-400 hover:text-slate-900'}`}>\n                    <X className=\"w-6 h-6\" />\n                </button>\n                <h3 className={`text-2xl font-bold mb-6 flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                    <FolderPlus className=\"w-6 h-6 text-orange-400\" /> Gestionar Categorías\n                </h3>\n\n                <form onSubmit={handleSubmit} className=\"flex gap-2 mb-6\">\n                    <input\n                        className={`flex-1 p-3 rounded-xl border transition-all duration-300 ${darkMode ? 'bg-slate-900 border-slate-700 text-white focus:border-orange-500 outline-none' : 'bg-slate-50 border-slate-200 text-slate-900 focus:border-orange-500 outline-none'}`}\n                        placeholder=\"Nueva categoría...\"\n                        value={catName}\n                        onChange={(e) => setCatName(e.target.value)}\n                        autoFocus\n                    />\n                    <button type=\"submit\" className=\"bg-orange-600 hover:bg-orange-500 text-white p-3 rounded-xl font-bold transition shadow-lg shadow-orange-600/20\">\n                        <Plus className=\"w-5 h-5\" />\n                    </button>\n                </form>\n\n                <div className=\"space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar\">\n                    {categories.map((cat, index) => (\n                        <div key={index} className={`flex items-center justify-between p-3 rounded-xl border group transition-all duration-300 ${darkMode ? 'bg-slate-900/50 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-100 hover:border-slate-200'}`}>\n                            <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>{cat}</span>\n                            <button\n                                onClick={() => onRemove(cat)}\n                                className={`transition opacity-0 group-hover:opacity-100 ${darkMode ? 'text-slate-600 hover:text-red-500' : 'text-slate-400 hover:text-red-600'}`}\n                            >\n                                <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                        </div>\n                    ))}\n                    {categories.length === 0 && (\n                        <p className={`text-center italic py-4 transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>No hay categorías definidas</p>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst ADMIN_PANEL_GUIDES = {\n    dashboard: {\n        title: 'Inicio (Panel de Control)',\n        description: 'Acá tenés el resumen general de tu tienda: ventas, ingresos y métricas para tomar decisiones rápidas.',\n        sections: [\n            {\n                title: 'Qué mirar primero',\n                bullets: [\n                    'Ingresos brutos y beneficio neto estimado para ver cómo viene el mes.',\n                    'Rendimiento mensual para comparar meses recientes.',\n                    'Movimientos recientes para detectar ingresos/gastos rápido.'\n                ]\n            },\n            {\n                title: 'Acciones típicas',\n                bullets: [\n                    'Usá los botones/atajos del panel para ver detalles de métricas y reportes.',\n                    'Registrá ventas manuales si vendiste fuera del checkout (mostrador / en casa).'\n                ]\n            }\n        ]\n    },\n    orders: {\n        title: 'Pedidos',\n        description: 'Gestioná los pedidos que entran: ver detalle, finalizar y eliminar.',\n        sections: [\n            {\n                title: 'Cómo operar',\n                bullets: [\n                    'Abrí un pedido con el ícono de ojo para ver productos, datos del cliente y totales.',\n                    'Marcá como finalizado con el ícono de tilde cuando ya esté entregado/pagado.',\n                    'Eliminá con el ícono de papelera solo si fue un pedido inválido o duplicado.'\n                ]\n            },\n            {\n                title: 'Notificación',\n                bullets: [\n                    'El botón “Notificación pedidos” activa o mutea el sonido/alerta de nuevos pedidos (solo admins).'\n                ]\n            }\n        ]\n    },\n    products: {\n        title: 'Productos',\n        description: 'Administrá tu catálogo: altas, edición, categorías, stock y visibilidad.',\n        sections: [\n            {\n                title: 'Crear y organizar',\n                bullets: [\n                    'Usá “Agregar Producto” para cargar nombre, imagen, precio y stock.',\n                    'Usá “Categorías” para crear/editar categorías y ordenar el catálogo.'\n                ]\n            },\n            {\n                title: 'Stock y visibilidad',\n                bullets: [\n                    'Revisá el stock para evitar vender sin disponibilidad.',\n                    'Si un producto está desactivado, no aparece en la tienda hasta reactivarlo.'\n                ]\n            },\n            {\n                title: 'Límites de plan',\n                bullets: [\n                    'El contador muestra cuántos productos tenés según el plan; si estás cerca del límite, te avisa.'\n                ]\n            }\n        ]\n    },\n    promos: {\n        title: 'Promos',\n        description: 'Creá combos/promociones armando un paquete de productos con un precio final.',\n        sections: [\n            {\n                title: 'Crear una promo',\n                bullets: [\n                    'Poné nombre, precio e imagen (opcional) para mostrarla atractiva.',\n                    'Agregá productos al combo y ajustá cantidades.',\n                    'Guardá y revisá que el precio final tenga sentido vs. el costo.'\n                ]\n            },\n            {\n                title: 'Edición y limpieza',\n                bullets: [\n                    'Editá una promo existente cuando cambien productos o precios.',\n                    'Eliminá promos viejas para mantener el panel ordenado.'\n                ]\n            }\n        ]\n    },\n    coupons: {\n        title: 'Cupones',\n        description: 'Creá cupones de descuento por porcentaje o monto fijo, con límites y vencimiento.',\n        sections: [\n            {\n                title: 'Configurar un cupón',\n                bullets: [\n                    'Definí el código (en mayúsculas), el tipo (porcentaje/fijo) y el valor.',\n                    'Opcional: mínimo de compra, límite de usos y fecha de vencimiento.',\n                    'Elegí si es público (para redes) o para un email específico.'\n                ]\n            },\n            {\n                title: 'Usarlo y compartirlo',\n                bullets: [\n                    'Copiá el código con el botón de copiar y pasalo por WhatsApp/Instagram.',\n                    'Eliminá cupones vencidos o que ya no quieras ofrecer.'\n                ]\n            },\n            {\n                title: 'Planes',\n                bullets: [\n                    'Si tu plan no habilita cupones, vas a ver el panel bloqueado y un acceso a planes.'\n                ]\n            }\n        ]\n    },\n    suppliers: {\n        title: 'Proveedores',\n        description: 'Guardá proveedores y vinculalos a los productos que te abastecen.',\n        sections: [\n            {\n                title: 'Alta y datos',\n                bullets: [\n                    'Creá un proveedor con nombre, contacto, teléfono, IG y dirección (si aplica).',\n                    'Asociá productos para tener referencia rápida de qué compra va con quién.'\n                ]\n            },\n            {\n                title: 'Mantenimiento',\n                bullets: [\n                    'Editá cuando cambie un contacto o dato fiscal.',\n                    'Eliminá si ya no trabajás con ese proveedor.'\n                ]\n            }\n        ]\n    },\n    purchases: {\n        title: 'Compras / Stock',\n        description: 'Registrá reposiciones de stock y llevá historial de compras a proveedores.',\n        sections: [\n            {\n                title: 'Registrar reposición',\n                bullets: [\n                    'Elegí el producto existente, poné cantidad y seleccioná el proveedor.',\n                    'El sistema calcula un costo estimado y ajusta el stock al guardar.'\n                ]\n            },\n            {\n                title: 'Historial y correcciones',\n                bullets: [\n                    'Usá el historial para revisar compras pasadas.',\n                    'Editar una compra puede ajustar el stock automáticamente: revisalo antes de guardar.'\n                ]\n            }\n        ]\n    },\n    finance: {\n        title: 'Finanzas',\n        description: 'Registrá inversiones/aportes y gastos para entender el capital y la rentabilidad.',\n        sections: [\n            {\n                title: 'Registrar movimientos',\n                bullets: [\n                    'Cargá inversiones/aportes con socio, monto y fecha.',\n                    'Cargá gastos/egresos con descripción, categoría y fecha.'\n                ]\n            },\n            {\n                title: 'Lectura',\n                bullets: [\n                    'Usá los totales para ver capital, egresos e impacto en el resultado.',\n                    'Mantené al día los gastos para que el beneficio estimado sea realista.'\n                ]\n            }\n        ]\n    },\n    users: {\n        title: 'Usuarios',\n        description: 'Administrá cuentas: búsqueda, roles y auditoría para soporte.',\n        sections: [\n            {\n                title: 'Buscar y filtrar',\n                bullets: [\n                    'Buscá por nombre, email o usuario desde la barra.',\n                    'Filtrá por rol para encontrar rápido admins/usuarios.'\n                ]\n            },\n            {\n                title: 'Gestión',\n                bullets: [\n                    'Editá el perfil o permisos según necesidad.',\n                    'Usá la auditoría para entender carritos/actividad si hay reclamos.'\n                ]\n            }\n        ]\n    }\n};\n\nfunction AdminHowToUse({ guideKey }) {\n    const [isOpen, setIsOpen] = useState(false);\n    const guide = ADMIN_PANEL_GUIDES[guideKey];\n    if (!guide) return null;\n\n    return (\n        <>\n            <button\n                onClick={() => setIsOpen(true)}\n                className=\"px-4 py-2 rounded-xl bg-slate-900/60 hover:bg-slate-900 text-slate-300 hover:text-white border border-slate-800 transition flex items-center gap-2 font-black text-[10px] uppercase tracking-widest\"\n                type=\"button\"\n            >\n                <FileQuestion className=\"w-4 h-4\" />\n                Cómo usar\n            </button>\n\n            {isOpen && (\n                <div\n                    className=\"fixed inset-0 z-[20050] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in\"\n                    onClick={() => setIsOpen(false)}\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                >\n                    <div\n                        className=\"w-full max-w-2xl bg-[#0a0a0a] border border-slate-700 rounded-[2rem] shadow-2xl overflow-hidden\"\n                        onClick={(e) => e.stopPropagation()}\n                    >\n                        <div className=\"flex items-start justify-between gap-4 p-6 border-b border-slate-800\">\n                            <div>\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Guía rápida</p>\n                                <h2 className=\"text-2xl font-black text-white mt-1\">Cómo usar: {guide.title}</h2>\n                                <p className=\"text-slate-400 text-sm mt-2\">{guide.description}</p>\n                            </div>\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"p-2 rounded-xl bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white border border-slate-800 transition\"\n                                type=\"button\"\n                                aria-label=\"Cerrar\"\n                            >\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 max-h-[70vh] overflow-y-auto custom-scrollbar space-y-6\">\n                            {(guide.sections || []).map((section, idx) => (\n                                <div key={idx} className=\"bg-slate-900/20 border border-slate-800 rounded-2xl p-5\">\n                                    <h3 className=\"text-white font-black\">{section.title}</h3>\n                                    <ul className=\"list-disc pl-5 mt-3 space-y-2 text-sm text-slate-300\">\n                                        {(section.bullets || []).map((b, i) => (\n                                            <li key={i}>{b}</li>\n                                        ))}\n                                    </ul>\n                                </div>\n                            ))}\n                        </div>\n\n                        <div className=\"p-6 border-t border-slate-800 flex justify-end\">\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"px-5 py-3 rounded-xl bg-orange-600 hover:bg-orange-500 text-white font-black transition\"\n                                type=\"button\"\n                            >\n                                Entendido\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </>\n    );\n}\n\n// --- APLICACIÓN PRINCIPAL ---\nfunction App() {\n    // --- GESTIÓN DE ESTADO (EXPANDIDA) ---\n\n    // Navegación y UI\n    const [view, setView] = useState('store'); // store, cart, checkout, profile, login, register, admin, about, guide\n    const [adminTab, setAdminTab] = useState('dashboard');\n    const [expenses, setExpenses] = useState([]);\n    const [investments, setInvestments] = useState([]);\n    const [purchases, setPurchases] = useState([]);\n    const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: null }); // dashboard, products, coupons, users, suppliers, settings, finance\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [isAdminMenuOpen, setIsAdminMenuOpen] = useState(false);\n    const [darkMode, setDarkMode] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_dark_mode');\n            return saved !== null ? JSON.parse(saved) : false; // Default to light mode (blanco)\n        } catch (e) { return false; }\n    });\n    const [appId, setAppId] = useState(null);\n    const [storeResolution, setStoreResolution] = useState({ status: 'resolving', hostname: '', normalizedHostname: '', storeId: null, error: null });\n    const [storeSetupStoreIdInput, setStoreSetupStoreIdInput] = useState('');\n    const [isStoreSetupSaving, setIsStoreSetupSaving] = useState(false);\n    const [isExportingBackup, setIsExportingBackup] = useState(false);\n    const [isImportingBackup, setIsImportingBackup] = useState(false);\n\n    // Usuarios y Autenticación\n    const [currentUser, setCurrentUser] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_user_data');\n            if (!saved) return null;\n\n            const userData = JSON.parse(saved);\n\n            // Validar que el usuario tenga los campos mínimos requeridos\n            // Si no tiene id, email o name, es un usuario inválido o corrupto\n            if (!userData || !userData.id || !userData.email || !userData.name) {\n                // Limpiar datos corruptos o incompletos\n                localStorage.removeItem('sustore_user_data');\n                return null;\n            }\n\n            return userData;\n        } catch (e) {\n            // Si hay error al parsear, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n            return null;\n        }\n    });\n    const [systemUser, setSystemUser] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isProcessingOrder, setIsProcessingOrder] = useState(false);\n    const [toasts, setToasts] = useState([]);\n\n    const [adminOrderAlarmMuted, setAdminOrderAlarmMuted] = useState(() => {\n        try {\n            return localStorage.getItem('sustore_admin_order_alarm_muted') === '1';\n        } catch (e) { return false; }\n    });\n\n    const orderAlarmContextRef = useRef(null);\n    const orderAlarmIntervalRef = useRef(null);\n    const orderAlarmActiveRef = useRef(false);\n    const orderAlarmToastShownRef = useRef(false);\n    const orderAlarmUnlockListenerActiveRef = useRef(false);\n    const lastOrdersSeenWriteRef = useRef(null);\n\n\n    // Datos Principales\n    const [products, setProducts] = useState([]);\n    const [promos, setPromos] = useState([]); // Nuevo estado para Promos\n    const [homeBanners, setHomeBanners] = useState([]);\n    const [cart, setCart] = useState(() => {\n        try {\n            const saved = JSON.parse(localStorage.getItem('sustore_cart'));\n            return Array.isArray(saved) ? saved : [];\n        } catch (e) { return []; }\n    });\n    const cartHydratedFromRemoteRef = useRef(false);\n    const [liveCarts, setLiveCarts] = useState([]); // Monitor de carritos en tiempo real\n    const [orders, setOrders] = useState([]);\n    const [users, setUsers] = useState([]);\n    const [coupons, setCoupons] = useState([]);\n    const [suppliers, setSuppliers] = useState([]);\n\n    const [settings, setSettings] = useState(defaultSettings);\n    const [settingsLoaded, setSettingsLoaded] = useState(false); // Indica si los settings ya se cargaron de Firebase\n\n    // Estados de Interfaz de Usuario\n    const [searchQuery, setSearchQuery] = useState('');\n    const [selectedCategory, setSelectedCategory] = useState('');\n\n    // --- DRAG TO SCROLL (Categorías) ---\n    const categoriesScrollRef = useRef(null);\n    const [isDraggingCategories, setIsDraggingCategories] = useState(false);\n    const [startXCategories, setStartXCategories] = useState(0);\n    const [scrollLeftCategories, setScrollLeftCategories] = useState(0);\n\n    const handleMouseDownCategories = (e) => {\n        setIsDraggingCategories(true);\n        setStartXCategories(e.pageX - categoriesScrollRef.current.offsetLeft);\n        setScrollLeftCategories(categoriesScrollRef.current.scrollLeft);\n    };\n\n    const handleMouseLeaveCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseUpCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseMoveCategories = (e) => {\n        if (!isDraggingCategories) return;\n        e.preventDefault();\n        const x = e.pageX - categoriesScrollRef.current.offsetLeft;\n        const walk = (x - startXCategories) * 2; // Velocidad de desplazamiento\n        categoriesScrollRef.current.scrollLeft = scrollLeftCategories - walk;\n    };\n\n\n    // Formularios de Autenticación\n    const [authData, setAuthData] = useState({\n        email: '',\n        password: '',\n        name: '',\n        username: '',\n        dni: '',\n        phone: ''\n    });\n    const [loginMode, setLoginMode] = useState(true);\n\n    // Estados para Nuevos Formularios (Finanzas y Compras)\n    const [newExpense, setNewExpense] = useState({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n    const [newInvestment, setNewInvestment] = useState({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n    const [newPurchase, setNewPurchase] = useState({ productId: '', supplierId: '', quantity: 1, cost: 0, isNewProduct: false });\n    const [newHomeBanner, setNewHomeBanner] = useState({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    const [editingHomeBannerId, setEditingHomeBannerId] = useState(null);\n\n    // Estado para Proveedores (Restaurado)\n    const [newSupplier, setNewSupplier] = useState({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n    const [editingSupplierId, setEditingSupplierId] = useState(null);\n    const [showSupplierModal, setShowSupplierModal] = useState(false);\n\n    // Estado para Carrito de Compras (Pedidos Mayoristas)\n    const [purchaseCart, setPurchaseCart] = useState([]);\n\n    // Estado para Modal de Crear Categoría\n    const [showCategoryModal, setShowCategoryModal] = useState(false);\n\n    // Estado para Detalle de Producto / Promo (Zoom)\n    const [selectedProduct, setSelectedProduct] = useState(null);\n\n    // --- HELPERS ---\n\n    const openConfirm = (title, message, onConfirm) => {\n        setConfirmModal({\n            isOpen: true,\n            title,\n            message,\n            onConfirm: async () => {\n                await onConfirm();\n                setConfirmModal(prev => ({ ...prev, isOpen: false }));\n            },\n            onCancel: () => setConfirmModal(prev => ({ ...prev, isOpen: false }))\n        });\n    };\n\n    const downloadJsonFile = (filename, obj) => {\n        const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        setTimeout(() => URL.revokeObjectURL(url), 1000);\n    };\n\n    const exportBackup = async () => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesión inválida');\n        setIsExportingBackup(true);\n        try {\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/export-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({}),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo exportar');\n            const safeDate = new Date().toISOString().replace(/[:.]/g, '-');\n            downloadJsonFile(`backup-${appId}-${safeDate}.json`, data);\n            showToast('Backup exportado.', 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo exportar', 'error');\n        } finally {\n            setIsExportingBackup(false);\n        }\n    };\n\n    const importBackupFile = async (file) => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesión inválida');\n        setIsImportingBackup(true);\n        try {\n            const text = await file.text();\n            const parsed = JSON.parse(text);\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/import-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({ backup: parsed }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo importar');\n            showToast(`Backup importado (${data.written || 0} docs).`, 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo importar', 'error');\n        } finally {\n            setIsImportingBackup(false);\n        }\n    };\n\n    // --- FUNCIÓN PARA MANEJAR CAMBIO DE PLAN (DOWNGRADE) ---\n    const getPlanLimit = (plan) => {\n        switch (plan) {\n            case 'premium': return Infinity;\n            case 'business': return 50;\n            case 'entrepreneur':\n            default: return 30;\n        }\n    };\n\n    const getPlanAllowsCoupons = (plan) => {\n        return plan === 'business' || plan === 'premium';\n    };\n\n    const handlePlanChange = async (newPlan) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const currentLimit = getPlanLimit(currentPlan);\n        const newLimit = getPlanLimit(newPlan);\n\n        // Si es upgrade (más productos permitidos), simplemente cambiar\n        if (newLimit >= currentLimit) {\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`¡Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}!`, 'success');\n            return;\n        }\n\n        // Es un DOWNGRADE - verificar límites\n        const activeProducts = products.filter(p => p.isActive !== false);\n        const productsToDeactivate = [];\n        const couponsToDeactivate = [];\n\n        // Si hay más productos activos que el nuevo límite\n        if (activeProducts.length > newLimit) {\n            // Ordenar por ventas (más vendidos quedan activos) o por fecha de creación\n            const sortedProducts = [...activeProducts].sort((a, b) => {\n                // Priorizar productos más vendidos\n                const salesA = orders.filter(o => o.items?.some(i => i.productId === a.id)).length;\n                const salesB = orders.filter(o => o.items?.some(i => i.productId === b.id)).length;\n                return salesB - salesA; // Más vendidos primero\n            });\n\n            // Los productos después del límite se desactivan\n            for (let i = newLimit; i < sortedProducts.length; i++) {\n                productsToDeactivate.push(sortedProducts[i]);\n            }\n        }\n\n        // Si el nuevo plan no permite cupones, desactivar todos los cupones activos\n        if (!getPlanAllowsCoupons(newPlan)) {\n            const activeCoupons = coupons.filter(c => c.isActive !== false);\n            couponsToDeactivate.push(...activeCoupons);\n        }\n\n        // Si hay productos/cupones a desactivar, mostrar confirmación\n        if (productsToDeactivate.length > 0 || couponsToDeactivate.length > 0) {\n            const message = `\n                ${productsToDeactivate.length > 0 ? `• ${productsToDeactivate.length} producto(s) serán desactivados (se conservan los ${newLimit} más vendidos)\\n` : ''}\n                ${couponsToDeactivate.length > 0 ? `• ${couponsToDeactivate.length} cupón(es) serán desactivados (el plan ${newPlan === 'entrepreneur' ? 'Emprendedor' : ''} no incluye cupones)\\n` : ''}\n                \n                Los productos y cupones NO se eliminarán, solo se desactivarán. Podrás reactivarlos manualmente si mejoras tu plan.\n            `;\n\n            openConfirm(\n                '⚠️ Cambio de Plan - Atención',\n                message,\n                async () => {\n                    try {\n                        // Desactivar productos excedentes\n                        for (const product of productsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Desactivar cupones si el plan no los soporta\n                        for (const coupon of couponsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', coupon.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Actualizar el plan\n                        setSettings({ ...settings, subscriptionPlan: newPlan });\n\n                        // Guardar info del downgrade para mostrar advertencias\n                        setPlanDowngradeInfo({\n                            showWarning: true,\n                            deactivatedProducts: productsToDeactivate.map(p => p.id),\n                            deactivatedCoupons: couponsToDeactivate.map(c => c.id),\n                            previousPlan: currentPlan,\n                            newPlan: newPlan\n                        });\n\n                        showToast(`Plan cambiado. ${productsToDeactivate.length} producto(s) y ${couponsToDeactivate.length} cupón(es) fueron desactivados.`, 'warning');\n                    } catch (error) {\n                        console.error('Error al cambiar de plan:', error);\n                        showToast('Error al cambiar de plan', 'error');\n                    }\n                }\n            );\n        } else {\n            // No hay nada que desactivar, simplemente cambiar el plan\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}`, 'success');\n        }\n    };\n\n    // Función para reactivar un producto manualmente (si mejora el plan)\n    const reactivateProduct = async (productId) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const limit = getPlanLimit(currentPlan);\n        const activeCount = products.filter(p => p.isActive !== false).length;\n\n        if (activeCount >= limit) {\n            showToast(`Has alcanzado el límite de ${limit} productos de tu plan. Mejora tu plan o desactiva otro producto primero.`, 'warning');\n            return;\n        }\n\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: true,\n                deactivatedByPlan: false,\n                reactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto reactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al reactivar producto:', error);\n            showToast('Error al reactivar producto', 'error');\n        }\n    };\n\n    // Función para desactivar un producto manualmente\n    const deactivateProduct = async (productId) => {\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: false,\n                deactivatedManually: true,\n                deactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto desactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al desactivar producto:', error);\n            showToast('Error al desactivar producto', 'error');\n        }\n    };\n\n\n    // Formulario de Checkout\n    const [checkoutData, setCheckoutData] = useState({\n        address: '',\n        city: '',\n        province: '',\n        zipCode: '',\n        paymentChoice: '',\n        shippingMethod: 'Pickup' // Pickup or Delivery\n    });\n    const [appliedCoupon, setAppliedCoupon] = useState(null);\n    const [showCouponModal, setShowCouponModal] = useState(false);\n\n    // Auto-corrección de método de pago al cambiar envío\n    useEffect(() => {\n        if (checkoutData.shippingMethod === 'Delivery' && checkoutData.paymentChoice === 'Efectivo') {\n            showToast('Pago en efectivo solo disponible con Retiro en Local.', 'info');\n            // Cambiar a otro método válido automáticamente\n            const hasTransfer = settings?.paymentTransfer?.enabled;\n            const hasCard = settings?.paymentMercadoPago?.enabled;\n            setCheckoutData(prev => ({\n                ...prev,\n                paymentChoice: hasTransfer ? 'Transferencia' : (hasCard ? 'Tarjeta' : '')\n            }));\n        }\n    }, [checkoutData.shippingMethod, settings]);\n\n    // --- ESTADOS DE ADMINISTRACIÓN (DETALLADOS) ---\n\n    // Gestión de Productos\n    const [newProduct, setNewProduct] = useState({\n        name: '',\n        basePrice: '',\n        stock: '',\n        categories: [], // Cambio: Ahora es un array para múltiples categorías\n        image: '',\n        description: '',\n        discount: 0,\n        purchasePrice: ''\n    });\n    const [editingId, setEditingId] = useState(null);\n    const [showProductForm, setShowProductForm] = useState(false);\n    const [settingsTab, setSettingsTab] = useState('store'); // store, appearance, social, payments, shipping, seo, advanced, team\n\n    // Gestión de Promos\n    const [newPromo, setNewPromo] = useState({\n        name: '',\n        price: '',\n        image: '',\n        description: '',\n        items: [] // Array de { productId, quantity }\n    });\n    const [promoSearch, setPromoSearch] = useState('');\n    const [selectedPromoProduct, setSelectedPromoProduct] = useState('');\n    const [promoProductQty, setPromoProductQty] = useState(1);\n    const [isEditingPromo, setIsEditingPromo] = useState(false);\n    const [editingPromoId, setEditingPromoId] = useState(null);\n\n    // Gestión Avanzada de Cupones (Restaurada la complejidad)\n    const [newCoupon, setNewCoupon] = useState({\n        code: '',\n        type: 'percentage', // percentage, fixed\n        value: 0,\n        minPurchase: 0,\n        maxDiscount: 0,\n        expirationDate: '',\n        targetType: 'global', // global, specific_user, specific_email\n        targetUser: '', // username o email específico\n        usageLimit: '', // Limite total de usos\n        perUserLimit: 1, // Limite por usuario\n        isActive: true\n    });\n\n\n\n\n    // Estado para EDICIÓN DE COMPRAS\n    const [editingPurchase, setEditingPurchase] = useState(null);\n\n    // Configuración y Equipo\n    const [aboutText, setAboutText] = useState('');\n\n    const [newCategory, setNewCategory] = useState('');\n    const [newTeamMember, setNewTeamMember] = useState({ email: '', role: 'employee', name: '' });\n\n    // Estado para Detalle de Pedido (Modal)\n    const [selectedOrder, setSelectedOrder] = useState(null);\n\n    // Estados para Paginación de Pedidos (Admin)\n    const [ordersLimit, setOrdersLimit] = useState(20);\n    const [ordersCursor, setOrdersCursor] = useState(null); // DocumentSnapshot del último elemento\n    const [ordersHistory, setOrdersHistory] = useState([]); // Historial de cursores para \"Volver\"\n    const [hasMoreOrders, setHasMoreOrders] = useState(true);\n\n    // Estados para Dashboard Avanzado (Venta Manual, Analíticas, Producto Menos Vendido)\n    const [showManualSaleModal, setShowManualSaleModal] = useState(false);\n    const [metricsDetail, setMetricsDetail] = useState(null); // { type: 'revenue' | 'net_income' }\n    const [showLeastSold, setShowLeastSold] = useState(false);\n\n    // Hoisted State for Manual Sale (So we can pre-fill it from Product List)\n    const [saleData, setSaleData] = useState({\n        productId: '',\n        quantity: 1,\n        price: 0,\n        customerName: 'Cliente Offline',\n        paymentMethod: 'Efectivo',\n        notes: 'Venta presencial'\n    });\n\n    // --- NUEVOS ESTADOS PARA GESTIÓN DE USUARIOS (CARRITO, PASS Y EDICIÓN) ---\n    const [viewUserCart, setViewUserCart] = useState(null); // Usuario seleccionado para ver carrito\n    const [userPassModal, setUserPassModal] = useState(null); // Usuario a cambiar contraseña\n    const [viewUserEdit, setViewUserEdit] = useState(null); // Usuario a editar perfil\n    const [newAdminPassword, setNewAdminPassword] = useState('');\n    const [userSearch, setUserSearch] = useState('');\n    const [userRoleFilter, setUserRoleFilter] = useState('all');\n\n    // Estado para Modal de Planes (cuando hacen clic en el overlay de restricción)\n    const [showPlansModal, setShowPlansModal] = useState(false);\n    const [selectedPlanOption, setSelectedPlanOption] = useState(null); // { plan: 'Emprendedor', cycle: 'Mensual', price: '$7.000' }\n\n    // Estado para Plan Downgrade - Productos/Cupones desactivados por límite\n    const [planDowngradeInfo, setPlanDowngradeInfo] = useState({\n        showWarning: false,\n        deactivatedProducts: [], // IDs de productos desactivados por límite\n        deactivatedCoupons: [], // IDs de cupones desactivados por límite\n        previousPlan: null,\n        newPlan: null\n    });\n\n    // --- ESTADOS PARA MERCADO PAGO CARD PAYMENT BRICK ---\n    const [mpBrickController, setMpBrickController] = useState(null);\n    const [isPaymentProcessing, setIsPaymentProcessing] = useState(false);\n    const [paymentError, setPaymentError] = useState(null);\n    const isInitializingBrick = useRef(false);\n    const cardPaymentBrickRef = useRef(null);\n\n\n    const openManualSaleModal = (product) => {\n        setSaleData({\n            productId: product.id,\n            quantity: 1,\n            price: Number(product.basePrice) || 0,\n            customerName: 'Cliente Offline',\n            paymentMethod: 'Efectivo',\n            notes: 'Venta presencial'\n        });\n        setShowManualSaleModal(true);\n    };\n\n    const confirmManualSale = async () => {\n        if (!saleData.productId) return;\n        if (saleData.quantity <= 0) {\n            showToast(\"La cantidad debe ser mayor a 0\", \"error\");\n            return;\n        }\n\n        setIsProcessingOrder(true);\n        try {\n            // 1. Verificar Stock Actualizado\n            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', saleData.productId);\n            const productSnap = await getDoc(productRef);\n\n            if (!productSnap.exists()) throw new Error(\"Producto no encontrado\");\n\n            const currentStock = Number(productSnap.data().stock) || 0;\n            if (currentStock < saleData.quantity) {\n                showToast(`Stock insuficiente. Solo quedan ${currentStock} unidades.`, \"error\");\n                setIsProcessingOrder(false);\n                return;\n            }\n\n            // 2. Crear Orden\n            const total = saleData.quantity * saleData.price;\n            const newOrder = {\n                orderId: Date.now().toString().slice(-6),\n                date: new Date().toISOString(),\n                status: 'Realizado',\n                source: 'manual_sale', // Identificador clave\n                userId: 'manual_admin',\n                customer: {\n                    name: saleData.customerName || 'Cliente Mostrador',\n                    email: '-',\n                    phone: '-',\n                    dni: '-'\n                },\n                items: [{\n                    id: saleData.productId,\n                    title: products.find(p => p.id === saleData.productId)?.name || 'Producto',\n                    quantity: saleData.quantity,\n                    unit_price: saleData.price,\n                    image: products.find(p => p.id === saleData.productId)?.image || ''\n                }],\n                total: total,\n                paymentMethod: saleData.paymentMethod,\n                notes: saleData.notes\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n            // 3. Descontar Stock\n            await updateDoc(productRef, {\n                stock: increment(-saleData.quantity)\n            });\n\n            showToast(\"Venta registrada exitosamente\", \"success\");\n            setShowManualSaleModal(false);\n\n        } catch (error) {\n            console.error(\"Error en venta manual:\", error);\n            showToast(\"Error al registrar venta: \" + error.message, \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // Referencias\n    const fileInputRef = useRef(null);\n\n    // --- FUNCIONES UTILITARIAS ---\n\n    // Mostrar notificaciones\n    const showToast = (msg, type = 'info') => {\n        const id = Date.now();\n        setToasts(prev => {\n            // Limitar a 3 toasts simultáneos\n            const filtered = prev.filter(t => Date.now() - t.id < 3000);\n            return [...filtered, { id, message: msg, type }];\n        });\n    };\n\n    const removeToast = (id) => setToasts(p => p.filter(t => t.id !== id));\n\n    const handleHomeBannerClick = (slide) => {\n        const targetType = slide?.targetType || (slide?.promoId ? 'promo' : slide?.productId ? 'product' : 'none');\n        const targetId = slide?.targetId || slide?.promoId || slide?.productId || '';\n        if (!targetId || targetType === 'none') return;\n\n        if (targetType === 'product') {\n            const product = products.find(p => String(p.id).trim() === String(targetId).trim());\n            if (product) {\n                setSelectedProduct(product);\n                return;\n            }\n            showToast(\"Este banner apunta a un producto que ya no existe.\", \"warning\");\n            document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n            return;\n        }\n\n        if (targetType === 'promo') {\n            const promo = promos.find(p => String(p.id).trim() === String(targetId).trim());\n            if (!promo) {\n                showToast(\"Este banner apunta a una promo que ya no existe.\", \"warning\");\n                document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n                return;\n            }\n\n            let maxPurchasable = Infinity;\n            (promo.items || []).forEach(item => {\n                const p = products.find(prod => prod.id === item.productId);\n                const pStock = p ? (Number(p.stock) || 0) : 0;\n                const maxForThisItem = Math.floor(pStock / (Number(item.quantity) || 1));\n                if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n            });\n            if (!Number.isFinite(maxPurchasable)) maxPurchasable = 0;\n\n            setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable });\n        }\n    };\n\n    // Validar acceso por rol\n    const getRole = (email) => {\n        if (!email) return 'user';\n        const cleanEmail = email.trim().toLowerCase();\n\n        // Super Admin Hardcodeado (Prioridad Máxima) - No depende de settings\n        if (cleanEmail === SUPER_ADMIN_EMAIL.toLowerCase()) return 'admin';\n\n        // 1. Verificar currentUser.role (Prioridad sobre equipo estático)\n        // Esto permite promover usuarios desde el panel sin depender de settings.team\n        // Esta verificación no depende de settings, solo de currentUser\n        if (currentUser && currentUser.email && currentUser.email.trim().toLowerCase() === cleanEmail && currentUser.role && currentUser.role !== 'user') {\n            return currentUser.role;\n        }\n\n        // Si settings aún no está cargado, no podemos verificar team ni users\n        // Devolvemos 'loading' para indicar que no sabemos aún el rol real\n        if (!settings || !settingsLoaded) return 'loading';\n\n        // 2. Buscar en el equipo (settings.team - Fallback/Hardcoded)\n        const team = settings?.team || [];\n        const member = team.find(m => m.email && m.email.trim().toLowerCase() === cleanEmail);\n        if (member) return member.role;\n\n        // 3. Buscar en la lista de usuarios (solo admins)\n        if (users && users.length > 0) {\n            const userDoc = users.find(u => u.email && u.email.trim().toLowerCase() === cleanEmail);\n            if (userDoc && userDoc.role) return userDoc.role;\n        }\n\n        return 'user';\n    };\n\n    const isAdmin = (email) => getRole(email) === 'admin';\n    const isEditor = (email) => getRole(email) === 'editor';\n    const isRoleLoading = (email) => getRole(email) === 'loading';\n    const hasAccess = (email) => {\n        const role = getRole(email);\n        // Si el rol aún está cargando, no tiene acceso (se mostrará loading)\n        if (role === 'loading') return false;\n        return role === 'admin' || role === 'editor' || role === 'employee';\n    };\n\n    const isAdminUser = isAdmin(systemUser?.email || currentUser?.email);\n    const isSuperAdminSession = !!(systemUser?.email && SUPER_ADMIN_EMAIL && systemUser.email.trim().toLowerCase() === SUPER_ADMIN_EMAIL.trim().toLowerCase());\n    const latestOrderIso = useMemo(() => {\n        if (!isAdminUser) return null;\n        const v = orders?.[0]?.date;\n        return typeof v === 'string' ? v : null;\n    }, [isAdminUser, orders]);\n    const ordersLastSeenIso = typeof settings?.ordersLastSeenIso === 'string' ? settings.ordersLastSeenIso : null;\n    const hasUnseenOrders = !!(latestOrderIso && (!ordersLastSeenIso || latestOrderIso > ordersLastSeenIso));\n\n    const toggleAdminOrderAlarmMuted = useCallback(() => {\n        setAdminOrderAlarmMuted(prev => {\n            const next = !prev;\n            try {\n                localStorage.setItem('sustore_admin_order_alarm_muted', next ? '1' : '0');\n            } catch (e) { }\n            return next;\n        });\n    }, []);\n\n    const stopOrderAlarm = useCallback(async () => {\n        orderAlarmActiveRef.current = false;\n        if (orderAlarmIntervalRef.current) {\n            clearInterval(orderAlarmIntervalRef.current);\n            orderAlarmIntervalRef.current = null;\n        }\n        const ctx = orderAlarmContextRef.current;\n        orderAlarmContextRef.current = null;\n        if (ctx) {\n            try {\n                await ctx.close();\n            } catch (e) { }\n        }\n    }, []);\n\n    const markOrdersSeen = useCallback(async (iso) => {\n        if (!isAdminUser) return;\n        if (!appId) return;\n        const value = typeof iso === 'string' && iso ? iso : new Date().toISOString();\n        if (lastOrdersSeenWriteRef.current === value) return;\n        lastOrdersSeenWriteRef.current = value;\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), { ordersLastSeenIso: value });\n        } catch (e) { }\n    }, [isAdminUser, appId]);\n\n    const startOrderAlarm = useCallback(async () => {\n        if (!isAdminUser) return;\n        if (adminOrderAlarmMuted) return;\n        if (orderAlarmActiveRef.current) return;\n\n        const AudioContextCtor = window.AudioContext || window.webkitAudioContext;\n        if (!AudioContextCtor) return;\n\n        const ctx = orderAlarmContextRef.current || new AudioContextCtor();\n        orderAlarmContextRef.current = ctx;\n\n        const scheduleBeep = (at) => {\n            const osc = ctx.createOscillator();\n            const gain = ctx.createGain();\n            osc.type = 'triangle';\n            osc.frequency.value = 880;\n            gain.gain.setValueAtTime(0.0001, at);\n            gain.gain.exponentialRampToValueAtTime(0.12, at + 0.01);\n            gain.gain.exponentialRampToValueAtTime(0.0001, at + 0.09);\n            osc.connect(gain);\n            gain.connect(ctx.destination);\n            osc.start(at);\n            osc.stop(at + 0.1);\n        };\n\n        const tick = () => {\n            const now = ctx.currentTime;\n            scheduleBeep(now);\n            scheduleBeep(now + 0.18);\n        };\n\n        try {\n            if (ctx.state === 'suspended') {\n                await ctx.resume();\n            }\n        } catch (e) { }\n\n        if (ctx.state !== 'running') {\n            if (!orderAlarmToastShownRef.current) {\n                showToast('Pedido nuevo: tocá/clic para habilitar sonido', 'warning');\n                orderAlarmToastShownRef.current = true;\n            }\n            if (!orderAlarmUnlockListenerActiveRef.current) {\n                orderAlarmUnlockListenerActiveRef.current = true;\n                window.addEventListener('pointerdown', async () => {\n                    orderAlarmUnlockListenerActiveRef.current = false;\n                    try {\n                        if (orderAlarmContextRef.current?.state === 'suspended') {\n                            await orderAlarmContextRef.current.resume();\n                        }\n                    } catch (e) { }\n                    if (hasUnseenOrders && !(view === 'admin' && adminTab === 'orders') && !adminOrderAlarmMuted) {\n                        startOrderAlarm();\n                    }\n                }, { once: true, capture: true });\n            }\n            return;\n        }\n\n        orderAlarmActiveRef.current = true;\n        tick();\n        orderAlarmIntervalRef.current = setInterval(tick, 2000);\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab]);\n\n    useEffect(() => {\n        const rawHostname = (typeof window !== 'undefined' && window.location && window.location.hostname)\n            ? String(window.location.hostname).trim().toLowerCase()\n            : '';\n        const normalizedHostname = rawHostname.startsWith('www.') ? rawHostname.slice(4) : rawHostname;\n\n        if (!normalizedHostname) {\n            setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: 'hostname-empty' });\n            setAppId(null);\n            return;\n        }\n\n        if (normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1') {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        if (normalizedHostname.endsWith('.vercel.app')) {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        setStoreResolution({ status: 'resolving', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n\n        let cancelled = false;\n        const resolve = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'storesIndex', normalizedHostname));\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const data = snap.data() || {};\n                    const storeId = typeof data.storeId === 'string' ? data.storeId.trim() : '';\n                    if (storeId) {\n                        setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId, error: null });\n                        setAppId(storeId);\n                        return;\n                    }\n                }\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n                setAppId(null);\n            } catch (e) {\n                if (cancelled) return;\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: e?.message || 'resolve-error' });\n                setAppId(null);\n            }\n        };\n        resolve();\n        return () => { cancelled = true; };\n    }, []);\n\n    const createStoreId = useCallback(() => {\n        const clean = (value) => String(value || '').trim().toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');\n        const base = clean(storeResolution.normalizedHostname || storeResolution.hostname || 'store');\n        const rand = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'\n            ? crypto.randomUUID().split('-')[0]\n            : Math.random().toString(36).slice(2, 8);\n        return `${base}-${rand}`.slice(0, 80);\n    }, [storeResolution.hostname, storeResolution.normalizedHostname]);\n\n    const bootstrapStoreData = useCallback(async (storeId) => {\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'data', 'settings', 'config'), { ...defaultSettings, createdAt: nowIso, updatedAt: nowIso }, { merge: true });\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'config'), { version: APP_VERSION, updatedAt: nowIso }, { merge: true });\n    }, []);\n\n    const registerHostname = useCallback(async (storeId) => {\n        const hostname = storeResolution.normalizedHostname;\n        if (!hostname) throw new Error('Dominio inválido');\n        const normalizedStoreId = String(storeId || '').trim();\n        if (!normalizedStoreId) throw new Error('StoreId inválido');\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'storesIndex', hostname), { storeId: normalizedStoreId, hostname, updatedAt: nowIso, updatedBy: systemUser?.email || null, createdAt: nowIso }, { merge: true });\n        await bootstrapStoreData(normalizedStoreId);\n        setAppId(normalizedStoreId);\n        setStoreResolution((prev) => ({ ...prev, status: 'resolved', storeId: normalizedStoreId, error: null }));\n    }, [bootstrapStoreData, storeResolution.normalizedHostname, systemUser?.email]);\n\n    // --- EFECTOS DE SINCRONIZACIÓN (FIREBASE) ---\n\n    // 0. Sincronizar Dark Mode con el DOM y localStorage\n    useEffect(() => {\n        // Aplicar/remover clase dark-mode en el body\n        if (darkMode) {\n            document.documentElement.classList.add('dark-mode');\n            document.body.classList.add('dark-mode');\n        } else {\n            document.documentElement.classList.remove('dark-mode');\n            document.body.classList.remove('dark-mode');\n        }\n        // Guardar preferencia en localStorage\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n    }, [darkMode]);\n\n    // 1. Sincronizar Carrito Local y Remoto (Live Cart)\n    useEffect(() => {\n        localStorage.setItem('sustore_cart', JSON.stringify(cart));\n\n        // Si hay usuario, subir carrito a DB para monitor de admin\n        if (appId && currentUser && currentUser.id) {\n            const syncCartToDB = async () => {\n                try {\n                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n                        userId: currentUser.id,\n                        userName: currentUser.name || 'Usuario', // Guardamos nombre (con fallback) para evitar errores\n                        items: cart.map(item => ({\n                            productId: item.product.id,\n                            quantity: item.quantity,\n                            name: item.product.name,\n                            price: item.product.basePrice\n                        })),\n                        lastUpdated: new Date().toISOString()\n                    }, { merge: true });\n                } catch (e) {\n                    console.error(\"Error syncing cart\", e);\n                }\n            };\n            // Debounce para no saturar escrituras (optimizado a 800ms)\n            const debounceTimer = setTimeout(syncCartToDB, 800);\n            return () => clearTimeout(debounceTimer);\n        }\n    }, [cart, currentUser, appId]);\n\n    useEffect(() => {\n        if (!currentUser?.id) return;\n        if (!appId) return;\n        if (cartHydratedFromRemoteRef.current) return;\n\n        let cancelled = false;\n        const hydrateCartFromRemote = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id));\n                if (!snap.exists()) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n                const data = snap.data() || {};\n                const remoteItems = Array.isArray(data.items) ? data.items : [];\n                if (remoteItems.length === 0) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n\n                const normalizedRemote = remoteItems\n                    .filter(i => i && i.productId && Number(i.quantity) > 0)\n                    .map(i => ({\n                        product: {\n                            id: i.productId,\n                            name: typeof i.name === 'string' ? i.name : '',\n                            basePrice: Number(i.price) || 0,\n                            image: '',\n                            category: ''\n                        },\n                        quantity: Number(i.quantity) || 1\n                    }));\n\n                if (normalizedRemote.length === 0) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n\n                // Solo hidratamos si el carrito local está vacío para evitar sobrescribir cambios recientes\n                // o si es la primera carga y decidimos que el remoto manda.\n                // Eliminamos la dependencia de 'cart' para evitar el bucle.\n                if (!cancelled) {\n                    setCart(prevCart => {\n                        if (prevCart.length === 0) return normalizedRemote;\n                        return prevCart; // Mantener local si ya hay algo\n                    });\n                    cartHydratedFromRemoteRef.current = true;\n                }\n            } catch (e) { \n                cartHydratedFromRemoteRef.current = true;\n            }\n        };\n\n        hydrateCartFromRemote();\n        return () => { cancelled = true; };\n    }, [appId, currentUser?.id]); // Eliminado 'cart' de las dependencias\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n\n        if (typeof settings?.ordersLastSeenIso !== 'string' && settingsLoaded && orders.length > 0 && latestOrderIso) {\n            markOrdersSeen(latestOrderIso);\n        }\n    }, [isAdminUser, settingsLoaded, settings?.ordersLastSeenIso, orders.length, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n        if (adminOrderAlarmMuted) {\n            stopOrderAlarm();\n            return;\n        }\n\n        const inOrdersTab = view === 'admin' && adminTab === 'orders';\n        if (hasUnseenOrders && !inOrdersTab) {\n            startOrderAlarm();\n        } else {\n            stopOrderAlarm();\n        }\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab, startOrderAlarm, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) return;\n        if (view !== 'admin' || adminTab !== 'orders') return;\n        if (!latestOrderIso) return;\n        markOrdersSeen(latestOrderIso);\n        stopOrderAlarm();\n    }, [isAdminUser, view, adminTab, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    // 1.1 Sincronizar precios y datos del carrito con productos actualizados\n    useEffect(() => {\n        if (products.length > 0 && cart.length > 0) {\n            setCart(prevCart => {\n                let hasChanges = false;\n                const newCart = prevCart.map(item => {\n                    // Buscar el producto actual en la lista maestra\n                    const currentProduct = products.find(p => p.id === item.product.id);\n\n                    if (currentProduct) {\n                        // Si el precio, nombre o imagen cambiaron, actualizamos el item del carrito\n                        if (currentProduct.basePrice !== (item.product?.basePrice ?? 0) ||\n                            currentProduct.name !== (item.product?.name ?? '') ||\n                            currentProduct.image !== (item.product?.image ?? '')) {\n                            hasChanges = true;\n                            return {\n                                ...item,\n                                product: {\n                                    ...currentProduct,\n                                    // Aseguramos que mantenemos la consistencia de tipos\n                                    basePrice: Number(currentProduct.basePrice) || 0\n                                }\n                            };\n                        }\n                    }\n                    return item;\n                });\n                return hasChanges ? newCart : prevCart;\n            });\n        }\n    }, [products]);\n\n\n\n    // 3. Sistema de Auto-Update\n    useEffect(() => {\n        if (!appId) return;\n        const configRef = doc(db, 'artifacts', appId, 'public', 'config');\n        const unsubscribe = onSnapshot(configRef, (snap) => {\n            if (snap.exists()) {\n                const data = snap.data();\n                if (data.version && data.version !== APP_VERSION) {\n                    console.log(`Nueva versión detectada: ${data.version}. Actualizando...`);\n                    window.location.reload();\n                }\n            }\n        });\n        return () => unsubscribe();\n    }, [appId]);\n    // 2. Persistencia Detallada y Session\n    useEffect(() => {\n        // Solo guardar usuarios con datos válidos completos\n        if (currentUser && currentUser.id && currentUser.email && currentUser.name) {\n            localStorage.setItem('sustore_user_data', JSON.stringify(currentUser));\n            // Pre-llenar checkout si hay datos\n            setCheckoutData(prev => ({\n                ...prev,\n                address: currentUser.address || prev.address,\n                city: currentUser.city || prev.city,\n                province: currentUser.province || prev.province,\n                zipCode: currentUser.zipCode || prev.zipCode\n            }));\n        } else if (!currentUser) {\n            // Si no hay usuario, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n        }\n        // Si currentUser existe pero no tiene datos válidos, no guardamos nada\n        // Esto evita persistir usuarios \"fantasma\" incompletos\n    }, [currentUser]);\n\n    // 3. Inicialización de Firebase Auth\n    useEffect(() => {\n        let didBootstrap = false;\n        let isBootstrapping = false;\n\n        const bootstrapAuth = async () => {\n            if (isBootstrapping) return;\n            isBootstrapping = true;\n            try {\n                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {\n                    await signInWithCustomToken(auth, __initial_auth_token);\n                } else {\n                    await signInAnonymously(auth);\n                }\n            } catch (e) {\n                console.error(\"Error en bootstrap Auth:\", e);\n            } finally {\n                isBootstrapping = false;\n            }\n        };\n\n        return onAuthStateChanged(auth, async (user) => {\n            setSystemUser(user);\n\n            if (!didBootstrap) {\n                didBootstrap = true;\n                if (!user) {\n                    setCurrentUser(null);\n                    await bootstrapAuth();\n                    setTimeout(() => setIsLoading(false), 300);\n                    return;\n                }\n            }\n\n            if (!user || user.isAnonymous) {\n                setCurrentUser(null);\n            }\n\n            setTimeout(() => setIsLoading(false), 300);\n        });\n    }, []);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (!systemUser || systemUser.isAnonymous) return;\n        let cancelled = false;\n        const loadProfile = async () => {\n            try {\n                const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', systemUser.uid);\n                const snap = await getDoc(userDocRef);\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const userData = { id: snap.id, ...snap.data() };\n                    if (userData.role === 'admin') userData._adminVerified = true;\n                    setCurrentUser(userData);\n                } else {\n                    setCurrentUser(null);\n                }\n            } catch {\n                if (!cancelled) setCurrentUser(null);\n            }\n        };\n        loadProfile();\n        return () => { cancelled = true; };\n    }, [appId, systemUser?.uid, systemUser?.isAnonymous]);\n\n    // CSS Variable Injection for Dynamic Theme Colors\n    useEffect(() => {\n        if (settings) {\n            const primaryColor = settings.primaryColor || '#f97316';\n            const secondaryColor = settings.secondaryColor || '#8b5cf6';\n            const accentColor = settings.accentColor || '#22c55e';\n\n            // Create or update the dynamic theme style element\n            let styleEl = document.getElementById('dynamic-theme-styles');\n            if (!styleEl) {\n                styleEl = document.createElement('style');\n                styleEl.id = 'dynamic-theme-styles';\n                document.head.appendChild(styleEl);\n            }\n\n            // Generate comprehensive CSS overrides for the theme\n            styleEl.textContent = `\n                :root {\n                    --color-primary: ${primaryColor};\n                    --color-secondary: ${secondaryColor};\n                    --color-accent: ${accentColor};\n                }\n                \n                /* Primary color overrides */\n                .text-orange-400, .text-orange-500 { color: ${primaryColor} !important; }\n                .bg-orange-400, .bg-orange-500 { background-color: ${primaryColor} !important; }\n                .bg-orange-900\\\\/10, .bg-orange-900\\\\/20 { background-color: ${primaryColor}1a !important; }\n                .border-orange-500, .border-orange-500\\\\/20, .border-orange-500\\\\/30, .border-orange-500\\\\/50 { border-color: ${primaryColor} !important; }\n                .hover\\\\:text-orange-400:hover { color: ${primaryColor} !important; }\n                .hover\\\\:bg-orange-400:hover, .hover\\\\:bg-orange-500:hover { background-color: ${primaryColor} !important; }\n                .hover\\\\:border-orange-500:hover, .hover\\\\:border-orange-500\\\\/30:hover, .hover\\\\:border-orange-500\\\\/50:hover { border-color: ${primaryColor} !important; }\n                .focus-within\\\\:border-orange-500\\\\/50:focus-within { border-color: ${primaryColor}80 !important; }\n                .from-orange-400 { --tw-gradient-from: ${primaryColor} !important; }\n                .to-orange-500 { --tw-gradient-to: ${primaryColor} !important; }\n                .shadow-orange-500\\\\/30, .shadow-orange-600\\\\/30 { --tw-shadow-color: ${primaryColor}4d !important; }\n                .ring-orange-500 { --tw-ring-color: ${primaryColor} !important; }\n                .selection\\\\:bg-orange-500\\\\/30 ::selection { background-color: ${primaryColor}4d !important; }\n                .selection\\\\:text-orange-200 ::selection { color: ${primaryColor} !important; }\n                \n                /* Secondary color overrides */\n                .text-purple-400, .text-purple-500 { color: ${secondaryColor} !important; }\n                .bg-purple-400, .bg-purple-500 { background-color: ${secondaryColor} !important; }\n                .bg-purple-900\\\\/10, .bg-purple-900\\\\/20 { background-color: ${secondaryColor}1a !important; }\n                .border-purple-500, .border-purple-500\\\\/20 { border-color: ${secondaryColor} !important; }\n                .hover\\\\:text-purple-400:hover { color: ${secondaryColor} !important; }\n                .from-purple-500, .from-purple-600 { --tw-gradient-from: ${secondaryColor} !important; }\n                \n                /* Accent color overrides */\n                .text-green-400, .text-green-500 { color: ${accentColor} !important; }\n                .bg-green-400, .bg-green-500, .bg-green-600 { background-color: ${accentColor} !important; }\n                .bg-green-900\\\\/10 { background-color: ${accentColor}1a !important; }\n                .border-green-500, .border-green-500\\\\/20, .border-green-500\\\\/30 { border-color: ${accentColor} !important; }\n                .hover\\\\:text-green-400:hover { color: ${accentColor} !important; }\n                .hover\\\\:bg-green-400:hover, .hover\\\\:bg-green-500:hover { background-color: ${accentColor} !important; }\n                .shadow-green-500\\\\/30, .shadow-green-600\\\\/30 { --tw-shadow-color: ${accentColor}4d !important; }\n                \n                /* Neon text effect with primary color */\n                .neon-text {\n                    text-shadow: 0 0 10px ${primaryColor}40, 0 0 20px ${primaryColor}20, 0 0 30px ${primaryColor}10 !important;\n                }\n            `;\n        }\n    }, [settings?.primaryColor, settings?.secondaryColor, settings?.accentColor]);\n\n    // Dark/Light Mode Effect\n    useEffect(() => {\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n\n        let lightModeStyle = document.getElementById('light-mode-styles');\n        if (!lightModeStyle) {\n            lightModeStyle = document.createElement('style');\n            lightModeStyle.id = 'light-mode-styles';\n            document.head.appendChild(lightModeStyle);\n        }\n\n        if (view === 'admin') {\n            lightModeStyle.textContent = '';\n            return;\n        }\n\n        if (!darkMode) {\n            // Light mode styles\n            lightModeStyle.textContent = `\n                /* Light Mode Overrides */\n                body, .bg-\\\\[\\\\#050505\\\\], .bg-\\\\[\\\\#0a0a0a\\\\], .bg-\\\\[\\\\#080808\\\\], .bg-\\\\[\\\\#111\\\\], .bg-black {\n                    background-color: #f8fafc !important;\n                }\n                .bg-\\\\[\\\\#1a1a1a\\\\], .bg-zinc-800 { background-color: #ffffff !important; }\n                .hover\\\\:bg-zinc-700:hover { background-color: #e2e8f0 !important; }\n                .bg-grid {\n                    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),\n                                      linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px) !important;\n                }\n                .text-white { color: #0f172a !important; }\n                .text-white\\\\/50, .text-white\\\\/60, .text-white\\\\/70, .text-white\\\\/80 { color: #475569 !important; }\n                .hover\\\\:text-white:hover { color: #0f172a !important; }\n                .text-slate-200 { color: #334155 !important; }\n                .text-slate-300, .text-slate-400, .text-slate-500, .text-slate-600 { color: #64748b !important; }\n                .bg-slate-900, .bg-slate-900\\\\/50, .bg-slate-800 { background-color: #ffffff !important; }\n                .bg-slate-900\\\\/30 { background-color: rgba(255,255,255,0.8) !important; }\n                .border-slate-700, .border-slate-700\\\\/50, .border-slate-800, .border-slate-800\\\\/50, .border-slate-900 { \n                    border-color: #e2e8f0 !important; \n                }\n                .border-white\\\\/5, .border-white\\\\/10, .border-white\\\\/20 { border-color: #e2e8f0 !important; }\n                .fill-white { fill: #0f172a !important; }\n                .stroke-white { stroke: #0f172a !important; }\n                .glass {\n                    background: rgba(255, 255, 255, 0.95) !important;\n                    border-color: #e2e8f0 !important;\n                }\n                .input-cyber {\n                    background-color: #f1f5f9 !important;\n                    border-color: #e2e8f0 !important;\n                    color: #0f172a !important;\n                }\n                .input-cyber::placeholder { color: #94a3b8 !important; }\n                .input-cyber:focus { border-color: var(--color-primary, #f97316) !important; }\n                \n                /* Cards and containers */\n                .rounded-\\\\[2rem\\\\], .rounded-\\\\[2\\\\.5rem\\\\], .rounded-\\\\[1\\\\.5rem\\\\] {\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.05) !important;\n                }\n                \n                /* Footer */\n                footer.bg-\\\\[\\\\#050505\\\\] { background-color: #0f172a !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900, \n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900\\\\/50,\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-800 { background-color: rgba(255,255,255,0.06) !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .border-slate-800 { border-color: rgba(255,255,255,0.10) !important; }\n                footer .text-white { color: #ffffff !important; }\n                footer .text-slate-500, footer .text-slate-400, footer .text-slate-600 { color: #94a3b8 !important; }\n                \n                /* Admin panel stays dark */\n                [class*=\"admin\"] .bg-\\\\[\\\\#050505\\\\] { background-color: #050505 !important; }\n            `;\n        } else {\n            lightModeStyle.textContent = '';\n        }\n    }, [darkMode, view]);\n\n    // 4. Suscripciones a Colecciones (Snapshot Listeners)\n    // - Público: se mantiene realtime solo donde aporta (products + settings)\n    // - Resto: se carga por demanda inicial (getDocs) para evitar listeners extra\n    // - Admin: listeners solo cuando el panel Admin está activo (view === 'admin')\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const unsubscribeFunctions = [];\n        let cancelled = false;\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'products'), (snapshot) => {\n                const productsData = snapshot.docs.map(d => {\n                    const data = d.data();\n                    return { id: d.id, ...data, stock: Number(data.stock) || 0 };\n                });\n                setProducts(productsData);\n                if (cart.length === 0) setIsLoading(false);\n            }, (error) => {\n                console.error(\"Error fetching products:\", error);\n                if (error?.code === 'permission-denied' || String(error?.message || '').includes('permission')) {\n                    showToast(\"Error de permisos. Reiniciando sesión...\", \"warning\");\n                    setTimeout(() => {\n                        auth.signOut().then(() => window.location.reload());\n                    }, 2000);\n                } else {\n                    showToast(\"Error al cargar productos: \" + (error?.message || 'error'), \"error\");\n                }\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), (snap) => {\n                if (snap.exists()) {\n                    const data = snap.data();\n                    const team = data.team || defaultSettings.team;\n                    const teamRoles = (data.teamRoles && typeof data.teamRoles === 'object')\n                        ? data.teamRoles\n                        : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n\n                    const mergedSettings = {\n                        ...defaultSettings,\n                        ...data,\n                        team,\n                        teamRoles,\n                        categories: data.categories || defaultSettings.categories\n                    };\n\n                    setSettings(mergedSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(data.aboutUsText || defaultSettings.aboutUsText);\n                } else {\n                    setSettings(defaultSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(defaultSettings.aboutUsText);\n                }\n            })\n        );\n\n        (async () => {\n            try {\n                const promosSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'promos'));\n                if (!cancelled) setPromos(promosSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setPromos([]);\n            }\n\n            try {\n                const bannersSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'));\n                if (!cancelled) {\n                    const banners = bannersSnap.docs.map(d => ({ id: d.id, ...d.data() }));\n                    banners.sort((a, b) => {\n                        const ao = Number.isFinite(Number(a.order)) ? Number(a.order) : 0;\n                        const bo = Number.isFinite(Number(b.order)) ? Number(b.order) : 0;\n                        if (ao !== bo) return ao - bo;\n                        const ad = typeof a.createdAt === 'string' ? a.createdAt : '';\n                        const bd = typeof b.createdAt === 'string' ? b.createdAt : '';\n                        return ad.localeCompare(bd);\n                    });\n                    setHomeBanners(banners);\n                }\n            } catch {\n                if (!cancelled) setHomeBanners([]);\n            }\n\n            try {\n                const couponsSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'));\n                if (!cancelled) setCoupons(couponsSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setCoupons([]);\n            }\n        })();\n\n        return () => {\n            cancelled = true;\n            unsubscribeFunctions.forEach(unsub => unsub());\n        };\n    }, [systemUser, appId]);\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const isAuthenticatedUser = systemUser && !systemUser.isAnonymous;\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n\n        if (!isAuthenticatedUser) {\n            setOrders([]);\n            return;\n        }\n\n        if (isAdminUser && !isAdminViewActive) {\n            setOrders([]);\n            return;\n        }\n\n        const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');\n        \n        let q;\n        if (isAdminUser) {\n            const constraints = [orderBy('date', 'desc'), limit(ordersLimit)];\n            if (ordersCursor) constraints.push(startAfter(ordersCursor));\n            q = query(ordersRef, ...constraints);\n        } else {\n            q = query(ordersRef, where('customerId', '==', systemUser.uid), orderBy('date', 'desc'), limit(50));\n        }\n\n        return onSnapshot(q, (snapshot) => {\n            const ordersData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n            \n            if (isAdminUser) {\n                setHasMoreOrders(snapshot.docs.length === ordersLimit);\n                // No actualizamos el cursor aquí para evitar bucles infinitos si onSnapshot dispara\n                // El cursor solo se actualiza manualmente al cambiar de página\n            }\n\n            if (!isAdminUser) {\n                const getDateMs = (value) => {\n                    if (!value) return 0;\n                    if (typeof value?.toMillis === 'function') return value.toMillis();\n                    const ms = Date.parse(String(value));\n                    return Number.isFinite(ms) ? ms : 0;\n                };\n                ordersData.sort((a, b) => getDateMs(b.date) - getDateMs(a.date));\n            }\n            setOrders(ordersData);\n        }, (err) => {\n            console.error(\"Orders Snapshot Error:\", err);\n            setOrders([]);\n        });\n    }, [systemUser, currentUser?.role, appId, view, ordersLimit, ordersCursor]);\n\n    const handleNextOrders = () => {\n        if (!hasMoreOrders || orders.length === 0) return;\n        // Necesitamos el DocumentSnapshot real. Como onSnapshot no nos lo da persistente,\n        // vamos a tener que buscarlo en la colección o cambiar a getDocs para paginación.\n        // Por ahora, buscaremos el último doc de la lista actual.\n        const lastId = orders[orders.length - 1].id;\n        getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', lastId)).then(snap => {\n            if (snap.exists()) {\n                setOrdersHistory(prev => [...prev, ordersCursor]);\n                setOrdersCursor(snap);\n            }\n        });\n    };\n\n    const handlePrevOrders = () => {\n        if (ordersHistory.length === 0) return;\n        const prevCursor = ordersHistory[ordersHistory.length - 1];\n        setOrdersCursor(prevCursor);\n        setOrdersHistory(prev => prev.slice(0, -1));\n    };\n\n    useEffect(() => {\n        if (!appId) return;\n\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n        if (!(isAdminUser && isAdminViewActive)) {\n            setUsers([]);\n            setSuppliers([]);\n            setExpenses([]);\n            setPurchases([]);\n            setInvestments([]);\n            setLiveCarts([]);\n            return;\n        }\n\n        const unsubscribeFunctions = [];\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'users'), snapshot => {\n                setUsers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), snapshot => {\n                setSuppliers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), snapshot => {\n                setExpenses(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), snapshot => {\n                setPurchases(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), snapshot => {\n                setInvestments(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'carts'), snapshot => {\n                const activeCarts = snapshot.docs\n                    .map(d => ({ id: d.id, ...d.data() }))\n                    .filter(c => c.items && c.items.length > 0);\n                setLiveCarts(activeCarts);\n            })\n        );\n\n        return () => unsubscribeFunctions.forEach(unsub => unsub());\n    }, [currentUser?.role, appId, view]);\n\n    // --- VALIDACIÓN INTELIGENTE DEL CARRITO ---\n    // Elimina automáticamente productos que ya no existen o no tienen stock\n    const productsById = useMemo(() => {\n        const map = new Map();\n        for (const p of products) map.set(String(p.id).trim(), p);\n        return map;\n    }, [products]);\n\n    const lastSyncedCartRef = useRef(null);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (products.length === 0) return;\n        if (!currentUser) return;\n        if (cart.length === 0) return;\n\n        let changed = false;\n        const removed = [];\n\n        const validated = cart.filter(item => {\n            const itemId = String(item.product?.id || '').trim();\n            const productInStore = productsById.get(itemId);\n            if (!productInStore) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Producto eliminado)`);\n                return false;\n            }\n            if (productInStore.isActive === false) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (No disponible actualmente)`);\n                return false;\n            }\n            if (productInStore.isPromo && Array.isArray(productInStore.items)) {\n                const ok = productInStore.items.every(comp => {\n                    const cid = String(comp?.productId || '').trim();\n                    const cp = productsById.get(cid);\n                    return !!cp && cp.isActive !== false;\n                });\n                if (!ok) {\n                    changed = true;\n                    removed.push(`${item.product?.name || 'Promo'} (Componente inválido)`);\n                    return false;\n                }\n            }\n            if (!(Number(productInStore.stock) > 0)) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Sin Stock)`);\n                return false;\n            }\n            return true;\n        }).map(item => {\n            const fresh = productsById.get(String(item.product?.id || '').trim());\n            if (fresh && ((item.product?.basePrice ?? 0) !== fresh.basePrice || (item.product?.discount ?? 0) !== fresh.discount)) {\n                changed = true;\n            }\n            return { ...item, product: fresh || item.product };\n        });\n\n        if (!changed) return;\n\n        setCart(validated);\n\n        const payload = JSON.stringify(validated.map(i => ({ id: String(i.product?.id || ''), q: i.quantity, p: i.product?.basePrice, d: i.product?.discount })));\n        if (lastSyncedCartRef.current === payload) return;\n        lastSyncedCartRef.current = payload;\n\n        setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n            userId: currentUser.id,\n            items: validated\n        }, { merge: true });\n\n        if (removed.length > 0) {\n            showToast(`Tu carrito se actualizó: ${removed.join(', ')}`, 'info');\n        }\n    }, [productsById, currentUser?.id, cart, appId]);\n\n    // --- EFECTO VISUAL: SEO, FAVICON Y TÍTULO DINÁMICO ---\n\n    const lastSavedSettingsRef = useRef(null);\n\n    // Actualiza todas las meta tags de SEO según la configuración de la tienda\n    useEffect(() => {\n        // IMPORTANTE: Esperar a que la configuración cargue realmente para evitar \"parpadeo\" del logo default\n        if (!appId) return;\n        if (!settingsLoaded || !settings) return;\n\n        const currentSettingsStr = JSON.stringify(settings);\n\n        // Prevent infinite loop: Only save if content changed\n        if (lastSavedSettingsRef.current === currentSettingsStr) {\n            return;\n        }\n\n        // Auto-Save Settings Logic (Debounced)\n        const autoSaveTimer = setTimeout(async () => {\n            try {\n                if (currentUser?.role !== 'admin') {\n                    lastSavedSettingsRef.current = currentSettingsStr;\n                    return;\n                }\n                const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                const team = settings?.team || defaultSettings.team;\n                const teamRoles = (settings?.teamRoles && typeof settings.teamRoles === 'object')\n                    ? settings.teamRoles\n                    : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n                const settingsToSave = { ...settings, teamRoles };\n                // Use merge true to be safe, though we usually have the full object\n                await setDoc(settingsRef, settingsToSave, { merge: true });\n\n                // Update the ref to match what we just saved\n                lastSavedSettingsRef.current = JSON.stringify(settingsToSave);\n\n                console.log(\"[AutoSave] Settings saved successfully.\");\n            } catch (error) {\n                console.error(\"[AutoSave] Error saving settings:\", error);\n            }\n        }, 2000); // 2 seconds debounce\n\n        // Helper para actualizar meta tags de forma segura\n        const updateMetaTag = (selector, content) => {\n            const element = document.querySelector(selector);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateMetaTagById = (id, content) => {\n            const element = document.getElementById(id);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateLinkTag = (id, href) => {\n            const element = document.getElementById(id);\n            if (element && href) {\n                element.setAttribute('href', href);\n            }\n        };\n\n        // 1. Título de la Pestaña\n        const pageTitle = settings.seoTitle || (settings.storeName ? `${settings.storeName} - Tienda Online` : 'Tienda Online');\n        document.title = pageTitle;\n\n        // 2. Meta Description\n        const description = settings.seoDescription || `${settings.storeName || 'Tienda'} - Tu tienda online de confianza.`;\n        updateMetaTagById('meta-description', description);\n\n        // 3. Meta Keywords\n        const keywords = settings.seoKeywords || `${settings.storeName || 'tienda'}, productos, comprar, envíos`;\n        updateMetaTagById('meta-keywords', keywords);\n\n        // 4. Meta Author\n        const author = settings.seoAuthor || settings.storeName || 'Tienda Online';\n        updateMetaTagById('meta-author', author);\n\n        // 5. Apple Mobile Web App Title\n        updateMetaTagById('meta-apple-title', settings.storeName || 'Tienda');\n\n        // 6. Theme Color\n        if (settings.primaryColor) {\n            updateMetaTagById('meta-theme-color', settings.primaryColor);\n        }\n\n        // 7. Canonical URL\n        if (settings.seoUrl) {\n            updateLinkTag('link-canonical', settings.seoUrl);\n        }\n\n        // 8. Open Graph Tags\n        const ogImage = settings.seoImage || settings.logoUrl || settings.heroUrl || '';\n        updateMetaTagById('og-title', pageTitle);\n        updateMetaTagById('og-description', description);\n        updateMetaTagById('og-site-name', settings.storeName || 'Tienda Online');\n        if (settings.seoUrl) {\n            updateMetaTagById('og-url', settings.seoUrl);\n        }\n        if (ogImage) {\n            updateMetaTagById('og-image', ogImage);\n        }\n\n        // 9. Twitter Card Tags\n        updateMetaTagById('twitter-title', pageTitle);\n        updateMetaTagById('twitter-description', description);\n        if (ogImage) {\n            updateMetaTagById('twitter-image', ogImage);\n        }\n\n        // 10. Favicon (Icono de Pestaña) - Auto Circular\n        const link = document.getElementById('dynamic-favicon') || document.querySelector(\"link[rel*='icon']\");\n        if (link) {\n            if (settings.logoUrl) {\n                // Intentar recortar la imagen en círculo para el favicon\n                const img = new Image();\n                img.crossOrigin = 'Anonymous';\n                img.onload = () => {\n                    try {\n                        const canvas = document.createElement('canvas');\n                        canvas.width = 64;\n                        canvas.height = 64;\n                        const ctx = canvas.getContext('2d');\n                        // Crear círculo\n                        ctx.beginPath();\n                        ctx.arc(32, 32, 32, 0, Math.PI * 2);\n                        ctx.closePath();\n                        ctx.clip();\n                        // Dibujar imagen\n                        ctx.drawImage(img, 0, 0, 64, 64);\n                        link.href = canvas.toDataURL('image/png');\n                    } catch (e) {\n                        // Fallback si falla canvas (ej: CORS estricto)\n                        link.href = settings.logoUrl;\n                    }\n                };\n                img.onerror = () => { link.href = settings.logoUrl; };\n                img.src = settings.logoUrl;\n            } else {\n                // Si no hay logo configurado, usar el default circular\n                link.href = '/icon-192.png';\n            }\n        }\n\n        console.log('[SEO & AutoSave] Updated and Autosaved.');\n\n        return () => clearTimeout(autoSaveTimer);\n    }, [settings, settingsLoaded, currentUser?.role]);\n\n    // ⚠️ [PAUSA POR SEGURIDAD] - El código continúa con la lógica expandida. Escribe \"continuar\" para la siguiente parte.\n    // --- LÓGICA DE NEGOCIO Y FUNCIONES PRINCIPALES ---\n\n    // 1. Lógica de Autenticación (Firebase Auth + Perfil en Firestore)\n    const handleAuth = async (isRegister) => {\n        setIsLoading(true);\n        try {\n            const superAdminAttempt = String(authData.email || '').trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n            const normalizedHostname = String(window.location.hostname || '').trim().toLowerCase();\n            const isLocalhost = normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1' || normalizedHostname === '::1';\n            if (!appId && !superAdminAttempt) {\n                throw new Error('Tienda no configurada para este dominio.');\n            }\n            const usersPath = appId ? ['artifacts', appId, 'public', 'data', 'users'] : null;\n\n            const fetchProfile = async (uid) => {\n                if (!usersPath) return null;\n                const snap = await getDoc(doc(db, ...usersPath, uid));\n                return snap.exists() ? { id: snap.id, ...snap.data() } : null;\n            };\n\n            const setupProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                const res = await fetch('/api/auth/setup-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({\n                        name: authData.name,\n                        username: authData.username,\n                        dni: authData.dni,\n                        phone: authData.phone\n                    })\n                });\n                const data = await res.json().catch(() => ({}));\n                if (!res.ok) throw new Error(data.error || 'Error al crear el perfil');\n            };\n\n            const claimLegacyProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                await fetch('/api/auth/claim-legacy-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({})\n                });\n            };\n\n            if (isRegister) {\n                const normalizedEmail = authData.email.trim().toLowerCase();\n                if (!authData.name || authData.name.trim().length < 3) throw new Error(\"El nombre es muy corto.\");\n                if (!authData.username || authData.username.trim().length < 3) throw new Error(\"Debes elegir un nombre de usuario.\");\n                if (!normalizedEmail || !normalizedEmail.includes('@')) throw new Error(\"Email inválido.\");\n                if (!authData.password || authData.password.length < 6) throw new Error(\"La contraseña debe tener al menos 6 caracteres.\");\n                if (!authData.dni || authData.dni.trim().length < 6) throw new Error(\"Debes ingresar tu DNI (mínimo 6 dígitos).\");\n                if (!authData.phone || authData.phone.trim().length < 8) throw new Error(\"Debes ingresar tu teléfono (mínimo 8 dígitos).\");\n\n                const userCredential = await createUserWithEmailAndPassword(auth, normalizedEmail, authData.password);\n                try {\n                    await setupProfile(userCredential.user);\n                } catch (e) {\n                    try { await userCredential.user.delete(); } catch { }\n                    throw e;\n                }\n\n                const profile = await fetchProfile(userCredential.user.uid);\n                if (!profile) throw new Error('No se pudo cargar el perfil');\n\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(\"¡Cuenta creada exitosamente! Bienvenido.\", \"success\");\n            } else {\n                const input = authData.email.trim();\n                if (!input) throw new Error(\"Ingresa tu email o usuario.\");\n                if (!authData.password) throw new Error(\"Ingresa tu contraseña.\");\n\n                let emailToUse = input.toLowerCase();\n                let authUser = null;\n\n                if (!input.includes('@')) {\n                    const res = await fetch('/api/auth/username-lookup', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                        body: JSON.stringify({ username: input })\n                    });\n                    const data = await res.json().catch(() => ({}));\n                    if (!res.ok) throw new Error(\"Usuario no encontrado.\");\n                    emailToUse = String(data.email || '').toLowerCase();\n                }\n\n                try {\n                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                    authUser = userCredential.user;\n                } catch (e) {\n                    const code = e?.code || '';\n                    const invalidCredentialCodes = new Set(['auth/invalid-credential', 'auth/invalid-login-credentials']);\n                    if (code === 'auth/user-not-found' || invalidCredentialCodes.has(code)) {\n                        const res = await fetch('/api/auth/legacy-login', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                            body: JSON.stringify({ identifier: input, password: authData.password })\n                        });\n                        const raw = await res.text().catch(() => '');\n                        let data = {};\n                        try { data = raw ? JSON.parse(raw) : {}; } catch { data = {}; }\n                        if (!res.ok || !data?.token) {\n                            if (res.status === 401) {\n                                const looksLikeVercel = /<html/i.test(raw) || /login\\s*–\\s*vercel/i.test(raw) || /vercel/i.test(raw);\n                                if (looksLikeVercel) {\n                                    throw new Error('Tu despliegue está respondiendo 401 (Vercel protegido). Desactivá Deployment Protection / Vercel Authentication o hacé el sitio público.');\n                                }\n                                throw new Error('Credenciales incorrectas.');\n                            }\n                            if (data?.code === 'firebase_admin_not_configured') {\n                                throw new Error(data.error || 'Backend no configurado (Firebase Admin)');\n                            }\n                            if (superAdminAttempt) {\n                                if (!isLocalhost) {\n                                    throw new Error('El Super Admin no se inicializa desde Vercel. Crealo en Firebase Auth (Authentication > Users) o inicializalo en localhost.');\n                                }\n                                const bootRes = await fetch('/api/auth/bootstrap-super-admin', {\n                                    method: 'POST',\n                                    headers: { 'Content-Type': 'application/json' },\n                                    body: JSON.stringify({ email: emailToUse, password: authData.password })\n                                });\n                                if (bootRes.ok) {\n                                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                                    authUser = userCredential.user;\n                                } else {\n                                    const bootData = await bootRes.json().catch(() => ({}));\n                                    throw new Error(bootData?.error || 'No se pudo inicializar el Super Admin');\n                                }\n                            }\n                            if (!authUser) {\n                                throw new Error(data.error || 'No se pudo recuperar tu cuenta legacy');\n                            }\n                        }\n                        const userCredential = await signInWithCustomToken(auth, data.token);\n                        authUser = userCredential.user;\n                    } else if (code === 'auth/wrong-password') {\n                        throw new Error(\"La contraseña es incorrecta.\");\n                    } else if (code === 'auth/too-many-requests') {\n                        throw new Error(\"Demasiados intentos fallidos. Intenta más tarde o restablece tu contraseña.\");\n                    } else {\n                        throw e;\n                    }\n                }\n\n                if (!authUser) throw new Error('Error al iniciar sesión');\n\n                if (!usersPath) {\n                    const normalizedEmailLower = String(authUser.email || emailToUse).toLowerCase();\n                    const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                    setCurrentUser({\n                        id: authUser.uid,\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: superEmailLower && normalizedEmailLower === superEmailLower ? 'admin' : 'user',\n                    });\n                    showToast('Sesión iniciada. Vinculá el dominio para cargar la tienda.', 'success');\n                    setView('store');\n                    setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n                    return;\n                }\n\n                let profile = await fetchProfile(authUser.uid);\n                if (!profile) {\n                    await claimLegacyProfile(authUser);\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                if (!profile) {\n                    const minimal = {\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: String(authUser.email || emailToUse).trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase() ? 'admin' : 'user',\n                        createdAt: new Date().toISOString()\n                    };\n                    await setDoc(doc(db, ...usersPath, authUser.uid), minimal, { merge: true });\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                await updateDoc(doc(db, ...usersPath, authUser.uid), { lastLogin: new Date().toISOString() }).catch(() => { });\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(`¡Hola de nuevo, ${profile?.name || 'Usuario'}!`, \"success\");\n            }\n\n            setView('store');\n            setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n        } catch (error) {\n            console.error(\"Error de autenticación:\", error);\n            showToast(error.message || 'Error de autenticación', \"error\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 1.1 Recuperar Contraseña\n    const handleForgotPassword = async () => {\n        if (!authData.email || !authData.email.includes('@')) {\n            showToast(\"Ingresa tu email en el campo de arriba para recuperar la contraseña.\", \"warning\");\n            return;\n        }\n        setIsLoading(true);\n        try {\n            await sendPasswordResetEmail(auth, authData.email);\n            showToast(\"¡Listo! Revisa tu email (y spam) para restablecer tu contraseña.\", \"success\");\n        } catch (e) {\n            console.error(\"Error reset pass:\", e);\n            if (e.code === 'auth/user-not-found') {\n                showToast(\"No existe una cuenta registrada con este email.\", \"error\");\n            } else {\n                showToast(\"Error al enviar email: \" + e.message, \"error\");\n            }\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 2. Gestión de Favoritos (Wishlist)\n    const toggleFavorite = async (product) => {\n        if (!currentUser) {\n            showToast(\"Debes iniciar sesión para guardar favoritos.\", \"info\");\n            return;\n        }\n\n        const currentFavs = currentUser.favorites || [];\n        const isAlreadyFav = currentFavs.includes(product.id);\n        let newFavs = [];\n\n        if (isAlreadyFav) {\n            // Eliminar de favoritos\n            newFavs = currentFavs.filter(id => id !== product.id);\n            showToast(\"Eliminado de tus favoritos.\", \"info\");\n        } else {\n            // Agregar a favoritos\n            newFavs = [...currentFavs, product.id];\n            showToast(\"¡Guardado en favoritos!\", \"success\");\n        }\n\n        // Actualización Optimista (UI instantánea)\n        setCurrentUser(prev => ({ ...prev, favorites: newFavs }));\n\n        // Persistencia en Firebase\n        try {\n            const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', currentUser.id);\n            await updateDoc(userRef, { favorites: newFavs });\n        } catch (e) {\n            console.error(\"Error guardando favorito:\", e);\n            // Revertir si falla (opcional, por simplicidad no lo incluimos pero sería ideal)\n        }\n    };\n\n    // 3. Gestión del Carrito\n    const manageCart = (product, quantityDelta) => {\n        setCart(prevCart => {\n            const existingItemIndex = prevCart.findIndex(item => item.product.id === product.id);\n            const currentQuantity = existingItemIndex >= 0 ? prevCart[existingItemIndex].quantity : 0;\n            const newQuantity = currentQuantity + quantityDelta;\n\n            // Validaciones de Stock (Manejo Dual: Producto Normal vs Promo)\n            let currentStock = 0;\n\n            if (product.isPromo) {\n                // Recalcular stock virtual al momento de agregar (por seguridad)\n                let maxPurchasable = Infinity;\n                product.items.forEach(item => {\n                    const p = products.find(prod => prod.id === item.productId);\n                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                });\n                currentStock = maxPurchasable;\n            } else {\n                currentStock = Number(product.stock);\n            }\n\n            if (newQuantity > currentStock) {\n                showToast(`Lo sentimos, el stock máximo disponible es ${currentStock}.`, \"warning\");\n                return prevCart;\n            }\n\n            // Eliminar item si cantidad llega a 0\n            if (newQuantity <= 0) {\n                if (existingItemIndex >= 0) {\n                    showToast(\"Producto eliminado del carrito.\", \"info\");\n                    return prevCart.filter(item => item.product.id !== product.id);\n                }\n                return prevCart;\n            }\n\n            // Actualizar o Agregar\n            if (existingItemIndex >= 0) {\n                // Actualizar cantidad existente\n                const updatedCart = [...prevCart];\n                updatedCart[existingItemIndex] = { ...updatedCart[existingItemIndex], quantity: newQuantity };\n                return updatedCart;\n            } else {\n                // Agregar nuevo item\n                showToast(\"¡Producto agregado al carrito!\", \"success\");\n                return [...prevCart, { product: product, quantity: newQuantity }];\n            }\n        });\n    };\n\n    // 4. Cálculos de Precios y Descuentos\n    const calculateItemPrice = (basePrice, discount) => {\n        if (!discount || discount <= 0) return Number(basePrice);\n        const discounted = Number(basePrice) * (1 - discount / 100);\n        return Math.ceil(discounted);\n    };\n\n    const cartSubtotal = useMemo(() => {\n        return cart.reduce((total, item) => {\n            const price = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            return total + (price * (item.quantity || 0));\n        }, 0);\n    }, [cart]);\n\n    // Aplicar lógica compleja de cupones\n    const calculateDiscountAmount = (total, coupon) => {\n        if (!coupon) return 0;\n\n        // Validar expiración y límites nuevamente por seguridad\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return 0;\n\n        let discountValue = 0;\n\n        if (coupon.type === 'fixed') {\n            discountValue = coupon.value;\n            // No descontar más que el total\n            if (discountValue > total) discountValue = total;\n        } else if (coupon.type === 'percentage') {\n            discountValue = total * (coupon.value / 100);\n            // Aplicar tope si existe\n            if (coupon.maxDiscount && coupon.maxDiscount > 0) {\n                if (discountValue > coupon.maxDiscount) {\n                    discountValue = coupon.maxDiscount;\n                }\n            }\n        }\n\n        return Math.ceil(discountValue);\n    };\n\n    const buildWhatsappUrl = (baseLink, message) => {\n        const trimmed = (baseLink || '').trim();\n        if (!trimmed) return null;\n        try {\n            const url = new URL(trimmed);\n            url.searchParams.set('text', message);\n            return url.toString();\n        } catch {\n            const digits = trimmed.replace(/[^\\d]/g, '');\n            if (!digits) return null;\n            return `https://wa.me/${digits}?text=${encodeURIComponent(message)}`;\n        }\n    };\n\n    const isCouponValidForWhatsapp = (coupon) => {\n        if (!coupon) return false;\n        if (coupon.targetType === 'specific_email' && currentUser?.email) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) return false;\n        }\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return false;\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) return false;\n        if (cartSubtotal < (coupon.minPurchase || 0)) return false;\n        if (!currentUser?.dni) return false;\n        return true;\n    };\n\n    const buildWhatsappCartMessage = () => {\n        const currency = settings?.currency || '$';\n        const storeName = settings?.storeName || 'la tienda';\n\n        const lines = [];\n        lines.push(`Hola, quiero terminar mi compra por WhatsApp en ${storeName}.`);\n\n        if (currentUser?.name) {\n            const userBits = [currentUser.name];\n            if (currentUser.email) userBits.push(currentUser.email);\n            if (currentUser.phone) userBits.push(currentUser.phone);\n            lines.push(`Cliente: ${userBits.join(' - ')}`);\n        } else if (currentUser?.email) {\n            lines.push(`Cliente: ${currentUser.email}`);\n        }\n\n        lines.push('');\n        lines.push('Mi carrito:');\n\n        cart.forEach((item) => {\n            const name = item.product?.name || 'Producto';\n            const quantity = Number(item.quantity) || 0;\n            const unit = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            const lineTotal = Math.ceil(unit * quantity);\n            lines.push(`- ${quantity} x ${name} — ${currency}${unit.toLocaleString()} c/u — ${currency}${lineTotal.toLocaleString()}`);\n        });\n\n        const couponToUse = isCouponValidForWhatsapp(appliedCoupon) ? appliedCoupon : null;\n        const couponDiscount = couponToUse ? calculateDiscountAmount(cartSubtotal, couponToUse) : 0;\n        const messageSubtotal = Math.max(0, Number(cartSubtotal) || 0);\n        const messageShipping = Math.max(0, Number(shippingFee) || 0);\n        const messageTotal = Math.max(0, messageSubtotal - couponDiscount + messageShipping);\n\n        lines.push('');\n        lines.push(`Subtotal: ${currency}${messageSubtotal.toLocaleString()}`);\n\n        if (couponToUse && couponDiscount > 0) {\n            lines.push(`Cupón: ${couponToUse.code}`);\n            lines.push(`Descuento: -${currency}${couponDiscount.toLocaleString()}`);\n        }\n\n        const shippingLabel = checkoutData.shippingMethod === 'Delivery' ? 'Envío a domicilio' : 'Retiro en local';\n        lines.push(`${shippingLabel}: ${messageShipping > 0 ? `${currency}${messageShipping.toLocaleString()}` : 'Gratis'}`);\n        lines.push(`Total estimado: ${currency}${messageTotal.toLocaleString()}`);\n\n        return lines.join('\\n');\n    };\n\n    const discountAmount = appliedCoupon ? calculateDiscountAmount(cartSubtotal, appliedCoupon) : 0;\n\n    const shippingFee = useMemo(() => {\n        if (checkoutData.shippingMethod !== 'Delivery') return 0;\n        const deliverySettings = settings?.shippingDelivery;\n        if (!deliverySettings?.enabled) return 0;\n        if (deliverySettings.freeAbove > 0 && cartSubtotal >= deliverySettings.freeAbove) return 0;\n        return Number(deliverySettings.fee) || 0;\n    }, [checkoutData.shippingMethod, cartSubtotal, settings?.shippingDelivery]);\n\n    const finalTotal = Math.max(0, cartSubtotal - discountAmount + shippingFee);\n\n    // Selección de Cupón\n    const selectCoupon = async (coupon) => {\n        // Validaciones previas\n        if (coupon.targetType === 'specific_email' && currentUser) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) {\n                return showToast(\"Este cupón no está disponible para tu cuenta.\", \"error\");\n            }\n        }\n        if (new Date(coupon.expirationDate) < new Date()) {\n            return showToast(\"Este cupón ha vencido.\", \"error\");\n        }\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) {\n            return showToast(\"Este cupón ha agotado sus usos totales.\", \"error\");\n        }\n        if (cartSubtotal < (coupon.minPurchase || 0)) {\n            return showToast(`El monto mínimo para este cupón es $${coupon.minPurchase}.`, \"warning\");\n        }\n\n        if (!currentUser?.dni) {\n            return showToast(\"Debes actualizar tu DNI en el perfil para usar cupones.\", \"warning\");\n        }\n\n        setAppliedCoupon(coupon);\n        setShowCouponModal(false);\n\n        let msg = \"¡Cupón aplicado correctamente!\";\n        if (coupon.type === 'percentage' && coupon.maxDiscount > 0) {\n            msg += ` (Tope de reintegro: $${coupon.maxDiscount})`;\n        }\n        showToast(msg, \"success\");\n    };\n\n    // Enviar correo automático via Backend\n    const sendOrderConfirmationEmail = async (orderData, discountDetails) => {\n        try {\n            await fetch('/api/payment', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                },\n                body: JSON.stringify({\n                    orderId: orderData.orderId,\n                    customer: orderData.customer,\n                    items: orderData.items,\n                    total: orderData.total,\n                    subtotal: orderData.subtotal,\n                    discountDetails: discountDetails,\n                    shipping: orderData.shippingAddress,\n                    shippingFee: orderData.shippingFee,\n                    shippingMethod: orderData.shippingMethod,\n                    paymentMethod: orderData.paymentMethod,\n                    date: orderData.date\n                }),\n            });\n            console.log(\"Correo de confirmación enviado enviada API.\");\n        } catch (error) {\n            console.error(\"Error al enviar email automático:\", error);\n            // No bloqueamos el flujo si falla el email, solo logueamos\n        }\n    };\n\n    const getAuthenticatedUser = async () => {\n        const existing = auth.currentUser;\n        if (existing && !existing.isAnonymous) return existing;\n\n        const hydrated = await new Promise((resolve) => {\n            let unsub = null;\n            const timeoutId = setTimeout(() => {\n                if (unsub) unsub();\n                resolve(auth.currentUser);\n            }, 1200);\n            unsub = onAuthStateChanged(auth, (user) => {\n                clearTimeout(timeoutId);\n                unsub();\n                resolve(user);\n            });\n        });\n\n        if (hydrated && !hydrated.isAnonymous) return hydrated;\n        return null;\n    };\n\n    // 5. Confirmación de Pedido (Checkout)\n    const confirmOrder = async () => {\n        if (isProcessingOrder) return;\n\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesión para finalizar la compra.\", \"info\");\n            }\n\n            let effectiveUser = currentUser;\n            if (!effectiveUser && appId) {\n                try {\n                    const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', authUser.uid));\n                    if (snap.exists()) {\n                        const userData = { id: snap.id, ...snap.data() };\n                        if (userData.role === 'admin') userData._adminVerified = true;\n                        setCurrentUser(userData);\n                        effectiveUser = userData;\n                    }\n                } catch { }\n            }\n\n            if (!effectiveUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesión para finalizar la compra.\", \"info\");\n            }\n\n            if (!effectiveUser.name || !effectiveUser.phone || !effectiveUser.dni) {\n                setView('profile');\n                return showToast(\"Por favor completa tus datos personales (Nombre, Teléfono y DNI) en tu perfil antes de comprar.\", \"warning\");\n            }\n\n            if (checkoutData.shippingMethod === 'Delivery' && (!checkoutData.address || !checkoutData.city || !checkoutData.province || !checkoutData.zipCode)) {\n                return showToast(\"Por favor completa TODOS los datos de envío.\", \"warning\");\n            }\n\n            if (!checkoutData.paymentChoice) {\n                return showToast(\"Selecciona un método de pago.\", \"warning\");\n            }\n\n            if (checkoutData.paymentChoice === 'Tarjeta') {\n                throw new Error('Para pagar con tarjeta usá el formulario de Mercado Pago.');\n            }\n\n            setIsProcessingOrder(true);\n            showToast(\"Procesando tu pedido, por favor espera...\", \"info\");\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: checkoutData.paymentChoice,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) {\n                setView('login');\n                throw new Error('Tu sesión venció. Iniciá sesión nuevamente para finalizar la compra.');\n            }\n            if (!res.ok) throw new Error(data.error || 'Error al procesar el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            setView('profile');\n            showToast(\"¡Pedido realizado con éxito! Te enviamos un email con el detalle.\", \"success\");\n        } catch (e) {\n            console.error(\"Error al procesar pedido:\", e);\n            showToast(e.message || \"Ocurrió un error al procesar el pedido.\", \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // --- FUNCIONES DE MERCADO PAGO CARD PAYMENT BRICK ---\n\n    // Inicializar el Card Payment Brick cuando se selecciona Mercado Pago\n    const initializeCardPaymentBrick = async () => {\n        if (isInitializingBrick.current) return;\n\n        // Resetear estados al iniciar por si quedaron de una compra anterior\n        setIsPaymentProcessing(false);\n        setPaymentError(null);\n\n        console.log('💎 Mercado Pago: Iniciando Brick. Total a cobrar:', finalTotal);\n\n        if (!window.MercadoPago) {\n            try {\n                await (async () => {\n                    if (window.MercadoPago) return;\n                    await new Promise((resolve, reject) => {\n                        const s = document.createElement('script');\n                        s.src = 'https://sdk.mercadopago.com/js/v2';\n                        s.async = true;\n                        s.onload = resolve;\n                        s.onerror = reject;\n                        document.head.appendChild(s);\n                    });\n                })();\n            } catch {\n                setPaymentError('No se pudo cargar el sistema de pagos. Intentá nuevamente.');\n                return;\n            }\n        }\n\n        // Sanitizar el monto total para evitar errores de precisión flotante\n        const safeAmount = Number(parseFloat(finalTotal).toFixed(2));\n        if (isNaN(safeAmount) || safeAmount <= 0) {\n            console.error('❌ Error: Monto inválido para pago:', finalTotal);\n            return;\n        }\n\n        const container = document.getElementById('cardPaymentBrick_container');\n        if (!container) return;\n\n        isInitializingBrick.current = true;\n\n        // Timeout de seguridad: si en 10 segundos no cargó, permitir reintentar\n        const safetyTimeout = setTimeout(() => {\n            if (isInitializingBrick.current) {\n                console.warn('⚠️ Mercado Pago: La inicialización está tardando demasiado. Liberando bloqueo...');\n                isInitializingBrick.current = false;\n            }\n        }, 10000);\n\n        // Limpiar brick anterior si existe\n        if (mpBrickController) {\n            try {\n                await mpBrickController.unmount();\n            } catch (e) {\n                console.warn('Error unmounting:', e);\n            }\n            setMpBrickController(null);\n        }\n\n        // Limpiar el contenedor físicamente por si quedaron restos\n        const containerElem = document.getElementById('cardPaymentBrick_container');\n        if (containerElem) {\n            containerElem.innerHTML = '';\n            // Forzar un reflow/render\n            containerElem.style.display = 'none';\n            containerElem.offsetHeight;\n            containerElem.style.display = 'block';\n        }\n\n        // Limpiar errores previos\n        setPaymentError(null);\n\n        const publicKey = await getMercadoPagoPublicKey();\n        if (!publicKey) {\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            setPaymentError('Mercado Pago no está configurado. Verificá la clave pública en el servidor.');\n            return;\n        }\n        const mp = new window.MercadoPago(publicKey, {\n            locale: 'es-AR',\n        });\n\n        const bricksBuilder = mp.bricks();\n\n        try {\n            const controller = await bricksBuilder.create('cardPayment', 'cardPaymentBrick_container', {\n                initialization: {\n                    amount: safeAmount, // Total validado y formateado\n                },\n                customization: {\n                    visual: {\n                        style: {\n                            theme: 'default',\n                            customVariables: {\n                                formBackgroundColor: '#0f172a',\n                                baseColor: '#f97316',\n                                borderRadiusMedium: '12px',\n                                borderRadiusLarge: '16px',\n                                textPrimaryColor: '#000000',\n                                textSecondaryColor: '#334155',\n                            },\n                        },\n                    },\n                    paymentMethods: {\n                        maxInstallments: 12,\n                    },\n                },\n                callbacks: {\n                    onReady: () => {\n                        console.log('✅ Mercado Pago: Card Payment Brick cargado.');\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                    },\n                    onSubmit: async (cardFormData) => {\n                        console.log('🚀 Mercado Pago: Procesando pago...');\n\n                        // Bloquear clics dobles pero permitir reintentos si falla\n                        setIsPaymentProcessing(true);\n                        setPaymentError(null);\n\n                        // Validar datos críticos antes de enviar\n                        if (!cardFormData.token) {\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error en los datos de la tarjeta. Por favor intentá nuevamente.');\n                            showToast('Error al procesar los datos de la tarjeta.', 'error');\n                            return;\n                        }\n\n                        try {\n                            const response = await fetch('/api/checkout', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    action: 'process_payment',\n                                    paymentData: {\n                                        token: cardFormData.token,\n                                        transaction_amount: safeAmount,\n                                        description: `Compra en ${settings?.storeName || 'Tienda Online'}`,\n                                        installments: cardFormData.installments || 1,\n                                        payment_method_id: cardFormData.payment_method_id || '',\n                                        issuer_id: cardFormData.issuer_id || '',\n                                    },\n                                    payer: {\n                                        email: currentUser?.email || 'sin-email@tienda.com',\n                                        identificationType: cardFormData.payer?.identification?.type || 'DNI',\n                                        identificationNumber: cardFormData.payer?.identification?.number || '00000000',\n                                    },\n                                }),\n                            });\n\n                            const result = await response.json().catch(() => ({}));\n                            console.log('📦 Respuesta:', result);\n\n                            if (!response.ok) {\n                                const message = result?.error || result?.message || `Error procesando pago (${response.status})`;\n                                throw new Error(message);\n                            }\n\n                            if (result.status === 'approved' || result.status === 'in_process' || result.status === 'pending') {\n                                await confirmOrderAfterPayment(result.id);\n                                showToast('¡Compra realizada!', 'success');\n                                setIsPaymentProcessing(false);\n                                isInitializingBrick.current = false;\n                                // Limpiar controlador de MP para que la próxima compra reinicie de cero\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(e); }\n                                    setMpBrickController(null);\n                                }\n                            } else {\n                                // ERROR DE NEGOCIO (Pago rechazado, tarjeta inválida, etc)\n                                const mpErrorMap = {\n                                    'cc_rejected_high_risk': 'El pago fue rechazado por controles de seguridad de Mercado Pago. Te recomendamos probar con otra tarjeta o medio de pago.',\n                                    'cc_rejected_insufficient_amount': 'Tu tarjeta no tiene fondos suficientes.',\n                                    'cc_rejected_bad_filled_other': 'Revisá los datos de tu tarjeta.',\n                                    'cc_rejected_bad_filled_date': 'La fecha de vencimiento es incorrecta.',\n                                    'cc_rejected_bad_filled_security_code': 'El código de seguridad es incorrecto.',\n                                    'cc_rejected_call_for_authorize': 'Debés autorizar el pago llamando a tu banco.',\n                                    'cc_rejected_card_disabled': 'Tu tarjeta está inactiva. Llamá a tu banco para activarla.',\n                                    'cc_rejected_max_attempts': 'Llegaste al límite de intentos permitidos. Usá otra tarjeta.',\n                                    'cc_rejected_duplicated_payment': 'Ya hiciste un pago similar recientemente. Esperá unos minutos.'\n                                };\n                                const detailedError = mpErrorMap[result.status_detail] || result.status_detail || result.error || 'Pago rechazado';\n                                console.error('❌ Motivo del rechazo:', detailedError);\n\n                                // IMPORTANTE: Si el pago falla, destruimos el brick para que al reintentar se cree uno nuevo y limpio\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(\"Error al desmontar brick tras falla:\", e); }\n                                    setMpBrickController(null);\n                                }\n                                isInitializingBrick.current = false;\n\n                                setIsPaymentProcessing(false);\n                                // Mensaje de máxima tranquilidad para el cliente\n                                setPaymentError(`${detailedError}`); // Mensaje limpio y directo\n                                showToast('El pago no se pudo completar. Revisá los detalles.', 'error');\n                            }\n                        } catch (error) {\n                            // ERROR DE CONEXIÓN\n                            console.error('❌ Error de conexión:', error);\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error de conexión con el servidor. Revisá tu internet e intentá de nuevo.');\n                            showToast('Error de conexión.', 'error');\n                        }\n                    },\n                    onError: (error) => {\n                        console.error('❌ Mercado Pago Error:', error);\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                        // No mostrar error si es solo por AdBlock\n                        if (error && error.message && error.message.includes('melidata')) return;\n                        setPaymentError('Error en el formulario. Verificá tus claves de producción.');\n                    },\n                },\n            });\n\n            setMpBrickController(controller);\n        } catch (error) {\n            console.error('Error creating brick:', error);\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            showToast('Error al cargar el formulario de pago.', 'error');\n        }\n    };\n\n    // Confirmar orden después de pago exitoso con MP\n    const confirmOrderAfterPayment = async (mpPaymentId) => {\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                throw new Error('Sesión inválida. Reiniciá e intentá de nuevo.');\n            }\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: 'Tarjeta',\n                    mpPaymentId,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) throw new Error('Tu sesión venció. Iniciá sesión nuevamente e intentá otra vez.');\n            if (!res.ok) throw new Error(data.error || 'Error guardando el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            if (mpBrickController) {\n                try { mpBrickController.unmount(); } catch (e) { }\n            }\n            setMpBrickController(null);\n            setView('profile');\n        } catch (error) {\n            console.error('Error creating order after payment:', error);\n            showToast('El pago fue exitoso pero hubo un error guardando el pedido. Contacta soporte.', 'warning');\n        }\n    };\n\n    // Effect para inicializar el Brick cuando se selecciona MP\n    useEffect(() => {\n        const isCheckoutView = view === 'checkout';\n        const isMP = checkoutData.paymentChoice === 'Tarjeta';\n\n        if (isCheckoutView && isMP && finalTotal > 0 && currentUser && cart.length > 0) {\n            // Validar que el usuario tenga datos completos antes de mostrar formulario de pago\n            if (!currentUser.name || !currentUser.phone || !currentUser.dni) {\n                showToast(\"Por favor completá tus datos personales antes de pagar con tarjeta.\", \"warning\");\n                setView('profile');\n                return;\n            }\n\n            // Pequeño delay para asegurar que el DOM está listo\n            const timer = setTimeout(() => {\n                const container = document.getElementById('cardPaymentBrick_container');\n                if (container) {\n                    initializeCardPaymentBrick();\n                }\n            }, 300);\n            return () => clearTimeout(timer);\n        } else if (mpBrickController && (!isCheckoutView || !isMP)) {\n            // Limpiar brick si se cambia de método de pago O de vista\n            console.log('Sweep: Limpiando Brick por cambio de vista o método.');\n            try {\n                mpBrickController.unmount();\n            } catch (e) { }\n            setMpBrickController(null);\n            isInitializingBrick.current = false;\n        }\n    }, [checkoutData.paymentChoice, finalTotal, currentUser, cart.length, view]);\n\n    // --- FUNCIONES DE ADMINISTRACIÓN ---\n\n    // 6. Guardar Producto\n    const saveProductFn = async () => {\n        // Validaciones básicas\n        if (!newProduct.name) return showToast(\"El nombre del producto es obligatorio.\", \"warning\");\n\n        // --- PRODUCT LIMIT CHECK (SUBSCRIPTION) ---\n        const MAX_PRODUCTS_ENTREPRENEUR = 30;\n        const MAX_PRODUCTS_BUSINESS = 50;\n\n        // Check limits only when creating new product\n        if (!editingId) {\n            const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n            const isEntrepreneur = currentPlan === 'entrepreneur';\n            const isBusiness = currentPlan === 'business';\n\n            if (isEntrepreneur && products.length >= MAX_PRODUCTS_ENTREPRENEUR) {\n                return showToast(`Has alcanzado el límite de ${MAX_PRODUCTS_ENTREPRENEUR} productos del Plan Emprendedor. ¡Mejora tu plan para seguir creciendo!`, \"error\");\n            }\n\n            if (isBusiness && products.length >= MAX_PRODUCTS_BUSINESS) {\n                return showToast(`Has alcanzado el límite de ${MAX_PRODUCTS_BUSINESS} productos del Plan Negocio. ¡Pásate a Premium para productos ilimitados!`, \"error\");\n            }\n        }\n\n        if (!newProduct.basePrice || Number(newProduct.basePrice) <= 0) return showToast(\"El precio debe ser mayor a 0.\", \"warning\");\n\n        // Validación de categorías (array)\n        const categories = Array.isArray(newProduct.categories) ? newProduct.categories :\n            (newProduct.category ? [newProduct.category] : []);\n        if (categories.length === 0) return showToast(\"Selecciona al menos una categoría.\", \"warning\");\n\n        const productData = {\n            ...newProduct,\n            categories: categories, // Guardar como array\n            basePrice: Number(newProduct.basePrice) || 0,\n            purchasePrice: Number(newProduct.purchasePrice || 0),\n            stock: Number(newProduct.stock) || 0,\n            discount: Number(newProduct.discount || 0),\n            image: newProduct.image || 'https://via.placeholder.com/150',\n            lastUpdated: new Date().toISOString()\n        };\n\n        // Eliminar propiedad legacy para evitar error de \"undefined\" en Firestore\n        if ('category' in productData) delete productData.category;\n\n        try {\n            if (editingId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', editingId), productData);\n                showToast(\"Producto actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), {\n                    ...productData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Producto creado correctamente.\", \"success\");\n            }\n            // Resetear formulario\n            setNewProduct({ name: '', basePrice: '', purchasePrice: '', stock: '', categories: [], image: '', description: '', discount: 0 });\n            setEditingId(null);\n            setShowProductForm(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar el producto.\", \"error\");\n        }\n    };\n\n    // 6.4. Image Upload Handler (Base64 for Vercel)\n    // 6.4. Image Upload Handler (Optimized with Canvas Resize)\n    const handleImageUpload = (e, setTargetState, imageField = 'image', maxWidth = 800) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n            return showToast(\"Por favor selecciona una imagen válida.\", \"warning\");\n        }\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            const img = new Image();\n            img.onload = () => {\n                const canvas = document.createElement('canvas');\n                const MAX_WIDTH = maxWidth;\n                const MAX_HEIGHT = maxWidth;\n                let width = img.width;\n                let height = img.height;\n\n                if (width > height) {\n                    if (width > MAX_WIDTH) {\n                        height *= MAX_WIDTH / width;\n                        width = MAX_WIDTH;\n                    }\n                } else {\n                    if (height > MAX_HEIGHT) {\n                        width *= MAX_HEIGHT / height;\n                        height = MAX_HEIGHT;\n                    }\n                }\n\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(img, 0, 0, width, height);\n\n                const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n                setTargetState(prev => ({ ...prev, [imageField]: dataUrl }));\n                showToast(\"Imagen optimizada y cargada.\", \"success\");\n            };\n            img.src = event.target.result;\n        };\n        reader.readAsDataURL(file);\n    };\n\n    const resetHomeBannerForm = () => {\n        setEditingHomeBannerId(null);\n        setNewHomeBanner({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    };\n\n    const editHomeBannerFn = (banner) => {\n        if (!banner) return;\n        setEditingHomeBannerId(banner.id);\n        const targetType = banner.targetType || (banner.promoId ? 'promo' : banner.productId ? 'product' : 'none');\n        const targetId = banner.targetId || banner.promoId || banner.productId || '';\n        setNewHomeBanner({\n            imageUrl: banner.imageUrl || '',\n            targetType,\n            targetId,\n            enabled: banner.enabled !== false,\n            order: Number.isFinite(Number(banner.order)) ? Number(banner.order) : 0,\n        });\n    };\n\n    const saveHomeBannerFn = async () => {\n        if (!newHomeBanner?.imageUrl) return showToast(\"Subí una imagen para el banner.\", \"warning\");\n        const targetType = newHomeBanner?.targetType || 'none';\n        const targetId = newHomeBanner?.targetId || '';\n        if (targetType !== 'none' && !targetId) return showToast(\"Seleccioná el destino del banner.\", \"warning\");\n\n        const orderValue = Number.isFinite(Number(newHomeBanner.order)) ? Number(newHomeBanner.order) : 0;\n        const payload = {\n            imageUrl: newHomeBanner.imageUrl,\n            enabled: newHomeBanner.enabled !== false,\n            order: orderValue,\n            targetType,\n            targetId: targetType === 'none' ? '' : String(targetId),\n            productId: targetType === 'product' ? String(targetId) : '',\n            promoId: targetType === 'promo' ? String(targetId) : '',\n        };\n\n        try {\n            if (editingHomeBannerId) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', editingHomeBannerId), payload);\n                showToast(\"Banner actualizado.\", \"success\");\n            } else {\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'), {\n                    ...payload,\n                    createdAt: new Date().toISOString(),\n                });\n                showToast(\"Banner creado.\", \"success\");\n            }\n            resetHomeBannerForm();\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error guardando banner: \" + (e?.message || \"error\"), \"error\");\n        }\n    };\n\n    const deleteHomeBannerFn = (banner) => {\n        if (!banner?.id) return;\n        openConfirm(\"Eliminar Banner\", \"¿Eliminar este banner del carrusel?\", async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', banner.id));\n                showToast(\"Banner eliminado.\", \"success\");\n                if (editingHomeBannerId === banner.id) resetHomeBannerForm();\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error eliminando banner: \" + (e?.message || \"error\"), \"error\");\n            }\n        });\n    };\n\n    // 6.5. Eliminar Producto\n    const deleteProductFn = (product) => {\n        openConfirm(\"Eliminar Producto\", `¿Estás seguro de eliminar el producto \"${product.name}\"?`, async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id));\n                showToast(\"Producto eliminado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar el producto.\", \"error\");\n            }\n        });\n    };\n\n    // 6.6. Venta Manual (Fuera de Página)\n    const handleManualSale = (product) => {\n        if (product.stock <= 0) return showToast(\"No hay stock para vender.\", \"warning\");\n\n        openConfirm(\"Venta Manual\", `¿Registrar venta manual de 1 unidad de \"${product.name}\"?`, async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-1)\n                });\n                showToast(\"Venta registrada. Stock actualizado.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        });\n    };\n\n    // 6.7. Gestión de Pedidos (Finalizar/Eliminar)\n    const finalizeOrderFn = (orderId) => {\n        openConfirm(\"Finalizar Pedido\", \"¿Marcar este pedido como REALIZADO/ENTREGADO?\", async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId), {\n                    status: 'Realizado',\n                    lastUpdate: new Date().toISOString()\n                });\n                showToast(\"Pedido finalizado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al finalizar pedido.\", \"error\");\n            }\n        });\n    };\n\n    const deleteOrderFn = (orderId) => {\n        openConfirm(\"Eliminar Pedido\", \"¿Eliminar este pedido permanentemente? El stock de los productos será devuelto al inventario.\", async () => {\n            try {\n                // 1. Obtener datos del pedido antes de eliminar\n                const orderRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId);\n                const orderSnap = await getDoc(orderRef);\n\n                if (!orderSnap.exists()) {\n                    throw new Error(\"El pedido no existe o ya fue eliminado.\");\n                }\n\n                const orderData = orderSnap.data();\n\n                // 2. Devolver Stock (Iterar items)\n                if (orderData.items && Array.isArray(orderData.items)) {\n                    for (const item of orderData.items) {\n                        if (item.productId && item.quantity > 0) {\n                            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                            try {\n                                await updateDoc(productRef, {\n                                    stock: increment(item.quantity)\n                                });\n                            } catch (ignore) {\n                                // Si el producto ya no existe, ignoramos el error para permitir borrar el pedido\n                                console.warn(`Producto ${item.productId} no encontrado, no se restauró stock.`);\n                            }\n                        }\n                    }\n                }\n\n                // 3. Eliminar Documento\n                await deleteDoc(orderRef);\n                showToast(\"Pedido eliminado y stock restaurado exitosamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar pedido: \" + e.message, \"error\");\n            }\n        });\n    };\n\n    // 7. Guardar Cupón (COMPLEJO y DETALLADO)\n    const saveCouponFn = async () => {\n        // Validaciones exhaustivas\n        if (!newCoupon.code || newCoupon.code.length < 3) return showToast(\"El código del cupón debe tener al menos 3 caracteres.\", \"warning\");\n        if (!newCoupon.value || Number(newCoupon.value) <= 0) return showToast(\"El valor del descuento debe ser mayor a 0.\", \"warning\");\n\n        if (newCoupon.type === 'percentage' && Number(newCoupon.value) > 100) return showToast(\"El porcentaje no puede ser mayor a 100%.\", \"warning\");\n\n        if (newCoupon.targetType === 'specific_user' && !newCoupon.targetUser.includes('@')) {\n            return showToast(\"Si el cupón es para un usuario específico, ingresa un email válido.\", \"warning\");\n        }\n\n        try {\n            const couponData = {\n                ...newCoupon,\n                code: newCoupon.code.toUpperCase().trim(),\n                value: Number(newCoupon.value),\n                minPurchase: Number(newCoupon.minPurchase || 0),\n                maxDiscount: Number(newCoupon.maxDiscount || 0),\n                usageLimit: Number(newCoupon.usageLimit || 0),\n                perUserLimit: Number(newCoupon.perUserLimit || 1),\n                targetUser: newCoupon.targetType === 'global' ? '' : newCoupon.targetUser,\n                createdAt: new Date().toISOString(),\n                usedBy: [] // Inicializar array de usos\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'), couponData);\n\n            // Resetear formulario completamente\n            setNewCoupon({\n                code: '', type: 'percentage', value: 0, minPurchase: 0, maxDiscount: 0,\n                expirationDate: '', targetType: 'global', targetUser: '', usageLimit: '', perUserLimit: 1\n            });\n            showToast(\"Cupón de descuento creado exitosamente.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear el cupón.\", \"error\");\n        }\n    };\n\n    // 8. Guardar Proveedor (Crear / Editar)\n    const saveSupplierFn = async () => {\n        if (!newSupplier.name) return showToast(\"El nombre de la empresa es obligatorio.\", \"warning\");\n\n        // Validación: Debe tener al menos UN método de contacto\n        if (!newSupplier.phone && !newSupplier.ig) {\n            return showToast(\"Debes ingresar al menos un método de contacto (Teléfono o Instagram).\", \"warning\");\n        }\n\n        const supplierData = {\n            ...newSupplier,\n            associatedProducts: newSupplier.associatedProducts || [],\n            lastUpdated: new Date().toISOString()\n        };\n\n        try {\n            if (editingSupplierId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', editingSupplierId), supplierData);\n                showToast(\"Proveedor actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), {\n                    ...supplierData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Proveedor registrado correctamente.\", \"success\");\n            }\n\n            setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n            setEditingSupplierId(null);\n            setShowSupplierModal(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar proveedor.\", \"error\");\n        }\n    };\n\n    // 9. Configuración y Equipo (Settings)\n\n\n    // 10. Gestión de Compras (Editar/Eliminar con lógica de Stock)\n    const deletePurchaseFn = (purchase) => {\n        openConfirm(\"Eliminar Compra\", `¿Eliminar registro de compra? Se descontarán ${purchase.quantity} unidades del stock del producto.`, async () => {\n            try {\n                // 1. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', purchase.productId), {\n                    stock: increment(-purchase.quantity)\n                });\n                // 2. Eliminar Compra\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', purchase.id));\n                showToast(\"Compra eliminada y stock revertido.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar compra.\", \"error\");\n            }\n        });\n    };\n\n    const updatePurchaseFn = async (pId, oldData, newData) => {\n        const qtyDiff = (newData.quantity || 0) - (oldData.quantity || 0);\n\n        try {\n            // 1. Actualizar Stock si cambió la cantidad\n            if (qtyDiff !== 0) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', oldData.productId), {\n                    stock: increment(qtyDiff)\n                });\n            }\n            // 2. Actualizar Registro\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', pId), {\n                quantity: newData.quantity,\n                cost: newData.cost,\n                supplierId: newData.supplierId\n            });\n            setEditingPurchase(null);\n            showToast(\"Compra actualizada y stock ajustado.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al actualizar la compra.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA GESTIÓN DE CATEGORÍAS ---\n    const createCategoryFn = async () => {\n        if (!newCategory.trim()) return showToast(\"Ingresa un nombre para la categoría.\", \"warning\");\n\n        try {\n            const updatedCategories = [...(settings.categories || []), newCategory.trim()];\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), {\n                categories: updatedCategories\n            });\n            setNewCategory('');\n            setShowCategoryModal(false);\n            showToast(`Categoría \"${newCategory}\" creada.`, \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear categoría.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA CARRITO DE COMPRAS (PEDIDOS MAYORISTAS) ---\n    const addToPurchaseCart = (productId, quantity, supplierId) => {\n        if (!productId || !supplierId || quantity <= 0) {\n            return showToast(\"Completa todos los campos.\", \"warning\");\n        }\n\n        const product = products.find(p => p.id === productId);\n        if (!product) return showToast(\"Producto no encontrado.\", \"error\");\n\n        const productPrice = product.purchasePrice || product.basePrice || 0;\n        const cost = productPrice * quantity;\n\n        const existingIndex = purchaseCart.findIndex(item => item.productId === productId);\n\n        if (existingIndex >= 0) {\n            // Actualizar cantidad si ya existe\n            const updated = [...purchaseCart];\n            updated[existingIndex].quantity += quantity;\n            updated[existingIndex].cost = (product.purchasePrice || product.basePrice || 0) * updated[existingIndex].quantity;\n            setPurchaseCart(updated);\n            showToast(`Cantidad actualizada: ${product.name}`, \"success\");\n        } else {\n            // Agregar nuevo item\n            setPurchaseCart([...purchaseCart, {\n                productId,\n                productName: product.name,\n                productImage: product.image,\n                quantity,\n                unitPrice: productPrice,\n                cost,\n                supplierId\n            }]);\n            showToast(`Agregado al pedido: ${product.name}`, \"success\");\n        }\n\n        // Resetear formulario\n        setNewPurchase({ productId: '', supplierId: supplierId, quantity: 1, cost: 0, isNewProduct: false });\n    };\n\n    const removeFromPurchaseCart = (index) => {\n        const updated = purchaseCart.filter((_, i) => i !== index);\n        setPurchaseCart(updated);\n        showToast(\"Producto eliminado del pedido.\", \"info\");\n    };\n\n    const updatePurchaseCartItem = (index, newQuantity) => {\n        const updated = [...purchaseCart];\n        updated[index].quantity = newQuantity;\n        updated[index].cost = updated[index].unitPrice * newQuantity;\n        setPurchaseCart(updated);\n    };\n\n    const finalizePurchaseOrder = async () => {\n        if (purchaseCart.length === 0) {\n            return showToast(\"El carrito de compras está vacío.\", \"warning\");\n        }\n\n        try {\n            const batch = writeBatch(db);\n            const batchId = `BATCH - ${Date.now()}`;\n            const timestamp = new Date().toISOString();\n\n            // Registrar cada compra y actualizar stock en Lote (Batch)\n            for (const item of purchaseCart) {\n                // 1. Crear Referencia para Nueva Compra\n                const newPurchaseRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'));\n                batch.set(newPurchaseRef, {\n                    productId: item.productId,\n                    supplierId: item.supplierId,\n                    quantity: item.quantity,\n                    cost: item.cost,\n                    batchId: batchId,\n                    date: timestamp\n                });\n\n                // 2. Actualizar Stock del Producto (Fixing NaN issues on the fly)\n                const product = products.find(p => p.id === item.productId);\n                const currentStock = isNaN(Number(product?.stock)) ? 0 : Number(product.stock);\n                const newStock = currentStock + item.quantity;\n\n                const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                batch.update(productRef, {\n                    stock: newStock\n                });\n            }\n\n            await batch.commit();\n\n            setPurchaseCart([]);\n            showToast(`Pedido finalizado: ${purchaseCart.length} productos registrados.`, \"success\");\n        } catch (e) {\n            console.error(\"Error in batch purchase:\", e);\n            showToast(\"Error al finalizar el pedido: \" + e.message, \"error\");\n        }\n    };\n\n    // --- CÁLCULOS DEL DASHBOARD (CENTRALIZADOS) ---\n    const dashboardMetrics = useMemo(() => {\n        // 1. Demanda en Vivo y Favoritos (Trending) + VENTAS REALES\n        const productStats = {}; // { id: { cart: 0, fav: 0, sales: 0, total: 0 } }\n\n        // Helper para inicializar stats\n        const initStats = (id) => {\n            if (!productStats[id]) productStats[id] = { cart: 0, fav: 0, sales: 0, total: 0 };\n        };\n\n        // Contar apariciones en Carritos Activos (LiveCarts)\n        liveCarts.forEach(cart => {\n            if (cart.items) {\n                cart.items.forEach(item => {\n                    initStats(item.productId);\n                    productStats[item.productId].cart += 1;\n                    productStats[item.productId].total += 1;\n                });\n            }\n        });\n\n        // Contar apariciones en Favoritos de Usuarios\n        users.forEach(u => {\n            if (u.favorites) {\n                u.favorites.forEach(pid => {\n                    initStats(pid);\n                    productStats[pid].fav += 1;\n                    productStats[pid].total += 1;\n                });\n            }\n        });\n\n        // 2. Finanzas y Ventas Confirmadas (Updated: Solo contar \"Realizado\")\n        const validOrders = orders.filter(o => o.status === 'Realizado');\n        const revenue = validOrders.reduce((acc, o) => acc + (o.total || 0), 0);\n        const expensesTotal = expenses?.reduce((acc, e) => acc + (e.amount || 0), 0) || 0;\n        const purchasesTotal = purchases?.reduce((acc, p) => acc + (p.cost || 0), 0) || 0;\n        const netIncome = revenue - expensesTotal - purchasesTotal;\n\n        // 3. Producto Estrella y Menos Vendido (Ventas reales confirmadas)\n        const salesCount = {}; // { productId: quantity }\n        const productMetadata = {}; // { productId: { name, image } } -> Fallback para productos eliminados\n\n        validOrders.forEach(o => {\n            if (o.items && Array.isArray(o.items)) {\n                o.items.forEach(i => {\n                    const pid = i.productId;\n                    const qty = Number(i.quantity) || 0;\n\n                    // Acumular Ventas\n                    salesCount[pid] = (salesCount[pid] || 0) + qty;\n\n                    // Guardar Metadata (Nombre/Imagen) del item por si el producto ya no existe\n                    if (!productMetadata[pid]) {\n                        productMetadata[pid] = { name: i.title || i.name || 'Producto Desconocido', image: i.image };\n                    }\n\n                    // Sumar a Estadísticas de Tendencia (Peso x5 para ventas reales)\n                    initStats(pid);\n                    productStats[pid].sales += qty;\n                    productStats[pid].total += (qty * 5);\n                });\n            }\n        });\n\n        // Ordenar productos por \"calor\" (total de interés)\n        const trendingProducts = Object.entries(productStats)\n            .map(([id, stats]) => {\n                // Intentar buscar en productos vivos, sino usar metadata del pedido\n                const liveProd = products.find(p => p.id === id);\n                const meta = productMetadata[id] || {};\n\n                // Si el producto no existe en el inventario actual (fue eliminado), no mostrarlo en tendencias\n                if (!liveProd) return null;\n\n                return {\n                    id: id,\n                    name: liveProd.name,\n                    image: liveProd.image,\n                    stock: liveProd.stock,\n                    stats\n                };\n            })\n            .filter(Boolean)\n            .sort((a, b) => b.stats.total - a.stats.total)\n            .slice(0, 5); // Top 5\n\n        // Estrella (Más Vendido)\n        let starProductId = null;\n        let maxSales = -1;\n        Object.entries(salesCount).forEach(([id, count]) => {\n            if (count > maxSales) {\n                maxSales = count;\n                starProductId = id;\n            }\n        });\n\n        // Resolver objeto completo para Estrella\n        let starProduct = null;\n        if (starProductId) {\n            const liveStar = products.find(p => p.id === starProductId);\n            const meta = productMetadata[starProductId];\n            if (liveStar || meta) {\n                starProduct = {\n                    id: starProductId,\n                    name: liveStar ? liveStar.name : meta.name,\n                    image: liveStar ? liveStar.image : meta.image,\n                    sales: maxSales,\n                    stock: liveStar ? liveStar.stock : 0\n                };\n            }\n        }\n\n        // Menos Vendido (Peor Producto) - Buscar el mínimo entre TODOS los productos activos\n        // Nota: Solo consideramos productos que AÚN existen en inventario para \"Menos Vendido\"\n        let leastSoldProductId = null;\n        let minSales = Infinity;\n\n        products.forEach(p => {\n            const count = salesCount[p.id] || 0;\n            if (count < minSales) {\n                minSales = count;\n                leastSoldProductId = p.id;\n            }\n        });\n        const leastSoldProduct = leastSoldProductId ? products.find(p => p.id === leastSoldProductId) : null;\n\n        // 4. Analítica Temporal (Timeline)\n        const timeline = { daily: {}, monthly: {}, yearly: {} };\n        const categoryStats = {}; // { catName: { revenue: 0, items: 0 } }\n\n        validOrders.forEach(o => {\n            const d = new Date(o.date);\n            const dayKey = d.toISOString().split('T')[0]; // YYYY-MM-DD\n            const monthKey = d.toISOString().slice(0, 7); // YYYY-MM\n            const yearKey = d.getFullYear().toString(); // YYYY\n\n            const agg = (obj, key, amount) => {\n                if (!obj[key]) obj[key] = { date: key, revenue: 0, orders: 0 };\n                obj[key].revenue += amount;\n                obj[key].orders += 1;\n            };\n\n            agg(timeline.daily, dayKey, o.total);\n            agg(timeline.monthly, monthKey, o.total);\n            agg(timeline.yearly, yearKey, o.total);\n\n            // Sales By Category\n            if (o.items) {\n                o.items.forEach(item => {\n                    const prod = products.find(p => p.id === item.productId || p.id === item.id);\n                    const cat = prod ? prod.category : 'Otros';\n                    if (!categoryStats[cat]) categoryStats[cat] = { name: cat, revenue: 0, items: 0, percentage: 0 };\n                    categoryStats[cat].revenue += (item.unit_price * item.quantity);\n                    categoryStats[cat].items += item.quantity;\n                });\n            }\n        });\n\n        const analytics = {\n            daily: Object.values(timeline.daily).sort((a, b) => a.date.localeCompare(b.date)),\n            monthly: Object.values(timeline.monthly).sort((a, b) => a.date.localeCompare(b.date)),\n            yearly: Object.values(timeline.yearly).sort((a, b) => a.date.localeCompare(b.date))\n        };\n\n        // Format salesByCategory\n        const totalSalesVolume = Object.values(categoryStats).reduce((acc, c) => acc + c.items, 0);\n        const salesByCategory = Object.values(categoryStats)\n            .map(c => ({\n                ...c,\n                percentage: totalSalesVolume > 0 ? Math.round((c.items / totalSalesVolume) * 100) : 0\n            }))\n            .sort((a, b) => b.items - a.items);\n\n        // 5. Low Stock Alerts\n        const lowStockThreshold = settings?.lowStockThreshold || 5;\n        const lowStockProducts = products.filter(p => !p.promoItems && (Number(p.stock) <= lowStockThreshold));\n\n        // 6. Recent Activity\n        const recentActivity = [...orders].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);\n\n        // 7. Financial Transactions (Ledger)\n        const transactions = [\n            ...validOrders.map(o => ({ id: o.id || o.orderId, type: 'income', category: 'Venta', date: o.date, amount: o.total, description: `Orden #${o.orderId}`, status: o.status })),\n            ...expenses.map(e => ({ id: e.id, type: 'expense', category: e.category || 'Gasto', date: e.date, amount: e.amount, description: e.description, status: 'Pagado' })),\n            ...(purchases || []).map(p => ({ id: p.id, type: 'expense', category: 'Compra Stock', date: p.date, amount: p.cost, description: `Prov: ${p.supplier || 'General'}`, status: 'Completado' })),\n            ...(investments || []).map(i => ({ id: i.id, type: 'income', category: 'Inversión', date: i.date, amount: i.amount, description: `Inv: ${i.investor}`, status: 'Recibido' }))\n        ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 100);\n\n        return {\n            revenue,\n            expensesTotal,\n            purchasesTotal,\n            netIncome,\n            trendingProducts,\n            starProduct,\n            leastSoldProduct,\n            salesCount,\n            analytics,\n            salesByCategory,\n            lowStockProducts,\n            recentActivity,\n            transactions,\n            totalOrders: orders.length,\n            totalUsers: users.length\n        };\n    }, [orders, expenses, purchases, products, liveCarts, users, settings]);\n\n    // ⚠️ [PAUSA POR SEGURIDAD] - El código continúa con la Interfaz Gráfica completa y detallada. Por favor escribe \"continuar\".\n    // --- COMPONENTES UI: MODALES DETALLADOS ---\n\n    // Modal de Detalles de Pedido (Visor Completo)\n    const OrderDetailsModal = ({ order, onClose }) => {\n        if (!order) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\" onClick={onClose}>\n                <div \n                    className={`rounded-[2rem] w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] shadow-2xl border relative transition-colors duration-300 ${darkMode ? 'glass border-slate-800' : 'bg-white border-slate-200'}`}\n                    onClick={e => e.stopPropagation()}\n                >\n                    {/* Header del Modal */}\n                    <div className={`p-8 border-b flex justify-between items-center transition-colors duration-300 ${darkMode ? 'border-slate-800 bg-slate-900/50' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h3 className={`text-2xl font-black flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                DETALLE DE PEDIDO <span className=\"text-orange-500\">#{order.orderId}</span>\n                            </h3>\n                            <div className=\"flex items-center gap-4 mt-2\">\n                                <span className={`text-xs flex items-center gap-1 font-bold tracking-wider transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                    <Clock className=\"w-3 h-3\" /> {new Date(order.date).toLocaleString()}\n                                </span>\n                                <span className={`text-[10px] px-2 py-0.5 rounded border uppercase font-black tracking-widest transition-colors duration-300 ${order.status === 'Realizado' ? (darkMode ? 'bg-green-900/30 text-green-400 border-green-500/30' : 'bg-green-100 text-green-600 border-green-200') : (darkMode ? 'bg-yellow-900/30 text-yellow-400 border-yellow-500/30' : 'bg-yellow-100 text-yellow-600 border-yellow-200')}`}>\n                                    {order.status}\n                                </span>\n                            </div>\n                        </div>\n                        <button onClick={onClose} className={`p-3 rounded-full transition shadow-lg border ${darkMode ? 'bg-slate-800 hover:bg-slate-700 border-slate-700 text-slate-400 hover:text-white' : 'bg-slate-100 hover:bg-slate-200 border-slate-200 text-slate-500 hover:text-slate-900'}`}>\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n\n                    {/* Contenido Scrollable */}\n                    <div className={`p-8 overflow-y-auto space-y-8 custom-scrollbar transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-white'}`}>\n\n                        {/* Estado Visual */}\n                        <div className={`flex justify-between items-center p-6 rounded-2xl border shadow-inner transition-colors duration-300 ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                            <div className=\"flex items-center gap-4\">\n                                <div className={`p-4 rounded-full shadow-lg transition-all duration-300 ${order.status === 'Realizado' ? (darkMode ? 'bg-green-500/20 text-green-400 shadow-[0_0_15px_rgba(34,197,94,0.2)]' : 'bg-green-100 text-green-600') : (darkMode ? 'bg-yellow-500/20 text-yellow-400 shadow-[0_0_15px_rgba(234,179,8,0.2)]' : 'bg-yellow-100 text-yellow-600')}`}>\n                                    {order.status === 'Realizado' ? <CheckCircle className=\"w-8 h-8\" /> : <Clock className=\"w-8 h-8\" />}\n                                </div>\n                                <div>\n                                    <p className={`text-xs uppercase font-bold tracking-widest mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Estado Actual</p>\n                                    <p className={`text-xl font-black transition-colors duration-300 ${order.status === 'Realizado' ? (darkMode ? 'text-green-400' : 'text-green-600') : (darkMode ? 'text-yellow-400' : 'text-yellow-600')}`}>\n                                        {order.status === 'Realizado' ? 'Entregado / Finalizado' : 'Pendiente de Pago/Envío'}\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Columnas de Info */}\n                        <div className=\"grid md:grid-cols-2 gap-6\">\n                            {/* Cliente */}\n                            <div className={`p-6 rounded-2xl border transition duration-300 ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-200 hover:border-slate-300'}`}>\n                                <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                    <User className=\"w-4 h-4\" /> Datos del Cliente\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.name}</p>\n                                    <div className=\"space-y-1\">\n                                        <p className={`text-sm flex justify-between border-b border-dashed pb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400 border-slate-800/50' : 'text-slate-600 border-slate-100'}`}>\n                                            <span>Email:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.email}</span>\n                                        </p>\n                                        <p className={`text-sm flex justify-between border-b border-dashed pb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400 border-slate-800/50' : 'text-slate-600 border-slate-100'}`}>\n                                            <span>Teléfono:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.phone || '-'}</span>\n                                        </p>\n                                        <p className={`text-sm flex justify-between transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>DNI:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.dni || '-'}</span>\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Envío */}\n                            <div className={`p-6 rounded-2xl border transition duration-300 ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-200 hover:border-slate-300'}`}>\n                                <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                    <Truck className=\"w-4 h-4\" /> Datos de Entrega\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className={`font-medium text-sm leading-relaxed min-h-[3rem] transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-800'}`}>\n                                        {order.shippingAddress || 'Retiro en sucursal'}\n                                    </p>\n                                    <div className={`pt-2 mt-2 border-t transition-colors duration-300 ${darkMode ? 'border-slate-800/50' : 'border-slate-100'}`}>\n                                        <p className={`text-xs uppercase font-bold mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Método de Pago</p>\n                                        <div className=\"flex items-center gap-2\">\n                                            <CreditCard className=\"w-4 h-4 text-orange-500\" />\n                                            <p className=\"text-orange-500 font-black text-sm uppercase\">{order.paymentMethod}</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Lista de Productos */}\n                        <div>\n                            <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                <Package className=\"w-4 h-4\" /> Productos ({order.items.length})\n                            </h4>\n                            <div className=\"space-y-3\">\n                                {order.items.map((item, idx) => (\n                                    <div key={idx} className={`flex justify-between items-center p-4 rounded-xl border transition group duration-300 ${darkMode ? 'bg-slate-900/40 border-slate-800 hover:border-orange-900/30' : 'bg-white border-slate-100 hover:border-orange-200 shadow-sm'}`}>\n                                        <div className=\"flex items-center gap-4\">\n                                            <div className={`w-12 h-12 flex items-center justify-center rounded-lg p-1 shadow-md group-hover:scale-105 transition border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>\n                                                {item.image ? <img src={item.image} className=\"w-full h-full object-contain\" /> : <Package className=\"text-slate-400\" />}\n                                            </div>\n                                            <div>\n                                                <p className={`font-bold text-sm transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.title}</p>\n                                                <p className={`text-xs flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                                                    <span className={`px-1.5 rounded text-[10px] font-bold transition-colors duration-300 ${darkMode ? 'bg-slate-800 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>x{item.quantity}</span>\n                                                    <span>${item.unit_price.toLocaleString()} c/u</span>\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <span className={`font-mono font-bold text-lg tracking-tight transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            ${(item.unit_price * item.quantity).toLocaleString()}\n                                        </span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Resumen Financiero */}\n                        <div className={`p-6 rounded-2xl border space-y-3 shadow-lg transition-colors duration-300 ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                            <div className={`flex justify-between text-sm font-medium transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                <span>Subtotal Productos</span>\n                                <span>${(order.subtotal || order.total).toLocaleString()}</span>\n                            </div>\n\n                            {order.discount > 0 && (\n                                <div className={`flex justify-between text-sm font-bold p-2 rounded-lg border border-dashed transition-colors duration-300 ${darkMode ? 'text-green-400 bg-green-900/10 border-green-900/30' : 'text-green-600 bg-green-50 border-green-200'}`}>\n                                    <span className=\"flex items-center gap-2\">\n                                        <Ticket className=\"w-3 h-3\" /> Descuento ({order.discountCode || 'Cupón'})\n                                    </span>\n                                    <span>-${order.discount.toLocaleString()}</span>\n                                </div>\n                            )}\n\n                            <div className={`flex justify-between items-center mt-4 pt-4 border-t border-dashed transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-100'}`}>\n                                <span className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total Abonado</span>\n                                <span className={`text-3xl font-black tracking-tighter transition-colors duration-300 ${darkMode ? 'text-orange-500 neon-text' : 'text-orange-600'}`}>\n                                    ${order.total.toLocaleString()}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal Selector de Cupones (Visualmente Rico)\n    const CouponSelectorModal = () => {\n        if (!showCouponModal) return null;\n\n        // Filtrado de cupones válidos\n        const availableCoupons = coupons.filter(c => {\n            const isNotExpired = !c.expirationDate || new Date(c.expirationDate) > new Date();\n            const isUserTarget = !c.targetUser || (currentUser && c.targetUser === currentUser.email);\n            const isGlobal = c.targetType === 'global';\n            const usedCount = c.usedBy ? c.usedBy.length : 0;\n            const notExhausted = !c.usageLimit || usedCount < c.usageLimit;\n            const userNotUsed = currentUser && c.usedBy && !c.usedBy.includes(currentUser.id);\n\n            return isNotExpired && (isUserTarget || isGlobal) && notExhausted && userNotUsed;\n        });\n\n        return (\n            <div className=\"fixed inset-0 z-[150] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setShowCouponModal(false)}>\n                <div className={`rounded-[2rem] w-full max-w-lg overflow-hidden relative shadow-2xl border transition-colors duration-300 ${darkMode ? 'border-purple-500/20 bg-[#050505]' : 'border-slate-200 bg-white'}`} onClick={e => e.stopPropagation()}>\n                    <button onClick={() => setShowCouponModal(false)} className={`absolute top-6 right-6 p-2 rounded-full transition z-10 ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200'}`}>\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className={`p-8 border-b transition-colors duration-300 ${darkMode ? 'bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-slate-800' : 'bg-gradient-to-br from-slate-50 to-white border-slate-100'}`}>\n                        <h3 className={`text-2xl font-black mb-2 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                            <div className={`p-2 rounded-lg border transition-colors duration-300 ${darkMode ? 'bg-purple-900/20 border-purple-500/30' : 'bg-purple-50 border-purple-200'}`}>\n                                <Gift className={`w-6 h-6 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`} />\n                            </div>\n                            Mis Beneficios\n                        </h3>\n                        <p className={`transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'} text-sm`}>Selecciona un cupón para aplicar el descuento a tu compra.</p>\n                    </div>\n\n                    <div className={`p-8 space-y-4 max-h-[50vh] overflow-y-auto custom-scrollbar transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-white'}`}>\n                        {availableCoupons.length === 0 ? (\n                            <div className={`text-center py-12 border-2 border-dashed rounded-2xl transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                <Ticket className={`w-16 h-16 mx-auto mb-4 transition-colors duration-300 ${darkMode ? 'text-slate-700' : 'text-slate-300'}`} />\n                                <p className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>No tienes cupones disponibles.</p>\n                                <p className={`transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'} text-sm mt-2`}>Mantente atento a nuestras redes sociales.</p>\n                            </div>\n                        ) : availableCoupons.map(c => {\n                            const canApply = cartSubtotal >= (c.minPurchase || 0);\n                            return (\n                                <div key={c.id} onClick={() => canApply && selectCoupon(c)} className={`relative overflow-hidden rounded-2xl border transition-all duration-300 group ${\n                                    canApply \n                                        ? (darkMode ? 'bg-slate-900 border-slate-700 hover:border-purple-500 cursor-pointer hover:shadow-[0_0_20px_rgba(168,85,247,0.15)] hover:scale-[1.02]' : 'bg-white border-slate-200 hover:border-purple-500 cursor-pointer hover:shadow-xl hover:scale-[1.02]') \n                                        : (darkMode ? 'bg-slate-900/50 border-slate-800 opacity-50 cursor-not-allowed grayscale' : 'bg-slate-50 border-slate-100 opacity-50 cursor-not-allowed grayscale')\n                                }`}>\n                                    {/* Decoración lateral */}\n                                    <div className={`absolute top-0 left-0 w-2 h-full transition-colors duration-300 ${canApply ? 'bg-purple-500' : (darkMode ? 'bg-slate-700' : 'bg-slate-300')}`}></div>\n\n                                    <div className=\"p-5 pl-8 flex justify-between items-center\">\n                                        <div className=\"flex-1\">\n                                            <div className=\"flex items-center gap-3 mb-2\">\n                                                <span className={`font-black text-xl tracking-widest font-mono transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{c.code}</span>\n                                                <span className={`text-[10px] px-2 py-0.5 rounded border uppercase font-bold transition-colors duration-300 ${darkMode ? 'bg-purple-900/30 text-purple-300 border-purple-500/30' : 'bg-purple-50 text-purple-600 border-purple-200'}`}>\n                                                    {c.type === 'fixed' ? 'DESCUENTO FIJO' : 'PORCENTAJE'}\n                                                </span>\n                                            </div>\n                                            <p className={`font-bold text-sm transition-colors duration-300 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                                {c.type === 'fixed' ? `Ahorra $${c.value}` : `${c.value}% de Descuento`}\n                                                {c.maxDiscount > 0 && <span className={`transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'} text-xs ml-1 font-normal`}>(Tope ${c.maxDiscount})</span>}\n                                            </p>\n\n                                            {/* Validación visual de mínimo de compra */}\n                                            {c.minPurchase > 0 && (\n                                                <p className={`text-xs mt-3 font-bold flex items-center gap-1 transition-colors duration-300 ${canApply ? (darkMode ? 'text-slate-500' : 'text-slate-400') : 'text-red-400'}`}>\n                                                    {canApply ? <CheckCircle className=\"w-3 h-3\" /> : <AlertCircle className=\"w-3 h-3\" />}\n                                                    Compra mínima: ${c.minPurchase}\n                                                </p>\n                                            )}\n                                        </div>\n\n                                        {/* Botón de acción */}\n                                        {canApply && (\n                                            <div className=\"w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white shadow-lg transform group-hover:scale-110 transition ml-4\">\n                                                <Plus className=\"w-6 h-6\" />\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n    // Modal de Detalle de Producto / Promo (Versión Premium)\n    const ProductDetailModal = () => {\n        if (!selectedProduct) return null;\n\n        const [qty, setQty] = useState(1);\n        const [added, setAdded] = useState(false);\n\n        const isPromo = selectedProduct.isPromo || !!selectedProduct.items;\n        const stockLimit = isPromo ? Number(selectedProduct.stock) : Number(selectedProduct.stock);\n\n        // Calcular stock real disponible restando lo que ya está en carrito\n        const cartItem = cart.find(item => item.product.id === selectedProduct.id);\n        const inCartQty = cartItem ? cartItem.quantity : 0;\n        const availableToAdd = Math.max(0, stockLimit - inCartQty);\n\n        const hasStock = stockLimit > 0;\n        const isMaxInCart = availableToAdd === 0 && hasStock;\n        const displayPrice = isPromo ? Number(selectedProduct.price || selectedProduct.basePrice) : calculateItemPrice(selectedProduct.basePrice, selectedProduct.discount);\n\n        const handleAdd = (e) => {\n            e.stopPropagation();\n            if (!hasStock) return;\n\n            const itemToAdd = isPromo ? {\n                id: selectedProduct.id,\n                name: selectedProduct.name,\n                basePrice: selectedProduct.price || selectedProduct.basePrice,\n                image: selectedProduct.image,\n                isPromo: true,\n                items: selectedProduct.items,\n                stock: selectedProduct.stock\n            } : selectedProduct;\n\n            manageCart(itemToAdd, qty);\n            setAdded(true);\n            setTimeout(() => setAdded(false), 2000);\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[20000] flex items-center justify-center bg-black/90 backdrop-blur-xl animate-fade-in p-4\" onClick={() => setSelectedProduct(null)}>\n                <div className={`border rounded-[2.5rem] max-w-4xl w-full overflow-hidden flex flex-col md:flex-row shadow-2xl animate-scale-up relative h-full md:h-auto overflow-y-auto md:overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`} onClick={e => e.stopPropagation()}>\n\n                    {/* Imagen con Zoom y Efectos */}\n                    <div className={`md:w-1/2 h-72 md:h-[550px] p-8 md:p-12 flex items-center justify-center relative overflow-hidden group ${darkMode ? 'bg-gradient-to-b from-slate-900 to-[#0a0a0a]' : 'bg-gradient-to-b from-slate-100 to-white'}`}>\n                        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/5 to-transparent opacity-50 group-hover:opacity-100 transition duration-500\"></div>\n                        <img\n                            src={selectedProduct.image}\n                            className={`w-full h-full object-contain z-10 transition-transform duration-700 hover:scale-110 ${darkMode ? 'drop-shadow-[0_0_50px_rgba(255,255,255,0.15)]' : 'drop-shadow-[0_0_50px_rgba(0,0,0,0.1)]'}`}\n                        />\n                        {/* Badges de Estado */}\n                        {!hasStock && (\n                            <div className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-[2px]\">\n                                <div className=\"border-4 border-red-500 p-4 -rotate-12 bg-black shadow-2xl\">\n                                    <span className=\"text-red-500 font-black text-2xl tracking-widest uppercase\">AGOTADO</span>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Panel de Información y Acción */}\n                    <div className={`md:w-1/2 p-8 md:p-12 flex flex-col ${darkMode ? 'bg-[#080808]' : 'bg-white'}`}>\n                        <div className=\"mb-8\">\n                            <span className={`inline-block px-3 py-1 text-[10px] font-black uppercase tracking-[0.2em] rounded mb-4 border ${darkMode ? 'bg-orange-500/10 text-orange-400 border-orange-500/20' : 'bg-orange-50 text-orange-600 border-orange-200'}`}>\n                                {isPromo ? 'COMBOS & PROMOCIONES' : selectedProduct.category}\n                            </span>\n                            <h2 className={`text-3xl md:text-4xl font-black leading-[1.1] mb-6 ${darkMode ? 'text-white neon-text-small' : 'text-slate-900'}`}>{selectedProduct.name}</h2>\n                            <p className={`text-sm md:text-base leading-relaxed line-clamp-4 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                {selectedProduct.description || ''}\n                            </p>\n                        </div>\n\n                        {/* Lista de productos para Promos */}\n                        {isPromo && selectedProduct.items && (\n                            <div className={`mb-8 space-y-3 p-6 rounded-2xl border shadow-inner ${darkMode ? 'bg-purple-500/5 border-purple-500/20' : 'bg-purple-50 border-purple-200'}`}>\n                                <p className={`text-[10px] uppercase font-black tracking-[0.2em] flex items-center gap-2 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                    <Sparkles className=\"w-3 h-3\" /> Este pack incluye:\n                                </p>\n                                <div className=\"space-y-2\">\n                                    {selectedProduct.items.map((item, idx) => {\n                                        const p = products.find(prod => prod.id === item.productId);\n                                        return (\n                                            <div key={idx} className={`flex items-center gap-3 text-sm group/item ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                                                <div className={`w-6 h-6 rounded-lg flex items-center justify-center text-[10px] font-black group-hover/item:text-white transition ${darkMode ? 'bg-purple-500/20 text-purple-400 group-hover/item:bg-purple-500' : 'bg-purple-100 text-purple-600 group-hover/item:bg-purple-600'}`}>\n                                                    {item.quantity}x\n                                                </div>\n                                                <span className={`font-bold transition ${darkMode ? 'group-hover:text-white' : 'group-hover:text-slate-900'}`}>{p?.name || 'Producto del Packs'}</span>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Footer con Precio y Carrito */}\n                        <div className={`mt-auto pt-8 border-t flex flex-col gap-6 ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                            <div className=\"flex items-end justify-between\">\n                                <div className=\"flex flex-col\">\n                                    <span className={`text-xs font-bold uppercase tracking-wider mb-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Inversión Total</span>\n                                    <div className=\"flex items-center gap-3\">\n                                        {selectedProduct.discount > 0 && !isPromo && (\n                                            <span className={`text-sm line-through font-bold ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>${(selectedProduct.basePrice * qty).toLocaleString()}</span>\n                                        )}\n                                        <span className={`text-4xl font-black tracking-tighter ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            ${(displayPrice * qty).toLocaleString()}\n                                        </span>\n                                    </div>\n                                </div>\n                                {selectedProduct.discount > 0 && !isPromo && (\n                                    <div className=\"px-3 py-1 bg-red-500 text-white rounded-lg text-[10px] font-black animate-pulse\">\n                                        -{selectedProduct.discount}% OFF\n                                    </div>\n                                )}\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                {/* Selector de Cantidad */}\n                                <div className={`flex items-center gap-3 rounded-2xl p-2 border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}>\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                                        disabled={qty <= 1}\n                                        className={`w-12 h-12 flex items-center justify-center rounded-xl transition disabled:opacity-30 disabled:cursor-not-allowed ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}\n                                    >\n                                        <Minus className=\"w-5 h-5\" />\n                                    </button>\n                                    <span className={`text-xl font-bold w-8 text-center font-mono ${darkMode ? 'text-white' : 'text-slate-900'}`}>{qty}</span>\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.min(availableToAdd, qty + 1)); }}\n                                        disabled={qty >= availableToAdd}\n                                        className={`w-12 h-12 flex items-center justify-center rounded-xl transition disabled:opacity-30 disabled:cursor-not-allowed ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}\n                                    >\n                                        <Plus className=\"w-5 h-5\" />\n                                    </button>\n                                </div>\n\n                                <button\n                                    onClick={handleAdd}\n                                    disabled={!hasStock || isMaxInCart}\n                                    className={`flex-1 py-5 rounded-2xl font-black transition flex items-center justify-center gap-3 shadow-2xl ${added\n                                        ? 'bg-green-500 text-white'\n                                        : (hasStock && !isMaxInCart)\n                                            ? (darkMode ? 'bg-white text-black hover:bg-orange-400 hover:text-white hover:scale-[1.02] active:scale-[0.98]' : 'bg-slate-900 text-white hover:bg-orange-600 hover:scale-[1.02] active:scale-[0.98]')\n                                            : (darkMode ? 'bg-slate-900 text-slate-600 border border-slate-800 cursor-not-allowed' : 'bg-slate-200 text-slate-400 border border-slate-300 cursor-not-allowed')\n                                        }`}\n                                >\n                                    {added ? (\n                                        <><CheckCircle className=\"w-6 h-6\" /> LISTO</>\n                                    ) : isMaxInCart ? (\n                                        <><AlertCircle className=\"w-6 h-6\" /> MAX EN CARRITO</>\n                                    ) : hasStock ? (\n                                        <><ShoppingCart className=\"w-6 h-6\" /> AGREGAR</>\n                                    ) : (\n                                        <><AlertCircle className=\"w-6 h-6\" /> AGOTADO</>\n                                    )}\n                                </button>\n                            </div>\n                        </div>\n\n\n                        {/* Botón Cerrar */}\n                        <button\n                            onClick={() => setSelectedProduct(null)}\n                            className={`absolute top-4 right-4 md:top-6 md:right-6 p-4 rounded-full transition-all border z-[30] shadow-2xl backdrop-blur-md ${darkMode ? 'bg-black/60 md:bg-white/5 hover:bg-white/10 text-white md:text-slate-400 hover:text-white border-white/20 md:border-white/5' : 'bg-white/60 md:bg-slate-900/5 hover:bg-slate-900/10 text-slate-900 md:text-slate-500 hover:text-slate-900 border-slate-200 md:border-slate-900/5'}`}\n                            title=\"Cerrar detalle\"\n                        >\n                            <X className=\"w-6 h-6 md:w-5 md:h-5\" />\n                        </button>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Venta Manual (Offline / \"En Casa\")\n    const ManualSaleModal = () => {\n        // State is now hoisted to App (saleData, setSaleData)\n\n        if (!showManualSaleModal) return null;\n\n        const product = products.find(p => p.id === saleData.productId);\n\n        const handleProductChange = (e) => {\n            const pid = e.target.value;\n            const prod = products.find(p => p.id === pid);\n            setSaleData({\n                ...saleData,\n                productId: pid,\n                price: prod ? Number(prod.basePrice) : 0\n            });\n        };\n\n        const handleSubmit = async (e) => {\n            e.preventDefault();\n            if (!product) return showToast(\"Selecciona un producto.\", \"warning\");\n            if (saleData.quantity <= 0) return showToast(\"Cantidad inválida.\", \"warning\");\n\n            try {\n                // Verificar Stock\n                const currentStock = Number(product.stock) || 0;\n                if (saleData.quantity > currentStock) {\n                    return showToast(`Stock insuficiente (Disponible: ${currentStock}).`, \"error\");\n                }\n\n                // Crear Orden \"Offline\"\n                const orderId = `man-${Date.now().toString().slice(-6)}`;\n                const total = saleData.quantity * saleData.price;\n\n                const newOrder = {\n                    orderId: orderId,\n                    userId: 'manual_admin', // Usuario sistema\n                    customer: {\n                        name: saleData.customerName || 'Cliente Mostrador',\n                        email: 'offline@store.com',\n                        phone: '-',\n                        dni: '-'\n                    },\n                    items: [{\n                        productId: product.id,\n                        title: product.name,\n                        quantity: Number(saleData.quantity),\n                        unit_price: Number(saleData.price),\n                        image: product.image\n                    }],\n                    subtotal: total,\n                    discount: 0,\n                    total: total,\n                    status: 'Realizado', // Ya entregado\n                    date: new Date().toISOString(),\n                    shippingAddress: 'Entrega Presencial (Offline)',\n                    paymentMethod: saleData.paymentMethod,\n                    source: 'manual_sale',\n                    notes: saleData.notes\n                };\n\n                // 1. Guardar Pedido\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n                // 2. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-Number(saleData.quantity))\n                });\n\n                showToast(\"Venta registrada correctamente.\", \"success\");\n                setShowManualSaleModal(false);\n            } catch (err) {\n                console.error(err);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setShowManualSaleModal(false)}>\n                <div className={`rounded-[2rem] w-full max-w-lg border shadow-2xl relative overflow-hidden transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`} onClick={e => e.stopPropagation()}>\n                    <button onClick={() => setShowManualSaleModal(false)} className={`absolute top-6 right-6 p-2 rounded-full transition z-10 ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-400 hover:text-slate-900'}`}>\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className={`p-8 border-b transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-100'}`}>\n                        <h3 className={`text-2xl font-black flex items-center gap-3 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                            <Store className=\"w-6 h-6 text-green-400\" /> Registrar Venta Manual\n                        </h3>\n                        <p className={`text-sm mt-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Para ventas fuera de la plataforma web.</p>\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"p-8 space-y-4\">\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Producto</label>\n                            <select\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.productId}\n                                onChange={handleProductChange}\n                            >\n                                <option value=\"\">-- Seleccionar Producto --</option>\n                                {products.map(p => (\n                                    <option key={p.id} value={p.id}>\n                                        {p.name} (Stock: {p.stock})\n                                    </option>\n                                ))}\n                            </select>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Cantidad</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"1\"\n                                    className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                    value={saleData.quantity}\n                                    onChange={e => setSaleData({ ...saleData, quantity: Number(e.target.value) })}\n                                />\n                            </div>\n                            <div>\n                                <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Precio Unit. ($)</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"0\"\n                                    className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                    value={saleData.price}\n                                    onChange={e => setSaleData({ ...saleData, price: Number(e.target.value) })}\n                                />\n                            </div>\n                        </div>\n\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Cliente / Notas</label>\n                            <input\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.customerName}\n                                onChange={e => setSaleData({ ...saleData, customerName: e.target.value })}\n                            />\n                        </div>\n\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Método de Pago</label>\n                            <select\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.paymentMethod}\n                                onChange={e => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                            >\n                                <option value=\"Efectivo\">Efectivo</option>\n                                <option value=\"Transferencia\">Transferencia</option>\n                                <option value=\"Tarjeta\">Tarjeta (POS)</option>\n                            </select>\n                        </div>\n\n                        <button type=\"submit\" className=\"w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-900/20 transition transform hover:-translate-y-1 mt-4\">\n                            REGISTRAR VENTA\n                        </button>\n                    </form>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Analíticas Detalladas (Drill-down)\n    const MetricsDetailModal = () => {\n        const [timeframe, setTimeframe] = useState('monthly'); // daily, monthly, yearly\n        if (!metricsDetail) return null;\n\n        const data = dashboardMetrics.analytics[timeframe] || [];\n        const title = metricsDetail.type === 'revenue' ? 'Ingresos Brutos' : 'Beneficio Neto';\n        const colorClass = metricsDetail.type === 'revenue' ? 'text-green-400' : 'text-orange-400';\n\n        // Calcular mejores/peores\n        const sortedByVal = [...data].sort((a, b) => b.revenue - a.revenue);\n        const bestPeriod = sortedByVal[0];\n        const worstPeriod = sortedByVal[sortedByVal.length - 1];\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setMetricsDetail(null)}>\n                <div \n                    className={`rounded-[2.5rem] w-full max-w-4xl max-h-[90vh] flex flex-col border shadow-2xl relative overflow-hidden transition-colors duration-300 ${darkMode ? 'bg-[#050505] border-slate-800' : 'bg-white border-slate-200'}`}\n                    onClick={e => e.stopPropagation()}\n                >\n                    {/* Header */}\n                    <div className={`p-8 border-b flex justify-between items-center ${darkMode ? 'border-slate-800 bg-slate-900/20' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h3 className={`text-3xl font-black ${colorClass} flex items-center gap-3`}>\n                                <BarChart className=\"w-8 h-8\" /> {title} - Analítica\n                            </h3>\n                            <p className=\"text-slate-500 text-sm mt-1\">Desglose detallado de tu rendimiento.</p>\n                        </div>\n                        <button \n                            onClick={() => setMetricsDetail(null)} \n                            className={`p-3 rounded-full transition border ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white border-slate-700' : 'bg-slate-100 text-slate-500 hover:text-slate-900 border-slate-200'}`}\n                        >\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n\n                    {/* Controls */}\n                    <div className={`p-6 flex gap-4 border-b justify-center ${darkMode ? 'bg-slate-900/10 border-slate-800/50' : 'bg-slate-50/50 border-slate-100'}`}>\n                        {['daily', 'monthly', 'yearly'].map(t => (\n                            <button\n                                key={t}\n                                onClick={() => setTimeframe(t)}\n                                className={`px-6 py-2 rounded-full text-xs font-black uppercase tracking-widest transition ${\n                                    timeframe === t \n                                        ? (darkMode ? 'bg-slate-100 text-black' : 'bg-slate-900 text-white') \n                                        : (darkMode ? 'bg-slate-900 text-slate-500 hover:text-white border border-slate-800' : 'bg-white text-slate-400 hover:text-slate-600 border border-slate-200')\n                                }`}\n                            >\n                                {t === 'daily' ? 'Diario' : t === 'monthly' ? 'Mensual' : 'Anual'}\n                            </button>\n                        ))}\n                    </div>\n\n                    {/* Stats Highlights */}\n                    <div className={`grid grid-cols-2 gap-4 p-6 ${darkMode ? 'bg-slate-900/5' : 'bg-slate-50/30'}`}>\n                        <div className={`border p-4 rounded-2xl flex items-center gap-4 ${darkMode ? 'bg-green-900/10 border-green-500/20' : 'bg-green-50 border-green-100'}`}>\n                            <div className={`p-3 rounded-xl ${darkMode ? 'bg-green-500/20 text-green-400' : 'bg-green-100 text-green-600'}`}>\n                                <TrendingUp className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Mejor Periodo</p>\n                                <p className={`${darkMode ? 'text-green-400' : 'text-green-600'} font-black text-lg`}>\n                                    {bestPeriod ? `$${bestPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{bestPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                        <div className={`border p-4 rounded-2xl flex items-center gap-4 ${darkMode ? 'bg-red-900/10 border-red-500/20' : 'bg-red-50 border-red-100'}`}>\n                            <div className={`p-3 rounded-xl ${darkMode ? 'bg-red-500/20 text-red-400' : 'bg-red-100 text-red-600'}`}>\n                                <TrendingDown className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Peor Periodo</p>\n                                <p className={`${darkMode ? 'text-red-400' : 'text-red-600'} font-black text-lg`}>\n                                    {worstPeriod ? `$${worstPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{worstPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* CSS Bar Chart */}\n                    <div className=\"flex-1 p-6 relative flex items-end justify-between gap-2 overflow-x-auto custom-scrollbar\">\n                        {data.length === 0 ? (\n                            <div className={`w-full text-center my-auto transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>No hay datos para mostrar el gráfico.</div>\n                        ) : (\n                            (() => {\n                                const maxVal = Math.max(...data.map(d => d.revenue), 1); // Avoid div/0\n                                return data.slice().map((item, idx) => {\n                                    const heightPct = (item.revenue / maxVal) * 100;\n                                    \n                                    return (\n                                        <div key={idx} className={`flex flex-col items-center justify-end h-full gap-2 group min-w-[60px] cursor-pointer rounded-xl p-1 transition-all ${darkMode ? 'hover:bg-slate-900/30' : 'hover:bg-slate-100'}`}>\n                                            {/* Tooltip on Hover */}\n                                            <div className={`opacity-0 group-hover:opacity-100 absolute bottom-full mb-2 border px-3 py-2 rounded-xl pointer-events-none transition z-50 shadow-xl max-w-[min(240px,70vw)] whitespace-normal break-words ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-white border-slate-200'}`}>\n                                                <p className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.date}</p>\n                                                <p className={`font-black ${colorClass}`}>${item.revenue.toLocaleString()}</p>\n                                                <p className={`text-[10px] ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>{item.orders} Pedidos</p>\n                                            </div>\n\n                                            {/* Bar */}\n                                            <div\n                                                className={`w-4 bg-gradient-to-t rounded-t-full relative transition-all duration-500 group-hover:w-6 group-hover:brightness-125 ${\n                                                    metricsDetail.type === 'revenue' \n                                                        ? (darkMode ? 'from-green-900/50 to-green-500' : 'from-green-200 to-green-600') \n                                                        : (darkMode ? 'from-orange-900/50 to-orange-500' : 'from-orange-200 to-orange-600')\n                                                }`}\n                                                style={{ height: `${Math.max(heightPct, 5)}%` }} // Min height 5%\n                                            >\n                                                {/* Glow alignment */}\n                                                <div className={`absolute top-0 left-0 right-0 h-4 rounded-full blur-md opacity-20 ${metricsDetail.type === 'revenue' ? 'bg-green-400' : 'bg-orange-400'}`}></div>\n                                            </div>\n\n                                            {/* Label */}\n                                            <p className={`text-[10px] font-bold -rotate-45 group-hover:rotate-0 transition origin-center mt-2 truncate w-full text-center ${darkMode ? 'text-slate-600 group-hover:text-white' : 'text-slate-400 group-hover:text-slate-900'}`}>\n                                                {timeframe === 'monthly' ? item.date.slice(5) : timeframe === 'daily' ? item.date.slice(5) : item.date}\n                                            </p>\n                                        </div>\n                                    );\n                                })\n                            })()\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n\n    // --- SUB-COMPONENTS FOR ADMIN DRAWER ---\n\n    const UserCartView = ({ cartItems, isLoading }) => {\n        if (isLoading) {\n            return (\n                <div className=\"py-20 flex flex-col items-center gap-4 opacity-50\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-orange-400\" />\n                    <p className={`text-xs font-black tracking-widest transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>SINCRONIZANDO DATOS...</p>\n                </div>\n            );\n        }\n        if (cartItems.length === 0) {\n            return (\n                <div className=\"py-20 text-center flex flex-col items-center gap-6\">\n                    <div className={`p-6 rounded-full border transition-colors duration-300 ${darkMode ? 'bg-white/5 border-white/5' : 'bg-slate-100 border-slate-200'}`}>\n                        <ShoppingCart className={`w-12 h-12 transition-colors duration-300 ${darkMode ? 'text-slate-700' : 'text-slate-300'}`} />\n                    </div>\n                    <p className={`text-sm font-black uppercase tracking-widest italic transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>No hay productos activos</p>\n                </div>\n            );\n        }\n        return (\n            <>\n                <div className=\"flex justify-between items-center px-2\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Contenido del Carrito</p>\n                    <p className=\"text-xs font-bold text-orange-400 bg-orange-400/10 px-3 py-1 rounded-full\">{cartItems.length} ITEMS</p>\n                </div>\n                <div className=\"space-y-3\">\n                    {cartItems.map((item, idx) => (\n                        <div key={idx} className={`border p-4 rounded-2xl flex gap-4 transition group animate-fade-up transition-colors duration-300 ${darkMode ? 'bg-white/[0.03] border-white/10 hover:bg-white/[0.05] hover:border-orange-500/20' : 'bg-slate-50 border-slate-100 hover:bg-slate-100 hover:border-orange-200'}`} style={{ animationDelay: `${idx * 0.05}s` }}>\n                            <div className={`w-16 h-16 rounded-xl overflow-hidden shadow-inner border flex-shrink-0 transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-white/5' : 'bg-white border-slate-200'}`}>\n                                <img src={item.image || 'https://images.unsplash.com/photo-1581404917879-53e19259fdda?w=100'} className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\" />\n                            </div>\n                            <div className=\"flex-1 flex flex-col justify-center\">\n                                <p className={`font-bold text-sm leading-tight mb-1 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.name}</p>\n                                <div className=\"flex justify-between items-center\">\n                                    <p className={`text-xs transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>Cant: <span className={`font-mono font-bold transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}</span></p>\n                                    <p className=\"text-orange-400 font-black font-mono text-xs\">${Number(item.price).toLocaleString()}</p>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n                <div className={`pt-6 border-t transition-colors duration-300 ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                    <div className={`flex justify-between items-center p-6 rounded-2xl border transition-colors duration-300 ${darkMode ? 'bg-orange-500/5 border-orange-500/20' : 'bg-orange-50 border-orange-100'}`}>\n                        <p className={`font-bold transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Valor Total</p>\n                        <p className={`text-2xl font-black font-mono transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartItems.reduce((acc, i) => acc + (Number(i.price) * i.quantity), 0).toLocaleString()}</p>\n                    </div>\n                </div>\n            </>\n        );\n    };\n\n    const UserEditForm = ({ user, currentUser, initialData, onSubmit, onDelete, isSaving }) => {\n        const [formData, setFormData] = useState(initialData);\n        const SUPER_ADMIN_EMAIL = 'lautarocorazza63@gmail.com';\n        const isSuperAdminProfile = user.email === SUPER_ADMIN_EMAIL;\n\n        // Update local state when initialData changes\n        useEffect(() => {\n            setFormData(initialData);\n        }, [initialData]);\n\n        const handleSubmit = (e) => {\n            e.preventDefault();\n            onSubmit(formData);\n        };\n\n        return (\n            <form onSubmit={handleSubmit} className=\"space-y-8 animate-fade-in\">\n                {/* Datos de Identidad */}\n                <div className=\"space-y-6\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                        <User className=\"w-3 h-3\" /> Datos Identidad\n                    </p>\n                    <div className=\"grid grid-cols-1 gap-6\">\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Nombre Completo\"\n                                value={formData.name}\n                                onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                required\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Username / Alias\"\n                                value={formData.username}\n                                onChange={e => setFormData({ ...formData, username: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'} ${isSuperAdminProfile ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                placeholder=\"Email de la cuenta (Principal)\"\n                                value={formData.email}\n                                onChange={e => setFormData({ ...formData, email: e.target.value })}\n                                required\n                                disabled={isSuperAdminProfile}\n                                title={isSuperAdminProfile ? \"No se puede modificar el email del Super Admin\" : \"\"}\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"DNI\"\n                                value={formData.dni}\n                                onChange={e => setFormData({ ...formData, dni: e.target.value })}\n                            />\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Teléfono\"\n                                value={formData.phone}\n                                onChange={e => setFormData({ ...formData, phone: e.target.value })}\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Seguridad y Rol */}\n                <div className=\"space-y-6 pt-4\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                        <Lock className=\"w-3 h-3\" /> Seguridad & Rol\n                    </p>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <div className=\"relative group\">\n                                <input\n                                    type=\"password\"\n                                    className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                    placeholder=\"Nueva Contraseña (Dejar vacío para no cambiar)\"\n                                    value={formData.newPassword}\n                                    onChange={e => setFormData({ ...formData, newPassword: e.target.value })}\n                                />\n                            </div>\n                            <p className={`text-[9px] mt-2 ml-1 italic transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>Mínimo 6 caracteres para actualizar.</p>\n                        </div>\n\n                        <div className={`flex p-1.5 rounded-2xl border transition-all duration-300 ${darkMode ? 'bg-slate-900/50 border-white/5' : 'bg-slate-100 border-slate-200'} ${isSuperAdminProfile ? 'opacity-50 pointer-events-none' : ''}`}>\n                            {['user', 'editor', 'admin'].map(r => (\n                                <button\n                                    key={r}\n                                    type=\"button\"\n                                    onClick={() => setFormData({ ...formData, role: r })}\n                                    className={`flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${formData.role === r ? (darkMode ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20' : 'bg-white text-indigo-600 shadow-sm') : (darkMode ? 'text-slate-500 hover:text-slate-300' : 'text-slate-400 hover:text-slate-600')\n                                        }`}\n                                >\n                                    {r}\n                                </button>\n                            ))}\n                        </div>\n                        {isSuperAdminProfile && <p className=\"text-[9px] text-orange-400 mt-1 ml-1\">Rol de Super Admin inmutable.</p>}\n                    </div>\n                </div>\n\n                <div className=\"space-y-4 pt-6\">\n                    <button\n                        type=\"submit\"\n                        disabled={isSaving}\n                        className=\"w-full py-5 bg-gradient-to-r from-indigo-600 to-orange-600 hover:from-indigo-500 hover:to-orange-500 text-white font-black rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50\"\n                    >\n                        {isSaving ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <Save className=\"w-6 h-6\" />}\n                        SINCRONIZAR CAMBIOS\n                    </button>\n\n                    {!isSuperAdminProfile && (\n                        <button\n                            type=\"button\"\n                            onClick={onDelete}\n                            className=\"w-full py-4 border border-red-500/30 bg-red-500/5 text-red-500 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-500/10 transition flex items-center justify-center gap-2\"\n                        >\n                            <Trash2 className=\"w-4 h-4\" /> Eliminar Cuenta Permanente\n                        </button>\n                    )}\n                </div>\n            </form>\n        );\n    };\n\n    // Unified Right Sidebar Drawer (Admin)\n    const AdminUserDrawer = () => {\n        const [userCartItems, setUserCartItems] = useState([]);\n        const [isLoadingCart, setIsLoadingCart] = useState(false);\n        const [isSaving, setIsSaving] = useState(false);\n        const active = viewUserCart || userPassModal || viewUserEdit;\n\n        // Determinamos el tipo basado en qué activó el drawer: 'cart', 'edit', o 'password'\n        const type = viewUserCart ? 'cart' : (userPassModal ? 'password' : 'edit');\n        const user = viewUserCart || userPassModal || viewUserEdit;\n\n        const [initialFormState, setInitialFormState] = useState({\n            name: '',\n            username: '',\n            email: '',\n            phone: '',\n            dni: '',\n            role: 'user',\n            newPassword: ''\n        });\n\n        // Effect to update initial form state and fetch cart\n        useEffect(() => {\n            if (active && user) {\n                if (type === 'cart') {\n                    const fetchCart = async () => {\n                        setIsLoadingCart(true);\n                        try {\n                            const cartDoc = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', user.id));\n                            setUserCartItems(cartDoc.exists() ? (cartDoc.data().items || []) : []);\n                        } catch (e) { setUserCartItems([]); }\n                        setIsLoadingCart(false);\n                    };\n                    fetchCart();\n                }\n\n                setInitialFormState({\n                    name: user.name || '',\n                    username: user.username || '',\n                    email: user.email || '',\n                    phone: user.phone || '',\n                    dni: user.dni || '',\n                    role: user.role || 'user',\n                    newPassword: ''\n                });\n            }\n        }, [active, user, type]);\n\n\n        const closeDrawer = () => {\n            setViewUserCart(null);\n            setUserPassModal(null);\n            setViewUserEdit(null);\n        };\n\n        const handleEditSubmit = async (formData) => {\n            setIsSaving(true);\n            try {\n                if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesión inválida');\n                const token = await auth.currentUser.getIdToken();\n                // 1. Actualización Crítica (Auth) vía API si cambió email o password\n                const authUpdate = {};\n                if (formData.email !== user.email) authUpdate.email = formData.email;\n                if (formData.newPassword) authUpdate.password = formData.newPassword;\n\n                if (Object.keys(authUpdate).length > 0) {\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'update', uid: user.id, ...authUpdate })\n                    });\n                    const result = await res.json();\n                    if (!res.ok) throw new Error(result.error);\n                }\n\n                // 2. Actualización de Perfil (Firestore)\n                const firestoreUpdate = {\n                    name: formData.name,\n                    username: formData.username,\n                    email: formData.email,\n                    emailLower: formData.email.toLowerCase(),\n                    phone: formData.phone,\n                    dni: formData.dni,\n                    role: formData.role,\n                    lastModifiedBy: currentUser.email,\n                    updatedAt: new Date().toISOString()\n                };\n\n                // Si cambió la contraseña, también actualizarla en Firestore\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id), firestoreUpdate);\n\n                // Si estamos editando nuestro propio usuario, actualizar el estado global inmediatamente\n                if (currentUser && currentUser.id === user.id) {\n                    setCurrentUser(prev => ({ ...prev, ...firestoreUpdate }));\n                }\n\n                showToast(\"Perfil de usuario actualizado correctamente.\", \"success\");\n                closeDrawer();\n\n            } catch (e) {\n                console.error(e);\n                showToast(e.message || \"Error al actualizar perfil.\", \"error\");\n            }\n            setIsSaving(false);\n        };\n\n        const handleDeleteUser = async () => {\n            if (user.email === currentUser.email) {\n                return showToast(\"Autoprotección activa: No puedes eliminar tu propia cuenta.\", \"warning\");\n            }\n\n            openConfirm(\"ELIMINAR USUARIO\", `¿Estás seguro de eliminar a ${user.name}? Esta acción es irreversible y borrará su acceso y datos.`, async () => {\n                setIsSaving(true);\n                try {\n                    if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesión inválida');\n                    const token = await auth.currentUser.getIdToken();\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'delete', uid: user.id })\n                    });\n                    if (!res.ok) throw new Error(\"Error eliminando acceso de Auth\");\n\n                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id));\n\n                    showToast(\"Usuario eliminado definitivamente.\", \"success\");\n                    closeDrawer();\n                } catch (e) {\n                    console.error(e);\n                    showToast(\"Fallo al eliminar usuario.\", \"error\");\n                }\n                setIsSaving(false);\n            });\n        };\n\n        if (!active) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[1000] flex justify-end animate-fade-in pointer-events-none\">\n                <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto\" onClick={closeDrawer} />\n\n                <div className={`w-full max-w-xl border-l shadow-[-20px_0_50px_rgba(0,0,0,0.5)] flex flex-col h-full pointer-events-auto relative overflow-hidden animate-slide-left transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-white/10' : 'bg-white border-slate-200'}`}>\n                    <div className=\"absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-600 via-orange-500 to-pink-600\"></div>\n\n                    <div className={`p-8 border-b flex justify-between items-center transition-colors duration-300 ${darkMode ? 'border-white/5 bg-white/[0.02]' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h2 className={`text-xl font-black tracking-widest uppercase transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                {type === 'cart' ? 'Auditoría de Carrito' : 'Configurar Cuenta'}\n                            </h2>\n                            <p className={`text-[10px] font-bold mt-1 tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                <span className=\"w-1.5 h-1.5 rounded-full bg-orange-400 animate-pulse\"></span>\n                                ID: {user.id.slice(-8).toUpperCase()} • {user.email}\n                            </p>\n                        </div>\n                        <button onClick={closeDrawer} className={`p-3 rounded-2xl transition-all border group ${darkMode ? 'bg-white/5 hover:bg-white/10 border-white/5' : 'bg-slate-100 hover:bg-slate-200 border-slate-200'}`}>\n                            <X className={`w-5 h-5 transition-colors duration-300 ${darkMode ? 'text-slate-400 group-hover:text-white' : 'text-slate-500 group-hover:text-slate-900'}`} />\n                        </button>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-8 custom-scrollbar space-y-8\">\n                        {type === 'cart' && <UserCartView cartItems={userCartItems} isLoading={isLoadingCart} />}\n                        {(type === 'edit' || type === 'password') && (\n                            <UserEditForm\n                                user={user}\n                                currentUser={currentUser}\n                                initialData={initialFormState}\n                                onSubmit={handleEditSubmit}\n                                onDelete={handleDeleteUser}\n                                isSaving={isSaving}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Estado de Carga Inicial\n    if (isLoading && view === 'store') {\n        const loadingPrimaryColor = settings?.primaryColor || '#f97316';\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white px-4\">\n                <div className=\"relative\">\n                    <div className=\"w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: loadingPrimaryColor }}></div>\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 animate-pulse\" style={{ color: loadingPrimaryColor }} />\n                    </div>\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-3xl font-black tracking-[0.1em] sm:tracking-[0.2em] md:tracking-[0.3em] mt-6 sm:mt-8 animate-pulse text-center max-w-[90vw]\" style={{ color: loadingPrimaryColor, textShadow: `0 0 20px ${loadingPrimaryColor}40` }}>\n                    {settings?.loadingTitle || settings?.storeName || ''}\n                </h1>\n                <p className=\"text-slate-500 text-xs sm:text-sm mt-3 sm:mt-4 font-mono uppercase tracking-wider sm:tracking-widest text-center\">\n                    {settings?.loadingText || 'Cargando sistema...'}\n                </p>\n            </div>\n        );\n    }\n\n    // Modo Mantenimiento\n    if (settings?.maintenanceMode && !isAdmin(currentUser?.email)) {\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white p-4 sm:p-6 text-center\">\n                <div className=\"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mb-6 sm:mb-8 border border-red-900/50 animate-pulse\">\n                    <AlertTriangle className=\"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12\" />\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-4xl font-black mb-3 sm:mb-4 tracking-tight uppercase\">Sistema en Mantenimiento</h1>\n                <p className=\"text-slate-400 max-w-sm sm:max-w-md mx-auto leading-relaxed text-sm sm:text-base\">\n                    Estamos realizando mejoras para brindarte una experiencia premium.\n                    ¡Te mandamos un saludo y esperamos que vuelvas prontamente!\n                </p>\n                <div className=\"mt-8 sm:mt-12 pt-8 sm:pt-12 border-t border-slate-900 w-full max-w-xs\">\n                    <p className=\"text-[10px] sm:text-xs text-slate-600 font-mono italic\">{settings?.storeName || ''} - Modo Mantenimiento Activo</p>\n                </div>\n            </div>\n        );\n    }\n\n    // --- LÓGICA DE FILTRADO Y ORDENAMIENTO INTELIGENTE ---\n    const filteredProducts = products\n        .filter(p => {\n            // Excluir productos desactivados de la tienda pública\n            if (p.isActive === false) return false;\n\n            const matchesSearch = (p.name || '').toLowerCase().includes(searchQuery.toLowerCase());\n\n            // Lógica de Categorías Especiales\n            if (selectedCategory === 'Promos') return false; // El grid estándar se oculta para Promos\n            if (selectedCategory === 'Ofertas') {\n                return matchesSearch && (p.discount > 0);\n            }\n\n            // NUEVO: Soporte para múltiples categorías\n            // Verificar si el producto tiene el array categories o el campo legacy category\n            const matchesCategory = (() => {\n                // Sin filtro seleccionado - mostrar todos\n                if (selectedCategory === '') return true;\n\n                // Producto con múltiples categorías (nuevo sistema)\n                if (Array.isArray(p.categories)) {\n                    return p.categories.includes(selectedCategory);\n                }\n\n                // Producto con categoría antigua (retrocompatibilidad)\n                if (p.category) {\n                    return p.category.trim() === selectedCategory;\n                }\n\n                // Sin categoría asignada\n                return false;\n            })();\n\n            return matchesSearch && matchesCategory;\n        })\n        .sort((a, b) => {\n            // Prioridad 1: Productos Destacados primero\n            if (a.isFeatured && !b.isFeatured) return -1;\n            if (!a.isFeatured && b.isFeatured) return 1;\n            // Prioridad 2: Más vendidos\n            const salesA = dashboardMetrics?.salesCount?.[a.id] || 0;\n            const salesB = dashboardMetrics?.salesCount?.[b.id] || 0;\n            return salesB - salesA;\n        });\n\n    // --- RENDERIZADO PRINCIPAL (RETURN) ---\n    return (\n\n        <div className={`min-h-screen flex flex-col relative w-full bg-grid font-sans selection:bg-orange-500/30 selection:text-orange-200 transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-slate-50'}`}>\n            {/* DEBUGGER VISUAL (SOLO DESARROLLO) */}\n            {view === 'store' && currentUser?.role === 'admin' && (\n                <div className=\"fixed bottom-4 left-4 z-[9999] bg-black/80 text-green-400 font-mono text-xs p-2 rounded border border-green-900 pointer-events-none\">\n                    [DEBUG] Total: {products.length} | Filtro: {filteredProducts.length} | Cat: {selectedCategory || 'ALL'}\n                </div>\n            )}\n\n            {/* Efectos de Fondo Globales */}\n            <div className=\"fixed inset-0 pointer-events-none z-0\">\n                <div className=\"absolute top-[-10%] left-[-10%] w-[60%] h-[60%] bg-purple-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n                <div className=\"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-orange-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n            </div>\n\n\n            {/* Contenedores Globales (Toasts y Modales) */}\n            <div className=\"fixed top-24 right-4 z-[20001] space-y-3 pointer-events-none\">\n                {/* Toasts necesitan pointer-events-auto para poder cerrarlos */}\n                <div className=\"pointer-events-auto space-y-3\">\n                    {toasts.map(t => (\n                        <Toast key={t.id} message={t.message} type={t.type} onClose={() => removeToast(t.id)} />\n                    ))}\n                </div>\n            </div>\n\n            {storeResolution.status !== 'resolved' && (\n                <div className=\"fixed inset-0 z-[10000] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4\">\n                    <div className=\"w-full max-w-xl rounded-3xl border border-white/10 bg-[#050505] p-8 shadow-2xl\">\n                        {storeResolution.status === 'resolving' ? (\n                            <div className=\"flex items-center gap-4\">\n                                <Loader2 className=\"w-7 h-7 animate-spin text-orange-500\" />\n                                <div>\n                                    <p className=\"text-white font-black text-xl tracking-tight\">Detectando tienda…</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">{storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-6\">\n                                <div className=\"space-y-2\">\n                                    <p className=\"text-white font-black text-2xl tracking-tight\">Tienda no configurada</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">Dominio: {storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n\n                                {!systemUser || systemUser.isAnonymous ? (\n                                    <div className=\"space-y-4\">\n                                        <p className=\"text-slate-400 text-sm\">Iniciá sesión para configurar este dominio.</p>\n                                        <button\n                                            onClick={() => setView('login')}\n                                            className=\"w-full py-4 rounded-2xl bg-gradient-to-r from-orange-600 to-purple-600 text-white font-black uppercase tracking-widest text-xs hover:from-orange-500 hover:to-purple-500 transition\"\n                                        >\n                                            Iniciar sesión\n                                        </button>\n                                    </div>\n                                ) : !isSuperAdminSession ? (\n                                    <div className=\"space-y-3\">\n                                        <p className=\"text-slate-400 text-sm\">Este dominio solo puede registrarlo el Super Admin.</p>\n                                        <p className=\"text-slate-600 text-xs font-mono\">Sesión: {systemUser?.email || systemUser?.uid}</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-5\">\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-300 text-sm\">Elegí cómo querés vincular este dominio:</p>\n                                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            const newStoreId = createStoreId();\n                                                            await registerHostname(newStoreId);\n                                                            showToast(`Dominio vinculado a ${newStoreId}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo crear la tienda', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-[10px] uppercase tracking-widest hover:bg-white/10 transition disabled:opacity-50\"\n                                                >\n                                                    Crear tienda nueva\n                                                </button>\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(DEFAULT_APP_ID);\n                                                            showToast(`Dominio vinculado a ${DEFAULT_APP_ID}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-orange-500/10 border border-orange-500/20 text-orange-400 font-black text-[10px] uppercase tracking-widest hover:bg-orange-500/20 transition disabled:opacity-50\"\n                                                >\n                                                    Usar tienda default\n                                                </button>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-500 text-xs font-mono\">O pegá un storeId existente:</p>\n                                            <div className=\"flex gap-2\">\n                                                <input\n                                                    value={storeSetupStoreIdInput}\n                                                    onChange={(e) => setStoreSetupStoreIdInput(e.target.value)}\n                                                    className=\"input-cyber flex-1 p-4 text-sm font-mono\"\n                                                    placeholder=\"storeId (ej: cliente-abc123)\"\n                                                />\n                                                <button\n                                                    disabled={isStoreSetupSaving || !storeSetupStoreIdInput.trim()}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(storeSetupStoreIdInput.trim());\n                                                            showToast('Dominio vinculado', 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"px-5 rounded-2xl bg-indigo-600 text-white font-black text-[10px] uppercase tracking-widest hover:bg-indigo-500 transition disabled:opacity-50\"\n                                                >\n                                                    Vincular\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n\n\n            <OrderDetailsModal order={selectedOrder} onClose={() => setSelectedOrder(null)} />\n            <CouponSelectorModal />\n            <ProductDetailModal />\n\n            {/* --- BARRA DE NAVEGACIÓN (NAVBAR) --- */}\n            {view !== 'admin' && (\n                <nav className={`fixed top-0 w-full h-16 sm:h-20 z-50 px-3 sm:px-6 md:px-12 flex items-center justify-between backdrop-blur-xl transition-all duration-300 ${darkMode ? 'glass border-b border-slate-800/50' : 'bg-white/95 border-b border-slate-200 shadow-sm'}`}>\n                    {/* Logo y Menú */}\n                    <div className=\"flex items-center gap-2 sm:gap-6\">\n                        <button onClick={() => setIsMenuOpen(true)} className={`p-2 sm:p-3 rounded-lg sm:rounded-xl transition border group ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                            <Menu className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                        </button>\n                        <div className=\"cursor-pointer group flex items-center gap-2 sm:gap-3\" onClick={() => setView('store')}>\n                            {settings?.logoUrl && (\n                                <div className={`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full overflow-hidden border-2 bg-white p-0.5 flex-shrink-0 shadow-lg group-hover:border-orange-500 transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                    <img src={settings.logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover rounded-full\" />\n                                </div>\n                            )}\n                            <div className=\"flex flex-col\">\n                                <span className={`text-xl sm:text-2xl md:text-4xl font-black tracking-tighter italic group-hover:text-orange-500 transition-all duration-300 leading-none ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    {!settingsLoaded ? (\n                                        <span className={`inline-block h-6 sm:h-8 w-20 sm:w-32 rounded animate-pulse ${darkMode ? 'bg-slate-700/50' : 'bg-slate-200'}`}></span>\n                                    ) : (settings?.storeName || '')}\n                                </span>\n                                <div className=\"h-0.5 sm:h-1 w-1/2 bg-orange-500 rounded-full group-hover:w-full transition-all duration-500 mt-0.5 sm:mt-1 shadow-sm\"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Barra de Búsqueda (Visible en Desktop) */}\n                    <div className={`hidden lg:flex items-center rounded-2xl px-6 py-3 w-1/3 transition shadow-inner group ${darkMode ? 'bg-slate-900/50 border border-slate-700/50 focus-within:border-orange-500/50 focus-within:bg-slate-900' : 'bg-slate-100 border border-slate-200 focus-within:border-orange-400 focus-within:bg-white focus-within:shadow-md'}`}>\n                        <Search className={`w-5 h-5 mr-3 group-focus-within:text-orange-500 transition ${darkMode ? 'text-slate-400' : 'text-slate-500'}`} />\n                        <input\n                            className={`bg-transparent outline-none text-sm w-full font-medium ${darkMode ? 'text-white placeholder-slate-500' : 'text-slate-900 placeholder-slate-400'}`}\n                            placeholder=\"¿Qué estás buscando hoy?\"\n                            value={searchQuery}\n                            onChange={e => setSearchQuery(e.target.value)}\n                        />\n                    </div>\n\n                    {/* Acciones de Usuario */}\n                    <div className=\"flex items-center gap-4\">\n                        {/* Botones de Contacto */}\n                        <div className=\"hidden md:flex items-center gap-2\">\n                            {settings?.showWhatsapp !== false && settings?.whatsappLink && (\n                                <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-green-900/10 text-green-400 hover:bg-green-500 hover:text-white border border-green-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(34,197,94,0.3)]\">\n                                    <MessageCircle className=\"w-5 h-5\" /> WhatsApp\n                                </button>\n                            )}\n                            {settings?.showInstagram !== false && settings?.instagramLink && (\n                                <button onClick={() => window.open(settings?.instagramLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-pink-900/10 text-pink-400 hover:bg-pink-500 hover:text-white border border-pink-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(236,72,153,0.3)]\">\n                                    <Instagram className=\"w-5 h-5\" /> Instagram\n                                </button>\n                            )}\n                        </div>\n\n                        {/* Botón Modo Claro/Oscuro */}\n                        <button\n                            onClick={() => setDarkMode(!darkMode)}\n                            className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group overflow-hidden border ${darkMode ? 'bg-slate-900/50 text-yellow-400 hover:bg-slate-800 border-slate-700/50' : 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100 border-yellow-200'}`}\n                            title={darkMode ? 'Activar modo claro' : 'Activar modo oscuro'}\n                        >\n                            <div className={`transform transition-all duration-500 ${darkMode ? 'rotate-0 scale-100' : 'rotate-180 scale-0 absolute'}`}>\n                                <Moon className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                            <div className={`transform transition-all duration-500 ${!darkMode ? 'rotate-0 scale-100' : '-rotate-180 scale-0 absolute'}`}>\n                                <Sun className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                        </button>\n\n                        {/* Botón Carrito */}\n                        <button onClick={() => setView('cart')} className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group border ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50 hover:border-orange-500/30' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200 hover:border-orange-400'}`}>\n                            <ShoppingBag className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                            {cart.length > 0 && (\n                                <span className={`absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 bg-orange-500 text-white text-[9px] sm:text-[10px] font-black w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center shadow-lg border-2 animate-bounce-short ${darkMode ? 'border-[#050505]' : 'border-white'}`}>\n                                    {cart.length}\n                                </span>\n                            )}\n                        </button>\n\n                        {/* Perfil / Login - Solo mostrar perfil si el usuario tiene datos válidos */}\n                        {currentUser && currentUser.id && currentUser.email && currentUser.name ? (\n                            <button onClick={() => setView('profile')} className={`flex items-center gap-2 sm:gap-3 pl-2 pr-3 sm:pr-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl border transition group ${darkMode ? 'bg-slate-900/50 border-slate-700/50 hover:border-orange-500/50' : 'bg-slate-100 border-slate-200 hover:border-orange-400'}`}>\n                                <div className=\"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center text-white font-bold shadow-lg text-xs sm:text-sm group-hover:scale-105 transition\">\n                                    {currentUser.name.charAt(0)}\n                                </div>\n                                <div className=\"text-left hidden md:block\">\n                                    <p className={`text-[9px] sm:text-[10px] uppercase font-bold tracking-wider ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Hola,</p>\n                                    <p className={`text-xs sm:text-sm font-bold leading-none group-hover:text-orange-500 transition ${darkMode ? 'text-white' : 'text-slate-900'}`}>{currentUser.name.split(' ')[0]}</p>\n                                </div>\n                            </button>\n                        ) : (\n                            <button onClick={() => setView('login')} className={`px-3 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-black transition shadow-lg flex items-center gap-1 sm:gap-2 transform hover:-translate-y-0.5 ${darkMode ? 'bg-white text-black hover:bg-orange-500 hover:text-white' : 'bg-orange-500 text-white hover:bg-orange-600'}`}>\n                                <User className=\"w-4 h-4 sm:w-5 sm:h-5\" /> <span className=\"hidden sm:inline\">INGRESAR</span><span className=\"sm:hidden\">Entrar</span>\n                            </button>\n                        )}\n                    </div>\n                </nav>\n            )}\n\n            {/* --- MENÚ MÓVIL (DETALLADO Y EXPLÍCITO) --- */}\n            {isMenuOpen && (\n                <div className=\"fixed inset-0 z-[10000] flex justify-start\">\n                    {/* Backdrop */}\n                    <div className={`fixed inset-0 backdrop-blur-sm transition-opacity ${darkMode ? 'bg-black/90' : 'bg-black/50'}`} onClick={() => setIsMenuOpen(false)}></div>\n\n                    {/* Panel Lateral */}\n                    <div className={`relative w-72 sm:w-80 h-full p-6 sm:p-8 animate-fade-in-right flex flex-col shadow-2xl z-[10001] ${darkMode ? 'bg-[#0a0a0a] border-r border-slate-800' : 'bg-white border-r border-slate-200'}`}>\n                        <div className={`flex justify-between items-center mb-8 sm:mb-10 border-b pb-4 sm:pb-6 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <h2 className={`text-2xl sm:text-3xl font-black tracking-tight drop-shadow-md ${darkMode ? 'text-white' : 'text-slate-900'}`}>MENÚ</h2>\n                            <button onClick={() => setIsMenuOpen(false)} className={`p-2 sm:p-3 rounded-full transition border ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                                <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                            </button>\n                        </div>\n\n                        {/* Lista de Botones */}\n                        <div className=\"space-y-2 sm:space-y-3 flex-1 overflow-y-auto custom-scrollbar pr-2\">\n                            <button onClick={() => { setView('store'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Home className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Inicio\n                            </button>\n\n                            <button onClick={() => { setView('profile'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <User className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Mi Perfil\n                            </button>\n\n                            <button onClick={() => { setView('cart'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <div className=\"relative\">\n                                    <ShoppingBag className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                    {cart.length > 0 && <span className=\"absolute -top-2 -right-2 bg-orange-500 text-[10px] text-white rounded-full w-4 h-4 flex items-center justify-center font-bold\">{cart.length}</span>}\n                                </div>\n                                Mi Carrito\n                            </button>\n\n                            <div className={`h-px my-3 sm:my-4 mx-4 ${darkMode ? 'bg-slate-800' : 'bg-slate-200'}`}></div>\n\n                            <button onClick={() => { setView('about'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Info className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Sobre Nosotros\n                            </button>\n\n                            {settings?.showGuideLink !== false && (\n                                <button onClick={() => { setView('guide'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                    <FileQuestion className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> {settings?.guideTitle || 'Cómo Comprar'}\n                                </button>\n                            )}\n\n                            {/* Panel Admin (Solo si tiene permisos) */}\n                            {hasAccess(currentUser?.email) && (\n                                <button onClick={() => { setView('admin'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold text-orange-500 mt-4 sm:mt-6 pt-4 sm:pt-6 flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl transition border ${darkMode ? 'border-t border-slate-800 bg-orange-900/10 hover:bg-orange-900/20 border-orange-500/20' : 'border-t border-slate-200 bg-orange-50 hover:bg-orange-100 border-orange-200'}`}>\n                                    <Shield className=\"w-5 h-5 sm:w-6 sm:h-6\" /> Admin Panel\n                                </button>\n                            )}\n                        </div>\n\n                        <div className={`mt-6 sm:mt-8 pt-6 sm:pt-8 border-t text-center ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-widest ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>{settings?.menuCopyright || settings.storeName}</p>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Espaciador para el Navbar Fixed */}\n            {view !== 'admin' && <div className=\"h-16 sm:h-20 md:h-24\"></div>}\n\n            {/* --- CONTENIDO PRINCIPAL (VIEW SWITCHER) --- */}\n            <main className={`flex-grow relative z-10 ${view === 'admin' ? 'min-h-screen min-full-viewport flex overflow-hidden' : 'p-4 md:p-8'}`}>\n\n                {/* 1. VISTA TIENDA (HOME) */}\n                {view === 'store' && (\n                    <div className=\"max-w-[1400px] mx-auto pb-32 min-h-screen block\">\n\n                        {/* Anuncio Global (Marquesina) - Solo mostrar cuando settings están cargados */}\n                        {settingsLoaded && settings?.showAnnouncementBanner !== false && settings?.announcementMessage && (\n                            <div className=\"w-full bg-gradient-to-r from-orange-900/20 to-red-900/20 border border-orange-500/20 rounded-xl p-3 mb-8 text-center animate-pulse relative overflow-hidden group\">\n                                <div className=\"absolute inset-0 bg-white/5 skew-x-12 -translate-x-full group-hover:translate-x-full transition duration-1000\"></div>\n                                <p className=\"text-orange-400 font-black text-xs md:text-sm tracking-[0.2em] uppercase flex items-center justify-center gap-3\">\n                                    <Flame className=\"w-4 h-4 text-orange-500\" /> {settings.announcementMessage} <Flame className=\"w-4 h-4 text-orange-500\" />\n                                </p>\n                            </div>\n                        )}\n\n                        {/* Brand Ticker (Futuristic) - Solo mostrar cuando settings están cargados */}\n                        {settingsLoaded && settings?.showBrandTicker !== false && (\n                            <div className={`mb-8 w-full overflow-hidden border-y backdrop-blur-sm py-2 ${darkMode ? 'border-slate-800/50 bg-[#0a0a0a]/50' : 'border-slate-200 bg-slate-100/50'}`}>\n                                <div className=\"ticker-wrap\">\n                                    <div className={`ticker-content font-mono text-xs md:text-sm tracking-[0.2em] md:tracking-[0.5em] uppercase flex items-center gap-6 md:gap-12 ${darkMode ? 'text-orange-500/50' : 'text-orange-600/70'}`}>\n                                        {[1, 2, 3, 4].map((i) => (\n                                            <React.Fragment key={i}>\n                                                <span className=\"whitespace-nowrap\">{settings?.tickerText || `${settings?.storeName || ''} Tech • Futuro • Calidad Premium • Innovación`}</span>\n                                                <span>•</span>\n                                            </React.Fragment>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Banner Hero */}\n                        <div className={`relative w-full h-[30vh] md:h-[350px] 2xl:h-[450px] rounded-[2rem] overflow-hidden shadow-2xl mb-8 border group container-tv ${darkMode ? 'border-slate-800 bg-[#080808]' : 'border-slate-200 bg-white'}`}>\n                            {/* Grid Background Effect */}\n                            <div className=\"grid-bg\"></div>\n                            <div className={`absolute inset-0 bg-[url('/noise.svg')] z-[1] ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n                            <HomeBannerCarouselBackground\n                                settingsLoaded={settingsLoaded}\n                                banners={settings?.showHomeBannerCarousel === false ? [] : homeBanners}\n                                fallbackUrl={settings?.heroUrl}\n                                autoplayMs={settings?.homeBannerAutoplayMs || 5000}\n                                darkMode={darkMode}\n                                onBannerClick={handleHomeBannerClick}\n                            />\n\n                            {/* Overlay de Texto */}\n                            <div className={`absolute inset-0 flex flex-col justify-center px-8 md:px-20 z-10 p-12 pointer-events-none ${darkMode ? 'bg-gradient-to-t md:bg-gradient-to-r from-[#050505] via-[#050505]/80 to-transparent' : 'bg-gradient-to-t md:bg-gradient-to-r from-white/25 via-white/10 to-transparent'}`}>\n                                <div className=\"max-w-2xl animate-fade-up\">\n                                    {/* Skeleton/Loading mientras no se cargan los settings */}\n                                    {!settingsLoaded ? (\n                                        <>\n                                            <div className=\"h-6 w-32 bg-slate-700/50 rounded-md mb-4 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-64 md:w-80 bg-slate-700/50 rounded-lg mb-2 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-48 md:w-64 bg-slate-700/50 rounded-lg mb-4 animate-pulse\"></div>\n                                            <div className=\"h-4 w-72 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                            <div className=\"h-4 w-56 bg-slate-700/50 rounded mb-6 animate-pulse\"></div>\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"h-12 w-40 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                                <div className=\"h-10 w-24 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                            </div>\n                                        </>\n                                    ) : (\n                                        <>\n                                            <span className=\"bg-orange-500 text-black px-3 py-1 rounded-md text-[10px] font-black uppercase tracking-widest shadow-[0_0_15px_rgba(255,255,255,0.1)] mb-4 inline-block\">\n                                                {settings?.heroBadge || ''}\n                                            </span>\n                                            <h1 className={`text-3xl md:text-5xl lg:text-6xl text-tv-huge font-black leading-[0.9] mb-4 ${darkMode ? 'text-white drop-shadow-2xl' : 'text-slate-900'}`}>\n                                                {settings?.heroTitle1 || ''} <br />\n                                                <span className={`text-transparent bg-clip-text bg-gradient-to-r ${darkMode ? 'from-orange-400 to-blue-600' : 'from-orange-600 to-blue-700'}`}>\n                                                    {settings?.heroTitle2 || ''}\n                                                </span>\n                                            </h1>\n                                            <p className={`text-sm md:text-base lg:text-lg mb-6 max-w-md font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                                {settings?.heroSubtitle || ''}\n                                            </p>\n                                            <div className=\"flex items-center gap-4\">\n                                                <button onClick={() => document.getElementById('catalog').scrollIntoView({ behavior: 'smooth' })} className=\"px-8 py-4 bg-white text-black font-black rounded-xl hover:bg-orange-400 transition shadow-[0_0_30px_rgba(255,255,255,0.1)] flex items-center justify-center gap-2 group/btn pointer-events-auto\">\n                                                    VER CATÁLOGO <ArrowRight className=\"w-5 h-5 group-hover/btn:translate-x-1 transition\" />\n                                                </button>\n                                                <button onClick={() => setView('guide')} className={`px-6 py-2.5 rounded-xl flex items-center gap-2 transition font-bold text-xs group pointer-events-auto ${darkMode ? 'bg-white/5 backdrop-blur-md border border-white/10 hover:bg-white/10 text-white' : 'bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-900'}`}>\n                                                    <Info className={`w-4 h-4 ${darkMode ? 'text-orange-400' : 'text-orange-600'}`} /> Ayuda\n                                                </button>\n                                            </div>\n                                        </>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Why Choose Us Section */}\n                        {/* Why Choose Us Section (Editable) - Respeta toggles de configuración */}\n                        {settingsLoaded && settings?.showFeaturesSection !== false && (\n                            <div className={`grid grid-cols-1 ${[settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 1 ? 'md:grid-cols-1 max-w-md mx-auto' :\n                                [settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 2 ? 'md:grid-cols-2 max-w-2xl mx-auto' :\n                                    'md:grid-cols-3'\n                                } gap-4 md:gap-8 mb-12 container-tv`}>\n                                {!settingsLoaded ? (\n                                    <>\n                                        {/* Skeleton para las tarjetas */}\n                                        {[1, 2, 3].map((i) => (\n                                            <div key={i} className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center\">\n                                                <div className=\"w-10 h-10 rounded-full bg-slate-700/50 mb-3 animate-pulse\"></div>\n                                                <div className=\"h-5 w-32 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                                <div className=\"h-3 w-48 bg-slate-700/50 rounded mb-1 animate-pulse\"></div>\n                                                <div className=\"h-3 w-40 bg-slate-700/50 rounded animate-pulse\"></div>\n                                            </div>\n                                        ))}\n                                    </>\n                                ) : (\n                                    <>\n                                        {/* Beneficio 1 */}\n                                        {settings?.showFeature1 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-orange-900/20' : 'bg-orange-100'}`}>\n                                                    <Zap className={`w-5 h-5 ${darkMode ? 'text-orange-400' : 'text-orange-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature1Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature1Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 2 */}\n                                        {settings?.showFeature2 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-purple-900/20' : 'bg-purple-100'}`}>\n                                                    <Shield className={`w-5 h-5 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature2Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature2Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 3 */}\n                                        {settings?.showFeature3 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-green-900/20' : 'bg-green-100'}`}>\n                                                    <Headphones className={`w-5 h-5 ${darkMode ? 'text-green-400' : 'text-green-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature3Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature3Desc || ''}</p>\n                                            </div>\n                                        )}\n                                    </>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Filtros de Categoría */}\n                        <div id=\"catalog\" className={`sticky top-16 sm:top-20 z-40 backdrop-blur-xl py-3 sm:py-4 mb-6 sm:mb-8 -mx-4 px-4 border-y transition-colors duration-300 ${darkMode ? 'bg-[#050505]/80 border-slate-800/50' : 'bg-white/90 border-slate-200'}`}>\n                            <div\n                                ref={categoriesScrollRef}\n                                onMouseDown={handleMouseDownCategories}\n                                onMouseLeave={handleMouseLeaveCategories}\n                                onMouseUp={handleMouseUpCategories}\n                                onMouseMove={handleMouseMoveCategories}\n                                className={`flex items-center gap-2 overflow-x-auto pb-1 ${isDraggingCategories ? 'cursor-grabbing scroll-auto' : 'cursor-grab scroll-smooth'}`}\n                                style={{ scrollbarWidth: 'none', msOverflowStyle: 'none', WebkitOverflowScrolling: 'touch' }}\n                            >\n                                <Filter className={`w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n\n                                {/* BOTÓN PROMOS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Promos')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-black text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 group relative overflow-hidden flex-shrink-0 ${selectedCategory === 'Promos' ? 'text-white border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.5)]' : darkMode ? 'bg-slate-900 border-slate-800 text-purple-400 hover:text-white hover:border-purple-500/50' : 'bg-purple-50 border-purple-200 text-purple-600 hover:bg-purple-100 hover:border-purple-300'}`}\n                                >\n                                    {selectedCategory === 'Promos' && <div className=\"absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 animate-gradient-xy\"></div>}\n                                    <span className=\"relative z-10 flex items-center gap-1.5 sm:gap-2\"><Sparkles className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> PROMOS</span>\n                                </button>\n\n                                {/* BOTÓN OFERTAS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Ofertas')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 flex-shrink-0 ${selectedCategory === 'Ofertas' ? 'bg-red-600/20 text-red-500 border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-red-400 hover:text-white hover:border-red-500/50' : 'bg-red-50 border-red-200 text-red-600 hover:bg-red-100 hover:border-red-300'}`}\n                                >\n                                    <Percent className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> OFERTAS\n                                </button>\n\n                                <button onClick={() => setSelectedCategory('')} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === '' ? darkMode ? 'bg-white text-black border-white shadow-[0_0_15px_rgba(255,255,255,0.2)]' : 'bg-slate-900 text-white border-slate-900 shadow-md' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}`}>\n                                    Todos\n                                </button>\n                                {settings?.categories?.map(c => (\n                                    <button key={c} onClick={() => setSelectedCategory(c)} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === c ? 'bg-orange-500 text-white border-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-orange-50 hover:border-orange-300 hover:text-orange-600'}`}>\n                                        {c}\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n\n\n                        {/* SECCIÓN PROMOS (NUEVO) */}\n                        {/* SECCIÓN PROMOS (TAB VIEW) */}\n                        {selectedCategory === 'Promos' && (\n                            <div className=\"mb-16 animate-fade-in\">\n                                {promos.length > 0 ? (\n                                    <>\n                                        <h2 className={`text-3xl font-black mb-8 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            <Tag className=\"w-8 h-8 text-purple-500 animate-pulse\" /> PROMOCIONES ESPECIALES\n                                        </h2>\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                                            {promos.map(promo => {\n                                                // Calcular si hay stock para esta promo\n                                                // La disponibilidad depende del \"item\" con menor stock relativo\n                                                let maxPurchasable = Infinity;\n                                                promo.items.forEach(item => {\n                                                    const p = products.find(prod => prod.id === item.productId);\n                                                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                                                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                                                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                                                });\n\n                                                const hasStock = maxPurchasable > 0;\n\n                                                return (\n                                                    <div key={promo.id} className={`rounded-[2.5rem] border overflow-hidden group transition duration-500 relative flex flex-col ${darkMode ? 'bg-gradient-to-br from-purple-900/10 to-blue-900/10 border-purple-500/30 shadow-[0_0_30px_rgba(168,85,247,0.1)] hover:shadow-[0_0_50px_rgba(168,85,247,0.2)]' : 'bg-white border-purple-200 shadow-sm hover:shadow-xl'}`}>\n                                                        <div\n                                                            className={`aspect-square flex items-center justify-center relative overflow-hidden cursor-zoom-in ${darkMode ? 'bg-slate-900/50' : 'bg-slate-50'}`}\n                                                            onClick={() => setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable })}\n                                                        >\n                                                            <img src={promo.image} className=\"w-full h-full object-contain transition duration-700 group-hover:scale-110\" />\n                                                            <div className={`absolute inset-0 bg-gradient-to-t via-transparent to-transparent ${darkMode ? 'from-[#0a0a0a]' : 'from-white/50'}`}></div>\n                                                            <div className=\"absolute top-4 right-4 bg-purple-600 text-white text-xs font-black px-3 py-1 rounded-full uppercase tracking-wider shadow-lg\">\n                                                                Oferta Limitada\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"p-8 flex-1 flex flex-col\">\n                                                            <h3 className={`text-2xl font-black mb-2 leading-tight ${darkMode ? 'text-white' : 'text-slate-900'}`}>{promo.name}</h3>\n                                                            <p className={`text-sm mb-6 flex-1 ${darkMode ? 'text-purple-300' : 'text-purple-600'}`}>{promo.description}</p>\n\n                                                            {/* Lista de productos incluidos */}\n                                                            <div className=\"mb-6 space-y-2\">\n                                                                <p className=\"text-[10px] uppercase font-bold text-slate-500 tracking-widest\">Incluye:</p>\n                                                                {promo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    return (\n                                                                        <div key={idx} className={`flex items-center gap-2 text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                                                            <CheckCircle className={`w-3.5 h-3.5 ${darkMode ? 'text-purple-500' : 'text-purple-600'}`} />\n                                                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}x</span> {p ? p.name : 'Producto'}\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                            </div>\n\n                                                            <div className={`flex items-center justify-between mt-auto pt-6 border-t ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                                                                <div className=\"flex flex-col\">\n                                                                    <span className=\"text-slate-500 text-xs font-bold line-through decoration-red-500 decoration-2\">\n                                                                        ${promo.items.reduce((acc, item) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                        }, 0).toLocaleString()}\n                                                                    </span>\n                                                                    <span className={`text-3xl font-black ${darkMode ? 'text-purple-400 neon-text' : 'text-purple-600'}`}>\n                                                                        ${Number(promo.price).toLocaleString()}\n                                                                    </span>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!hasStock) return showToast(\"Sin stock disponible para esta promo.\", \"warning\");\n                                                                        const promoProduct = {\n                                                                            id: promo.id,\n                                                                            name: promo.name,\n                                                                            basePrice: promo.price,\n                                                                            image: promo.image,\n                                                                            isPromo: true,\n                                                                            items: promo.items,\n                                                                            stock: maxPurchasable\n                                                                        };\n                                                                        manageCart(promoProduct, 1);\n                                                                    }}\n                                                                    disabled={!hasStock}\n                                                                    className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition shadow-lg ${hasStock ? (darkMode ? 'bg-white text-black hover:bg-purple-400 hover:text-white hover:scale-105' : 'bg-slate-900 text-white hover:bg-purple-600 hover:scale-105') : (darkMode ? 'bg-slate-800 text-slate-500 cursor-not-allowed' : 'bg-slate-200 text-slate-400 cursor-not-allowed')}`}\n                                                                >\n                                                                    {hasStock ? <ShoppingCart className=\"w-5 h-5\" /> : <X className=\"w-5 h-5\" />}\n                                                                    {hasStock ? 'AGREGAR' : 'AGOTADO'}\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                );\n                                            })}\n                                        </div>\n                                    </>\n                                ) : (\n                                    <div className={`flex flex-col items-center justify-center p-20 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                        <div className={`p-8 rounded-full mb-6 shadow-2xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                            <Tag className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                        </div>\n                                        <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Sin Promociones Activas</h3>\n                                        <p className=\"text-slate-500 max-w-sm\">No hay promociones disponibles en este momento. ¡Volvé pronto!</p>\n                                        <button\n                                            onClick={() => setSelectedCategory('')}\n                                            className={`mt-6 px-6 py-3 rounded-xl font-bold transition border ${darkMode ? 'bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 border-orange-500/20' : 'bg-orange-50 hover:bg-orange-100 text-orange-600 border-orange-200'}`}\n                                        >\n                                            Ver Todo el Catálogo\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Grid de Productos - Filtrando productos inválidos (ej: tests) */}\n                        {products.filter(p => p.isActive !== false).length === 0 ? (\n                            <div className={`flex flex-col items-center justify-center p-20 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                {/* Empty State explícito (sin componente externo para \"bulk\") */}\n                                <div className={`p-8 rounded-full mb-6 shadow-2xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <Package className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                </div>\n                                <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Catálogo Vacío</h3>\n                                <p className=\"text-slate-500 max-w-sm\">No hay productos disponibles en este momento. Por favor revisa más tarde o contacta soporte.</p>\n                            </div>\n                        ) : (\n                            <>\n                                {filteredProducts.length === 0 && selectedCategory !== 'Promos' && (\n                                    <div className=\"flex flex-col items-center justify-center p-20 text-center col-span-full animate-fade-in w-full\">\n                                        <div className={`p-6 rounded-full mb-4 inline-block border ${darkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                            <Search className={`w-12 h-12 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                        </div>\n                                        <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>No se encontraron resultados</h3>\n                                        <p className=\"text-slate-500 mb-6 max-w-md mx-auto\">\n                                            No hay productos que coincidan con <span className={`${darkMode ? 'text-white' : 'text-slate-900'} font-bold`}>\"{searchQuery}\"</span>\n                                            {selectedCategory && <span> en la categoría <span className={`${darkMode ? 'text-white' : 'text-slate-900'} font-bold`}>{selectedCategory}</span></span>}.\n                                        </p>\n                                        <button\n                                            onClick={() => { setSearchQuery(''); setSelectedCategory(''); }}\n                                            className={`px-6 py-3 rounded-xl font-bold transition border ${darkMode ? 'bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 border-orange-500/20' : 'bg-orange-50 hover:bg-orange-100 text-orange-600 border-orange-200'}`}\n                                        >\n                                            Limpiar filtros\n                                        </button>\n                                    </div>\n                                )}\n                                <div className=\"grid grid-cols-1 min-[380px]:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 min-[1920px]:grid-cols-5 gap-3 sm:gap-6 md:gap-8 pb-32\">\n                                    {filteredProducts.map(p => (\n                                        <ProductCard\n                                            key={p.id}\n                                            p={p}\n                                            settings={settings}\n                                            currentUser={currentUser}\n                                            toggleFavorite={toggleFavorite}\n                                            setSelectedProduct={setSelectedProduct}\n                                            manageCart={manageCart}\n                                            calculateItemPrice={calculateItemPrice}\n                                            darkMode={darkMode}\n                                        />\n                                    ))}\n                                </div>\n\n                            </>\n                        )}\n                    </div>\n                )}\n\n                {/* 2. VISTA DEL CARRITO DE COMPRAS */}\n                {view === 'cart' && (\n                    <div className=\"max-w-6xl mx-auto animate-fade-up px-4 md:px-8 pb-20\">\n                        <div className=\"flex flex-col gap-4 mb-8 pt-8 sm:flex-row sm:items-center sm:justify-between\">\n                            <div className=\"flex items-center gap-4\">\n                                <button onClick={() => setView('store')} className={`p-3 rounded-full transition group ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200'}`}>\n                                    <ArrowLeft className=\"w-6 h-6 group-hover:-translate-x-1 transition\" />\n                                </button>\n                                <h1 className={`text-4xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    <ShoppingBag className=\"w-10 h-10 text-orange-500\" /> Mi Carrito\n                                </h1>\n                            </div>\n\n                            {cart.length > 0 && settings?.showCartWhatsappCheckout === true && (\n                                <button\n                                    onClick={() => {\n                                        const url = buildWhatsappUrl(settings?.whatsappLink, buildWhatsappCartMessage());\n                                        if (!url) {\n                                            showToast('Configura el enlace de WhatsApp en Admin → Configuración → Social.', 'warning');\n                                            return;\n                                        }\n                                        window.open(url, '_blank');\n                                    }}\n                                    className=\"w-full sm:w-auto px-5 py-3 bg-green-600 hover:bg-green-500 text-white rounded-2xl font-black transition shadow-lg hover:shadow-green-500/30 flex items-center justify-center gap-2\"\n                                >\n                                    <MessageCircle className=\"w-5 h-5\" /> Terminar compra por WhatsApp\n                                </button>\n                            )}\n                        </div>\n\n                        {cart.length === 0 ? (\n                            <div className={`flex flex-col items-center justify-center p-16 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                <div className={`p-8 rounded-full mb-6 shadow-xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <ShoppingCart className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                </div>\n                                <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Tu carrito está vacío</h3>\n                                <p className=\"text-slate-500 text-sm max-w-xs mb-8 leading-relaxed\">\n                                    ¡Es un buen momento para buscar ese producto que tanto quieres!\n                                </p>\n                                <button onClick={() => setView('store')} className=\"px-8 py-4 bg-orange-600 text-white rounded-xl font-bold transition shadow-lg hover:bg-orange-500 hover:shadow-orange-500/30 flex items-center gap-2\">\n                                    Ir a la Tienda <ArrowRight className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        ) : (\n                            <div className=\"grid lg:grid-cols-3 gap-8\">\n                                {/* Lista de Items */}\n                                <div className=\"lg:col-span-2 space-y-4\">\n                                    {cart.map((item) => (\n                                        <div key={item.product.id} className={`p-4 md:p-6 rounded-3xl border flex flex-col md:flex-row gap-6 items-center group relative overflow-hidden transition duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-orange-900/50' : 'bg-white border-slate-200 hover:border-orange-200 shadow-sm hover:shadow-md'}`}>\n                                            {/* Imagen */}\n                                            <div className=\"w-full md:w-32 h-32 bg-white rounded-2xl flex items-center justify-center p-2 flex-shrink-0 shadow-lg border border-slate-100\">\n                                                <img src={item.product.image} alt={item.product.name} className=\"w-full h-full object-contain\" />\n                                            </div>\n\n                                            {/* Info */}\n                                            <div className=\"flex-1 w-full text-center md:text-left z-10\">\n                                                <div className=\"flex justify-between items-start w-full\">\n                                                    <h3 className={`font-bold text-lg truncate mb-1 pr-4 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.product.name}</h3>\n                                                    <button onClick={() => manageCart(item.product, -item.quantity)} className={`p-2 rounded-lg transition ${darkMode ? 'text-slate-600 hover:text-red-500 bg-slate-900 hover:bg-red-900/20' : 'text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50'}`}>\n                                                        <Trash2 className=\"w-5 h-5\" />\n                                                    </button>\n                                                </div>\n\n                                                <p className=\"text-orange-500 font-bold text-sm mb-4\">\n                                                    ${calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0).toLocaleString()} <span className=\"text-slate-500 font-normal\">unitario</span>\n                                                </p>\n\n                                                {/* Controles de Cantidad */}\n                                                <div className=\"flex items-center justify-center md:justify-start gap-4\">\n                                                    <div className={`flex items-center gap-3 rounded-xl p-1 border ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\n                                                        <button onClick={() => manageCart(item.product, -1)} className={`w-10 h-10 flex items-center justify-center rounded-lg transition ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}>\n                                                            <Minus className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <span className={`text-base font-bold w-8 text-center ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}</span>\n                                                        <button onClick={() => manageCart(item.product, 1)} className={`w-10 h-10 flex items-center justify-center rounded-lg transition ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}>\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                    <div className={`hidden md:block h-8 w-px mx-2 ${darkMode ? 'bg-slate-800' : 'bg-slate-200'}`}></div>\n                                                    <p className=\"text-xs text-slate-500 font-bold uppercase hidden md:block\">\n                                                        Subtotal: <span className={`text-lg ml-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>${(calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0) * (item.quantity || 0)).toLocaleString()}</span>\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n\n                                {/* Resumen y Checkout */}\n                                <div className={`border p-8 rounded-[2.5rem] h-fit sticky top-28 shadow-2xl transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`text-2xl font-black mb-8 border-b pb-4 transition-colors duration-300 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>Resumen de Compra</h3>\n\n                                    {/* Sección de Cupones */}\n                                    <div className=\"mb-8\">\n                                        <label className={`text-xs font-bold uppercase tracking-widest mb-3 block flex items-center gap-2 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                            <Tag className=\"w-4 h-4\" /> Cupón de Descuento\n                                        </label>\n                                        {appliedCoupon ? (\n                                            <div className=\"bg-purple-900/20 border border-purple-500/30 p-4 rounded-2xl flex justify-between items-center relative overflow-hidden group animate-fade-up\">\n                                                <div className=\"absolute inset-0 bg-purple-500/5 group-hover:bg-purple-500/10 transition\"></div>\n                                                <div className=\"relative z-10\">\n                                                    <p className=\"font-black text-purple-300 text-lg tracking-widest\">{appliedCoupon.code}</p>\n                                                    <p className=\"text-xs text-purple-400 font-bold\">\n                                                        {appliedCoupon.type === 'fixed' ? `$${appliedCoupon.value} OFF` : `${appliedCoupon.value}% OFF`}\n                                                    </p>\n                                                </div>\n                                                <button onClick={() => setAppliedCoupon(null)} className={`p-2 rounded-full transition relative z-10 border border-transparent hover:border-red-500/30 ${darkMode ? 'bg-slate-900/50 text-purple-300 hover:text-red-400 hover:bg-red-900/30' : 'bg-white text-purple-600 hover:text-red-600 hover:bg-red-50'}`}>\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                </button>\n                                            </div>\n                                        ) : (\n                                            <button onClick={() => setShowCouponModal(true)} className={`w-full py-4 border border-dashed rounded-2xl transition flex items-center justify-center gap-2 text-sm font-bold group ${darkMode ? 'border-slate-700 hover:border-purple-500 bg-slate-900/30 hover:bg-purple-900/10 text-slate-400 hover:text-purple-300' : 'border-slate-300 hover:border-purple-500 bg-slate-50 hover:bg-purple-50 text-slate-500 hover:text-purple-600'}`}>\n                                                <Ticket className=\"w-5 h-5 group-hover:rotate-12 transition\" /> Ver cupones disponibles\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Desglose de Precios */}\n                                    <div className={`space-y-4 border-b pb-8 mb-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                        <div className={`flex justify-between font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Subtotal</span>\n                                            <span className={`font-mono font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n                                        <div className={`flex justify-between text-sm font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Envío {checkoutData.shippingMethod === 'Delivery' ? '(A domicilio)' : '(Retiro)'}</span>\n                                            <span className=\"text-orange-500 font-bold flex items-center gap-1\">\n                                                <Truck className=\"w-3 h-3\" />\n                                                {shippingFee > 0 ? `$${shippingFee.toLocaleString()}` : (checkoutData.shippingMethod === 'Pickup' ? 'Gratis' : '¡Envío Gratis!')}\n                                            </span>\n                                        </div>\n                                        {appliedCoupon && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold text-sm animate-pulse bg-purple-900/10 p-2 rounded-lg\">\n                                                <span>Descuento aplicado</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Total Final */}\n                                    <div className=\"flex justify-between items-end mb-8\">\n                                        <span className={`font-bold text-lg ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total Final</span>\n                                        <span className={`text-4xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                            ${finalTotal.toLocaleString()}\n                                        </span>\n                                    </div>\n\n                                    {/* Botón Acción */}\n                                    <button onClick={() => setView('checkout')} className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-5 text-white font-bold text-lg rounded-2xl shadow-[0_0_25px_rgba(249,115,22,0.3)] hover:shadow-[0_0_35px_rgba(249,115,22,0.5)] transition-all flex items-center justify-center gap-3 transform hover:-translate-y-1\">\n                                        Iniciar Compra <ArrowRight className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                )}\n\n                {/* 3. VISTA DE CHECKOUT (FINALIZAR COMPRA) */}\n                {view === 'checkout' && (\n                    <div className=\"max-w-5xl mx-auto pb-20 animate-fade-up px-4 md:px-8\">\n                        <button onClick={() => setView('cart')} className=\"mb-8 mt-8 text-slate-400 hover:text-white flex items-center gap-2 font-bold transition\">\n                            <ArrowLeft className=\"w-5 h-5\" /> Volver al Carrito\n                        </button>\n\n                        <div className=\"grid md:grid-cols-5 gap-8\">\n                            {/* Columna Izquierda: Formularios */}\n                            <div className=\"md:col-span-3 space-y-8\">\n\n                                {/* Opciones de Entrega */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <Truck className=\"text-orange-500 w-6 h-6\" /> Método de Entrega\n                                    </h2>\n                                    <div className=\"grid grid-cols-2 gap-4 relative z-10 mb-6\">\n                                        {settings?.shippingPickup?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Pickup' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Pickup' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Pickup' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <MapPin className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Retiro en Local</span>\n                                            </button>\n                                        )}\n                                        {settings?.shippingDelivery?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Delivery' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Delivery' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Delivery' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <Truck className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Envío a Domicilio</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {checkoutData.shippingMethod === 'Pickup' && (\n                                        <div className=\"p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl animate-fade-up flex gap-3\">\n                                            <Info className=\"w-5 h-5 text-orange-400 shrink-0\" />\n                                            <p className=\"text-xs text-orange-200\">Retira tu pedido en: <span className=\"font-bold\">{settings?.shippingPickup?.address || 'Dirección a coordinar'}</span></p>\n                                        </div>\n                                    )}\n\n                                    {checkoutData.shippingMethod === 'Delivery' && (\n                                        <div className=\"space-y-5 relative z-10 animate-fade-up mt-4\">\n                                            <h3 className={`text-sm font-bold uppercase tracking-widest pl-2 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Datos de Destino</h3>\n                                            <div>\n                                                <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Dirección y Altura</label>\n                                                <input\n                                                    className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                    placeholder=\"Ej: Av. Santa Fe 1234\"\n                                                    value={checkoutData.address || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, address: e.target.value })}\n                                                />\n                                            </div>\n                                            <div className=\"grid grid-cols-2 gap-5\">\n                                                <div>\n                                                    <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Ciudad</label>\n                                                    <input\n                                                        className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                        placeholder=\"Ej: Rosario\"\n                                                        value={checkoutData.city || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, city: e.target.value })}\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Provincia</label>\n                                                    <input\n                                                        className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                        placeholder=\"Ej: Santa Fe\"\n                                                        value={checkoutData.province || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, province: e.target.value })}\n                                                    />\n                                                </div>\n                                            </div>\n                                            <div>\n                                                <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Código Postal</label>\n                                                <input\n                                                    className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                    placeholder=\"Ej: 2000\"\n                                                    value={checkoutData.zipCode || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, zipCode: e.target.value })}\n                                                />\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* Método de Pago */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <CreditCard className=\"text-orange-500 w-6 h-6\" /> Método de Pago\n                                    </h2>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10\">\n                                        {settings?.paymentMercadoPago?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Tarjeta' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Tarjeta' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Tarjeta' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <CreditCard className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Tarjeta</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentTransfer?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Transferencia' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Transferencia' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Transferencia' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <RefreshCw className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Transferencia</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentCash && checkoutData.shippingMethod !== 'Delivery' && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Efectivo' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Efectivo' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Efectivo' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <Banknote className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Efectivo</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Card Payment Brick Container - Solo para Tarjeta */}\n                                    {checkoutData.paymentChoice === 'Tarjeta' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/30\">\n                                                <h3 className=\"text-white font-bold mb-4 flex items-center gap-2\">\n                                                    <CreditCard className=\"w-5 h-5 text-orange-400\" />\n                                                    Ingresá los datos de tu tarjeta\n                                                </h3>\n                                                <p className=\"text-slate-400 text-sm mb-4\">\n                                                    Pagá de forma segura con Visa, MasterCard, AMEX y más.\n                                                </p>\n\n                                                {/* WARNING: AD BLOCKER */}\n                                                <div className=\"mb-6 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <AlertCircle className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        <strong className=\"text-orange-400 block mb-1\">ATENCIÓN:</strong>\n                                                        Si tenés activado un <span className=\"text-white font-bold\">AdBlocker/Bloqueador de Anuncios</span>, por favor desactivalo temporalmente.\n                                                        Es posible que el pago no se concrete si el bloqueador interfiere con la seguridad del banco.\n                                                    </p>\n                                                </div>\n\n                                                {/* Contenedor del Card Payment Brick de Mercado Pago */}\n                                                <div id=\"cardPaymentBrick_container\" ref={cardPaymentBrickRef} className=\"min-h-[400px]\"></div>\n\n                                                {/* Mensaje de error si hay */}\n                                                {paymentError && (\n                                                    <div className=\"mt-4 space-y-3\">\n                                                        <div className=\"p-4 bg-red-900/20 border border-red-500/30 rounded-xl text-red-400 text-sm flex items-center gap-3\">\n                                                            <AlertTriangle className=\"w-5 h-5 flex-shrink-0\" />\n                                                            {paymentError}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => {\n                                                                setPaymentError(null);\n                                                                initializeCardPaymentBrick();\n                                                            }}\n                                                            className=\"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2\"\n                                                        >\n                                                            <RefreshCw className=\"w-4 h-4\" />\n                                                            Reintentar Pago\n                                                        </button>\n                                                    </div>\n                                                )}\n\n                                                {/* Indicador de procesamiento */}\n                                                {isPaymentProcessing && (\n                                                    <div className=\"mt-4 p-4 bg-orange-900/20 border border-orange-500/30 rounded-xl text-orange-400 text-sm flex items-center gap-3\">\n                                                        <Loader2 className=\"w-5 h-5 animate-spin flex-shrink-0\" />\n                                                        Procesando tu pago, por favor esperá...\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    )}\n                                    {checkoutData.paymentChoice === 'Transferencia' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/20\">\n                                                <h3 className=\"text-white font-bold mb-3 flex items-center gap-2\">\n                                                    <Building className=\"w-5 h-5 text-orange-400\" />\n                                                    Datos para transferir\n                                                </h3>\n                                                <div className=\"space-y-2 text-sm\">\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Titular</span>\n                                                        <span className=\"text-white font-medium text-right break-all\">{settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Alias</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">CBU</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu) : 'Sin configurar'}</span>\n                                                    </div>\n                                                </div>\n                                                <div className=\"mt-4 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <Info className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        Una vez realizada la transferencia, confirmá el pedido. Si necesitás coordinar el comprobante, te contactamos por WhatsApp si está disponible.\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna Derecha: Confirmación */}\n                            <div className=\"md:col-span-2\">\n                                <div className={`border p-8 rounded-[2.5rem] sticky top-28 shadow-2xl ${darkMode ? 'bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`font-black mb-8 text-xl border-b pb-4 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-100'}`}>Resumen Final</h3>\n\n                                    <div className=\"space-y-4 mb-8\">\n                                        <div className={`flex justify-between ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                            <span>Productos ({cart.length})</span>\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n\n                                        {discountAmount > 0 && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold\">\n                                                <span>Descuento</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n\n                                        <div className={`h-px my-4 border-t border-dashed ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}></div>\n\n                                        <div className=\"flex justify-between items-end\">\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total a Pagar</span>\n                                            <span className={`text-3xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>${finalTotal.toLocaleString()}</span>\n                                        </div>\n                                    </div>\n\n                                    {/* Botón Confirmar - Solo para Efectivo o Transferencia (NO para Tarjeta) */}\n                                    {checkoutData.paymentChoice && checkoutData.paymentChoice !== 'Tarjeta' ? (\n                                        <>\n                                            <button\n                                                onClick={confirmOrder}\n                                                disabled={isProcessingOrder}\n                                                className={`w-full py-5 text-white font-bold text-lg rounded-2xl shadow-xl flex items-center justify-center gap-3 transition-all ${isProcessingOrder ? 'bg-slate-700 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500 shadow-green-900/20 hover:scale-[1.02]'}`}\n                                            >\n                                                {isProcessingOrder ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <CheckCircle className=\"w-6 h-6\" />}\n                                                {isProcessingOrder ? 'Procesando...' : 'Confirmar Pedido'}\n                                            </button>\n\n                                            <p className=\"text-center text-slate-600 text-xs mt-6 leading-relaxed px-4\">\n                                                Al confirmar, aceptas nuestros términos de servicio y política de privacidad.\n                                            </p>\n                                        </>\n                                    ) : checkoutData.paymentChoice === 'Tarjeta' ? (\n                                        <div className=\"bg-orange-900/10 border border-orange-500/20 p-4 rounded-2xl text-center\">\n                                            <p className=\"text-orange-400 text-sm font-medium flex items-center justify-center gap-2\">\n                                                <CreditCard className=\"w-4 h-4\" />\n                                                Completá los datos de tu tarjeta arriba para pagar\n                                            </p>\n                                            <p className=\"text-slate-500 text-xs mt-2\">\n                                                Tu compra quedará confirmada automáticamente al procesar el pago.\n                                            </p>\n                                        </div>\n                                    ) : null}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 4. VISTA DE PERFIL (HISTORIAL Y FAVORITOS) - Solo si el usuario tiene datos válidos */}\n                {view === 'profile' && currentUser && currentUser.id && currentUser.email && currentUser.name && (\n                    <div className=\"max-w-6xl mx-auto pt-8 animate-fade-up px-4 md:px-8 pb-20\">\n                        {/* Tarjeta de Usuario */}\n                        <div className={`p-8 md:p-12 rounded-[3rem] mb-12 flex flex-col md:flex-row items-center gap-8 relative overflow-hidden shadow-2xl border transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                            {/* Decoración Fondo */}\n                            <div className={`absolute top-0 right-0 w-96 h-96 rounded-full blur-[120px] pointer-events-none ${darkMode ? 'bg-orange-500/5' : 'bg-orange-500/10'}`}></div>\n                            <div className={`absolute bottom-0 left-0 w-64 h-64 rounded-full blur-[100px] pointer-events-none ${darkMode ? 'bg-blue-600/5' : 'bg-blue-600/10'}`}></div>\n\n                            {/* Avatar */}\n                            <div className={`w-28 h-28 rounded-[2rem] bg-gradient-to-br from-orange-500 to-blue-600 flex items-center justify-center text-5xl font-black text-white shadow-2xl z-10 transform rotate-3 border-4 ${darkMode ? 'border-[#0a0a0a]' : 'border-white'}`}>\n                                {currentUser.name.charAt(0)}\n                            </div>\n\n                            {/* Info */}\n                            <div className=\"text-center md:text-left z-10 flex-1\">\n                                <h2 className={`text-4xl md:text-5xl font-black mb-2 tracking-tight ${darkMode ? 'text-white' : 'text-slate-900'}`}>{currentUser.name}</h2>\n                                <p className={`flex items-center justify-center md:justify-start gap-2 font-medium mb-4 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                    <Mail className=\"w-4 h-4 text-orange-500\" /> {currentUser.email}\n                                </p>\n                                <div className=\"flex flex-wrap gap-4 justify-center md:justify-start\">\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <User className=\"w-3 h-3\" /> {currentUser.dni || 'Sin DNI'}\n                                    </span>\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <Phone className=\"w-3 h-3\" /> {currentUser.phone || 'Sin Teléfono'}\n                                    </span>\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <Shield className=\"w-3 h-3\" /> {getRole(currentUser.email).toUpperCase()}\n                                    </span>\n                                </div>\n                            </div>\n\n                            {/* Acciones */}\n                            <div className=\"flex flex-col gap-3 z-10 w-full md:w-auto\">\n                                {hasAccess(currentUser.email) && (\n                                    <button onClick={() => setView('admin')} className={`px-6 py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2 shadow-lg border ${darkMode ? 'bg-slate-900 border-orange-500/30 text-orange-400 hover:bg-orange-900/20 hover:shadow-orange-500/10' : 'bg-orange-50 border-orange-200 text-orange-600 hover:bg-orange-100'}`}>\n                                        <Shield className=\"w-5 h-5\" /> Panel Admin\n                                    </button>\n                                )}\n                                <button onClick={() => { localStorage.removeItem('sustore_user_data'); setCurrentUser(null); setView('store') }} className={`px-6 py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2 border ${darkMode ? 'bg-red-900/10 border-red-500/20 text-red-500 hover:bg-red-900/20 hover:border-red-500/40' : 'bg-red-50 border-red-100 text-red-600 hover:bg-red-100'}`}>\n                                    <LogOut className=\"w-5 h-5\" /> Cerrar Sesión\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* SECCIÓN: MIS CUPONES (NUEVO) */}\n                        <div className={`p-8 rounded-[2.5rem] mb-12 shadow-2xl animate-fade-up border transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                            <h3 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                <Ticket className=\"text-purple-400 w-6 h-6\" /> Mis Cupones Disponibles\n                            </h3>\n\n                            <div className=\"grid md:grid-cols-2 gap-8\">\n                                <div className=\"space-y-4\">\n                                    {/* Mostrar cupones GLOBALES (targetType='global') y ESPECIFICOS para este usuario */}\n                                    {(() => {\n                                        const myCoupons = coupons.filter(c =>\n                                            (c.targetType === 'global') ||\n                                            (c.targetType === 'specific_email' && c.targetUser === currentUser.email)\n                                        );\n\n                                        if (myCoupons.length === 0) return <p className={`${darkMode ? 'text-slate-500' : 'text-slate-400'} italic`}>No tienes cupones disponibles en este momento.</p>;\n\n                                        return myCoupons.map(c => (\n                                            <div key={c.id} className={`p-4 rounded-xl flex items-center justify-between group transition border ${darkMode ? 'bg-slate-900/50 border-slate-800 hover:border-purple-500/30' : 'bg-slate-50 border-slate-100 hover:border-purple-300 hover:bg-white'}`}>\n                                                <div>\n                                                    <p className={`font-black text-lg tracking-widest ${darkMode ? 'text-white' : 'text-slate-900'}`}>{c.code}</p>\n                                                    <p className={`text-sm font-bold ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                                        {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                    </p>\n                                                    {c.expirationDate && <p className={`text-[10px] mt-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Vence: {c.expirationDate}</p>}\n                                                </div>\n                                                <button\n                                                    onClick={() => {\n                                                        navigator.clipboard.writeText(c.code);\n                                                        showToast(\"Código copiado\", \"success\");\n                                                    }}\n                                                    className={`px-4 py-2 rounded-lg text-xs font-bold transition border ${darkMode ? 'bg-purple-900/20 text-purple-400 border-purple-500/20 hover:bg-purple-500 hover:text-white' : 'bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-600 hover:text-white'}`}\n                                                >\n                                                    COPIAR\n                                                </button>\n                                            </div>\n                                        ));\n                                    })()}\n                                </div>\n\n                                <div className={`p-6 rounded-2xl border ${darkMode ? 'bg-slate-900/30 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                                    <h4 className={`font-bold mb-4 text-sm uppercase tracking-wider ${darkMode ? 'text-white' : 'text-slate-900'}`}>Canjear Código</h4>\n                                    <div className=\"flex gap-2\">\n                                        <input\n                                            className={`flex-1 rounded-xl p-3 outline-none uppercase font-mono border ${darkMode ? 'bg-slate-950 border-slate-800 text-white focus:border-purple-500' : 'bg-white border-slate-200 text-slate-900 focus:border-purple-400'}`}\n                                            placeholder=\"CÓDIGO\"\n                                            id=\"couponRedeemInput\"\n                                        />\n                                        <button\n                                            onClick={() => {\n                                                const input = document.getElementById('couponRedeemInput');\n                                                const code = String(input?.value || '').trim().toUpperCase();\n                                                if (!code) return showToast(\"Ingresa un código\", \"warning\");\n                                                const coupon = coupons.find(c => c.code === code);\n                                                if (coupon) {\n                                                    showToast(\"¡Cupón válido! Úsalo en el checkout.\", \"success\");\n                                                } else {\n                                                    showToast(\"Cupón no encontrado o inválido\", \"error\");\n                                                }\n                                            }}\n                                            className=\"bg-purple-600 px-6 rounded-xl text-white font-bold hover:bg-purple-500 transition shadow-lg\"\n                                        >\n                                            Validar\n                                        </button>\n                                    </div>\n                                    <p className={`text-xs mt-3 leading-relaxed ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                        Ingresa el código aquí para verificar si es válido. Llévalo al checkout para aplicar el descuento.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"grid lg:grid-cols-2 gap-10\">\n                            {/* Columna Izquierda: Historial de Pedidos */}\n                            <div className=\"space-y-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className={`text-2xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <ShoppingBag className=\"text-orange-400 w-6 h-6\" /> Tus Compras\n                                    </h3>\n                                </div>\n\n                                {(() => {\n                                    const completedOrders = orders.filter(o => o.userId === currentUser.id && o.status === 'Realizado');\n                                    // Flatten all items from completed orders\n                                    const purchasedItems = completedOrders.flatMap(o => o.items.map(item => ({ ...item, date: o.date })));\n\n                                    if (purchasedItems.length === 0) {\n                                        return (\n                                            <div className={`p-12 border-2 border-dashed rounded-[2rem] text-center bg-slate-900/20 ${darkMode ? 'border-slate-800 text-slate-500' : 'border-slate-200 text-slate-400 bg-slate-50'}`}>\n                                                <ShoppingBag className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                                <p className=\"font-bold\">Aún no tienes compras finalizadas.</p>\n                                                <button onClick={() => setView('store')} className=\"mt-4 text-orange-400 hover:underline text-sm font-bold\">Ir a la tienda</button>\n                                            </div>\n                                        );\n                                    }\n\n                                    return (\n                                        <div className=\"grid grid-cols-1 gap-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                            {purchasedItems.sort((a, b) => new Date(b.date) - new Date(a.date)).map((item, idx) => (\n                                                <div key={idx} className={`p-4 rounded-2xl flex items-center gap-4 group transition duration-300 border ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-orange-500/50' : 'bg-white border-slate-200 hover:border-orange-400 hover:shadow-md'}`}>\n                                                    <div className={`w-16 h-16 rounded-xl p-1 flex-shrink-0 ${darkMode ? 'bg-white' : 'bg-slate-50 border border-slate-100'}`}>\n                                                        <img src={item.image} className=\"w-full h-full object-contain\" alt={item.title} />\n                                                    </div>\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <h4 className={`font-bold text-sm truncate transition group-hover:text-orange-500 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.title}</h4>\n                                                        <p className={`text-xs font-mono mt-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>{new Date(item.date).toLocaleDateString()}</p>\n                                                    </div>\n                                                    <div className=\"text-right flex flex-col items-end gap-1\">\n                                                        <p className={`font-black ${darkMode ? 'text-white' : 'text-slate-900'}`}>${item.unit_price.toLocaleString()}</p>\n                                                        {item.quantity > 1 && (\n                                                            <span className={`text-[10px] font-bold ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>x{item.quantity} und.</span>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })()}\n                            </div>\n\n                            {/* Columna Derecha: Favoritos */}\n                            <div className=\"space-y-6\">\n\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className={`text-2xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <Heart className=\"text-red-500 w-6 h-6 fill-current\" /> Mis Favoritos\n                                    </h3>\n                                    <span className={`text-xs font-bold px-3 py-1 rounded-full ${darkMode ? 'text-slate-500 bg-slate-900' : 'text-slate-600 bg-slate-100'}`}>\n                                        {currentUser.favorites?.length || 0} Guardados\n                                    </span>\n                                </div>\n\n                                {!currentUser.favorites || currentUser.favorites.length === 0 ? (\n                                    <div className={`p-12 border-2 border-dashed rounded-[2rem] text-center bg-slate-900/20 ${darkMode ? 'border-slate-800 text-slate-500' : 'border-slate-200 text-slate-400 bg-slate-50'}`}>\n                                        <Heart className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                        <p className=\"font-bold\">Tu lista de deseos está vacía.</p>\n                                        <p className=\"text-xs mt-2 max-w-xs mx-auto\">Guarda productos haciendo click en el corazón de las tarjetas.</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                        {currentUser.favorites.map(fid => {\n                                            const p = products.find(prod => prod.id === fid);\n                                            if (!p) return null;\n                                            return (\n                                                <div key={fid} className={`p-4 rounded-2xl flex items-center gap-4 relative group transition border ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-slate-600' : 'bg-white border-slate-200 hover:border-orange-400 hover:shadow-md'}`}>\n                                                    <div className={`w-16 h-16 rounded-xl p-1 flex-shrink-0 ${darkMode ? 'bg-white' : 'bg-slate-50 border border-slate-100'}`}>\n                                                        <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                    </div>\n\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <p className={`font-bold line-clamp-1 transition group-hover:text-orange-500 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{p.name}</p>\n                                                        <p className=\"text-orange-500 font-bold text-sm mt-1\">${p.basePrice.toLocaleString()}</p>\n                                                    </div>\n\n                                                    <div className=\"flex gap-2\">\n                                                        <button\n                                                            onClick={() => toggleFavorite(p)}\n                                                            className={`p-3 rounded-xl transition border ${darkMode ? 'bg-slate-900 text-red-400 border-slate-800 hover:bg-red-900/20 hover:border-red-500/30' : 'bg-red-50 text-red-500 border-red-100 hover:bg-red-100'}`}\n                                                            title=\"Eliminar de favoritos\"\n                                                        >\n                                                            <Trash2 className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => manageCart(p, 1)}\n                                                            className={`p-3 rounded-xl transition border ${darkMode ? 'bg-slate-900 text-orange-400 border-slate-800 hover:bg-orange-900/20 hover:border-orange-500/30' : 'bg-orange-50 text-orange-600 border-orange-100 hover:bg-orange-100'}`}\n                                                            title=\"Agregar al carrito\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Fallback: Si intenta acceder a profile sin usuario válido, mostrar login */}\n                {view === 'profile' && (!currentUser || !currentUser.id || !currentUser.email || !currentUser.name) && (\n                    <div className=\"max-w-md mx-auto pt-20 animate-fade-up px-4 text-center\">\n                        <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] shadow-2xl\">\n                            <User className=\"w-16 h-16 mx-auto mb-6 text-orange-500 opacity-50\" />\n                            <h2 className=\"text-2xl font-black text-white mb-4\">Inicia Sesión</h2>\n                            <p className=\"text-slate-400 mb-8\">Debes iniciar sesión o registrarte para acceder a tu perfil.</p>\n                            <button\n                                onClick={() => setView('login')}\n                                className=\"w-full py-4 bg-gradient-to-r from-orange-500 to-blue-600 text-white rounded-2xl font-black hover:from-orange-400 hover:to-blue-500 transition shadow-lg\"\n                            >\n                                INICIAR SESIÓN\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 5. MODAL DE AUTENTICACIÓN (LOGIN/REGISTER) */}\n                {(view === 'login' || view === 'register') && (\n                    <div className=\"fixed inset-0 z-[20002] flex items-center justify-center bg-[#050505]/95 p-4 animate-fade-up backdrop-blur-xl\">\n\n                        <div className=\"bg-[#0a0a0a] p-8 md:p-12 rounded-[3rem] w-full max-w-md shadow-2xl border border-slate-800 relative overflow-hidden\">\n                            {/* Botón Cerrar (Dentro de la tarjeta) */}\n                            <button onClick={() => setView('store')} className=\"absolute top-6 right-6 p-2 bg-slate-900/50 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition z-20\">\n                                <X className=\"w-6 h-6\" />\n                            </button>\n\n                            <div className=\"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 via-orange-600 to-red-600\"></div>\n\n                            <h2 className=\"text-4xl font-black text-white mb-2 text-center tracking-tight\">\n                                {loginMode ? 'Bienvenido' : 'Crear Cuenta'}\n                            </h2>\n                            <p className=\"text-slate-500 text-center mb-8 text-sm\">\n                                {loginMode ? 'Ingresa a tu cuenta para continuar.' : 'Únete a nosotros hoy mismo.'}\n                            </p>\n\n                            <form onSubmit={(e) => { e.preventDefault(); handleAuth(!loginMode) }} className=\"space-y-4\">\n                                {!loginMode && (\n                                    <div className=\"space-y-4 animate-fade-up\">\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre Completo *\" value={authData.name} onChange={e => setAuthData({ ...authData, name: e.target.value })} required />\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de Usuario *\" value={authData.username} onChange={e => setAuthData({ ...authData, username: e.target.value })} required />\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <input className=\"input-cyber p-4\" placeholder=\"DNI *\" value={authData.dni} onChange={e => setAuthData({ ...authData, dni: e.target.value })} required />\n                                            <input className=\"input-cyber p-4\" placeholder=\"Teléfono *\" value={authData.phone} onChange={e => setAuthData({ ...authData, phone: e.target.value })} required />\n                                        </div>\n                                    </div>\n                                )}\n\n                                <div className=\"space-y-4\">\n                                    <input className=\"input-cyber w-full p-4\" placeholder={loginMode ? \"Email o Usuario\" : \"Email *\"} value={authData.email} onChange={e => setAuthData({ ...authData, email: e.target.value })} required />\n                                    <input className=\"input-cyber w-full p-4\" type=\"password\" placeholder={loginMode ? \"Contraseña\" : \"Contraseña *\"} value={authData.password} onChange={e => setAuthData({ ...authData, password: e.target.value })} required />\n                                </div>\n\n                                <button type=\"submit\" className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-4 text-white rounded-xl font-bold mt-6 transition transform hover:-translate-y-1 shadow-lg flex items-center justify-center gap-2\">\n                                    {isLoading ? <Loader2 className=\"animate-spin w-5 h-5\" /> : (loginMode ? 'INGRESAR' : 'REGISTRARSE')}\n                                </button>\n                            </form>\n\n                            <button onClick={() => setLoginMode(!loginMode)} className=\"w-full text-center text-slate-500 text-sm mt-8 font-bold hover:text-orange-400 transition border-t border-slate-800 pt-6\">\n                                {loginMode ? '¿No tienes cuenta? Regístrate gratis' : '¿Ya tienes cuenta? Inicia sesión'}\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 6. VISTAS ESTÁTICAS (ABOUT & GUIDE) */}\n                {view === 'about' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Info className=\"text-orange-500 w-12 h-12\" /> Sobre Nosotros\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] text-xl leading-relaxed whitespace-pre-wrap shadow-2xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"absolute top-0 right-0 w-64 h-64 bg-purple-500/10 rounded-full blur-[100px] pointer-events-none\"></div>\n                            <p className=\"relative z-10\">{settings.aboutUsText}</p>\n\n                            <div className={`mt-12 pt-12 border-t flex flex-col md:flex-row gap-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Shield className=\"text-orange-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Garantía Oficial</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Productos de calidad</p></div>\n                                </div>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Truck className=\"text-purple-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Envíos Seguros</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>A todo el país</p></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {view === 'guide' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <FileQuestion className=\"text-orange-500 w-12 h-12\" /> {settings?.guideTitle || 'Cómo Comprar'}\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            {[\n                                { title: settings?.guideStep1Title || \"Selecciona Productos\", text: settings?.guideStep1Text || \"Navega por nuestro catálogo y añade lo que te guste al carrito con el botón '+'.\" },\n                                { title: settings?.guideStep2Title || \"Revisa tu Carrito\", text: settings?.guideStep2Text || \"Verifica las cantidades. Si tienes un cupón de descuento, ¡es el momento de usarlo!\" },\n                                { title: settings?.guideStep3Title || \"Datos de Envío\", text: settings?.guideStep3Text || \"Completa la información de entrega. Hacemos envíos a todo el país.\" },\n                                { title: settings?.guideStep4Title || \"Pago y Confirmación\", text: settings?.guideStep4Text || \"Elige tu método de pago preferido. Si es transferencia, recibirás los datos por email.\" },\n                                { title: settings?.guideStep5Title || \"¡Listo!\", text: settings?.guideStep5Text || \"Recibirás un correo con el seguimiento de tu pedido. ¡Disfruta tu compra!\" }\n                            ].filter((step, idx) => {\n                                // Filtrar pasos que están desactivados\n                                if (idx === 0 && settings?.showGuideStep1 === false) return false;\n                                if (idx === 1 && settings?.showGuideStep2 === false) return false;\n                                if (idx === 2 && settings?.showGuideStep3 === false) return false;\n                                if (idx === 3 && settings?.showGuideStep4 === false) return false;\n                                if (idx === 4 && settings?.showGuideStep5 === false) return false;\n                                return true;\n                            }).map((step, idx) => (\n                                <div key={idx} className=\"flex gap-6 items-start\">\n                                    <div className={`w-10 h-10 rounded-full font-black flex items-center justify-center border flex-shrink-0 mt-1 ${darkMode ? 'bg-orange-900/20 text-orange-400 border-orange-500/20' : 'bg-orange-100 text-orange-600 border-orange-200'}`}>\n                                        {idx + 1}\n                                    </div>\n                                    <div>\n                                        <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{step.title}</h3>\n                                        <p className={`leading-relaxed ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{step.text}</p>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {view === 'privacy' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Shield className=\"text-orange-500 w-12 h-12\" /> Política de Privacidad\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"prose prose-invert max-w-none\">\n                                <p className={`text-sm mb-8 italic ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Última actualización: 07 de enero de 2026</p>\n\n                                <p>Este Aviso de Privacidad para <strong>{settings?.storeName || 'Sustore'}</strong> (\"nosotros\", \"nos\" o \"nuestro\"), describe cómo y por qué podríamos acceder, recopilar, almacenar, usar y/o compartir (\"proceso\") su información personal cuando utiliza nuestros servicios (\"Servicios\"), incluso cuando:</p>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Visita nuestro sitio web en <a href=\"https://sustore.vercel.app\" className=\"text-orange-500 hover:underline\">https://sustore.vercel.app</a> o cualquier sitio web nuestro que enlace a este Aviso de Privacidad.</li>\n                                    <li>Interactúe con nosotros de otras maneras relacionadas, incluido cualquier marketing o evento.</li>\n                                </ul>\n\n                                <div className={`p-6 rounded-2xl border my-8 ${darkMode ? 'bg-slate-900/50 border-slate-800 text-slate-300' : 'bg-slate-50 border-slate-200 text-slate-700'}`}>\n                                    <h3 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-slate-900'}`}>RESUMEN DE PUNTOS CLAVE</h3>\n                                    <ul className=\"space-y-4 text-sm\">\n                                        <li><strong>¿Qué información personal procesamos?</strong> Información proporcionada al registrarse o comprar.</li>\n                                        <li><strong>¿Procesamos información confidencial?</strong> No.</li>\n                                        <li><strong>¿Recopilamos información de terceros?</strong> No.</li>\n                                        <li><strong>¿Cómo procesamos su información?</strong> Para gestionar pedidos, seguridad y mejora del servicio.</li>\n                                        <li><strong>¿Compartimos información?</strong> Solo en situaciones específicas como transferencias comerciales o requisitos legales.</li>\n                                    </ul>\n                                </div>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>1. ¿QUÉ INFORMACIÓN RECOPILAMOS?</h3>\n                                <p>Recopilamos información que usted nos proporciona voluntariamente: nombres, teléfonos, emails, direcciones, nombres de usuario y contraseñas.</p>\n                                <p>También recopilamos datos técnicos automáticamente (IP, tipo de navegador) para seguridad y análisis del sitio.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>2. ¿CÓMO PROCESAMOS TU INFORMACIÓN?</h3>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Facilitar creación y administración de cuentas.</li>\n                                    <li>Gestionar pedidos, pagos y envíos.</li>\n                                    <li>Proteger nuestros servicios contra fraude.</li>\n                                    <li>Evaluar y mejorar la experiencia del usuario.</li>\n                                </ul>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>3. ¿CUÁNTO TIEMPO CONSERVAMOS TU INFORMACIÓN?</h3>\n                                <p>Conservamos su información mientras tenga una cuenta activa con nosotros o según lo exija la ley para fines contables o legales.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>4. ¿CUÁLES SON SUS DERECHOS?</h3>\n                                <p>Puede revisar, cambiar o cancelar su cuenta en cualquier momento desde su perfil o contactándonos directamente.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>5. CONTACTO</h3>\n                                <p>Para preguntas sobre este aviso, puede escribirnos a:</p>\n                                <div className={`p-6 rounded-xl border font-mono text-sm leading-relaxed ${darkMode ? 'bg-slate-950 border-slate-800' : 'bg-white border-slate-200 shadow-sm'}`}>\n                                    <strong>{settings?.storeName || 'Sustore'}</strong><br />\n                                    Saavedra 7568<br />\n                                    Santa Fe, 3000<br />\n                                    Argentina<br />\n                                    <a href={`https://mail.google.com/mail/?view=cm&fs=1&to=${settings?.sellerEmail}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-orange-500 hover:underline\">{settings?.sellerEmail || '[Email de contacto]'}</a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 7. PANEL DE ADMINISTRACIÓN (COMPLETO Y DETALLADO) */}\n                {view === 'admin' && (\n                    // === Verificación de carga antes de verificar acceso ===\n                    // Si los settings no están cargados o el rol está indeterminado, mostrar loading\n                    (!settingsLoaded || isRoleLoading(currentUser?.email)) ? (\n                        <div className=\"min-h-screen bg-[#050505] flex items-center justify-center\">\n                            <div className=\"text-center\">\n                                <div className=\"relative\">\n                                    <div className=\"w-16 h-16 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: '#f97316' }}></div>\n                                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                                        <Shield className=\"w-6 h-6 text-orange-500 animate-pulse\" />\n                                    </div>\n                                </div>\n                                <p className=\"text-slate-500 text-xs mt-4 font-mono uppercase tracking-widest\">Verificando permisos...</p>\n                            </div>\n                        </div>\n                    ) :\n                        // === SEGURIDAD: Triple verificación de acceso ===\n                        // 1. Verificar que tiene permisos por rol\n                        // 2. Verificar que el usuario tiene un ID válido\n                        // 3. Verificar que la sesión no fue manipulada\n                        (hasAccess(currentUser?.email) &&\n                            currentUser?.id &&\n                            currentUser?.id.length >= 10 &&\n                            !SecurityManager.detectManipulation()) ? (\n                            <div className=\"flex min-h-screen min-full-viewport bg-[#050505] overflow-hidden animate-fade-up relative w-full font-sans\">\n\n                                {/* Overlay para cerrar el menú en móvil */}\n                                {isAdminMenuOpen && (\n                                    <div\n                                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-30 md:hidden animate-fade-in\"\n                                        onClick={() => setIsAdminMenuOpen(false)}\n                                    />\n                                )}\n\n                                {/* 7.1 Sidebar Admin */}\n                                <div className={`fixed inset-y-0 left-0 z-40 w-[280px] bg-[#0a0a0a] border-r border-slate-800 flex flex-col transition-transform duration-300 ease-out ${isAdminMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'} md:static md:w-72 shadow-2xl`}>\n                                    <div className=\"p-6 md:p-8 border-b border-slate-900 flex items-center justify-between\">\n                                        <div>\n                                            <h2 className=\"text-xl md:text-2xl font-black text-white tracking-tight flex items-center gap-3\">\n                                                <div className=\"w-9 h-9 md:w-10 md:h-10 bg-orange-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-orange-900/20\">\n                                                    <Shield className=\"w-5 h-5 md:w-6 md:h-6\" />\n                                                </div>\n                                                ADMIN\n                                            </h2>\n                                            <p className=\"text-[10px] md:text-xs text-slate-500 mt-1.5 font-mono ml-1\">v3.0.0 PRO</p>\n                                        </div>\n                                        {/* Botón cerrar en móvil */}\n                                        <button\n                                            onClick={() => setIsAdminMenuOpen(false)}\n                                            className=\"md:hidden p-2 bg-slate-900 hover:bg-slate-800 rounded-xl text-slate-400 hover:text-white transition border border-slate-800\"\n                                        >\n                                            <X className=\"w-5 h-5\" />\n                                        </button>\n                                    </div>\n\n                                    <nav className=\"flex-1 p-3 md:p-4 space-y-1.5 md:space-y-2 overflow-y-auto custom-scrollbar\">\n                                        <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-1\">Principal</p>\n\n                                        <button onClick={() => { setAdminTab('dashboard'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'dashboard' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <LayoutDashboard className=\"w-5 h-5\" /> Inicio\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('orders'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'orders' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <ShoppingBag className=\"w-5 h-5\" /> Pedidos\n                                            {isAdminUser && hasUnseenOrders && (\n                                                <span className=\"ml-auto text-[10px] px-2 py-1 rounded-full bg-red-900/30 text-red-300 border border-red-500/30 font-black uppercase tracking-widest\">\n                                                    Nuevo\n                                                </span>\n                                            )}\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('products'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'products' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <Package className=\"w-5 h-5\" /> Productos\n                                        </button>\n\n                                        {/* Promos - Available for editors and admins */}\n                                        {(isAdmin(currentUser?.email) || isEditor(currentUser?.email)) && (\n                                            <button onClick={() => { setAdminTab('promos'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'promos' ? 'bg-purple-900/20 text-purple-400 border border-purple-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                <Tag className=\"w-5 h-5\" /> Promos\n                                            </button>\n                                        )}\n\n                                        {isAdmin(currentUser?.email) && (\n                                            <>\n                                                <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-4 md:mt-6\">Gestión</p>\n\n                                                <button onClick={() => { setAdminTab('coupons'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'coupons' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Ticket className=\"w-5 h-5\" /> Cupones\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('suppliers'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'suppliers' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Truck className=\"w-5 h-5\" /> Proveedores\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('purchases'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'purchases' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <ShoppingCart className=\"w-5 h-5\" /> Compras\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('finance'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'finance' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Wallet className=\"w-5 h-5\" /> Finanzas\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('settings'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'settings' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Settings className=\"w-5 h-5\" /> Configuración\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('users'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'users' ? 'bg-pink-900/20 text-pink-400 border border-pink-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Users className=\"w-5 h-5\" /> Usuarios\n                                                </button>\n                                            </>\n                                        )}\n                                    </nav>\n\n                                    <div className=\"p-4 md:p-6 border-t border-slate-900\">\n                                        <button onClick={() => { setView('store'); setIsAdminMenuOpen(false); }} className=\"w-full py-3.5 md:py-4 bg-slate-900 rounded-xl text-slate-400 hover:text-white hover:bg-slate-800 transition font-bold text-sm flex items-center justify-center gap-2 group border border-slate-800\">\n                                            <LogOut className=\"w-4 h-4 group-hover:-translate-x-1 transition\" /> Volver a Tienda\n                                        </button>\n                                    </div>\n                                </div>\n\n                                {/* 7.2 Contenido Principal Admin */}\n                                <div className=\"flex-1 bg-[#050505] overflow-y-auto relative w-full p-4 md:p-10 custom-scrollbar\">\n                                    <button onClick={() => setIsAdminMenuOpen(true)} className=\"md:hidden mb-4 p-3 bg-slate-900 hover:bg-slate-800 rounded-xl text-white border border-slate-800 flex items-center gap-2 font-bold text-sm transition\">\n                                        <Menu className=\"w-5 h-5\" /> Menú\n                                    </button>\n\n                                    {/* TAB: DASHBOARD */}\n                                    {adminTab === 'dashboard' && (\n                                        <div className=\"max-w-[1600px] mx-auto animate-fade-up space-y-8 pb-20\">\n                                            <ManualSaleModal />\n                                            <MetricsDetailModal />\n                                            {/* Modales Admin Users */}\n\n\n                                            <div className=\"flex flex-col md:flex-row justify-between items-end mb-4 gap-4\">\n                                                <div>\n                                                    <h1 className=\"text-4xl font-black text-white neon-text\">Panel de Control</h1>\n                                                    <p className=\"text-slate-500 mt-2\">Resumen administrativo y financiero.</p>\n                                                </div>\n                                                <div className=\"flex items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"dashboard\" />\n                                                    <div className=\"hidden md:block bg-slate-900 px-4 py-2 rounded-lg text-xs text-slate-400 font-mono border border-slate-800\">\n                                                        {new Date().toLocaleDateString('es-AR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCIÓN 1: ANALÍTICA FINANCIERA (Lista Gráfica) */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                {/* INGRESOS BRUTOS */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-green-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Ingresos Brutos</p>\n                                                            <h2 className=\"text-4xl font-black text-white tracking-tighter\">${dashboardMetrics.revenue.toLocaleString()}</h2>\n                                                        </div>\n                                                        <div className=\"p-4 bg-green-900/20 text-green-400 rounded-2xl\">\n                                                            <DollarSign className=\"w-8 h-8\" />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gráfica (Ultimos 6 meses) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Rendimiento Mensual</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            const maxRev = Math.max(...dashboardMetrics.analytics.monthly.map(x => x.revenue));\n                                                            const percentage = maxRev > 0 ? (m.revenue / maxRev) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-white font-bold\">${m.revenue.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div\n                                                                            className=\"h-full bg-gradient-to-r from-green-600 to-emerald-400 rounded-full transition-all duration-1000 group-hover/item:brightness-125\"\n                                                                            style={{ width: `${percentage}%` }}\n                                                                        ></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n\n                                                {/* BENEFICIO NETO */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-orange-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Beneficio Neto (Estimado)</p>\n                                                            <h2 className={`text-4xl font-black tracking-tighter ${dashboardMetrics.netIncome >= 0 ? 'text-orange-400' : 'text-red-500'}`}>\n                                                                ${dashboardMetrics.netIncome.toLocaleString()}\n                                                            </h2>\n                                                        </div>\n                                                        <div className={`p-4 rounded-2xl ${dashboardMetrics.netIncome >= 0 ? 'bg-orange-900/20 text-orange-400' : 'bg-red-900/20 text-red-500'}`}>\n                                                            {dashboardMetrics.netIncome >= 0 ? <TrendingUp className=\"w-8 h-8\" /> : <TrendingDown className=\"w-8 h-8\" />}\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gráfica (Comparativa Ingreso vs Gasto) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Ingresos vs Gastos (Últimos Meses)</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            // Estimación simplificada de gastos mensuales (proporcional solo para visualización si no hay data exacta mensual de gastos guardada historica)\n                                                            // En una real app, se calcularía real desde expenses.\n                                                            // Como `expenses` tiene fecha, podemos calcularlo.\n                                                            const monthExpenses = expenses.filter(e => e.date.startsWith(m.date)).reduce((acc, c) => acc + c.amount, 0)\n                                                                + (purchases || []).filter(p => p.date.startsWith(m.date)).reduce((acc, c) => acc + c.cost, 0);\n\n                                                            const totalVol = m.revenue + monthExpenses;\n                                                            const revPct = totalVol > 0 ? (m.revenue / totalVol) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-orange-400 font-bold\">+${(m.revenue - monthExpenses).toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div title={`Ingresos: $${m.revenue}`} className=\"h-full bg-orange-500 transition-all duration-1000\" style={{ width: `${revPct}%` }}></div>\n                                                                        <div title={`Gastos: $${monthExpenses}`} className=\"h-full bg-red-500 transition-all duration-1000\" style={{ width: `${100 - revPct}%` }}></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCIÓN 2: KPIs RÁPIDOS */}\n                                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Usuarios Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalUsers}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Pedidos Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalOrders}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Ticket Promedio</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">\n                                                        ${dashboardMetrics.totalOrders > 0 ? Math.round(dashboardMetrics.revenue / dashboardMetrics.totalOrders).toLocaleString() : 0}\n                                                    </p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Stock Bajo</p>\n                                                    <p className={`font-black text-2xl text-center mt-1 ${dashboardMetrics.lowStockProducts.length > 0 ? 'text-red-500' : 'text-green-500'}`}>\n                                                        {dashboardMetrics.lowStockProducts.length}\n                                                    </p>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCIÓN 2.5: MEJORES Y PEORES (NUEVO) */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                {/* BEST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-yellow-500/30 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <Star className=\"w-32 h-32 text-yellow-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <Star className=\"w-4 h-4 text-yellow-500\" /> Producto Estrella\n                                                    </p>\n                                                    {dashboardMetrics.starProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg flex-shrink-0\">\n                                                                <img src={dashboardMetrics.starProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.starProduct.name}</h3>\n                                                                <p className=\"text-yellow-400 font-bold text-lg\">{dashboardMetrics.starProduct.sales} Und. vendidas</p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Stock actual: {dashboardMetrics.starProduct.stock}</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">No hay datos de ventas aún.</p>\n                                                    )}\n                                                </div>\n\n                                                {/* WORST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-slate-600 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <AlertCircle className=\"w-32 h-32 text-slate-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <TrendingDown className=\"w-4 h-4 text-slate-500\" /> Menos Vendido (En Stock)\n                                                    </p>\n                                                    {dashboardMetrics.leastSoldProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg grayscale flex-shrink-0\">\n                                                                <img src={dashboardMetrics.leastSoldProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.leastSoldProduct.name}</h3>\n                                                                <p className=\"text-slate-400 font-bold text-lg\">\n                                                                    {dashboardMetrics.salesCount[dashboardMetrics.leastSoldProduct.id] || 0} Und. vendidas\n                                                                </p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Hay que rotar este stock.</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">Todos los productos tienen buena rotación.</p>\n                                                    )}\n                                                </div>\n                                            </div>\n\n                                            {/* SECCIÓN 3: LIBRO MAYOR (REGISTRO ADMINISTRATIVO) */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 overflow-hidden shadow-2xl\">\n                                                <h3 className=\"text-xl font-black text-white mb-6 flex items-center gap-2\">\n                                                    <FileText className=\"w-6 h-6 text-purple-400\" /> Registro de Movimientos\n                                                </h3>\n\n                                                <div className=\"overflow-x-auto\">\n                                                    <table className=\"w-full text-left border-collapse\">\n                                                        <thead>\n                                                            <tr className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-slate-800\">\n                                                                <th className=\"pb-4 pl-4\">Fecha</th>\n                                                                <th className=\"pb-4\">Tipo</th>\n                                                                <th className=\"pb-4\">Concepto</th>\n                                                                <th className=\"pb-4\">Estado</th>\n                                                                <th className=\"pb-4 text-right pr-4\">Monto</th>\n                                                            </tr>\n                                                        </thead>\n                                                        <tbody className=\"text-sm font-medium\">\n                                                            {dashboardMetrics.transactions.map((t, idx) => (\n                                                                <tr key={`${t.type}-${idx}`} className=\"border-b border-slate-800/50 hover:bg-slate-900/20 transition group\">\n                                                                    <td className=\"py-4 pl-4 text-slate-400 font-mono text-xs\">{new Date(t.date).toLocaleDateString()}</td>\n                                                                    <td className=\"py-4\">\n                                                                        <span className={`px-2 py-1 rounded text-[10px] font-black uppercase tracking-wider ${t.type === 'income' ? 'bg-green-900/20 text-green-400 border border-green-500/20' : 'bg-red-900/20 text-red-400 border border-red-500/20'\n                                                                            }`}>\n                                                                            {t.category}\n                                                                        </span>\n                                                                    </td>\n                                                                    <td className=\"py-4 text-white group-hover:text-purple-300 transition\">\n                                                                        {t.description}\n                                                                    </td>\n                                                                    <td className=\"py-4 text-xs text-slate-500\">\n                                                                        {t.status}\n                                                                    </td>\n                                                                    <td className={`py-4 text-right pr-4 font-mono font-bold ${t.type === 'income' ? 'text-green-400' : 'text-red-400'}`}>\n                                                                        {t.type === 'income' ? '+' : '-'}${t.amount.toLocaleString()}\n                                                                    </td>\n                                                                </tr>\n                                                            ))}\n                                                            {dashboardMetrics.transactions.length === 0 && (\n                                                                <tr><td colSpan=\"5\" className=\"text-center py-8 text-slate-500\">Sin movimientos registrados.</td></tr>\n                                                            )}\n                                                        </tbody>\n                                                    </table>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CONFIGURACIÓN (BLINDADA) - REMOVED (Consolidated in main Settings tab below) */}\n\n\n                                    {/* TAB: PROVEEDORES (CON SELECTOR VISUAL) */}\n                                    {adminTab === 'suppliers' && (\n                                        <div className=\"max-w-6xl mx-auto space-y-8 animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                                                <h1 className=\"text-3xl font-black text-white\">Proveedores</h1>\n                                                <div className=\"flex items-center gap-2\">\n                                                    <AdminHowToUse guideKey=\"suppliers\" />\n                                                    <button onClick={() => { setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] }); setEditingSupplierId(null); setShowSupplierModal(true); }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:-translate-y-1\">\n                                                        <Plus className=\"w-5 h-5\" /> Nuevo Proveedor\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {suppliers.map((s, idx) => (\n                                                    <div key={s.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-[2rem] hover:border-slate-600 transition duration-300 group animate-fade-up\">\n                                                        <div className=\"flex justify-between items-start mb-6\">\n                                                            <div className=\"p-4 bg-slate-900 rounded-xl text-slate-400 group-hover:text-orange-400 transition group-hover:bg-orange-900/20\">\n                                                                <Truck className=\"w-8 h-8\" />\n                                                            </div>\n                                                            <div className=\"flex gap-2\">\n                                                                <button\n                                                                    onClick={() => { setNewSupplier(s); setEditingSupplierId(s.id); setShowSupplierModal(true); }}\n                                                                    className=\"text-slate-600 hover:text-orange-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Editar\"\n                                                                >\n                                                                    <Edit className=\"w-5 h-5\" />\n                                                                </button>\n                                                                <button\n                                                                    onClick={() => openConfirm(\"Eliminar Proveedor\", \"¿Eliminar proveedor?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', s.id)))}\n                                                                    className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Eliminar\"\n                                                                >\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n\n                                                        <h3 className=\"text-2xl font-bold text-white mb-2\">{s.name}</h3>\n\n                                                        <div className=\"space-y-3 mb-6 p-4 bg-slate-900/30 rounded-xl border border-slate-800/50\">\n                                                            <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                <User className=\"w-4 h-4 text-slate-500\" /> {s.contact}\n                                                            </p>\n                                                            {s.phone && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Phone className=\"w-4 h-4 text-slate-500\" /> {s.phone}\n                                                                </p>\n                                                            )}\n                                                            {s.ig && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Instagram className=\"w-4 h-4 text-slate-500\" /> {s.ig}\n                                                                </p>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"pt-4 border-t border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider\">Productos Suministrados</p>\n                                                            <div className=\"flex flex-wrap gap-2\">\n                                                                {(s.associatedProducts && s.associatedProducts.length > 0) ? (\n                                                                    s.associatedProducts.map(pid => {\n                                                                        const p = products.find(prod => prod.id === pid);\n                                                                        if (!p) return null;\n                                                                        return (\n                                                                            <div key={pid} className=\"w-10 h-10 rounded-lg bg-white p-1 flex items-center justify-center border border-slate-600 tooltip-container\" title={p.name}>\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                ) : (\n                                                                    <span className=\"text-xs text-slate-600 italic\">No hay productos asignados</span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: COMPRAS (STOCK) */}\n                                    {adminTab === 'purchases' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gestión de Stock y Compras</h1>\n                                                <AdminHowToUse guideKey=\"purchases\" />\n                                            </div>\n\n                                            {/* Formulario de Compra Unificado */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] mb-10 shadow-xl overflow-hidden relative\">\n\n                                                {/* Header / Solo Reposición de Stock */}\n                                                <div className=\"flex border-b border-slate-800\">\n                                                    <div className=\"flex-1 p-6 text-center font-bold tracking-wider bg-orange-900/20 text-orange-400\">\n                                                        <Package className=\"w-5 h-5 inline-block mr-2\" /> REGISTRAR REPOSICIÓN DE STOCK\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"p-8\">\n                                                    {(() => {\n                                                        const selectedProduct = products.find(p => p.id === newPurchase.productId);\n                                                        const productPrice = selectedProduct?.purchasePrice || selectedProduct?.basePrice || 0;\n                                                        const autoCost = productPrice * newPurchase.quantity;\n\n                                                        return (\n                                                            <div className=\"space-y-6 animate-fade-in\">\n                                                                {/* Preview del Producto Seleccionado (REMOVIDO de aquí para moverlo junto al input) */}\n\n                                                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                                    <div className=\"md:col-span-2\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Producto Existente</label>\n                                                                        <div className=\"flex gap-4 items-center\">\n                                                                            {selectedProduct && (\n                                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                                    <img src={selectedProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                                </div>\n                                                                            )}\n                                                                            <div className=\"flex-1\">\n                                                                                <select className=\"input-cyber w-full p-4\" value={newPurchase.productId} onChange={e => setNewPurchase({ ...newPurchase, productId: e.target.value })}>\n                                                                                    <option value=\"\">Seleccionar Producto...</option>\n                                                                                    {products.map(p => (\n                                                                                        <option key={p.id} value={p.id}>\n                                                                                            {p.name} (Stock: {isNaN(Number(p.stock)) ? 0 : p.stock})\n                                                                                        </option>\n                                                                                    ))}\n                                                                                </select>\n                                                                                {selectedProduct && (\n                                                                                    <p className=\"text-xs text-orange-400 mt-2 font-bold\">\n                                                                                        Stock Actual: {isNaN(Number(selectedProduct.stock)) ? 0 : selectedProduct.stock} | Costo Total Estimado: ${autoCost.toLocaleString()}\n                                                                                    </p>\n                                                                                )}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    <div>\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cantidad</label>\n                                                                        <input type=\"number\" className=\"input-cyber w-full p-4\" placeholder=\"0\" value={newPurchase.quantity} onChange={e => setNewPurchase({ ...newPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                                    </div>\n                                                                    <div className=\"md:col-span-3\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Proveedor</label>\n                                                                        <select className=\"input-cyber w-full p-4\" value={newPurchase.supplierId} onChange={e => setNewPurchase({ ...newPurchase, supplierId: e.target.value })}>\n                                                                            <option value=\"\">Seleccionar...</option>\n                                                                            {suppliers.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\n                                                                        </select>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        )\n                                                    })()}\n\n\n                                                    <button\n                                                        onClick={async () => {\n                                                            // Validaciones\n                                                            if (!newPurchase.productId) return showToast(\"Selecciona un producto existente.\", \"warning\");\n                                                            if (newPurchase.quantity <= 0) return showToast(\"La cantidad debe ser mayor a 0.\", \"warning\");\n                                                            if (newPurchase.cost < 0) return showToast(\"El costo no puede ser negativo.\", \"warning\");\n\n                                                            try {\n                                                                const selectedProd = products.find(p => p.id === newPurchase.productId);\n                                                                const targetProductName = selectedProd?.name || \"Desconocido\";\n\n                                                                // Auto-calcular costo: precio de compra × cantidad\n                                                                const productPrice = selectedProd?.purchasePrice || selectedProd?.basePrice || 0;\n                                                                const calculatedCost = productPrice * newPurchase.quantity;\n\n                                                                // REGISTRAR COMPRA\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), {\n                                                                    productId: newPurchase.productId,\n                                                                    supplierId: newPurchase.supplierId || '',\n                                                                    quantity: newPurchase.quantity,\n                                                                    cost: calculatedCost,\n                                                                    date: new Date().toISOString()\n                                                                });\n\n                                                                // ACTUALIZAR STOCK\n                                                                const currentStock = isNaN(Number(selectedProd?.stock)) ? 0 : Number(selectedProd.stock);\n                                                                const newStock = currentStock + newPurchase.quantity;\n\n                                                                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', newPurchase.productId), {\n                                                                    stock: newStock\n                                                                });\n\n                                                                // Resetear Formulario\n                                                                setNewPurchase({\n                                                                    isNewProduct: false, productId: '', supplierId: '', quantity: 1, cost: 0,\n                                                                    newProdName: '', newProdPrice: 0, newProdImage: '', newProdCategory: ''\n                                                                });\n                                                                showToast(`Compra de \"${targetProductName}\" registrada exitosamente.`, \"success\");\n\n                                                            } catch (e) {\n                                                                console.error(\"Error stock update:\", e);\n                                                                showToast(\"Error: \" + (e.message || \"Operación fallida\"), \"error\");\n                                                            }\n                                                        }}\n                                                        className=\"w-full mt-8 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-black py-5 rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <Save className=\"w-6 h-6\" /> REGISTRAR REPOSICIÓN DE STOCK\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* CARRITO DE COMPRAS */}\n                                            {purchaseCart.length > 0 && (\n                                                <div className=\"bg-gradient-to-br from-orange-900/20 to-red-900/20 border border-orange-800 rounded-[2.5rem] p-8 mb-10 animate-fade-up\">\n                                                    <div className=\"flex items-center justify-between mb-6\">\n                                                        <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <ShoppingCart className=\"w-6 h-6 text-orange-400\" />\n                                                            Carrito de Compras ({purchaseCart.length} {purchaseCart.length === 1 ? 'producto' : 'productos'})\n                                                        </h3>\n                                                        <p className=\"text-orange-400 font-black text-2xl\">\n                                                            TOTAL: ${purchaseCart.reduce((acc, item) => acc + item.cost, 0).toLocaleString()}\n                                                        </p>\n                                                    </div>\n\n                                                    <div className=\"space-y-4 mb-6\">\n                                                        {purchaseCart.map((item, index) => (\n                                                            <div key={index} className=\"flex items-center gap-6 bg-slate-900/50 p-4 rounded-xl border border-slate-700\">\n                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0\">\n                                                                    <img src={item.productImage} className=\"w-full h-full object-contain\" alt={item.productName} />\n                                                                </div>\n                                                                <div className=\"flex-1\">\n                                                                    <p className=\"font-bold text-white\">{item.productName}</p>\n                                                                    <p className=\"text-xs text-slate-400\">Precio Unit.: ${item.unitPrice.toLocaleString()}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-3\">\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        value={item.quantity}\n                                                                        onChange={(e) => updatePurchaseCartItem(index, parseInt(e.target.value) || 1)}\n                                                                        className=\"w-20 bg-slate-800 border border-slate-700 text-white px-3 py-2 rounded-lg text-center font-bold\"\n                                                                        min=\"1\"\n                                                                    />\n                                                                    <p className=\"text-orange-400 font-bold w-28 text-right\">${item.cost.toLocaleString()}</p>\n                                                                    <button\n                                                                        onClick={() => removeFromPurchaseCart(index)}\n                                                                        className=\"p-2 bg-red-900/20 hover:bg-red-900/40 text-red-400 rounded-lg transition\"\n                                                                    >\n                                                                        <Trash2 className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        ))}\n                                                    </div>\n\n                                                    <button\n                                                        onClick={finalizePurchaseOrder}\n                                                        className=\"w-full py-5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-black rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <CheckCircle className=\"w-6 h-6\" /> FINALIZAR PEDIDO\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Historial */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6\">Historial de Compras</h3>\n                                                <div className=\"space-y-4\">\n                                                    {purchases.sort((a, b) => new Date(b.date) - new Date(a.date)).map((p, idx) => {\n                                                        const prod = products.find(prod => prod.id === p.productId);\n                                                        const sup = suppliers.find(s => s.id === p.supplierId);\n                                                        return (\n                                                            <div key={p.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"flex justify-between items-center bg-slate-900/40 p-4 rounded-xl border border-slate-800 hover:border-slate-600 transition group animate-fade-up\">\n                                                                <div className=\"flex items-center gap-4 flex-1\">\n                                                                    {/* Image Preview */}\n                                                                    <div className=\"w-12 h-12 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                        {prod?.image ? (\n                                                                            <img src={prod.image} className=\"w-full h-full object-contain\" alt={prod.name} />\n                                                                        ) : (\n                                                                            <Package className=\"w-full h-full text-slate-400 p-2\" />\n                                                                        )}\n                                                                    </div>\n\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white flex items-center gap-2\">\n                                                                            {prod?.name || 'Producto Eliminado'}\n                                                                            <span className=\"text-[10px] bg-slate-800 px-2 py-0.5 rounded text-slate-400\">STOCK ACTUAL: {prod?.stock || 0}</span>\n                                                                        </p>\n                                                                        <p className=\"text-xs text-slate-500\">{new Date(p.date).toLocaleDateString()} {sup ? `- Prov: ${sup.name}` : ''}</p>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex items-center gap-6\">\n                                                                    <div className=\"text-right\">\n                                                                        <p className=\"text-orange-400 font-bold\">+{p.quantity} u.</p>\n                                                                        <p className=\"text-slate-400 text-xs font-mono\">${(p.cost || 0).toLocaleString()}</p>\n                                                                    </div>\n                                                                    <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                                        <button onClick={() => setEditingPurchase(p)} className=\"p-2 bg-slate-800 hover:bg-blue-900/30 text-slate-400 hover:text-blue-400 rounded-lg transition\">\n                                                                            <Edit className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                        <button onClick={() => deletePurchaseFn(p)} className=\"p-2 bg-slate-800 hover:bg-red-900/30 text-slate-400 hover:text-red-400 rounded-lg transition\">\n                                                                            <Trash2 className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        );\n                                                    })}\n                                                </div>\n                                            </div>\n\n                                            {/* Modal Edición Compra */}\n                                            {editingPurchase && (\n                                                <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-in\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-700 rounded-3xl p-8 w-full max-w-lg shadow-2xl relative\">\n                                                        <button onClick={() => setEditingPurchase(null)} className=\"absolute top-4 right-4 p-2 text-slate-500 hover:text-white\"><X className=\"w-6 h-6\" /></button>\n                                                        <h3 className=\"text-2xl font-bold text-white mb-6\">Editar Compra</h3>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Cantidad comprada</label>\n                                                                <div className=\"text-xs text-yellow-500 mb-2\">⚠ Modificar esto ajustará el stock del producto automáticamente.</div>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.quantity} onChange={e => setEditingPurchase({ ...editingPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Costo Total ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.cost} onChange={e => setEditingPurchase({ ...editingPurchase, cost: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => {\n                                                                const original = purchases.find(x => x.id === editingPurchase.id);\n                                                                if (original) updatePurchaseFn(editingPurchase.id, original, editingPurchase);\n                                                            }}\n                                                            className=\"w-full mt-6 bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl transition shadow-lg\"\n                                                        >\n                                                            Guardar Cambios\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: FINANZAS (GASTOS E INVERSIONES) */}\n                                    {adminTab === 'finance' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-4xl font-black text-white neon-text\">Finanzas y Capital</h1>\n                                                <AdminHowToUse guideKey=\"finance\" />\n                                            </div>\n\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* SECCIÓN: REGISTRAR INVERSIÓN (NUEVO) */}\n                                                <div className=\"bg-[#0a0a0a] border border-orange-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <TrendingUp className=\"w-5 h-5 text-orange-400\" /> Registrar Inversión / Aporte\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Inversor (Socio)</label>\n                                                            <div className=\"relative\">\n                                                                <Users className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500 w-4 h-4\" />\n                                                                <select\n                                                                    className=\"input-cyber w-full pl-12 p-4 appearance-none\"\n                                                                    value={newInvestment.investor}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                >\n                                                                    <option value=\"\">Seleccionar Socio...</option>\n                                                                    {(settings?.team || []).map((member, idx) => (\n                                                                        <option key={idx} value={member.name || member.email}>\n                                                                            {member.name || member.email}\n                                                                        </option>\n                                                                    ))}\n                                                                    <option value=\"other\">Otro / Externo</option>\n                                                                </select>\n                                                            </div>\n                                                            {newInvestment.investor === 'other' && (\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4 mt-2\"\n                                                                    placeholder=\"Nombre del Inversor Externo\"\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                />\n                                                            )}\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4 font-mono font-bold text-orange-400\"\n                                                                    placeholder=\"0.00\"\n                                                                    value={newInvestment.amount}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, amount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Fecha</label>\n                                                                <input\n                                                                    type=\"date\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={newInvestment.date}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, date: e.target.value })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Notas (Opcional)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Ej: Inversión Inicial, Refuerzo de capital...\"\n                                                                value={newInvestment.notes}\n                                                                onChange={e => setNewInvestment({ ...newInvestment, notes: e.target.value })}\n                                                            />\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newInvestment.investor || newInvestment.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), {\n                                                                    ...newInvestment,\n                                                                    timestamp: new Date().toISOString()\n                                                                });\n                                                                setNewInvestment({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n                                                                showToast(\"Inversión registrada correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-orange-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Aporte\n                                                        </button>\n                                                    </div>\n                                                </div>\n\n                                                {/* SECCIÓN: REGISTRAR GASTO */}\n                                                <div className=\"bg-[#0a0a0a] border border-red-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-red-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <Wallet className=\"w-5 h-5 text-red-400\" /> Registrar Gasto / Egreso\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripción</label>\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Ej: Pago de Internet, Alquiler...\" value={newExpense.description} onChange={e => setNewExpense({ ...newExpense, description: e.target.value })} />\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-4 font-mono font-bold text-red-400\" placeholder=\"0.00\" value={newExpense.amount} onChange={e => setNewExpense({ ...newExpense, amount: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Categoría</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newExpense.category} onChange={e => setNewExpense({ ...newExpense, category: e.target.value })}>\n                                                                    <option>General</option>\n                                                                    <option>Servicios</option>\n                                                                    <option>Impuestos</option>\n                                                                    <option>Mantenimiento</option>\n                                                                    <option>Marketing</option>\n                                                                    <option>Sueldos</option>\n                                                                    <option>Otros</option>\n                                                                </select>\n                                                            </div>\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newExpense.description || newExpense.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), {\n                                                                    ...newExpense,\n                                                                    date: new Date().toISOString()\n                                                                });\n                                                                setNewExpense({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n                                                                showToast(\"Gasto registrado correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-red-900/50 hover:bg-red-900 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-red-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Gasto\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* TABLAS DETALLADAS */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* Historial de Inversiones */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Inversiones</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {investments.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin inversiones registradas.</p> :\n                                                            investments.sort((a, b) => new Date(b.date) - new Date(a.date)).map((inv, idx) => (\n                                                                <div key={inv.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-orange-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{inv.investor}</p>\n                                                                        <p className=\"text-slate-500 text-xs\">{new Date(inv.date).toLocaleDateString()} {inv.notes && `- ${inv.notes}`}</p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-orange-400 font-mono font-bold\">+${inv.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Inversión\", \"¿Deseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'investments', inv.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n\n                                                {/* Historial de Gastos */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Gastos</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {expenses.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin gastos registrados.</p> :\n                                                            expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map((ex, idx) => (\n                                                                <div key={ex.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-red-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{ex.description}</p>\n                                                                        <p className=\"text-slate-500 text-xs flex gap-2\">\n                                                                            <span className=\"text-red-300 font-bold bg-red-900/20 px-1.5 rounded\">{ex.category}</span>\n                                                                            <span>{new Date(ex.date).toLocaleDateString()}</span>\n                                                                        </p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-red-400 font-mono font-bold\">-${ex.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Gasto\", \"¿Deseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'expenses', ex.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCIÓN: DISTRIBUCIÓN DE GANANCIAS (AUTOMÁTICA) */}\n                                            <div className=\"animate-fade-up pt-12 border-t border-slate-800\">\n                                                <div className=\"flex justify-between items-center mb-8\">\n                                                    <div>\n                                                        <h2 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <DollarSign className=\"w-8 h-8 text-green-500\" /> Distribución de Ganancias\n                                                        </h2>\n                                                        <p className=\"text-slate-500 mt-1\">Cálculo automático basado en las inversiones registradas.</p>\n                                                    </div>\n                                                    <div className=\"text-right\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Beneficio Neto</p>\n                                                        <p className={`text-3xl font-black ${dashboardMetrics.netIncome >= 0 ? 'text-green-400' : 'text-red-500'}`}>\n                                                            ${dashboardMetrics.netIncome.toLocaleString()}\n                                                        </p>\n                                                    </div>\n                                                </div>\n\n                                                {/* Gráfico y Tabla */}\n                                                <div className=\"flex flex-col gap-8 bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                    {(() => {\n                                                        const team = settings?.team || [];\n                                                        // Calcular Total Invertido por Miembro desde la colección 'investments'\n                                                        const memberInvestments = team.map(member => {\n                                                            const totalInv = investments\n                                                                .filter(inv => inv.investor === member.name || inv.investor === member.email) // Match by Name or Email\n                                                                .reduce((acc, inv) => acc + (Number(inv.amount) || 0), 0);\n                                                            return { ...member, totalInv };\n                                                        });\n\n                                                        const totalCapital = memberInvestments.reduce((acc, m) => acc + m.totalInv, 0);\n\n                                                        if (totalCapital === 0) return <p className=\"text-slate-500 text-center py-12\">Registra inversiones para ver la distribución de ganancias.</p>;\n\n                                                        return (\n                                                            <>\n                                                                {/* Barra de Progreso Distribución */}\n                                                                <div className=\"w-full h-8 bg-slate-900 rounded-full flex overflow-hidden\">\n                                                                    {memberInvestments.map((member, idx) => {\n                                                                        const pct = totalCapital > 0 ? (member.totalInv / totalCapital) * 100 : 0;\n                                                                        const colors = ['bg-green-500', 'bg-orange-500', 'bg-purple-500', 'bg-pink-500', 'bg-yellow-500', 'bg-red-500'];\n                                                                        if (pct <= 0) return null;\n                                                                        return (\n                                                                            <div key={idx} className={`${colors[idx % colors.length]} h-full transition-all duration-500`} style={{ width: `${pct}%` }} title={`${member.name}: ${pct.toFixed(1)}%`}></div>\n                                                                        );\n                                                                    })}\n                                                                </div>\n\n                                                                {/* Tabla de Distribución */}\n                                                                <div className=\"overflow-x-auto\">\n                                                                    <table className=\"w-full text-left border-collapse\">\n                                                                        <thead>\n                                                                            <tr className=\"bg-slate-900/50 border-b border-slate-800\">\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest\">Socio</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right\">Capital Aportado</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-center\">% Part.</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right text-green-500\">Ganancia Est.</th>\n                                                                            </tr>\n                                                                        </thead>\n                                                                        <tbody className=\"divide-y divide-slate-800/50\">\n                                                                            {memberInvestments.map((member, idx) => {\n                                                                                const sharePercentage = totalCapital > 0 ? ((member.totalInv / totalCapital) * 100) : 0;\n                                                                                const memberProfit = (dashboardMetrics.netIncome * sharePercentage) / 100;\n                                                                                const colors = ['text-green-500', 'text-orange-500', 'text-purple-500', 'text-pink-500', 'text-yellow-500', 'text-red-500'];\n\n                                                                                return (\n                                                                                    <tr key={idx} className=\"hover:bg-slate-900/20 transition\">\n                                                                                        <td className=\"p-5\">\n                                                                                            <div className=\"flex items-center gap-3\">\n                                                                                                <div className={`w-3 h-3 rounded-full ${colors[idx % colors.length].replace('text-', 'bg-')}`}></div>\n                                                                                                <div>\n                                                                                                    <p className=\"font-bold text-white\">{member.name || 'Sin Nombre'}</p>\n                                                                                                    <p className=\"text-xs text-slate-500\">{member.email}</p>\n                                                                                                </div>\n                                                                                            </div>\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-bold text-white\">\n                                                                                            ${member.totalInv.toLocaleString()}\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-center font-mono text-slate-300 font-bold\">\n                                                                                            {sharePercentage.toFixed(1)}%\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-black text-green-400 text-lg\">\n                                                                                            ${memberProfit.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                                                                                        </td>\n                                                                                    </tr>\n                                                                                );\n                                                                            })}\n                                                                        </tbody>\n                                                                        <tfoot className=\"bg-slate-900/30 border-t border-slate-800\">\n                                                                            <tr>\n                                                                                <td className=\"p-6 font-black text-white text-right\">TOTAL CAPITAL</td>\n                                                                                <td className=\"p-6 text-right font-black text-orange-400 text-lg\">\n                                                                                    ${totalCapital.toLocaleString()}\n                                                                                </td>\n                                                                                <td className=\"p-6 text-center font-bold text-slate-500\">100%</td>\n                                                                                <td className=\"p-6 text-right font-black text-green-500 text-xl\">\n                                                                                    ${dashboardMetrics.netIncome.toLocaleString()}\n                                                                                </td>\n                                                                            </tr>\n                                                                        </tfoot>\n                                                                    </table>\n                                                                </div>\n                                                            </>\n                                                        );\n                                                    })()}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CUPONES (GESTIÓN AVANZADA) */}\n                                    {adminTab === 'coupons' && (\n                                        <div className=\"max-w-5xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Overlay for Entrepreneur Plan */}\n                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                <button\n                                                    onClick={() => setShowPlansModal(true)}\n                                                    className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-md rounded-[2.5rem] cursor-pointer hover:bg-black/70 transition group\"\n                                                >\n                                                    <div className=\"text-center p-8 max-w-md\">\n                                                        <div className=\"w-20 h-20 mx-auto mb-6 bg-purple-500/20 rounded-full flex items-center justify-center border border-purple-500/30 group-hover:scale-110 transition\">\n                                                            <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-2xl font-black text-white mb-4\">Cupones Bloqueados</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Los cupones de descuento están disponibles a partir del <span className=\"text-purple-400 font-bold\">Plan Negocio</span>.</p>\n                                                        <p className=\"text-sm text-white/60 group-hover:text-white transition\">Clic para ver planes disponibles</p>\n                                                    </div>\n                                                </button>\n                                            )}\n\n                                            <div className=\"relative z-30 flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gestión de Cupones</h1>\n                                                <AdminHowToUse guideKey=\"coupons\" />\n                                            </div>\n\n                                            {/* Formulario de Creación */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] mb-10 shadow-xl\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                    <Plus className=\"w-5 h-5 text-purple-400\" /> Crear Nuevo Cupón\n                                                </h3>\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                    {/* Columna 1 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Código del Cupón</label>\n                                                            <input className=\"input-cyber w-full p-4 font-mono text-lg uppercase tracking-widest\" placeholder=\"Ej: VERANO2024\" value={newCoupon.code} onChange={e => setNewCoupon({ ...newCoupon, code: e.target.value.toUpperCase() })} />\n                                                        </div>\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newCoupon.type} onChange={e => setNewCoupon({ ...newCoupon, type: e.target.value })}>\n                                                                    <option value=\"percentage\">Porcentaje (%)</option>\n                                                                    <option value=\"fixed\">Fijo ($)</option>\n                                                                </select>\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Valor</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"0\" value={newCoupon.value} onChange={e => setNewCoupon({ ...newCoupon, value: e.target.value })} />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Columna 2 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mínimo de Compra</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0\" value={newCoupon.minPurchase} onChange={e => setNewCoupon({ ...newCoupon, minPurchase: e.target.value })} />\n                                                            </div>\n                                                            {newCoupon.type === 'percentage' && (\n                                                                <div className=\"flex-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tope Reintegro</label>\n                                                                    <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0 (Opcional)\" value={newCoupon.maxDiscount} onChange={e => setNewCoupon({ ...newCoupon, maxDiscount: e.target.value })} />\n                                                                </div>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Límite Usos (Total)</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Ej: 100\" value={newCoupon.usageLimit} onChange={e => setNewCoupon({ ...newCoupon, usageLimit: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Vencimiento</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"date\" value={newCoupon.expirationDate} onChange={e => setNewCoupon({ ...newCoupon, expirationDate: e.target.value })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"md:col-span-2\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                Tipo de Cupón\n                                                            </label>\n                                                            <select\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={newCoupon.targetType}\n                                                                onChange={e => setNewCoupon({ ...newCoupon, targetType: e.target.value })}\n                                                            >\n                                                                <option value=\"global\">🌍 Público / Canjeable (Redes Sociales)</option>\n                                                                <option value=\"specific_email\">👤 Usuario Específico (Email)</option>\n                                                            </select>\n                                                        </div>\n\n                                                        {newCoupon.targetType === 'specific_email' && (\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Email del Usuario\n                                                                </label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"usuario@ejemplo.com\"\n                                                                    value={newCoupon.targetUser || ''}\n                                                                    onChange={e => setNewCoupon({ ...newCoupon, targetUser: e.target.value })}\n                                                                />\n                                                                <p className=\"text-xs text-slate-400 mt-1\">Solo este usuario podrá usar el cupón</p>\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                                <button onClick={saveCouponFn} className=\"w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2\">\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cupón\n                                                </button>\n                                            </div>\n\n                                            {/* Lista de Cupones Activos */}\n                                            <div className=\"grid gap-4\">\n                                                {coupons.map((c, idx) => (\n                                                    <div key={c.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col md:flex-row justify-between items-center group hover:border-slate-700 transition animate-fade-up\">\n                                                        <div className=\"flex items-center gap-6 mb-4 md:mb-0 w-full md:w-auto\">\n                                                            <div className=\"w-16 h-16 bg-slate-900 rounded-xl flex items-center justify-center border border-slate-800 text-purple-400 font-black text-2xl\">\n                                                                %\n                                                            </div>\n                                                            <div>\n                                                                <h4 className=\"text-white font-black text-xl tracking-wider\">{c.code}</h4>\n                                                                <p className=\"text-purple-400 font-bold text-sm\">\n                                                                    {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                                    <span className=\"text-slate-500 font-normal ml-2\">\n                                                                        (Min: ${c.minPurchase})\n                                                                    </span>\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-600 mt-1 flex gap-3\">\n                                                                    <span>Usado: {c.usedBy ? c.usedBy.length : 0} veces</span>\n                                                                    {c.usageLimit && <span>Límite: {c.usageLimit}</span>}\n                                                                    {c.expirationDate && <span>Vence: {c.expirationDate}</span>}\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 md:mt-0\">\n                                                            {c.targetType === 'global' && (\n                                                                <div className=\"bg-purple-900/30 text-purple-400 px-3 py-1 rounded-lg border border-purple-500/30 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest\">\n                                                                    <Globe className=\"w-3 h-3\" /> Social\n                                                                </div>\n                                                            )}\n                                                            <button\n                                                                onClick={() => {\n                                                                    navigator.clipboard.writeText(c.code);\n                                                                    showToast(\"Código copiado al portapapeles\", \"success\");\n                                                                }}\n                                                                className=\"bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white p-3 rounded-xl transition border border-slate-800\"\n                                                                title=\"Copiar Código\"\n                                                            >\n                                                                <Copy className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button\n                                                                onClick={() => openConfirm(\"Eliminar Cupón\", \"¿Eliminar este cupón?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', c.id)))}\n                                                                className=\"bg-slate-900 hover:bg-red-900/20 text-slate-500 hover:text-red-400 p-3 rounded-xl transition border border-slate-800\"\n                                                            >\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: USERS (NUEVO) */}\n\n                                    {adminTab === 'users' && (() => {\n                                        const filteredUsers = users.filter(u => {\n                                            const query = userSearch.toLowerCase();\n                                            const matchesSearch = (u.name || '').toLowerCase().includes(query) ||\n                                                (u.email || '').toLowerCase().includes(query) ||\n                                                (u.username || '').toLowerCase().includes(query);\n                                            const matchesRole = userRoleFilter === 'all' || u.role === userRoleFilter;\n                                            return matchesSearch && matchesRole;\n                                        });\n\n                                        return (\n                                            <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                                <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10\">\n                                                    <div>\n                                                        <h1 className=\"text-4xl font-black text-white tracking-tighter flex items-center gap-4\">\n                                                            <div className=\"w-12 h-12 rounded-2xl bg-pink-500/20 flex items-center justify-center border border-pink-500/30\">\n                                                                <Users className=\"w-6 h-6 text-pink-400\" />\n                                                            </div>\n                                                            Gestión de Usuarios\n                                                        </h1>\n                                                        <p className=\"text-slate-500 mt-2 font-medium\">Control total sobre cuentas, roles y auditoría de carritos.</p>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto\">\n                                                        <div className=\"w-full sm:w-auto flex justify-end\">\n                                                            <AdminHowToUse guideKey=\"users\" />\n                                                        </div>\n                                                        <div className=\"relative w-full sm:w-64 group\">\n                                                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 group-focus-within:text-orange-400 transition\" />\n                                                            <input\n                                                                className=\"input-cyber w-full pl-11 pr-4 py-3 text-sm\"\n                                                                placeholder=\"Buscar por nombre, email...\"\n                                                                value={userSearch}\n                                                                onChange={e => setUserSearch(e.target.value)}\n                                                            />\n                                                        </div>\n                                                        <div className=\"flex bg-slate-900/50 p-1 rounded-xl border border-white/5\">\n                                                            {['all', 'admin', 'user'].map(role => (\n                                                                <button\n                                                                    key={role}\n                                                                    onClick={() => setUserRoleFilter(role)}\n                                                                    className={`px-4 py-2 rounded-lg text-xs font-black uppercase transition-all ${userRoleFilter === role ? 'bg-white/10 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\n                                                                >\n                                                                    {role === 'all' ? 'Todos' : role}\n                                                                </button>\n                                                            ))}\n                                                        </div>\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"bg-[#050505] border border-white/5 rounded-[2.5rem] overflow-hidden shadow-2xl\">\n                                                    <div className=\"overflow-x-auto overflow-y-visible\">\n                                                        <table className=\"w-full text-left border-collapse\">\n                                                            <thead>\n                                                                <tr className=\"bg-white/[0.02] border-b border-white/5\">\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Identidad</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-center\">Actividad & Stats</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Rango</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-right\">Acciones</th>\n                                                                </tr>\n                                                            </thead>\n                                                            <tbody className=\"divide-y divide-white/5\">\n                                                                {filteredUsers.length === 0 ? (\n                                                                    <tr>\n                                                                        <td colSpan=\"4\" className=\"p-20 text-center\">\n                                                                            <div className=\"flex flex-col items-center gap-4 opacity-20\">\n                                                                                <UserPlus className=\"w-16 h-16\" />\n                                                                                <p className=\"font-black uppercase tracking-widest\">No se encontraron usuarios</p>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ) : filteredUsers.map((u, idx) => (\n                                                                    <tr key={u.id} style={{ animationDelay: `${idx * 0.03}s` }} className=\"group hover:bg-white/[0.01] transition-all animate-fade-up\">\n                                                                        <td className=\"p-5\">\n                                                                            <div className=\"flex items-center gap-5\">\n                                                                                <div className=\"relative group/avatar\">\n                                                                                    <div className=\"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl blur-lg opacity-20 group-hover/avatar:opacity-40 transition\" />\n                                                                                    <div className=\"relative w-14 h-14 rounded-2xl bg-[#0a0a0a] border border-white/10 flex items-center justify-center text-xl font-black text-white overflow-hidden shadow-xl\">\n                                                                                        {u.image ? <img src={u.image} className=\"w-full h-full object-cover\" /> : (u.name || '?').charAt(0).toUpperCase()}\n                                                                                    </div>\n                                                                                </div>\n                                                                                <div>\n                                                                                    <div className=\"flex items-center gap-2\">\n                                                                                        <p className=\"font-bold text-white text-lg tracking-tight\">{u.name}</p>\n                                                                                        {u.isVerified && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 font-mono\">{u.email}</p>\n                                                                                    <div className=\"flex items-center gap-3 mt-2\">\n                                                                                        <span className=\"text-[9px] font-black text-slate-600 uppercase tracking-widest bg-white/5 px-2 py-0.5 rounded-md\">ID: {u.id.slice(-6)}</span>\n                                                                                        <span className=\"text-[9px] font-bold text-slate-500 uppercase\">INC. {new Date(u.joinDate).toLocaleDateString()}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8 relative\">\n                                                                            {/* Blur Overlay for Entrepreneur Plan */}\n                                                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                                                <button\n                                                                                    onClick={() => setShowPlansModal(true)}\n                                                                                    className=\"absolute inset-0 z-10 flex items-center justify-center bg-black/60 backdrop-blur-sm rounded-xl cursor-pointer hover:bg-black/70 transition group\"\n                                                                                >\n                                                                                    <div className=\"text-center\">\n                                                                                        <Lock className=\"w-6 h-6 text-yellow-500 mx-auto mb-2 group-hover:scale-110 transition\" />\n                                                                                        <p className=\"text-xs font-black text-yellow-400 uppercase tracking-wider\">Plan Negocio</p>\n                                                                                        <p className=\"text-[10px] text-slate-400 group-hover:text-white transition\">Clic para ver planes</p>\n                                                                                    </div>\n                                                                                </button>\n                                                                            )}\n                                                                            <div className={`flex flex-col items-center gap-3 ${(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) ? 'filter blur-sm pointer-events-none' : ''}`}>\n                                                                                <div className=\"flex gap-2\">\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Favoritos\">\n                                                                                        <Heart className={`w-4 h-4 ${u.favorites?.length > 0 ? 'text-pink-500 fill-pink-500' : 'text-slate-600'}`} />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.favorites ? u.favorites.length : 0}</span>\n                                                                                    </div>\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Pedidos Realizados\">\n                                                                                        <ShoppingBag className=\"w-4 h-4 text-orange-500\" />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.ordersCount || 0}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                                <button\n                                                                                    onClick={() => setViewUserCart(u)}\n                                                                                    className=\"w-full py-2.5 rounded-xl border border-orange-500/20 bg-orange-500/5 text-orange-400 hover:bg-orange-500/20 text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2\"\n                                                                                >\n                                                                                    <Maximize2 className=\"w-3 h-3\" /> Ver Carrito en Vivo\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.1em] border shadow-inner ${u.role === 'admin'\n                                                                                ? 'bg-purple-500/10 text-purple-400 border-purple-500/30'\n                                                                                : 'bg-slate-900/50 text-slate-500 border-white/5'\n                                                                                }`}>\n                                                                                {u.role === 'admin' ? <Shield className=\"w-3 h-3\" /> : <User className=\"w-3 h-3\" />}\n                                                                                {u.role}\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className=\"flex justify-end gap-3 translate-x-2 opacity-60 group-hover:opacity-100 transition-opacity\">\n                                                                                <button\n                                                                                    onClick={() => setViewUserEdit(u)}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-orange-400 hover:border-orange-500/40 hover:bg-orange-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Gestionar Perfil\"\n                                                                                >\n                                                                                    <Edit className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                                <button\n                                                                                    onClick={() => {\n                                                                                        setNewAdminPassword('');\n                                                                                        setUserPassModal(u);\n                                                                                    }}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-pink-400 hover:border-pink-500/40 hover:bg-pink-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Seguridad & Acceso\"\n                                                                                >\n                                                                                    <Lock className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ))}\n                                                            </tbody>\n                                                        </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        );\n                                    })()}\n\n\n                                    {/* TAB: PROMOS (NUEVO) */}\n                                    {adminTab === 'promos' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white flex items-center gap-3\">\n                                                    <Tag className=\"w-8 h-8 text-purple-500\" /> Gestión de Promos\n                                                </h1>\n                                                <AdminHowToUse guideKey=\"promos\" />\n                                            </div>\n\n                                            {/* Formulario Nueva Promo */}\n                                            {/* Formulario Nueva Promo o Banner Upgrade */}\n                                            {(!((settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && promos.length >= 1) || isEditingPromo) ? (\n                                                <div className=\"bg-[#0a0a0a] border border-purple-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        {isEditingPromo ? <Edit className=\"w-5 h-5 text-purple-400\" /> : <Plus className=\"w-5 h-5 text-green-400\" />}\n                                                        {isEditingPromo ? 'Editar Promo' : 'Crear Nueva Promo'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                        {/* Datos Básicos */}\n                                                        <div className=\"space-y-4\">\n                                                            <input\n                                                                type=\"text\"\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Nombre de la Promo\"\n                                                                value={newPromo.name}\n                                                                onChange={e => setNewPromo({ ...newPromo, name: e.target.value })}\n                                                            />\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <div className=\"relative\">\n                                                                    <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\">$</span>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        className=\"input-cyber w-full p-4 pl-8\"\n                                                                        placeholder=\"Precio\"\n                                                                        value={newPromo.price}\n                                                                        onChange={e => setNewPromo({ ...newPromo, price: e.target.value })}\n                                                                    />\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900 rounded-xl border border-slate-700 text-slate-400 font-mono text-sm flex items-center\">\n                                                                    Costo: ${newPromo.items.reduce((acc, item) => {\n                                                                        const p = products.find(prod => prod.id === item.productId);\n                                                                        return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                    }, 0).toLocaleString()}\n                                                                </div>\n                                                            </div>\n                                                            <div className=\"mb-4\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de la Promo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={e => handleImageUpload(e, setNewPromo)}\n                                                                />\n                                                                {newPromo.image && (\n                                                                    <div className=\"mt-2 relative group w-32 aspect-video overflow-hidden rounded-xl border border-slate-700\">\n                                                                        <img src={newPromo.image} className=\"w-full h-full object-cover\" />\n                                                                        <button onClick={() => setNewPromo({ ...newPromo, image: '' })} className=\"absolute top-1 right-1 bg-black/50 p-1 rounded-full text-white hover:bg-red-500 transition opacity-0 group-hover:opacity-100\">\n                                                                            <X className=\"w-3 h-3\" />\n                                                                        </button>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                placeholder=\"Descripción breve...\"\n                                                                value={newPromo.description}\n                                                                onChange={e => setNewPromo({ ...newPromo, description: e.target.value })}\n                                                            />\n                                                        </div>\n\n                                                        {/* Constructor de Bundle */}\n                                                        <div className=\"bg-slate-900/40 p-6 rounded-2xl border border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                                                <Package className=\"w-4 h-4\" /> Productos Incluidos\n                                                            </p>\n\n                                                            <div className=\"grid grid-cols-1 sm:grid-cols-[1fr_5rem_auto] gap-2 mb-4\">\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3 text-sm min-w-0\"\n                                                                    value={selectedPromoProduct}\n                                                                    onChange={e => setSelectedPromoProduct(e.target.value)}\n                                                                >\n                                                                    <option value=\"\">Agregar producto...</option>\n                                                                    {products.map(p => (\n                                                                        <option key={p.id} value={p.id}>{p.name} (${Number(p.basePrice)})</option>\n                                                                    ))}\n                                                                </select>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full sm:w-20 p-3 text-sm text-center\"\n                                                                    value={promoProductQty}\n                                                                    min=\"1\"\n                                                                    onChange={e => setPromoProductQty(Math.max(1, parseInt(e.target.value) || 1))}\n                                                                />\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!selectedPromoProduct) return;\n                                                                        const exists = newPromo.items.find(i => i.productId === selectedPromoProduct);\n                                                                        if (exists) {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: newPromo.items.map(i => i.productId === selectedPromoProduct ? { ...i, quantity: i.quantity + promoProductQty } : i)\n                                                                            });\n                                                                        } else {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: [...newPromo.items, { productId: selectedPromoProduct, quantity: promoProductQty }]\n                                                                            });\n                                                                        }\n                                                                        setSelectedPromoProduct('');\n                                                                        setPromoProductQty(1);\n                                                                    }}\n                                                                    className=\"h-[46px] w-full sm:w-auto px-4 bg-purple-600 hover:bg-purple-500 text-white rounded-xl transition flex items-center justify-center\"\n                                                                >\n                                                                    <Plus className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n\n                                                            <div className=\"space-y-2 max-h-[150px] overflow-y-auto custom-scrollbar\">\n                                                                {newPromo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    if (!p) return null;\n                                                                    return (\n                                                                        <div key={idx} className=\"flex justify-between items-center bg-slate-900 p-3 rounded-lg border border-slate-700\">\n                                                                            <div className=\"flex items-center gap-3\">\n                                                                                <img src={p.image} className=\"w-8 h-8 rounded bg-white object-contain p-0.5\" />\n                                                                                <div>\n                                                                                    <p className=\"text-sm font-bold text-white truncate max-w-[200px] sm:max-w-none\">{p.name}</p>\n                                                                                    <p className=\"text-xs text-slate-500\">{item.quantity} un. x ${p.basePrice}</p>\n                                                                                </div>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewPromo({ ...newPromo, items: newPromo.items.filter((_, i) => i !== idx) })}\n                                                                                className=\"text-red-500 hover:text-red-400 p-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-4 h-4\" />\n                                                                            </button>\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                                {newPromo.items.length === 0 && (\n                                                                    <div className=\"text-center py-6 text-slate-600 italic text-sm border border-dashed border-slate-800 rounded-lg\">\n                                                                        Agrega productos para armar el combo\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end mt-6\">\n                                                        {isEditingPromo && (\n                                                            <button\n                                                                onClick={() => {\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                }}\n                                                                className=\"w-full sm:w-auto px-6 py-3 rounded-xl border border-slate-800 bg-slate-900/40 text-slate-300 hover:text-white hover:bg-slate-900 transition font-bold\"\n                                                            >\n                                                                Cancelar\n                                                            </button>\n                                                        )}\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newPromo.name || !newPromo.price || newPromo.items.length === 0) {\n                                                                    return showToast(\"Completa nombre, precio y agrega productos.\", \"warning\");\n                                                                }\n\n                                                                setIsLoading(true);\n                                                                try {\n                                                                    if (isEditingPromo && editingPromoId) {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', editingPromoId), newPromo);\n                                                                        showToast(\"Promo actualizada\", \"success\");\n                                                                    } else {\n                                                                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'promos'), {\n                                                                            ...newPromo,\n                                                                            createdAt: new Date().toISOString()\n                                                                        });\n                                                                        showToast(\"Promo creada exitosamente\", \"success\");\n                                                                    }\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                } catch (e) {\n                                                                    console.error(e);\n                                                                    showToast(\"Error al guardar promo\", \"error\");\n                                                                } finally {\n                                                                    setIsLoading(false);\n                                                                }\n                                                            }}\n                                                            className=\"w-full sm:w-auto px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center\"\n                                                        >\n                                                            {isEditingPromo ? 'Guardar Cambios' : 'Crear Promo'}\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            ) : (\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] mb-10 shadow-xl flex flex-col items-center justify-center text-center animate-fade-up\">\n                                                    <div className=\"w-20 h-20 bg-purple-500/20 rounded-full flex items-center justify-center mb-6 border border-purple-500/30\">\n                                                        <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                    </div>\n                                                    <h3 className=\"text-2xl font-black text-white mb-2\">Límite de Promos Alcanzado</h3>\n                                                    <p className=\"text-slate-400 max-w-md mb-8\">\n                                                        Tu plan actual te permite tener hasta <strong className=\"text-white\">1 promo activa</strong>.\n                                                        Para crear más promociones ilimitadas, actualiza tu plan.\n                                                    </p>\n                                                    <button\n                                                        onClick={() => setShowPlansModal(true)}\n                                                        className=\"px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg shadow-purple-600/20 transition flex items-center gap-2\"\n                                                    >\n                                                        <Zap className=\"w-5 h-5\" /> Mejorar mi Plan\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Promos */}\n                                            {/* Lista de Promos */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {promos.map(promo => {\n                                                    const totalCost = (promo.items || []).reduce((acc, item) => {\n                                                        const p = products.find(prod => prod.id === item.productId);\n                                                        return acc + ((Number(p?.purchasePrice) || 0) * item.quantity);\n                                                    }, 0);\n                                                    const price = Number(promo.price) || 0;\n                                                    const profit = price - totalCost;\n                                                    const margin = price > 0 ? ((profit / price) * 100).toFixed(1) : 0;\n                                                    const isProfitable = profit > 0;\n\n                                                    return (\n                                                        <div key={promo.id} className=\"bg-[#0a0a0a] border border-slate-800 rounded-2xl overflow-hidden hover:border-purple-500/30 transition group flex flex-col\">\n                                                            <div className=\"aspect-video relative overflow-hidden\">\n                                                                <img src={promo.image || 'https://via.placeholder.com/400'} className=\"w-full h-full object-cover transition duration-500 group-hover:scale-105\" />\n                                                                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent\"></div>\n                                                                <div className=\"absolute bottom-4 left-4 right-4 bg-black/55 backdrop-blur-sm rounded-2xl p-4 border border-white/10\">\n                                                                    <h4 className=\"text-xl font-black text-white mb-1 leading-tight\">{promo.name}</h4>\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <p className=\"text-3xl text-purple-400 font-black\">${price.toLocaleString()}</p>\n                                                                        {totalCost > 0 && (\n                                                                            <div className={`px-2 py-1 rounded text-xs font-bold border ${isProfitable ? 'bg-green-900/30 border-green-500/30 text-green-400' : 'bg-red-900/30 border-red-500/30 text-red-400'}`}>\n                                                                                {margin}% MG\n                                                                            </div>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"p-6 flex-1 flex flex-col\">\n                                                                {/* Productos Incluidos con Miniaturas */}\n                                                                <div className=\"mb-6 flex-1\">\n                                                                    <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Incluye:</p>\n                                                                    <div className=\"flex flex-col gap-2\">\n                                                                        {(promo.items || []).map((item, i) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return (\n                                                                                <div key={i} className=\"flex items-center gap-3 p-2 rounded-lg bg-slate-900/50 border border-slate-800/50\">\n                                                                                    <div className=\"w-10 h-10 bg-white rounded-lg p-0.5 flex-shrink-0\">\n                                                                                        <img src={p?.image} className=\"w-full h-full object-contain\" />\n                                                                                    </div>\n                                                                                    <div className=\"flex-1 min-w-0\">\n                                                                                        <p className=\"text-sm font-bold text-white truncate\">{p?.name || 'Producto Eliminado'}</p>\n                                                                                        <p className=\"text-xs text-slate-500\">{item.quantity} x ${Number(p?.basePrice || 0).toLocaleString()} (Costo)</p>\n                                                                                    </div>\n                                                                                </div>\n                                                                            )\n                                                                        })}\n                                                                    </div>\n                                                                </div>\n\n                                                                {/* Análisis de Rentabilidad */}\n                                                                <div className=\"mb-6 p-4 bg-slate-900/40 rounded-xl border border-dashed border-slate-800\">\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Costo Real:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${totalCost.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Precio Venta:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${price.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"border-t border-slate-800 my-2\"></div>\n                                                                    <div className=\"flex justify-between text-sm font-bold\">\n                                                                        <span className={isProfitable ? \"text-green-500\" : \"text-red-500\"}>Ganancia Neta:</span>\n                                                                        <span className={`font-mono ${isProfitable ? \"text-green-400\" : \"text-red-400\"}`}>\n                                                                            {isProfitable ? '+' : ''}${profit.toLocaleString()}\n                                                                        </span>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex gap-3 mt-auto\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            setNewPromo({\n                                                                                name: promo.name,\n                                                                                price: promo.price,\n                                                                                image: promo.image,\n                                                                                description: promo.description || '',\n                                                                                items: promo.items || []\n                                                                            });\n                                                                            setEditingPromoId(promo.id);\n                                                                            setIsEditingPromo(true);\n                                                                            window.scrollTo({ top: 0, behavior: 'smooth' });\n                                                                        }}\n                                                                        className=\"flex-1 py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-bold transition border border-slate-700 flex items-center justify-center gap-2 group-hover:border-purple-500/30\"\n                                                                    >\n                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                    </button>\n                                                                    <button\n                                                                        onClick={() => openConfirm('Eliminar Promo', '¿Estás seguro? Esto no se puede deshacer.', async () => {\n                                                                            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', promo.id));\n                                                                            showToast(\"Promo eliminada\", \"info\");\n                                                                        })}\n                                                                        className=\"px-4 py-3 bg-red-900/20 hover:bg-red-900/40 text-red-500 rounded-xl transition border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PEDIDOS (RESTAURADO) */}\n                                    {adminTab === 'orders' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gestión de Pedidos</h1>\n                                                <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"orders\" />\n                                                    <button onClick={() => toggleAdminOrderAlarmMuted()} className={`px-5 py-3 rounded-xl font-black transition border flex items-center gap-3 ${adminOrderAlarmMuted ? 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800' : 'bg-green-900/10 text-green-400 border-green-500/20 hover:bg-green-600 hover:text-white'}`}>\n                                                        <Bell className={`w-5 h-5 ${adminOrderAlarmMuted ? 'opacity-40' : ''}`} />\n                                                        Notificación pedidos\n                                                        <span className={`text-[10px] px-2 py-1 rounded-full border font-black uppercase tracking-widest ${adminOrderAlarmMuted ? 'bg-slate-900/60 text-slate-400 border-slate-700' : 'bg-green-900/20 text-green-400 border-green-500/30'}`}>\n                                                            {adminOrderAlarmMuted ? 'Muteada' : 'Activa'}\n                                                        </span>\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {orders.length === 0 ? (\n                                                <div className=\"text-center py-20 border border-dashed border-slate-800 rounded-[3rem] bg-slate-900/20\">\n                                                    <ShoppingBag className=\"w-20 h-20 mx-auto mb-4 text-slate-700\" />\n                                                    <p className=\"text-xl text-slate-500 font-bold\">No hay pedidos registrados aún.</p>\n                                                </div>\n                                            ) : (\n                                                <div className=\"space-y-4\">\n                                                    {orders.map((o, idx) => (\n                                                        <div\n                                                            key={o.id}\n                                                            style={{ animationDelay: `${idx * 0.05}s` }}\n                                                            className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col lg:flex-row justify-between items-center gap-6 hover:border-slate-700 transition group animate-fade-up\"\n                                                        >\n                                                            {/* Info Principal */}\n                                                            <div className=\"flex-1 w-full lg:w-auto\">\n                                                                <div className=\"flex items-center gap-4 mb-2\">\n                                                                    <span className=\"bg-slate-900 text-orange-400 px-3 py-1 rounded-lg text-sm font-black tracking-widest border border-slate-800\">\n                                                                        #{o.orderId}\n                                                                    </span>\n                                                                    <span className={`text-[10px] px-2 py-1 rounded-full uppercase font-bold border ${o.status === 'Realizado' ? 'bg-green-900/20 text-green-400 border-green-500/30' : 'bg-yellow-900/20 text-yellow-400 border-yellow-500/30'}`}>\n                                                                        {o.status}\n                                                                    </span>\n                                                                </div>\n                                                                <h4 className=\"text-white font-bold text-lg mb-1\">{o.customer.name}</h4>\n                                                                <p className=\"text-slate-500 text-xs flex items-center gap-2\">\n                                                                    <Clock className=\"w-3 h-3\" /> {new Date(o.date).toLocaleString()}\n                                                                    <span className=\"w-1 h-1 bg-slate-700 rounded-full\"></span>\n                                                                    <span className=\"text-slate-400 font-mono\">${o.total.toLocaleString()}</span>\n                                                                </p>\n                                                            </div>\n\n                                                            {/* Items Preview */}\n                                                            <div className=\"flex -space-x-2\">\n                                                                {o.items.slice(0, 4).map((i, idx) => (\n                                                                    <div key={idx} className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center overflow-hidden\" title={i.title}>\n                                                                        {i.image ? <img src={i.image} className=\"w-full h-full object-cover\" /> : <Package className=\"w-4 h-4 text-slate-500\" />}\n                                                                    </div>\n                                                                ))}\n                                                                {o.items.length > 4 && (\n                                                                    <div className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center text-xs text-white font-bold\">\n                                                                        +{o.items.length - 4}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Acciones */}\n                                                            <div className=\"flex items-center gap-3 w-full lg:w-auto justify-end\">\n                                                                <button onClick={() => setSelectedOrder(o)} className=\"p-3 bg-slate-900 hover:bg-slate-800 text-slate-300 hover:text-white rounded-xl transition border border-slate-800\" title=\"Ver Detalles\">\n                                                                    <Eye className=\"w-5 h-5\" />\n                                                                </button>\n\n                                                                {o.status !== 'Realizado' && (\n                                                                    <button onClick={() => finalizeOrderFn(o.id)} className=\"p-3 bg-green-900/10 hover:bg-green-600 text-green-500 hover:text-white rounded-xl transition border border-green-500/20\" title=\"Marcar como Finalizado\">\n                                                                        <CheckCircle className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                )}\n\n                                                                <button onClick={() => deleteOrderFn(o.id)} className=\"p-3 bg-red-900/10 hover:bg-red-600 text-red-500 hover:text-white rounded-xl transition border border-red-500/20\" title=\"Eliminar Pedido\">\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    ))}\n\n                                                    {/* Paginación */}\n                                                    <div className=\"flex items-center justify-center gap-4 mt-10 pb-10\">\n                                                        <button\n                                                            onClick={handlePrevOrders}\n                                                            disabled={ordersHistory.length === 0}\n                                                            className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition ${ordersHistory.length === 0 ? 'bg-slate-900 text-slate-700 cursor-not-allowed' : 'bg-slate-800 text-white hover:bg-slate-700'}`}\n                                                        >\n                                                            <ChevronLeft className=\"w-5 h-5\" /> Anterior\n                                                        </button>\n                                                        <span className=\"text-slate-500 font-mono text-sm\">\n                                                            Página {ordersHistory.length + 1}\n                                                        </span>\n                                                        <button\n                                                            onClick={handleNextOrders}\n                                                            disabled={!hasMoreOrders || orders.length < ordersLimit}\n                                                            className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition ${(!hasMoreOrders || orders.length < ordersLimit) ? 'bg-slate-900 text-slate-700 cursor-not-allowed' : 'bg-orange-600 text-white hover:bg-orange-500'}`}\n                                                        >\n                                                            Siguiente <ChevronRight className=\"w-5 h-5\" />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PRODUCTOS (LISTA Y FORMULARIO) */}\n                                    {adminTab === 'products' && (\n                                        <div className=\"max-w-7xl mx-auto animate-fade-in pb-20\">\n                                            <div className=\"flex justify-between items-center mb-8\">\n                                                <div>\n                                                    <h1 className=\"text-3xl font-black text-white\">Inventario</h1>\n                                                    {(() => {\n                                                        const plan = settings?.subscriptionPlan || 'entrepreneur';\n                                                        const limit = plan === 'premium' ? '∞' : plan === 'business' ? 50 : 30;\n                                                        const current = products.length;\n                                                        const isNearLimit = plan !== 'premium' && current >= limit * 0.8;\n                                                        return (\n                                                            <p className={`text-sm font-bold mt-1 ${isNearLimit ? 'text-yellow-400' : 'text-slate-500'}`}>\n                                                                {current} / {limit} productos\n                                                                {isNearLimit && plan !== 'premium' && <span className=\"text-yellow-500 ml-2\">⚠ Cerca del límite</span>}\n                                                            </p>\n                                                        );\n                                                    })()}\n                                                </div>\n                                                <div className=\"flex gap-2\">\n                                                    <AdminHowToUse guideKey=\"products\" />\n                                                    <button onClick={() => setShowCategoryModal(true)} className=\"bg-slate-800 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-slate-700 transition transform hover:scale-105 active:scale-95 border border-slate-700\">\n                                                        <FolderPlus className=\"w-5 h-5\" /> Categorías\n                                                    </button>\n                                                    <button onClick={() => { setNewProduct({}); setEditingId(null); setShowProductForm(true) }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:scale-105 active:scale-95\">\n                                                        <Plus className=\"w-5 h-5\" /> Agregar Producto\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* Banner de advertencia si hay productos desactivados por límite de plan */}\n                                            {(() => {\n                                                const deactivatedByPlan = products.filter(p => p.isActive === false && p.deactivatedByPlan);\n                                                const deactivatedManually = products.filter(p => p.isActive === false && !p.deactivatedByPlan);\n                                                const totalDeactivated = products.filter(p => p.isActive === false);\n\n                                                if (totalDeactivated.length > 0) {\n                                                    return (\n                                                        <div className=\"bg-yellow-900/20 border border-yellow-500/30 p-4 rounded-2xl mb-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n                                                            <div className=\"flex items-start gap-3\">\n                                                                <AlertTriangle className=\"w-6 h-6 text-yellow-400 flex-shrink-0 mt-0.5\" />\n                                                                <div>\n                                                                    <p className=\"font-bold text-yellow-400\">\n                                                                        {totalDeactivated.length} producto(s) desactivado(s)\n                                                                    </p>\n                                                                    <p className=\"text-sm text-yellow-200/70\">\n                                                                        {deactivatedByPlan.length > 0 && `${deactivatedByPlan.length} por límite de plan. `}\n                                                                        {deactivatedManually.length > 0 && `${deactivatedManually.length} desactivado(s) manualmente. `}\n                                                                        Los productos desactivados no se muestran en la tienda.\n                                                                    </p>\n                                                                </div>\n                                                            </div>\n                                                            <button\n                                                                onClick={() => showToast(\"Usa el botón de ojo (👁) en cada producto para activar/desactivar\", \"info\")}\n                                                                className=\"px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-xl font-bold text-sm hover:bg-yellow-500/30 transition border border-yellow-500/30 whitespace-nowrap\"\n                                                            >\n                                                                Ver desactivados\n                                                            </button>\n                                                        </div>\n                                                    );\n                                                }\n                                                return null;\n                                            })()}\n\n                                            {/* Formulario Productos (Expandido) */}\n                                            {showProductForm && (\n                                                <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl relative\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6\">\n                                                        {editingId ? 'Editar Producto' : 'Nuevo Producto'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                        <div className=\"space-y-4\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Producto\" value={newProduct.name || ''} onChange={e => setNewProduct({ ...newProduct, name: e.target.value })} />\n                                                            <div className=\"flex gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Precio Venta ($)\" value={newProduct.basePrice || ''} onChange={e => setNewProduct({ ...newProduct, basePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Costo Compra ($)\" value={newProduct.purchasePrice || ''} onChange={e => setNewProduct({ ...newProduct, purchasePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Stock\" value={newProduct.stock || ''} onChange={e => setNewProduct({ ...newProduct, stock: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"space-y-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2\">\n                                                                    Categorías (Selecciona una o más)\n                                                                </label>\n                                                                <div className=\"bg-slate-900/50 border border-slate-700 rounded-xl p-4 max-h-64 overflow-y-auto custom-scrollbar\">\n                                                                    {(settings?.categories || []).length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 py-4 text-sm\">\n                                                                            No hay categorías disponibles. Agrégalas abajo.\n                                                                        </p>\n                                                                    ) : (\n                                                                        (settings?.categories || []).map(cat => {\n                                                                            // Soporte retrocompatible: verificar tanto categories (array) como category (string)\n                                                                            const isSelected = Array.isArray(newProduct.categories)\n                                                                                ? newProduct.categories.includes(cat)\n                                                                                : (newProduct.category === cat);\n\n                                                                            return (\n                                                                                <label\n                                                                                    key={cat}\n                                                                                    className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all group hover:bg-slate-800 mb-2 last:mb-0 ${isSelected ? 'bg-orange-900/20 border border-orange-500/30' : 'border border-transparent'\n                                                                                        }`}\n                                                                                >\n                                                                                    <input\n                                                                                        type=\"checkbox\"\n                                                                                        checked={isSelected}\n                                                                                        onChange={(e) => {\n                                                                                            if (e.target.checked) {\n                                                                                                // Agregar categoría\n                                                                                                const current = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories\n                                                                                                    : (newProduct.category ? [newProduct.category] : []);\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: [...current, cat],\n                                                                                                    category: undefined // Eliminar el campo antiguo\n                                                                                                });\n                                                                                            } else {\n                                                                                                // Remover categoría\n                                                                                                const updated = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories.filter(c => c !== cat)\n                                                                                                    : [];\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: updated\n                                                                                                });\n                                                                                            }\n                                                                                        }}\n                                                                                        className=\"w-4 h-4 text-orange-600 bg-slate-900 border-slate-600 rounded focus:ring-orange-500 focus:ring-2\"\n                                                                                    />\n                                                                                    <span className={`flex-1 text-sm font-medium transition-colors ${isSelected ? 'text-orange-400' : 'text-slate-300 group-hover:text-white'\n                                                                                        }`}>\n                                                                                        {cat}\n                                                                                    </span>\n                                                                                    {isSelected && (\n                                                                                        <span className=\"text-xs font-bold text-orange-500 bg-orange-500/10 px-2 py-0.5 rounded flex items-center gap-1\">\n                                                                                            <CheckCircle className=\"w-3 h-3\" />\n                                                                                        </span>\n                                                                                    )}\n                                                                                </label>\n                                                                            );\n                                                                        })\n                                                                    )}\n                                                                </div>\n                                                                {/* Mostrar categorías seleccionadas como tags */}\n                                                                {newProduct.categories && newProduct.categories.length > 0 && (\n                                                                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                                                                        {newProduct.categories.map(cat => (\n                                                                            <span\n                                                                                key={cat}\n                                                                                className=\"bg-orange-500/20 text-orange-400 text-xs font-bold px-3 py-1.5 rounded-full border border-orange-500/30 flex items-center gap-2\"\n                                                                            >\n                                                                                {cat}\n                                                                                <button\n                                                                                    type=\"button\"\n                                                                                    onClick={() => {\n                                                                                        setNewProduct({\n                                                                                            ...newProduct,\n                                                                                            categories: newProduct.categories.filter(c => c !== cat)\n                                                                                        });\n                                                                                    }}\n                                                                                    className=\"hover:text-orange-300 transition\"\n                                                                                >\n                                                                                    <X className=\"w-3 h-3\" />\n                                                                                </button>\n                                                                            </span>\n                                                                        ))}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <button\n                                                                type=\"button\"\n                                                                onClick={() => setShowCategoryModal(true)}\n                                                                className=\"w-full mt-2 py-2 bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 rounded-xl font-bold transition flex items-center justify-center gap-2 text-sm border border-orange-800\"\n                                                            >\n                                                                <FolderPlus className=\"w-4 h-4\" /> Nueva Categoría\n                                                            </button>\n                                                        </div>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Imagen del Producto\n                                                                </label>\n                                                                <div className=\"space-y-3\">\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewProduct)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newProduct.image && (\n                                                                        <div className=\"bg-white rounded-xl p-3 w-32 h-32\">\n                                                                            <img src={newProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Descuento (%)\n                                                                </label>\n                                                                <p className=\"text-xs text-slate-400 mb-2\">Porcentaje de descuento sobre el precio base (0-100)</p>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    min=\"0\"\n                                                                    max=\"100\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"0\"\n                                                                    value={newProduct.discount || 0}\n                                                                    onChange={e => setNewProduct({ ...newProduct, discount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <textarea className=\"input-cyber w-full h-32 p-4 mb-6 resize-none\" placeholder=\"Descripción detallada del producto...\" value={newProduct.description || ''} onChange={e => setNewProduct({ ...newProduct, description: e.target.value })} />\n\n                                                    <div className=\"flex gap-4 justify-end\">\n                                                        <button onClick={() => setShowProductForm(false)} className=\"px-6 py-3 text-slate-400 font-bold hover:text-white transition\">Cancelar</button>\n                                                        <button onClick={saveProductFn} className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\">Guardar Producto</button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Productos */}\n                                            <div className=\"grid gap-3\">\n                                                {products.map((p, idx) => (\n                                                    <div\n                                                        key={p.id}\n                                                        style={{ animationDelay: `${idx * 0.05}s` }}\n                                                        className={`bg-[#0a0a0a] border p-4 rounded-xl flex flex-col sm:flex-row justify-between items-center group hover:border-orange-900/50 transition animate-fade-up ${p.isActive === false ? 'border-yellow-500/30 opacity-60' : 'border-slate-800'}`}\n                                                    >\n                                                        <div className=\"flex items-center gap-6 w-full sm:w-auto\">\n                                                            <div className={`w-16 h-16 bg-white rounded-lg p-2 flex-shrink-0 relative ${p.isActive === false ? 'grayscale' : ''}`}>\n                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                {p.isFeatured && (\n                                                                    <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg\">\n                                                                        <Star className=\"w-3 h-3 text-black fill-current\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-lg flex items-center gap-2\">\n                                                                    {p.name}\n                                                                    {p.isFeatured && <span className=\"text-[10px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full font-bold\">DESTACADO</span>}\n                                                                    {p.isActive === false && <span className=\"text-[10px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full font-bold\">OCULTO{p.deactivatedByPlan ? ' (LÍMITE)' : ''}</span>}\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-500 font-mono\">\n                                                                    Stock: <span className={(p.stock || 0) < (settings?.lowStockThreshold || 5) ? 'text-red-400 font-bold animate-pulse' : 'text-slate-400'}>{p.stock || 0}</span> |\n                                                                    <span className=\"text-orange-400 font-bold ml-2\" title=\"Precio Venta\">${Number(p.basePrice).toLocaleString()}</span> |\n                                                                    <span className=\"text-slate-500 ml-2 font-mono\" title=\"Costo Adquisición\">Costo: ${Number(p.purchasePrice || 0).toLocaleString()}</span>\n                                                                    {Number(p.basePrice) > 0 && (\n                                                                        <span className={`ml-2 text-[10px] font-black px-1.5 py-0.5 rounded border ${((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) < 0.3 ? 'bg-red-900/20 text-red-400 border-red-500/20' : 'bg-green-900/20 text-green-400 border-green-500/20'}`}>\n                                                                            {(((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) * 100).toFixed(0)}%\n                                                                        </span>\n                                                                    )} |\n                                                                    <span className=\"text-green-400 ml-2\">Ventas: {(dashboardMetrics?.salesCount?.[p.id] || 0)}</span>\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto justify-end items-center\">\n                                                            {/* Toggle Featured */}\n                                                            <button\n                                                                onClick={async () => {\n                                                                    try {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', p.id), {\n                                                                            isFeatured: !p.isFeatured\n                                                                        });\n                                                                        showToast(p.isFeatured ? \"Producto quitado de destacados\" : \"Producto marcado como destacado\", \"success\");\n                                                                    } catch (e) {\n                                                                        console.error(e);\n                                                                        showToast(\"Error al actualizar\", \"error\");\n                                                                    }\n                                                                }}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isFeatured ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30 hover:bg-yellow-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-yellow-400 hover:border-yellow-500/30'}`}\n                                                                title={p.isFeatured ? \"Quitar de Destacados\" : \"Marcar como Destacado\"}\n                                                            >\n                                                                <Star className={`w-5 h-5 ${p.isFeatured ? 'fill-current' : ''}`} />\n                                                            </button>\n                                                            {/* Toggle Activar/Desactivar */}\n                                                            <button\n                                                                onClick={() => p.isActive === false ? reactivateProduct(p.id) : deactivateProduct(p.id)}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isActive === false ? 'bg-red-500/20 text-red-400 border-red-500/30 hover:bg-green-500/20 hover:text-green-400 hover:border-green-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-red-400 hover:border-red-500/30'}`}\n                                                                title={p.isActive === false ? \"Activar Producto (hacerlo visible en tienda)\" : \"Desactivar Producto (ocultarlo de la tienda)\"}\n                                                            >\n                                                                {p.isActive === false ? <Eye className=\"w-5 h-5\" /> : <EyeOff className=\"w-5 h-5\" />}\n                                                            </button>\n                                                            <button onClick={() => openManualSaleModal(p)} className=\"p-3 bg-slate-900 rounded-xl text-green-400 hover:bg-green-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\" title=\"Venta Manual (Descontar 1)\">\n                                                                <DollarSign className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => { setNewProduct(p); setEditingId(p.id); setShowProductForm(true) }} className=\"p-3 bg-slate-900 rounded-xl text-orange-400 hover:bg-orange-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Edit className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => deleteProductFn(p)} className=\"p-3 bg-slate-900 rounded-xl text-red-400 hover:bg-red-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n\n\n                                    {/* TAB: CONFIGURACIÓN AVANZADA (NEW) */}\n                                    {adminTab === 'settings' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Developer-Only Access Block */}\n                                            {currentUser?.email !== SUPER_ADMIN_EMAIL && (\n                                                <div className=\"absolute inset-0 z-30 flex items-center justify-center bg-black/90 backdrop-blur-md rounded-[2.5rem]\">\n                                                    <div className=\"text-center p-8 max-w-lg\">\n                                                        <div className=\"w-24 h-24 mx-auto mb-6 bg-red-500/20 rounded-full flex items-center justify-center border border-red-500/30\">\n                                                            <Shield className=\"w-12 h-12 text-red-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-3xl font-black text-white mb-4\">Acceso Restringido</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Esta sección está reservada únicamente para el <span className=\"text-orange-400 font-bold\">desarrollador</span> de la plataforma.</p>\n                                                        <div className=\"bg-slate-900/50 p-4 rounded-xl border border-slate-800 mb-6\">\n                                                            <p className=\"text-sm text-slate-500 mb-2\">Para solicitar cambios en la configuración, contacta a:</p>\n                                                            <p className=\"text-orange-400 font-bold text-lg\">lautarocorazza63@gmail.com</p>\n                                                        </div>\n                                                        <p className=\"text-xs text-slate-600\">Si necesitas modificar tu tienda, envía un email detallando los cambios que deseas realizar.</p>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            <h1 className=\"text-4xl font-black text-white neon-text mb-8 flex items-center gap-3\">\n                                                <Settings className=\"w-8 h-8 text-orange-500 animate-spin-slow\" /> Configuración General\n                                            </h1>\n\n                                            {/* Sub-Navigation Tabs */}\n                                            <div className=\"flex flex-wrap gap-2 mb-8 pb-4 border-b border-slate-800\">\n                                                {[\n                                                    { id: 'store', label: 'Tienda', icon: Store },\n                                                    { id: 'appearance', label: 'Apariencia', icon: Palette },\n                                                    { id: 'social', label: 'Redes', icon: Share2 },\n                                                    { id: 'payments', label: 'Pagos', icon: CreditCard },\n                                                    { id: 'ticket', label: 'Ticket', icon: Ticket },\n                                                    { id: 'shipping', label: 'Envíos', icon: Truck },\n                                                    { id: 'seo', label: 'SEO', icon: Globe },\n                                                    { id: 'advanced', label: 'Avanzado', icon: Cog },\n                                                    { id: 'team', label: 'Equipo', icon: Users },\n                                                    // Only show Subscription tab to Super Admin\n                                                    ...(currentUser?.email === SUPER_ADMIN_EMAIL ? [{ id: 'subscription', label: 'Suscripciones', icon: Zap }] : [])\n                                                ].map(tab => (\n                                                    <button\n                                                        key={tab.id}\n                                                        onClick={() => setSettingsTab(tab.id)}\n                                                        className={`px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 transition-all duration-300 border ${settingsTab === tab.id ? 'bg-orange-600 text-white shadow-[0_0_20px_rgba(8,145,178,0.4)] border-orange-400 transform scale-105' : 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800'}`}\n                                                    >\n                                                        <tab.icon className={`w-4 h-4 ${settingsTab === tab.id ? 'animate-pulse' : ''}`} /> {tab.label}\n                                                    </button>\n                                                ))}\n                                            </div>\n\n                                            {/* === SUBSCRIPTION MANAGEMENT (SUPER ADMIN ONLY) === */}\n                                            {settingsTab === 'subscription' && currentUser?.email === SUPER_ADMIN_EMAIL && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] shadow-[0_0_50px_rgba(249,115,22,0.1)]\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 flex items-center gap-3\">\n                                                            <Zap className=\"w-6 h-6 text-yellow-500 fill-current\" />\n                                                            Modelos de Suscripción\n                                                        </h3>\n\n                                                        <div className=\"mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl flex items-center gap-4\">\n                                                            <AlertTriangle className=\"w-8 h-8 text-yellow-500\" />\n                                                            <div>\n                                                                <p className=\"font-bold text-yellow-500\">Zona de Peligro: Super Admin</p>\n                                                                <p className=\"text-sm text-yellow-200\">Cambiar el plan afecta inmediatamente los límites y funcionalidades de la tienda.</p>\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"mb-8 p-6 bg-slate-900/40 border border-slate-800 rounded-2xl\">\n                                                            <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                                                                <div>\n                                                                    <p className=\"text-white font-black text-lg\">Backup de Tienda</p>\n                                                                    <p className=\"text-slate-500 text-xs font-mono\">storeId: {appId || '—'}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-2\">\n                                                                    <button\n                                                                        disabled={isExportingBackup || !appId}\n                                                                        onClick={exportBackup}\n                                                                        className=\"px-4 py-3 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 font-black text-[10px] uppercase tracking-widest hover:bg-green-500/20 transition disabled:opacity-50\"\n                                                                    >\n                                                                        {isExportingBackup ? 'Exportando…' : 'Exportar'}\n                                                                    </button>\n                                                                    <label className={`px-4 py-3 rounded-xl bg-indigo-600/20 border border-indigo-500/30 text-indigo-200 font-black text-[10px] uppercase tracking-widest hover:bg-indigo-600/30 transition ${isImportingBackup || !appId ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                        {isImportingBackup ? 'Importando…' : 'Importar'}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"application/json\"\n                                                                            className=\"hidden\"\n                                                                            onChange={(e) => {\n                                                                                const file = e.target.files && e.target.files[0];\n                                                                                if (file) importBackupFile(file);\n                                                                                e.target.value = '';\n                                                                            }}\n                                                                        />\n                                                                    </label>\n                                                                </div>\n                                                            </div>\n                                                            <p className=\"text-slate-600 text-xs mt-4\">Importar escribe con merge (no borra por defecto). Usalo con cuidado.</p>\n                                                        </div>\n\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            {/* Plan Emprendedor */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('entrepreneur')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan ? 'bg-slate-900 border-orange-500 shadow-[0_0_30px_rgba(249,115,22,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Store className=\"w-6 h-6 text-orange-400\" />\n                                                                    </div>\n                                                                    {(settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan) && <div className=\"bg-orange-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Emprendedor</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">El esencial para arrancar sólido pero económico.</p>\n                                                                <div className=\"text-2xl font-black text-orange-400 mb-6\">$7.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Hasta 30 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Dominio Vercel</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Mercado Pago Directo</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Negocio */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('business')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'business' ? 'bg-slate-900 border-purple-500 shadow-[0_0_30px_rgba(168,85,247,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Briefcase className=\"w-6 h-6 text-purple-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'business' && <div className=\"bg-purple-500 text-white text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Negocio</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Para marcas con identidad definida.</p>\n                                                                <div className=\"text-2xl font-black text-purple-400 mb-6\">$14.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Hasta 50 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Personalización Visual</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Botón WhatsApp</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Premium */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('premium')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'premium' ? 'bg-slate-900 border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Sparkles className=\"w-6 h-6 text-yellow-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'premium' && <div className=\"bg-yellow-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Premium</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Servicio Full con IA.</p>\n                                                                <div className=\"text-2xl font-black text-yellow-400 mb-6\">$22.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Ilimitado / Full IA</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Carga Inicial (10)</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Mantenimiento Mensual</li>\n                                                                </ul>\n                                                            </button>\n                                                        </div>\n\n                                                        {/* Billing Cycle Selection */}\n                                                        <div className=\"mt-8 pt-8 border-t border-slate-800/50\">\n                                                            <h4 className=\"text-lg font-bold text-slate-300 mb-4 flex items-center gap-2\">\n                                                                <Calendar className=\"w-5 h-5 text-green-400\" /> Ciclo de Facturación\n                                                            </h4>\n                                                            <div className=\"grid grid-cols-3 gap-4\">\n                                                                {[\n                                                                    { id: 'Semanal', label: 'Semanal' },\n                                                                    { id: 'Mensual', label: 'Mensual' },\n                                                                    { id: 'Anual', label: 'Anual' }\n                                                                ].map(cycle => (\n                                                                    <button\n                                                                        key={cycle.id}\n                                                                        onClick={() => setSettings({ ...settings, subscriptionBillingCycle: cycle.id })}\n                                                                        className={`p-3 rounded-xl border transition-all font-bold ${settings?.subscriptionBillingCycle === cycle.id\n                                                                            ? 'bg-green-500 text-black border-green-400 shadow-lg shadow-green-500/20'\n                                                                            : 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800'\n                                                                            }`}\n                                                                    >\n                                                                        {cycle.label}\n                                                                    </button>\n                                                                ))}\n                                                            </div>\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Define la frecuencia de cobro para este plan.</p>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'store' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Información de la Tienda\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre de la Tienda</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeName || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeName: e.target.value })}\n                                                                    placeholder=\"Mi Tienda\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Email de Contacto</label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeEmail || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                    placeholder=\"contacto@mitienda.com\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Teléfono</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storePhone || ''}\n                                                                    onChange={e => setSettings({ ...settings, storePhone: e.target.value })}\n                                                                    placeholder=\"+54 11 1234-5678\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Dirección</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeAddress || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeAddress: e.target.value })}\n                                                                    placeholder=\"Av. Corrientes 1234, CABA\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripción de la Tienda</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-24 resize-none\"\n                                                                value={settings?.storeDescription || ''}\n                                                                onChange={e => setSettings({ ...settings, storeDescription: e.target.value })}\n                                                                placeholder=\"Breve descripción de tu tienda...\"\n                                                            />\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto de Nosotros</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-32 resize-none\"\n                                                                value={settings?.aboutUsText || ''}\n                                                                onChange={e => setSettings({ ...settings, aboutUsText: e.target.value })}\n                                                                placeholder=\"Historia de tu marca, valores, misión...\"\n                                                            />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Copyright Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-orange-400\" /> Textos de Copyright\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Menú Lateral</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.menuCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, menuCopyright: e.target.value })}\n                                                                    placeholder={`${settings?.storeName || 'Mi Tienda'} © ${new Date().getFullYear()}`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece al final del menú hamburguesa</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Footer</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerCopyright: e.target.value })}\n                                                                    placeholder={`© ${new Date().getFullYear()} ${settings?.storeName || 'Mi Tienda'}. All rights reserved.`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en la barra inferior del sitio</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Guía \"Cómo Comprar\" Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileQuestion className=\"w-5 h-5 text-orange-400\" /> Guía \"Cómo Comprar\"\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar la página */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar en Menú</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar enlace \"Cómo Comprar\" en el menú lateral</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showGuideLink: settings?.showGuideLink === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showGuideLink !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideLink !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Título de la página */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título de la Página</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.guideTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, guideTitle: e.target.value })}\n                                                                    placeholder=\"Cómo Comprar\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Paso 1 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">1</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 1</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep1: settings?.showGuideStep1 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep1 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Title: e.target.value })}\n                                                                        placeholder=\"Selecciona Productos\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Text: e.target.value })}\n                                                                        placeholder=\"Descripción del paso...\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 2 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">2</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 2</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep2: settings?.showGuideStep2 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep2 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep2 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Title: e.target.value })}\n                                                                        placeholder=\"Revisa tu Carrito\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Text: e.target.value })}\n                                                                        placeholder=\"Descripción del paso...\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 3 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">3</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 3</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep3: settings?.showGuideStep3 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep3 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep3 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Title: e.target.value })}\n                                                                        placeholder=\"Datos de Envío\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Text: e.target.value })}\n                                                                        placeholder=\"Descripción del paso...\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 4 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">4</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 4</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep4: settings?.showGuideStep4 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep4 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep4 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep4 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Title: e.target.value })}\n                                                                        placeholder=\"Pago y Confirmación\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Text: e.target.value })}\n                                                                        placeholder=\"Descripción del paso...\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 5 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">5</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 5</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep5: settings?.showGuideStep5 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep5 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep5 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep5 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Title: e.target.value })}\n                                                                        placeholder=\"¡Listo!\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Text: e.target.value })}\n                                                                        placeholder=\"Descripción del paso...\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Bell className=\"w-5 h-5 text-yellow-400\" /> Anuncios\n                                                        </h3>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Anuncio (Banner superior)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={settings?.announcementMessage || ''}\n                                                                onChange={e => setSettings({ ...settings, announcementMessage: e.target.value })}\n                                                                placeholder=\"🔥 ¡Envío gratis en compras mayores a $50.000!\"\n                                                            />\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Dejar vacío para ocultar el banner.</p>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Zap className=\"w-5 h-5 text-yellow-500\" /> Pantalla de Carga\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingTitle: e.target.value })}\n                                                                    placeholder={settings?.storeName || \"SUSTORE\"}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en grande (ej. SUSTORE).</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Texto pequeño debajo del título.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === APPEARANCE === */}\n                                            {settingsTab === 'appearance' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Imágenes\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen Hero (Banner Principal)</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Logo de la Tienda</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'logoUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                />\n                                                                {settings?.logoUrl && (\n                                                                    <div className=\"mt-4 w-24 h-24 rounded-xl overflow-hidden border border-slate-700 bg-white p-2\">\n                                                                        <img src={settings.logoUrl} className=\"w-full h-full object-contain\" alt=\"Logo Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Play className=\"w-5 h-5 text-orange-400\" /> Carrusel Home\n                                                        </h3>\n\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Mostrar carrusel</p>\n                                                                        <p className=\"text-xs text-slate-500\">Si está apagado, se usa la imagen Hero tradicional.</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showHomeBannerCarousel: settings?.showHomeBannerCarousel === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.showHomeBannerCarousel !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showHomeBannerCarousel !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cambio automático (segundos)</label>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        min=\"1\"\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={Number.isFinite(Number(settings?.homeBannerAutoplayMs)) ? Math.max(1, Math.round(Number(settings.homeBannerAutoplayMs) / 1000)) : 5}\n                                                                        onChange={(e) => {\n                                                                            const seconds = Number(e.target.value);\n                                                                            const safeSeconds = Number.isFinite(seconds) ? Math.max(1, seconds) : 5;\n                                                                            setSettings({ ...settings, homeBannerAutoplayMs: Math.round(safeSeconds * 1000) });\n                                                                        }}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                                                                <div className=\"lg:col-span-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen del slide</label>\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewHomeBanner, 'imageUrl', 1400)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newHomeBanner?.imageUrl && (\n                                                                        <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-28\">\n                                                                            <img src={newHomeBanner.imageUrl} className=\"w-full h-full object-cover\" alt=\"Banner preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n\n                                                                <div className=\"lg:col-span-2 space-y-4\">\n                                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Acción al hacer click</label>\n                                                                            <select\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={newHomeBanner?.targetType || 'none'}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetType: e.target.value, targetId: '' }))}\n                                                                            >\n                                                                                <option value=\"none\">Solo mostrar (sin link)</option>\n                                                                                <option value=\"product\">Abrir producto</option>\n                                                                                <option value=\"promo\">Abrir promo</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Orden (0 = primero)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={Number.isFinite(Number(newHomeBanner?.order)) ? Number(newHomeBanner.order) : 0}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, order: e.target.value }))}\n                                                                            />\n                                                                            <p className=\"text-xs text-slate-500 mt-2\">Menor número aparece primero (0, 1, 2...).</p>\n                                                                        </div>\n                                                                    </div>\n\n                                                                    {newHomeBanner?.targetType !== 'none' && (\n                                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                            <div>\n                                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                                    {newHomeBanner?.targetType === 'promo' ? 'Promo al hacer click' : 'Producto al hacer click'}\n                                                                                </label>\n                                                                                <select\n                                                                                    className=\"input-cyber w-full p-3\"\n                                                                                    value={newHomeBanner?.targetId || ''}\n                                                                                    onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetId: e.target.value }))}\n                                                                                >\n                                                                                    <option value=\"\">Seleccionar...</option>\n                                                                                    {(newHomeBanner?.targetType === 'promo' ? [...promos] : [...products])\n                                                                                        .sort((a, b) => (a?.name || '').localeCompare(b?.name || ''))\n                                                                                        .map(item => (\n                                                                                            <option key={item.id} value={item.id}>{item.name}</option>\n                                                                                        ))}\n                                                                                </select>\n                                                                            </div>\n                                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 flex items-center gap-4\">\n                                                                                {(() => {\n                                                                                    const isPromo = newHomeBanner?.targetType === 'promo';\n                                                                                    const item = isPromo\n                                                                                        ? promos.find(p => p.id === newHomeBanner?.targetId)\n                                                                                        : products.find(p => p.id === newHomeBanner?.targetId);\n                                                                                    const img = isPromo ? item?.image : item?.image;\n                                                                                    return (\n                                                                                        <>\n                                                                                            <div className=\"w-16 h-16 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                                {img ? <img src={img} className=\"w-full h-full object-cover\" alt=\"Preview\" /> : <ImageIcon className=\"w-6 h-6 text-slate-600\" />}\n                                                                                            </div>\n                                                                                            <div className=\"min-w-0\">\n                                                                                                <p className=\"text-xs text-slate-500 font-bold uppercase tracking-wider\">Vista previa</p>\n                                                                                                <p className=\"font-black text-white truncate\">{item?.name || 'Sin selección'}</p>\n                                                                                            </div>\n                                                                                        </>\n                                                                                    );\n                                                                                })()}\n                                                                            </div>\n                                                                        </div>\n                                                                    )}\n\n                                                                    <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\n                                                                        <div className=\"flex items-center justify-between flex-1 p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                            <div>\n                                                                                <p className=\"font-bold text-white\">Slide habilitado</p>\n                                                                                <p className=\"text-xs text-slate-500\">Si está apagado no se muestra.</p>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewHomeBanner(prev => ({ ...prev, enabled: prev?.enabled === false ? true : false }))}\n                                                                                className={`w-14 h-8 rounded-full transition relative ${newHomeBanner?.enabled !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                            >\n                                                                                <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${newHomeBanner?.enabled !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                            </button>\n                                                                        </div>\n\n                                                                        <div className=\"flex gap-3\">\n                                                                            {editingHomeBannerId && (\n                                                                                <button\n                                                                                    onClick={resetHomeBannerForm}\n                                                                                    className=\"px-6 py-3 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition\"\n                                                                                >\n                                                                                    Cancelar\n                                                                                </button>\n                                                                            )}\n                                                                            <button\n                                                                                onClick={saveHomeBannerFn}\n                                                                                className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\"\n                                                                            >\n                                                                                {editingHomeBannerId ? 'Guardar Slide' : 'Agregar Slide'}\n                                                                            </button>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"space-y-3\">\n                                                                {homeBanners.length === 0 ? (\n                                                                    <p className=\"text-slate-500 text-sm\">Todavía no hay slides en el carrusel.</p>\n                                                                ) : (\n                                                                    homeBanners.map(b => {\n                                                                        const targetType = b.targetType || (b.promoId ? 'promo' : b.productId ? 'product' : 'none');\n                                                                        const targetId = b.targetId || b.promoId || b.productId || '';\n                                                                        const targetItem = targetType === 'promo'\n                                                                            ? promos.find(p => p.id === targetId)\n                                                                            : targetType === 'product'\n                                                                                ? products.find(p => p.id === targetId)\n                                                                                : null;\n                                                                        const targetName = targetType === 'none'\n                                                                            ? 'Solo imagen'\n                                                                            : targetItem?.name || (targetType === 'promo' ? 'Promo inexistente' : 'Producto inexistente');\n                                                                        const isEnabled = b?.enabled !== false;\n                                                                        return (\n                                                                            <div key={b.id} className=\"flex flex-col md:flex-row md:items-center gap-4 p-4 bg-slate-900/40 rounded-2xl border border-slate-800\">\n                                                                                <div className=\"w-full md:w-40 h-20 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex-shrink-0\">\n                                                                                    {b?.imageUrl ? (\n                                                                                        <img src={b.imageUrl} className=\"w-full h-full object-cover\" alt=\"Slide\" />\n                                                                                    ) : null}\n                                                                                </div>\n                                                                                <div className=\"flex-1 min-w-0\">\n                                                                                    <div className=\"flex items-center gap-3 flex-wrap\">\n                                                                                        <div className=\"w-10 h-10 rounded-lg overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                            {targetItem?.image ? <img src={targetItem.image} className=\"w-full h-full object-cover\" alt=\"Target\" /> : <ImageIcon className=\"w-4 h-4 text-slate-600\" />}\n                                                                                        </div>\n                                                                                        <p className=\"font-black text-white truncate\">{targetName}</p>\n                                                                                        <span className={`text-[10px] font-black px-2 py-1 rounded-lg border ${isEnabled ? 'text-green-400 border-green-500/30 bg-green-500/10' : 'text-slate-400 border-slate-700 bg-slate-800/30'}`}>\n                                                                                            {isEnabled ? 'ACTIVO' : 'PAUSADO'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            {targetType === 'promo' ? 'PROMO' : targetType === 'product' ? 'PRODUCTO' : 'SIN LINK'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            ORDEN {Number.isFinite(Number(b.order)) ? Number(b.order) : 0}\n                                                                                        </span>\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 mt-1 truncate\">{targetType === 'none' ? 'Click desactivado' : targetId}</p>\n                                                                                </div>\n                                                                                <div className=\"flex items-center gap-2\">\n                                                                                    <button\n                                                                                        onClick={() => editHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                                    </button>\n                                                                                    <button\n                                                                                        onClick={() => deleteHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-red-500/30 text-red-400 hover:bg-red-500/10 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Trash2 className=\"w-4 h-4\" /> Eliminar\n                                                                                    </button>\n                                                                                </div>\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Palette className=\"w-5 h-5 text-pink-400\" /> Colores del Tema\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Primario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Secundario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Acento</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Brand Ticker Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-orange-400\" /> Ticker de Marca\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Ticker</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activar/desactivar la cinta de texto animada.</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Ticker</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.tickerText || ''}\n                                                                    onChange={e => setSettings({ ...settings, tickerText: e.target.value })}\n                                                                    placeholder=\"TECNOLOGÍA • INNOVACIÓN • CALIDAD PREMIUM • FUTURO\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Este texto se repetirá en bucle.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Hero Banner Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Banner Principal (Hero)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Badge/Etiqueta</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.heroBadge || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroBadge: e.target.value })}\n                                                                    placeholder=\"Nueva Colección 2026\"\n                                                                />\n                                                            </div>\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título Línea 1</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle1 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle1: e.target.value })}\n                                                                        placeholder=\"TECNOLOGÍA\"\n                                                                    />\n                                                                </div>\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título Línea 2</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle2 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle2: e.target.value })}\n                                                                        placeholder=\"DEL FUTURO\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Subtítulo</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-20 resize-none\"\n                                                                    value={settings?.heroSubtitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroSubtitle: e.target.value })}\n                                                                    placeholder=\"Explora nuestra selección premium. Calidad garantizada y soporte técnico especializado.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de Fondo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl', 1920)}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Recomendado: 1920x800 px mínimo</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Features Section Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Star className=\"w-5 h-5 text-yellow-400\" /> Beneficios Destacados\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar toda la sección */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Sección de Beneficios</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva toda la sección de beneficios</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFeaturesSection: settings?.showFeaturesSection === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showFeaturesSection !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeaturesSection !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Feature 1 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Zap className=\"w-4 h-4 text-orange-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 1 (Rayo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature1: settings?.showFeature1 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature1 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Title: e.target.value })}\n                                                                        placeholder=\"Envío Ultra Rápido\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Desc: e.target.value })}\n                                                                        placeholder=\"Subtítulo corto...\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 2 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Shield className=\"w-4 h-4 text-purple-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 2 (Escudo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature2: settings?.showFeature2 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature2 !== false ? 'bg-purple-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature2 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Title: e.target.value })}\n                                                                        placeholder=\"Garantía Extendida\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Desc: e.target.value })}\n                                                                        placeholder=\"Subtítulo corto...\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 3 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Headphones className=\"w-4 h-4 text-green-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 3 (Soporte)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature3: settings?.showFeature3 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature3 !== false ? 'bg-green-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature3 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Title: e.target.value })}\n                                                                        placeholder=\"Soporte 24/7\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Desc: e.target.value })}\n                                                                        placeholder=\"Subtítulo corto...\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Contact Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <MessageCircle className=\"w-5 h-5 text-green-400\" /> Sección Contacto (Footer)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Sección</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva la sección de contacto en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFooterContact: settings?.showFooterContact === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showFooterContact !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showFooterContact !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactTitle: e.target.value })}\n                                                                    placeholder=\"Contacto\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripción</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactDescription: e.target.value })}\n                                                                    placeholder=\"¿Tienes alguna duda? Estamos aquí para ayudarte.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Botón</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactButtonText || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactButtonText: e.target.value })}\n                                                                    placeholder=\"Contactar Soporte\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo de Contacto</label>\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactType || 'whatsapp'}\n                                                                    onChange={e => setSettings({ ...settings, footerContactType: e.target.value })}\n                                                                >\n                                                                    <option value=\"whatsapp\">WhatsApp</option>\n                                                                    <option value=\"instagram\">Instagram</option>\n                                                                    <option value=\"email\">Email</option>\n                                                                </select>\n\n                                                                {/* Conditional Input based on Type */}\n                                                                {(!settings?.footerContactType || settings?.footerContactType === 'whatsapp') && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1 block\">Enlace de WhatsApp</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-green-500/30 focus:border-green-500\"\n                                                                            value={settings?.whatsappLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                            placeholder=\"https://wa.me/54911...\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'instagram' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-pink-500 uppercase tracking-wider mb-1 block\">Perfil de Instagram</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-pink-500/30 focus:border-pink-500\"\n                                                                            value={settings?.instagramLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                            placeholder=\"https://instagram.com/usuario\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'email' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-blue-500 uppercase tracking-wider mb-1 block\">Email de Soporte</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-blue-500/30 focus:border-blue-500\"\n                                                                            value={settings?.storeEmail || ''}\n                                                                            onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                            placeholder=\"soporte@tienda.com\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Brand Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Marca en Footer\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Sufijo del Nombre</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerSuffix || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerSuffix: e.target.value })}\n                                                                    placeholder=\".SF\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece junto al nombre de la tienda (ej: SUSTORE.SF)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripción</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-24 resize-none\"\n                                                                    value={settings?.footerDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerDescription: e.target.value })}\n                                                                    placeholder=\"Tu destino premium para tecnología de vanguardia...\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Legal Links Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-slate-400\" /> Links Legales\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Política de Privacidad</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showPrivacyPolicy: settings?.showPrivacyPolicy === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showPrivacyPolicy !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showPrivacyPolicy !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Terms of Service</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showTermsOfService: settings?.showTermsOfService === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showTermsOfService !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showTermsOfService !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'ticket' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Ticket className=\"w-5 h-5 text-orange-400\" /> Ticket / Comprobante\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Estos datos se usan en el comprobante que se envía por email al confirmar la compra.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre que aparece en el ticket</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.brandName || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, brandName: e.target.value } })}\n                                                                    placeholder={settings?.storeName || 'Mi Tienda'}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de WhatsApp (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, whatsappLink: e.target.value } })}\n                                                                    placeholder={settings?.whatsappLink || 'https://wa.me/5491112345678'}\n                                                                />\n                                                            </div>\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de la página (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.siteUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, siteUrl: e.target.value } })}\n                                                                    placeholder={settings?.seoUrl || ''}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SOCIAL MEDIA === */}\n                                            {settingsTab === 'social' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Share2 className=\"w-5 h-5 text-blue-400\" /> Redes Sociales\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Configura los enlaces y activa/desactiva la visibilidad de cada red social en el footer.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            {/* WhatsApp */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <MessageCircle className=\"w-4 h-4 text-green-400\" /> WhatsApp\n                                                                    </label>\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"text-[10px] text-slate-500 font-mono uppercase\">Footer</span>\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, showWhatsapp: !settings?.showWhatsapp })}\n                                                                            className={`w-10 h-5 rounded-full transition relative ${settings?.showWhatsapp === true ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                        >\n                                                                            <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showWhatsapp === true ? '22px' : '2px' }}></div>\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm mb-3\"\n                                                                    value={settings?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                    placeholder=\"https://wa.me/5491112345678\"\n                                                                />\n\n                                                                {/* Floating Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold flex items-center gap-2\">\n                                                                            Botón Flotante\n                                                                            {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                                <Lock className=\"w-3 h-3 text-yellow-500\" />\n                                                                            )}\n                                                                        </p>\n                                                                        {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                            <p className=\"text-[9px] text-yellow-500/80 mt-0.5\">Requiere Plan Negocio</p>\n                                                                        )}\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if (['business', 'premium'].includes(settings?.subscriptionPlan)) {\n                                                                                setSettings({ ...settings, showFloatingWhatsapp: !settings?.showFloatingWhatsapp });\n                                                                            } else {\n                                                                                setShowPlansModal(true);\n                                                                            }\n                                                                        }}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showFloatingWhatsapp ? 'bg-green-500' : 'bg-slate-700'} ${(!['business', 'premium'].includes(settings?.subscriptionPlan)) ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showFloatingWhatsapp ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Cart Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 mt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold\">Botón en Carrito</p>\n                                                                        <p className=\"text-[9px] text-slate-500 mt-0.5\">“Terminar compra por WhatsApp”</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showCartWhatsappCheckout: !settings?.showCartWhatsappCheckout })}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showCartWhatsappCheckout ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showCartWhatsappCheckout ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                            {/* Instagram */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Instagram className=\"w-4 h-4 text-pink-400\" /> Instagram\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showInstagram: settings?.showInstagram === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showInstagram !== false ? 'bg-pink-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showInstagram !== false ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.instagramLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                    placeholder=\"https://instagram.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Facebook */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Facebook className=\"w-4 h-4 text-blue-500\" /> Facebook\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFacebook: !settings?.showFacebook })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showFacebook ? 'bg-blue-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showFacebook ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.facebookLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, facebookLink: e.target.value })}\n                                                                    placeholder=\"https://facebook.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Twitter */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Twitter className=\"w-4 h-4 text-sky-400\" /> Twitter/X\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTwitter: !settings?.showTwitter })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTwitter ? 'bg-sky-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTwitter ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.twitterLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, twitterLink: e.target.value })}\n                                                                    placeholder=\"https://twitter.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* TikTok */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Music className=\"w-4 h-4 text-rose-400\" /> TikTok\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTiktok: !settings?.showTiktok })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTiktok ? 'bg-rose-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTiktok ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.tiktokLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, tiktokLink: e.target.value })}\n                                                                    placeholder=\"https://tiktok.com/@mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* YouTube */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Youtube className=\"w-4 h-4 text-red-500\" /> YouTube\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showYoutube: !settings?.showYoutube })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showYoutube ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showYoutube ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.youtubeLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, youtubeLink: e.target.value })}\n                                                                    placeholder=\"https://youtube.com/c/mitienda\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === PAYMENTS === */}\n                                            {settingsTab === 'payments' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <CreditCard className=\"w-5 h-5 text-green-400\" /> Métodos de Pago\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Transfer */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Building className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Transferencia Bancaria</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, enabled: !settings?.paymentTransfer?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentTransfer?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentTransfer?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.paymentTransfer?.enabled && (\n                                                                    <div className=\"mt-5 grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Titular</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.holderName || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, holderName: e.target.value } })}\n                                                                                placeholder=\"Nombre y apellido\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Alias</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.alias || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, alias: e.target.value } })}\n                                                                                placeholder=\"alias.ejemplo\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">CBU</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.cbu || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, cbu: e.target.value } })}\n                                                                                placeholder=\"0000000000000000000000\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Cash */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Banknote className=\"w-6 h-6 text-green-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Efectivo</p>\n                                                                            <p className=\"text-xs text-slate-500\">Pago al recibir</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            // Validar que Retiro en Local esté activo\n                                                                            if (!settings?.shippingPickup?.enabled) {\n                                                                                showToast('Debes activar \"Retiro en Local\" (Envíos) para habilitar efectivo.', 'warning');\n                                                                                return;\n                                                                            }\n                                                                            setSettings({ ...settings, paymentCash: !settings?.paymentCash });\n                                                                        }}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'} ${!settings?.shippingPickup?.enabled ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {!settings?.shippingPickup?.enabled && (\n                                                                    <p className=\"text-[10px] text-orange-400/80 mt-2 flex items-center gap-1\">\n                                                                        <AlertTriangle className=\"w-3 h-3\" /> Requiere activar Retiro en Local\n                                                                    </p>\n                                                                )}\n                                                            </div>\n\n                                                            {/* MercadoPago (Tarjeta) */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <CreditCard className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Tarjeta (Mercado Pago)</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentMercadoPago: { ...settings?.paymentMercadoPago, enabled: !settings?.paymentMercadoPago?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentMercadoPago?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentMercadoPago?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n\n\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SHIPPING === */}\n                                            {settingsTab === 'shipping' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Truck className=\"w-5 h-5 text-orange-400\" /> Opciones de Envío\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Pickup */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <MapPin className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Retiro en Local</p>\n                                                                            <p className=\"text-xs text-slate-500\">El cliente pasa a buscar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, enabled: !settings?.shippingPickup?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingPickup?.enabled && (\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-4\"\n                                                                        value={settings?.shippingPickup?.address || ''}\n                                                                        onChange={e => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, address: e.target.value } })}\n                                                                        placeholder=\"Dirección de retiro: Av. Corrientes 1234\"\n                                                                    />\n                                                                )}\n                                                            </div>\n\n                                                            {/* Delivery */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Package className=\"w-6 h-6 text-purple-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Envío a Domicilio</p>\n                                                                            <p className=\"text-xs text-slate-500\">Delivery estándar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, enabled: !settings?.shippingDelivery?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingDelivery?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingDelivery?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingDelivery?.enabled && (\n                                                                    <div className=\"grid grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Costo de Envío ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.fee || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, fee: parseFloat(e.target.value) || 0 } })}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Gratis desde ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.freeAbove || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, freeAbove: parseFloat(e.target.value) || 0 } })}\n                                                                                placeholder=\"0 = nunca gratis\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SEO === */}\n                                            {settingsTab === 'seo' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Globe className=\"w-5 h-5 text-green-400\" /> Optimización SEO\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Título del Sitio</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoTitle: e.target.value })}\n                                                                    placeholder=\"Mi Tienda Online | Los Mejores Productos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece en la pestaña del navegador</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Meta Descripción</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                    value={settings?.seoDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoDescription: e.target.value })}\n                                                                    placeholder=\"Tienda online de productos de alta calidad. Envíos a todo el país. ¡Visitanos!\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Descripción que aparece en Google (max 160 caracteres)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Palabras Clave</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoKeywords || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoKeywords: e.target.value })}\n                                                                    placeholder=\"tienda online, productos, ofertas, descuentos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Separadas por comas</p>\n                                                            </div>\n\n                                                            {/* URL Canónica */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">URL del Sitio (Canónica)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoUrl: e.target.value })}\n                                                                    placeholder=\"https://mitienda.vercel.app\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">URL oficial de tu tienda (aparece en Google y redes sociales)</p>\n                                                            </div>\n\n                                                            {/* Autor */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Autor / Empresa</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoAuthor || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoAuthor: e.target.value })}\n                                                                    placeholder=\"Mi Empresa S.A.\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Nombre que aparece como autor del sitio</p>\n                                                            </div>\n\n                                                            {/* OG Image Upload */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen para Redes Sociales (OG:Image)</label>\n                                                                <div className=\"flex items-center gap-4\">\n                                                                    <div className=\"relative group w-32 h-32 bg-slate-900 rounded-xl border-2 border-dashed border-slate-700 hover:border-orange-500 transition flex items-center justify-center overflow-hidden cursor-pointer\">\n                                                                        {settings?.seoImage ? (\n                                                                            <img src={settings.seoImage} alt=\"SEO Preview\" className=\"w-full h-full object-cover\" />\n                                                                        ) : (\n                                                                            <ImageIcon className=\"w-8 h-8 text-slate-600 group-hover:text-orange-500 transition\" />\n                                                                        )}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"image/*\"\n                                                                            className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                            onChange={(e) => handleImageUpload(e, setSettings, 'seoImage', 1200)}\n                                                                        />\n                                                                        {/* Overlay al hacer hover para indicar cambio */}\n                                                                        <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                            <Upload className=\"w-6 h-6 text-white\" />\n                                                                        </div>\n                                                                    </div>\n                                                                    <div className=\"flex-1\">\n                                                                        <p className=\"text-sm text-slate-400 mb-2\">Sube una imagen atractiva (ej: logo con fondo, banner).</p>\n                                                                        <p className=\"text-xs text-slate-600\">Recomendado: 1200x630 píxeles para mejor visualización en Facebook/WhatsApp.</p>\n                                                                        {settings?.seoImage && (\n                                                                            <button\n                                                                                onClick={() => setSettings({ ...settings, seoImage: '' })}\n                                                                                className=\"mt-2 text-xs text-red-400 hover:text-red-300 flex items-center gap-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-3 h-3\" /> Eliminar imagen\n                                                                            </button>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Links Status */}\n                                                            <div className=\"pt-4 border-t border-slate-800 grid grid-cols-2 gap-4\">\n                                                                <a href=\"/sitemap.xml\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Sitemap.xml</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                                <a href=\"/robots.txt\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Robots.txt</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === ADVANCED === */}\n                                            {settingsTab === 'advanced' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Cog className=\"w-5 h-5 text-slate-400\" /> Configuración Avanzada\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            {/* Maintenance Mode */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Modo Mantenimiento</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar página de \"Volvemos pronto\"</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, maintenanceMode: !settings?.maintenanceMode })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.maintenanceMode ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.maintenanceMode ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* PWA & Performance Controls */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 space-y-4\">\n                                                                <h4 className=\"text-sm font-bold text-orange-400 uppercase tracking-wider mb-2\">Rendimiento & PWA</h4>\n\n                                                                {/* Lazy Loading */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Carga Diferida (Lazy Load)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Mejora velocidad cargando imágenes al hacer scroll</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enableLazyLoad: settings?.enableLazyLoad === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enableLazyLoad !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enableLazyLoad !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* PWA Service Worker */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Modo Offline (PWA)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Permite instalar la app y uso sin internet</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enablePWA: settings?.enablePWA === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enablePWA !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enablePWA !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Clear Cache Button */}\n                                                                <div className=\"pt-2 border-t border-slate-700\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if ('caches' in window) {\n                                                                                caches.keys().then(names => {\n                                                                                    names.forEach(name => caches.delete(name));\n                                                                                    showToast('Caché limpiada. Recargando...', 'success');\n                                                                                    setTimeout(() => window.location.reload(), 1500);\n                                                                                });\n                                                                            } else {\n                                                                                showToast('Tu navegador no soporta gestión de caché', 'warning');\n                                                                            }\n                                                                        }}\n                                                                        className=\"w-full py-2 px-4 bg-slate-800 hover:bg-slate-700 text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-2\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" /> Forzar Limpieza de Caché y Recargar\n                                                                    </button>\n                                                                    <p className=\"text-xs text-slate-500 mt-2 text-center\">Usar si ves errores gráficos o versiones antiguas.</p>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Loading Text */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"mb-3\">\n                                                                    <p className=\"font-bold text-white\">Texto de Carga</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mensaje que aparece mientras carga la página</p>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Show Announcement Banner */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Banner de Anuncio</p>\n                                                                    <p className=\"text-xs text-slate-500\">Barra superior con mensaje promocional</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showAnnouncementBanner: settings?.showAnnouncementBanner === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showAnnouncementBanner !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showAnnouncementBanner !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Brand Ticker */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Ticker de Marca</p>\n                                                                    <p className=\"text-xs text-slate-500\">Texto en movimiento debajo del anuncio</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Stock */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Stock Disponible</p>\n                                                                    <p className=\"text-xs text-slate-500\">Los clientes ven cuántas unidades hay</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showStockCount: settings?.showStockCount === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showStockCount !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showStockCount !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require Phone */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir Teléfono</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requirePhone: settings?.requirePhone === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requirePhone !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requirePhone !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require DNI */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir DNI</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requireDNI: settings?.requireDNI === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requireDNI !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requireDNI !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Low Stock Threshold */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Umbral de Stock Bajo</p>\n                                                                        <p className=\"text-xs text-slate-500\">Alerta cuando el stock es menor a este valor</p>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.lowStockThreshold || 5}\n                                                                    onChange={e => setSettings({ ...settings, lowStockThreshold: parseInt(e.target.value) || 5 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* AI Config Block (SustIA) */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-yellow-500\" /> Personalización IA\n                                                        </h3>\n                                                        <div className=\"flex items-center gap-6\">\n                                                            <div className=\"relative group w-24 h-24 bg-slate-900 rounded-full border-2 border-dashed border-slate-700 hover:border-yellow-500 transition flex items-center justify-center overflow-hidden cursor-pointer shrink-0 shadow-xl\">\n                                                                {settings?.botImage ? (\n                                                                    <img src={settings.botImage} alt=\"Bot Preview\" className=\"w-full h-full object-cover\" />\n                                                                ) : (\n                                                                    <Sparkles className=\"w-8 h-8 text-slate-600 group-hover:text-yellow-500 transition\" />\n                                                                )}\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'botImage', 300)}\n                                                                />\n                                                                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                    <Upload className=\"w-6 h-6 text-white\" />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-base mb-1\">Avatar del Asistente</p>\n                                                                <p className=\"text-xs text-slate-500 mb-3 max-w-xs leading-relaxed\">Sube una imagen personalizada para el bot (PNG/JPG). Se recomienda formato cuadrado.</p>\n                                                                {settings?.botImage ? (\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, botImage: '' })}\n                                                                        className=\"text-xs bg-red-900/20 text-red-400 hover:bg-red-900/40 px-3 py-1.5 rounded-lg transition flex items-center gap-2 border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-3 h-3\" /> Restaurar Default\n                                                                    </button>\n                                                                ) : (\n                                                                    <span className=\"text-xs text-yellow-600 bg-yellow-900/20 px-3 py-1 rounded-lg border border-yellow-700/30\">\n                                                                        Usando imagen por defecto\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FolderPlus className=\"w-5 h-5 text-orange-400\" /> Categorías de Productos\n                                                        </h3>\n                                                        <div className=\"flex flex-wrap gap-2 mb-4\">\n                                                            {(settings?.categories || []).map((cat, idx) => (\n                                                                <div key={idx} className=\"bg-slate-900 text-white px-4 py-2 rounded-lg flex items-center gap-2 border border-slate-700\">\n                                                                    <span>{cat}</span>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, categories: (settings?.categories || []).filter((_, i) => i !== idx) })}\n                                                                        className=\"text-red-400 hover:text-red-300\"\n                                                                    >\n                                                                        <X className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            ))}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => setShowCategoryModal(true)}\n                                                            className=\"px-4 py-2 bg-orange-900/20 text-orange-400 rounded-lg font-bold text-sm border border-orange-500/30 hover:bg-orange-900/40 transition flex items-center gap-2\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" /> Agregar Categoría\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === TEAM === */}\n                                            {settingsTab === 'team' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Users className=\"w-5 h-5 text-purple-400\" /> Equipo y Accesos\n                                                        </h3>\n                                                        <p className=\"text-slate-500 mb-6\">Gestiona los miembros del equipo, sus roles de acceso y participación en ganancias.</p>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            {(settings?.team || []).map((member, idx) => (\n                                                                <div key={idx} className=\"flex flex-col md:flex-row md:items-center gap-4 bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                    <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg flex-shrink-0\">\n                                                                        {member.name?.charAt(0)?.toUpperCase() || '?'}\n                                                                    </div>\n                                                                    <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Nombre</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-2 text-sm\"\n                                                                                value={member.name || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], name: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"Nombre\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Email (Acceso)</label>\n                                                                            <input\n                                                                                type=\"email\"\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.email || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], email: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"usuario@email.com\"\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Rol</label>\n                                                                            <select\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.role || 'employee'}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], role: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            >\n                                                                                <option value=\"employee\">Empleado</option>\n                                                                                <option value=\"admin\">Admin</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Total Invertido</label>\n                                                                            <div className=\"input-cyber w-full p-2 text-sm bg-slate-900/50 text-slate-400 flex items-center cursor-not-allowed\">\n                                                                                $ {investments.filter(inv => inv.investor === member.name || inv.investor === member.email).reduce((acc, curr) => acc + (Number(curr.amount) || 0), 0).toLocaleString()}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    {member.email !== SUPER_ADMIN_EMAIL && (\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, team: (settings?.team || []).filter((_, i) => i !== idx) })}\n                                                                            className=\"p-3 bg-red-900/20 text-red-400 hover:bg-red-900/40 rounded-xl transition flex-shrink-0\"\n                                                                            title=\"Eliminar Miembro\"\n                                                                        >\n                                                                            <Trash2 className=\"w-5 h-5\" />\n                                                                        </button>\n                                                                    )}\n                                                                </div>\n                                                            ))}\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => setSettings({ ...settings, team: [...(settings?.team || []), { name: '', email: '', role: 'employee', investment: 0 }] })}\n                                                            className=\"px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold shadow-lg shadow-purple-600/30 flex items-center gap-2 transition\"\n                                                        >\n                                                            <UserPlus className=\"w-5 h-5\" /> Agregar Nuevo Miembro\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Save Button */}\n                                            <div className=\"fixed bottom-8 right-8 z-50\">\n                                                <button\n                                                    onClick={async () => {\n                                                        try {\n                                                            setIsLoading(true);\n                                                            const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                                                            await setDoc(settingsRef, settings, { merge: true });\n                                                            showToast(\"Configuración guardada exitosamente\", \"success\");\n                                                        } catch (e) {\n                                                            console.error(e);\n                                                            showToast(\"Error al guardar\", \"error\");\n                                                        } finally {\n                                                            setIsLoading(false);\n                                                        }\n                                                    }}\n                                                    className=\"px-8 py-4 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-bold rounded-2xl shadow-2xl shadow-orange-900/30 flex items-center gap-3 transition transform hover:scale-105\"\n                                                >\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cambios\n                                                </button>\n                                            </div>\n                                        </div>\n                                    )\n                                    }\n\n                                    {/* 7.3 Modal Proveedores (Selector Visual) */}\n                                    {\n                                        showSupplierModal && (\n                                            <div className=\"fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-scale\">\n                                                <div className=\"bg-[#0a0a0a] border border-slate-700 p-8 rounded-[2.5rem] w-full max-w-lg shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh]\">\n                                                    <div className=\"overflow-y-auto custom-scrollbar pr-2 pb-20\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 sticky top-0 bg-[#0a0a0a] py-2 z-10\">\n                                                            {editingSupplierId ? 'Editar' : 'Nuevo'} Proveedor\n                                                        </h3>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de la Empresa\" value={newSupplier.name} onChange={e => setNewSupplier({ ...newSupplier, name: e.target.value })} />\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Contacto\" value={newSupplier.contact} onChange={e => setNewSupplier({ ...newSupplier, contact: e.target.value })} />\n\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Teléfono\" value={newSupplier.phone} onChange={e => setNewSupplier({ ...newSupplier, phone: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Instagram (sin @)\" value={newSupplier.ig} onChange={e => setNewSupplier({ ...newSupplier, ig: e.target.value })} />\n                                                            </div>\n\n                                                            {/* Selector Visual de Productos */}\n                                                            <div className=\"border-t border-slate-800 pt-6 mt-6\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 block\">\n                                                                    Asignar Productos Suministrados\n                                                                </label>\n                                                                <div className=\"h-48 overflow-y-auto bg-slate-900/50 rounded-xl p-2 border border-slate-800 custom-scrollbar\">\n                                                                    {products.length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 text-xs py-4\">Carga productos primero.</p>\n                                                                    ) : products.map(p => (\n                                                                        <div\n                                                                            key={p.id}\n                                                                            onClick={() => {\n                                                                                const prev = newSupplier.associatedProducts || [];\n                                                                                const exists = prev.includes(p.id);\n                                                                                setNewSupplier({\n                                                                                    ...newSupplier,\n                                                                                    associatedProducts: exists ? prev.filter(x => x !== p.id) : [...prev, p.id]\n                                                                                });\n                                                                            }}\n                                                                            className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer mb-1 transition ${newSupplier.associatedProducts?.includes(p.id) ? 'bg-orange-900/30 border border-orange-500/30' : 'hover:bg-slate-800 border border-transparent'}`}\n                                                                        >\n                                                                            <div className=\"w-8 h-8 bg-white rounded p-0.5 flex-shrink-0\">\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                            <span className=\"text-xs text-white truncate flex-1 font-medium\">{p.name}</span>\n                                                                            {newSupplier.associatedProducts?.includes(p.id) && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                        </div>\n                                                                    ))}\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Botones Fixed */}\n                                                    <div className=\"absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a] to-transparent flex gap-4\">\n                                                        <button onClick={() => setShowSupplierModal(false)} className=\"flex-1 py-4 text-slate-400 font-bold hover:text-white transition bg-slate-900 rounded-xl\">Cancelar</button>\n                                                        <button onClick={saveSupplierFn} className=\"flex-1 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold shadow-lg transition\">Guardar</button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        )\n                                    }\n                                </div >\n                            </div >\n                        ) : (\n                            <AccessDenied onBack={() => setView('store')} />\n                        ))\n                }\n\n                {/* 8. VISTA POLÍTICA DE PRIVACIDAD */}\n                {\n                    view === 'privacy' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Política de <span className=\"text-orange-500 text-6xl\">Privacidad</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 text-lg leading-relaxed\">\n                                        En <strong>{settings?.storeName || 'SUSTORE'}</strong>, valoramos tu privacidad y nos comprometemos a proteger tus datos personales. Esta política describe cómo recolectamos, usamos y resguardamos tu información.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">1. Información Recolectada</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Recolectamos datos básicos como nombre, correo electrónico y número de teléfono únicamente cuando te registras o realizas un pedido para procesar tu compra correctamente.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">2. Uso de los Datos</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Tu información se utiliza exclusivamente para:\n                                    </p>\n                                    <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                        <li>Gestionar tus pedidos y entregas.</li>\n                                        <li>Enviar actualizaciones sobre el estado de tu compra.</li>\n                                        <li>Mejorar nuestros servicios y experiencia de usuario.</li>\n                                    </ul>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">3. Seguridad</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Implementamos medidas de seguridad robustas y encriptación de datos para asegurar que tu información esté protegida contra accesos no autorizados.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">4. Contacto</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed mb-12\">\n                                        Si tienes dudas sobre nuestra política de privacidad, contáctanos a <span className=\"text-orange-400\">{settings?.storeEmail || 'soporte@tuempresa.com'}</span>.\n                                    </p>\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n                {/* 9. VISTA TÉRMINOS Y CONDICIONES */}\n                {\n                    view === 'terms' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Condiciones de <span className=\"text-orange-500 text-6xl\">Uso</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 font-bold mb-8\">Última actualización: 07 de enero de 2026</p>\n\n                                    <h3 className=\"text-xl font-bold text-white mt-8 mb-4\">ACUERDO CON NUESTROS TÉRMINOS LEGALES</h3>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Nosotros somos <strong>{settings?.storeName || 'Sustore'}</strong> (\"<strong>Empresa</strong>\", \"<strong>nosotros</strong>\", \"<strong>nos</strong>\", \"<strong>nuestro</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Operamos el sitio web <a href=\"https://sustore.vercel.app\" className=\"text-orange-400 hover:underline\">https://sustore.vercel.app</a> (el \"<strong>Sitio</strong>\"), así como cualquier otro producto y servicio relacionado que haga referencia o se vincule con estos términos legales (los \"<strong>Términos Legales</strong>\") (colectivamente, los \"<strong>Servicios</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Puede contactarnos por correo electrónico a la dirección proporcionada al final de este documento.\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Estos Términos Legales constituyen un acuerdo legalmente vinculante celebrado entre usted, ya sea personalmente o en nombre de una entidad (\"<strong>usted</strong>\"), y Sustore, en relación con su acceso y uso de los Servicios. Usted acepta que al acceder a los Servicios, ha leído, comprendido y aceptado estar sujeto a todos estos Términos Legales. <strong className=\"text-red-400\">SI NO ESTÁ DE ACUERDO CON TODOS ESTOS TÉRMINOS LEGALES, ENTONCES TIENE EXPRESAMENTE PROHIBIDO UTILIZAR LOS SERVICIOS Y DEBE DEJAR DE UTILIZARLOS INMEDIATAMENTE.</strong>\n                                    </p>\n\n                                    <div className=\"bg-slate-900/50 p-8 rounded-3xl border border-slate-800 my-10\">\n                                        <h3 className=\"text-lg font-black text-white uppercase tracking-widest mb-6\">ÍNDICE</h3>\n                                        <ul className=\"space-y-2 text-sm text-orange-400 font-medium\">\n                                            <li><a href=\"#section1\" className=\"hover:text-orange-300 transition\">1. NUESTROS SERVICIOS</a></li>\n                                            <li><a href=\"#section2\" className=\"hover:text-orange-300 transition\">2. DERECHOS DE PROPIEDAD INTELECTUAL</a></li>\n                                            <li><a href=\"#section3\" className=\"hover:text-orange-300 transition\">3. REPRESENTACIONES DE USUARIOS</a></li>\n                                            <li><a href=\"#section4\" className=\"hover:text-orange-300 transition\">4. ACTIVIDADES PROHIBIDAS</a></li>\n                                            <li><a href=\"#section5\" className=\"hover:text-orange-300 transition\">5. CONTRIBUCIONES GENERADAS POR EL USUARIO</a></li>\n                                            <li><a href=\"#section6\" className=\"hover:text-orange-300 transition\">6. LICENCIA DE CONTRIBUCIÓN</a></li>\n                                            <li><a href=\"#section7\" className=\"hover:text-orange-300 transition\">7. GESTIÓN DE SERVICIOS</a></li>\n                                            <li><a href=\"#section8\" className=\"hover:text-orange-300 transition\">8. PLAZO Y TERMINACIÓN</a></li>\n                                            <li><a href=\"#section9\" className=\"hover:text-orange-300 transition\">9. MODIFICACIONES E INTERRUPCIONES</a></li>\n                                            <li><a href=\"#section10\" className=\"hover:text-orange-300 transition\">10. LEY APLICABLE</a></li>\n                                            <li><a href=\"#section11\" className=\"hover:text-orange-300 transition\">11. RESOLUCIÓN DE DISPUTAS</a></li>\n                                            <li><a href=\"#section12\" className=\"hover:text-orange-300 transition\">12. CORRECCIONES</a></li>\n                                            <li><a href=\"#section13\" className=\"hover:text-orange-300 transition\">13. DESCARGO DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section14\" className=\"hover:text-orange-300 transition\">14. LIMITACIONES DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section15\" className=\"hover:text-orange-300 transition\">15. INDEMNIZACIÓN</a></li>\n                                            <li><a href=\"#section16\" className=\"hover:text-orange-300 transition\">16. DATOS DEL USUARIO</a></li>\n                                            <li><a href=\"#section17\" className=\"hover:text-orange-300 transition\">17. COMUNICACIONES ELECTRÓNICAS</a></li>\n                                            <li><a href=\"#section18\" className=\"hover:text-orange-300 transition\">18. VARIOS</a></li>\n                                            <li><a href=\"#section19\" className=\"hover:text-orange-300 transition\">19. CONTÁCTENOS</a></li>\n                                        </ul>\n                                    </div>\n\n                                    <section id=\"section1\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">1. NUESTROS SERVICIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            La información proporcionada al utilizar los Servicios no está destinada a ser distribuida o utilizada por ninguna persona o entidad en ninguna jurisdicción o país donde dicha distribución o uso sería contrario a la ley o regulación o que nos sometería a cualquier requisito de registro dentro de dicha jurisdicción o país. En consecuencia, aquellas personas que eligen acceder a los Servicios desde otras ubicaciones lo hacen por iniciativa propia y son las únicas responsables del cumplimiento de las leyes locales, si y en la medida en que sean aplicables.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section2\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">2. DERECHOS DE PROPIEDAD INTELECTUAL</h2>\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Nuestra propiedad intelectual</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Somos propietarios o licenciatarios de todos los derechos de propiedad intelectual de nuestros Servicios, incluido todo el código fuente, bases de datos, funcionalidad, software, diseños de sitios web, audio, video, texto, fotografías y gráficos de los Servicios (colectivamente, el \"Contenido\"), así como las marcas comerciales, marcas de servicio y logotipos contenidos en ellas (las \"Marcas\").\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Nuestro Contenido y Marcas están protegidos por leyes de derechos de autor y marcas registradas (y varias otras leyes de derechos de propiedad intelectual y competencia desleal) y tratados alrededor del mundo.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            El Contenido y las Marcas se proporcionan en o a través de los Servicios \"TAL CUAL\" para su uso personal, no comercial o finalidad empresarial interna.\n                                        </p>\n\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Su uso de nuestros Servicios</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Sujeto a su cumplimiento de estos Términos Legales, incluidos los \"ACTIVIDADES PROHIBIDAS\" en la sección siguiente, le otorgamos un contrato no exclusivo, intransferible y revocable licencia para:\n                                        </p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2 mb-4\">\n                                            <li>acceder a los Servicios; y</li>\n                                            <li>descargar o imprimir una copia de cualquier parte del Contenido al que haya obtenido acceso correctamente,</li>\n                                        </ul>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">únicamente para tu uso personal, no comercial o finalidad empresarial interna.</p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Salvo lo establecido en esta sección o en otra parte de nuestros Términos Legales, ninguna parte de los Servicios ni ningún Contenido o Marca podrán copiarse ni reproducirse, agregado, republicado, cargado, publicado, mostrado públicamente, codificado, traducido, transmitido, distribuido, vendido, licenciado o explotado de otro modo para cualquier fin comercial, sin nuestro expreso previo escrito permiso.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Si desea hacer algún uso de los Servicios, Contenido o Marcas que no sea el establecido en esta sección o en otra parte de nuestros Términos Legales, dirija su solicitud a nuestro correo de contacto.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section3\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">3. REPRESENTACIONES DE USUARIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Al utilizar los Servicios, usted declara y garantiza que: (1) usted tiene la capacidad legal y acepta cumplir con estos Términos Legales; (2) no eres un menor de edad en la jurisdicción en la que usted reside; (3) no accederás a los Servicios a través de medios automatizados o no humanos, ya sea a través de un bot, script o de otro modo; (4) no utilizará los Servicios para ninguna actividad ilegal o no autorizado propósito; y (5) su uso de los Servicios no violará ninguna ley o regulación aplicable.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section4\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">4. ACTIVIDADES PROHIBIDAS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            No puede acceder ni utilizar los Servicios para ningún otro propósito que no sea aquel para el cual los ponemos a disposición. Los Servicios no podrán utilizarse en relación con ningún negocio comercial esfuerzo excepto aquellos que estén específicamente respaldados o aprobados por nosotros.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">Como usuario de los Servicios, usted acepta no:</p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                            <li>Recuperar sistemáticamente datos u otro contenido de los Servicios para crear o compilar, directa o indirectamente, una colección, compilación, base de datos o directorio sin nuestro permiso por escrito.</li>\n                                            <li>Engañarnos, defraudarnos o engañarnos a nosotros y a otros usuarios, especialmente en cualquier intento de obtener información confidencial de la cuenta, como las contraseñas de los usuarios.</li>\n                                            <li>Eludir, deshabilitar o interferir de otro modo con las características relacionadas con la seguridad de los Servicios.</li>\n                                            <li>Menospreciar, empañar o dañar de otro modo, en nuestra opinión, a nosotros y/o a los Servicios.</li>\n                                            <li>Utilizar cualquier información obtenida de los Servicios para acosar, abusar o dañar a otra persona.</li>\n                                            <li>Hacer un uso indebido de nuestros servicios de soporte o presentar informes falsos de abuso o mala conducta.</li>\n                                            <li>Utilice los Servicios de una manera incompatible con las leyes o regulaciones aplicables.</li>\n                                        </ul>\n                                    </section>\n\n                                    <section id=\"section13\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">13. DESCARGO DE RESPONSABILIDAD</h2>\n                                        <p className=\"text-slate-500 leading-relaxed text-xs uppercase tracking-wide border-l-4 border-red-500/50 pl-4 py-2 bg-red-900/5\">\n                                            LOS SERVICIOS SE PRESTAN TAL CUAL Y SEGÚN ESTÉ DISPONIBLE. USTED ACEPTA QUE SU USO DE LOS SERVICIOS SERÁ BAJO SU PROPIO RIESGO. EN LA MÁXIMA MEDIDA PERMITIDA POR LA LEY, RENUNCIAMOS A TODAS LAS GARANTÍAS, EXPRESAS O IMPLÍCITAS, EN RELACIÓN CON LOS SERVICIOS Y SU USO DE LOS MISMOS.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section19\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">19. CONTÁCTENOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Para resolver una queja con respecto a los Servicios o para recibir más información sobre el uso de los Servicios, contáctenos en:\n                                        </p>\n                                        <p className=\"text-2xl font-black text-orange-400\">\n                                            {settings?.storeEmail || 'soporte@tuempresa.com'}\n                                        </p>\n                                    </section>\n\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700 mt-12\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n            </main >\n\n            {/* FOOTER PROFESIONAL (Visible solo fuera del Admin y Auth) */}\n            {\n                view !== 'admin' && view !== 'login' && view !== 'register' && (\n                    <footer className={`pt-16 pb-8 relative overflow-hidden transition-colors duration-300 border-t ${darkMode ? 'bg-[#050505] border-slate-900' : 'bg-slate-100 border-slate-200'}`}>\n                        {/* Decoración de Fondo */}\n                        <div className={`absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-orange-500/30 to-transparent`}></div>\n                        <div className={`absolute -top-40 -right-40 w-96 h-96 rounded-full blur-[100px] pointer-events-none ${darkMode ? 'bg-blue-900/5' : 'bg-blue-500/5'}`}></div>\n\n                        <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 grid grid-cols-1 md:grid-cols-4 gap-12 mb-16 relative z-10\">\n                            {/* Columna 1: Marca */}\n                            <div className=\"md:col-span-2 space-y-6\">\n                                <h2 className={`text-3xl font-black tracking-tighter italic ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    {settingsLoaded ? (settings?.storeName || '') : ''}\n                                    <span className=\"text-orange-500\">{settings?.footerSuffix || '.SF'}</span>\n                                </h2>\n                                <p className={`max-w-sm leading-relaxed text-sm ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                    {settings?.footerDescription || 'Tu destino premium para tecnología de vanguardia. Ofrecemos los mejores productos con garantía y soporte especializado. Elevamos tu experiencia digital.'}\n                                </p>\n                                <div className=\"flex gap-3 pt-2 flex-wrap\">\n                                    {settings?.showInstagram !== false && settings?.instagramLink && (\n                                        <button onClick={() => window.open(settings?.instagramLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-pink-400 hover:bg-pink-900/10 hover:border-pink-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-pink-600 hover:bg-pink-50 hover:border-pink-300'}`}>\n                                            <Instagram className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showWhatsapp === true && settings?.whatsappLink && (\n                                        <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-green-400 hover:bg-green-900/10 hover:border-green-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-green-600 hover:bg-green-50 hover:border-green-300'}`}>\n                                            <MessageCircle className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showFacebook && settings?.facebookLink && (\n                                        <button onClick={() => window.open(settings?.facebookLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-blue-400 hover:bg-blue-900/10 hover:border-blue-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-blue-600 hover:bg-blue-50 hover:border-blue-300'}`}>\n                                            <Facebook className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTwitter && settings?.twitterLink && (\n                                        <button onClick={() => window.open(settings?.twitterLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-sky-400 hover:bg-sky-900/10 hover:border-sky-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-sky-600 hover:bg-sky-50 hover:border-sky-300'}`}>\n                                            <Twitter className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTiktok && settings?.tiktokLink && (\n                                        <button onClick={() => window.open(settings?.tiktokLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-rose-400 hover:bg-rose-900/10 hover:border-rose-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-rose-600 hover:bg-rose-50 hover:border-rose-300'}`}>\n                                            <Music className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showYoutube && settings?.youtubeLink && (\n                                        <button onClick={() => window.open(settings?.youtubeLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-red-400 hover:bg-red-900/10 hover:border-red-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-red-600 hover:bg-red-50 hover:border-red-300'}`}>\n                                            <Youtube className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna 2: Quick Links */}\n                            <div className=\"space-y-6\">\n                                <h3 className={`font-bold uppercase tracking-widest text-xs ${darkMode ? 'text-white' : 'text-slate-900'}`}>Enlaces Rápidos</h3>\n                                <ul className={`space-y-3 text-sm font-medium ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                    <li>\n                                        <button onClick={() => setView('store')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Inicio\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('profile')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Mi Cuenta\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('guide')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Ayuda & Soporte\n                                        </button>\n                                    </li>\n                                </ul>\n                            </div>\n\n                            {/* Columna 3: Soporte */}\n                            {settings?.showFooterContact !== false && (\n                                <div className=\"space-y-6\">\n                                    <h3 className={`font-bold uppercase tracking-widest text-xs ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {settings?.footerContactTitle || 'Contacto'}\n                                    </h3>\n                                    <p className={`text-sm leading-relaxed mb-4 ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                        {settings?.footerContactDescription || '¿Tienes alguna duda? Estamos aquí para ayudarte.'}\n                                    </p>\n                                    <button\n                                        onClick={() => {\n                                            const type = settings?.footerContactType || 'whatsapp';\n                                            if (type === 'whatsapp' && settings?.whatsappLink) {\n                                                window.open(settings.whatsappLink, '_blank');\n                                            } else if (type === 'instagram' && settings?.instagramLink) {\n                                                window.open(settings.instagramLink, '_blank');\n                                            } else if (type === 'email' && settings?.storeEmail) {\n                                                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${settings.storeEmail}`, '_blank');\n                                            }\n                                        }}\n                                        className={`px-6 py-3 rounded-xl text-sm font-bold transition w-full md:w-auto border ${darkMode ? 'bg-orange-900/10 text-orange-400 border-orange-500/20 hover:bg-orange-500 hover:text-white' : 'bg-orange-50 text-orange-600 border-orange-200 hover:bg-orange-500 hover:text-white hover:border-orange-500'}`}\n                                    >\n                                        {settings?.footerContactButtonText || 'Contactar Soporte'}\n                                    </button>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Copyright Bar */}\n                        <div className={`border-t transition-colors duration-300 ${darkMode ? 'border-slate-900 bg-[#020202]' : 'border-slate-200 bg-slate-200/50'}`}>\n                            <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 py-6 flex flex-col md:flex-row justify-between items-center gap-4\">\n                                <p className={`text-xs font-mono ${darkMode ? 'text-slate-600' : 'text-slate-500'}`}>\n                                    © 2026 Sustore. Todos los derechos reservados.\n                                </p>\n                                <div className=\"flex gap-6\">\n                                    {settings?.showPrivacyPolicy !== false && (\n                                        <span onClick={() => setView('privacy')} className={`text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-orange-500 transition underline underline-offset-4 ${darkMode ? 'text-slate-700 decoration-slate-900' : 'text-slate-500 decoration-slate-300'}`}>Privacy Policy</span>\n                                    )}\n                                    {settings?.showTermsOfService !== false && (\n                                        <span onClick={() => setView('terms')} className={`text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-orange-500 transition underline underline-offset-4 ${darkMode ? 'text-slate-700 decoration-slate-900' : 'text-slate-500 decoration-slate-300'}`}>Terms of Service</span>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    </footer>\n                )\n            }\n\n            {/* MODAL: CREAR CATEGORÍA */}\n            {\n                showCategoryModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-orange-800 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-orange-900/20 text-orange-500\">\n                                <FolderPlus className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-6 text-white\">Nueva Categoría</h3>\n                            <input\n                                type=\"text\"\n                                value={newCategory}\n                                onChange={(e) => setNewCategory(e.target.value)}\n                                className=\"input-cyber w-full p-4 mb-6\"\n                                placeholder=\"Nombre de la categoría\"\n                                autoFocus\n                            />\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => { setNewCategory(''); setShowCategoryModal(false); }}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={createCategoryFn}\n                                    className=\"flex-1 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold transition shadow-lg shadow-orange-600/30\"\n                                >\n                                    Crear\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            {/* MODAL: VENTA MANUAL */}\n            {\n                showManualSaleModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-green-900 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-green-900/20 text-green-500\">\n                                <DollarSign className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-2 text-white\">Venta Manual</h3>\n                            <p className=\"text-center text-slate-400 mb-6\">\n                                {products.find(p => p.id === saleData.productId)?.name}\n                            </p>\n\n                            <div className=\"space-y-4 mb-8\">\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Cantidad</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.quantity}\n                                            onChange={(e) => setSaleData({ ...saleData, quantity: parseInt(e.target.value) || 1 })}\n                                            min=\"1\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Precio Unit.</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.price}\n                                            onChange={(e) => setSaleData({ ...saleData, price: parseFloat(e.target.value) || 0 })}\n                                        />\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Método de Pago</label>\n                                    <select\n                                        className=\"input-cyber w-full p-3\"\n                                        value={saleData.paymentMethod}\n                                        onChange={(e) => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                                    >\n                                        <option value=\"Efectivo\">Efectivo</option>\n                                        <option value=\"Transferencia\">Transferencia</option>\n                                        <option value=\"Tarjeta\">Tarjeta</option>\n                                    </select>\n                                </div>\n                                <div className=\"bg-slate-900 p-4 rounded-xl flex justify-between items-center border border-slate-800\">\n                                    <span className=\"text-slate-400 font-bold\">Total:</span>\n                                    <span className=\"text-2xl font-black text-green-400\">${(saleData.quantity * saleData.price).toLocaleString()}</span>\n                                </div>\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => setShowManualSaleModal(false)}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={confirmManualSale}\n                                    disabled={isProcessingOrder}\n                                    className=\"flex-1 py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold transition shadow-lg shadow-green-600/30 flex items-center justify-center gap-2\"\n                                >\n                                    {isProcessingOrder ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <CheckCircle className=\"w-5 h-5\" />}\n                                    Confirmar\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n            {/* BOTÓN FLOTANTE DE WHATSAPP (Solo Plan Negocio/Premium) */}\n            {\n                settings?.showFloatingWhatsapp && settings?.whatsappLink && ['business', 'premium'].includes(settings?.subscriptionPlan) && view !== 'admin' && (\n                    <button\n                        onClick={() => window.open(settings.whatsappLink, '_blank')}\n                        className=\"fixed bottom-24 right-6 z-50 p-4 bg-green-500 rounded-full shadow-[0_0_20px_rgba(34,197,94,0.4)] hover:scale-110 hover:shadow-[0_0_30px_rgba(34,197,94,0.6)] transition-all animate-bounce-slow\"\n                        title=\"Chatea con nosotros\"\n                    >\n                        <MessageCircle className=\"w-8 h-8 text-white fill-white\" />\n                    </button>\n                )\n            }\n\n            <AdminUserDrawer />\n            {/* MODAL: VER PLANES DE SUSCRIPCIÓN */}\n            {\n                showPlansModal && (\n                    <PlansModalContent settings={settings} onClose={() => setShowPlansModal(false)} />\n                )\n            }\n            {\n                false && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-0 md:p-4 overflow-hidden\">\n                        <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full md:h-auto md:max-h-[90vh] md:max-w-6xl md:rounded-[2.5rem] border-0 md:border md:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n                            {/* Scrollable Content */}\n                            <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6 md:p-10 pb-20\">\n                                {/* Header */}\n                                <div className=\"flex justify-between items-start mb-6\">\n                                    <div>\n                                        <h2 className=\"text-3xl md:text-4xl font-black text-white flex items-center gap-3 mb-2\">\n                                            <div className=\"p-2 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl\">\n                                                <Zap className=\"w-6 h-6 md:w-8 md:h-8 text-white fill-current\" />\n                                            </div>\n                                            Planes Disponibles\n                                        </h2>\n                                        <p className=\"text-slate-500\">Tu plan actual: <span className=\"text-orange-400 font-bold uppercase bg-orange-500/10 px-3 py-1 rounded-full text-sm\">{settings?.subscriptionPlan === 'business' ? '🚀 Negocio' : settings?.subscriptionPlan === 'premium' ? '💎 Premium' : '🏪 Emprendedor'}</span></p>\n                                    </div>\n                                    <button onClick={() => setShowPlansModal(false)} className=\"p-3 bg-slate-900 hover:bg-slate-800 rounded-2xl text-slate-400 hover:text-white transition-all duration-300 hover:rotate-90\">\n                                        <X className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n\n                                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12\">\n\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    {/* PLAN EMPRENDEDOR */}\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan\n                                        ? 'bg-gradient-to-b from-orange-950/40 to-slate-950 border-orange-500 shadow-[0_0_40px_rgba(249,115,22,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-orange-500/50'\n                                        }`}>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-orange-400 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">✓ TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-orange-600 to-orange-500 rounded-2xl shadow-lg shadow-orange-500/30\">\n                                                    <Store className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">🚀 Emprendedor</h4>\n                                                    <p className=\"text-sm text-orange-400 font-medium leading-tight\">Impulso inicial</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$7.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Carga de hasta <strong className=\"text-white\">30 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Integración <strong className=\"text-white\">Mercado Pago</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">1 promoción</strong> activa</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-orange-500/50 open:shadow-[0_0_20px_rgba(249,115,22,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-orange-400\">👇 Elegí tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-orange-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$2.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$7.000', label: 'Pago Mensual', sub: 'Más equilibrado' },\n                                                        { cycle: 'Anual', price: '$70.000', label: 'Pago Anual', sub: 'Ahorrás $14.000 🎁' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Emprendedor', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-orange-500 text-black border-orange-400 shadow-lg ring-2 ring-orange-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-orange-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    {/* PLAN NEGOCIO */}\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'business'\n                                        ? 'bg-gradient-to-b from-purple-950/40 to-slate-950 border-purple-500 shadow-[0_0_40px_rgba(168,85,247,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-purple-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-purple-600 to-fuchsia-600 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20 animate-pulse\">⭐ MÁS POPULAR</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'business' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-purple-400 text-white text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">✓ TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-purple-600 to-fuchsia-600 rounded-2xl shadow-lg shadow-purple-500/30\">\n                                                    <Briefcase className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">🚀 Negocio</h4>\n                                                    <p className=\"text-sm text-purple-400 font-medium leading-tight\">Escala tu marca</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$13.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span>Hasta <strong className=\"text-white\">50 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">5 promociones</strong> simultáneas</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Cupones</strong> de descuento</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Analítica</strong> de clientes</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-purple-500/50 open:shadow-[0_0_20px_rgba(168,85,247,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-purple-400\">👇 Elegí tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-purple-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$4.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$13.000', label: 'Pago Mensual', sub: 'Ideal gestión mensual' },\n                                                        { cycle: 'Anual', price: '$117.000', label: 'Pago Anual', sub: '3 MESES GRATIS 🎉' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Negocio', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-purple-600 text-white border-purple-500 shadow-lg ring-2 ring-purple-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-purple-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle ? 'text-white/80' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    {/* PLAN PREMIUM */}\n                                    {/* ═══════════════════════════════════════════════════════════════════ */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'premium'\n                                        ? 'bg-gradient-to-b from-yellow-950/40 to-slate-950 border-yellow-500 shadow-[0_0_40px_rgba(234,179,8,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-yellow-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-yellow-500 to-amber-600 text-black text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20\">💎 VIP</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-yellow-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'premium' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-yellow-500 to-amber-500 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">✓ TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-2xl shadow-lg shadow-yellow-500/30\">\n                                                    <Sparkles className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">💎 Premium</h4>\n                                                    <p className=\"text-sm text-yellow-400 font-medium leading-tight\">Liderazgo total</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$22.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Ilimitados</strong> productos y promos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Asistente IA</strong> 24/7</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Carga VIP</strong> 10 productos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Mantenimiento</strong> Full Mensual</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-yellow-500/50 open:shadow-[0_0_20px_rgba(234,179,8,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-yellow-400\">👇 Elegí tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-yellow-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$6.500', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$22.000', label: 'Pago Mensual', sub: 'Equilibrio perfecto' },\n                                                        { cycle: 'Anual', price: '$198.000', label: 'Pago Anual', sub: '3 MESES GRATIS 🎁' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Premium', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-yellow-500 text-black border-yellow-400 shadow-lg ring-2 ring-yellow-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-yellow-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n                                </div>\n\n                            </div>\n\n                            {/* Sticky Footer */}\n                            <div className=\"border-t border-slate-800 bg-[#0a0a0a] p-6 z-20 shrink-0\">\n                                <div className={`p-4 md:p-6 rounded-2xl border transition-all duration-500 relative overflow-hidden group ${selectedPlanOption\n                                    ? 'bg-gradient-to-r from-green-900/80 to-emerald-900/80 border-green-500 shadow-[0_0_40px_rgba(34,197,94,0.3)]'\n                                    : 'bg-slate-900 border-slate-700 opacity-90'\n                                    }`}>\n                                    <div className=\"absolute inset-0 bg-[url('/noise.svg')] opacity-20\"></div>\n\n                                    <div className=\"relative z-10 flex flex-col md:flex-row items-center justify-between gap-6\">\n                                        <div className=\"flex items-center gap-4 text-left\">\n                                            <div className={`p-3 rounded-full shadow-lg transition-colors duration-300 ${selectedPlanOption ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-400'}`}>\n                                                {selectedPlanOption ? <CheckCircle className=\"w-8 h-8\" /> : <Zap className=\"w-8 h-8\" />}\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-xl font-bold text-white mb-1\">\n                                                    {selectedPlanOption\n                                                        ? `¡Excelente elección! 🚀`\n                                                        : 'Seleccioná una opción para continuar'}\n                                                </h3>\n                                                <p className={`text-sm ${selectedPlanOption ? 'text-green-300' : 'text-slate-400'}`}>\n                                                    {selectedPlanOption\n                                                        ? <span>Estás a un paso de activar tu <strong>Plan {selectedPlanOption.plan}</strong> con pago <strong>{selectedPlanOption.cycle}</strong>.</span>\n                                                        : 'Hacé clic en una de las opciones de arriba para ver los detalles.'}\n                                                </p>\n                                            </div>\n                                        </div>\n\n                                        {selectedPlanOption && (\n                                            <a\n                                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero suscribirme al *Plan ${selectedPlanOption.plan}* con pago *${selectedPlanOption.cycle}* de ${selectedPlanOption.price}. ¿Cómo seguimos?`)}`}\n                                                target=\"_blank\"\n                                                rel=\"noopener noreferrer\"\n                                                className=\"w-full md:w-auto px-8 py-4 bg-green-500 hover:bg-green-400 text-black font-black text-lg rounded-xl transition-all duration-300 hover:scale-105 shadow-xl shadow-green-500/30 flex items-center justify-center gap-2 animate-bounce-subtle\"\n                                            >\n                                                <MessageCircle className=\"w-6 h-6 fill-current\" />\n                                                Confirmar por WhatsApp\n                                                <ArrowRight className=\"w-5 h-5\" />\n                                            </a>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            <ConfirmModal\n                isOpen={confirmModal.isOpen}\n                title={confirmModal.title}\n                message={confirmModal.message}\n                onConfirm={confirmModal.onConfirm}\n                onCancel={confirmModal.onCancel || (() => setConfirmModal(prev => ({ ...prev, isOpen: false })))}\n                isDangerous={true}\n                darkMode={darkMode}\n            />\n            {/* --- SUSTIA CHATBOT (AI) --- */}\n            <CategoryModal\n                isOpen={showCategoryModal}\n                onClose={() => setShowCategoryModal(false)}\n                categories={settings?.categories || []}\n                onAdd={(newCat) => setSettings({ ...settings, categories: [...(settings?.categories || []), newCat] })}\n                onRemove={(cat) => setSettings({ ...settings, categories: (settings?.categories || []).filter(c => c !== cat) })}\n                darkMode={darkMode}\n            />\n            <Suspense fallback={null}>\n                <SustIABot\n                    settings={settings}\n                    products={products}\n                    addToCart={(p, q = 1) => manageCart(p, q)}\n                    controlPanel={{\n                        setDarkMode: setDarkMode,\n                        openCart: () => setView('cart')\n                    }}\n                    coupons={coupons}\n                />\n            </Suspense>\n        </div >\n    );\n}\n\n// === COMPONENTE MODAL DE PLANES REFACTORIZADO ===\nconst PlansModalContent = ({ settings, onClose }) => {\n    const [activePlanId, setActivePlanId] = React.useState(null);\n    const [selectedOption, setSelectedOption] = React.useState(null);\n\n    // Clases de color estáticas para Tailwind (no interpolar)\n    const colorClasses = {\n        purple: {\n            iconBg: 'bg-purple-600',\n            iconText: 'text-purple-400',\n            price: 'text-purple-400',\n            check: 'text-purple-500',\n            activeBg: 'bg-purple-500',\n            activeBorder: 'border-purple-400',\n            gradient: 'from-purple-900/40 to-slate-900',\n            border: 'border-purple-500/50'\n        },\n        orange: {\n            iconBg: 'bg-orange-600',\n            iconText: 'text-orange-400',\n            price: 'text-orange-400',\n            check: 'text-orange-500',\n            activeBg: 'bg-orange-500',\n            activeBorder: 'border-orange-400',\n            gradient: 'from-orange-900/40 to-slate-900',\n            border: 'border-orange-500/50'\n        },\n        yellow: {\n            iconBg: 'bg-yellow-500',\n            iconText: 'text-yellow-400',\n            price: 'text-yellow-400',\n            check: 'text-yellow-500',\n            activeBg: 'bg-yellow-500',\n            activeBorder: 'border-yellow-400',\n            gradient: 'from-yellow-900/40 to-slate-900',\n            border: 'border-yellow-500/50'\n        }\n    };\n\n    const PLANS = [\n        {\n            id: 'entrepreneur',\n            name: 'Plan Emprendedor',\n            emoji: '🏪',\n            subtitle: 'El impulso que tu negocio necesita para despegar.',\n            price: '$7.000',\n            features: [\n                '📦 Carga de hasta 30 productos',\n                '💳 Integración con Mercado Pago',\n                '🔥 1 Promoción activa',\n                '📊 Panel de Control completo',\n                '📧 Soporte técnico vía Gmail'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$2.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$7.000', sub: 'Opción equilibrada' },\n                { id: 'annual', label: 'Anual', price: '$70.000', sub: '🎁 2 MESES GRATIS' }\n            ],\n            color: 'orange',\n            icon: Store\n        },\n        {\n            id: 'business',\n            name: 'Plan Negocio',\n            emoji: '🚀',\n            subtitle: 'Para marcas con identidad que buscan escalar.',\n            price: '$13.000',\n            popular: true,\n            features: [\n                '📦 Hasta 50 productos',\n                '🔥 5 Promociones simultáneas',\n                '🎫 Sistema de cupones',\n                '📊 Analítica de clientes',\n                '📲 Botón WhatsApp flotante'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$4.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$13.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$117.000', sub: '🎁 3 MESES GRATIS' }\n            ],\n            color: 'purple',\n            icon: Briefcase\n        },\n        {\n            id: 'premium',\n            name: 'Plan Premium',\n            emoji: '💎',\n            subtitle: 'Automatización total y cero preocupaciones.',\n            price: '$22.000',\n            features: [\n                '🚀 Productos ilimitados',\n                '🤖 Asistente IA 24/7',\n                '✨ Carga VIP (10 productos)',\n                '🛠️ Mantenimiento mensual',\n                '📲 Omnicanalidad total'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$6.500', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$22.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$198.000', sub: '🎁 3 MESES GRATIS' }\n            ],\n            color: 'yellow',\n            icon: Sparkles\n        }\n    ];\n\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-2 sm:p-4 overflow-hidden\">\n            <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full sm:h-auto sm:max-h-[95vh] sm:max-w-5xl sm:rounded-3xl border-0 sm:border sm:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n\n                {/* Header */}\n                <div className=\"flex justify-between items-center p-4 sm:p-6 border-b border-slate-800/50 shrink-0\">\n                    <div>\n                        <h2 className=\"text-xl sm:text-3xl font-black text-white flex items-center gap-2 sm:gap-3\">\n                            <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 text-yellow-500 fill-current\" /> Planes Disponibles\n                        </h2>\n                        <p className=\"text-slate-500 text-xs sm:text-sm mt-1\">Elegí un plan y seleccioná tu forma de pago</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 sm:p-3 bg-slate-800 hover:bg-slate-700 rounded-full text-white transition-all hover:rotate-90\">\n                        <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                    </button>\n                </div>\n\n                {/* Scrollable Content */}\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-5\">\n                        {PLANS.map(plan => {\n                            const isActive = activePlanId === plan.id;\n                            const isCurrentPlan = settings?.subscriptionPlan === plan.id || (!settings?.subscriptionPlan && plan.id === 'entrepreneur');\n                            const Icon = plan.icon;\n                            const colors = colorClasses[plan.color];\n\n                            return (\n                                <div\n                                    key={plan.id}\n                                    onClick={() => setActivePlanId(isActive ? null : plan.id)}\n                                    className={`relative rounded-2xl sm:rounded-3xl border-2 transition-all duration-300 overflow-hidden cursor-pointer flex flex-col\n                                        ${isActive\n                                            ? `bg-gradient-to-b ${colors.gradient} ${colors.border} shadow-xl scale-[1.01]`\n                                            : 'bg-[#111] border-slate-800 hover:border-slate-600'\n                                        }`}\n                                >\n                                    {/* Popular Badge */}\n                                    {plan.popular && (\n                                        <div className=\"absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] font-black px-3 py-1 rounded-bl-xl\">\n                                            POPULAR\n                                        </div>\n                                    )}\n\n                                    {/* Current Plan Badge */}\n                                    {isCurrentPlan && (\n                                        <div className=\"absolute top-0 left-1/2 -translate-x-1/2 bg-white/10 backdrop-blur text-white text-[10px] font-bold px-3 py-1 rounded-b-lg border border-white/20\">\n                                            ✓ TU PLAN\n                                        </div>\n                                    )}\n\n                                    <div className=\"p-4 sm:p-5 flex-1 flex flex-col\">\n                                        {/* Header */}\n                                        <div className=\"flex items-center gap-3 mb-3\">\n                                            <div className={`p-2.5 sm:p-3 rounded-xl ${colors.iconBg} shadow-lg`}>\n                                                <Icon className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-lg sm:text-xl font-black text-white\">{plan.name}</h3>\n                                                <p className=\"text-[11px] sm:text-xs text-slate-500\">{plan.subtitle}</p>\n                                            </div>\n                                        </div>\n\n                                        {/* Price */}\n                                        <div className={`text-2xl sm:text-3xl font-black ${colors.price} mb-4`}>\n                                            {plan.price} <span className=\"text-sm text-slate-500 font-normal\">/mes</span>\n                                        </div>\n\n                                        {/* Features */}\n                                        <div className=\"space-y-2 mb-4 flex-1\">\n                                            {plan.features.map((feat, i) => (\n                                                <div key={i} className=\"flex items-start gap-2 text-xs sm:text-sm text-slate-300\">\n                                                    <CheckCircle className={`w-3.5 h-3.5 sm:w-4 sm:h-4 ${colors.check} shrink-0 mt-0.5`} />\n                                                    <span>{feat}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n\n                                        {/* Expand/Collapse Indicator */}\n                                        <button\n                                            className={`w-full py-2 text-xs font-bold uppercase tracking-wider rounded-lg transition-all flex items-center justify-center gap-2\n                                                ${isActive ? 'bg-white/5 text-white' : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'}`}\n                                        >\n                                            {isActive ? 'Elegí tu forma de pago' : 'Ver opciones de pago'}\n                                            <ChevronDown className={`w-4 h-4 transition-transform ${isActive ? 'rotate-180' : ''}`} />\n                                        </button>\n\n                                        {/* Payment Options (Expandable) */}\n                                        <div className={`transition-all duration-300 overflow-hidden ${isActive ? 'max-h-[400px] opacity-100 mt-4' : 'max-h-0 opacity-0'}`}>\n                                            <div className=\"space-y-2 pt-4 border-t border-white/10\">\n                                                {plan.cycles.map(cycle => {\n                                                    const isSelected = selectedOption?.price === cycle.price && selectedOption?.plan === plan.name;\n                                                    return (\n                                                        <button\n                                                            key={cycle.id}\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setSelectedOption({ plan: plan.name, cycle: cycle.label, price: cycle.price, sub: cycle.sub, emoji: plan.emoji });\n                                                            }}\n                                                            className={`w-full text-left p-3 rounded-xl border-2 transition-all flex justify-between items-center\n                                                                ${isSelected\n                                                                    ? `${colors.activeBg} text-black ${colors.activeBorder} shadow-lg`\n                                                                    : 'bg-slate-900/50 border-slate-700 hover:bg-slate-800 text-slate-300 hover:border-slate-500'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{cycle.label}</div>\n                                                                <div className={`text-[10px] ${isSelected ? 'text-black/70' : 'text-slate-500'}`}>{cycle.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-base sm:text-lg\">{cycle.price}</div>\n                                                        </button>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n\n                {/* Sticky Footer CTA */}\n                {selectedOption && (\n                    <div className=\"border-t border-slate-800 bg-gradient-to-r from-green-900/30 to-emerald-900/30 p-3 sm:p-5 shrink-0 animate-slide-up\">\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3 max-w-4xl mx-auto\">\n                            <div className=\"text-center sm:text-left\">\n                                <p className=\"text-white text-sm sm:text-base font-bold\">\n                                    {selectedOption.emoji} {selectedOption.plan} • <span className=\"text-green-400\">{selectedOption.cycle}</span>\n                                </p>\n                                <p className=\"text-slate-400 text-xs\">{selectedOption.sub} • {selectedOption.price}</p>\n                            </div>\n                            <a\n                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero contratar el *${selectedOption.plan}* con pago *${selectedOption.cycle}* (${selectedOption.price}). ¿Cómo sigo?`)}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"w-full sm:w-auto px-6 py-3 bg-green-500 hover:bg-green-400 text-black font-black text-sm sm:text-base rounded-xl transition shadow-lg shadow-green-500/30 flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5 fill-current\" /> Confirmar por WhatsApp\n                            </a>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\n// Fallback para Acceso Denegado\nconst AccessDenied = ({ onBack }) => (\n    <div className=\"min-h-screen bg-black flex items-center justify-center p-4 animate-fade-in\">\n        <div className=\"text-center max-w-md\">\n            <div className=\"w-20 h-20 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-900/50\">\n                <Shield className=\"w-10 h-10\" />\n            </div>\n            <h1 className=\"text-3xl font-black text-white mb-2\">ACCESO DENEGADO</h1>\n            <p className=\"text-slate-500 mb-8\">No tienes los permisos necesarios para acceder al Panel de Administración.</p>\n            <button onClick={onBack} className=\"px-8 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition flex items-center gap-2 mx-auto border border-slate-700\">\n                <ArrowLeft className=\"w-4 h-4\" /> Volver a la Tienda\n            </button>\n        </div>\n    </div>\n);\n\n// Renderizado Final\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n    throw new Error('No se encontró el contenedor #root');\n}\nconst root = createRoot(rootElement);\nroot.render(\n    <ErrorBoundary>\n        <App />\n    </ErrorBoundary>\n);\n"],
  "mappings": "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",
  "names": ["React", "useState", "useEffect", "useRef", "useMemo", "useCallback", "Suspense", "lazy", "createRoot", "ShoppingBag", "X", "User", "Search", "Zap", "CheckCircle", "MessageCircle", "Instagram", "Minus", "Heart", "Tag", "Plus", "Trash2", "Edit", "AlertTriangle", "RefreshCw", "LogOut", "Mail", "CreditCard", "Menu", "Home", "Info", "FileQuestion", "Users", "Package", "LayoutDashboard", "Settings", "Ticket", "Truck", "Wallet", "FileText", "ArrowRight", "ArrowLeft", "DollarSign", "ChevronLeft", "ChevronRight", "TrendingUp", "TrendingDown", "Briefcase", "Save", "AlertCircle", "Phone", "MapPin", "Copy", "ExternalLink", "Shield", "ShoppingCart", "Play", "FolderPlus", "Eye", "EyeOff", "Clock", "Calendar", "Gift", "Lock", "Loader2", "Star", "Percent", "Sparkles", "Flame", "ImageIcon", "Filter", "ChevronDown", "Store", "BarChart", "Globe", "Headphones", "Palette", "Share2", "Cog", "Facebook", "Twitter", "Youtube", "Bell", "Music", "Building", "Banknote", "UserPlus", "Maximize2", "Sun", "Moon", "Upload", "initializeApp", "getAuth", "signInAnonymously", "onAuthStateChanged", "signInWithCustomToken", "sendPasswordResetEmail", "signInWithEmailAndPassword", "createUserWithEmailAndPassword", "getFirestore", "collection", "addDoc", "onSnapshot", "query", "updateDoc", "doc", "getDocs", "deleteDoc", "where", "writeBatch", "getDoc", "increment", "setDoc", "orderBy", "limit", "startAfter", "SustIABot", "AdminPanel", "CheckoutPanel", "firebaseConfig", "app", "auth", "db", "DEFAULT_APP_ID", "APP_VERSION", "mpPublicKeyPromise", "getMercadoPagoPublicKey", "res", "data", "setupSmoothWheelScroll", "getDocumentScrollingElement", "elementStates", "clamp", "value", "min", "max", "maxScrollTopForEl", "el", "isScrollable", "overflowY", "findScrollableAncestor", "startEl", "getState", "existing", "state", "animateElement", "ts", "dt", "friction", "current", "next", "nextTs", "onWheel", "e", "targetEl", "scrollEl", "deltaX", "deltaY", "strength", "onResize", "docEl", "_sa", "SUPER_ADMIN_EMAIL", "SecurityManager", "base", "timestamp", "password", "encoder", "salt", "hashBuffer", "b", "hash", "email", "key", "now", "record", "str", "i", "char", "userId", "payload", "token", "signature", "fullToken", "toSign", "stored", "payloadB64", "userData", "input", "a", "aBytes", "bBytes", "result", "noop", "method", "widthDiff", "heightDiff", "defaultSettings", "HomeBannerCarouselBackground", "settingsLoaded", "banners", "fallbackUrl", "autoplayMs", "darkMode", "onBannerClick", "slides", "useMemo", "b", "activeIndex", "setActiveIndex", "useState", "isPaused", "setIsPaused", "useEffect", "effectiveAutoplayMs", "shouldAutoplay", "id", "i", "next", "img", "activeSlide", "hasTarget", "type", "imageOpacity", "imageClass", "goPrev", "goNext", "React", "slide", "idx", "e", "ArrowLeft", "ArrowRight", "_", "Toast", "message", "onClose", "containerClass", "iconContainerClass", "IconComponent", "Info", "CheckCircle", "AlertCircle", "AlertTriangle", "t", "X", "ConfirmModal", "isOpen", "title", "onConfirm", "onCancel", "confirmText", "cancelText", "isDangerous", "ErrorBoundary", "props", "error", "errorInfo", "QuickAddButton", "product", "onAdd", "qty", "setQty", "added", "setAdded", "handleAdd", "isMax", "isMin", "Minus", "Plus", "ProductCard", "p", "settings", "currentUser", "toggleFavorite", "setSelectedProduct", "manageCart", "calculateItemPrice", "cardBg", "cardBorder", "cardHoverBorder", "cardShadow", "imageBg", "textPrimary", "textSecondary", "infoBg", "borderColor", "Maximize2", "ImageIcon", "Star", "Heart", "prev", "CategoryModal", "isOpen", "onClose", "categories", "onAdd", "onRemove", "darkMode", "catName", "setCatName", "React", "e", "X", "FolderPlus", "Plus", "cat", "index", "Trash2", "ADMIN_PANEL_GUIDES", "AdminHowToUse", "guideKey", "setIsOpen", "useState", "guide", "FileQuestion", "section", "idx", "b", "i", "App", "view", "setView", "adminTab", "setAdminTab", "expenses", "setExpenses", "investments", "setInvestments", "purchases", "setPurchases", "confirmModal", "setConfirmModal", "isMenuOpen", "setIsMenuOpen", "isAdminMenuOpen", "setIsAdminMenuOpen", "setDarkMode", "saved", "appId", "setAppId", "storeResolution", "setStoreResolution", "storeSetupStoreIdInput", "setStoreSetupStoreIdInput", "isStoreSetupSaving", "setIsStoreSetupSaving", "isExportingBackup", "setIsExportingBackup", "isImportingBackup", "setIsImportingBackup", "currentUser", "setCurrentUser", "userData", "systemUser", "setSystemUser", "isLoading", "setIsLoading", "isProcessingOrder", "setIsProcessingOrder", "toasts", "setToasts", "adminOrderAlarmMuted", "setAdminOrderAlarmMuted", "orderAlarmContextRef", "useRef", "orderAlarmIntervalRef", "orderAlarmActiveRef", "orderAlarmToastShownRef", "orderAlarmUnlockListenerActiveRef", "lastOrdersSeenWriteRef", "products", "setProducts", "promos", "setPromos", "homeBanners", "setHomeBanners", "cart", "setCart", "cartHydratedFromRemoteRef", "liveCarts", "setLiveCarts", "orders", "setOrders", "users", "setUsers", "coupons", "setCoupons", "suppliers", "setSuppliers", "settings", "setSettings", "defaultSettings", "settingsLoaded", "setSettingsLoaded", "searchQuery", "setSearchQuery", "selectedCategory", "setSelectedCategory", "categoriesScrollRef", "isDraggingCategories", "setIsDraggingCategories", "startXCategories", "setStartXCategories", "scrollLeftCategories", "setScrollLeftCategories", "handleMouseDownCategories", "handleMouseLeaveCategories", "handleMouseUpCategories", "handleMouseMoveCategories", "walk", "authData", "setAuthData", "loginMode", "setLoginMode", "newExpense", "setNewExpense", "newInvestment", "setNewInvestment", "newPurchase", "setNewPurchase", "newHomeBanner", "setNewHomeBanner", "editingHomeBannerId", "setEditingHomeBannerId", "newSupplier", "setNewSupplier", "editingSupplierId", "setEditingSupplierId", "showSupplierModal", "setShowSupplierModal", "purchaseCart", "setPurchaseCart", "showCategoryModal", "setShowCategoryModal", "selectedProduct", "setSelectedProduct", "openConfirm", "title", "message", "onConfirm", "prev", "downloadJsonFile", "filename", "obj", "blob", "url", "a", "exportBackup", "auth", "token", "res", "data", "safeDate", "showToast", "importBackupFile", "file", "text", "parsed", "getPlanLimit", "plan", "getPlanAllowsCoupons", "handlePlanChange", "newPlan", "currentPlan", "currentLimit", "newLimit", "activeProducts", "p", "productsToDeactivate", "couponsToDeactivate", "sortedProducts", "salesA", "o", "activeCoupons", "c", "product", "updateDoc", "doc", "db", "coupon", "setPlanDowngradeInfo", "error", "reactivateProduct", "productId", "limit", "deactivateProduct", "checkoutData", "setCheckoutData", "appliedCoupon", "setAppliedCoupon", "showCouponModal", "setShowCouponModal", "useEffect", "hasTransfer", "hasCard", "newProduct", "setNewProduct", "editingId", "setEditingId", "showProductForm", "setShowProductForm", "settingsTab", "setSettingsTab", "newPromo", "setNewPromo", "promoSearch", "setPromoSearch", "selectedPromoProduct", "setSelectedPromoProduct", "promoProductQty", "setPromoProductQty", "isEditingPromo", "setIsEditingPromo", "editingPromoId", "setEditingPromoId", "newCoupon", "setNewCoupon", "editingPurchase", "setEditingPurchase", "aboutText", "setAboutText", "newCategory", "setNewCategory", "newTeamMember", "setNewTeamMember", "selectedOrder", "setSelectedOrder", "ordersLimit", "setOrdersLimit", "ordersCursor", "setOrdersCursor", "ordersHistory", "setOrdersHistory", "hasMoreOrders", "setHasMoreOrders", "showManualSaleModal", "setShowManualSaleModal", "metricsDetail", "setMetricsDetail", "showLeastSold", "setShowLeastSold", "saleData", "setSaleData", "viewUserCart", "setViewUserCart", "userPassModal", "setUserPassModal", "viewUserEdit", "setViewUserEdit", "newAdminPassword", "setNewAdminPassword", "userSearch", "setUserSearch", "userRoleFilter", "setUserRoleFilter", "showPlansModal", "setShowPlansModal", "selectedPlanOption", "setSelectedPlanOption", "planDowngradeInfo", "mpBrickController", "setMpBrickController", "isPaymentProcessing", "setIsPaymentProcessing", "paymentError", "setPaymentError", "isInitializingBrick", "cardPaymentBrickRef", "openManualSaleModal", "confirmManualSale", "productRef", "productSnap", "getDoc", "currentStock", "total", "newOrder", "addDoc", "collection", "increment", "fileInputRef", "msg", "type", "id", "t", "removeToast", "handleHomeBannerClick", "slide", "targetType", "targetId", "promo", "maxPurchasable", "item", "prod", "pStock", "maxForThisItem", "getRole", "email", "cleanEmail", "SUPER_ADMIN_EMAIL", "member", "m", "userDoc", "u", "isAdmin", "isEditor", "isRoleLoading", "hasAccess", "role", "isAdminUser", "isSuperAdminSession", "latestOrderIso", "useMemo", "v", "ordersLastSeenIso", "hasUnseenOrders", "toggleAdminOrderAlarmMuted", "useCallback", "next", "stopOrderAlarm", "ctx", "markOrdersSeen", "iso", "value", "startOrderAlarm", "AudioContextCtor", "scheduleBeep", "at", "osc", "gain", "tick", "now", "rawHostname", "normalizedHostname", "DEFAULT_APP_ID", "cancelled", "snap", "storeId", "createStoreId", "base", "rand", "bootstrapStoreData", "nowIso", "setDoc", "APP_VERSION", "registerHostname", "hostname", "normalizedStoreId", "debounceTimer", "remoteItems", "normalizedRemote", "prevCart", "hasChanges", "newCart", "currentProduct", "configRef", "unsubscribe", "onSnapshot", "didBootstrap", "isBootstrapping", "bootstrapAuth", "signInWithCustomToken", "signInAnonymously", "onAuthStateChanged", "user", "userDocRef", "primaryColor", "secondaryColor", "accentColor", "styleEl", "lightModeStyle", "unsubscribeFunctions", "snapshot", "productsData", "d", "team", "teamRoles", "mergedSettings", "promosSnap", "getDocs", "bannersSnap", "banners", "ao", "bo", "ad", "bd", "couponsSnap", "unsub", "isAuthenticatedUser", "isAdminViewActive", "ordersRef", "q", "constraints", "orderBy", "startAfter", "query", "where", "ordersData", "getDateMs", "ms", "err", "handleNextOrders", "lastId", "handlePrevOrders", "prevCursor", "activeCarts", "productsById", "map", "lastSyncedCartRef", "changed", "removed", "validated", "itemId", "productInStore", "comp", "cid", "cp", "fresh", "payload", "lastSavedSettingsRef", "currentSettingsStr", "autoSaveTimer", "settingsRef", "settingsToSave", "updateMetaTag", "selector", "content", "element", "updateMetaTagById", "updateLinkTag", "href", "pageTitle", "description", "keywords", "author", "ogImage", "link", "img", "canvas", "handleAuth", "isRegister", "superAdminAttempt", "isLocalhost", "usersPath", "fetchProfile", "uid", "setupProfile", "firebaseUser", "claimLegacyProfile", "normalizedEmail", "userCredential", "createUserWithEmailAndPassword", "profile", "normalizedEmailLower", "superEmailLower", "normalizedProfile", "input", "emailToUse", "authUser", "signInWithEmailAndPassword", "code", "raw", "bootRes", "bootData", "minimal", "handleForgotPassword", "sendPasswordResetEmail", "toggleFavorite", "currentFavs", "isAlreadyFav", "newFavs", "userRef", "manageCart", "quantityDelta", "existingItemIndex", "newQuantity", "updatedCart", "calculateItemPrice", "basePrice", "discount", "discounted", "cartSubtotal", "price", "calculateDiscountAmount", "discountValue", "buildWhatsappUrl", "baseLink", "trimmed", "digits", "isCouponValidForWhatsapp", "buildWhatsappCartMessage", "currency", "storeName", "lines", "userBits", "name", "quantity", "unit", "lineTotal", "couponToUse", "couponDiscount", "messageSubtotal", "messageShipping", "shippingFee", "messageTotal", "shippingLabel", "discountAmount", "deliverySettings", "finalTotal", "selectCoupon", "sendOrderConfirmationEmail", "orderData", "discountDetails", "getAuthenticatedUser", "existing", "hydrated", "resolve", "timeoutId", "confirmOrder", "effectiveUser", "initializeCardPaymentBrick", "reject", "s", "safeAmount", "safetyTimeout", "containerElem", "publicKey", "getMercadoPagoPublicKey", "bricksBuilder", "controller", "cardFormData", "response", "result", "confirmOrderAfterPayment", "detailedError", "mpPaymentId", "isCheckoutView", "isMP", "timer", "saveProductFn", "MAX_PRODUCTS_ENTREPRENEUR", "MAX_PRODUCTS_BUSINESS", "isEntrepreneur", "isBusiness", "productData", "handleImageUpload", "setTargetState", "imageField", "maxWidth", "reader", "event", "MAX_WIDTH", "MAX_HEIGHT", "width", "height", "dataUrl", "resetHomeBannerForm", "editHomeBannerFn", "banner", "saveHomeBannerFn", "orderValue", "deleteHomeBannerFn", "deleteDoc", "deleteProductFn", "handleManualSale", "finalizeOrderFn", "orderId", "deleteOrderFn", "orderRef", "orderSnap", "saveCouponFn", "couponData", "saveSupplierFn", "supplierData", "deletePurchaseFn", "purchase", "updatePurchaseFn", "pId", "oldData", "newData", "qtyDiff", "createCategoryFn", "updatedCategories", "addToPurchaseCart", "supplierId", "productPrice", "cost", "existingIndex", "updated", "removeFromPurchaseCart", "_", "updatePurchaseCartItem", "finalizePurchaseOrder", "batch", "writeBatch", "batchId", "timestamp", "newPurchaseRef", "newStock", "dashboardMetrics", "productStats", "initStats", "pid", "validOrders", "revenue", "acc", "expensesTotal", "purchasesTotal", "netIncome", "salesCount", "productMetadata", "qty", "trendingProducts", "stats", "liveProd", "meta", "starProductId", "maxSales", "count", "starProduct", "liveStar", "leastSoldProductId", "minSales", "leastSoldProduct", "timeline", "categoryStats", "dayKey", "monthKey", "yearKey", "agg", "key", "amount", "analytics", "totalSalesVolume", "salesByCategory", "lowStockThreshold", "lowStockProducts", "recentActivity", "transactions", "OrderDetailsModal", "order", "Clock", "CheckCircle", "User", "Truck", "CreditCard", "Package", "Ticket", "CouponSelectorModal", "availableCoupons", "isNotExpired", "isUserTarget", "isGlobal", "usedCount", "notExhausted", "userNotUsed", "Gift", "canApply", "AlertCircle", "ProductDetailModal", "setQty", "added", "setAdded", "isPromo", "stockLimit", "cartItem", "inCartQty", "availableToAdd", "hasStock", "isMaxInCart", "displayPrice", "handleAdd", "itemToAdd", "Sparkles", "Minus", "ShoppingCart", "ManualSaleModal", "handleProductChange", "Store", "MetricsDetailModal", "timeframe", "setTimeframe", "colorClass", "sortedByVal", "bestPeriod", "worstPeriod", "BarChart", "TrendingUp", "TrendingDown", "maxVal", "heightPct", "UserCartView", "cartItems", "Loader2", "UserEditForm", "initialData", "onSubmit", "onDelete", "isSaving", "formData", "setFormData", "isSuperAdminProfile", "Lock", "r", "Save", "AdminUserDrawer", "userCartItems", "setUserCartItems", "isLoadingCart", "setIsLoadingCart", "setIsSaving", "active", "initialFormState", "setInitialFormState", "cartDoc", "closeDrawer", "handleEditSubmit", "authUpdate", "firestoreUpdate", "handleDeleteUser", "loadingPrimaryColor", "Zap", "AlertTriangle", "filteredProducts", "matchesSearch", "matchesCategory", "Toast", "newStoreId", "Menu", "Search", "MessageCircle", "Instagram", "Moon", "Sun", "ShoppingBag", "Home", "Info", "Shield", "Flame", "HomeBannerCarouselBackground", "ArrowRight", "Headphones", "Filter", "Percent", "Tag", "promoProduct", "ProductCard", "ArrowLeft", "MapPin", "RefreshCw", "Banknote", "Building", "Mail", "Phone", "LogOut", "myCoupons", "purchasedItems", "Heart", "fid", "step", "SecurityManager", "LayoutDashboard", "Wallet", "Settings", "Users", "DollarSign", "maxRev", "x", "percentage", "monthExpenses", "totalVol", "revPct", "Star", "FileText", "Edit", "autoCost", "selectedProd", "targetProductName", "calculatedCost", "sup", "original", "inv", "ex", "memberInvestments", "totalInv", "totalCapital", "pct", "colors", "sharePercentage", "memberProfit", "Globe", "Copy", "filteredUsers", "matchesRole", "UserPlus", "Maximize2", "exists", "totalCost", "profit", "margin", "isProfitable", "Bell", "Eye", "ChevronLeft", "ChevronRight", "current", "isNearLimit", "deactivatedByPlan", "deactivatedManually", "totalDeactivated", "isSelected", "EyeOff", "Palette", "Share2", "Cog", "tab", "Briefcase", "Calendar", "cycle", "ImageIcon", "Play", "seconds", "safeSeconds", "targetItem", "targetName", "isEnabled", "Facebook", "Twitter", "Music", "Youtube", "Upload", "ExternalLink", "names", "curr", "AccessDenied", "PlansModalContent", "ConfirmModal", "newCat", "Suspense", "SustIABot", "activePlanId", "setActivePlanId", "selectedOption", "setSelectedOption", "colorClasses", "isActive", "isCurrentPlan", "Icon", "feat", "ChevronDown", "onBack", "rootElement", "root", "createRoot", "ErrorBoundary"]
}
