{
  "version": 3,
  "sources": ["../script.js"],
  "sourcesContent": ["\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFF\uFEFFimport React, { useState, useEffect, useRef, useMemo, useCallback, Suspense, lazy } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport {\n    ShoppingBag, X, User, Search, Zap, CheckCircle, MessageCircle, Instagram, Minus, Heart, Tag,\n    Plus, Trash2, Edit, AlertTriangle, RefreshCw, Bot, Send, LogIn, LogOut, Mail, CreditCard, Menu, Home,\n    Info, FileQuestion, Users, Package, LayoutDashboard, Settings, Ticket, Truck, PieChart, Wallet,\n    FileText, ArrowRight, ArrowLeft, DollarSign, BarChart3, ChevronRight, TrendingUp, TrendingDown,\n    Briefcase, Calculator, Save, AlertCircle, Phone, MapPin, Copy, ExternalLink, Shield, Trophy,\n    ShoppingCart, Archive, Play, FolderPlus, Eye, EyeOff, Clock, Calendar, Gift, Lock, Loader2, Star, Percent, Sparkles,\n    Flame, Image as ImageIcon, Filter, ChevronDown, ChevronUp, Store, BarChart, Globe, Headphones, Palette, Share2, Cog, Facebook, Twitter, Linkedin, Youtube, Bell, Music, Building, Banknote, Smartphone, UserPlus, Maximize2, Settings2, Sun, Moon, Upload\n} from 'lucide-react';\nimport { initializeApp } from 'firebase/app';\nimport { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, sendPasswordResetEmail, signInWithEmailAndPassword, createUserWithEmailAndPassword } from 'firebase/auth';\nimport {\n    getFirestore, collection, addDoc, onSnapshot, query, updateDoc, doc, getDocs, deleteDoc,\n    where, writeBatch, getDoc, increment, setDoc, arrayUnion, arrayRemove, orderBy, limit, startAfter\n} from 'firebase/firestore';\n\n// --- CONFIGURACI√ìN FIREBASE (PROYECTO: sustore-63266) ---\n// Nota: esta es la configuraci√≥n p√∫blica del SDK web. NO incluyas aqu√≠ el JSON de service account.\nconst firebaseConfig = {\n    apiKey: \"AIzaSyAfllte-D_I3h3TwBaiSL4KVfWrCSVh9ro\",\n    authDomain: \"sustore-63266.firebaseapp.com\",\n    projectId: \"sustore-63266\",\n    storageBucket: \"sustore-63266.firebasestorage.app\",\n    messagingSenderId: \"684651914850\",\n    appId: \"1:684651914850:web:f3df09e5caf6e50e9e533b\",\n    measurementId: \"G-X3K7XGYPRD\"\n};\n\nconst app = initializeApp(firebaseConfig);\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n// ID interno de la app (no es el appId de Firebase). Puedes cambiarlo si quieres diferenciar entornos.\nconst DEFAULT_APP_ID = \"sustore-63266-prod\";\nconst APP_VERSION = \"3.0.0\";\n\nlet mpPublicKeyPromise = null;\nasync function getMercadoPagoPublicKey() {\n    if (mpPublicKeyPromise) return mpPublicKeyPromise;\n    mpPublicKeyPromise = (async () => {\n        try {\n            const res = await fetch('/api/checkout?action=public_config', { method: 'GET' });\n            if (!res.ok) return null;\n            const data = await res.json().catch(() => ({}));\n            const key = String(data?.mpPublicKey || '').trim();\n            return key || null;\n        } catch (e) {\n            return null;\n        }\n    })();\n    return mpPublicKeyPromise;\n}\n\nconst setupSmoothWheelScroll = () => {\n    if (typeof window === 'undefined' || typeof document === 'undefined') return;\n    if (window.__smoothWheelScrollEnabled) return;\n    window.__smoothWheelScrollEnabled = true;\n\n    const reduceMotion = typeof window.matchMedia === 'function' && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    if (reduceMotion) return;\n\n    const getDocumentScrollingElement = () => document.scrollingElement || document.documentElement;\n    const elementStates = new WeakMap();\n\n    const clamp = (value, min, max) => Math.min(max, Math.max(min, value));\n    const maxScrollTopForEl = (el) => Math.max(0, el.scrollHeight - el.clientHeight);\n\n    const isScrollable = (el) => {\n        if (!el || !(el instanceof Element)) return false;\n        const style = window.getComputedStyle(el);\n        const overflowY = style.overflowY;\n        if (overflowY === 'hidden' || overflowY === 'visible') return false;\n        return el.scrollHeight > el.clientHeight + 1;\n    };\n\n    const findScrollableAncestor = (startEl) => {\n        let el = startEl;\n        while (el && el instanceof Element && el !== document.body && el !== document.documentElement) {\n            if (isScrollable(el)) return el;\n            el = el.parentElement;\n        }\n        return null;\n    };\n\n    const getState = (el) => {\n        const existing = elementStates.get(el);\n        if (existing) return existing;\n        const state = { rafId: null, velocity: 0, lastTs: 0 };\n        elementStates.set(el, state);\n        return state;\n    };\n\n    const animateElement = (el, ts) => {\n        const state = getState(el);\n        if (!state.lastTs) state.lastTs = ts;\n        const dt = Math.min(48, ts - state.lastTs);\n        state.lastTs = ts;\n\n        const frictionPerFrame = 0.86;\n        const friction = Math.pow(frictionPerFrame, dt / 16.67);\n\n        const current = el.scrollTop;\n        const next = clamp(current + state.velocity * (dt / 16.67), 0, maxScrollTopForEl(el));\n        el.scrollTop = next;\n\n        if (next === 0 || next === maxScrollTopForEl(el)) {\n            state.velocity *= 0.5;\n        }\n\n        state.velocity *= friction;\n\n        if (Math.abs(state.velocity) < 0.1) {\n            state.rafId = null;\n            state.velocity = 0;\n            state.lastTs = 0;\n            return;\n        }\n\n        state.rafId = window.requestAnimationFrame((nextTs) => animateElement(el, nextTs));\n    };\n\n    const onWheel = (e) => {\n        if (e.defaultPrevented) return;\n        if (e.ctrlKey || e.metaKey || e.shiftKey) return;\n        const targetEl = e.target instanceof Element ? e.target : null;\n        const scrollEl = (targetEl && findScrollableAncestor(targetEl)) || getDocumentScrollingElement();\n\n        const deltaX = e.deltaX;\n        let deltaY = e.deltaY;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) return;\n        if (!Number.isFinite(deltaY) || Math.abs(deltaY) < 0.01) return;\n\n        e.preventDefault();\n\n        if (e.deltaMode === 1) deltaY *= 40;\n        else if (e.deltaMode === 2) deltaY *= window.innerHeight;\n\n        const state = getState(scrollEl);\n        const strength = 0.9;\n        state.velocity += deltaY * strength;\n        state.velocity = clamp(state.velocity, -4500, 4500);\n        if (state.rafId === null) state.rafId = window.requestAnimationFrame((ts) => animateElement(scrollEl, ts));\n    };\n\n    const onResize = () => {\n        const docEl = getDocumentScrollingElement();\n        const state = getState(docEl);\n        state.velocity = clamp(state.velocity, -4500, 4500);\n    };\n\n    document.addEventListener('wheel', onWheel, { passive: false, capture: true });\n    window.addEventListener('resize', onResize, { passive: true });\n};\n\ntry { setupSmoothWheelScroll(); } catch (e) { }\n\n// === SEGURIDAD: Email de Super Admin ofuscado (m√∫ltiples capas) ===\nconst _sa = ['bGF1dGFyb2NvcmF6emE2M0BnbWFpbC5jb20=']; // Base64\nconst SUPER_ADMIN_EMAIL = (() => { try { return atob(_sa[0]); } catch (e) { return ''; } })();\n\n// === SEGURIDAD: Sistema Anti-Manipulaci√≥n Avanzado ===\nconst SecurityManager = {\n    sessionToken: null,\n    loginAttempts: {},\n    maxAttempts: 5,\n    lockoutTime: 300000, // 5 minutos\n    integrityChecks: {},\n\n    // Salt din√°mico basado en timestamp (m√°s seguro que salt fijo)\n    _generateSalt() {\n        const base = 'tienda_secure_2024';\n        const timestamp = Math.floor(Date.now() / 86400000); // Cambia cada d√≠a\n        return base + '_' + timestamp;\n    },\n\n    // Hash seguro para contrase√±as (SHA-256 con salt din√°mico)\n    async hashPassword(password) {\n        const encoder = new TextEncoder();\n        const salt = this._generateSalt();\n        const data = encoder.encode(password + salt);\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n    },\n\n    // Verificar contrase√±a hasheada\n    async verifyPassword(password, hash) {\n        const inputHash = await this.hashPassword(password);\n        return inputHash === hash;\n    },\n\n    // Rate limiting mejorado para login\n    canAttemptLogin(email) {\n        const key = this._hashKey(email.toLowerCase());\n        const now = Date.now();\n        const record = this.loginAttempts[key];\n\n        if (record && record.lockedUntil > now) {\n            return { allowed: false, remainingTime: Math.ceil((record.lockedUntil - now) / 1000) };\n        }\n\n        if (record && record.lockedUntil && record.lockedUntil < now) {\n            delete this.loginAttempts[key];\n        }\n\n        return { allowed: true };\n    },\n\n    // Hash de claves para no exponer emails en memoria\n    _hashKey(str) {\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            const char = str.charCodeAt(i);\n            hash = ((hash << 5) - hash) + char;\n            hash = hash & hash;\n        }\n        return 'k_' + Math.abs(hash).toString(36);\n    },\n\n    // Registrar intento fallido\n    recordFailedAttempt(email) {\n        const key = this._hashKey(email.toLowerCase());\n        if (!this.loginAttempts[key]) {\n            this.loginAttempts[key] = { count: 0, firstAttempt: Date.now() };\n        }\n        this.loginAttempts[key].count++;\n\n        if (this.loginAttempts[key].count >= this.maxAttempts) {\n            this.loginAttempts[key].lockedUntil = Date.now() + this.lockoutTime;\n            // Log seguro sin exponer email\n            console.warn('[Security] Account locked - too many failed attempts');\n        }\n    },\n\n    // Limpiar intentos despu√©s de login exitoso\n    clearAttempts(email) {\n        const key = this._hashKey(email.toLowerCase());\n        delete this.loginAttempts[key];\n    },\n\n    // Generar token de sesi√≥n con firma criptogr√°fica\n    generateSessionToken(userId) {\n        const payload = {\n            uid: userId,\n            iat: Date.now(),\n            exp: Date.now() + 86400000, // 24 horas\n            nonce: crypto.getRandomValues(new Uint32Array(1))[0].toString(36)\n        };\n        const token = btoa(JSON.stringify(payload));\n        const signature = this._signToken(token);\n        const fullToken = token + '.' + signature;\n        this.sessionToken = fullToken;\n        sessionStorage.setItem('_st', fullToken);\n        return fullToken;\n    },\n\n    // Firma simple del token\n    _signToken(token) {\n        let hash = 0;\n        const secret = 'tienda_secret_key_2024';\n        const toSign = token + secret;\n        for (let i = 0; i < toSign.length; i++) {\n            hash = ((hash << 5) - hash) + toSign.charCodeAt(i);\n            hash = hash & hash;\n        }\n        return Math.abs(hash).toString(36);\n    },\n\n    // Verificar token de sesi√≥n con validaci√≥n de expiraci√≥n\n    verifySession() {\n        const stored = sessionStorage.getItem('_st');\n        if (!stored || stored !== this.sessionToken) return false;\n\n        try {\n            const [payloadB64] = stored.split('.');\n            const payload = JSON.parse(atob(payloadB64));\n            // Verificar expiraci√≥n\n            if (payload.exp && payload.exp < Date.now()) {\n                this.invalidateSession();\n                return false;\n            }\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    // Invalidar sesi√≥n\n    invalidateSession() {\n        this.sessionToken = null;\n        sessionStorage.removeItem('_st');\n        localStorage.removeItem('sustore_user_data');\n    },\n\n    // Detectar manipulaci√≥n de React DevTools\n    detectManipulation() {\n        const stored = localStorage.getItem('sustore_user_data');\n        if (stored) {\n            try {\n                const userData = JSON.parse(stored);\n                // Verificar estructura v√°lida\n                if (!userData.id || userData.id.length < 10 ||\n                    !userData.email || !userData.email.includes('@')) {\n                    console.warn('[Security] Invalid session data detected');\n                    localStorage.removeItem('sustore_user_data');\n                    return true;\n                }\n                // Verificar que el rol no fue manipulado a admin ilegalmente\n                if (userData.role === 'admin' && !this._validateAdminClaim(userData)) {\n                    console.warn('[Security] Admin role manipulation detected');\n                    userData.role = 'user';\n                    localStorage.setItem('sustore_user_data', JSON.stringify(userData));\n                    return true;\n                }\n            } catch (e) {\n                localStorage.removeItem('sustore_user_data');\n                return true;\n            }\n        }\n        return false;\n    },\n\n    // Validar claim de admin (requiere verificaci√≥n del servidor)\n    _validateAdminClaim(userData) {\n        // 1. Permitir siempre al Super Admin (Hardcoded)\n        if (userData.email === SUPER_ADMIN_EMAIL) return true;\n\n        // 2. Permitir si tiene la flag de verificaci√≥n (seteada al loguear/cargar desde DB)\n        return userData._adminVerified === true;\n    },\n\n    // Sanitizar entrada del usuario (Anti-XSS)\n    sanitizeInput(input) {\n        if (typeof input !== 'string') return input;\n        return input\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#x27;')\n            .replace(/\\//g, '&#x2F;')\n            .replace(/javascript:/gi, '')\n            .replace(/on\\w+=/gi, '');\n    },\n\n    // Validar email\n    isValidEmail(email) {\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        return emailRegex.test(email) && email.length <= 254;\n    },\n\n    // Validar fortaleza de contrase√±a\n    isStrongPassword(password) {\n        return password.length >= 8 &&\n            /[A-Z]/.test(password) &&\n            /[a-z]/.test(password) &&\n            /[0-9]/.test(password);\n    },\n\n    // Protecci√≥n contra ataques de timing\n    async secureCompare(a, b) {\n        if (typeof a !== 'string' || typeof b !== 'string') return false;\n        const encoder = new TextEncoder();\n        const aBytes = encoder.encode(a);\n        const bBytes = encoder.encode(b);\n        if (aBytes.length !== bBytes.length) return false;\n\n        let result = 0;\n        for (let i = 0; i < aBytes.length; i++) {\n            result |= aBytes[i] ^ bBytes[i];\n        }\n        return result === 0;\n    },\n\n    // Bloquear acceso a consola en producci√≥n (anti-debugging)\n    protectConsole() {\n        if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('127.0.0.1')) {\n            // Desactivar console.log en producci√≥n para no exponer info\n            const noop = () => { };\n            ['log', 'debug', 'info', 'table', 'dir'].forEach(method => {\n                console[method] = noop;\n            });\n            // Mantener warn y error para debugging cr√≠tico\n        }\n    },\n\n    // Detectar DevTools abierto\n    detectDevTools() {\n        const threshold = 160;\n        const check = () => {\n            const widthDiff = window.outerWidth - window.innerWidth > threshold;\n            const heightDiff = window.outerHeight - window.innerHeight > threshold;\n            if (widthDiff || heightDiff) {\n                // DevTools detectado - no hacer nada visible pero loguear\n                // console.warn('[Security] DevTools detected');\n            }\n        };\n        // Verificar peri√≥dicamente\n        setInterval(check, 5000);\n    },\n\n    // Inicializar todas las protecciones\n    init() {\n        this.detectManipulation();\n        this.protectConsole();\n        this.detectDevTools();\n\n        // Limpiar datos sensibles de window\n        Object.defineProperty(window, 'SUPER_ADMIN_EMAIL', {\n            get: () => undefined,\n            configurable: false\n        });\n    }\n};\n\n// Inicializar protecciones de seguridad\nSecurityManager.init();\n\n// Configuraci√≥n por defecto\nconst defaultSettings = {\n    // --- Identidad de la Tienda ---\n    storeName: \"Tienda Online\",\n    primaryColor: \"#f97316\",\n    currency: \"$\",\n\n    ticket: {\n        brandName: \"\",\n        whatsappLink: \"\",\n        siteUrl: \"\"\n    },\n\n    // --- Administraci√≥n ---\n    admins: SUPER_ADMIN_EMAIL,\n    team: [{ email: SUPER_ADMIN_EMAIL, role: \"admin\", name: \"Administrador\" }],\n\n    // --- Contacto ---\n    sellerEmail: \"\",\n    instagramUser: \"\",\n    instagramLink: \"\",\n    whatsappLink: \"\",\n    showWhatsapp: false,\n    showFloatingWhatsapp: false,\n    showCartWhatsappCheckout: false,\n    showInstagram: false,\n\n    paymentTransfer: {\n        enabled: false,\n        holderName: \"\",\n        alias: \"\",\n        cbu: \"\"\n    },\n    paymentCash: false,\n    paymentMercadoPago: {\n        enabled: false\n    },\n\n    // --- Im√°genes ---\n    logoUrl: \"\",\n    heroUrl: \"\",\n    showHomeBannerCarousel: true,\n    homeBannerAutoplayMs: 5000,\n\n    // --- Configuraci√≥n de Tienda ---\n    markupPercentage: 0,\n    announcementMessage: \"\",\n    categories: [\"General\"],\n    aboutUsText: \"Bienvenido a nuestra tienda. Ofrecemos productos de calidad con env√≠o a todo el pa√≠s.\",\n\n    // --- SEO (Search Engine Optimization) ---\n    seoTitle: \"\",\n    seoDescription: \"Tu tienda online de confianza. Calidad y vanguardia en cada producto. Env√≠os a todo el pa√≠s.\",\n    seoKeywords: \"tienda online, productos, comprar, env√≠os\",\n    seoAuthor: \"\",\n    seoUrl: \"\",\n    seoImage: \"\",\n\n    // --- Textos de Carga ---\n    loadingTitle: \"\",\n    loadingText: \"Cargando sistema...\"\n};\n\n// --- COMPONENTES DE UI ---\n\n// Componente de Imagen con Lazy Loading\nconst LazyImage = ({ src, alt, className, placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzFhMWExYSIvPjwvc3ZnPg==' }) => {\n    const [isLoaded, setIsLoaded] = useState(false);\n    const [isInView, setIsInView] = useState(false);\n    const imgRef = useRef(null);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            ([entry]) => {\n                if (entry.isIntersecting) {\n                    setIsInView(true);\n                    observer.disconnect();\n                }\n            },\n            { rootMargin: '100px', threshold: 0.1 }\n        );\n\n        if (imgRef.current) {\n            observer.observe(imgRef.current);\n        }\n\n        return () => observer.disconnect();\n    }, []);\n\n    return (\n        <img\n            ref={imgRef}\n            src={isInView ? src : placeholder}\n            alt={alt}\n            className={`${className} transition-opacity duration-300 ${isLoaded ? 'opacity-100' : 'opacity-0'}`}\n            onLoad={() => setIsLoaded(true)}\n            loading=\"lazy\"\n        />\n    );\n};\n\nconst HomeBannerCarouselBackground = ({ settingsLoaded, banners, fallbackUrl, autoplayMs, darkMode, onBannerClick }) => {\n    const slides = useMemo(() => {\n        if (!Array.isArray(banners)) return [];\n        return banners.filter(b => b && b.enabled !== false && typeof b.imageUrl === 'string' && b.imageUrl.trim().length > 0);\n    }, [banners]);\n\n    const [activeIndex, setActiveIndex] = useState(0);\n    const [isPaused, setIsPaused] = useState(false);\n\n    useEffect(() => {\n        if (activeIndex >= slides.length) setActiveIndex(0);\n    }, [activeIndex, slides.length]);\n\n    const effectiveAutoplayMs = Number(autoplayMs);\n    const shouldAutoplay = settingsLoaded && !isPaused && slides.length > 1 && Number.isFinite(effectiveAutoplayMs) && effectiveAutoplayMs >= 1500;\n\n    useEffect(() => {\n        if (!shouldAutoplay) return;\n        const id = setInterval(() => {\n            setActiveIndex(i => (i + 1) % slides.length);\n        }, effectiveAutoplayMs);\n        return () => clearInterval(id);\n    }, [shouldAutoplay, slides.length, effectiveAutoplayMs]);\n\n    useEffect(() => {\n        if (slides.length <= 1) return;\n        const next = slides[(activeIndex + 1) % slides.length];\n        if (!next?.imageUrl) return;\n        const img = new Image();\n        img.src = next.imageUrl;\n    }, [slides, activeIndex]);\n\n    const activeSlide = slides[activeIndex] || null;\n    const hasTarget = (() => {\n        const type = activeSlide?.targetType || (activeSlide?.promoId ? 'promo' : activeSlide?.productId ? 'product' : 'none');\n        const id = activeSlide?.targetId || activeSlide?.promoId || activeSlide?.productId || '';\n        return type !== 'none' && !!id;\n    })();\n    const imageOpacity = 0.85;\n    const imageClass = `w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`;\n\n    const goPrev = () => {\n        setActiveIndex(i => {\n            const next = i - 1;\n            return next < 0 ? slides.length - 1 : next;\n        });\n    };\n\n    const goNext = () => {\n        setActiveIndex(i => (i + 1) % slides.length);\n    };\n\n    if (!settingsLoaded) {\n        return <div className=\"absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 animate-pulse\"></div>;\n    }\n\n    if (slides.length === 0) {\n        return fallbackUrl ? (\n            <img src={fallbackUrl} style={{ opacity: imageOpacity }} className={`absolute inset-0 w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105 ${darkMode ? '' : 'saturate-110 contrast-110'}`} />\n        ) : (\n            <div className={`absolute inset-0 opacity-60 ${darkMode ? 'bg-gradient-to-br from-orange-900/40 via-[#0a0a0a] to-slate-900/40' : 'bg-gradient-to-br from-orange-200/60 via-white to-slate-200/60'}`}>\n                <div className={`absolute inset-0 bg-[url('/noise.svg')] ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n            </div>\n        );\n    }\n\n    return (\n        <div\n            className={`absolute inset-0 overflow-hidden ${hasTarget ? 'cursor-pointer' : ''}`}\n            onClick={() => hasTarget && onBannerClick?.(activeSlide)}\n            onMouseEnter={() => setIsPaused(true)}\n            onMouseLeave={() => setIsPaused(false)}\n        >\n            <div\n                className=\"h-full w-full flex transition-transform duration-700 ease-in-out\"\n                style={{ transform: `translate3d(-${activeIndex * 100}%, 0, 0)`, willChange: 'transform' }}\n            >\n                {slides.map((slide, idx) => (\n                    <div key={slide.id || `${idx}-${slide.targetId || slide.productId || slide.promoId || 'slide'}`} className=\"w-full h-full flex-shrink-0 relative\">\n                        <img src={slide.imageUrl} style={{ opacity: imageOpacity }} className={imageClass} />\n                    </div>\n                ))}\n            </div>\n\n            {slides.length > 1 && (\n                <>\n                    <button\n                        type=\"button\"\n                        className=\"absolute left-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goPrev(); }}\n                        aria-label=\"Banner anterior\"\n                    >\n                        <ArrowLeft className=\"w-5 h-5\" />\n                    </button>\n                    <button\n                        type=\"button\"\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 z-20 w-11 h-11 rounded-full bg-black/40 border border-white/20 text-white backdrop-blur-md hover:bg-black/55 transition flex items-center justify-center pointer-events-auto\"\n                        onClick={(e) => { e.stopPropagation(); goNext(); }}\n                        aria-label=\"Banner siguiente\"\n                    >\n                        <ArrowRight className=\"w-5 h-5\" />\n                    </button>\n                    <div className=\"absolute bottom-4 inset-x-0 z-20 flex items-center justify-center gap-2 pointer-events-auto\" onClick={(e) => e.stopPropagation()}>\n                        {slides.map((_, idx) => (\n                            <button\n                                key={`dot-${idx}`}\n                                type=\"button\"\n                                aria-label={`Ir al banner ${idx + 1}`}\n                                className={`h-2.5 rounded-full transition-all duration-300 ${idx === activeIndex ? 'w-8 bg-white' : 'w-2.5 bg-white/40 hover:bg-white/70'}`}\n                                onClick={() => setActiveIndex(idx)}\n                            />\n                        ))}\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n\n// Componente de Notificaci√≥n (Toast)\nconst Toast = ({ message, type, onClose }) => {\n    let containerClass = \"fixed top-24 right-4 z-[9999] flex items-center gap-4 p-5 rounded-2xl border-l-4 backdrop-blur-xl animate-fade-up shadow-2xl transition-all duration-300\";\n    let iconContainerClass = \"p-2 rounded-full\";\n    let IconComponent = Info;\n\n    if (type === 'success') {\n        containerClass += \" border-green-500 text-green-400 bg-black/90 shadow-[0_0_20px_rgba(34,197,94,0.3)]\";\n        iconContainerClass += \" bg-green-500/20\";\n        IconComponent = CheckCircle;\n    } else if (type === 'error') {\n        containerClass += \" border-red-500 text-red-400 bg-black/90 shadow-[0_0_20px_rgba(239,68,68,0.3)]\";\n        iconContainerClass += \" bg-red-500/20\";\n        IconComponent = AlertCircle;\n    } else if (type === 'warning') {\n        containerClass += \" border-yellow-500 text-yellow-400 bg-black/90 shadow-[0_0_20px_rgba(234,179,8,0.3)]\";\n        iconContainerClass += \" bg-yellow-500/20\";\n        IconComponent = AlertTriangle;\n    } else {\n        containerClass += \" border-orange-500 text-orange-400 bg-black/90 shadow-[0_0_20px_rgba(249,115,22,0.3)]\";\n        iconContainerClass += \" bg-orange-500/20\";\n        IconComponent = Info;\n    }\n\n    useEffect(() => {\n        const t = setTimeout(onClose, 4000);\n        return () => clearTimeout(t);\n    }, [onClose]);\n\n    return (\n        <div className={containerClass}>\n            <div className={iconContainerClass}>\n                <IconComponent className=\"w-5 h-5\" />\n            </div>\n            <div>\n                <p className=\"font-bold text-sm tracking-wide\">{message}</p>\n            </div>\n            <button onClick={onClose} className=\"ml-2 text-white/50 hover:text-white transition\">\n                <X className=\"w-4 h-4\" />\n            </button>\n        </div>\n    );\n};\n\n// Componente Modal de Confirmaci√≥n\nconst ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = \"Confirmar\", cancelText = \"Cancelar\", isDangerous = false, darkMode = true }) => {\n    if (!isOpen) return null;\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-up p-4\">\n            <div className={`p-8 rounded-[2rem] max-w-sm w-full border transition-all duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 shadow-2xl' : 'bg-white border-slate-200 shadow-xl'} ${isDangerous && darkMode ? 'border-red-500/50 shadow-[0_0_30px_rgba(220,38,38,0.2)]' : isDangerous ? 'border-red-200 shadow-red-100' : ''}`}>\n                <div className={`w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto transition-colors duration-300 ${isDangerous ? 'bg-red-500/20 text-red-500' : (darkMode ? 'bg-orange-900/20 text-orange-500' : 'bg-orange-50 text-orange-600')}`}>\n                    {isDangerous ? <AlertTriangle className=\"w-8 h-8\" /> : <Info className=\"w-8 h-8\" />}\n                </div>\n                <h3 className={`text-xl font-black text-center mb-2 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{title}</h3>\n                <p className={`text-center mb-8 text-sm leading-relaxed transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{message}</p>\n                <div className=\"flex gap-3\">\n                    <button onClick={onCancel} className={`flex-1 py-3 rounded-xl font-bold transition ${darkMode ? 'bg-slate-800 hover:bg-slate-700 text-slate-300' : 'bg-slate-100 hover:bg-slate-200 text-slate-600'}`}>{cancelText}</button>\n                    <button onClick={onConfirm} className={`flex-1 py-3 text-white rounded-xl font-bold transition shadow-lg ${isDangerous ? 'bg-red-600 hover:bg-red-500 shadow-red-600/30' : 'bg-orange-600 hover:bg-orange-500 shadow-orange-600/30'}`}>{confirmText}</button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// Error Boundary\nclass ErrorBoundary extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = { hasError: false, error: null, errorInfo: null };\n    }\n    static getDerivedStateFromError(error) { return { hasError: true }; }\n    componentDidCatch(error, errorInfo) {\n        this.setState({ error, errorInfo });\n        console.error(\"Uncaught error:\", error, errorInfo);\n    }\n    render() {\n        if (this.state.hasError) {\n            return (\n                <div className=\"min-h-screen bg-black text-red-500 p-10 font-mono\">\n                    <h1 className=\"text-4xl font-bold mb-4\">CRITICAL SYSTEM FAILURE</h1>\n                    <div className=\"border border-red-900 bg-red-900/10 p-6 rounded-xl overflow-auto\">\n                        <h2 className=\"text-xl font-bold mb-2\">{this.state.error?.toString()}</h2>\n                        <pre className=\"text-xs text-red-400/70 whitespace-pre-wrap\">{this.state.errorInfo?.componentStack}</pre>\n                    </div>\n                    <button onClick={() => window.location.reload()} className=\"mt-8 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-500 font-bold\">REINICIAR SISTEMA</button>\n                </div>\n            );\n        }\n        return this.props.children;\n    }\n}\n\n// Componente Auxiliar para Bot√≥n de Agregar R√°pido\nconst QuickAddButton = ({ product, onAdd, darkMode }) => {\n    const [qty, setQty] = useState(1);\n    const [added, setAdded] = useState(false);\n\n    const handleAdd = (e) => {\n        e.stopPropagation();\n        onAdd(product, qty);\n        setAdded(true);\n        setTimeout(() => setAdded(false), 2000);\n        setQty(1);\n    };\n\n    const isMax = qty >= product.stock;\n    const isMin = qty <= 1;\n\n    return (\n        <div className=\"flex flex-col items-end gap-2\" onClick={(e) => e.stopPropagation()}>\n            <div className={`flex items-center rounded-lg ${darkMode ? 'bg-zinc-800' : 'bg-slate-100'} p-0.5 border ${darkMode ? 'border-zinc-700' : 'border-slate-200'}`}>\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                    disabled={isMin}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMin ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Minus className=\"w-3 h-3\" /></button>\n\n                <span className={`w-8 text-center text-xs font-bold font-mono ${darkMode ? 'text-white' : 'text-slate-900'}`}>{qty}</span>\n\n                <button\n                    onClick={(e) => { e.stopPropagation(); setQty(Math.min(product.stock, qty + 1)); }}\n                    disabled={isMax}\n                    className={`w-7 h-7 flex items-center justify-center rounded-md transition ${isMax ? 'opacity-30 cursor-not-allowed' : darkMode ? 'hover:bg-zinc-700 text-white' : 'hover:bg-slate-200 text-slate-700'}`}\n                ><Plus className=\"w-3 h-3\" /></button>\n            </div>\n\n            <button\n                onClick={handleAdd}\n                className={`w-full py-1.5 px-3 rounded-xl transition-all duration-300 shadow-md flex items-center justify-center gap-1.5 active:scale-95 ${added\n                    ? 'bg-green-500 text-white shadow-green-500/30'\n                    : darkMode\n                        ? 'bg-white text-black hover:bg-orange-400 hover:text-black shadow-white/10'\n                        : 'bg-orange-500 text-white hover:bg-orange-600 shadow-orange-500/20'\n                    }`}\n            >\n                {added ? (\n                    <CheckCircle className=\"w-4 h-4\" />\n                ) : (\n                    <>\n                        <Plus className=\"w-5 h-5 md:w-4 md:h-4\" />\n                    </>\n                )}\n            </button>\n        </div>\n    );\n};\n\n// --- COMPONENTE PRODUCT CARD OPTIMIZADO (MEMOIZED) ---\nconst ProductCard = React.memo(({ p, settings, currentUser, toggleFavorite, setSelectedProduct, manageCart, calculateItemPrice, darkMode }) => {\n    // Clases din√°micas basadas en el tema\n    const cardBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const cardBorder = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n    const cardHoverBorder = darkMode ? 'hover:border-orange-500/50' : 'hover:border-orange-400';\n    const cardShadow = darkMode ? 'hover:shadow-[0_0_30px_rgba(249,115,22,0.1)]' : 'shadow-sm hover:shadow-xl hover:shadow-orange-200/50';\n    const imageBg = darkMode ? 'bg-gradient-to-b from-slate-900 to-[#0a0a0a]' : 'bg-gradient-to-b from-slate-100 to-white';\n    const textPrimary = darkMode ? 'text-white' : 'text-slate-900';\n    const textSecondary = darkMode ? 'text-slate-400' : 'text-slate-600';\n    const infoBg = darkMode ? 'bg-[#0a0a0a]' : 'bg-white';\n    const borderColor = darkMode ? 'border-slate-800/50' : 'border-slate-200';\n\n    return (\n        <div className={`${cardBg} rounded-2xl sm:rounded-3xl border ${cardBorder} overflow-hidden group ${cardHoverBorder} ${cardShadow} transition duration-500 relative flex flex-col h-full animate-fade-in content-visibility-auto contain-content`}>\n\n            {/* Imagen y Badges */}\n            <div className={`h-56 sm:h-80 ${imageBg} m-2 sm:m-3 p-2 sm:p-3 flex items-center justify-center relative overflow-hidden cursor-zoom-in transition-all duration-500`} onClick={() => setSelectedProduct(p)}>\n                {/* Efecto Glow Fondo */}\n                <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition duration-500\"></div>\n\n                {p.image ? (\n                    <div className=\"w-full h-full flex items-center justify-center overflow-hidden\">\n                        <img\n                            src={p.image}\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                            onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.nextSibling.style.display = 'flex'; }}\n                            className={`max-w-full max-h-full rounded-xl sm:rounded-2xl border-2 ${darkMode ? 'border-orange-500/20' : 'border-slate-100'} shadow-lg z-10 transition-transform duration-700 group-hover:scale-105 ${p.stock <= 0 ? 'grayscale opacity-50' : ''}`}\n                        />\n                    </div>\n                ) : null}\n\n\n                {/* Bot√≥n Ver (Visible en Mobile/Touch) */}\n                <button\n                    onClick={(e) => {\n                        e.stopPropagation();\n                        setSelectedProduct(p);\n                    }}\n                    className={`absolute bottom-2 right-2 sm:bottom-4 sm:right-4 z-30 ${darkMode ? 'bg-black/60 border-white/20' : 'bg-white/90 border-slate-200'} backdrop-blur-md p-2 sm:p-3 rounded-full ${darkMode ? 'text-white' : 'text-slate-700'} border md:hidden`}\n                >\n                    <Maximize2 className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                </button>\n\n                {/* Fallback Icon */}\n                <div className=\"hidden w-full h-full flex items-center justify-center z-0 absolute inset-0\" style={{ display: p.image ? 'none' : 'flex' }}>\n                    <div className={`flex flex-col items-center justify-center ${darkMode ? 'text-slate-700' : 'text-slate-400'}`}>\n                        <ImageIcon className=\"w-12 h-12 sm:w-16 sm:h-16 mb-2 opacity-50\" />\n                        <span className=\"text-[10px] sm:text-xs font-bold uppercase tracking-widest opacity-50\">Sin Imagen</span>\n                    </div>\n                </div>\n\n                {/* OVERLAY AGOTADO (Mejorado) */}\n                {p.stock <= 0 && (\n                    <div className={`absolute inset-0 z-30 flex items-center justify-center ${darkMode ? 'bg-black/40' : 'bg-white/60'} backdrop-blur-[2px]`}>\n                        <div className=\"border-4 border-red-500 p-2 sm:p-4 -rotate-12 bg-black/80 shadow-[0_0_30px_rgba(239,68,68,0.5)] transform scale-90 sm:scale-110\">\n                            <span className=\"text-red-500 font-black text-lg sm:text-2xl md:text-3xl tracking-[0.15em] sm:tracking-[0.2em] uppercase\">AGOTADO</span>\n                        </div>\n                    </div>\n                )}\n\n                {/* BADGE: DESTACADO */}\n                {p.isFeatured && p.stock > 0 && (\n                    <div className=\"absolute top-0 left-0 bg-gradient-to-r from-yellow-500 to-orange-500 text-black text-[9px] sm:text-[10px] font-black px-2 sm:px-4 py-1 sm:py-1.5 rounded-br-xl sm:rounded-br-2xl uppercase tracking-wider z-20 shadow-lg flex items-center gap-1\">\n                        <Star className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 fill-current\" /> Destacado\n                    </div>\n                )}\n\n                {/* Descuento Badge */}\n                {p.discount > 0 && p.stock > 0 && !p.isFeatured && (\n                    <span className=\"absolute top-2 left-2 sm:top-4 sm:left-4 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg shadow-lg z-20 shadow-red-600/20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Combined Badge (Featured + Discount) */}\n                {p.discount > 0 && p.stock > 0 && p.isFeatured && (\n                    <span className=\"absolute top-8 sm:top-10 left-0 bg-red-600 text-white text-[9px] sm:text-[10px] font-black px-2 sm:px-3 py-0.5 sm:py-1 rounded-r-lg shadow-lg z-20\">\n                        -{p.discount}% OFF\n                    </span>\n                )}\n\n                {/* Bot√≥n Favorito (Funcional) */}\n                <button\n                    onClick={(e) => { e.stopPropagation(); toggleFavorite(p) }}\n                    className={`absolute top-2 right-2 sm:top-4 sm:right-4 p-2 sm:p-3 rounded-full z-20 transition shadow-lg backdrop-blur-sm border ${currentUser?.favorites?.includes(p.id) ? 'bg-red-500 text-white border-red-500 shadow-red-500/30' : darkMode ? 'bg-white/10 text-slate-300 border-white/10 hover:bg-white hover:text-red-500' : 'bg-slate-100 text-slate-500 border-slate-200 hover:bg-red-50 hover:text-red-500 hover:border-red-200'}`}\n                >\n                    <Heart className={`w-4 h-4 sm:w-5 sm:h-5 ${currentUser?.favorites?.includes(p.id) ? 'fill-current' : ''}`} />\n                </button>\n\n\n            </div>\n\n            {/* Informaci√≥n */}\n            <div className={`p-3 sm:p-4 flex-1 flex flex-col relative z-10 ${infoBg}`}>\n                <div className=\"flex justify-between items-start mb-2 sm:mb-3\">\n                    <p className={`text-[9px] sm:text-[10px] text-orange-500 font-black uppercase tracking-widest ${darkMode ? 'border-orange-900/30 bg-orange-900/10' : 'border-orange-200 bg-orange-50'} border px-1.5 sm:px-2 py-0.5 sm:py-1 rounded`}>\n                        {Array.isArray(p.categories) ? (p.categories.length > 0 ? p.categories[0] : p.category || 'Sin categor√≠a') : (p.category || 'Sin categor√≠a')}\n                    </p>\n                    {/* Estado de Stock */}\n                    {settings?.showStockCount !== false && p.stock > 0 && p.stock <= (settings?.lowStockThreshold || 5) ? (\n                        <span className=\"text-[9px] sm:text-[10px] text-red-500 font-bold flex items-center gap-1\">\n                            <AlertCircle className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" /> √öltimos {p.stock}\n                        </span>\n                    ) : null}\n                </div>\n\n                <h3 className={`${textPrimary} font-bold text-sm sm:text-base leading-tight mb-2 sm:mb-4 group-hover:text-orange-600 transition line-clamp-2 min-h-[2rem] sm:min-h-[2.5rem]`}>\n                    {p.name}\n                </h3>\n\n                <div className={`mt-auto pt-2 sm:pt-4 border-t ${borderColor} flex items-end justify-between`}>\n                    <div className=\"flex flex-col\">\n                        {p.discount > 0 && (\n                            <span className={`text-[10px] sm:text-xs ${textSecondary} line-through font-medium mb-0.5 sm:mb-1`}>\n                                ${p.basePrice.toLocaleString()}\n                            </span>\n                        )}\n                        <span className={`text-lg sm:text-2xl font-black ${textPrimary} tracking-tight flex items-center gap-1`}>\n                            ${calculateItemPrice(p.basePrice, p.discount).toLocaleString()}\n                        </span>\n                    </div>\n\n                    {/* Add to Cart with Quantity */}\n                    {p.stock > 0 && (\n                        <div\n                            className=\"flex items-center gap-2\"\n                            onClick={(e) => e.stopPropagation()}\n                        >\n                            <QuickAddButton\n                                product={p}\n                                onAdd={(product, qty) => manageCart(product, qty)}\n                                darkMode={darkMode}\n                            />\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div >\n    );\n}, (prev, next) => {\n    return (\n        prev.p.id === next.p.id &&\n        prev.p.stock === next.p.stock &&\n        prev.p.basePrice === next.p.basePrice &&\n        prev.p.name === next.p.name &&\n        prev.p.image === next.p.image &&\n        prev.currentUser?.favorites?.includes(prev.p.id) === next.currentUser?.favorites?.includes(next.p.id)\n    );\n});\n\n\n// --- Bot Product Card Component ---\nconst BotProductCard = ({ product, onAdd }) => {\n    const [qty, setQty] = useState(1);\n    const hasStock = product.stock > 0;\n\n    return (\n        <div className=\"min-w-[140px] w-[140px] bg-[#1a1a1a] border border-white/10 rounded-xl overflow-hidden shadow-lg snap-start flex-shrink-0 group flex flex-col\">\n            <div className=\"h-28 bg-white relative overflow-hidden\">\n                <img\n                    src={product.image || 'https://via.placeholder.com/150'}\n                    alt={product.name}\n                    className={`w-full h-full object-contain p-2 transition duration-300 ${hasStock ? 'group-hover:scale-110' : 'grayscale opacity-50'}`}\n                />\n                {!hasStock && (\n                    <div className=\"absolute inset-0 bg-black/50 flex items-center justify-center\">\n                        <span className=\"text-white text-[10px] font-bold bg-red-600 px-2 py-1 rounded\">AGOTADO</span>\n                    </div>\n                )}\n            </div>\n            <div className=\"p-2 flex-1 flex flex-col\">\n                <h4 className=\"text-white text-xs font-bold truncate mb-1\">{product.name}</h4>\n                <div className=\"flex justify-between items-center mb-2\">\n                    <p className=\"text-yellow-500 text-xs font-black\">${parseInt(product.basePrice).toLocaleString()}</p>\n                    {product.discount > 0 && <span className=\"text-[10px] text-red-400 font-bold\">-{product.discount}%</span>}\n                </div>\n\n                {hasStock ? (\n                    <div className=\"mt-auto space-y-2\">\n                        <div className=\"flex items-center justify-between bg-zinc-800 rounded-lg p-1 mb-2\">\n                            <button\n                                onClick={() => setQty(Math.max(1, qty - 1))}\n                                className=\"w-6 h-6 flex items-center justify-center text-white hover:bg-zinc-700 rounded transition font-bold\"\n                            >-</button>\n                            <span className=\"text-white text-xs font-mono font-bold\">{qty}</span>\n                            <button\n                                onClick={() => setQty(Math.min(product.stock, qty + 1))}\n                                className=\"w-6 h-6 flex items-center justify-center text-white hover:bg-zinc-700 rounded transition font-bold\"\n                            >+</button>\n                        </div>\n                        <button\n                            onClick={() => onAdd(product, qty)}\n                            className=\"w-full bg-yellow-600 hover:bg-yellow-500 text-white text-[10px] py-1.5 rounded-lg transition font-medium flex items-center justify-center gap-1 active:scale-95\"\n                        >\n                            Agregar <span className=\"text-xs\">+</span>\n                        </button>\n                    </div>\n                ) : (\n                    <button disabled className=\"w-full mt-auto bg-slate-700 text-slate-400 text-[10px] py-1.5 rounded-lg cursor-not-allowed\">\n                        Sin Stock\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n};\n\n// --- COMPONENTE SUSTIA (AI ASSISTANT) ---\nconst SustIABot = React.memo(({ settings, products, addToCart, controlPanel, coupons }) => {\n    // 1. Verificaci√≥n de Plan - Solo disponible en Plan Premium\n    const forceEnabled = (() => {\n        try {\n            const href = String(window.location.href || '');\n            if (href.includes('sustia=1')) return true;\n            return new URLSearchParams(window.location.search).get('sustia') === '1';\n        } catch { return false; }\n    })();\n    if (!forceEnabled && settings?.subscriptionPlan !== 'premium') return null;\n\n    const [isOpen, setIsOpen] = useState(false);\n\n    // Custom Bot Image (Configurable)\n    const botImage = settings?.botImage || \"sustia-ai-v2.jpg\";\n\n    const chatStorageKey = `sustore_sustia_chat_${DEFAULT_APP_ID}`;\n    const defaultBotMessage = { role: 'model', text: '¬°Hola! Soy SustIA ü§ñ, tu asistente personal. ¬øBuscas algo especial hoy? Puedo verificar stock y agregar productos a tu carrito.' };\n    const [messages, setMessages] = useState([defaultBotMessage]);\n    const [inputValue, setInputValue] = useState('');\n    const [isTyping, setIsTyping] = useState(false);\n    const [lastContext, setLastContext] = useState(null); // Para manejar contexto (S√≠/No)\n    const messagesEndRef = useRef(null);\n    const messagesRef = useRef(messages);\n    const inFlightRef = useRef(false);\n    const pendingTextRef = useRef(null);\n    const isMountedRef = useRef(true);\n\n    const safeProducts = Array.isArray(products) ? products : [];\n    const safeCoupons = Array.isArray(coupons) ? coupons : [];\n    const aiEnabled = !!settings?.aiAssistant?.enabled;\n\n    const normalizeText = (value) => {\n        if (value === null || value === undefined) return '';\n        return String(value).toLowerCase().normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").trim();\n    };\n\n    const tokenize = (value) => {\n        const t = normalizeText(value);\n        if (!t) return [];\n        const raw = t.split(/[\\s,.;:!?/()\\\\[\\]{}\"‚Äú‚Äù'‚Äô\\-+*_]+/).filter(Boolean);\n        const stop = new Set([\n            'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas',\n            'de', 'del', 'en', 'con', 'sin', 'para', 'por', 'a', 'al',\n            'que', 'como', 'cual', 'cuales', 'donde', 'cuando', 'quien', 'quienes',\n            'hola', 'buenas', 'buenos', 'dia', 'dias', 'tardes', 'noches',\n            'busco', 'buscar', 'tenes', 'tienes', 'precio', 'vale', 'cuesta',\n            'quiero', 'necesito', 'hay', 'me', 'te', 'mi', 'mis', 'tu', 'tus',\n            'agrega', 'agregar', 'agregame', 'agregalo', 'sumar', 'sumame', 'poner', 'pone',\n            'comprar', 'compralo', 'llevo', 'carrito', 'bolsa', 'cesta',\n            'mas', 'menos', 'muy', 'super', 're'\n        ]);\n        return raw.filter(w => w.length > 1 && !stop.has(w) && !/^\\d+$/.test(w));\n    };\n\n    const parseHumanNumber = (rawNumber, contextText) => {\n        if (!rawNumber) return null;\n        const n = parseFloat(String(rawNumber).replace(',', '.'));\n        if (!Number.isFinite(n)) return null;\n        const hasK = contextText.includes(`${rawNumber}k`) || contextText.includes(`${rawNumber} k`) || contextText.includes(`${rawNumber}mil`) || contextText.includes(`${rawNumber} mil`);\n        if (hasK) return n * 1000;\n        return n;\n    };\n\n    const parseQuantity = (t) => {\n        const text = normalizeText(t);\n        const m1 = text.match(/\\b(?:x|por)\\s*(\\d{1,3})\\b/);\n        if (m1) return Math.max(1, Math.min(99, parseInt(m1[1], 10)));\n        const m2 = text.match(/\\b(\\d{1,3})\\s*(?:u|ud|uds|unidad|unidades|pcs|piezas)\\b/);\n        if (m2) return Math.max(1, Math.min(99, parseInt(m2[1], 10)));\n        const m3 = text.match(/\\b(\\d{1,2})\\b/);\n        if (m3 && text.match(/\\b(agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|quiero|llevo|comprar)\\b/)) {\n            return Math.max(1, Math.min(99, parseInt(m3[1], 10)));\n        }\n        return 1;\n    };\n\n    const getProductCategories = (p) => {\n        const cats = [];\n        if (Array.isArray(p?.categories)) cats.push(...p.categories);\n        if (typeof p?.category === 'string' && p.category.trim()) cats.push(p.category);\n        return cats\n            .filter(Boolean)\n            .map(c => String(c).trim())\n            .filter(Boolean);\n    };\n\n    const getProductFinalPrice = (p) => {\n        const base = Number(p?.basePrice) || 0;\n        const disc = Number(p?.discount) || 0;\n        if (typeof calculateItemPrice === 'function') return calculateItemPrice(base, disc);\n        return base * (1 - disc / 100);\n    };\n\n    const aiContext = useMemo(() => {\n        const storeName = settings?.storeName ? String(settings.storeName) : '';\n        const aboutUsText = settings?.aboutUsText ? String(settings.aboutUsText) : '';\n\n        const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n        const pickupEnabled = !!settings?.shippingPickup?.enabled;\n        const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n        const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n        const pickupAddress = settings?.shippingPickup?.address || '';\n        const shippingParts = [];\n        if (pickupEnabled) shippingParts.push(`Retiro en local: ${pickupAddress ? pickupAddress : 'a coordinar'}.`);\n        if (deliveryEnabled) {\n            if (freeAbove > 0) shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n            else shippingParts.push(`Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n        }\n\n        const hasCard = !!settings?.paymentMercadoPago?.enabled;\n        const hasTransfer = !!settings?.paymentTransfer?.enabled;\n        const hasCash = !!settings?.paymentCash && pickupEnabled;\n        const payParts = [];\n        if (hasCard) payParts.push('Tarjeta (Mercado Pago)');\n        if (hasTransfer) payParts.push('Transferencia');\n        if (hasCash) payParts.push('Efectivo (solo retiro en local)');\n\n        const categories = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...safeProducts.flatMap(p => getProductCategories(p))])]\n            .map(c => String(c).trim())\n            .filter(Boolean)\n            .slice(0, 20);\n\n        const productHints = safeProducts\n            .filter(p => p && (Number(p.stock) || 0) > 0 && p.isActive !== false)\n            .map(p => ({\n                name: String(p.name || '').trim(),\n                price: getProductFinalPrice(p),\n                discount: Number(p.discount) || 0,\n                featured: !!p.isFeatured,\n                cats: getProductCategories(p).slice(0, 2).join(', ')\n            }))\n            .filter(p => p.name)\n            .sort((a, b) => (b.discount - a.discount) || (Number(b.featured) - Number(a.featured)) || (a.price - b.price))\n            .slice(0, 25)\n            .map(p => `${p.name} ‚Äî $${Math.round(p.price).toLocaleString()}${p.cats ? ` ‚Äî ${p.cats}` : ''}`);\n\n        return {\n            storeName,\n            aboutUsText,\n            shipping: shippingParts.join(' '),\n            payments: payParts.join(', '),\n            categories,\n            productHints\n        };\n    }, [settings, safeProducts]);\n\n    const callExternalAI = async ({ userText, history, signal }) => {\n        const res = await fetch('/api/ai/chat', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                userText,\n                messages: Array.isArray(history) ? history : [],\n                context: aiContext\n            }),\n            signal\n        });\n        const data = await res.json().catch(() => ({}));\n        if (!res.ok) throw new Error(data?.error || 'ai_error');\n        if (!data?.text || typeof data.text !== 'string') throw new Error('ai_invalid');\n        return { text: data.text };\n    };\n\n    // Auto-scroll al √∫ltimo mensaje\n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n    }, [messages, isOpen]);\n\n    useEffect(() => {\n        messagesRef.current = messages;\n    }, [messages]);\n\n    useEffect(() => {\n        return () => { isMountedRef.current = false; };\n    }, []);\n\n    // --- HERRAMIENTA DE B√öSQUEDA INTELIGENTE (FUZZY) ---\n    const fuzzySearch = (text, query) => {\n        if (!query || typeof query !== 'string') return false;\n        if (!text || typeof text !== 'string') return false;\n\n        const str = normalizeText(text);\n        const patt = normalizeText(query);\n\n        if (str.includes(patt)) return true; // Coincidencia exacta parcial\n\n        // Coincidencia aproximada simple (para Typos)\n        // Si m√°s del 70% de los caracteres est√°n presentes en orden relativo\n        let matches = 0;\n        let lastIndex = -1;\n        for (let char of patt) {\n            const index = str.indexOf(char, lastIndex + 1);\n            if (index > -1) {\n                matches++;\n                lastIndex = index;\n            }\n        }\n        return (matches / patt.length) > 0.75;\n    };\n\n    // --- CEREBRO LOCAL AVANZADO V5 (Universal & Contextual) ---\n    const callLocalBrain = async (userText, currentMessages) => {\n        await new Promise(resolve => setTimeout(resolve, 800)); // Simular pensamiento\n        const text = normalizeText(userText);\n        const qty = parseQuantity(text);\n\n        // 0. Detectar Saludos\n        if (text.match(/\\b(hola|holas|buen dia|buenos dias|buenas tardes|buenas noches|buenas|hello|hi|hey|que tal|como estas|como va|todo bien)\\b/)) {\n            return { text: \"¬°Hola! üëã ¬øQu√© quer√©s hacer? Pod√©s pedirme productos, ofertas, cupones, env√≠o, pagos o que agregue algo al carrito.\" };\n        }\n\n        if (text.match(/\\b(quien sos|que sos|que haces|sos real|sos un bot|asistente)\\b/)) {\n            const storeName = settings?.storeName ? ` de **${settings.storeName}**` : '';\n            return { text: `Soy SustIA${storeName}. Puedo ayudarte a encontrar productos, ver ofertas/cupones y armar el carrito m√°s r√°pido.` };\n        }\n\n        if (text.match(/\\b(categorias|categoria|rubros|rubro|secciones)\\b/)) {\n            const prodCats = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n            const cats = [...new Set([...(Array.isArray(settings?.categories) ? settings.categories : []), ...prodCats])]\n                .map(c => String(c).trim())\n                .filter(Boolean);\n            if (cats.length === 0) return { text: \"Todav√≠a no tengo categor√≠as configuradas. Decime qu√© est√°s buscando y lo resuelvo igual.\" };\n            const top = cats.slice(0, 10);\n            return { text: `Tenemos estas categor√≠as:\\n\\n${top.map(c => `- ${c}`).join('\\n')}\\n\\nDecime cu√°l te interesa y te muestro opciones.` };\n        }\n\n        if (text.match(/\\b(sobre|info|informacion|quienes somos|about)\\b/)) {\n            const about = settings?.aboutUsText || '';\n            if (about.trim()) return { text: about.trim() };\n            return { text: \"Esta tienda todav√≠a no carg√≥ su secci√≥n ‚ÄúSobre nosotros‚Äù. ¬øQuer√©s que te ayude a encontrar un producto?\" };\n        }\n\n        // 0.1 Comandos de Sistema (Universal)\n        if (controlPanel) {\n            if (text.match(/modo\\s*(?:oscuro|noche|dark)/)) {\n                controlPanel.setDarkMode(true);\n                return { text: \"He activado el modo oscuro üåô. ¬øMejor para tus ojos?\" };\n            }\n            if (text.match(/modo\\s*(?:claro|dia|light)/)) {\n                controlPanel.setDarkMode(false);\n                return { text: \"He activado el modo claro ‚òÄÔ∏è.\" };\n            }\n            if (text.match(/(?:ver|abrir|ir al)\\s*(?:carrito|bolsa|cesta)/)) {\n                controlPanel.openCart();\n                return { text: \"Abriendo tu carrito de compras... üõí\" };\n            }\n        }\n\n        if (text.match(/\\b(envio|envios|entrega|delivery|domicilio|retiro|retirar|local|pickup)\\b/)) {\n            const deliveryEnabled = !!settings?.shippingDelivery?.enabled;\n            const pickupEnabled = !!settings?.shippingPickup?.enabled;\n            const deliveryFee = Number(settings?.shippingDelivery?.fee) || 0;\n            const freeAbove = Number(settings?.shippingDelivery?.freeAbove) || 0;\n            const pickupAddress = settings?.shippingPickup?.address || '';\n\n            const lines = [];\n            if (pickupEnabled) {\n                lines.push(`üìç Retiro en local: ${pickupAddress ? `**${pickupAddress}**` : 'a coordinar'}.`);\n            }\n            if (deliveryEnabled) {\n                if (freeAbove > 0) {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()} (gratis desde $${freeAbove.toLocaleString()}).`);\n                } else {\n                    lines.push(`üöö Env√≠o a domicilio: $${deliveryFee.toLocaleString()}.`);\n                }\n            }\n            if (!pickupEnabled && !deliveryEnabled) {\n                lines.push(\"Todav√≠a no tengo configurado el m√©todo de entrega para esta tienda.\");\n            }\n            lines.push(\"Si me dec√≠s tu ciudad/zona, te digo lo mejor para vos.\");\n            return { text: lines.join('\\n') };\n        }\n\n        if (text.match(/\\b(pago|pagos|tarjeta|mercado\\s*pago|transferencia|cbu|alias|efectivo)\\b/)) {\n            const hasCard = !!settings?.paymentMercadoPago?.enabled;\n            const hasTransfer = !!settings?.paymentTransfer?.enabled;\n            const hasCash = !!settings?.paymentCash && !!settings?.shippingPickup?.enabled;\n            const wantsTransferData = hasTransfer && text.match(/\\b(alias|cbu|transferencia)\\b/);\n            const options = [];\n            if (hasCard) options.push(\"üí≥ Tarjeta (Mercado Pago)\");\n            if (hasTransfer) options.push(\"üè¶ Transferencia\");\n            if (hasCash) options.push(\"üíµ Efectivo (solo retiro en local)\");\n\n            if (options.length === 0) {\n                return { text: \"Todav√≠a no tengo m√©todos de pago configurados para esta tienda. Si quer√©s, te paso WhatsApp para coordinar.\" };\n            }\n            if (wantsTransferData) {\n                const holderName = settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName).trim() : '';\n                const alias = settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias).trim() : '';\n                const cbu = settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu).trim() : '';\n                const lines = [\"Para transferir, us√° estos datos:\"];\n                if (holderName) lines.push(`- Titular: ${holderName}`);\n                if (alias) lines.push(`- Alias: ${alias}`);\n                if (cbu) lines.push(`- CBU: ${cbu}`);\n                if (!holderName && !alias && !cbu) {\n                    lines.push(\"- A√∫n no est√°n cargados los datos de transferencia para esta tienda.\");\n                }\n                return { text: lines.join('\\n') };\n            }\n            return { text: `Pod√©s pagar con:\\n\\n${options.map(o => `- ${o}`).join('\\n')}\\n\\n¬øCon cu√°l prefer√≠s?` };\n        }\n\n        // 0.2 Detectar Ayuda/Contacto\n        if (text.match(/\\b(ayuda|soporte|contacto|human|persona|asesor)\\b/)) {\n            if (settings?.whatsappLink) {\n                return { text: `Claro. Si necesitas asistencia personalizada con un humano üßë‚Äçüíª, escr√≠benos a nuestro WhatsApp: ${settings.whatsappLink} üì≤` };\n            }\n            return { text: \"Estoy dise√±ado para ayudarte a encontrar productos las 24hs. ü§ñ ¬øBuscas algo en espec√≠fico?\" };\n        }\n\n        // 0.3 Detectar Promociones/Cupones\n        if (text.match(/\\b(descuento|promo|cupon|oferta|codigo|rebaja)\\b/)) {\n            const activeCoupons = safeCoupons.filter(c => c?.active);\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0);\n\n            if (activeCoupons.length > 0) {\n                const couponText = activeCoupons\n                    .filter(c => c?.code)\n                    .map(c => `üé´ **${c.code}** (${c.discountType === 'percentage' ? c.value + '%' : '$' + c.value} OFF)`)\n                    .join(\"\\n\");\n                return { text: `¬°S√≠! Tenemos estos cupones disponibles para ti:\\n\\n${couponText}\\n\\n¬°√ösalos al finalizar tu compra! üõí` };\n            } else if (deals.length > 0) {\n                setLastContext({ type: 'show_deals', data: deals.sort(() => 0.5 - Math.random()).slice(0, 5) });\n                return { text: `No tengo c√≥digos de cup√≥n activos ahora, pero s√≠ tenemos **${deals.length}** productos con descuento. ¬øQuer√©s que te muestre los mejores? üè∑Ô∏è` };\n            } else {\n                return { text: \"Por el momento no tengo c√≥digos promocionales activos, pero nuestros precios son los mejores del mercado. üòâ\" };\n            }\n        }\n\n        // 1. Manejo de Contexto (Conversacional)\n        if (lastContext) {\n            if (text.match(/\\b(si|claro|dale|bueno|yes|por favor|obvio)\\b/)) {\n                const ctx = lastContext;\n                setLastContext(null);\n                if (ctx.type === 'suggest_cross_sell') {\n                    return {\n                        text: \"¬°Excelente! Mira estas oportunidades que seleccion√© para ti: üî•\",\n                        products: ctx.data\n                    };\n                }\n                if (ctx.type === 'show_deals') {\n                    return {\n                        text: \"Listo. Estas son algunas ofertas que valen la pena ahora mismo:\",\n                        products: ctx.data\n                    };\n                }\n            } else if (text.match(/\\b(no|gracias|paso|cancelar|asi esta bien)\\b/)) {\n                setLastContext(null);\n                return { text: \"Entendido. ¬øNecesitas ayuda con algo m√°s? üòä\" };\n            }\n        }\n\n        // 2. Detectar Intenciones\n        const isCheaper = text.match(/(?:mas|muy|super)\\s*(?:barato|economico|bajo)|oferta|menos|mas\\s*economico/);\n        const isExpensive = text.match(/(?:mas|muy|super)\\s*(?:caro|mejor|calidad|top|premium)|costoso|lujo/);\n        const isBuying = text.match(/(?:agrega|agregar|agregame|sum[a√°]|pone|poner|met[e√©]|comprar|quiero|dame|carrito|llevo|lo quiero)/);\n\n        // 2.1 Filtros de Precio Inteligentes (NUEVO)\n        let minPrice = 0;\n        let maxPrice = Infinity;\n\n        // Detectar \"menos de X\"\n        const lessThanMatch = text.match(/(?:menos|menor|bajo)\\s*(?:de|a|que)?\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (lessThanMatch) {\n            const parsed = parseHumanNumber(lessThanMatch[1], text);\n            if (parsed !== null) maxPrice = parsed;\n        }\n\n        // Detectar \"entre X y Y\"\n        const betweenMatch = text.match(/entre\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?\\s*y\\s*\\$?\\s*(\\d+(?:[.,]\\d+)?)(?:\\s*(?:k|mil))?/);\n        if (betweenMatch) {\n            const parsedMin = parseHumanNumber(betweenMatch[1], text);\n            const parsedMax = parseHumanNumber(betweenMatch[2], text);\n            if (parsedMin !== null) minPrice = parsedMin;\n            if (parsedMax !== null) maxPrice = parsedMax;\n        }\n\n        // 3. Detectar Categor√≠a (Fuzzy)\n        const availableCategories = [...new Set(safeProducts.flatMap(p => getProductCategories(p)))];\n        const detectedCategoryVal = availableCategories.find(c => fuzzySearch(c, text) || fuzzySearch(text, c));\n        const targetCategory = detectedCategoryVal ? detectedCategoryVal.toLowerCase() : null;\n\n        // 4. B√∫squeda y Scoring de Productos\n        const synonyms = new Map([\n            ['celu', 'celular'],\n            ['cel', 'celular'],\n            ['tele', 'televisor'],\n            ['tv', 'televisor'],\n            ['compu', 'computadora'],\n            ['notebook', 'laptop'],\n            ['auris', 'auriculares'],\n            ['zapas', 'zapatillas'],\n            ['remera', 'camiseta'],\n            ['remeras', 'camisetas']\n        ]);\n        const keywords = tokenize(text).flatMap(k => {\n            const alt = synonyms.get(k);\n            return alt ? [k, alt] : [k];\n        });\n\n        let candidates = safeProducts.filter(p => (Number(p?.stock) || 0) > 0 && p?.isActive !== false);\n\n        // Aplicar filtros de precio\n        candidates = candidates.filter(p => {\n            const fp = getProductFinalPrice(p);\n            return fp >= minPrice && fp <= maxPrice;\n        });\n\n        // Filtro por categor√≠a detectada\n        if (targetCategory) {\n            candidates = candidates.filter(p => getProductCategories(p).some(c => normalizeText(c) === targetCategory));\n        }\n\n        // Scoring\n        if (keywords.length > 0) {\n            candidates = candidates.map(p => {\n                let score = 0;\n                const pName = normalizeText(p?.name || \"\");\n                const pDesc = normalizeText(p?.description || \"\");\n                const pCats = getProductCategories(p).map(c => normalizeText(c));\n\n                keywords.forEach(k => {\n                    if (!k) return;\n                    if (pName.includes(k)) score += 12;\n                    else if (fuzzySearch(pName, k)) score += 6;\n\n                    if (pDesc.includes(k)) score += 4;\n                    else if (fuzzySearch(pDesc, k)) score += 2;\n\n                    if (pCats.some(c => c.includes(k))) score += 6;\n                });\n                if ((Number(p?.discount) || 0) > 0) score += 2;\n                if (p?.isFeatured) score += 2;\n                return { ...p, score };\n            }).filter(p => p.score > 0);\n\n            // Ordenar por relevancia\n            candidates.sort((a, b) => b.score - a.score);\n        }\n\n        // 4.1 Recuperaci√≥n Contextual (Si el usuario dice \"agregalo\" y no hay keywords de producto)\n        // Buscamos en el historial previo si se mostraron productos\n        if (candidates.length === 0 && isBuying) {\n            // Buscar el √∫ltimo mensaje del modelo que tuviera productos\n            // currentMessages incluye el mensaje actual del usuario al final.\n            const history = [...currentMessages].reverse();\n            // history[0] es el mensaje del usuario actual\n            // history[1] deber√≠a ser el √∫ltimo del modelo\n            const lastModelMsg = history.find(m => m.role === 'model' && m.products && m.products.length > 0);\n\n            if (lastModelMsg) {\n                // Asumimos el primero de la lista anterior como el deseado\n                candidates = [lastModelMsg.products[0]];\n            }\n        }\n\n        // Ordenamiento por precio (secundario)\n        if (isCheaper) candidates.sort((a, b) => getProductFinalPrice(a) - getProductFinalPrice(b));\n        if (isExpensive) candidates.sort((a, b) => getProductFinalPrice(b) - getProductFinalPrice(a));\n\n        // 5. Respuesta\n        if (candidates.length === 0) {\n            // Inteligencia Proactiva: Si no hay match, ofrecer ofertas o destacados\n            const deals = safeProducts.filter(p => (Number(p?.discount) || 0) > 0 && (Number(p?.stock) || 0) > 0).slice(0, 3);\n            if (deals.length > 0) {\n                setLastContext({ type: 'suggest_cross_sell', data: deals });\n                return { text: \"Mmm, no encontr√© exactamente eso ü§î. ¬øPero te gustar√≠a ver nuestras ofertas del d√≠a? üè∑Ô∏è\" };\n            }\n            // Dynamic \"Smart\" Suggestions\n            let suggestionText = \"No encontr√© nada parecido. üòÖ\";\n\n            if (availableCategories.length > 0) {\n                // Get 3 random unique categories\n                const shuffled = availableCategories.sort(() => 0.5 - Math.random());\n                const topCats = shuffled.slice(0, 3).join(\", \");\n                suggestionText = `No tengo eso por ahora. Pero mira, en esta tienda tenemos cosas de: **${topCats}**. ¬øTe sirve algo de eso?`;\n            } else {\n                suggestionText = \"No encontr√© nada con ese nombre. ¬øQuiz√°s probando con otra palabra m√°s simple?\";\n            }\n\n            return { text: suggestionText };\n        }\n\n        const topMatches = candidates.slice(0, 5);\n\n        // Acci√≥n de Compra\n        if (isBuying && topMatches.length > 0) {\n            const best = topMatches[0];\n            addToCart(best, qty);\n\n            // --- CROSS-SELLING UNIVERSAL ---\n            // Buscar productos complementarios (Destacados o con Descuento que NO sean el que acaba de comprar)\n            // Esto funciona para cualquier tienda\n            const suggestions = safeProducts\n                .filter(p => (p.isFeatured || p.discount > 0) && p.id !== best.id && p.stock > 0)\n                .sort(() => 0.5 - Math.random()) // Mezclar\n                .slice(0, 3);\n\n            if (suggestions.length > 0) {\n                setLastContext({ type: 'suggest_cross_sell', data: suggestions });\n                return {\n                    text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí\\n\\n¬øTe gustar√≠a ver algunos productos destacados para complementar tu compra? üëÄ`,\n                    products: [best]\n                };\n            }\n\n            return {\n                text: `¬°Listo! Agregu√© **${qty}x ${best.name}** a tu carrito. üõí ¬øAlgo m√°s?`,\n                products: [best]\n            };\n        }\n\n        let msg = \"Aqu√≠ tienes algunas opciones:\";\n        if (targetCategory) msg = `Encontr√© esto en la categor√≠a ${targetCategory}:`;\n        if (isCheaper) msg = \"Las opciones m√°s econ√≥micas:\";\n\n        return {\n            text: msg,\n            products: topMatches\n        };\n    };\n\n    const withTimeout = async (promise, ms) => {\n        let timeoutId = null;\n        const timeoutPromise = new Promise((_, reject) => {\n            timeoutId = setTimeout(() => reject(new Error('timeout')), ms);\n        });\n        try {\n            return await Promise.race([promise, timeoutPromise]);\n        } finally {\n            if (timeoutId) clearTimeout(timeoutId);\n        }\n    };\n\n    const sendText = async (rawText, opts = {}) => {\n        const alreadyAddedUser = !!opts.alreadyAddedUser;\n        const text = String(rawText || '').trim().slice(0, 300);\n        if (!text) return;\n        if (inFlightRef.current) {\n            if (!alreadyAddedUser) {\n                const newMsgUserQueued = { role: 'client', text };\n                setMessages(prev => [...prev, newMsgUserQueued]);\n            }\n            pendingTextRef.current = { text, alreadyAddedUser: true };\n            return;\n        }\n\n        inFlightRef.current = true;\n        setInputValue('');\n\n        const newMsgUser = alreadyAddedUser ? null : { role: 'client', text };\n        const updatedHistory = [...(messagesRef.current || []), ...(newMsgUser ? [newMsgUser] : [])];\n\n        if (newMsgUser) {\n            setMessages(prev => [...prev, newMsgUser]);\n        }\n        setIsTyping(true);\n\n        try {\n            const localResponse = await withTimeout(callLocalBrain(text, updatedHistory), 12000);\n            if (!isMountedRef.current) return;\n            let finalText = localResponse?.text && typeof localResponse.text === 'string'\n                ? localResponse.text\n                : \"Perd√≥n, tuve un problema procesando eso. ¬øPod√©s reformularlo?\";\n            const safeProducts = Array.isArray(localResponse?.products) ? localResponse.products : undefined;\n\n            const shouldAskExternal = aiEnabled && (!safeProducts || safeProducts.length === 0) && /no encontr[e√©]|no tengo eso|no lo tengo|probando con otra palabra/i.test(finalText);\n            if (shouldAskExternal) {\n                const controller = new AbortController();\n                const id = setTimeout(() => controller.abort(), 8500);\n                try {\n                    const aiRes = await callExternalAI({ userText: text, history: updatedHistory, signal: controller.signal });\n                    if (aiRes?.text) finalText = aiRes.text;\n                } catch { }\n                clearTimeout(id);\n            }\n\n            setMessages(prev => [...prev, {\n                role: 'model',\n                text: finalText,\n                products: safeProducts\n            }]);\n        } catch (e) {\n            if (!isMountedRef.current) return;\n            const fallback = settings?.whatsappLink\n                ? `Uy, se me trab√≥ por un momento. Si quer√©s, habl√° por WhatsApp: ${settings.whatsappLink}`\n                : \"Uy, se me trab√≥ por un momento. ¬øProbamos de nuevo?\";\n            setMessages(prev => [...prev, { role: 'model', text: fallback }]);\n        } finally {\n            if (isMountedRef.current) setIsTyping(false);\n            inFlightRef.current = false;\n            const pending = pendingTextRef.current;\n            if (pending && pending.text) {\n                pendingTextRef.current = null;\n                setTimeout(() => sendText(pending.text, { alreadyAddedUser: pending.alreadyAddedUser === true }), 0);\n            }\n        }\n    };\n\n    const handleSend = async () => {\n        return sendText(inputValue);\n    };\n\n    const handleQuickAction = (value) => {\n        const text = String(value || '').trim();\n        if (!text) return;\n        sendText(text);\n    };\n\n    const clearChat = () => {\n        try {\n            localStorage.removeItem(chatStorageKey);\n        } catch { }\n        setLastContext(null);\n        setMessages([defaultBotMessage]);\n    };\n\n    const quickActions = [\n        { label: 'Ofertas', value: 'Mostrame ofertas' },\n        { label: 'Cupones', value: 'Ten√©s cupones?' },\n        { label: 'Env√≠o', value: 'C√≥mo es el env√≠o?' },\n        { label: 'Pagos', value: 'Qu√© medios de pago hay?' },\n        { label: 'Categor√≠as', value: 'Qu√© categor√≠as ten√©s?' },\n        { label: 'WhatsApp', value: 'Necesito hablar con una persona' }\n    ];\n\n\n\n    return (\n        <div className=\"fixed bottom-6 right-6 left-3 sm:left-auto z-[9999] flex flex-col items-end pointer-events-none\">\n            {isOpen && (\n                <div className=\"bg-[#0a0a0a] border border-yellow-500/30 rounded-2xl w-full max-w-sm sm:max-w-none sm:w-80 md:w-96 h-[min(550px,75dvh)] shadow-2xl flex flex-col mb-4 animate-fade-up overflow-hidden font-sans pointer-events-auto\">\n                    <div className=\"bg-gradient-to-r from-yellow-600 to-amber-600 p-4 flex justify-between items-center shadow-md relative z-10\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"p-1 bg-white/10 rounded-full backdrop-blur-sm overflow-hidden border border-white/20\">\n                                <img src={botImage} className=\"w-8 h-8 object-cover rounded-full opacity-90\" alt=\"SustIA\" />\n                            </div>\n                            <div>\n                                <h3 className=\"font-bold text-white text-sm\">SustIA</h3>\n                                <p className=\"text-[10px] text-white/80 flex items-center gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse\"></span>\n                                    Asistente Virtual\n                                </p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <button onClick={clearChat} className=\"text-white/80 hover:text-white p-1 hover:bg-white/10 rounded-lg transition\" title=\"Limpiar chat\">\n                                <Trash2 className=\"w-5 h-5\" />\n                            </button>\n                            <button onClick={() => setIsOpen(false)} className=\"text-white/80 hover:text-white p-1 hover:bg-white/10 rounded-lg transition\" title=\"Cerrar\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>\n\n                    <div className=\"bg-[#111] px-4 py-2 border-b border-white/5\">\n                        <div className=\"flex gap-2 overflow-x-auto pb-1 custom-scrollbar\">\n                            {quickActions.map(a => (\n                                <button\n                                    key={a.label}\n                                    type=\"button\"\n                                    data-testid={`quick-action-${a.label.toLowerCase()}`}\n                                    onClick={() => {\n                                        handleQuickAction(a.value);\n                                    }}\n                                    className=\"shrink-0 px-3 py-1.5 rounded-full text-[11px] font-bold border border-white/10 bg-[#1a1a1a] text-white/90 hover:bg-[#222] transition\"\n                                >\n                                    {a.label}\n                                </button>\n                            ))}\n                        </div>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-5 bg-[#111] custom-scrollbar relative\">\n                        {messages.map((m, i) => (\n                            <div key={i} className={`flex flex-col ${m.role === 'client' ? 'items-end' : 'items-start'}`}>\n                                <div className={`max-w-[85%] p-3.5 rounded-2xl text-sm shadow-sm ${m.role === 'client'\n                                    ? 'bg-yellow-600 text-white rounded-br-sm'\n                                    : 'bg-[#1a1a1a] text-slate-200 rounded-bl-sm border border-white/5'\n                                    }`}>\n                                    <p className=\"whitespace-pre-wrap leading-relaxed\">{m.text}</p>\n                                </div>\n\n                                {m.products && m.products.length > 0 && (\n                                    <div className=\"mt-3 flex gap-3 overflow-x-auto pb-2 w-full custom-scrollbar pl-1 snap-x\">\n                                        {m.products.map(product => (\n                                            <BotProductCard\n                                                key={product.id}\n                                                product={product}\n                                                onAdd={(p, qty) => {\n                                                    addToCart(p, qty);\n                                                    setMessages(prev => [...prev, { role: 'model', text: `Agregado ${qty}x ${p.name} al carrito! üõí` }]);\n                                                }}\n                                            />\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n                        {isTyping && (\n                            <div className=\"flex justify-start\">\n                                <div className=\"bg-[#1a1a1a] p-3 rounded-2xl rounded-bl-none border border-white/5 flex gap-1\">\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\"></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></span>\n                                    <span className=\"w-1.5 h-1.5 bg-slate-500 rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></span>\n                                </div>\n                            </div>\n                        )}\n                        <div ref={messagesEndRef} />\n                    </div>\n\n                    <div className=\"p-3 bg-[#0a0a0a] border-t border-white/10 relative z-0\">\n                        <form onSubmit={(e) => { e.preventDefault(); handleSend(); }} className=\"flex gap-2 items-center\">\n                            <input\n                                className=\"flex-1 bg-[#1a1a1a] border border-white/10 rounded-full px-4 py-2.5 text-sm text-white focus:border-yellow-500/50 outline-none transition placeholder:text-slate-600\"\n                                placeholder=\"Escribe aqu√≠...\"\n                                value={inputValue}\n                                onChange={e => setInputValue(e.target.value)}\n                            />\n                            <button type=\"submit\" className=\"p-2.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-full transition shadow-lg shadow-yellow-600/20 disabled:opacity-50 disabled:cursor-not-allowed\" disabled={isTyping || !inputValue.trim()}>\n                                <Send className=\"w-4 h-4\" />\n                            </button>\n                        </form>\n                    </div>\n                </div>\n            )}\n\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"pointer-events-auto w-14 h-14 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(234,179,8,0.4)] hover:scale-110 transition-transform group relative z-50\"\n            >\n                {isOpen ? <X className=\"w-6 h-6 text-white\" /> : <img src=\"sustia-ai-v2.jpg\" className=\"w-full h-full object-cover rounded-full opacity-95 hover:scale-110 transition-transform duration-300\" alt=\"SustIA\" />}\n                {!isOpen && (\n                    <span className=\"absolute -top-1 -right-1 flex h-4 w-4\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-4 w-4 bg-yellow-500 border border-black\"></span>\n                    </span>\n                )}\n            </button>\n        </div>\n    );\n}, (prevProps, nextProps) => {\n    // Custom comparison for performance optimization\n    // Only re-render if isOpen state changes internally (handled by internal state mainly)\n    // or if critical props change deep inside\n    if (prevProps.settings?.subscriptionPlan !== nextProps.settings?.subscriptionPlan) return false;\n    if (prevProps.products !== nextProps.products) return false;\n    // Don't re-render on addToCart change (function ref usually stable but check if it matters)\n    return true;\n});\n\nconst CategoryModal = ({ isOpen, onClose, categories, onAdd, onRemove, darkMode = true }) => {\n    const [catName, setCatName] = React.useState('');\n\n    if (!isOpen) return null;\n\n    const handleSubmit = (e) => {\n        e.preventDefault();\n        if (catName.trim()) {\n            onAdd(catName.trim());\n            setCatName('');\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-[10010] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in p-4\" onClick={onClose}>\n            <div className={`p-8 rounded-[2rem] max-w-md w-full relative border transition-all duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200 shadow-xl'}`} onClick={e => e.stopPropagation()}>\n                <button onClick={onClose} className={`absolute top-4 right-4 transition ${darkMode ? 'text-slate-500 hover:text-white' : 'text-slate-400 hover:text-slate-900'}`}>\n                    <X className=\"w-6 h-6\" />\n                </button>\n                <h3 className={`text-2xl font-bold mb-6 flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                    <FolderPlus className=\"w-6 h-6 text-orange-400\" /> Gestionar Categor√≠as\n                </h3>\n\n                <form onSubmit={handleSubmit} className=\"flex gap-2 mb-6\">\n                    <input\n                        className={`flex-1 p-3 rounded-xl border transition-all duration-300 ${darkMode ? 'bg-slate-900 border-slate-700 text-white focus:border-orange-500 outline-none' : 'bg-slate-50 border-slate-200 text-slate-900 focus:border-orange-500 outline-none'}`}\n                        placeholder=\"Nueva categor√≠a...\"\n                        value={catName}\n                        onChange={(e) => setCatName(e.target.value)}\n                        autoFocus\n                    />\n                    <button type=\"submit\" className=\"bg-orange-600 hover:bg-orange-500 text-white p-3 rounded-xl font-bold transition shadow-lg shadow-orange-600/20\">\n                        <Plus className=\"w-5 h-5\" />\n                    </button>\n                </form>\n\n                <div className=\"space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar\">\n                    {categories.map((cat, index) => (\n                        <div key={index} className={`flex items-center justify-between p-3 rounded-xl border group transition-all duration-300 ${darkMode ? 'bg-slate-900/50 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-100 hover:border-slate-200'}`}>\n                            <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>{cat}</span>\n                            <button\n                                onClick={() => onRemove(cat)}\n                                className={`transition opacity-0 group-hover:opacity-100 ${darkMode ? 'text-slate-600 hover:text-red-500' : 'text-slate-400 hover:text-red-600'}`}\n                            >\n                                <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                        </div>\n                    ))}\n                    {categories.length === 0 && (\n                        <p className={`text-center italic py-4 transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>No hay categor√≠as definidas</p>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst ADMIN_PANEL_GUIDES = {\n    dashboard: {\n        title: 'Inicio (Panel de Control)',\n        description: 'Ac√° ten√©s el resumen general de tu tienda: ventas, ingresos y m√©tricas para tomar decisiones r√°pidas.',\n        sections: [\n            {\n                title: 'Qu√© mirar primero',\n                bullets: [\n                    'Ingresos brutos y beneficio neto estimado para ver c√≥mo viene el mes.',\n                    'Rendimiento mensual para comparar meses recientes.',\n                    'Movimientos recientes para detectar ingresos/gastos r√°pido.'\n                ]\n            },\n            {\n                title: 'Acciones t√≠picas',\n                bullets: [\n                    'Us√° los botones/atajos del panel para ver detalles de m√©tricas y reportes.',\n                    'Registr√° ventas manuales si vendiste fuera del checkout (mostrador / en casa).'\n                ]\n            }\n        ]\n    },\n    orders: {\n        title: 'Pedidos',\n        description: 'Gestion√° los pedidos que entran: ver detalle, finalizar y eliminar.',\n        sections: [\n            {\n                title: 'C√≥mo operar',\n                bullets: [\n                    'Abr√≠ un pedido con el √≠cono de ojo para ver productos, datos del cliente y totales.',\n                    'Marc√° como finalizado con el √≠cono de tilde cuando ya est√© entregado/pagado.',\n                    'Elimin√° con el √≠cono de papelera solo si fue un pedido inv√°lido o duplicado.'\n                ]\n            },\n            {\n                title: 'Notificaci√≥n',\n                bullets: [\n                    'El bot√≥n ‚ÄúNotificaci√≥n pedidos‚Äù activa o mutea el sonido/alerta de nuevos pedidos (solo admins).'\n                ]\n            }\n        ]\n    },\n    products: {\n        title: 'Productos',\n        description: 'Administr√° tu cat√°logo: altas, edici√≥n, categor√≠as, stock y visibilidad.',\n        sections: [\n            {\n                title: 'Crear y organizar',\n                bullets: [\n                    'Us√° ‚ÄúAgregar Producto‚Äù para cargar nombre, imagen, precio y stock.',\n                    'Us√° ‚ÄúCategor√≠as‚Äù para crear/editar categor√≠as y ordenar el cat√°logo.'\n                ]\n            },\n            {\n                title: 'Stock y visibilidad',\n                bullets: [\n                    'Revis√° el stock para evitar vender sin disponibilidad.',\n                    'Si un producto est√° desactivado, no aparece en la tienda hasta reactivarlo.'\n                ]\n            },\n            {\n                title: 'L√≠mites de plan',\n                bullets: [\n                    'El contador muestra cu√°ntos productos ten√©s seg√∫n el plan; si est√°s cerca del l√≠mite, te avisa.'\n                ]\n            }\n        ]\n    },\n    promos: {\n        title: 'Promos',\n        description: 'Cre√° combos/promociones armando un paquete de productos con un precio final.',\n        sections: [\n            {\n                title: 'Crear una promo',\n                bullets: [\n                    'Pon√© nombre, precio e imagen (opcional) para mostrarla atractiva.',\n                    'Agreg√° productos al combo y ajust√° cantidades.',\n                    'Guard√° y revis√° que el precio final tenga sentido vs. el costo.'\n                ]\n            },\n            {\n                title: 'Edici√≥n y limpieza',\n                bullets: [\n                    'Edit√° una promo existente cuando cambien productos o precios.',\n                    'Elimin√° promos viejas para mantener el panel ordenado.'\n                ]\n            }\n        ]\n    },\n    coupons: {\n        title: 'Cupones',\n        description: 'Cre√° cupones de descuento por porcentaje o monto fijo, con l√≠mites y vencimiento.',\n        sections: [\n            {\n                title: 'Configurar un cup√≥n',\n                bullets: [\n                    'Defin√≠ el c√≥digo (en may√∫sculas), el tipo (porcentaje/fijo) y el valor.',\n                    'Opcional: m√≠nimo de compra, l√≠mite de usos y fecha de vencimiento.',\n                    'Eleg√≠ si es p√∫blico (para redes) o para un email espec√≠fico.'\n                ]\n            },\n            {\n                title: 'Usarlo y compartirlo',\n                bullets: [\n                    'Copi√° el c√≥digo con el bot√≥n de copiar y pasalo por WhatsApp/Instagram.',\n                    'Elimin√° cupones vencidos o que ya no quieras ofrecer.'\n                ]\n            },\n            {\n                title: 'Planes',\n                bullets: [\n                    'Si tu plan no habilita cupones, vas a ver el panel bloqueado y un acceso a planes.'\n                ]\n            }\n        ]\n    },\n    suppliers: {\n        title: 'Proveedores',\n        description: 'Guard√° proveedores y vinculalos a los productos que te abastecen.',\n        sections: [\n            {\n                title: 'Alta y datos',\n                bullets: [\n                    'Cre√° un proveedor con nombre, contacto, tel√©fono, IG y direcci√≥n (si aplica).',\n                    'Asoci√° productos para tener referencia r√°pida de qu√© compra va con qui√©n.'\n                ]\n            },\n            {\n                title: 'Mantenimiento',\n                bullets: [\n                    'Edit√° cuando cambie un contacto o dato fiscal.',\n                    'Elimin√° si ya no trabaj√°s con ese proveedor.'\n                ]\n            }\n        ]\n    },\n    purchases: {\n        title: 'Compras / Stock',\n        description: 'Registr√° reposiciones de stock y llev√° historial de compras a proveedores.',\n        sections: [\n            {\n                title: 'Registrar reposici√≥n',\n                bullets: [\n                    'Eleg√≠ el producto existente, pon√© cantidad y seleccion√° el proveedor.',\n                    'El sistema calcula un costo estimado y ajusta el stock al guardar.'\n                ]\n            },\n            {\n                title: 'Historial y correcciones',\n                bullets: [\n                    'Us√° el historial para revisar compras pasadas.',\n                    'Editar una compra puede ajustar el stock autom√°ticamente: revisalo antes de guardar.'\n                ]\n            }\n        ]\n    },\n    finance: {\n        title: 'Finanzas',\n        description: 'Registr√° inversiones/aportes y gastos para entender el capital y la rentabilidad.',\n        sections: [\n            {\n                title: 'Registrar movimientos',\n                bullets: [\n                    'Carg√° inversiones/aportes con socio, monto y fecha.',\n                    'Carg√° gastos/egresos con descripci√≥n, categor√≠a y fecha.'\n                ]\n            },\n            {\n                title: 'Lectura',\n                bullets: [\n                    'Us√° los totales para ver capital, egresos e impacto en el resultado.',\n                    'Manten√© al d√≠a los gastos para que el beneficio estimado sea realista.'\n                ]\n            }\n        ]\n    },\n    users: {\n        title: 'Usuarios',\n        description: 'Administr√° cuentas: b√∫squeda, roles y auditor√≠a para soporte.',\n        sections: [\n            {\n                title: 'Buscar y filtrar',\n                bullets: [\n                    'Busc√° por nombre, email o usuario desde la barra.',\n                    'Filtr√° por rol para encontrar r√°pido admins/usuarios.'\n                ]\n            },\n            {\n                title: 'Gesti√≥n',\n                bullets: [\n                    'Edit√° el perfil o permisos seg√∫n necesidad.',\n                    'Us√° la auditor√≠a para entender carritos/actividad si hay reclamos.'\n                ]\n            }\n        ]\n    }\n};\n\nfunction AdminHowToUse({ guideKey }) {\n    const [isOpen, setIsOpen] = useState(false);\n    const guide = ADMIN_PANEL_GUIDES[guideKey];\n    if (!guide) return null;\n\n    return (\n        <>\n            <button\n                onClick={() => setIsOpen(true)}\n                className=\"px-4 py-2 rounded-xl bg-slate-900/60 hover:bg-slate-900 text-slate-300 hover:text-white border border-slate-800 transition flex items-center gap-2 font-black text-[10px] uppercase tracking-widest\"\n                type=\"button\"\n            >\n                <FileQuestion className=\"w-4 h-4\" />\n                C√≥mo usar\n            </button>\n\n            {isOpen && (\n                <div\n                    className=\"fixed inset-0 z-[20050] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in\"\n                    onClick={() => setIsOpen(false)}\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                >\n                    <div\n                        className=\"w-full max-w-2xl bg-[#0a0a0a] border border-slate-700 rounded-[2rem] shadow-2xl overflow-hidden\"\n                        onClick={(e) => e.stopPropagation()}\n                    >\n                        <div className=\"flex items-start justify-between gap-4 p-6 border-b border-slate-800\">\n                            <div>\n                                <p className=\"text-[10px] font-black uppercase tracking-widest text-slate-500\">Gu√≠a r√°pida</p>\n                                <h2 className=\"text-2xl font-black text-white mt-1\">C√≥mo usar: {guide.title}</h2>\n                                <p className=\"text-slate-400 text-sm mt-2\">{guide.description}</p>\n                            </div>\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"p-2 rounded-xl bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white border border-slate-800 transition\"\n                                type=\"button\"\n                                aria-label=\"Cerrar\"\n                            >\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 max-h-[70vh] overflow-y-auto custom-scrollbar space-y-6\">\n                            {(guide.sections || []).map((section, idx) => (\n                                <div key={idx} className=\"bg-slate-900/20 border border-slate-800 rounded-2xl p-5\">\n                                    <h3 className=\"text-white font-black\">{section.title}</h3>\n                                    <ul className=\"list-disc pl-5 mt-3 space-y-2 text-sm text-slate-300\">\n                                        {(section.bullets || []).map((b, i) => (\n                                            <li key={i}>{b}</li>\n                                        ))}\n                                    </ul>\n                                </div>\n                            ))}\n                        </div>\n\n                        <div className=\"p-6 border-t border-slate-800 flex justify-end\">\n                            <button\n                                onClick={() => setIsOpen(false)}\n                                className=\"px-5 py-3 rounded-xl bg-orange-600 hover:bg-orange-500 text-white font-black transition\"\n                                type=\"button\"\n                            >\n                                Entendido\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </>\n    );\n}\n\n// --- APLICACI√ìN PRINCIPAL ---\nfunction App() {\n    // --- GESTI√ìN DE ESTADO (EXPANDIDA) ---\n\n    // Navegaci√≥n y UI\n    const [view, setView] = useState('store'); // store, cart, checkout, profile, login, register, admin, about, guide\n    const [adminTab, setAdminTab] = useState('dashboard');\n    const [expenses, setExpenses] = useState([]);\n    const [investments, setInvestments] = useState([]);\n    const [purchases, setPurchases] = useState([]);\n    const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: null }); // dashboard, products, coupons, users, suppliers, settings, finance\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n    const [isAdminMenuOpen, setIsAdminMenuOpen] = useState(false);\n    const [darkMode, setDarkMode] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_dark_mode');\n            return saved !== null ? JSON.parse(saved) : false; // Default to light mode (blanco)\n        } catch (e) { return false; }\n    });\n    const [appId, setAppId] = useState(null);\n    const [storeResolution, setStoreResolution] = useState({ status: 'resolving', hostname: '', normalizedHostname: '', storeId: null, error: null });\n    const [storeSetupStoreIdInput, setStoreSetupStoreIdInput] = useState('');\n    const [isStoreSetupSaving, setIsStoreSetupSaving] = useState(false);\n    const [isExportingBackup, setIsExportingBackup] = useState(false);\n    const [isImportingBackup, setIsImportingBackup] = useState(false);\n\n    // Usuarios y Autenticaci√≥n\n    const [currentUser, setCurrentUser] = useState(() => {\n        try {\n            const saved = localStorage.getItem('sustore_user_data');\n            if (!saved) return null;\n\n            const userData = JSON.parse(saved);\n\n            // Validar que el usuario tenga los campos m√≠nimos requeridos\n            // Si no tiene id, email o name, es un usuario inv√°lido o corrupto\n            if (!userData || !userData.id || !userData.email || !userData.name) {\n                // Limpiar datos corruptos o incompletos\n                localStorage.removeItem('sustore_user_data');\n                return null;\n            }\n\n            return userData;\n        } catch (e) {\n            // Si hay error al parsear, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n            return null;\n        }\n    });\n    const [systemUser, setSystemUser] = useState(null);\n    const [isLoading, setIsLoading] = useState(true);\n    const [isProcessingOrder, setIsProcessingOrder] = useState(false);\n    const [toasts, setToasts] = useState([]);\n\n    const [adminOrderAlarmMuted, setAdminOrderAlarmMuted] = useState(() => {\n        try {\n            return localStorage.getItem('sustore_admin_order_alarm_muted') === '1';\n        } catch (e) { return false; }\n    });\n\n    const orderAlarmContextRef = useRef(null);\n    const orderAlarmIntervalRef = useRef(null);\n    const orderAlarmActiveRef = useRef(false);\n    const orderAlarmToastShownRef = useRef(false);\n    const orderAlarmUnlockListenerActiveRef = useRef(false);\n    const lastOrdersSeenWriteRef = useRef(null);\n\n\n    // Datos Principales\n    const [products, setProducts] = useState([]);\n    const [promos, setPromos] = useState([]); // Nuevo estado para Promos\n    const [homeBanners, setHomeBanners] = useState([]);\n    const [cart, setCart] = useState(() => {\n        try {\n            const saved = JSON.parse(localStorage.getItem('sustore_cart'));\n            return Array.isArray(saved) ? saved : [];\n        } catch (e) { return []; }\n    });\n    const cartHydratedFromRemoteRef = useRef(false);\n    const [liveCarts, setLiveCarts] = useState([]); // Monitor de carritos en tiempo real\n    const [orders, setOrders] = useState([]);\n    const [users, setUsers] = useState([]);\n    const [coupons, setCoupons] = useState([]);\n    const [suppliers, setSuppliers] = useState([]);\n\n    const [settings, setSettings] = useState(defaultSettings);\n    const [settingsLoaded, setSettingsLoaded] = useState(false); // Indica si los settings ya se cargaron de Firebase\n\n    // Estados de Interfaz de Usuario\n    const [searchQuery, setSearchQuery] = useState('');\n    const [selectedCategory, setSelectedCategory] = useState('');\n\n    // --- DRAG TO SCROLL (Categor√≠as) ---\n    const categoriesScrollRef = useRef(null);\n    const [isDraggingCategories, setIsDraggingCategories] = useState(false);\n    const [startXCategories, setStartXCategories] = useState(0);\n    const [scrollLeftCategories, setScrollLeftCategories] = useState(0);\n\n    const handleMouseDownCategories = (e) => {\n        setIsDraggingCategories(true);\n        setStartXCategories(e.pageX - categoriesScrollRef.current.offsetLeft);\n        setScrollLeftCategories(categoriesScrollRef.current.scrollLeft);\n    };\n\n    const handleMouseLeaveCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseUpCategories = () => {\n        setIsDraggingCategories(false);\n    };\n\n    const handleMouseMoveCategories = (e) => {\n        if (!isDraggingCategories) return;\n        e.preventDefault();\n        const x = e.pageX - categoriesScrollRef.current.offsetLeft;\n        const walk = (x - startXCategories) * 2; // Velocidad de desplazamiento\n        categoriesScrollRef.current.scrollLeft = scrollLeftCategories - walk;\n    };\n\n\n    // Formularios de Autenticaci√≥n\n    const [authData, setAuthData] = useState({\n        email: '',\n        password: '',\n        name: '',\n        username: '',\n        dni: '',\n        phone: ''\n    });\n    const [loginMode, setLoginMode] = useState(true);\n\n    // Estados para Nuevos Formularios (Finanzas y Compras)\n    const [newExpense, setNewExpense] = useState({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n    const [newInvestment, setNewInvestment] = useState({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n    const [newPurchase, setNewPurchase] = useState({ productId: '', supplierId: '', quantity: 1, cost: 0, isNewProduct: false });\n    const [newHomeBanner, setNewHomeBanner] = useState({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    const [editingHomeBannerId, setEditingHomeBannerId] = useState(null);\n\n    // Estado para Proveedores (Restaurado)\n    const [newSupplier, setNewSupplier] = useState({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n    const [editingSupplierId, setEditingSupplierId] = useState(null);\n    const [showSupplierModal, setShowSupplierModal] = useState(false);\n\n    // Estado para Carrito de Compras (Pedidos Mayoristas)\n    const [purchaseCart, setPurchaseCart] = useState([]);\n\n    // Estado para Modal de Crear Categor√≠a\n    const [showCategoryModal, setShowCategoryModal] = useState(false);\n\n    // Estado para Detalle de Producto / Promo (Zoom)\n    const [selectedProduct, setSelectedProduct] = useState(null);\n\n    // --- HELPERS ---\n\n    const openConfirm = (title, message, onConfirm) => {\n        setConfirmModal({\n            isOpen: true,\n            title,\n            message,\n            onConfirm: async () => {\n                await onConfirm();\n                setConfirmModal(prev => ({ ...prev, isOpen: false }));\n            },\n            onCancel: () => setConfirmModal(prev => ({ ...prev, isOpen: false }))\n        });\n    };\n\n    const downloadJsonFile = (filename, obj) => {\n        const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json;charset=utf-8' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        setTimeout(() => URL.revokeObjectURL(url), 1000);\n    };\n\n    const exportBackup = async () => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n        setIsExportingBackup(true);\n        try {\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/export-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({}),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo exportar');\n            const safeDate = new Date().toISOString().replace(/[:.]/g, '-');\n            downloadJsonFile(`backup-${appId}-${safeDate}.json`, data);\n            showToast('Backup exportado.', 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo exportar', 'error');\n        } finally {\n            setIsExportingBackup(false);\n        }\n    };\n\n    const importBackupFile = async (file) => {\n        if (!appId) throw new Error('Tienda no configurada');\n        if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n        setIsImportingBackup(true);\n        try {\n            const text = await file.text();\n            const parsed = JSON.parse(text);\n            const token = await auth.currentUser.getIdToken();\n            const res = await fetch('/api/admin/import-store', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json', 'x-store-id': appId, 'Authorization': `Bearer ${token}` },\n                body: JSON.stringify({ backup: parsed }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (!res.ok) throw new Error(data.error || 'No se pudo importar');\n            showToast(`Backup importado (${data.written || 0} docs).`, 'success');\n        } catch (e) {\n            showToast(e?.message || 'No se pudo importar', 'error');\n        } finally {\n            setIsImportingBackup(false);\n        }\n    };\n\n    // --- FUNCI√ìN PARA MANEJAR CAMBIO DE PLAN (DOWNGRADE) ---\n    const getPlanLimit = (plan) => {\n        switch (plan) {\n            case 'premium': return Infinity;\n            case 'business': return 50;\n            case 'entrepreneur':\n            default: return 30;\n        }\n    };\n\n    const getPlanAllowsCoupons = (plan) => {\n        return plan === 'business' || plan === 'premium';\n    };\n\n    const handlePlanChange = async (newPlan) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const currentLimit = getPlanLimit(currentPlan);\n        const newLimit = getPlanLimit(newPlan);\n\n        // Si es upgrade (m√°s productos permitidos), simplemente cambiar\n        if (newLimit >= currentLimit) {\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`¬°Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}!`, 'success');\n            return;\n        }\n\n        // Es un DOWNGRADE - verificar l√≠mites\n        const activeProducts = products.filter(p => p.isActive !== false);\n        const productsToDeactivate = [];\n        const couponsToDeactivate = [];\n\n        // Si hay m√°s productos activos que el nuevo l√≠mite\n        if (activeProducts.length > newLimit) {\n            // Ordenar por ventas (m√°s vendidos quedan activos) o por fecha de creaci√≥n\n            const sortedProducts = [...activeProducts].sort((a, b) => {\n                // Priorizar productos m√°s vendidos\n                const salesA = orders.filter(o => o.items?.some(i => i.productId === a.id)).length;\n                const salesB = orders.filter(o => o.items?.some(i => i.productId === b.id)).length;\n                return salesB - salesA; // M√°s vendidos primero\n            });\n\n            // Los productos despu√©s del l√≠mite se desactivan\n            for (let i = newLimit; i < sortedProducts.length; i++) {\n                productsToDeactivate.push(sortedProducts[i]);\n            }\n        }\n\n        // Si el nuevo plan no permite cupones, desactivar todos los cupones activos\n        if (!getPlanAllowsCoupons(newPlan)) {\n            const activeCoupons = coupons.filter(c => c.isActive !== false);\n            couponsToDeactivate.push(...activeCoupons);\n        }\n\n        // Si hay productos/cupones a desactivar, mostrar confirmaci√≥n\n        if (productsToDeactivate.length > 0 || couponsToDeactivate.length > 0) {\n            const message = `\n                ${productsToDeactivate.length > 0 ? `‚Ä¢ ${productsToDeactivate.length} producto(s) ser√°n desactivados (se conservan los ${newLimit} m√°s vendidos)\\n` : ''}\n                ${couponsToDeactivate.length > 0 ? `‚Ä¢ ${couponsToDeactivate.length} cup√≥n(es) ser√°n desactivados (el plan ${newPlan === 'entrepreneur' ? 'Emprendedor' : ''} no incluye cupones)\\n` : ''}\n                \n                Los productos y cupones NO se eliminar√°n, solo se desactivar√°n. Podr√°s reactivarlos manualmente si mejoras tu plan.\n            `;\n\n            openConfirm(\n                '‚ö†Ô∏è Cambio de Plan - Atenci√≥n',\n                message,\n                async () => {\n                    try {\n                        // Desactivar productos excedentes\n                        for (const product of productsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Desactivar cupones si el plan no los soporta\n                        for (const coupon of couponsToDeactivate) {\n                            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', coupon.id), {\n                                isActive: false,\n                                deactivatedByPlan: true,\n                                deactivatedAt: new Date().toISOString()\n                            });\n                        }\n\n                        // Actualizar el plan\n                        setSettings({ ...settings, subscriptionPlan: newPlan });\n\n                        // Guardar info del downgrade para mostrar advertencias\n                        setPlanDowngradeInfo({\n                            showWarning: true,\n                            deactivatedProducts: productsToDeactivate.map(p => p.id),\n                            deactivatedCoupons: couponsToDeactivate.map(c => c.id),\n                            previousPlan: currentPlan,\n                            newPlan: newPlan\n                        });\n\n                        showToast(`Plan cambiado. ${productsToDeactivate.length} producto(s) y ${couponsToDeactivate.length} cup√≥n(es) fueron desactivados.`, 'warning');\n                    } catch (error) {\n                        console.error('Error al cambiar de plan:', error);\n                        showToast('Error al cambiar de plan', 'error');\n                    }\n                }\n            );\n        } else {\n            // No hay nada que desactivar, simplemente cambiar el plan\n            setSettings({ ...settings, subscriptionPlan: newPlan });\n            showToast(`Plan actualizado a ${newPlan === 'premium' ? 'Premium' : newPlan === 'business' ? 'Negocio' : 'Emprendedor'}`, 'success');\n        }\n    };\n\n    // Funci√≥n para reactivar un producto manualmente (si mejora el plan)\n    const reactivateProduct = async (productId) => {\n        const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n        const limit = getPlanLimit(currentPlan);\n        const activeCount = products.filter(p => p.isActive !== false).length;\n\n        if (activeCount >= limit) {\n            showToast(`Has alcanzado el l√≠mite de ${limit} productos de tu plan. Mejora tu plan o desactiva otro producto primero.`, 'warning');\n            return;\n        }\n\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: true,\n                deactivatedByPlan: false,\n                reactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto reactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al reactivar producto:', error);\n            showToast('Error al reactivar producto', 'error');\n        }\n    };\n\n    // Funci√≥n para desactivar un producto manualmente\n    const deactivateProduct = async (productId) => {\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', productId), {\n                isActive: false,\n                deactivatedManually: true,\n                deactivatedAt: new Date().toISOString()\n            });\n            showToast('Producto desactivado correctamente', 'success');\n        } catch (error) {\n            console.error('Error al desactivar producto:', error);\n            showToast('Error al desactivar producto', 'error');\n        }\n    };\n\n\n    // Formulario de Checkout\n    const [checkoutData, setCheckoutData] = useState({\n        address: '',\n        city: '',\n        province: '',\n        zipCode: '',\n        paymentChoice: '',\n        shippingMethod: 'Pickup' // Pickup or Delivery\n    });\n    const [appliedCoupon, setAppliedCoupon] = useState(null);\n    const [showCouponModal, setShowCouponModal] = useState(false);\n\n    // Auto-correcci√≥n de m√©todo de pago al cambiar env√≠o\n    useEffect(() => {\n        if (checkoutData.shippingMethod === 'Delivery' && checkoutData.paymentChoice === 'Efectivo') {\n            showToast('Pago en efectivo solo disponible con Retiro en Local.', 'info');\n            // Cambiar a otro m√©todo v√°lido autom√°ticamente\n            const hasTransfer = settings?.paymentTransfer?.enabled;\n            const hasCard = settings?.paymentMercadoPago?.enabled;\n            setCheckoutData(prev => ({\n                ...prev,\n                paymentChoice: hasTransfer ? 'Transferencia' : (hasCard ? 'Tarjeta' : '')\n            }));\n        }\n    }, [checkoutData.shippingMethod, settings]);\n\n    // --- ESTADOS DE ADMINISTRACI√ìN (DETALLADOS) ---\n\n    // Gesti√≥n de Productos\n    const [newProduct, setNewProduct] = useState({\n        name: '',\n        basePrice: '',\n        stock: '',\n        categories: [], // Cambio: Ahora es un array para m√∫ltiples categor√≠as\n        image: '',\n        description: '',\n        discount: 0,\n        purchasePrice: ''\n    });\n    const [editingId, setEditingId] = useState(null);\n    const [showProductForm, setShowProductForm] = useState(false);\n    const [settingsTab, setSettingsTab] = useState('store'); // store, appearance, social, payments, shipping, seo, advanced, team\n\n    // Gesti√≥n de Promos\n    const [newPromo, setNewPromo] = useState({\n        name: '',\n        price: '',\n        image: '',\n        description: '',\n        items: [] // Array de { productId, quantity }\n    });\n    const [promoSearch, setPromoSearch] = useState('');\n    const [selectedPromoProduct, setSelectedPromoProduct] = useState('');\n    const [promoProductQty, setPromoProductQty] = useState(1);\n    const [isEditingPromo, setIsEditingPromo] = useState(false);\n    const [editingPromoId, setEditingPromoId] = useState(null);\n\n    // Gesti√≥n Avanzada de Cupones (Restaurada la complejidad)\n    const [newCoupon, setNewCoupon] = useState({\n        code: '',\n        type: 'percentage', // percentage, fixed\n        value: 0,\n        minPurchase: 0,\n        maxDiscount: 0,\n        expirationDate: '',\n        targetType: 'global', // global, specific_user, specific_email\n        targetUser: '', // username o email espec√≠fico\n        usageLimit: '', // Limite total de usos\n        perUserLimit: 1, // Limite por usuario\n        isActive: true\n    });\n\n\n\n\n    // Estado para EDICI√ìN DE COMPRAS\n    const [editingPurchase, setEditingPurchase] = useState(null);\n\n    // Configuraci√≥n y Equipo\n    const [aboutText, setAboutText] = useState('');\n\n    const [newCategory, setNewCategory] = useState('');\n    const [newTeamMember, setNewTeamMember] = useState({ email: '', role: 'employee', name: '' });\n\n    // Estado para Detalle de Pedido (Modal)\n    const [selectedOrder, setSelectedOrder] = useState(null);\n\n    // Estados para Paginaci√≥n de Pedidos (Admin)\n    const [ordersLimit, setOrdersLimit] = useState(20);\n    const [ordersCursor, setOrdersCursor] = useState(null); // DocumentSnapshot del √∫ltimo elemento\n    const [ordersHistory, setOrdersHistory] = useState([]); // Historial de cursores para \"Volver\"\n    const [hasMoreOrders, setHasMoreOrders] = useState(true);\n\n    // Estados para Dashboard Avanzado (Venta Manual, Anal√≠ticas, Producto Menos Vendido)\n    const [showManualSaleModal, setShowManualSaleModal] = useState(false);\n    const [metricsDetail, setMetricsDetail] = useState(null); // { type: 'revenue' | 'net_income' }\n    const [showLeastSold, setShowLeastSold] = useState(false);\n\n    // Hoisted State for Manual Sale (So we can pre-fill it from Product List)\n    const [saleData, setSaleData] = useState({\n        productId: '',\n        quantity: 1,\n        price: 0,\n        customerName: 'Cliente Offline',\n        paymentMethod: 'Efectivo',\n        notes: 'Venta presencial'\n    });\n\n    // --- NUEVOS ESTADOS PARA GESTI√ìN DE USUARIOS (CARRITO, PASS Y EDICI√ìN) ---\n    const [viewUserCart, setViewUserCart] = useState(null); // Usuario seleccionado para ver carrito\n    const [userPassModal, setUserPassModal] = useState(null); // Usuario a cambiar contrase√±a\n    const [viewUserEdit, setViewUserEdit] = useState(null); // Usuario a editar perfil\n    const [newAdminPassword, setNewAdminPassword] = useState('');\n    const [userSearch, setUserSearch] = useState('');\n    const [userRoleFilter, setUserRoleFilter] = useState('all');\n\n    // Estado para Modal de Planes (cuando hacen clic en el overlay de restricci√≥n)\n    const [showPlansModal, setShowPlansModal] = useState(false);\n    const [selectedPlanOption, setSelectedPlanOption] = useState(null); // { plan: 'Emprendedor', cycle: 'Mensual', price: '$7.000' }\n\n    // Estado para Plan Downgrade - Productos/Cupones desactivados por l√≠mite\n    const [planDowngradeInfo, setPlanDowngradeInfo] = useState({\n        showWarning: false,\n        deactivatedProducts: [], // IDs de productos desactivados por l√≠mite\n        deactivatedCoupons: [], // IDs de cupones desactivados por l√≠mite\n        previousPlan: null,\n        newPlan: null\n    });\n\n    // --- ESTADOS PARA MERCADO PAGO CARD PAYMENT BRICK ---\n    const [mpBrickController, setMpBrickController] = useState(null);\n    const [isPaymentProcessing, setIsPaymentProcessing] = useState(false);\n    const [paymentError, setPaymentError] = useState(null);\n    const isInitializingBrick = useRef(false);\n    const cardPaymentBrickRef = useRef(null);\n\n\n    const openManualSaleModal = (product) => {\n        setSaleData({\n            productId: product.id,\n            quantity: 1,\n            price: Number(product.basePrice) || 0,\n            customerName: 'Cliente Offline',\n            paymentMethod: 'Efectivo',\n            notes: 'Venta presencial'\n        });\n        setShowManualSaleModal(true);\n    };\n\n    const confirmManualSale = async () => {\n        if (!saleData.productId) return;\n        if (saleData.quantity <= 0) {\n            showToast(\"La cantidad debe ser mayor a 0\", \"error\");\n            return;\n        }\n\n        setIsProcessingOrder(true);\n        try {\n            // 1. Verificar Stock Actualizado\n            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', saleData.productId);\n            const productSnap = await getDoc(productRef);\n\n            if (!productSnap.exists()) throw new Error(\"Producto no encontrado\");\n\n            const currentStock = Number(productSnap.data().stock) || 0;\n            if (currentStock < saleData.quantity) {\n                showToast(`Stock insuficiente. Solo quedan ${currentStock} unidades.`, \"error\");\n                setIsProcessingOrder(false);\n                return;\n            }\n\n            // 2. Crear Orden\n            const total = saleData.quantity * saleData.price;\n            const newOrder = {\n                orderId: Date.now().toString().slice(-6),\n                date: new Date().toISOString(),\n                status: 'Realizado',\n                source: 'manual_sale', // Identificador clave\n                userId: 'manual_admin',\n                customer: {\n                    name: saleData.customerName || 'Cliente Mostrador',\n                    email: '-',\n                    phone: '-',\n                    dni: '-'\n                },\n                items: [{\n                    id: saleData.productId,\n                    title: products.find(p => p.id === saleData.productId)?.name || 'Producto',\n                    quantity: saleData.quantity,\n                    unit_price: saleData.price,\n                    image: products.find(p => p.id === saleData.productId)?.image || ''\n                }],\n                total: total,\n                paymentMethod: saleData.paymentMethod,\n                notes: saleData.notes\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n            // 3. Descontar Stock\n            await updateDoc(productRef, {\n                stock: increment(-saleData.quantity)\n            });\n\n            showToast(\"Venta registrada exitosamente\", \"success\");\n            setShowManualSaleModal(false);\n\n        } catch (error) {\n            console.error(\"Error en venta manual:\", error);\n            showToast(\"Error al registrar venta: \" + error.message, \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // Referencias\n    const fileInputRef = useRef(null);\n\n    // --- FUNCIONES UTILITARIAS ---\n\n    // Mostrar notificaciones\n    const showToast = (msg, type = 'info') => {\n        const id = Date.now();\n        setToasts(prev => {\n            // Limitar a 3 toasts simult√°neos\n            const filtered = prev.filter(t => Date.now() - t.id < 3000);\n            return [...filtered, { id, message: msg, type }];\n        });\n    };\n\n    const removeToast = (id) => setToasts(p => p.filter(t => t.id !== id));\n\n    const handleHomeBannerClick = (slide) => {\n        const targetType = slide?.targetType || (slide?.promoId ? 'promo' : slide?.productId ? 'product' : 'none');\n        const targetId = slide?.targetId || slide?.promoId || slide?.productId || '';\n        if (!targetId || targetType === 'none') return;\n\n        if (targetType === 'product') {\n            const product = products.find(p => String(p.id).trim() === String(targetId).trim());\n            if (product) {\n                setSelectedProduct(product);\n                return;\n            }\n            showToast(\"Este banner apunta a un producto que ya no existe.\", \"warning\");\n            document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n            return;\n        }\n\n        if (targetType === 'promo') {\n            const promo = promos.find(p => String(p.id).trim() === String(targetId).trim());\n            if (!promo) {\n                showToast(\"Este banner apunta a una promo que ya no existe.\", \"warning\");\n                document.getElementById('catalog')?.scrollIntoView({ behavior: 'smooth' });\n                return;\n            }\n\n            let maxPurchasable = Infinity;\n            (promo.items || []).forEach(item => {\n                const p = products.find(prod => prod.id === item.productId);\n                const pStock = p ? (Number(p.stock) || 0) : 0;\n                const maxForThisItem = Math.floor(pStock / (Number(item.quantity) || 1));\n                if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n            });\n            if (!Number.isFinite(maxPurchasable)) maxPurchasable = 0;\n\n            setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable });\n        }\n    };\n\n    // Validar acceso por rol\n    const getRole = (email) => {\n        if (!email) return 'user';\n        const cleanEmail = email.trim().toLowerCase();\n\n        // Super Admin Hardcodeado (Prioridad M√°xima) - No depende de settings\n        if (cleanEmail === SUPER_ADMIN_EMAIL.toLowerCase()) return 'admin';\n\n        // 1. Verificar currentUser.role (Prioridad sobre equipo est√°tico)\n        // Esto permite promover usuarios desde el panel sin depender de settings.team\n        // Esta verificaci√≥n no depende de settings, solo de currentUser\n        if (currentUser && currentUser.email && currentUser.email.trim().toLowerCase() === cleanEmail && currentUser.role && currentUser.role !== 'user') {\n            return currentUser.role;\n        }\n\n        // Si settings a√∫n no est√° cargado, no podemos verificar team ni users\n        // Devolvemos 'loading' para indicar que no sabemos a√∫n el rol real\n        if (!settings || !settingsLoaded) return 'loading';\n\n        // 2. Buscar en el equipo (settings.team - Fallback/Hardcoded)\n        const team = settings?.team || [];\n        const member = team.find(m => m.email && m.email.trim().toLowerCase() === cleanEmail);\n        if (member) return member.role;\n\n        // 3. Buscar en la lista de usuarios (solo admins)\n        if (users && users.length > 0) {\n            const userDoc = users.find(u => u.email && u.email.trim().toLowerCase() === cleanEmail);\n            if (userDoc && userDoc.role) return userDoc.role;\n        }\n\n        return 'user';\n    };\n\n    const isAdmin = (email) => getRole(email) === 'admin';\n    const isEditor = (email) => getRole(email) === 'editor';\n    const isRoleLoading = (email) => getRole(email) === 'loading';\n    const hasAccess = (email) => {\n        const role = getRole(email);\n        // Si el rol a√∫n est√° cargando, no tiene acceso (se mostrar√° loading)\n        if (role === 'loading') return false;\n        return role === 'admin' || role === 'editor' || role === 'employee';\n    };\n\n    const isAdminUser = isAdmin(systemUser?.email || currentUser?.email);\n    const isSuperAdminSession = !!(systemUser?.email && SUPER_ADMIN_EMAIL && systemUser.email.trim().toLowerCase() === SUPER_ADMIN_EMAIL.trim().toLowerCase());\n    const latestOrderIso = useMemo(() => {\n        if (!isAdminUser) return null;\n        const v = orders?.[0]?.date;\n        return typeof v === 'string' ? v : null;\n    }, [isAdminUser, orders]);\n    const ordersLastSeenIso = typeof settings?.ordersLastSeenIso === 'string' ? settings.ordersLastSeenIso : null;\n    const hasUnseenOrders = !!(latestOrderIso && (!ordersLastSeenIso || latestOrderIso > ordersLastSeenIso));\n\n    const toggleAdminOrderAlarmMuted = useCallback(() => {\n        setAdminOrderAlarmMuted(prev => {\n            const next = !prev;\n            try {\n                localStorage.setItem('sustore_admin_order_alarm_muted', next ? '1' : '0');\n            } catch (e) { }\n            return next;\n        });\n    }, []);\n\n    const stopOrderAlarm = useCallback(async () => {\n        orderAlarmActiveRef.current = false;\n        if (orderAlarmIntervalRef.current) {\n            clearInterval(orderAlarmIntervalRef.current);\n            orderAlarmIntervalRef.current = null;\n        }\n        const ctx = orderAlarmContextRef.current;\n        orderAlarmContextRef.current = null;\n        if (ctx) {\n            try {\n                await ctx.close();\n            } catch (e) { }\n        }\n    }, []);\n\n    const markOrdersSeen = useCallback(async (iso) => {\n        if (!isAdminUser) return;\n        if (!appId) return;\n        const value = typeof iso === 'string' && iso ? iso : new Date().toISOString();\n        if (lastOrdersSeenWriteRef.current === value) return;\n        lastOrdersSeenWriteRef.current = value;\n        try {\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), { ordersLastSeenIso: value });\n        } catch (e) { }\n    }, [isAdminUser, appId]);\n\n    const startOrderAlarm = useCallback(async () => {\n        if (!isAdminUser) return;\n        if (adminOrderAlarmMuted) return;\n        if (orderAlarmActiveRef.current) return;\n\n        const AudioContextCtor = window.AudioContext || window.webkitAudioContext;\n        if (!AudioContextCtor) return;\n\n        const ctx = orderAlarmContextRef.current || new AudioContextCtor();\n        orderAlarmContextRef.current = ctx;\n\n        const scheduleBeep = (at) => {\n            const osc = ctx.createOscillator();\n            const gain = ctx.createGain();\n            osc.type = 'triangle';\n            osc.frequency.value = 880;\n            gain.gain.setValueAtTime(0.0001, at);\n            gain.gain.exponentialRampToValueAtTime(0.12, at + 0.01);\n            gain.gain.exponentialRampToValueAtTime(0.0001, at + 0.09);\n            osc.connect(gain);\n            gain.connect(ctx.destination);\n            osc.start(at);\n            osc.stop(at + 0.1);\n        };\n\n        const tick = () => {\n            const now = ctx.currentTime;\n            scheduleBeep(now);\n            scheduleBeep(now + 0.18);\n        };\n\n        try {\n            if (ctx.state === 'suspended') {\n                await ctx.resume();\n            }\n        } catch (e) { }\n\n        if (ctx.state !== 'running') {\n            if (!orderAlarmToastShownRef.current) {\n                showToast('Pedido nuevo: toc√°/clic para habilitar sonido', 'warning');\n                orderAlarmToastShownRef.current = true;\n            }\n            if (!orderAlarmUnlockListenerActiveRef.current) {\n                orderAlarmUnlockListenerActiveRef.current = true;\n                window.addEventListener('pointerdown', async () => {\n                    orderAlarmUnlockListenerActiveRef.current = false;\n                    try {\n                        if (orderAlarmContextRef.current?.state === 'suspended') {\n                            await orderAlarmContextRef.current.resume();\n                        }\n                    } catch (e) { }\n                    if (hasUnseenOrders && !(view === 'admin' && adminTab === 'orders') && !adminOrderAlarmMuted) {\n                        startOrderAlarm();\n                    }\n                }, { once: true, capture: true });\n            }\n            return;\n        }\n\n        orderAlarmActiveRef.current = true;\n        tick();\n        orderAlarmIntervalRef.current = setInterval(tick, 2000);\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab]);\n\n    useEffect(() => {\n        const rawHostname = (typeof window !== 'undefined' && window.location && window.location.hostname)\n            ? String(window.location.hostname).trim().toLowerCase()\n            : '';\n        const normalizedHostname = rawHostname.startsWith('www.') ? rawHostname.slice(4) : rawHostname;\n\n        if (!normalizedHostname) {\n            setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: 'hostname-empty' });\n            setAppId(null);\n            return;\n        }\n\n        if (normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1') {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        if (normalizedHostname.endsWith('.vercel.app')) {\n            setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: DEFAULT_APP_ID, error: null });\n            setAppId(DEFAULT_APP_ID);\n            return;\n        }\n\n        setStoreResolution({ status: 'resolving', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n\n        let cancelled = false;\n        const resolve = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'storesIndex', normalizedHostname));\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const data = snap.data() || {};\n                    const storeId = typeof data.storeId === 'string' ? data.storeId.trim() : '';\n                    if (storeId) {\n                        setStoreResolution({ status: 'resolved', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId, error: null });\n                        setAppId(storeId);\n                        return;\n                    }\n                }\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: null });\n                setAppId(null);\n            } catch (e) {\n                if (cancelled) return;\n                setStoreResolution({ status: 'unconfigured', hostname: rawHostname, normalizedHostname: normalizedHostname, storeId: null, error: e?.message || 'resolve-error' });\n                setAppId(null);\n            }\n        };\n        resolve();\n        return () => { cancelled = true; };\n    }, []);\n\n    const createStoreId = useCallback(() => {\n        const clean = (value) => String(value || '').trim().toLowerCase().replace(/[^a-z0-9-]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');\n        const base = clean(storeResolution.normalizedHostname || storeResolution.hostname || 'store');\n        const rand = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function'\n            ? crypto.randomUUID().split('-')[0]\n            : Math.random().toString(36).slice(2, 8);\n        return `${base}-${rand}`.slice(0, 80);\n    }, [storeResolution.hostname, storeResolution.normalizedHostname]);\n\n    const bootstrapStoreData = useCallback(async (storeId) => {\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'data', 'settings', 'config'), { ...defaultSettings, createdAt: nowIso, updatedAt: nowIso }, { merge: true });\n        await setDoc(doc(db, 'artifacts', storeId, 'public', 'config'), { version: APP_VERSION, updatedAt: nowIso }, { merge: true });\n    }, []);\n\n    const registerHostname = useCallback(async (storeId) => {\n        const hostname = storeResolution.normalizedHostname;\n        if (!hostname) throw new Error('Dominio inv√°lido');\n        const normalizedStoreId = String(storeId || '').trim();\n        if (!normalizedStoreId) throw new Error('StoreId inv√°lido');\n        const nowIso = new Date().toISOString();\n        await setDoc(doc(db, 'storesIndex', hostname), { storeId: normalizedStoreId, hostname, updatedAt: nowIso, updatedBy: systemUser?.email || null, createdAt: nowIso }, { merge: true });\n        await bootstrapStoreData(normalizedStoreId);\n        setAppId(normalizedStoreId);\n        setStoreResolution((prev) => ({ ...prev, status: 'resolved', storeId: normalizedStoreId, error: null }));\n    }, [bootstrapStoreData, storeResolution.normalizedHostname, systemUser?.email]);\n\n    // --- EFECTOS DE SINCRONIZACI√ìN (FIREBASE) ---\n\n    // 0. Sincronizar Dark Mode con el DOM y localStorage\n    useEffect(() => {\n        // Aplicar/remover clase dark-mode en el body\n        if (darkMode) {\n            document.documentElement.classList.add('dark-mode');\n            document.body.classList.add('dark-mode');\n        } else {\n            document.documentElement.classList.remove('dark-mode');\n            document.body.classList.remove('dark-mode');\n        }\n        // Guardar preferencia en localStorage\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n    }, [darkMode]);\n\n    // 1. Sincronizar Carrito Local y Remoto (Live Cart)\n    useEffect(() => {\n        localStorage.setItem('sustore_cart', JSON.stringify(cart));\n\n        // Si hay usuario, subir carrito a DB para monitor de admin\n        if (appId && currentUser && currentUser.id) {\n            const syncCartToDB = async () => {\n                try {\n                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n                        userId: currentUser.id,\n                        userName: currentUser.name || 'Usuario', // Guardamos nombre (con fallback) para evitar errores\n                        items: cart.map(item => ({\n                            productId: item.product.id,\n                            quantity: item.quantity,\n                            name: item.product.name,\n                            price: item.product.basePrice\n                        })),\n                        lastUpdated: new Date().toISOString()\n                    }, { merge: true });\n                } catch (e) {\n                    console.error(\"Error syncing cart\", e);\n                }\n            };\n            // Debounce para no saturar escrituras (optimizado a 800ms)\n            const debounceTimer = setTimeout(syncCartToDB, 800);\n            return () => clearTimeout(debounceTimer);\n        }\n    }, [cart, currentUser, appId]);\n\n    useEffect(() => {\n        if (!currentUser?.id) return;\n        if (!appId) return;\n        if (cartHydratedFromRemoteRef.current) return;\n\n        let cancelled = false;\n        const hydrateCartFromRemote = async () => {\n            try {\n                const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id));\n                if (!snap.exists()) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n                const data = snap.data() || {};\n                const remoteItems = Array.isArray(data.items) ? data.items : [];\n                if (remoteItems.length === 0) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n\n                const normalizedRemote = remoteItems\n                    .filter(i => i && i.productId && Number(i.quantity) > 0)\n                    .map(i => ({\n                        product: {\n                            id: i.productId,\n                            name: typeof i.name === 'string' ? i.name : '',\n                            basePrice: Number(i.price) || 0,\n                            image: '',\n                            category: ''\n                        },\n                        quantity: Number(i.quantity) || 1\n                    }));\n\n                if (normalizedRemote.length === 0) {\n                    cartHydratedFromRemoteRef.current = true;\n                    return;\n                }\n\n                // Solo hidratamos si el carrito local est√° vac√≠o para evitar sobrescribir cambios recientes\n                // o si es la primera carga y decidimos que el remoto manda.\n                // Eliminamos la dependencia de 'cart' para evitar el bucle.\n                if (!cancelled) {\n                    setCart(prevCart => {\n                        if (prevCart.length === 0) return normalizedRemote;\n                        return prevCart; // Mantener local si ya hay algo\n                    });\n                    cartHydratedFromRemoteRef.current = true;\n                }\n            } catch (e) { \n                cartHydratedFromRemoteRef.current = true;\n            }\n        };\n\n        hydrateCartFromRemote();\n        return () => { cancelled = true; };\n    }, [appId, currentUser?.id]); // Eliminado 'cart' de las dependencias\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n\n        if (typeof settings?.ordersLastSeenIso !== 'string' && settingsLoaded && orders.length > 0 && latestOrderIso) {\n            markOrdersSeen(latestOrderIso);\n        }\n    }, [isAdminUser, settingsLoaded, settings?.ordersLastSeenIso, orders.length, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) {\n            stopOrderAlarm();\n            return;\n        }\n        if (adminOrderAlarmMuted) {\n            stopOrderAlarm();\n            return;\n        }\n\n        const inOrdersTab = view === 'admin' && adminTab === 'orders';\n        if (hasUnseenOrders && !inOrdersTab) {\n            startOrderAlarm();\n        } else {\n            stopOrderAlarm();\n        }\n    }, [isAdminUser, adminOrderAlarmMuted, hasUnseenOrders, view, adminTab, startOrderAlarm, stopOrderAlarm]);\n\n    useEffect(() => {\n        if (!isAdminUser) return;\n        if (view !== 'admin' || adminTab !== 'orders') return;\n        if (!latestOrderIso) return;\n        markOrdersSeen(latestOrderIso);\n        stopOrderAlarm();\n    }, [isAdminUser, view, adminTab, latestOrderIso, markOrdersSeen, stopOrderAlarm]);\n\n    // 1.1 Sincronizar precios y datos del carrito con productos actualizados\n    useEffect(() => {\n        if (products.length > 0 && cart.length > 0) {\n            setCart(prevCart => {\n                let hasChanges = false;\n                const newCart = prevCart.map(item => {\n                    // Buscar el producto actual en la lista maestra\n                    const currentProduct = products.find(p => p.id === item.product.id);\n\n                    if (currentProduct) {\n                        // Si el precio, nombre o imagen cambiaron, actualizamos el item del carrito\n                        if (currentProduct.basePrice !== (item.product?.basePrice ?? 0) ||\n                            currentProduct.name !== (item.product?.name ?? '') ||\n                            currentProduct.image !== (item.product?.image ?? '')) {\n                            hasChanges = true;\n                            return {\n                                ...item,\n                                product: {\n                                    ...currentProduct,\n                                    // Aseguramos que mantenemos la consistencia de tipos\n                                    basePrice: Number(currentProduct.basePrice) || 0\n                                }\n                            };\n                        }\n                    }\n                    return item;\n                });\n                return hasChanges ? newCart : prevCart;\n            });\n        }\n    }, [products]);\n\n\n\n    // 3. Sistema de Auto-Update\n    useEffect(() => {\n        if (!appId) return;\n        const configRef = doc(db, 'artifacts', appId, 'public', 'config');\n        const unsubscribe = onSnapshot(configRef, (snap) => {\n            if (snap.exists()) {\n                const data = snap.data();\n                if (data.version && data.version !== APP_VERSION) {\n                    console.log(`Nueva versi√≥n detectada: ${data.version}. Actualizando...`);\n                    window.location.reload();\n                }\n            }\n        });\n        return () => unsubscribe();\n    }, [appId]);\n    // 2. Persistencia Detallada y Session\n    useEffect(() => {\n        // Solo guardar usuarios con datos v√°lidos completos\n        if (currentUser && currentUser.id && currentUser.email && currentUser.name) {\n            localStorage.setItem('sustore_user_data', JSON.stringify(currentUser));\n            // Pre-llenar checkout si hay datos\n            setCheckoutData(prev => ({\n                ...prev,\n                address: currentUser.address || prev.address,\n                city: currentUser.city || prev.city,\n                province: currentUser.province || prev.province,\n                zipCode: currentUser.zipCode || prev.zipCode\n            }));\n        } else if (!currentUser) {\n            // Si no hay usuario, limpiar localStorage\n            localStorage.removeItem('sustore_user_data');\n        }\n        // Si currentUser existe pero no tiene datos v√°lidos, no guardamos nada\n        // Esto evita persistir usuarios \"fantasma\" incompletos\n    }, [currentUser]);\n\n    // 3. Inicializaci√≥n de Firebase Auth\n    useEffect(() => {\n        let didBootstrap = false;\n        let isBootstrapping = false;\n\n        const bootstrapAuth = async () => {\n            if (isBootstrapping) return;\n            isBootstrapping = true;\n            try {\n                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {\n                    await signInWithCustomToken(auth, __initial_auth_token);\n                } else {\n                    await signInAnonymously(auth);\n                }\n            } catch (e) {\n                console.error(\"Error en bootstrap Auth:\", e);\n            } finally {\n                isBootstrapping = false;\n            }\n        };\n\n        return onAuthStateChanged(auth, async (user) => {\n            setSystemUser(user);\n\n            if (!didBootstrap) {\n                didBootstrap = true;\n                if (!user) {\n                    setCurrentUser(null);\n                    await bootstrapAuth();\n                    setTimeout(() => setIsLoading(false), 300);\n                    return;\n                }\n            }\n\n            if (!user || user.isAnonymous) {\n                setCurrentUser(null);\n            }\n\n            setTimeout(() => setIsLoading(false), 300);\n        });\n    }, []);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (!systemUser || systemUser.isAnonymous) return;\n        let cancelled = false;\n        const loadProfile = async () => {\n            try {\n                const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', systemUser.uid);\n                const snap = await getDoc(userDocRef);\n                if (cancelled) return;\n                if (snap.exists()) {\n                    const userData = { id: snap.id, ...snap.data() };\n                    if (userData.role === 'admin') userData._adminVerified = true;\n                    setCurrentUser(userData);\n                } else {\n                    setCurrentUser(null);\n                }\n            } catch {\n                if (!cancelled) setCurrentUser(null);\n            }\n        };\n        loadProfile();\n        return () => { cancelled = true; };\n    }, [appId, systemUser?.uid, systemUser?.isAnonymous]);\n\n    // CSS Variable Injection for Dynamic Theme Colors\n    useEffect(() => {\n        if (settings) {\n            const primaryColor = settings.primaryColor || '#f97316';\n            const secondaryColor = settings.secondaryColor || '#8b5cf6';\n            const accentColor = settings.accentColor || '#22c55e';\n\n            // Create or update the dynamic theme style element\n            let styleEl = document.getElementById('dynamic-theme-styles');\n            if (!styleEl) {\n                styleEl = document.createElement('style');\n                styleEl.id = 'dynamic-theme-styles';\n                document.head.appendChild(styleEl);\n            }\n\n            // Generate comprehensive CSS overrides for the theme\n            styleEl.textContent = `\n                :root {\n                    --color-primary: ${primaryColor};\n                    --color-secondary: ${secondaryColor};\n                    --color-accent: ${accentColor};\n                }\n                \n                /* Primary color overrides */\n                .text-orange-400, .text-orange-500 { color: ${primaryColor} !important; }\n                .bg-orange-400, .bg-orange-500 { background-color: ${primaryColor} !important; }\n                .bg-orange-900\\\\/10, .bg-orange-900\\\\/20 { background-color: ${primaryColor}1a !important; }\n                .border-orange-500, .border-orange-500\\\\/20, .border-orange-500\\\\/30, .border-orange-500\\\\/50 { border-color: ${primaryColor} !important; }\n                .hover\\\\:text-orange-400:hover { color: ${primaryColor} !important; }\n                .hover\\\\:bg-orange-400:hover, .hover\\\\:bg-orange-500:hover { background-color: ${primaryColor} !important; }\n                .hover\\\\:border-orange-500:hover, .hover\\\\:border-orange-500\\\\/30:hover, .hover\\\\:border-orange-500\\\\/50:hover { border-color: ${primaryColor} !important; }\n                .focus-within\\\\:border-orange-500\\\\/50:focus-within { border-color: ${primaryColor}80 !important; }\n                .from-orange-400 { --tw-gradient-from: ${primaryColor} !important; }\n                .to-orange-500 { --tw-gradient-to: ${primaryColor} !important; }\n                .shadow-orange-500\\\\/30, .shadow-orange-600\\\\/30 { --tw-shadow-color: ${primaryColor}4d !important; }\n                .ring-orange-500 { --tw-ring-color: ${primaryColor} !important; }\n                .selection\\\\:bg-orange-500\\\\/30 ::selection { background-color: ${primaryColor}4d !important; }\n                .selection\\\\:text-orange-200 ::selection { color: ${primaryColor} !important; }\n                \n                /* Secondary color overrides */\n                .text-purple-400, .text-purple-500 { color: ${secondaryColor} !important; }\n                .bg-purple-400, .bg-purple-500 { background-color: ${secondaryColor} !important; }\n                .bg-purple-900\\\\/10, .bg-purple-900\\\\/20 { background-color: ${secondaryColor}1a !important; }\n                .border-purple-500, .border-purple-500\\\\/20 { border-color: ${secondaryColor} !important; }\n                .hover\\\\:text-purple-400:hover { color: ${secondaryColor} !important; }\n                .from-purple-500, .from-purple-600 { --tw-gradient-from: ${secondaryColor} !important; }\n                \n                /* Accent color overrides */\n                .text-green-400, .text-green-500 { color: ${accentColor} !important; }\n                .bg-green-400, .bg-green-500, .bg-green-600 { background-color: ${accentColor} !important; }\n                .bg-green-900\\\\/10 { background-color: ${accentColor}1a !important; }\n                .border-green-500, .border-green-500\\\\/20, .border-green-500\\\\/30 { border-color: ${accentColor} !important; }\n                .hover\\\\:text-green-400:hover { color: ${accentColor} !important; }\n                .hover\\\\:bg-green-400:hover, .hover\\\\:bg-green-500:hover { background-color: ${accentColor} !important; }\n                .shadow-green-500\\\\/30, .shadow-green-600\\\\/30 { --tw-shadow-color: ${accentColor}4d !important; }\n                \n                /* Neon text effect with primary color */\n                .neon-text {\n                    text-shadow: 0 0 10px ${primaryColor}40, 0 0 20px ${primaryColor}20, 0 0 30px ${primaryColor}10 !important;\n                }\n            `;\n        }\n    }, [settings?.primaryColor, settings?.secondaryColor, settings?.accentColor]);\n\n    // Dark/Light Mode Effect\n    useEffect(() => {\n        localStorage.setItem('sustore_dark_mode', JSON.stringify(darkMode));\n\n        let lightModeStyle = document.getElementById('light-mode-styles');\n        if (!lightModeStyle) {\n            lightModeStyle = document.createElement('style');\n            lightModeStyle.id = 'light-mode-styles';\n            document.head.appendChild(lightModeStyle);\n        }\n\n        if (view === 'admin') {\n            lightModeStyle.textContent = '';\n            return;\n        }\n\n        if (!darkMode) {\n            // Light mode styles\n            lightModeStyle.textContent = `\n                /* Light Mode Overrides */\n                body, .bg-\\\\[\\\\#050505\\\\], .bg-\\\\[\\\\#0a0a0a\\\\], .bg-\\\\[\\\\#080808\\\\], .bg-\\\\[\\\\#111\\\\], .bg-black {\n                    background-color: #f8fafc !important;\n                }\n                .bg-\\\\[\\\\#1a1a1a\\\\], .bg-zinc-800 { background-color: #ffffff !important; }\n                .hover\\\\:bg-zinc-700:hover { background-color: #e2e8f0 !important; }\n                .bg-grid {\n                    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),\n                                      linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px) !important;\n                }\n                .text-white { color: #0f172a !important; }\n                .text-white\\\\/50, .text-white\\\\/60, .text-white\\\\/70, .text-white\\\\/80 { color: #475569 !important; }\n                .hover\\\\:text-white:hover { color: #0f172a !important; }\n                .text-slate-200 { color: #334155 !important; }\n                .text-slate-300, .text-slate-400, .text-slate-500, .text-slate-600 { color: #64748b !important; }\n                .bg-slate-900, .bg-slate-900\\\\/50, .bg-slate-800 { background-color: #ffffff !important; }\n                .bg-slate-900\\\\/30 { background-color: rgba(255,255,255,0.8) !important; }\n                .border-slate-700, .border-slate-700\\\\/50, .border-slate-800, .border-slate-800\\\\/50, .border-slate-900 { \n                    border-color: #e2e8f0 !important; \n                }\n                .border-white\\\\/5, .border-white\\\\/10, .border-white\\\\/20 { border-color: #e2e8f0 !important; }\n                .fill-white { fill: #0f172a !important; }\n                .stroke-white { stroke: #0f172a !important; }\n                .glass {\n                    background: rgba(255, 255, 255, 0.95) !important;\n                    border-color: #e2e8f0 !important;\n                }\n                .input-cyber {\n                    background-color: #f1f5f9 !important;\n                    border-color: #e2e8f0 !important;\n                    color: #0f172a !important;\n                }\n                .input-cyber::placeholder { color: #94a3b8 !important; }\n                .input-cyber:focus { border-color: var(--color-primary, #f97316) !important; }\n                \n                /* Cards and containers */\n                .rounded-\\\\[2rem\\\\], .rounded-\\\\[2\\\\.5rem\\\\], .rounded-\\\\[1\\\\.5rem\\\\] {\n                    box-shadow: 0 4px 20px rgba(0,0,0,0.05) !important;\n                }\n                \n                /* Footer */\n                footer.bg-\\\\[\\\\#050505\\\\] { background-color: #0f172a !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900, \n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-900\\\\/50,\n                footer.bg-\\\\[\\\\#050505\\\\] .bg-slate-800 { background-color: rgba(255,255,255,0.06) !important; }\n                footer.bg-\\\\[\\\\#050505\\\\] .border-slate-800 { border-color: rgba(255,255,255,0.10) !important; }\n                footer .text-white { color: #ffffff !important; }\n                footer .text-slate-500, footer .text-slate-400, footer .text-slate-600 { color: #94a3b8 !important; }\n                \n                /* Admin panel stays dark */\n                [class*=\"admin\"] .bg-\\\\[\\\\#050505\\\\] { background-color: #050505 !important; }\n            `;\n        } else {\n            lightModeStyle.textContent = '';\n        }\n    }, [darkMode, view]);\n\n    // 4. Suscripciones a Colecciones (Snapshot Listeners)\n    // - P√∫blico: se mantiene realtime solo donde aporta (products + settings)\n    // - Resto: se carga por demanda inicial (getDocs) para evitar listeners extra\n    // - Admin: listeners solo cuando el panel Admin est√° activo (view === 'admin')\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const unsubscribeFunctions = [];\n        let cancelled = false;\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'products'), (snapshot) => {\n                const productsData = snapshot.docs.map(d => {\n                    const data = d.data();\n                    return { id: d.id, ...data, stock: Number(data.stock) || 0 };\n                });\n                setProducts(productsData);\n                if (cart.length === 0) setIsLoading(false);\n            }, (error) => {\n                console.error(\"Error fetching products:\", error);\n                if (error?.code === 'permission-denied' || String(error?.message || '').includes('permission')) {\n                    showToast(\"Error de permisos. Reiniciando sesi√≥n...\", \"warning\");\n                    setTimeout(() => {\n                        auth.signOut().then(() => window.location.reload());\n                    }, 2000);\n                } else {\n                    showToast(\"Error al cargar productos: \" + (error?.message || 'error'), \"error\");\n                }\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), (snap) => {\n                if (snap.exists()) {\n                    const data = snap.data();\n                    const team = data.team || defaultSettings.team;\n                    const teamRoles = (data.teamRoles && typeof data.teamRoles === 'object')\n                        ? data.teamRoles\n                        : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n\n                    const mergedSettings = {\n                        ...defaultSettings,\n                        ...data,\n                        team,\n                        teamRoles,\n                        categories: data.categories || defaultSettings.categories\n                    };\n\n                    setSettings(mergedSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(data.aboutUsText || defaultSettings.aboutUsText);\n                } else {\n                    setSettings(defaultSettings);\n                    setSettingsLoaded(true);\n                    setAboutText(defaultSettings.aboutUsText);\n                }\n            })\n        );\n\n        (async () => {\n            try {\n                const promosSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'promos'));\n                if (!cancelled) setPromos(promosSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setPromos([]);\n            }\n\n            try {\n                const bannersSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'));\n                if (!cancelled) {\n                    const banners = bannersSnap.docs.map(d => ({ id: d.id, ...d.data() }));\n                    banners.sort((a, b) => {\n                        const ao = Number.isFinite(Number(a.order)) ? Number(a.order) : 0;\n                        const bo = Number.isFinite(Number(b.order)) ? Number(b.order) : 0;\n                        if (ao !== bo) return ao - bo;\n                        const ad = typeof a.createdAt === 'string' ? a.createdAt : '';\n                        const bd = typeof b.createdAt === 'string' ? b.createdAt : '';\n                        return ad.localeCompare(bd);\n                    });\n                    setHomeBanners(banners);\n                }\n            } catch {\n                if (!cancelled) setHomeBanners([]);\n            }\n\n            try {\n                const couponsSnap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'));\n                if (!cancelled) setCoupons(couponsSnap.docs.map(d => ({ id: d.id, ...d.data() })));\n            } catch {\n                if (!cancelled) setCoupons([]);\n            }\n        })();\n\n        return () => {\n            cancelled = true;\n            unsubscribeFunctions.forEach(unsub => unsub());\n        };\n    }, [systemUser, appId]);\n\n    useEffect(() => {\n        if (!systemUser) return;\n        if (!appId) return;\n\n        const isAuthenticatedUser = systemUser && !systemUser.isAnonymous;\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n\n        if (!isAuthenticatedUser) {\n            setOrders([]);\n            return;\n        }\n\n        if (isAdminUser && !isAdminViewActive) {\n            setOrders([]);\n            return;\n        }\n\n        const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');\n        \n        let q;\n        if (isAdminUser) {\n            const constraints = [orderBy('date', 'desc'), limit(ordersLimit)];\n            if (ordersCursor) constraints.push(startAfter(ordersCursor));\n            q = query(ordersRef, ...constraints);\n        } else {\n            q = query(ordersRef, where('customerId', '==', systemUser.uid), orderBy('date', 'desc'), limit(50));\n        }\n\n        return onSnapshot(q, (snapshot) => {\n            const ordersData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));\n            \n            if (isAdminUser) {\n                setHasMoreOrders(snapshot.docs.length === ordersLimit);\n                // No actualizamos el cursor aqu√≠ para evitar bucles infinitos si onSnapshot dispara\n                // El cursor solo se actualiza manualmente al cambiar de p√°gina\n            }\n\n            if (!isAdminUser) {\n                const getDateMs = (value) => {\n                    if (!value) return 0;\n                    if (typeof value?.toMillis === 'function') return value.toMillis();\n                    const ms = Date.parse(String(value));\n                    return Number.isFinite(ms) ? ms : 0;\n                };\n                ordersData.sort((a, b) => getDateMs(b.date) - getDateMs(a.date));\n            }\n            setOrders(ordersData);\n        }, (err) => {\n            console.error(\"Orders Snapshot Error:\", err);\n            setOrders([]);\n        });\n    }, [systemUser, currentUser?.role, appId, view, ordersLimit, ordersCursor]);\n\n    const handleNextOrders = () => {\n        if (!hasMoreOrders || orders.length === 0) return;\n        // Necesitamos el DocumentSnapshot real. Como onSnapshot no nos lo da persistente,\n        // vamos a tener que buscarlo en la colecci√≥n o cambiar a getDocs para paginaci√≥n.\n        // Por ahora, buscaremos el √∫ltimo doc de la lista actual.\n        const lastId = orders[orders.length - 1].id;\n        getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', lastId)).then(snap => {\n            if (snap.exists()) {\n                setOrdersHistory(prev => [...prev, ordersCursor]);\n                setOrdersCursor(snap);\n            }\n        });\n    };\n\n    const handlePrevOrders = () => {\n        if (ordersHistory.length === 0) return;\n        const prevCursor = ordersHistory[ordersHistory.length - 1];\n        setOrdersCursor(prevCursor);\n        setOrdersHistory(prev => prev.slice(0, -1));\n    };\n\n    useEffect(() => {\n        if (!appId) return;\n\n        const isAdminUser = currentUser?.role === 'admin';\n        const isAdminViewActive = view === 'admin';\n        if (!(isAdminUser && isAdminViewActive)) {\n            setUsers([]);\n            setSuppliers([]);\n            setExpenses([]);\n            setPurchases([]);\n            setInvestments([]);\n            setLiveCarts([]);\n            return;\n        }\n\n        const unsubscribeFunctions = [];\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'users'), snapshot => {\n                setUsers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), snapshot => {\n                setSuppliers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), snapshot => {\n                setExpenses(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), snapshot => {\n                setPurchases(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), snapshot => {\n                setInvestments(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n            })\n        );\n\n        unsubscribeFunctions.push(\n            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'carts'), snapshot => {\n                const activeCarts = snapshot.docs\n                    .map(d => ({ id: d.id, ...d.data() }))\n                    .filter(c => c.items && c.items.length > 0);\n                setLiveCarts(activeCarts);\n            })\n        );\n\n        return () => unsubscribeFunctions.forEach(unsub => unsub());\n    }, [currentUser?.role, appId, view]);\n\n    // --- VALIDACI√ìN INTELIGENTE DEL CARRITO ---\n    // Elimina autom√°ticamente productos que ya no existen o no tienen stock\n    const productsById = useMemo(() => {\n        const map = new Map();\n        for (const p of products) map.set(String(p.id).trim(), p);\n        return map;\n    }, [products]);\n\n    const lastSyncedCartRef = useRef(null);\n\n    useEffect(() => {\n        if (!appId) return;\n        if (products.length === 0) return;\n        if (!currentUser) return;\n        if (cart.length === 0) return;\n\n        let changed = false;\n        const removed = [];\n\n        const validated = cart.filter(item => {\n            const itemId = String(item.product?.id || '').trim();\n            const productInStore = productsById.get(itemId);\n            if (!productInStore) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Producto eliminado)`);\n                return false;\n            }\n            if (productInStore.isActive === false) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (No disponible actualmente)`);\n                return false;\n            }\n            if (productInStore.isPromo && Array.isArray(productInStore.items)) {\n                const ok = productInStore.items.every(comp => {\n                    const cid = String(comp?.productId || '').trim();\n                    const cp = productsById.get(cid);\n                    return !!cp && cp.isActive !== false;\n                });\n                if (!ok) {\n                    changed = true;\n                    removed.push(`${item.product?.name || 'Promo'} (Componente inv√°lido)`);\n                    return false;\n                }\n            }\n            if (!(Number(productInStore.stock) > 0)) {\n                changed = true;\n                removed.push(`${item.product?.name || 'Producto'} (Sin Stock)`);\n                return false;\n            }\n            return true;\n        }).map(item => {\n            const fresh = productsById.get(String(item.product?.id || '').trim());\n            if (fresh && ((item.product?.basePrice ?? 0) !== fresh.basePrice || (item.product?.discount ?? 0) !== fresh.discount)) {\n                changed = true;\n            }\n            return { ...item, product: fresh || item.product };\n        });\n\n        if (!changed) return;\n\n        setCart(validated);\n\n        const payload = JSON.stringify(validated.map(i => ({ id: String(i.product?.id || ''), q: i.quantity, p: i.product?.basePrice, d: i.product?.discount })));\n        if (lastSyncedCartRef.current === payload) return;\n        lastSyncedCartRef.current = payload;\n\n        setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', currentUser.id), {\n            userId: currentUser.id,\n            items: validated\n        }, { merge: true });\n\n        if (removed.length > 0) {\n            showToast(`Tu carrito se actualiz√≥: ${removed.join(', ')}`, 'info');\n        }\n    }, [productsById, currentUser?.id, cart, appId]);\n\n    // --- EFECTO VISUAL: SEO, FAVICON Y T√çTULO DIN√ÅMICO ---\n\n    const lastSavedSettingsRef = useRef(null);\n\n    // Actualiza todas las meta tags de SEO seg√∫n la configuraci√≥n de la tienda\n    useEffect(() => {\n        // IMPORTANTE: Esperar a que la configuraci√≥n cargue realmente para evitar \"parpadeo\" del logo default\n        if (!appId) return;\n        if (!settingsLoaded || !settings) return;\n\n        const currentSettingsStr = JSON.stringify(settings);\n\n        // Prevent infinite loop: Only save if content changed\n        if (lastSavedSettingsRef.current === currentSettingsStr) {\n            return;\n        }\n\n        // Auto-Save Settings Logic (Debounced)\n        const autoSaveTimer = setTimeout(async () => {\n            try {\n                if (currentUser?.role !== 'admin') {\n                    lastSavedSettingsRef.current = currentSettingsStr;\n                    return;\n                }\n                const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                const team = settings?.team || defaultSettings.team;\n                const teamRoles = (settings?.teamRoles && typeof settings.teamRoles === 'object')\n                    ? settings.teamRoles\n                    : Object.fromEntries((team || []).filter(m => m?.email && m?.role).map(m => [m.email.trim().toLowerCase(), m.role]));\n                const settingsToSave = { ...settings, teamRoles };\n                // Use merge true to be safe, though we usually have the full object\n                await setDoc(settingsRef, settingsToSave, { merge: true });\n\n                // Update the ref to match what we just saved\n                lastSavedSettingsRef.current = JSON.stringify(settingsToSave);\n\n                console.log(\"[AutoSave] Settings saved successfully.\");\n            } catch (error) {\n                console.error(\"[AutoSave] Error saving settings:\", error);\n            }\n        }, 2000); // 2 seconds debounce\n\n        // Helper para actualizar meta tags de forma segura\n        const updateMetaTag = (selector, content) => {\n            const element = document.querySelector(selector);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateMetaTagById = (id, content) => {\n            const element = document.getElementById(id);\n            if (element && content) {\n                element.setAttribute('content', content);\n            }\n        };\n\n        const updateLinkTag = (id, href) => {\n            const element = document.getElementById(id);\n            if (element && href) {\n                element.setAttribute('href', href);\n            }\n        };\n\n        // 1. T√≠tulo de la Pesta√±a\n        const pageTitle = settings.seoTitle || (settings.storeName ? `${settings.storeName} - Tienda Online` : 'Tienda Online');\n        document.title = pageTitle;\n\n        // 2. Meta Description\n        const description = settings.seoDescription || `${settings.storeName || 'Tienda'} - Tu tienda online de confianza.`;\n        updateMetaTagById('meta-description', description);\n\n        // 3. Meta Keywords\n        const keywords = settings.seoKeywords || `${settings.storeName || 'tienda'}, productos, comprar, env√≠os`;\n        updateMetaTagById('meta-keywords', keywords);\n\n        // 4. Meta Author\n        const author = settings.seoAuthor || settings.storeName || 'Tienda Online';\n        updateMetaTagById('meta-author', author);\n\n        // 5. Apple Mobile Web App Title\n        updateMetaTagById('meta-apple-title', settings.storeName || 'Tienda');\n\n        // 6. Theme Color\n        if (settings.primaryColor) {\n            updateMetaTagById('meta-theme-color', settings.primaryColor);\n        }\n\n        // 7. Canonical URL\n        if (settings.seoUrl) {\n            updateLinkTag('link-canonical', settings.seoUrl);\n        }\n\n        // 8. Open Graph Tags\n        const ogImage = settings.seoImage || settings.logoUrl || settings.heroUrl || '';\n        updateMetaTagById('og-title', pageTitle);\n        updateMetaTagById('og-description', description);\n        updateMetaTagById('og-site-name', settings.storeName || 'Tienda Online');\n        if (settings.seoUrl) {\n            updateMetaTagById('og-url', settings.seoUrl);\n        }\n        if (ogImage) {\n            updateMetaTagById('og-image', ogImage);\n        }\n\n        // 9. Twitter Card Tags\n        updateMetaTagById('twitter-title', pageTitle);\n        updateMetaTagById('twitter-description', description);\n        if (ogImage) {\n            updateMetaTagById('twitter-image', ogImage);\n        }\n\n        // 10. Favicon (Icono de Pesta√±a) - Auto Circular\n        const link = document.getElementById('dynamic-favicon') || document.querySelector(\"link[rel*='icon']\");\n        if (link) {\n            if (settings.logoUrl) {\n                // Intentar recortar la imagen en c√≠rculo para el favicon\n                const img = new Image();\n                img.crossOrigin = 'Anonymous';\n                img.onload = () => {\n                    try {\n                        const canvas = document.createElement('canvas');\n                        canvas.width = 64;\n                        canvas.height = 64;\n                        const ctx = canvas.getContext('2d');\n                        // Crear c√≠rculo\n                        ctx.beginPath();\n                        ctx.arc(32, 32, 32, 0, Math.PI * 2);\n                        ctx.closePath();\n                        ctx.clip();\n                        // Dibujar imagen\n                        ctx.drawImage(img, 0, 0, 64, 64);\n                        link.href = canvas.toDataURL('image/png');\n                    } catch (e) {\n                        // Fallback si falla canvas (ej: CORS estricto)\n                        link.href = settings.logoUrl;\n                    }\n                };\n                img.onerror = () => { link.href = settings.logoUrl; };\n                img.src = settings.logoUrl;\n            } else {\n                // Si no hay logo configurado, usar el default circular\n                link.href = '/icon-192.png';\n            }\n        }\n\n        console.log('[SEO & AutoSave] Updated and Autosaved.');\n\n        return () => clearTimeout(autoSaveTimer);\n    }, [settings, settingsLoaded, currentUser?.role]);\n\n    // ‚ö†Ô∏è [PAUSA POR SEGURIDAD] - El c√≥digo contin√∫a con la l√≥gica expandida. Escribe \"continuar\" para la siguiente parte.\n    // --- L√ìGICA DE NEGOCIO Y FUNCIONES PRINCIPALES ---\n\n    // 1. L√≥gica de Autenticaci√≥n (Firebase Auth + Perfil en Firestore)\n    const handleAuth = async (isRegister) => {\n        setIsLoading(true);\n        try {\n            const superAdminAttempt = String(authData.email || '').trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n            const normalizedHostname = String(window.location.hostname || '').trim().toLowerCase();\n            const isLocalhost = normalizedHostname === 'localhost' || normalizedHostname === '127.0.0.1' || normalizedHostname === '::1';\n            if (!appId && !superAdminAttempt) {\n                throw new Error('Tienda no configurada para este dominio.');\n            }\n            const usersPath = appId ? ['artifacts', appId, 'public', 'data', 'users'] : null;\n\n            const fetchProfile = async (uid) => {\n                if (!usersPath) return null;\n                const snap = await getDoc(doc(db, ...usersPath, uid));\n                return snap.exists() ? { id: snap.id, ...snap.data() } : null;\n            };\n\n            const setupProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                const res = await fetch('/api/auth/setup-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({\n                        name: authData.name,\n                        username: authData.username,\n                        dni: authData.dni,\n                        phone: authData.phone\n                    })\n                });\n                const data = await res.json().catch(() => ({}));\n                if (!res.ok) throw new Error(data.error || 'Error al crear el perfil');\n            };\n\n            const claimLegacyProfile = async (firebaseUser) => {\n                if (!appId) return;\n                const token = await firebaseUser.getIdToken();\n                await fetch('/api/auth/claim-legacy-profile', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'x-store-id': appId || '',\n                        'Authorization': `Bearer ${token}`\n                    },\n                    body: JSON.stringify({})\n                });\n            };\n\n            if (isRegister) {\n                const normalizedEmail = authData.email.trim().toLowerCase();\n                if (!authData.name || authData.name.trim().length < 3) throw new Error(\"El nombre es muy corto.\");\n                if (!authData.username || authData.username.trim().length < 3) throw new Error(\"Debes elegir un nombre de usuario.\");\n                if (!normalizedEmail || !normalizedEmail.includes('@')) throw new Error(\"Email inv√°lido.\");\n                if (!authData.password || authData.password.length < 6) throw new Error(\"La contrase√±a debe tener al menos 6 caracteres.\");\n                if (!authData.dni || authData.dni.trim().length < 6) throw new Error(\"Debes ingresar tu DNI (m√≠nimo 6 d√≠gitos).\");\n                if (!authData.phone || authData.phone.trim().length < 8) throw new Error(\"Debes ingresar tu tel√©fono (m√≠nimo 8 d√≠gitos).\");\n\n                const userCredential = await createUserWithEmailAndPassword(auth, normalizedEmail, authData.password);\n                try {\n                    await setupProfile(userCredential.user);\n                } catch (e) {\n                    try { await userCredential.user.delete(); } catch { }\n                    throw e;\n                }\n\n                const profile = await fetchProfile(userCredential.user.uid);\n                if (!profile) throw new Error('No se pudo cargar el perfil');\n\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(\"¬°Cuenta creada exitosamente! Bienvenido.\", \"success\");\n            } else {\n                const input = authData.email.trim();\n                if (!input) throw new Error(\"Ingresa tu email o usuario.\");\n                if (!authData.password) throw new Error(\"Ingresa tu contrase√±a.\");\n\n                let emailToUse = input.toLowerCase();\n                let authUser = null;\n\n                if (!input.includes('@')) {\n                    const res = await fetch('/api/auth/username-lookup', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                        body: JSON.stringify({ username: input })\n                    });\n                    const data = await res.json().catch(() => ({}));\n                    if (!res.ok) throw new Error(\"Usuario no encontrado.\");\n                    emailToUse = String(data.email || '').toLowerCase();\n                }\n\n                try {\n                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                    authUser = userCredential.user;\n                } catch (e) {\n                    const code = e?.code || '';\n                    const invalidCredentialCodes = new Set(['auth/invalid-credential', 'auth/invalid-login-credentials']);\n                    if (code === 'auth/user-not-found' || invalidCredentialCodes.has(code)) {\n                        const res = await fetch('/api/auth/legacy-login', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '' },\n                            body: JSON.stringify({ identifier: input, password: authData.password })\n                        });\n                        const raw = await res.text().catch(() => '');\n                        let data = {};\n                        try { data = raw ? JSON.parse(raw) : {}; } catch { data = {}; }\n                        if (!res.ok || !data?.token) {\n                            if (res.status === 401) {\n                                const looksLikeVercel = /<html/i.test(raw) || /login\\s*‚Äì\\s*vercel/i.test(raw) || /vercel/i.test(raw);\n                                if (looksLikeVercel) {\n                                    throw new Error('Tu despliegue est√° respondiendo 401 (Vercel protegido). Desactiv√° Deployment Protection / Vercel Authentication o hac√© el sitio p√∫blico.');\n                                }\n                                throw new Error('Credenciales incorrectas.');\n                            }\n                            if (data?.code === 'firebase_admin_not_configured') {\n                                throw new Error(data.error || 'Backend no configurado (Firebase Admin)');\n                            }\n                            if (superAdminAttempt) {\n                                if (!isLocalhost) {\n                                    throw new Error('El Super Admin no se inicializa desde Vercel. Crealo en Firebase Auth (Authentication > Users) o inicializalo en localhost.');\n                                }\n                                const bootRes = await fetch('/api/auth/bootstrap-super-admin', {\n                                    method: 'POST',\n                                    headers: { 'Content-Type': 'application/json' },\n                                    body: JSON.stringify({ email: emailToUse, password: authData.password })\n                                });\n                                if (bootRes.ok) {\n                                    const userCredential = await signInWithEmailAndPassword(auth, emailToUse, authData.password);\n                                    authUser = userCredential.user;\n                                } else {\n                                    const bootData = await bootRes.json().catch(() => ({}));\n                                    throw new Error(bootData?.error || 'No se pudo inicializar el Super Admin');\n                                }\n                            }\n                            if (!authUser) {\n                                throw new Error(data.error || 'No se pudo recuperar tu cuenta legacy');\n                            }\n                        }\n                        const userCredential = await signInWithCustomToken(auth, data.token);\n                        authUser = userCredential.user;\n                    } else if (code === 'auth/wrong-password') {\n                        throw new Error(\"La contrase√±a es incorrecta.\");\n                    } else if (code === 'auth/too-many-requests') {\n                        throw new Error(\"Demasiados intentos fallidos. Intenta m√°s tarde o restablece tu contrase√±a.\");\n                    } else {\n                        throw e;\n                    }\n                }\n\n                if (!authUser) throw new Error('Error al iniciar sesi√≥n');\n\n                if (!usersPath) {\n                    const normalizedEmailLower = String(authUser.email || emailToUse).toLowerCase();\n                    const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                    setCurrentUser({\n                        id: authUser.uid,\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: superEmailLower && normalizedEmailLower === superEmailLower ? 'admin' : 'user',\n                    });\n                    showToast('Sesi√≥n iniciada. Vincul√° el dominio para cargar la tienda.', 'success');\n                    setView('store');\n                    setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n                    return;\n                }\n\n                let profile = await fetchProfile(authUser.uid);\n                if (!profile) {\n                    await claimLegacyProfile(authUser);\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                if (!profile) {\n                    const minimal = {\n                        name: authUser.displayName || 'Usuario',\n                        email: authUser.email || emailToUse,\n                        emailLower: (authUser.email || emailToUse).toLowerCase(),\n                        role: String(authUser.email || emailToUse).trim().toLowerCase() === String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase() ? 'admin' : 'user',\n                        createdAt: new Date().toISOString()\n                    };\n                    await setDoc(doc(db, ...usersPath, authUser.uid), minimal, { merge: true });\n                    profile = await fetchProfile(authUser.uid);\n                }\n\n                await updateDoc(doc(db, ...usersPath, authUser.uid), { lastLogin: new Date().toISOString() }).catch(() => { });\n                const normalizedEmailLower = String(profile?.emailLower || profile?.email || '').trim().toLowerCase();\n                const superEmailLower = String(SUPER_ADMIN_EMAIL || '').trim().toLowerCase();\n                const normalizedProfile = superEmailLower && normalizedEmailLower === superEmailLower\n                    ? { ...profile, role: 'admin' }\n                    : profile;\n                setCurrentUser(normalizedProfile);\n                showToast(`¬°Hola de nuevo, ${profile?.name || 'Usuario'}!`, \"success\");\n            }\n\n            setView('store');\n            setAuthData({ email: '', password: '', name: '', username: '', dni: '', phone: '' });\n        } catch (error) {\n            console.error(\"Error de autenticaci√≥n:\", error);\n            showToast(error.message || 'Error de autenticaci√≥n', \"error\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 1.1 Recuperar Contrase√±a\n    const handleForgotPassword = async () => {\n        if (!authData.email || !authData.email.includes('@')) {\n            showToast(\"Ingresa tu email en el campo de arriba para recuperar la contrase√±a.\", \"warning\");\n            return;\n        }\n        setIsLoading(true);\n        try {\n            await sendPasswordResetEmail(auth, authData.email);\n            showToast(\"¬°Listo! Revisa tu email (y spam) para restablecer tu contrase√±a.\", \"success\");\n        } catch (e) {\n            console.error(\"Error reset pass:\", e);\n            if (e.code === 'auth/user-not-found') {\n                showToast(\"No existe una cuenta registrada con este email.\", \"error\");\n            } else {\n                showToast(\"Error al enviar email: \" + e.message, \"error\");\n            }\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    // 2. Gesti√≥n de Favoritos (Wishlist)\n    const toggleFavorite = async (product) => {\n        if (!currentUser) {\n            showToast(\"Debes iniciar sesi√≥n para guardar favoritos.\", \"info\");\n            return;\n        }\n\n        const currentFavs = currentUser.favorites || [];\n        const isAlreadyFav = currentFavs.includes(product.id);\n        let newFavs = [];\n\n        if (isAlreadyFav) {\n            // Eliminar de favoritos\n            newFavs = currentFavs.filter(id => id !== product.id);\n            showToast(\"Eliminado de tus favoritos.\", \"info\");\n        } else {\n            // Agregar a favoritos\n            newFavs = [...currentFavs, product.id];\n            showToast(\"¬°Guardado en favoritos!\", \"success\");\n        }\n\n        // Actualizaci√≥n Optimista (UI instant√°nea)\n        setCurrentUser(prev => ({ ...prev, favorites: newFavs }));\n\n        // Persistencia en Firebase\n        try {\n            const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', currentUser.id);\n            await updateDoc(userRef, { favorites: newFavs });\n        } catch (e) {\n            console.error(\"Error guardando favorito:\", e);\n            // Revertir si falla (opcional, por simplicidad no lo incluimos pero ser√≠a ideal)\n        }\n    };\n\n    // 3. Gesti√≥n del Carrito\n    const manageCart = (product, quantityDelta) => {\n        setCart(prevCart => {\n            const existingItemIndex = prevCart.findIndex(item => item.product.id === product.id);\n            const currentQuantity = existingItemIndex >= 0 ? prevCart[existingItemIndex].quantity : 0;\n            const newQuantity = currentQuantity + quantityDelta;\n\n            // Validaciones de Stock (Manejo Dual: Producto Normal vs Promo)\n            let currentStock = 0;\n\n            if (product.isPromo) {\n                // Recalcular stock virtual al momento de agregar (por seguridad)\n                let maxPurchasable = Infinity;\n                product.items.forEach(item => {\n                    const p = products.find(prod => prod.id === item.productId);\n                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                });\n                currentStock = maxPurchasable;\n            } else {\n                currentStock = Number(product.stock);\n            }\n\n            if (newQuantity > currentStock) {\n                showToast(`Lo sentimos, el stock m√°ximo disponible es ${currentStock}.`, \"warning\");\n                return prevCart;\n            }\n\n            // Eliminar item si cantidad llega a 0\n            if (newQuantity <= 0) {\n                if (existingItemIndex >= 0) {\n                    showToast(\"Producto eliminado del carrito.\", \"info\");\n                    return prevCart.filter(item => item.product.id !== product.id);\n                }\n                return prevCart;\n            }\n\n            // Actualizar o Agregar\n            if (existingItemIndex >= 0) {\n                // Actualizar cantidad existente\n                const updatedCart = [...prevCart];\n                updatedCart[existingItemIndex] = { ...updatedCart[existingItemIndex], quantity: newQuantity };\n                return updatedCart;\n            } else {\n                // Agregar nuevo item\n                showToast(\"¬°Producto agregado al carrito!\", \"success\");\n                return [...prevCart, { product: product, quantity: newQuantity }];\n            }\n        });\n    };\n\n    // 4. C√°lculos de Precios y Descuentos\n    const calculateItemPrice = (basePrice, discount) => {\n        if (!discount || discount <= 0) return Number(basePrice);\n        const discounted = Number(basePrice) * (1 - discount / 100);\n        return Math.ceil(discounted);\n    };\n\n    const cartSubtotal = useMemo(() => {\n        return cart.reduce((total, item) => {\n            const price = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            return total + (price * (item.quantity || 0));\n        }, 0);\n    }, [cart]);\n\n    // Aplicar l√≥gica compleja de cupones\n    const calculateDiscountAmount = (total, coupon) => {\n        if (!coupon) return 0;\n\n        // Validar expiraci√≥n y l√≠mites nuevamente por seguridad\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return 0;\n\n        let discountValue = 0;\n\n        if (coupon.type === 'fixed') {\n            discountValue = coupon.value;\n            // No descontar m√°s que el total\n            if (discountValue > total) discountValue = total;\n        } else if (coupon.type === 'percentage') {\n            discountValue = total * (coupon.value / 100);\n            // Aplicar tope si existe\n            if (coupon.maxDiscount && coupon.maxDiscount > 0) {\n                if (discountValue > coupon.maxDiscount) {\n                    discountValue = coupon.maxDiscount;\n                }\n            }\n        }\n\n        return Math.ceil(discountValue);\n    };\n\n    const buildWhatsappUrl = (baseLink, message) => {\n        const trimmed = (baseLink || '').trim();\n        if (!trimmed) return null;\n        try {\n            const url = new URL(trimmed);\n            url.searchParams.set('text', message);\n            return url.toString();\n        } catch {\n            const digits = trimmed.replace(/[^\\d]/g, '');\n            if (!digits) return null;\n            return `https://wa.me/${digits}?text=${encodeURIComponent(message)}`;\n        }\n    };\n\n    const isCouponValidForWhatsapp = (coupon) => {\n        if (!coupon) return false;\n        if (coupon.targetType === 'specific_email' && currentUser?.email) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) return false;\n        }\n        if (coupon.expirationDate && new Date(coupon.expirationDate) < new Date()) return false;\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) return false;\n        if (cartSubtotal < (coupon.minPurchase || 0)) return false;\n        if (!currentUser?.dni) return false;\n        return true;\n    };\n\n    const buildWhatsappCartMessage = () => {\n        const currency = settings?.currency || '$';\n        const storeName = settings?.storeName || 'la tienda';\n\n        const lines = [];\n        lines.push(`Hola, quiero terminar mi compra por WhatsApp en ${storeName}.`);\n\n        if (currentUser?.name) {\n            const userBits = [currentUser.name];\n            if (currentUser.email) userBits.push(currentUser.email);\n            if (currentUser.phone) userBits.push(currentUser.phone);\n            lines.push(`Cliente: ${userBits.join(' - ')}`);\n        } else if (currentUser?.email) {\n            lines.push(`Cliente: ${currentUser.email}`);\n        }\n\n        lines.push('');\n        lines.push('Mi carrito:');\n\n        cart.forEach((item) => {\n            const name = item.product?.name || 'Producto';\n            const quantity = Number(item.quantity) || 0;\n            const unit = calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0);\n            const lineTotal = Math.ceil(unit * quantity);\n            lines.push(`- ${quantity} x ${name} ‚Äî ${currency}${unit.toLocaleString()} c/u ‚Äî ${currency}${lineTotal.toLocaleString()}`);\n        });\n\n        const couponToUse = isCouponValidForWhatsapp(appliedCoupon) ? appliedCoupon : null;\n        const couponDiscount = couponToUse ? calculateDiscountAmount(cartSubtotal, couponToUse) : 0;\n        const messageSubtotal = Math.max(0, Number(cartSubtotal) || 0);\n        const messageShipping = Math.max(0, Number(shippingFee) || 0);\n        const messageTotal = Math.max(0, messageSubtotal - couponDiscount + messageShipping);\n\n        lines.push('');\n        lines.push(`Subtotal: ${currency}${messageSubtotal.toLocaleString()}`);\n\n        if (couponToUse && couponDiscount > 0) {\n            lines.push(`Cup√≥n: ${couponToUse.code}`);\n            lines.push(`Descuento: -${currency}${couponDiscount.toLocaleString()}`);\n        }\n\n        const shippingLabel = checkoutData.shippingMethod === 'Delivery' ? 'Env√≠o a domicilio' : 'Retiro en local';\n        lines.push(`${shippingLabel}: ${messageShipping > 0 ? `${currency}${messageShipping.toLocaleString()}` : 'Gratis'}`);\n        lines.push(`Total estimado: ${currency}${messageTotal.toLocaleString()}`);\n\n        return lines.join('\\n');\n    };\n\n    const discountAmount = appliedCoupon ? calculateDiscountAmount(cartSubtotal, appliedCoupon) : 0;\n\n    const shippingFee = useMemo(() => {\n        if (checkoutData.shippingMethod !== 'Delivery') return 0;\n        const deliverySettings = settings?.shippingDelivery;\n        if (!deliverySettings?.enabled) return 0;\n        if (deliverySettings.freeAbove > 0 && cartSubtotal >= deliverySettings.freeAbove) return 0;\n        return Number(deliverySettings.fee) || 0;\n    }, [checkoutData.shippingMethod, cartSubtotal, settings?.shippingDelivery]);\n\n    const finalTotal = Math.max(0, cartSubtotal - discountAmount + shippingFee);\n\n    // Selecci√≥n de Cup√≥n\n    const selectCoupon = async (coupon) => {\n        // Validaciones previas\n        if (coupon.targetType === 'specific_email' && currentUser) {\n            if (coupon.targetUser && coupon.targetUser.toLowerCase() !== currentUser.email.toLowerCase()) {\n                return showToast(\"Este cup√≥n no est√° disponible para tu cuenta.\", \"error\");\n            }\n        }\n        if (new Date(coupon.expirationDate) < new Date()) {\n            return showToast(\"Este cup√≥n ha vencido.\", \"error\");\n        }\n        if (coupon.usageLimit && coupon.usedBy && coupon.usedBy.length >= coupon.usageLimit) {\n            return showToast(\"Este cup√≥n ha agotado sus usos totales.\", \"error\");\n        }\n        if (cartSubtotal < (coupon.minPurchase || 0)) {\n            return showToast(`El monto m√≠nimo para este cup√≥n es $${coupon.minPurchase}.`, \"warning\");\n        }\n\n        if (!currentUser?.dni) {\n            return showToast(\"Debes actualizar tu DNI en el perfil para usar cupones.\", \"warning\");\n        }\n\n        setAppliedCoupon(coupon);\n        setShowCouponModal(false);\n\n        let msg = \"¬°Cup√≥n aplicado correctamente!\";\n        if (coupon.type === 'percentage' && coupon.maxDiscount > 0) {\n            msg += ` (Tope de reintegro: $${coupon.maxDiscount})`;\n        }\n        showToast(msg, \"success\");\n    };\n\n    // Enviar correo autom√°tico via Backend\n    const sendOrderConfirmationEmail = async (orderData, discountDetails) => {\n        try {\n            await fetch('/api/payment', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                },\n                body: JSON.stringify({\n                    orderId: orderData.orderId,\n                    customer: orderData.customer,\n                    items: orderData.items,\n                    total: orderData.total,\n                    subtotal: orderData.subtotal,\n                    discountDetails: discountDetails,\n                    shipping: orderData.shippingAddress,\n                    shippingFee: orderData.shippingFee,\n                    shippingMethod: orderData.shippingMethod,\n                    paymentMethod: orderData.paymentMethod,\n                    date: orderData.date\n                }),\n            });\n            console.log(\"Correo de confirmaci√≥n enviado enviada API.\");\n        } catch (error) {\n            console.error(\"Error al enviar email autom√°tico:\", error);\n            // No bloqueamos el flujo si falla el email, solo logueamos\n        }\n    };\n\n    const getAuthenticatedUser = async () => {\n        const existing = auth.currentUser;\n        if (existing && !existing.isAnonymous) return existing;\n\n        const hydrated = await new Promise((resolve) => {\n            let unsub = null;\n            const timeoutId = setTimeout(() => {\n                if (unsub) unsub();\n                resolve(auth.currentUser);\n            }, 1200);\n            unsub = onAuthStateChanged(auth, (user) => {\n                clearTimeout(timeoutId);\n                unsub();\n                resolve(user);\n            });\n        });\n\n        if (hydrated && !hydrated.isAnonymous) return hydrated;\n        return null;\n    };\n\n    // 5. Confirmaci√≥n de Pedido (Checkout)\n    const confirmOrder = async () => {\n        if (isProcessingOrder) return;\n\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesi√≥n para finalizar la compra.\", \"info\");\n            }\n\n            let effectiveUser = currentUser;\n            if (!effectiveUser && appId) {\n                try {\n                    const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', authUser.uid));\n                    if (snap.exists()) {\n                        const userData = { id: snap.id, ...snap.data() };\n                        if (userData.role === 'admin') userData._adminVerified = true;\n                        setCurrentUser(userData);\n                        effectiveUser = userData;\n                    }\n                } catch { }\n            }\n\n            if (!effectiveUser) {\n                setView('login');\n                return showToast(\"Por favor inicia sesi√≥n para finalizar la compra.\", \"info\");\n            }\n\n            if (!effectiveUser.name || !effectiveUser.phone || !effectiveUser.dni) {\n                setView('profile');\n                return showToast(\"Por favor completa tus datos personales (Nombre, Tel√©fono y DNI) en tu perfil antes de comprar.\", \"warning\");\n            }\n\n            if (checkoutData.shippingMethod === 'Delivery' && (!checkoutData.address || !checkoutData.city || !checkoutData.province || !checkoutData.zipCode)) {\n                return showToast(\"Por favor completa TODOS los datos de env√≠o.\", \"warning\");\n            }\n\n            if (!checkoutData.paymentChoice) {\n                return showToast(\"Selecciona un m√©todo de pago.\", \"warning\");\n            }\n\n            if (checkoutData.paymentChoice === 'Tarjeta') {\n                throw new Error('Para pagar con tarjeta us√° el formulario de Mercado Pago.');\n            }\n\n            setIsProcessingOrder(true);\n            showToast(\"Procesando tu pedido, por favor espera...\", \"info\");\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: checkoutData.paymentChoice,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) {\n                setView('login');\n                throw new Error('Tu sesi√≥n venci√≥. Inici√° sesi√≥n nuevamente para finalizar la compra.');\n            }\n            if (!res.ok) throw new Error(data.error || 'Error al procesar el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            setView('profile');\n            showToast(\"¬°Pedido realizado con √©xito! Te enviamos un email con el detalle.\", \"success\");\n        } catch (e) {\n            console.error(\"Error al procesar pedido:\", e);\n            showToast(e.message || \"Ocurri√≥ un error al procesar el pedido.\", \"error\");\n        } finally {\n            setIsProcessingOrder(false);\n        }\n    };\n\n    // --- FUNCIONES DE MERCADO PAGO CARD PAYMENT BRICK ---\n\n    // Inicializar el Card Payment Brick cuando se selecciona Mercado Pago\n    const initializeCardPaymentBrick = async () => {\n        if (isInitializingBrick.current) return;\n\n        // Resetear estados al iniciar por si quedaron de una compra anterior\n        setIsPaymentProcessing(false);\n        setPaymentError(null);\n\n        console.log('üíé Mercado Pago: Iniciando Brick. Total a cobrar:', finalTotal);\n\n        if (!window.MercadoPago) {\n            try {\n                await (async () => {\n                    if (window.MercadoPago) return;\n                    await new Promise((resolve, reject) => {\n                        const s = document.createElement('script');\n                        s.src = 'https://sdk.mercadopago.com/js/v2';\n                        s.async = true;\n                        s.onload = resolve;\n                        s.onerror = reject;\n                        document.head.appendChild(s);\n                    });\n                })();\n            } catch {\n                setPaymentError('No se pudo cargar el sistema de pagos. Intent√° nuevamente.');\n                return;\n            }\n        }\n\n        // Sanitizar el monto total para evitar errores de precisi√≥n flotante\n        const safeAmount = Number(parseFloat(finalTotal).toFixed(2));\n        if (isNaN(safeAmount) || safeAmount <= 0) {\n            console.error('‚ùå Error: Monto inv√°lido para pago:', finalTotal);\n            return;\n        }\n\n        const container = document.getElementById('cardPaymentBrick_container');\n        if (!container) return;\n\n        isInitializingBrick.current = true;\n\n        // Timeout de seguridad: si en 10 segundos no carg√≥, permitir reintentar\n        const safetyTimeout = setTimeout(() => {\n            if (isInitializingBrick.current) {\n                console.warn('‚ö†Ô∏è Mercado Pago: La inicializaci√≥n est√° tardando demasiado. Liberando bloqueo...');\n                isInitializingBrick.current = false;\n            }\n        }, 10000);\n\n        // Limpiar brick anterior si existe\n        if (mpBrickController) {\n            try {\n                await mpBrickController.unmount();\n            } catch (e) {\n                console.warn('Error unmounting:', e);\n            }\n            setMpBrickController(null);\n        }\n\n        // Limpiar el contenedor f√≠sicamente por si quedaron restos\n        const containerElem = document.getElementById('cardPaymentBrick_container');\n        if (containerElem) {\n            containerElem.innerHTML = '';\n            // Forzar un reflow/render\n            containerElem.style.display = 'none';\n            containerElem.offsetHeight;\n            containerElem.style.display = 'block';\n        }\n\n        // Limpiar errores previos\n        setPaymentError(null);\n\n        const publicKey = await getMercadoPagoPublicKey();\n        if (!publicKey) {\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            setPaymentError('Mercado Pago no est√° configurado. Verific√° la clave p√∫blica en el servidor.');\n            return;\n        }\n        const mp = new window.MercadoPago(publicKey, {\n            locale: 'es-AR',\n        });\n\n        const bricksBuilder = mp.bricks();\n\n        try {\n            const controller = await bricksBuilder.create('cardPayment', 'cardPaymentBrick_container', {\n                initialization: {\n                    amount: safeAmount, // Total validado y formateado\n                },\n                customization: {\n                    visual: {\n                        style: {\n                            theme: 'default',\n                            customVariables: {\n                                formBackgroundColor: '#0f172a',\n                                baseColor: '#f97316',\n                                borderRadiusMedium: '12px',\n                                borderRadiusLarge: '16px',\n                                textPrimaryColor: '#000000',\n                                textSecondaryColor: '#334155',\n                            },\n                        },\n                    },\n                    paymentMethods: {\n                        maxInstallments: 12,\n                    },\n                },\n                callbacks: {\n                    onReady: () => {\n                        console.log('‚úÖ Mercado Pago: Card Payment Brick cargado.');\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                    },\n                    onSubmit: async (cardFormData) => {\n                        console.log('üöÄ Mercado Pago: Procesando pago...');\n\n                        // Bloquear clics dobles pero permitir reintentos si falla\n                        setIsPaymentProcessing(true);\n                        setPaymentError(null);\n\n                        // Validar datos cr√≠ticos antes de enviar\n                        if (!cardFormData.token) {\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error en los datos de la tarjeta. Por favor intent√° nuevamente.');\n                            showToast('Error al procesar los datos de la tarjeta.', 'error');\n                            return;\n                        }\n\n                        try {\n                            const response = await fetch('/api/checkout', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    action: 'process_payment',\n                                    paymentData: {\n                                        token: cardFormData.token,\n                                        transaction_amount: safeAmount,\n                                        description: `Compra en ${settings?.storeName || 'Tienda Online'}`,\n                                        installments: cardFormData.installments || 1,\n                                        payment_method_id: cardFormData.payment_method_id || '',\n                                        issuer_id: cardFormData.issuer_id || '',\n                                    },\n                                    payer: {\n                                        email: currentUser?.email || 'sin-email@tienda.com',\n                                        identificationType: cardFormData.payer?.identification?.type || 'DNI',\n                                        identificationNumber: cardFormData.payer?.identification?.number || '00000000',\n                                    },\n                                }),\n                            });\n\n                            const result = await response.json().catch(() => ({}));\n                            console.log('üì¶ Respuesta:', result);\n\n                            if (!response.ok) {\n                                const message = result?.error || result?.message || `Error procesando pago (${response.status})`;\n                                throw new Error(message);\n                            }\n\n                            if (result.status === 'approved' || result.status === 'in_process' || result.status === 'pending') {\n                                await confirmOrderAfterPayment(result.id);\n                                showToast('¬°Compra realizada!', 'success');\n                                setIsPaymentProcessing(false);\n                                isInitializingBrick.current = false;\n                                // Limpiar controlador de MP para que la pr√≥xima compra reinicie de cero\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(e); }\n                                    setMpBrickController(null);\n                                }\n                            } else {\n                                // ERROR DE NEGOCIO (Pago rechazado, tarjeta inv√°lida, etc)\n                                const mpErrorMap = {\n                                    'cc_rejected_high_risk': 'El pago fue rechazado por controles de seguridad de Mercado Pago. Te recomendamos probar con otra tarjeta o medio de pago.',\n                                    'cc_rejected_insufficient_amount': 'Tu tarjeta no tiene fondos suficientes.',\n                                    'cc_rejected_bad_filled_other': 'Revis√° los datos de tu tarjeta.',\n                                    'cc_rejected_bad_filled_date': 'La fecha de vencimiento es incorrecta.',\n                                    'cc_rejected_bad_filled_security_code': 'El c√≥digo de seguridad es incorrecto.',\n                                    'cc_rejected_call_for_authorize': 'Deb√©s autorizar el pago llamando a tu banco.',\n                                    'cc_rejected_card_disabled': 'Tu tarjeta est√° inactiva. Llam√° a tu banco para activarla.',\n                                    'cc_rejected_max_attempts': 'Llegaste al l√≠mite de intentos permitidos. Us√° otra tarjeta.',\n                                    'cc_rejected_duplicated_payment': 'Ya hiciste un pago similar recientemente. Esper√° unos minutos.'\n                                };\n                                const detailedError = mpErrorMap[result.status_detail] || result.status_detail || result.error || 'Pago rechazado';\n                                console.error('‚ùå Motivo del rechazo:', detailedError);\n\n                                // IMPORTANTE: Si el pago falla, destruimos el brick para que al reintentar se cree uno nuevo y limpio\n                                if (mpBrickController) {\n                                    try {\n                                        await mpBrickController.unmount();\n                                    } catch (e) { console.log(\"Error al desmontar brick tras falla:\", e); }\n                                    setMpBrickController(null);\n                                }\n                                isInitializingBrick.current = false;\n\n                                setIsPaymentProcessing(false);\n                                // Mensaje de m√°xima tranquilidad para el cliente\n                                setPaymentError(`${detailedError}`); // Mensaje limpio y directo\n                                showToast('El pago no se pudo completar. Revis√° los detalles.', 'error');\n                            }\n                        } catch (error) {\n                            // ERROR DE CONEXI√ìN\n                            console.error('‚ùå Error de conexi√≥n:', error);\n                            setIsPaymentProcessing(false);\n                            setPaymentError('Error de conexi√≥n con el servidor. Revis√° tu internet e intent√° de nuevo.');\n                            showToast('Error de conexi√≥n.', 'error');\n                        }\n                    },\n                    onError: (error) => {\n                        console.error('‚ùå Mercado Pago Error:', error);\n                        isInitializingBrick.current = false;\n                        clearTimeout(safetyTimeout);\n                        // No mostrar error si es solo por AdBlock\n                        if (error && error.message && error.message.includes('melidata')) return;\n                        setPaymentError('Error en el formulario. Verific√° tus claves de producci√≥n.');\n                    },\n                },\n            });\n\n            setMpBrickController(controller);\n        } catch (error) {\n            console.error('Error creating brick:', error);\n            isInitializingBrick.current = false;\n            clearTimeout(safetyTimeout);\n            showToast('Error al cargar el formulario de pago.', 'error');\n        }\n    };\n\n    // Confirmar orden despu√©s de pago exitoso con MP\n    const confirmOrderAfterPayment = async (mpPaymentId) => {\n        try {\n            const authUser = await getAuthenticatedUser();\n            if (!authUser) {\n                throw new Error('Sesi√≥n inv√°lida. Reinici√° e intent√° de nuevo.');\n            }\n\n            const token = await authUser.getIdToken(true);\n            const res = await fetch('/api/orders/confirm', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'x-store-id': appId || '',\n                    'Authorization': `Bearer ${token}`,\n                },\n                body: JSON.stringify({\n                    paymentMethod: 'Tarjeta',\n                    mpPaymentId,\n                    shippingMethod: checkoutData.shippingMethod,\n                    shipping: {\n                        address: checkoutData.address,\n                        city: checkoutData.city,\n                        province: checkoutData.province,\n                        zipCode: checkoutData.zipCode,\n                        fee: shippingFee,\n                    },\n                    couponCode: appliedCoupon?.code || null,\n                    cart: cart.map(i => ({ productId: i.product?.id, quantity: i.quantity })),\n                }),\n            });\n            const data = await res.json().catch(() => ({}));\n            if (res.status === 401) throw new Error('Tu sesi√≥n venci√≥. Inici√° sesi√≥n nuevamente e intent√° otra vez.');\n            if (!res.ok) throw new Error(data.error || 'Error guardando el pedido');\n\n            setCart([]);\n            setAppliedCoupon(null);\n            if (mpBrickController) {\n                try { mpBrickController.unmount(); } catch (e) { }\n            }\n            setMpBrickController(null);\n            setView('profile');\n        } catch (error) {\n            console.error('Error creating order after payment:', error);\n            showToast('El pago fue exitoso pero hubo un error guardando el pedido. Contacta soporte.', 'warning');\n        }\n    };\n\n    // Effect para inicializar el Brick cuando se selecciona MP\n    useEffect(() => {\n        const isCheckoutView = view === 'checkout';\n        const isMP = checkoutData.paymentChoice === 'Tarjeta';\n\n        if (isCheckoutView && isMP && finalTotal > 0 && currentUser && cart.length > 0) {\n            // Validar que el usuario tenga datos completos antes de mostrar formulario de pago\n            if (!currentUser.name || !currentUser.phone || !currentUser.dni) {\n                showToast(\"Por favor complet√° tus datos personales antes de pagar con tarjeta.\", \"warning\");\n                setView('profile');\n                return;\n            }\n\n            // Peque√±o delay para asegurar que el DOM est√° listo\n            const timer = setTimeout(() => {\n                const container = document.getElementById('cardPaymentBrick_container');\n                if (container) {\n                    initializeCardPaymentBrick();\n                }\n            }, 300);\n            return () => clearTimeout(timer);\n        } else if (mpBrickController && (!isCheckoutView || !isMP)) {\n            // Limpiar brick si se cambia de m√©todo de pago O de vista\n            console.log('Sweep: Limpiando Brick por cambio de vista o m√©todo.');\n            try {\n                mpBrickController.unmount();\n            } catch (e) { }\n            setMpBrickController(null);\n            isInitializingBrick.current = false;\n        }\n    }, [checkoutData.paymentChoice, finalTotal, currentUser, cart.length, view]);\n\n    // --- FUNCIONES DE ADMINISTRACI√ìN ---\n\n    // 6. Guardar Producto\n    const saveProductFn = async () => {\n        // Validaciones b√°sicas\n        if (!newProduct.name) return showToast(\"El nombre del producto es obligatorio.\", \"warning\");\n\n        // --- PRODUCT LIMIT CHECK (SUBSCRIPTION) ---\n        const MAX_PRODUCTS_ENTREPRENEUR = 30;\n        const MAX_PRODUCTS_BUSINESS = 50;\n\n        // Check limits only when creating new product\n        if (!editingId) {\n            const currentPlan = settings?.subscriptionPlan || 'entrepreneur';\n            const isEntrepreneur = currentPlan === 'entrepreneur';\n            const isBusiness = currentPlan === 'business';\n\n            if (isEntrepreneur && products.length >= MAX_PRODUCTS_ENTREPRENEUR) {\n                return showToast(`Has alcanzado el l√≠mite de ${MAX_PRODUCTS_ENTREPRENEUR} productos del Plan Emprendedor. ¬°Mejora tu plan para seguir creciendo!`, \"error\");\n            }\n\n            if (isBusiness && products.length >= MAX_PRODUCTS_BUSINESS) {\n                return showToast(`Has alcanzado el l√≠mite de ${MAX_PRODUCTS_BUSINESS} productos del Plan Negocio. ¬°P√°sate a Premium para productos ilimitados!`, \"error\");\n            }\n        }\n\n        if (!newProduct.basePrice || Number(newProduct.basePrice) <= 0) return showToast(\"El precio debe ser mayor a 0.\", \"warning\");\n\n        // Validaci√≥n de categor√≠as (array)\n        const categories = Array.isArray(newProduct.categories) ? newProduct.categories :\n            (newProduct.category ? [newProduct.category] : []);\n        if (categories.length === 0) return showToast(\"Selecciona al menos una categor√≠a.\", \"warning\");\n\n        const productData = {\n            ...newProduct,\n            categories: categories, // Guardar como array\n            basePrice: Number(newProduct.basePrice) || 0,\n            purchasePrice: Number(newProduct.purchasePrice || 0),\n            stock: Number(newProduct.stock) || 0,\n            discount: Number(newProduct.discount || 0),\n            image: newProduct.image || 'https://via.placeholder.com/150',\n            lastUpdated: new Date().toISOString()\n        };\n\n        // Eliminar propiedad legacy para evitar error de \"undefined\" en Firestore\n        if ('category' in productData) delete productData.category;\n\n        try {\n            if (editingId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', editingId), productData);\n                showToast(\"Producto actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), {\n                    ...productData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Producto creado correctamente.\", \"success\");\n            }\n            // Resetear formulario\n            setNewProduct({ name: '', basePrice: '', purchasePrice: '', stock: '', categories: [], image: '', description: '', discount: 0 });\n            setEditingId(null);\n            setShowProductForm(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar el producto.\", \"error\");\n        }\n    };\n\n    // 6.4. Image Upload Handler (Base64 for Vercel)\n    // 6.4. Image Upload Handler (Optimized with Canvas Resize)\n    const handleImageUpload = (e, setTargetState, imageField = 'image', maxWidth = 800) => {\n        const file = e.target.files?.[0];\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n            return showToast(\"Por favor selecciona una imagen v√°lida.\", \"warning\");\n        }\n\n        const reader = new FileReader();\n        reader.onload = (event) => {\n            const img = new Image();\n            img.onload = () => {\n                const canvas = document.createElement('canvas');\n                const MAX_WIDTH = maxWidth;\n                const MAX_HEIGHT = maxWidth;\n                let width = img.width;\n                let height = img.height;\n\n                if (width > height) {\n                    if (width > MAX_WIDTH) {\n                        height *= MAX_WIDTH / width;\n                        width = MAX_WIDTH;\n                    }\n                } else {\n                    if (height > MAX_HEIGHT) {\n                        width *= MAX_HEIGHT / height;\n                        height = MAX_HEIGHT;\n                    }\n                }\n\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(img, 0, 0, width, height);\n\n                const dataUrl = canvas.toDataURL('image/jpeg', 0.7);\n                setTargetState(prev => ({ ...prev, [imageField]: dataUrl }));\n                showToast(\"Imagen optimizada y cargada.\", \"success\");\n            };\n            img.src = event.target.result;\n        };\n        reader.readAsDataURL(file);\n    };\n\n    const resetHomeBannerForm = () => {\n        setEditingHomeBannerId(null);\n        setNewHomeBanner({ imageUrl: '', targetType: 'none', targetId: '', enabled: true, order: 0 });\n    };\n\n    const editHomeBannerFn = (banner) => {\n        if (!banner) return;\n        setEditingHomeBannerId(banner.id);\n        const targetType = banner.targetType || (banner.promoId ? 'promo' : banner.productId ? 'product' : 'none');\n        const targetId = banner.targetId || banner.promoId || banner.productId || '';\n        setNewHomeBanner({\n            imageUrl: banner.imageUrl || '',\n            targetType,\n            targetId,\n            enabled: banner.enabled !== false,\n            order: Number.isFinite(Number(banner.order)) ? Number(banner.order) : 0,\n        });\n    };\n\n    const saveHomeBannerFn = async () => {\n        if (!newHomeBanner?.imageUrl) return showToast(\"Sub√≠ una imagen para el banner.\", \"warning\");\n        const targetType = newHomeBanner?.targetType || 'none';\n        const targetId = newHomeBanner?.targetId || '';\n        if (targetType !== 'none' && !targetId) return showToast(\"Seleccion√° el destino del banner.\", \"warning\");\n\n        const orderValue = Number.isFinite(Number(newHomeBanner.order)) ? Number(newHomeBanner.order) : 0;\n        const payload = {\n            imageUrl: newHomeBanner.imageUrl,\n            enabled: newHomeBanner.enabled !== false,\n            order: orderValue,\n            targetType,\n            targetId: targetType === 'none' ? '' : String(targetId),\n            productId: targetType === 'product' ? String(targetId) : '',\n            promoId: targetType === 'promo' ? String(targetId) : '',\n        };\n\n        try {\n            if (editingHomeBannerId) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', editingHomeBannerId), payload);\n                showToast(\"Banner actualizado.\", \"success\");\n            } else {\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'homeBanners'), {\n                    ...payload,\n                    createdAt: new Date().toISOString(),\n                });\n                showToast(\"Banner creado.\", \"success\");\n            }\n            resetHomeBannerForm();\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error guardando banner: \" + (e?.message || \"error\"), \"error\");\n        }\n    };\n\n    const deleteHomeBannerFn = (banner) => {\n        if (!banner?.id) return;\n        openConfirm(\"Eliminar Banner\", \"¬øEliminar este banner del carrusel?\", async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'homeBanners', banner.id));\n                showToast(\"Banner eliminado.\", \"success\");\n                if (editingHomeBannerId === banner.id) resetHomeBannerForm();\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error eliminando banner: \" + (e?.message || \"error\"), \"error\");\n            }\n        });\n    };\n\n    // 6.5. Eliminar Producto\n    const deleteProductFn = (product) => {\n        openConfirm(\"Eliminar Producto\", `¬øEst√°s seguro de eliminar el producto \"${product.name}\"?`, async () => {\n            try {\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id));\n                showToast(\"Producto eliminado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar el producto.\", \"error\");\n            }\n        });\n    };\n\n    // 6.6. Venta Manual (Fuera de P√°gina)\n    const handleManualSale = (product) => {\n        if (product.stock <= 0) return showToast(\"No hay stock para vender.\", \"warning\");\n\n        openConfirm(\"Venta Manual\", `¬øRegistrar venta manual de 1 unidad de \"${product.name}\"?`, async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-1)\n                });\n                showToast(\"Venta registrada. Stock actualizado.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        });\n    };\n\n    // 6.7. Gesti√≥n de Pedidos (Finalizar/Eliminar)\n    const finalizeOrderFn = (orderId) => {\n        openConfirm(\"Finalizar Pedido\", \"¬øMarcar este pedido como REALIZADO/ENTREGADO?\", async () => {\n            try {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId), {\n                    status: 'Realizado',\n                    lastUpdate: new Date().toISOString()\n                });\n                showToast(\"Pedido finalizado correctamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al finalizar pedido.\", \"error\");\n            }\n        });\n    };\n\n    const deleteOrderFn = (orderId) => {\n        openConfirm(\"Eliminar Pedido\", \"¬øEliminar este pedido permanentemente? El stock de los productos ser√° devuelto al inventario.\", async () => {\n            try {\n                // 1. Obtener datos del pedido antes de eliminar\n                const orderRef = doc(db, 'artifacts', appId, 'public', 'data', 'orders', orderId);\n                const orderSnap = await getDoc(orderRef);\n\n                if (!orderSnap.exists()) {\n                    throw new Error(\"El pedido no existe o ya fue eliminado.\");\n                }\n\n                const orderData = orderSnap.data();\n\n                // 2. Devolver Stock (Iterar items)\n                if (orderData.items && Array.isArray(orderData.items)) {\n                    for (const item of orderData.items) {\n                        if (item.productId && item.quantity > 0) {\n                            const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                            try {\n                                await updateDoc(productRef, {\n                                    stock: increment(item.quantity)\n                                });\n                            } catch (ignore) {\n                                // Si el producto ya no existe, ignoramos el error para permitir borrar el pedido\n                                console.warn(`Producto ${item.productId} no encontrado, no se restaur√≥ stock.`);\n                            }\n                        }\n                    }\n                }\n\n                // 3. Eliminar Documento\n                await deleteDoc(orderRef);\n                showToast(\"Pedido eliminado y stock restaurado exitosamente.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar pedido: \" + e.message, \"error\");\n            }\n        });\n    };\n\n    // 7. Guardar Cup√≥n (COMPLEJO y DETALLADO)\n    const saveCouponFn = async () => {\n        // Validaciones exhaustivas\n        if (!newCoupon.code || newCoupon.code.length < 3) return showToast(\"El c√≥digo del cup√≥n debe tener al menos 3 caracteres.\", \"warning\");\n        if (!newCoupon.value || Number(newCoupon.value) <= 0) return showToast(\"El valor del descuento debe ser mayor a 0.\", \"warning\");\n\n        if (newCoupon.type === 'percentage' && Number(newCoupon.value) > 100) return showToast(\"El porcentaje no puede ser mayor a 100%.\", \"warning\");\n\n        if (newCoupon.targetType === 'specific_user' && !newCoupon.targetUser.includes('@')) {\n            return showToast(\"Si el cup√≥n es para un usuario espec√≠fico, ingresa un email v√°lido.\", \"warning\");\n        }\n\n        try {\n            const couponData = {\n                ...newCoupon,\n                code: newCoupon.code.toUpperCase().trim(),\n                value: Number(newCoupon.value),\n                minPurchase: Number(newCoupon.minPurchase || 0),\n                maxDiscount: Number(newCoupon.maxDiscount || 0),\n                usageLimit: Number(newCoupon.usageLimit || 0),\n                perUserLimit: Number(newCoupon.perUserLimit || 1),\n                targetUser: newCoupon.targetType === 'global' ? '' : newCoupon.targetUser,\n                createdAt: new Date().toISOString(),\n                usedBy: [] // Inicializar array de usos\n            };\n\n            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'coupons'), couponData);\n\n            // Resetear formulario completamente\n            setNewCoupon({\n                code: '', type: 'percentage', value: 0, minPurchase: 0, maxDiscount: 0,\n                expirationDate: '', targetType: 'global', targetUser: '', usageLimit: '', perUserLimit: 1\n            });\n            showToast(\"Cup√≥n de descuento creado exitosamente.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear el cup√≥n.\", \"error\");\n        }\n    };\n\n    // 8. Guardar Proveedor (Crear / Editar)\n    const saveSupplierFn = async () => {\n        if (!newSupplier.name) return showToast(\"El nombre de la empresa es obligatorio.\", \"warning\");\n\n        // Validaci√≥n: Debe tener al menos UN m√©todo de contacto\n        if (!newSupplier.phone && !newSupplier.ig) {\n            return showToast(\"Debes ingresar al menos un m√©todo de contacto (Tel√©fono o Instagram).\", \"warning\");\n        }\n\n        const supplierData = {\n            ...newSupplier,\n            associatedProducts: newSupplier.associatedProducts || [],\n            lastUpdated: new Date().toISOString()\n        };\n\n        try {\n            if (editingSupplierId) {\n                // Editar existente\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', editingSupplierId), supplierData);\n                showToast(\"Proveedor actualizado correctamente.\", \"success\");\n            } else {\n                // Crear nuevo\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'suppliers'), {\n                    ...supplierData,\n                    createdAt: new Date().toISOString()\n                });\n                showToast(\"Proveedor registrado correctamente.\", \"success\");\n            }\n\n            setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] });\n            setEditingSupplierId(null);\n            setShowSupplierModal(false);\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al guardar proveedor.\", \"error\");\n        }\n    };\n\n    // 9. Configuraci√≥n y Equipo (Settings)\n\n\n    // 10. Gesti√≥n de Compras (Editar/Eliminar con l√≥gica de Stock)\n    const deletePurchaseFn = (purchase) => {\n        openConfirm(\"Eliminar Compra\", `¬øEliminar registro de compra? Se descontar√°n ${purchase.quantity} unidades del stock del producto.`, async () => {\n            try {\n                // 1. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', purchase.productId), {\n                    stock: increment(-purchase.quantity)\n                });\n                // 2. Eliminar Compra\n                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', purchase.id));\n                showToast(\"Compra eliminada y stock revertido.\", \"success\");\n            } catch (e) {\n                console.error(e);\n                showToast(\"Error al eliminar compra.\", \"error\");\n            }\n        });\n    };\n\n    const updatePurchaseFn = async (pId, oldData, newData) => {\n        const qtyDiff = (newData.quantity || 0) - (oldData.quantity || 0);\n\n        try {\n            // 1. Actualizar Stock si cambi√≥ la cantidad\n            if (qtyDiff !== 0) {\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', oldData.productId), {\n                    stock: increment(qtyDiff)\n                });\n            }\n            // 2. Actualizar Registro\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'purchases', pId), {\n                quantity: newData.quantity,\n                cost: newData.cost,\n                supplierId: newData.supplierId\n            });\n            setEditingPurchase(null);\n            showToast(\"Compra actualizada y stock ajustado.\", \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al actualizar la compra.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA GESTI√ìN DE CATEGOR√çAS ---\n    const createCategoryFn = async () => {\n        if (!newCategory.trim()) return showToast(\"Ingresa un nombre para la categor√≠a.\", \"warning\");\n\n        try {\n            const updatedCategories = [...(settings.categories || []), newCategory.trim()];\n            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config'), {\n                categories: updatedCategories\n            });\n            setNewCategory('');\n            setShowCategoryModal(false);\n            showToast(`Categor√≠a \"${newCategory}\" creada.`, \"success\");\n        } catch (e) {\n            console.error(e);\n            showToast(\"Error al crear categor√≠a.\", \"error\");\n        }\n    };\n\n    // --- FUNCIONES PARA CARRITO DE COMPRAS (PEDIDOS MAYORISTAS) ---\n    const addToPurchaseCart = (productId, quantity, supplierId) => {\n        if (!productId || !supplierId || quantity <= 0) {\n            return showToast(\"Completa todos los campos.\", \"warning\");\n        }\n\n        const product = products.find(p => p.id === productId);\n        if (!product) return showToast(\"Producto no encontrado.\", \"error\");\n\n        const productPrice = product.purchasePrice || product.basePrice || 0;\n        const cost = productPrice * quantity;\n\n        const existingIndex = purchaseCart.findIndex(item => item.productId === productId);\n\n        if (existingIndex >= 0) {\n            // Actualizar cantidad si ya existe\n            const updated = [...purchaseCart];\n            updated[existingIndex].quantity += quantity;\n            updated[existingIndex].cost = (product.purchasePrice || product.basePrice || 0) * updated[existingIndex].quantity;\n            setPurchaseCart(updated);\n            showToast(`Cantidad actualizada: ${product.name}`, \"success\");\n        } else {\n            // Agregar nuevo item\n            setPurchaseCart([...purchaseCart, {\n                productId,\n                productName: product.name,\n                productImage: product.image,\n                quantity,\n                unitPrice: productPrice,\n                cost,\n                supplierId\n            }]);\n            showToast(`Agregado al pedido: ${product.name}`, \"success\");\n        }\n\n        // Resetear formulario\n        setNewPurchase({ productId: '', supplierId: supplierId, quantity: 1, cost: 0, isNewProduct: false });\n    };\n\n    const removeFromPurchaseCart = (index) => {\n        const updated = purchaseCart.filter((_, i) => i !== index);\n        setPurchaseCart(updated);\n        showToast(\"Producto eliminado del pedido.\", \"info\");\n    };\n\n    const updatePurchaseCartItem = (index, newQuantity) => {\n        const updated = [...purchaseCart];\n        updated[index].quantity = newQuantity;\n        updated[index].cost = updated[index].unitPrice * newQuantity;\n        setPurchaseCart(updated);\n    };\n\n    const finalizePurchaseOrder = async () => {\n        if (purchaseCart.length === 0) {\n            return showToast(\"El carrito de compras est√° vac√≠o.\", \"warning\");\n        }\n\n        try {\n            const batch = writeBatch(db);\n            const batchId = `BATCH - ${Date.now()}`;\n            const timestamp = new Date().toISOString();\n\n            // Registrar cada compra y actualizar stock en Lote (Batch)\n            for (const item of purchaseCart) {\n                // 1. Crear Referencia para Nueva Compra\n                const newPurchaseRef = doc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'));\n                batch.set(newPurchaseRef, {\n                    productId: item.productId,\n                    supplierId: item.supplierId,\n                    quantity: item.quantity,\n                    cost: item.cost,\n                    batchId: batchId,\n                    date: timestamp\n                });\n\n                // 2. Actualizar Stock del Producto (Fixing NaN issues on the fly)\n                const product = products.find(p => p.id === item.productId);\n                const currentStock = isNaN(Number(product?.stock)) ? 0 : Number(product.stock);\n                const newStock = currentStock + item.quantity;\n\n                const productRef = doc(db, 'artifacts', appId, 'public', 'data', 'products', item.productId);\n                batch.update(productRef, {\n                    stock: newStock\n                });\n            }\n\n            await batch.commit();\n\n            setPurchaseCart([]);\n            showToast(`Pedido finalizado: ${purchaseCart.length} productos registrados.`, \"success\");\n        } catch (e) {\n            console.error(\"Error in batch purchase:\", e);\n            showToast(\"Error al finalizar el pedido: \" + e.message, \"error\");\n        }\n    };\n\n    // --- C√ÅLCULOS DEL DASHBOARD (CENTRALIZADOS) ---\n    const dashboardMetrics = useMemo(() => {\n        // 1. Demanda en Vivo y Favoritos (Trending) + VENTAS REALES\n        const productStats = {}; // { id: { cart: 0, fav: 0, sales: 0, total: 0 } }\n\n        // Helper para inicializar stats\n        const initStats = (id) => {\n            if (!productStats[id]) productStats[id] = { cart: 0, fav: 0, sales: 0, total: 0 };\n        };\n\n        // Contar apariciones en Carritos Activos (LiveCarts)\n        liveCarts.forEach(cart => {\n            if (cart.items) {\n                cart.items.forEach(item => {\n                    initStats(item.productId);\n                    productStats[item.productId].cart += 1;\n                    productStats[item.productId].total += 1;\n                });\n            }\n        });\n\n        // Contar apariciones en Favoritos de Usuarios\n        users.forEach(u => {\n            if (u.favorites) {\n                u.favorites.forEach(pid => {\n                    initStats(pid);\n                    productStats[pid].fav += 1;\n                    productStats[pid].total += 1;\n                });\n            }\n        });\n\n        // 2. Finanzas y Ventas Confirmadas (Updated: Solo contar \"Realizado\")\n        const validOrders = orders.filter(o => o.status === 'Realizado');\n        const revenue = validOrders.reduce((acc, o) => acc + (o.total || 0), 0);\n        const expensesTotal = expenses?.reduce((acc, e) => acc + (e.amount || 0), 0) || 0;\n        const purchasesTotal = purchases?.reduce((acc, p) => acc + (p.cost || 0), 0) || 0;\n        const netIncome = revenue - expensesTotal - purchasesTotal;\n\n        // 3. Producto Estrella y Menos Vendido (Ventas reales confirmadas)\n        const salesCount = {}; // { productId: quantity }\n        const productMetadata = {}; // { productId: { name, image } } -> Fallback para productos eliminados\n\n        validOrders.forEach(o => {\n            if (o.items && Array.isArray(o.items)) {\n                o.items.forEach(i => {\n                    const pid = i.productId;\n                    const qty = Number(i.quantity) || 0;\n\n                    // Acumular Ventas\n                    salesCount[pid] = (salesCount[pid] || 0) + qty;\n\n                    // Guardar Metadata (Nombre/Imagen) del item por si el producto ya no existe\n                    if (!productMetadata[pid]) {\n                        productMetadata[pid] = { name: i.title || i.name || 'Producto Desconocido', image: i.image };\n                    }\n\n                    // Sumar a Estad√≠sticas de Tendencia (Peso x5 para ventas reales)\n                    initStats(pid);\n                    productStats[pid].sales += qty;\n                    productStats[pid].total += (qty * 5);\n                });\n            }\n        });\n\n        // Ordenar productos por \"calor\" (total de inter√©s)\n        const trendingProducts = Object.entries(productStats)\n            .map(([id, stats]) => {\n                // Intentar buscar en productos vivos, sino usar metadata del pedido\n                const liveProd = products.find(p => p.id === id);\n                const meta = productMetadata[id] || {};\n\n                // Si el producto no existe en el inventario actual (fue eliminado), no mostrarlo en tendencias\n                if (!liveProd) return null;\n\n                return {\n                    id: id,\n                    name: liveProd.name,\n                    image: liveProd.image,\n                    stock: liveProd.stock,\n                    stats\n                };\n            })\n            .filter(Boolean)\n            .sort((a, b) => b.stats.total - a.stats.total)\n            .slice(0, 5); // Top 5\n\n        // Estrella (M√°s Vendido)\n        let starProductId = null;\n        let maxSales = -1;\n        Object.entries(salesCount).forEach(([id, count]) => {\n            if (count > maxSales) {\n                maxSales = count;\n                starProductId = id;\n            }\n        });\n\n        // Resolver objeto completo para Estrella\n        let starProduct = null;\n        if (starProductId) {\n            const liveStar = products.find(p => p.id === starProductId);\n            const meta = productMetadata[starProductId];\n            if (liveStar || meta) {\n                starProduct = {\n                    id: starProductId,\n                    name: liveStar ? liveStar.name : meta.name,\n                    image: liveStar ? liveStar.image : meta.image,\n                    sales: maxSales,\n                    stock: liveStar ? liveStar.stock : 0\n                };\n            }\n        }\n\n        // Menos Vendido (Peor Producto) - Buscar el m√≠nimo entre TODOS los productos activos\n        // Nota: Solo consideramos productos que A√öN existen en inventario para \"Menos Vendido\"\n        let leastSoldProductId = null;\n        let minSales = Infinity;\n\n        products.forEach(p => {\n            const count = salesCount[p.id] || 0;\n            if (count < minSales) {\n                minSales = count;\n                leastSoldProductId = p.id;\n            }\n        });\n        const leastSoldProduct = leastSoldProductId ? products.find(p => p.id === leastSoldProductId) : null;\n\n        // 4. Anal√≠tica Temporal (Timeline)\n        const timeline = { daily: {}, monthly: {}, yearly: {} };\n        const categoryStats = {}; // { catName: { revenue: 0, items: 0 } }\n\n        validOrders.forEach(o => {\n            const d = new Date(o.date);\n            const dayKey = d.toISOString().split('T')[0]; // YYYY-MM-DD\n            const monthKey = d.toISOString().slice(0, 7); // YYYY-MM\n            const yearKey = d.getFullYear().toString(); // YYYY\n\n            const agg = (obj, key, amount) => {\n                if (!obj[key]) obj[key] = { date: key, revenue: 0, orders: 0 };\n                obj[key].revenue += amount;\n                obj[key].orders += 1;\n            };\n\n            agg(timeline.daily, dayKey, o.total);\n            agg(timeline.monthly, monthKey, o.total);\n            agg(timeline.yearly, yearKey, o.total);\n\n            // Sales By Category\n            if (o.items) {\n                o.items.forEach(item => {\n                    const prod = products.find(p => p.id === item.productId || p.id === item.id);\n                    const cat = prod ? prod.category : 'Otros';\n                    if (!categoryStats[cat]) categoryStats[cat] = { name: cat, revenue: 0, items: 0, percentage: 0 };\n                    categoryStats[cat].revenue += (item.unit_price * item.quantity);\n                    categoryStats[cat].items += item.quantity;\n                });\n            }\n        });\n\n        const analytics = {\n            daily: Object.values(timeline.daily).sort((a, b) => a.date.localeCompare(b.date)),\n            monthly: Object.values(timeline.monthly).sort((a, b) => a.date.localeCompare(b.date)),\n            yearly: Object.values(timeline.yearly).sort((a, b) => a.date.localeCompare(b.date))\n        };\n\n        // Format salesByCategory\n        const totalSalesVolume = Object.values(categoryStats).reduce((acc, c) => acc + c.items, 0);\n        const salesByCategory = Object.values(categoryStats)\n            .map(c => ({\n                ...c,\n                percentage: totalSalesVolume > 0 ? Math.round((c.items / totalSalesVolume) * 100) : 0\n            }))\n            .sort((a, b) => b.items - a.items);\n\n        // 5. Low Stock Alerts\n        const lowStockThreshold = settings?.lowStockThreshold || 5;\n        const lowStockProducts = products.filter(p => !p.promoItems && (Number(p.stock) <= lowStockThreshold));\n\n        // 6. Recent Activity\n        const recentActivity = [...orders].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);\n\n        // 7. Financial Transactions (Ledger)\n        const transactions = [\n            ...validOrders.map(o => ({ id: o.id || o.orderId, type: 'income', category: 'Venta', date: o.date, amount: o.total, description: `Orden #${o.orderId}`, status: o.status })),\n            ...expenses.map(e => ({ id: e.id, type: 'expense', category: e.category || 'Gasto', date: e.date, amount: e.amount, description: e.description, status: 'Pagado' })),\n            ...(purchases || []).map(p => ({ id: p.id, type: 'expense', category: 'Compra Stock', date: p.date, amount: p.cost, description: `Prov: ${p.supplier || 'General'}`, status: 'Completado' })),\n            ...(investments || []).map(i => ({ id: i.id, type: 'income', category: 'Inversi√≥n', date: i.date, amount: i.amount, description: `Inv: ${i.investor}`, status: 'Recibido' }))\n        ].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 100);\n\n        return {\n            revenue,\n            expensesTotal,\n            purchasesTotal,\n            netIncome,\n            trendingProducts,\n            starProduct,\n            leastSoldProduct,\n            salesCount,\n            analytics,\n            salesByCategory,\n            lowStockProducts,\n            recentActivity,\n            transactions,\n            totalOrders: orders.length,\n            totalUsers: users.length\n        };\n    }, [orders, expenses, purchases, products, liveCarts, users, settings]);\n\n    // ‚ö†Ô∏è [PAUSA POR SEGURIDAD] - El c√≥digo contin√∫a con la Interfaz Gr√°fica completa y detallada. Por favor escribe \"continuar\".\n    // --- COMPONENTES UI: MODALES DETALLADOS ---\n\n    // Modal de Detalles de Pedido (Visor Completo)\n    const OrderDetailsModal = ({ order, onClose }) => {\n        if (!order) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\" onClick={onClose}>\n                <div \n                    className={`rounded-[2rem] w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] shadow-2xl border relative transition-colors duration-300 ${darkMode ? 'glass border-slate-800' : 'bg-white border-slate-200'}`}\n                    onClick={e => e.stopPropagation()}\n                >\n                    {/* Header del Modal */}\n                    <div className={`p-8 border-b flex justify-between items-center transition-colors duration-300 ${darkMode ? 'border-slate-800 bg-slate-900/50' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h3 className={`text-2xl font-black flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                DETALLE DE PEDIDO <span className=\"text-orange-500\">#{order.orderId}</span>\n                            </h3>\n                            <div className=\"flex items-center gap-4 mt-2\">\n                                <span className={`text-xs flex items-center gap-1 font-bold tracking-wider transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                    <Clock className=\"w-3 h-3\" /> {new Date(order.date).toLocaleString()}\n                                </span>\n                                <span className={`text-[10px] px-2 py-0.5 rounded border uppercase font-black tracking-widest transition-colors duration-300 ${order.status === 'Realizado' ? (darkMode ? 'bg-green-900/30 text-green-400 border-green-500/30' : 'bg-green-100 text-green-600 border-green-200') : (darkMode ? 'bg-yellow-900/30 text-yellow-400 border-yellow-500/30' : 'bg-yellow-100 text-yellow-600 border-yellow-200')}`}>\n                                    {order.status}\n                                </span>\n                            </div>\n                        </div>\n                        <button onClick={onClose} className={`p-3 rounded-full transition shadow-lg border ${darkMode ? 'bg-slate-800 hover:bg-slate-700 border-slate-700 text-slate-400 hover:text-white' : 'bg-slate-100 hover:bg-slate-200 border-slate-200 text-slate-500 hover:text-slate-900'}`}>\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n\n                    {/* Contenido Scrollable */}\n                    <div className={`p-8 overflow-y-auto space-y-8 custom-scrollbar transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-white'}`}>\n\n                        {/* Estado Visual */}\n                        <div className={`flex justify-between items-center p-6 rounded-2xl border shadow-inner transition-colors duration-300 ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                            <div className=\"flex items-center gap-4\">\n                                <div className={`p-4 rounded-full shadow-lg transition-all duration-300 ${order.status === 'Realizado' ? (darkMode ? 'bg-green-500/20 text-green-400 shadow-[0_0_15px_rgba(34,197,94,0.2)]' : 'bg-green-100 text-green-600') : (darkMode ? 'bg-yellow-500/20 text-yellow-400 shadow-[0_0_15px_rgba(234,179,8,0.2)]' : 'bg-yellow-100 text-yellow-600')}`}>\n                                    {order.status === 'Realizado' ? <CheckCircle className=\"w-8 h-8\" /> : <Clock className=\"w-8 h-8\" />}\n                                </div>\n                                <div>\n                                    <p className={`text-xs uppercase font-bold tracking-widest mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Estado Actual</p>\n                                    <p className={`text-xl font-black transition-colors duration-300 ${order.status === 'Realizado' ? (darkMode ? 'text-green-400' : 'text-green-600') : (darkMode ? 'text-yellow-400' : 'text-yellow-600')}`}>\n                                        {order.status === 'Realizado' ? 'Entregado / Finalizado' : 'Pendiente de Pago/Env√≠o'}\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Columnas de Info */}\n                        <div className=\"grid md:grid-cols-2 gap-6\">\n                            {/* Cliente */}\n                            <div className={`p-6 rounded-2xl border transition duration-300 ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-200 hover:border-slate-300'}`}>\n                                <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                    <User className=\"w-4 h-4\" /> Datos del Cliente\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.name}</p>\n                                    <div className=\"space-y-1\">\n                                        <p className={`text-sm flex justify-between border-b border-dashed pb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400 border-slate-800/50' : 'text-slate-600 border-slate-100'}`}>\n                                            <span>Email:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.email}</span>\n                                        </p>\n                                        <p className={`text-sm flex justify-between border-b border-dashed pb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400 border-slate-800/50' : 'text-slate-600 border-slate-100'}`}>\n                                            <span>Tel√©fono:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.phone || '-'}</span>\n                                        </p>\n                                        <p className={`text-sm flex justify-between transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>DNI:</span> <span className={`font-medium transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{order.customer.dni || '-'}</span>\n                                        </p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Env√≠o */}\n                            <div className={`p-6 rounded-2xl border transition duration-300 ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:border-slate-700' : 'bg-slate-50 border-slate-200 hover:border-slate-300'}`}>\n                                <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                    <Truck className=\"w-4 h-4\" /> Datos de Entrega\n                                </h4>\n                                <div className=\"space-y-3\">\n                                    <p className={`font-medium text-sm leading-relaxed min-h-[3rem] transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-800'}`}>\n                                        {order.shippingAddress || 'Retiro en sucursal'}\n                                    </p>\n                                    <div className={`pt-2 mt-2 border-t transition-colors duration-300 ${darkMode ? 'border-slate-800/50' : 'border-slate-100'}`}>\n                                        <p className={`text-xs uppercase font-bold mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>M√©todo de Pago</p>\n                                        <div className=\"flex items-center gap-2\">\n                                            <CreditCard className=\"w-4 h-4 text-orange-500\" />\n                                            <p className=\"text-orange-500 font-black text-sm uppercase\">{order.paymentMethod}</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Lista de Productos */}\n                        <div>\n                            <h4 className={`text-xs font-black uppercase tracking-widest mb-4 flex items-center gap-2 border-b pb-2 transition-colors duration-300 ${darkMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 border-slate-100'}`}>\n                                <Package className=\"w-4 h-4\" /> Productos ({order.items.length})\n                            </h4>\n                            <div className=\"space-y-3\">\n                                {order.items.map((item, idx) => (\n                                    <div key={idx} className={`flex justify-between items-center p-4 rounded-xl border transition group duration-300 ${darkMode ? 'bg-slate-900/40 border-slate-800 hover:border-orange-900/30' : 'bg-white border-slate-100 hover:border-orange-200 shadow-sm'}`}>\n                                        <div className=\"flex items-center gap-4\">\n                                            <div className={`w-12 h-12 flex items-center justify-center rounded-lg p-1 shadow-md group-hover:scale-105 transition border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-100'}`}>\n                                                {item.image ? <img src={item.image} className=\"w-full h-full object-contain\" /> : <Package className=\"text-slate-400\" />}\n                                            </div>\n                                            <div>\n                                                <p className={`font-bold text-sm transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.title}</p>\n                                                <p className={`text-xs flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>\n                                                    <span className={`px-1.5 rounded text-[10px] font-bold transition-colors duration-300 ${darkMode ? 'bg-slate-800 text-slate-300' : 'bg-slate-100 text-slate-600'}`}>x{item.quantity}</span>\n                                                    <span>${item.unit_price.toLocaleString()} c/u</span>\n                                                </p>\n                                            </div>\n                                        </div>\n                                        <span className={`font-mono font-bold text-lg tracking-tight transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            ${(item.unit_price * item.quantity).toLocaleString()}\n                                        </span>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        {/* Resumen Financiero */}\n                        <div className={`p-6 rounded-2xl border space-y-3 shadow-lg transition-colors duration-300 ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                            <div className={`flex justify-between text-sm font-medium transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                <span>Subtotal Productos</span>\n                                <span>${(order.subtotal || order.total).toLocaleString()}</span>\n                            </div>\n\n                            {order.discount > 0 && (\n                                <div className={`flex justify-between text-sm font-bold p-2 rounded-lg border border-dashed transition-colors duration-300 ${darkMode ? 'text-green-400 bg-green-900/10 border-green-900/30' : 'text-green-600 bg-green-50 border-green-200'}`}>\n                                    <span className=\"flex items-center gap-2\">\n                                        <Ticket className=\"w-3 h-3\" /> Descuento ({order.discountCode || 'Cup√≥n'})\n                                    </span>\n                                    <span>-${order.discount.toLocaleString()}</span>\n                                </div>\n                            )}\n\n                            <div className={`flex justify-between items-center mt-4 pt-4 border-t border-dashed transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-100'}`}>\n                                <span className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total Abonado</span>\n                                <span className={`text-3xl font-black tracking-tighter transition-colors duration-300 ${darkMode ? 'text-orange-500 neon-text' : 'text-orange-600'}`}>\n                                    ${order.total.toLocaleString()}\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal Selector de Cupones (Visualmente Rico)\n    const CouponSelectorModal = () => {\n        if (!showCouponModal) return null;\n\n        // Filtrado de cupones v√°lidos\n        const availableCoupons = coupons.filter(c => {\n            const isNotExpired = !c.expirationDate || new Date(c.expirationDate) > new Date();\n            const isUserTarget = !c.targetUser || (currentUser && c.targetUser === currentUser.email);\n            const isGlobal = c.targetType === 'global';\n            const usedCount = c.usedBy ? c.usedBy.length : 0;\n            const notExhausted = !c.usageLimit || usedCount < c.usageLimit;\n            const userNotUsed = currentUser && c.usedBy && !c.usedBy.includes(currentUser.id);\n\n            return isNotExpired && (isUserTarget || isGlobal) && notExhausted && userNotUsed;\n        });\n\n        return (\n            <div className=\"fixed inset-0 z-[150] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setShowCouponModal(false)}>\n                <div className={`rounded-[2rem] w-full max-w-lg overflow-hidden relative shadow-2xl border transition-colors duration-300 ${darkMode ? 'border-purple-500/20 bg-[#050505]' : 'border-slate-200 bg-white'}`} onClick={e => e.stopPropagation()}>\n                    <button onClick={() => setShowCouponModal(false)} className={`absolute top-6 right-6 p-2 rounded-full transition z-10 ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200'}`}>\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className={`p-8 border-b transition-colors duration-300 ${darkMode ? 'bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-slate-800' : 'bg-gradient-to-br from-slate-50 to-white border-slate-100'}`}>\n                        <h3 className={`text-2xl font-black mb-2 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                            <div className={`p-2 rounded-lg border transition-colors duration-300 ${darkMode ? 'bg-purple-900/20 border-purple-500/30' : 'bg-purple-50 border-purple-200'}`}>\n                                <Gift className={`w-6 h-6 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`} />\n                            </div>\n                            Mis Beneficios\n                        </h3>\n                        <p className={`transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'} text-sm`}>Selecciona un cup√≥n para aplicar el descuento a tu compra.</p>\n                    </div>\n\n                    <div className={`p-8 space-y-4 max-h-[50vh] overflow-y-auto custom-scrollbar transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-white'}`}>\n                        {availableCoupons.length === 0 ? (\n                            <div className={`text-center py-12 border-2 border-dashed rounded-2xl transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                <Ticket className={`w-16 h-16 mx-auto mb-4 transition-colors duration-300 ${darkMode ? 'text-slate-700' : 'text-slate-300'}`} />\n                                <p className={`font-bold text-lg transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>No tienes cupones disponibles.</p>\n                                <p className={`transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'} text-sm mt-2`}>Mantente atento a nuestras redes sociales.</p>\n                            </div>\n                        ) : availableCoupons.map(c => {\n                            const canApply = cartSubtotal >= (c.minPurchase || 0);\n                            return (\n                                <div key={c.id} onClick={() => canApply && selectCoupon(c)} className={`relative overflow-hidden rounded-2xl border transition-all duration-300 group ${\n                                    canApply \n                                        ? (darkMode ? 'bg-slate-900 border-slate-700 hover:border-purple-500 cursor-pointer hover:shadow-[0_0_20px_rgba(168,85,247,0.15)] hover:scale-[1.02]' : 'bg-white border-slate-200 hover:border-purple-500 cursor-pointer hover:shadow-xl hover:scale-[1.02]') \n                                        : (darkMode ? 'bg-slate-900/50 border-slate-800 opacity-50 cursor-not-allowed grayscale' : 'bg-slate-50 border-slate-100 opacity-50 cursor-not-allowed grayscale')\n                                }`}>\n                                    {/* Decoraci√≥n lateral */}\n                                    <div className={`absolute top-0 left-0 w-2 h-full transition-colors duration-300 ${canApply ? 'bg-purple-500' : (darkMode ? 'bg-slate-700' : 'bg-slate-300')}`}></div>\n\n                                    <div className=\"p-5 pl-8 flex justify-between items-center\">\n                                        <div className=\"flex-1\">\n                                            <div className=\"flex items-center gap-3 mb-2\">\n                                                <span className={`font-black text-xl tracking-widest font-mono transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{c.code}</span>\n                                                <span className={`text-[10px] px-2 py-0.5 rounded border uppercase font-bold transition-colors duration-300 ${darkMode ? 'bg-purple-900/30 text-purple-300 border-purple-500/30' : 'bg-purple-50 text-purple-600 border-purple-200'}`}>\n                                                    {c.type === 'fixed' ? 'DESCUENTO FIJO' : 'PORCENTAJE'}\n                                                </span>\n                                            </div>\n                                            <p className={`font-bold text-sm transition-colors duration-300 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                                {c.type === 'fixed' ? `Ahorra $${c.value}` : `${c.value}% de Descuento`}\n                                                {c.maxDiscount > 0 && <span className={`transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'} text-xs ml-1 font-normal`}>(Tope ${c.maxDiscount})</span>}\n                                            </p>\n\n                                            {/* Validaci√≥n visual de m√≠nimo de compra */}\n                                            {c.minPurchase > 0 && (\n                                                <p className={`text-xs mt-3 font-bold flex items-center gap-1 transition-colors duration-300 ${canApply ? (darkMode ? 'text-slate-500' : 'text-slate-400') : 'text-red-400'}`}>\n                                                    {canApply ? <CheckCircle className=\"w-3 h-3\" /> : <AlertCircle className=\"w-3 h-3\" />}\n                                                    Compra m√≠nima: ${c.minPurchase}\n                                                </p>\n                                            )}\n                                        </div>\n\n                                        {/* Bot√≥n de acci√≥n */}\n                                        {canApply && (\n                                            <div className=\"w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center text-white shadow-lg transform group-hover:scale-110 transition ml-4\">\n                                                <Plus className=\"w-6 h-6\" />\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n    // Modal de Detalle de Producto / Promo (Versi√≥n Premium)\n    const ProductDetailModal = () => {\n        if (!selectedProduct) return null;\n\n        const [qty, setQty] = useState(1);\n        const [added, setAdded] = useState(false);\n\n        const isPromo = selectedProduct.isPromo || !!selectedProduct.items;\n        const stockLimit = isPromo ? Number(selectedProduct.stock) : Number(selectedProduct.stock);\n\n        // Calcular stock real disponible restando lo que ya est√° en carrito\n        const cartItem = cart.find(item => item.product.id === selectedProduct.id);\n        const inCartQty = cartItem ? cartItem.quantity : 0;\n        const availableToAdd = Math.max(0, stockLimit - inCartQty);\n\n        const hasStock = stockLimit > 0;\n        const isMaxInCart = availableToAdd === 0 && hasStock;\n        const displayPrice = isPromo ? Number(selectedProduct.price || selectedProduct.basePrice) : calculateItemPrice(selectedProduct.basePrice, selectedProduct.discount);\n\n        const handleAdd = (e) => {\n            e.stopPropagation();\n            if (!hasStock) return;\n\n            const itemToAdd = isPromo ? {\n                id: selectedProduct.id,\n                name: selectedProduct.name,\n                basePrice: selectedProduct.price || selectedProduct.basePrice,\n                image: selectedProduct.image,\n                isPromo: true,\n                items: selectedProduct.items,\n                stock: selectedProduct.stock\n            } : selectedProduct;\n\n            manageCart(itemToAdd, qty);\n            setAdded(true);\n            setTimeout(() => setAdded(false), 2000);\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[20000] flex items-center justify-center bg-black/90 backdrop-blur-xl animate-fade-in p-4\" onClick={() => setSelectedProduct(null)}>\n                <div className={`border rounded-[2.5rem] max-w-4xl w-full overflow-hidden flex flex-col md:flex-row shadow-2xl animate-scale-up relative h-full md:h-auto overflow-y-auto md:overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`} onClick={e => e.stopPropagation()}>\n\n                    {/* Imagen con Zoom y Efectos */}\n                    <div className={`md:w-1/2 h-72 md:h-[550px] p-8 md:p-12 flex items-center justify-center relative overflow-hidden group ${darkMode ? 'bg-gradient-to-b from-slate-900 to-[#0a0a0a]' : 'bg-gradient-to-b from-slate-100 to-white'}`}>\n                        <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/5 to-transparent opacity-50 group-hover:opacity-100 transition duration-500\"></div>\n                        <img\n                            src={selectedProduct.image}\n                            className={`w-full h-full object-contain z-10 transition-transform duration-700 hover:scale-110 ${darkMode ? 'drop-shadow-[0_0_50px_rgba(255,255,255,0.15)]' : 'drop-shadow-[0_0_50px_rgba(0,0,0,0.1)]'}`}\n                        />\n                        {/* Badges de Estado */}\n                        {!hasStock && (\n                            <div className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/40 backdrop-blur-[2px]\">\n                                <div className=\"border-4 border-red-500 p-4 -rotate-12 bg-black shadow-2xl\">\n                                    <span className=\"text-red-500 font-black text-2xl tracking-widest uppercase\">AGOTADO</span>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Panel de Informaci√≥n y Acci√≥n */}\n                    <div className={`md:w-1/2 p-8 md:p-12 flex flex-col ${darkMode ? 'bg-[#080808]' : 'bg-white'}`}>\n                        <div className=\"mb-8\">\n                            <span className={`inline-block px-3 py-1 text-[10px] font-black uppercase tracking-[0.2em] rounded mb-4 border ${darkMode ? 'bg-orange-500/10 text-orange-400 border-orange-500/20' : 'bg-orange-50 text-orange-600 border-orange-200'}`}>\n                                {isPromo ? 'COMBOS & PROMOCIONES' : selectedProduct.category}\n                            </span>\n                            <h2 className={`text-3xl md:text-4xl font-black leading-[1.1] mb-6 ${darkMode ? 'text-white neon-text-small' : 'text-slate-900'}`}>{selectedProduct.name}</h2>\n                            <p className={`text-sm md:text-base leading-relaxed line-clamp-4 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                {selectedProduct.description || ''}\n                            </p>\n                        </div>\n\n                        {/* Lista de productos para Promos */}\n                        {isPromo && selectedProduct.items && (\n                            <div className={`mb-8 space-y-3 p-6 rounded-2xl border shadow-inner ${darkMode ? 'bg-purple-500/5 border-purple-500/20' : 'bg-purple-50 border-purple-200'}`}>\n                                <p className={`text-[10px] uppercase font-black tracking-[0.2em] flex items-center gap-2 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                    <Sparkles className=\"w-3 h-3\" /> Este pack incluye:\n                                </p>\n                                <div className=\"space-y-2\">\n                                    {selectedProduct.items.map((item, idx) => {\n                                        const p = products.find(prod => prod.id === item.productId);\n                                        return (\n                                            <div key={idx} className={`flex items-center gap-3 text-sm group/item ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>\n                                                <div className={`w-6 h-6 rounded-lg flex items-center justify-center text-[10px] font-black group-hover/item:text-white transition ${darkMode ? 'bg-purple-500/20 text-purple-400 group-hover/item:bg-purple-500' : 'bg-purple-100 text-purple-600 group-hover/item:bg-purple-600'}`}>\n                                                    {item.quantity}x\n                                                </div>\n                                                <span className={`font-bold transition ${darkMode ? 'group-hover:text-white' : 'group-hover:text-slate-900'}`}>{p?.name || 'Producto del Packs'}</span>\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Footer con Precio y Carrito */}\n                        <div className={`mt-auto pt-8 border-t flex flex-col gap-6 ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                            <div className=\"flex items-end justify-between\">\n                                <div className=\"flex flex-col\">\n                                    <span className={`text-xs font-bold uppercase tracking-wider mb-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Inversi√≥n Total</span>\n                                    <div className=\"flex items-center gap-3\">\n                                        {selectedProduct.discount > 0 && !isPromo && (\n                                            <span className={`text-sm line-through font-bold ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>${(selectedProduct.basePrice * qty).toLocaleString()}</span>\n                                        )}\n                                        <span className={`text-4xl font-black tracking-tighter ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            ${(displayPrice * qty).toLocaleString()}\n                                        </span>\n                                    </div>\n                                </div>\n                                {selectedProduct.discount > 0 && !isPromo && (\n                                    <div className=\"px-3 py-1 bg-red-500 text-white rounded-lg text-[10px] font-black animate-pulse\">\n                                        -{selectedProduct.discount}% OFF\n                                    </div>\n                                )}\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                {/* Selector de Cantidad */}\n                                <div className={`flex items-center gap-3 rounded-2xl p-2 border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}>\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.max(1, qty - 1)); }}\n                                        disabled={qty <= 1}\n                                        className={`w-12 h-12 flex items-center justify-center rounded-xl transition disabled:opacity-30 disabled:cursor-not-allowed ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}\n                                    >\n                                        <Minus className=\"w-5 h-5\" />\n                                    </button>\n                                    <span className={`text-xl font-bold w-8 text-center font-mono ${darkMode ? 'text-white' : 'text-slate-900'}`}>{qty}</span>\n                                    <button\n                                        onClick={(e) => { e.stopPropagation(); setQty(Math.min(availableToAdd, qty + 1)); }}\n                                        disabled={qty >= availableToAdd}\n                                        className={`w-12 h-12 flex items-center justify-center rounded-xl transition disabled:opacity-30 disabled:cursor-not-allowed ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}\n                                    >\n                                        <Plus className=\"w-5 h-5\" />\n                                    </button>\n                                </div>\n\n                                <button\n                                    onClick={handleAdd}\n                                    disabled={!hasStock || isMaxInCart}\n                                    className={`flex-1 py-5 rounded-2xl font-black transition flex items-center justify-center gap-3 shadow-2xl ${added\n                                        ? 'bg-green-500 text-white'\n                                        : (hasStock && !isMaxInCart)\n                                            ? (darkMode ? 'bg-white text-black hover:bg-orange-400 hover:text-white hover:scale-[1.02] active:scale-[0.98]' : 'bg-slate-900 text-white hover:bg-orange-600 hover:scale-[1.02] active:scale-[0.98]')\n                                            : (darkMode ? 'bg-slate-900 text-slate-600 border border-slate-800 cursor-not-allowed' : 'bg-slate-200 text-slate-400 border border-slate-300 cursor-not-allowed')\n                                        }`}\n                                >\n                                    {added ? (\n                                        <><CheckCircle className=\"w-6 h-6\" /> LISTO</>\n                                    ) : isMaxInCart ? (\n                                        <><AlertCircle className=\"w-6 h-6\" /> MAX EN CARRITO</>\n                                    ) : hasStock ? (\n                                        <><ShoppingCart className=\"w-6 h-6\" /> AGREGAR</>\n                                    ) : (\n                                        <><AlertCircle className=\"w-6 h-6\" /> AGOTADO</>\n                                    )}\n                                </button>\n                            </div>\n                        </div>\n\n\n                        {/* Bot√≥n Cerrar */}\n                        <button\n                            onClick={() => setSelectedProduct(null)}\n                            className={`absolute top-4 right-4 md:top-6 md:right-6 p-4 rounded-full transition-all border z-[30] shadow-2xl backdrop-blur-md ${darkMode ? 'bg-black/60 md:bg-white/5 hover:bg-white/10 text-white md:text-slate-400 hover:text-white border-white/20 md:border-white/5' : 'bg-white/60 md:bg-slate-900/5 hover:bg-slate-900/10 text-slate-900 md:text-slate-500 hover:text-slate-900 border-slate-200 md:border-slate-900/5'}`}\n                            title=\"Cerrar detalle\"\n                        >\n                            <X className=\"w-6 h-6 md:w-5 md:h-5\" />\n                        </button>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Venta Manual (Offline / \"En Casa\")\n    const ManualSaleModal = () => {\n        // State is now hoisted to App (saleData, setSaleData)\n\n        if (!showManualSaleModal) return null;\n\n        const product = products.find(p => p.id === saleData.productId);\n\n        const handleProductChange = (e) => {\n            const pid = e.target.value;\n            const prod = products.find(p => p.id === pid);\n            setSaleData({\n                ...saleData,\n                productId: pid,\n                price: prod ? Number(prod.basePrice) : 0\n            });\n        };\n\n        const handleSubmit = async (e) => {\n            e.preventDefault();\n            if (!product) return showToast(\"Selecciona un producto.\", \"warning\");\n            if (saleData.quantity <= 0) return showToast(\"Cantidad inv√°lida.\", \"warning\");\n\n            try {\n                // Verificar Stock\n                const currentStock = Number(product.stock) || 0;\n                if (saleData.quantity > currentStock) {\n                    return showToast(`Stock insuficiente (Disponible: ${currentStock}).`, \"error\");\n                }\n\n                // Crear Orden \"Offline\"\n                const orderId = `man-${Date.now().toString().slice(-6)}`;\n                const total = saleData.quantity * saleData.price;\n\n                const newOrder = {\n                    orderId: orderId,\n                    userId: 'manual_admin', // Usuario sistema\n                    customer: {\n                        name: saleData.customerName || 'Cliente Mostrador',\n                        email: 'offline@store.com',\n                        phone: '-',\n                        dni: '-'\n                    },\n                    items: [{\n                        productId: product.id,\n                        title: product.name,\n                        quantity: Number(saleData.quantity),\n                        unit_price: Number(saleData.price),\n                        image: product.image\n                    }],\n                    subtotal: total,\n                    discount: 0,\n                    total: total,\n                    status: 'Realizado', // Ya entregado\n                    date: new Date().toISOString(),\n                    shippingAddress: 'Entrega Presencial (Offline)',\n                    paymentMethod: saleData.paymentMethod,\n                    source: 'manual_sale',\n                    notes: saleData.notes\n                };\n\n                // 1. Guardar Pedido\n                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);\n\n                // 2. Descontar Stock\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', product.id), {\n                    stock: increment(-Number(saleData.quantity))\n                });\n\n                showToast(\"Venta registrada correctamente.\", \"success\");\n                setShowManualSaleModal(false);\n            } catch (err) {\n                console.error(err);\n                showToast(\"Error al registrar venta manual.\", \"error\");\n            }\n        };\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setShowManualSaleModal(false)}>\n                <div className={`rounded-[2rem] w-full max-w-lg border shadow-2xl relative overflow-hidden transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`} onClick={e => e.stopPropagation()}>\n                    <button onClick={() => setShowManualSaleModal(false)} className={`absolute top-6 right-6 p-2 rounded-full transition z-10 ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-400 hover:text-slate-900'}`}>\n                        <X className=\"w-5 h-5\" />\n                    </button>\n\n                    <div className={`p-8 border-b transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-100'}`}>\n                        <h3 className={`text-2xl font-black flex items-center gap-3 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                            <Store className=\"w-6 h-6 text-green-400\" /> Registrar Venta Manual\n                        </h3>\n                        <p className={`text-sm mt-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Para ventas fuera de la plataforma web.</p>\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"p-8 space-y-4\">\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Producto</label>\n                            <select\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.productId}\n                                onChange={handleProductChange}\n                            >\n                                <option value=\"\">-- Seleccionar Producto --</option>\n                                {products.map(p => (\n                                    <option key={p.id} value={p.id}>\n                                        {p.name} (Stock: {p.stock})\n                                    </option>\n                                ))}\n                            </select>\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Cantidad</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"1\"\n                                    className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                    value={saleData.quantity}\n                                    onChange={e => setSaleData({ ...saleData, quantity: Number(e.target.value) })}\n                                />\n                            </div>\n                            <div>\n                                <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Precio Unit. ($)</label>\n                                <input\n                                    type=\"number\"\n                                    min=\"0\"\n                                    className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                    value={saleData.price}\n                                    onChange={e => setSaleData({ ...saleData, price: Number(e.target.value) })}\n                                />\n                            </div>\n                        </div>\n\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Cliente / Notas</label>\n                            <input\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.customerName}\n                                onChange={e => setSaleData({ ...saleData, customerName: e.target.value })}\n                            />\n                        </div>\n\n                        <div>\n                            <label className={`text-xs font-bold uppercase tracking-widest block mb-1 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>M√©todo de Pago</label>\n                            <select\n                                className={`w-full rounded-xl p-3 focus:border-green-500 outline-none transition-all duration-300 ${darkMode ? 'bg-slate-900 border border-slate-700 text-white' : 'bg-slate-50 border border-slate-200 text-slate-900'}`}\n                                value={saleData.paymentMethod}\n                                onChange={e => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                            >\n                                <option value=\"Efectivo\">Efectivo</option>\n                                <option value=\"Transferencia\">Transferencia</option>\n                                <option value=\"Tarjeta\">Tarjeta (POS)</option>\n                            </select>\n                        </div>\n\n                        <button type=\"submit\" className=\"w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-900/20 transition transform hover:-translate-y-1 mt-4\">\n                            REGISTRAR VENTA\n                        </button>\n                    </form>\n                </div>\n            </div>\n        );\n    };\n\n    // Modal de Anal√≠ticas Detalladas (Drill-down)\n    const MetricsDetailModal = () => {\n        const [timeframe, setTimeframe] = useState('monthly'); // daily, monthly, yearly\n        if (!metricsDetail) return null;\n\n        const data = dashboardMetrics.analytics[timeframe] || [];\n        const title = metricsDetail.type === 'revenue' ? 'Ingresos Brutos' : 'Beneficio Neto';\n        const colorClass = metricsDetail.type === 'revenue' ? 'text-green-400' : 'text-orange-400';\n\n        // Calcular mejores/peores\n        const sortedByVal = [...data].sort((a, b) => b.revenue - a.revenue);\n        const bestPeriod = sortedByVal[0];\n        const worstPeriod = sortedByVal[sortedByVal.length - 1];\n\n        return (\n            <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-up\" onClick={() => setMetricsDetail(null)}>\n                <div \n                    className={`rounded-[2.5rem] w-full max-w-4xl max-h-[90vh] flex flex-col border shadow-2xl relative overflow-hidden transition-colors duration-300 ${darkMode ? 'bg-[#050505] border-slate-800' : 'bg-white border-slate-200'}`}\n                    onClick={e => e.stopPropagation()}\n                >\n                    {/* Header */}\n                    <div className={`p-8 border-b flex justify-between items-center ${darkMode ? 'border-slate-800 bg-slate-900/20' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h3 className={`text-3xl font-black ${colorClass} flex items-center gap-3`}>\n                                <BarChart className=\"w-8 h-8\" /> {title} - Anal√≠tica\n                            </h3>\n                            <p className=\"text-slate-500 text-sm mt-1\">Desglose detallado de tu rendimiento.</p>\n                        </div>\n                        <button \n                            onClick={() => setMetricsDetail(null)} \n                            className={`p-3 rounded-full transition border ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white border-slate-700' : 'bg-slate-100 text-slate-500 hover:text-slate-900 border-slate-200'}`}\n                        >\n                            <X className=\"w-5 h-5\" />\n                        </button>\n                    </div>\n\n                    {/* Controls */}\n                    <div className={`p-6 flex gap-4 border-b justify-center ${darkMode ? 'bg-slate-900/10 border-slate-800/50' : 'bg-slate-50/50 border-slate-100'}`}>\n                        {['daily', 'monthly', 'yearly'].map(t => (\n                            <button\n                                key={t}\n                                onClick={() => setTimeframe(t)}\n                                className={`px-6 py-2 rounded-full text-xs font-black uppercase tracking-widest transition ${\n                                    timeframe === t \n                                        ? (darkMode ? 'bg-slate-100 text-black' : 'bg-slate-900 text-white') \n                                        : (darkMode ? 'bg-slate-900 text-slate-500 hover:text-white border border-slate-800' : 'bg-white text-slate-400 hover:text-slate-600 border border-slate-200')\n                                }`}\n                            >\n                                {t === 'daily' ? 'Diario' : t === 'monthly' ? 'Mensual' : 'Anual'}\n                            </button>\n                        ))}\n                    </div>\n\n                    {/* Stats Highlights */}\n                    <div className={`grid grid-cols-2 gap-4 p-6 ${darkMode ? 'bg-slate-900/5' : 'bg-slate-50/30'}`}>\n                        <div className={`border p-4 rounded-2xl flex items-center gap-4 ${darkMode ? 'bg-green-900/10 border-green-500/20' : 'bg-green-50 border-green-100'}`}>\n                            <div className={`p-3 rounded-xl ${darkMode ? 'bg-green-500/20 text-green-400' : 'bg-green-100 text-green-600'}`}>\n                                <TrendingUp className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Mejor Periodo</p>\n                                <p className={`${darkMode ? 'text-green-400' : 'text-green-600'} font-black text-lg`}>\n                                    {bestPeriod ? `$${bestPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{bestPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                        <div className={`border p-4 rounded-2xl flex items-center gap-4 ${darkMode ? 'bg-red-900/10 border-red-500/20' : 'bg-red-50 border-red-100'}`}>\n                            <div className={`p-3 rounded-xl ${darkMode ? 'bg-red-500/20 text-red-400' : 'bg-red-100 text-red-600'}`}>\n                                <TrendingDown className=\"w-6 h-6\" />\n                            </div>\n                            <div>\n                                <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Peor Periodo</p>\n                                <p className={`${darkMode ? 'text-red-400' : 'text-red-600'} font-black text-lg`}>\n                                    {worstPeriod ? `$${worstPeriod.revenue.toLocaleString()}` : '-'}\n                                </p>\n                                <p className=\"text-[10px] text-slate-500 font-mono\">{worstPeriod?.date || '-'}</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* CSS Bar Chart */}\n                    <div className=\"flex-1 p-6 relative flex items-end justify-between gap-2 overflow-x-auto custom-scrollbar\">\n                        {data.length === 0 ? (\n                            <div className={`w-full text-center my-auto transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>No hay datos para mostrar el gr√°fico.</div>\n                        ) : (\n                            (() => {\n                                const maxVal = Math.max(...data.map(d => d.revenue), 1); // Avoid div/0\n                                return data.slice().map((item, idx) => {\n                                    const heightPct = (item.revenue / maxVal) * 100;\n                                    \n                                    return (\n                                        <div key={idx} className={`flex flex-col items-center justify-end h-full gap-2 group min-w-[60px] cursor-pointer rounded-xl p-1 transition-all ${darkMode ? 'hover:bg-slate-900/30' : 'hover:bg-slate-100'}`}>\n                                            {/* Tooltip on Hover */}\n                                            <div className={`opacity-0 group-hover:opacity-100 absolute bottom-full mb-2 border px-3 py-2 rounded-xl pointer-events-none transition z-50 shadow-xl max-w-[min(240px,70vw)] whitespace-normal break-words ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-white border-slate-200'}`}>\n                                                <p className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.date}</p>\n                                                <p className={`font-black ${colorClass}`}>${item.revenue.toLocaleString()}</p>\n                                                <p className={`text-[10px] ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>{item.orders} Pedidos</p>\n                                            </div>\n\n                                            {/* Bar */}\n                                            <div\n                                                className={`w-4 bg-gradient-to-t rounded-t-full relative transition-all duration-500 group-hover:w-6 group-hover:brightness-125 ${\n                                                    metricsDetail.type === 'revenue' \n                                                        ? (darkMode ? 'from-green-900/50 to-green-500' : 'from-green-200 to-green-600') \n                                                        : (darkMode ? 'from-orange-900/50 to-orange-500' : 'from-orange-200 to-orange-600')\n                                                }`}\n                                                style={{ height: `${Math.max(heightPct, 5)}%` }} // Min height 5%\n                                            >\n                                                {/* Glow alignment */}\n                                                <div className={`absolute top-0 left-0 right-0 h-4 rounded-full blur-md opacity-20 ${metricsDetail.type === 'revenue' ? 'bg-green-400' : 'bg-orange-400'}`}></div>\n                                            </div>\n\n                                            {/* Label */}\n                                            <p className={`text-[10px] font-bold -rotate-45 group-hover:rotate-0 transition origin-center mt-2 truncate w-full text-center ${darkMode ? 'text-slate-600 group-hover:text-white' : 'text-slate-400 group-hover:text-slate-900'}`}>\n                                                {timeframe === 'monthly' ? item.date.slice(5) : timeframe === 'daily' ? item.date.slice(5) : item.date}\n                                            </p>\n                                        </div>\n                                    );\n                                })\n                            })()\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n\n    // --- SUB-COMPONENTS FOR ADMIN DRAWER ---\n\n    const UserCartView = ({ cartItems, isLoading }) => {\n        if (isLoading) {\n            return (\n                <div className=\"py-20 flex flex-col items-center gap-4 opacity-50\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-orange-400\" />\n                    <p className={`text-xs font-black tracking-widest transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>SINCRONIZANDO DATOS...</p>\n                </div>\n            );\n        }\n        if (cartItems.length === 0) {\n            return (\n                <div className=\"py-20 text-center flex flex-col items-center gap-6\">\n                    <div className={`p-6 rounded-full border transition-colors duration-300 ${darkMode ? 'bg-white/5 border-white/5' : 'bg-slate-100 border-slate-200'}`}>\n                        <ShoppingCart className={`w-12 h-12 transition-colors duration-300 ${darkMode ? 'text-slate-700' : 'text-slate-300'}`} />\n                    </div>\n                    <p className={`text-sm font-black uppercase tracking-widest italic transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>No hay productos activos</p>\n                </div>\n            );\n        }\n        return (\n            <>\n                <div className=\"flex justify-between items-center px-2\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Contenido del Carrito</p>\n                    <p className=\"text-xs font-bold text-orange-400 bg-orange-400/10 px-3 py-1 rounded-full\">{cartItems.length} ITEMS</p>\n                </div>\n                <div className=\"space-y-3\">\n                    {cartItems.map((item, idx) => (\n                        <div key={idx} className={`border p-4 rounded-2xl flex gap-4 transition group animate-fade-up transition-colors duration-300 ${darkMode ? 'bg-white/[0.03] border-white/10 hover:bg-white/[0.05] hover:border-orange-500/20' : 'bg-slate-50 border-slate-100 hover:bg-slate-100 hover:border-orange-200'}`} style={{ animationDelay: `${idx * 0.05}s` }}>\n                            <div className={`w-16 h-16 rounded-xl overflow-hidden shadow-inner border flex-shrink-0 transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-white/5' : 'bg-white border-slate-200'}`}>\n                                <img src={item.image || 'https://images.unsplash.com/photo-1581404917879-53e19259fdda?w=100'} className=\"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500\" />\n                            </div>\n                            <div className=\"flex-1 flex flex-col justify-center\">\n                                <p className={`font-bold text-sm leading-tight mb-1 transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.name}</p>\n                                <div className=\"flex justify-between items-center\">\n                                    <p className={`text-xs transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>Cant: <span className={`font-mono font-bold transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}</span></p>\n                                    <p className=\"text-orange-400 font-black font-mono text-xs\">${Number(item.price).toLocaleString()}</p>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n                <div className={`pt-6 border-t transition-colors duration-300 ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                    <div className={`flex justify-between items-center p-6 rounded-2xl border transition-colors duration-300 ${darkMode ? 'bg-orange-500/5 border-orange-500/20' : 'bg-orange-50 border-orange-100'}`}>\n                        <p className={`font-bold transition-colors duration-300 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Valor Total</p>\n                        <p className={`text-2xl font-black font-mono transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartItems.reduce((acc, i) => acc + (Number(i.price) * i.quantity), 0).toLocaleString()}</p>\n                    </div>\n                </div>\n            </>\n        );\n    };\n\n    const UserEditForm = ({ user, currentUser, initialData, onSubmit, onDelete, isSaving }) => {\n        const [formData, setFormData] = useState(initialData);\n        const SUPER_ADMIN_EMAIL = 'lautarocorazza63@gmail.com';\n        const isSuperAdminProfile = user.email === SUPER_ADMIN_EMAIL;\n\n        // Update local state when initialData changes\n        useEffect(() => {\n            setFormData(initialData);\n        }, [initialData]);\n\n        const handleSubmit = (e) => {\n            e.preventDefault();\n            onSubmit(formData);\n        };\n\n        return (\n            <form onSubmit={handleSubmit} className=\"space-y-8 animate-fade-in\">\n                {/* Datos de Identidad */}\n                <div className=\"space-y-6\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                        <User className=\"w-3 h-3\" /> Datos Identidad\n                    </p>\n                    <div className=\"grid grid-cols-1 gap-6\">\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Nombre Completo\"\n                                value={formData.name}\n                                onChange={e => setFormData({ ...formData, name: e.target.value })}\n                                required\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Username / Alias\"\n                                value={formData.username}\n                                onChange={e => setFormData({ ...formData, username: e.target.value })}\n                            />\n                        </div>\n                        <div>\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'} ${isSuperAdminProfile ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                placeholder=\"Email de la cuenta (Principal)\"\n                                value={formData.email}\n                                onChange={e => setFormData({ ...formData, email: e.target.value })}\n                                required\n                                disabled={isSuperAdminProfile}\n                                title={isSuperAdminProfile ? \"No se puede modificar el email del Super Admin\" : \"\"}\n                            />\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"DNI\"\n                                value={formData.dni}\n                                onChange={e => setFormData({ ...formData, dni: e.target.value })}\n                            />\n                            <input\n                                className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                placeholder=\"Tel√©fono\"\n                                value={formData.phone}\n                                onChange={e => setFormData({ ...formData, phone: e.target.value })}\n                            />\n                        </div>\n                    </div>\n                </div>\n\n                {/* Seguridad y Rol */}\n                <div className=\"space-y-6 pt-4\">\n                    <p className={`text-[10px] font-black uppercase tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                        <Lock className=\"w-3 h-3\" /> Seguridad & Rol\n                    </p>\n                    <div className=\"space-y-4\">\n                        <div>\n                            <div className=\"relative group\">\n                                <input\n                                    type=\"password\"\n                                    className={`w-full p-4 text-sm font-mono transition-all duration-300 ${darkMode ? 'input-cyber' : 'bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 text-slate-900 placeholder:text-slate-400'}`}\n                                    placeholder=\"Nueva Contrase√±a (Dejar vac√≠o para no cambiar)\"\n                                    value={formData.newPassword}\n                                    onChange={e => setFormData({ ...formData, newPassword: e.target.value })}\n                                />\n                            </div>\n                            <p className={`text-[9px] mt-2 ml-1 italic transition-colors duration-300 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>M√≠nimo 6 caracteres para actualizar.</p>\n                        </div>\n\n                        <div className={`flex p-1.5 rounded-2xl border transition-all duration-300 ${darkMode ? 'bg-slate-900/50 border-white/5' : 'bg-slate-100 border-slate-200'} ${isSuperAdminProfile ? 'opacity-50 pointer-events-none' : ''}`}>\n                            {['user', 'editor', 'admin'].map(r => (\n                                <button\n                                    key={r}\n                                    type=\"button\"\n                                    onClick={() => setFormData({ ...formData, role: r })}\n                                    className={`flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${formData.role === r ? (darkMode ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-600/20' : 'bg-white text-indigo-600 shadow-sm') : (darkMode ? 'text-slate-500 hover:text-slate-300' : 'text-slate-400 hover:text-slate-600')\n                                        }`}\n                                >\n                                    {r}\n                                </button>\n                            ))}\n                        </div>\n                        {isSuperAdminProfile && <p className=\"text-[9px] text-orange-400 mt-1 ml-1\">Rol de Super Admin inmutable.</p>}\n                    </div>\n                </div>\n\n                <div className=\"space-y-4 pt-6\">\n                    <button\n                        type=\"submit\"\n                        disabled={isSaving}\n                        className=\"w-full py-5 bg-gradient-to-r from-indigo-600 to-orange-600 hover:from-indigo-500 hover:to-orange-500 text-white font-black rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50\"\n                    >\n                        {isSaving ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <Save className=\"w-6 h-6\" />}\n                        SINCRONIZAR CAMBIOS\n                    </button>\n\n                    {!isSuperAdminProfile && (\n                        <button\n                            type=\"button\"\n                            onClick={onDelete}\n                            className=\"w-full py-4 border border-red-500/30 bg-red-500/5 text-red-500 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-500/10 transition flex items-center justify-center gap-2\"\n                        >\n                            <Trash2 className=\"w-4 h-4\" /> Eliminar Cuenta Permanente\n                        </button>\n                    )}\n                </div>\n            </form>\n        );\n    };\n\n    // Unified Right Sidebar Drawer (Admin)\n    const AdminUserDrawer = () => {\n        const [userCartItems, setUserCartItems] = useState([]);\n        const [isLoadingCart, setIsLoadingCart] = useState(false);\n        const [isSaving, setIsSaving] = useState(false);\n        const active = viewUserCart || userPassModal || viewUserEdit;\n\n        // Determinamos el tipo basado en qu√© activ√≥ el drawer: 'cart', 'edit', o 'password'\n        const type = viewUserCart ? 'cart' : (userPassModal ? 'password' : 'edit');\n        const user = viewUserCart || userPassModal || viewUserEdit;\n\n        const [initialFormState, setInitialFormState] = useState({\n            name: '',\n            username: '',\n            email: '',\n            phone: '',\n            dni: '',\n            role: 'user',\n            newPassword: ''\n        });\n\n        // Effect to update initial form state and fetch cart\n        useEffect(() => {\n            if (active && user) {\n                if (type === 'cart') {\n                    const fetchCart = async () => {\n                        setIsLoadingCart(true);\n                        try {\n                            const cartDoc = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'carts', user.id));\n                            setUserCartItems(cartDoc.exists() ? (cartDoc.data().items || []) : []);\n                        } catch (e) { setUserCartItems([]); }\n                        setIsLoadingCart(false);\n                    };\n                    fetchCart();\n                }\n\n                setInitialFormState({\n                    name: user.name || '',\n                    username: user.username || '',\n                    email: user.email || '',\n                    phone: user.phone || '',\n                    dni: user.dni || '',\n                    role: user.role || 'user',\n                    newPassword: ''\n                });\n            }\n        }, [active, user, type]);\n\n\n        const closeDrawer = () => {\n            setViewUserCart(null);\n            setUserPassModal(null);\n            setViewUserEdit(null);\n        };\n\n        const handleEditSubmit = async (formData) => {\n            setIsSaving(true);\n            try {\n                if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n                const token = await auth.currentUser.getIdToken();\n                // 1. Actualizaci√≥n Cr√≠tica (Auth) v√≠a API si cambi√≥ email o password\n                const authUpdate = {};\n                if (formData.email !== user.email) authUpdate.email = formData.email;\n                if (formData.newPassword) authUpdate.password = formData.newPassword;\n\n                if (Object.keys(authUpdate).length > 0) {\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'update', uid: user.id, ...authUpdate })\n                    });\n                    const result = await res.json();\n                    if (!res.ok) throw new Error(result.error);\n                }\n\n                // 2. Actualizaci√≥n de Perfil (Firestore)\n                const firestoreUpdate = {\n                    name: formData.name,\n                    username: formData.username,\n                    email: formData.email,\n                    emailLower: formData.email.toLowerCase(),\n                    phone: formData.phone,\n                    dni: formData.dni,\n                    role: formData.role,\n                    lastModifiedBy: currentUser.email,\n                    updatedAt: new Date().toISOString()\n                };\n\n                // Si cambi√≥ la contrase√±a, tambi√©n actualizarla en Firestore\n                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id), firestoreUpdate);\n\n                // Si estamos editando nuestro propio usuario, actualizar el estado global inmediatamente\n                if (currentUser && currentUser.id === user.id) {\n                    setCurrentUser(prev => ({ ...prev, ...firestoreUpdate }));\n                }\n\n                showToast(\"Perfil de usuario actualizado correctamente.\", \"success\");\n                closeDrawer();\n\n            } catch (e) {\n                console.error(e);\n                showToast(e.message || \"Error al actualizar perfil.\", \"error\");\n            }\n            setIsSaving(false);\n        };\n\n        const handleDeleteUser = async () => {\n            if (user.email === currentUser.email) {\n                return showToast(\"Autoprotecci√≥n activa: No puedes eliminar tu propia cuenta.\", \"warning\");\n            }\n\n            openConfirm(\"ELIMINAR USUARIO\", `¬øEst√°s seguro de eliminar a ${user.name}? Esta acci√≥n es irreversible y borrar√° su acceso y datos.`, async () => {\n                setIsSaving(true);\n                try {\n                    if (!auth.currentUser || auth.currentUser.isAnonymous) throw new Error('Sesi√≥n inv√°lida');\n                    const token = await auth.currentUser.getIdToken();\n                    const res = await fetch('/api/admin/users', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json', 'x-store-id': appId || '', 'Authorization': `Bearer ${token}` },\n                        body: JSON.stringify({ action: 'delete', uid: user.id })\n                    });\n                    if (!res.ok) throw new Error(\"Error eliminando acceso de Auth\");\n\n                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', user.id));\n\n                    showToast(\"Usuario eliminado definitivamente.\", \"success\");\n                    closeDrawer();\n                } catch (e) {\n                    console.error(e);\n                    showToast(\"Fallo al eliminar usuario.\", \"error\");\n                }\n                setIsSaving(false);\n            });\n        };\n\n        if (!active) return null;\n\n        return (\n            <div className=\"fixed inset-0 z-[1000] flex justify-end animate-fade-in pointer-events-none\">\n                <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto\" onClick={closeDrawer} />\n\n                <div className={`w-full max-w-xl border-l shadow-[-20px_0_50px_rgba(0,0,0,0.5)] flex flex-col h-full pointer-events-auto relative overflow-hidden animate-slide-left transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-white/10' : 'bg-white border-slate-200'}`}>\n                    <div className=\"absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-600 via-orange-500 to-pink-600\"></div>\n\n                    <div className={`p-8 border-b flex justify-between items-center transition-colors duration-300 ${darkMode ? 'border-white/5 bg-white/[0.02]' : 'border-slate-100 bg-slate-50/50'}`}>\n                        <div>\n                            <h2 className={`text-xl font-black tracking-widest uppercase transition-colors duration-300 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                {type === 'cart' ? 'Auditor√≠a de Carrito' : 'Configurar Cuenta'}\n                            </h2>\n                            <p className={`text-[10px] font-bold mt-1 tracking-widest flex items-center gap-2 transition-colors duration-300 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                <span className=\"w-1.5 h-1.5 rounded-full bg-orange-400 animate-pulse\"></span>\n                                ID: {user.id.slice(-8).toUpperCase()} ‚Ä¢ {user.email}\n                            </p>\n                        </div>\n                        <button onClick={closeDrawer} className={`p-3 rounded-2xl transition-all border group ${darkMode ? 'bg-white/5 hover:bg-white/10 border-white/5' : 'bg-slate-100 hover:bg-slate-200 border-slate-200'}`}>\n                            <X className={`w-5 h-5 transition-colors duration-300 ${darkMode ? 'text-slate-400 group-hover:text-white' : 'text-slate-500 group-hover:text-slate-900'}`} />\n                        </button>\n                    </div>\n\n                    <div className=\"flex-1 overflow-y-auto p-8 custom-scrollbar space-y-8\">\n                        {type === 'cart' && <UserCartView cartItems={userCartItems} isLoading={isLoadingCart} />}\n                        {(type === 'edit' || type === 'password') && (\n                            <UserEditForm\n                                user={user}\n                                currentUser={currentUser}\n                                initialData={initialFormState}\n                                onSubmit={handleEditSubmit}\n                                onDelete={handleDeleteUser}\n                                isSaving={isSaving}\n                            />\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Estado de Carga Inicial\n    if (isLoading && view === 'store') {\n        const loadingPrimaryColor = settings?.primaryColor || '#f97316';\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white px-4\">\n                <div className=\"relative\">\n                    <div className=\"w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: loadingPrimaryColor }}></div>\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 animate-pulse\" style={{ color: loadingPrimaryColor }} />\n                    </div>\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-3xl font-black tracking-[0.1em] sm:tracking-[0.2em] md:tracking-[0.3em] mt-6 sm:mt-8 animate-pulse text-center max-w-[90vw]\" style={{ color: loadingPrimaryColor, textShadow: `0 0 20px ${loadingPrimaryColor}40` }}>\n                    {settings?.loadingTitle || settings?.storeName || ''}\n                </h1>\n                <p className=\"text-slate-500 text-xs sm:text-sm mt-3 sm:mt-4 font-mono uppercase tracking-wider sm:tracking-widest text-center\">\n                    {settings?.loadingText || 'Cargando sistema...'}\n                </p>\n            </div>\n        );\n    }\n\n    // Modo Mantenimiento\n    if (settings?.maintenanceMode && !isAdmin(currentUser?.email)) {\n        return (\n            <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] text-white p-4 sm:p-6 text-center\">\n                <div className=\"w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mb-6 sm:mb-8 border border-red-900/50 animate-pulse\">\n                    <AlertTriangle className=\"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12\" />\n                </div>\n                <h1 className=\"text-xl sm:text-2xl md:text-4xl font-black mb-3 sm:mb-4 tracking-tight uppercase\">Sistema en Mantenimiento</h1>\n                <p className=\"text-slate-400 max-w-sm sm:max-w-md mx-auto leading-relaxed text-sm sm:text-base\">\n                    Estamos realizando mejoras para brindarte una experiencia premium.\n                    ¬°Te mandamos un saludo y esperamos que vuelvas prontamente!\n                </p>\n                <div className=\"mt-8 sm:mt-12 pt-8 sm:pt-12 border-t border-slate-900 w-full max-w-xs\">\n                    <p className=\"text-[10px] sm:text-xs text-slate-600 font-mono italic\">{settings?.storeName || ''} - Modo Mantenimiento Activo</p>\n                </div>\n            </div>\n        );\n    }\n\n    // --- L√ìGICA DE FILTRADO Y ORDENAMIENTO INTELIGENTE ---\n    const filteredProducts = products\n        .filter(p => {\n            // Excluir productos desactivados de la tienda p√∫blica\n            if (p.isActive === false) return false;\n\n            const matchesSearch = (p.name || '').toLowerCase().includes(searchQuery.toLowerCase());\n\n            // L√≥gica de Categor√≠as Especiales\n            if (selectedCategory === 'Promos') return false; // El grid est√°ndar se oculta para Promos\n            if (selectedCategory === 'Ofertas') {\n                return matchesSearch && (p.discount > 0);\n            }\n\n            // NUEVO: Soporte para m√∫ltiples categor√≠as\n            // Verificar si el producto tiene el array categories o el campo legacy category\n            const matchesCategory = (() => {\n                // Sin filtro seleccionado - mostrar todos\n                if (selectedCategory === '') return true;\n\n                // Producto con m√∫ltiples categor√≠as (nuevo sistema)\n                if (Array.isArray(p.categories)) {\n                    return p.categories.includes(selectedCategory);\n                }\n\n                // Producto con categor√≠a antigua (retrocompatibilidad)\n                if (p.category) {\n                    return p.category.trim() === selectedCategory;\n                }\n\n                // Sin categor√≠a asignada\n                return false;\n            })();\n\n            return matchesSearch && matchesCategory;\n        })\n        .sort((a, b) => {\n            // Prioridad 1: Productos Destacados primero\n            if (a.isFeatured && !b.isFeatured) return -1;\n            if (!a.isFeatured && b.isFeatured) return 1;\n            // Prioridad 2: M√°s vendidos\n            const salesA = dashboardMetrics?.salesCount?.[a.id] || 0;\n            const salesB = dashboardMetrics?.salesCount?.[b.id] || 0;\n            return salesB - salesA;\n        });\n\n    // --- RENDERIZADO PRINCIPAL (RETURN) ---\n    return (\n\n        <div className={`min-h-screen flex flex-col relative w-full bg-grid font-sans selection:bg-orange-500/30 selection:text-orange-200 transition-colors duration-300 ${darkMode ? 'bg-[#050505]' : 'bg-slate-50'}`}>\n            {/* DEBUGGER VISUAL (SOLO DESARROLLO) */}\n            {view === 'store' && currentUser?.role === 'admin' && (\n                <div className=\"fixed bottom-4 left-4 z-[9999] bg-black/80 text-green-400 font-mono text-xs p-2 rounded border border-green-900 pointer-events-none\">\n                    [DEBUG] Total: {products.length} | Filtro: {filteredProducts.length} | Cat: {selectedCategory || 'ALL'}\n                </div>\n            )}\n\n            {/* Efectos de Fondo Globales */}\n            <div className=\"fixed inset-0 pointer-events-none z-0\">\n                <div className=\"absolute top-[-10%] left-[-10%] w-[60%] h-[60%] bg-purple-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n                <div className=\"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-orange-900/5 rounded-full blur-[150px] animate-pulse-slow\"></div>\n            </div>\n\n\n            {/* Contenedores Globales (Toasts y Modales) */}\n            <div className=\"fixed top-24 right-4 z-[20001] space-y-3 pointer-events-none\">\n                {/* Toasts necesitan pointer-events-auto para poder cerrarlos */}\n                <div className=\"pointer-events-auto space-y-3\">\n                    {toasts.map(t => (\n                        <Toast key={t.id} message={t.message} type={t.type} onClose={() => removeToast(t.id)} />\n                    ))}\n                </div>\n            </div>\n\n            {storeResolution.status !== 'resolved' && (\n                <div className=\"fixed inset-0 z-[10000] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4\">\n                    <div className=\"w-full max-w-xl rounded-3xl border border-white/10 bg-[#050505] p-8 shadow-2xl\">\n                        {storeResolution.status === 'resolving' ? (\n                            <div className=\"flex items-center gap-4\">\n                                <Loader2 className=\"w-7 h-7 animate-spin text-orange-500\" />\n                                <div>\n                                    <p className=\"text-white font-black text-xl tracking-tight\">Detectando tienda‚Ä¶</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">{storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-6\">\n                                <div className=\"space-y-2\">\n                                    <p className=\"text-white font-black text-2xl tracking-tight\">Tienda no configurada</p>\n                                    <p className=\"text-slate-500 text-sm font-mono\">Dominio: {storeResolution.normalizedHostname || storeResolution.hostname}</p>\n                                </div>\n\n                                {!systemUser || systemUser.isAnonymous ? (\n                                    <div className=\"space-y-4\">\n                                        <p className=\"text-slate-400 text-sm\">Inici√° sesi√≥n para configurar este dominio.</p>\n                                        <button\n                                            onClick={() => setView('login')}\n                                            className=\"w-full py-4 rounded-2xl bg-gradient-to-r from-orange-600 to-purple-600 text-white font-black uppercase tracking-widest text-xs hover:from-orange-500 hover:to-purple-500 transition\"\n                                        >\n                                            Iniciar sesi√≥n\n                                        </button>\n                                    </div>\n                                ) : !isSuperAdminSession ? (\n                                    <div className=\"space-y-3\">\n                                        <p className=\"text-slate-400 text-sm\">Este dominio solo puede registrarlo el Super Admin.</p>\n                                        <p className=\"text-slate-600 text-xs font-mono\">Sesi√≥n: {systemUser?.email || systemUser?.uid}</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-5\">\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-300 text-sm\">Eleg√≠ c√≥mo quer√©s vincular este dominio:</p>\n                                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            const newStoreId = createStoreId();\n                                                            await registerHostname(newStoreId);\n                                                            showToast(`Dominio vinculado a ${newStoreId}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo crear la tienda', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-[10px] uppercase tracking-widest hover:bg-white/10 transition disabled:opacity-50\"\n                                                >\n                                                    Crear tienda nueva\n                                                </button>\n                                                <button\n                                                    disabled={isStoreSetupSaving}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(DEFAULT_APP_ID);\n                                                            showToast(`Dominio vinculado a ${DEFAULT_APP_ID}`, 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"py-4 rounded-2xl bg-orange-500/10 border border-orange-500/20 text-orange-400 font-black text-[10px] uppercase tracking-widest hover:bg-orange-500/20 transition disabled:opacity-50\"\n                                                >\n                                                    Usar tienda default\n                                                </button>\n                                            </div>\n                                        </div>\n\n                                        <div className=\"space-y-3\">\n                                            <p className=\"text-slate-500 text-xs font-mono\">O peg√° un storeId existente:</p>\n                                            <div className=\"flex gap-2\">\n                                                <input\n                                                    value={storeSetupStoreIdInput}\n                                                    onChange={(e) => setStoreSetupStoreIdInput(e.target.value)}\n                                                    className=\"input-cyber flex-1 p-4 text-sm font-mono\"\n                                                    placeholder=\"storeId (ej: cliente-abc123)\"\n                                                />\n                                                <button\n                                                    disabled={isStoreSetupSaving || !storeSetupStoreIdInput.trim()}\n                                                    onClick={async () => {\n                                                        setIsStoreSetupSaving(true);\n                                                        try {\n                                                            await registerHostname(storeSetupStoreIdInput.trim());\n                                                            showToast('Dominio vinculado', 'success');\n                                                        } catch (e) {\n                                                            showToast(e?.message || 'No se pudo vincular', 'error');\n                                                        }\n                                                        setIsStoreSetupSaving(false);\n                                                    }}\n                                                    className=\"px-5 rounded-2xl bg-indigo-600 text-white font-black text-[10px] uppercase tracking-widest hover:bg-indigo-500 transition disabled:opacity-50\"\n                                                >\n                                                    Vincular\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n\n\n\n            <OrderDetailsModal order={selectedOrder} onClose={() => setSelectedOrder(null)} />\n            <CouponSelectorModal />\n            <ProductDetailModal />\n\n            {/* --- BARRA DE NAVEGACI√ìN (NAVBAR) --- */}\n            {view !== 'admin' && (\n                <nav className={`fixed top-0 w-full h-16 sm:h-20 z-50 px-3 sm:px-6 md:px-12 flex items-center justify-between backdrop-blur-xl transition-all duration-300 ${darkMode ? 'glass border-b border-slate-800/50' : 'bg-white/95 border-b border-slate-200 shadow-sm'}`}>\n                    {/* Logo y Men√∫ */}\n                    <div className=\"flex items-center gap-2 sm:gap-6\">\n                        <button onClick={() => setIsMenuOpen(true)} className={`p-2 sm:p-3 rounded-lg sm:rounded-xl transition border group ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                            <Menu className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                        </button>\n                        <div className=\"cursor-pointer group flex items-center gap-2 sm:gap-3\" onClick={() => setView('store')}>\n                            {settings?.logoUrl && (\n                                <div className={`w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full overflow-hidden border-2 bg-white p-0.5 flex-shrink-0 shadow-lg group-hover:border-orange-500 transition-colors duration-300 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                    <img src={settings.logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover rounded-full\" />\n                                </div>\n                            )}\n                            <div className=\"flex flex-col\">\n                                <span className={`text-xl sm:text-2xl md:text-4xl font-black tracking-tighter italic group-hover:text-orange-500 transition-all duration-300 leading-none ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    {!settingsLoaded ? (\n                                        <span className={`inline-block h-6 sm:h-8 w-20 sm:w-32 rounded animate-pulse ${darkMode ? 'bg-slate-700/50' : 'bg-slate-200'}`}></span>\n                                    ) : (settings?.storeName || '')}\n                                </span>\n                                <div className=\"h-0.5 sm:h-1 w-1/2 bg-orange-500 rounded-full group-hover:w-full transition-all duration-500 mt-0.5 sm:mt-1 shadow-sm\"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Barra de B√∫squeda (Visible en Desktop) */}\n                    <div className={`hidden lg:flex items-center rounded-2xl px-6 py-3 w-1/3 transition shadow-inner group ${darkMode ? 'bg-slate-900/50 border border-slate-700/50 focus-within:border-orange-500/50 focus-within:bg-slate-900' : 'bg-slate-100 border border-slate-200 focus-within:border-orange-400 focus-within:bg-white focus-within:shadow-md'}`}>\n                        <Search className={`w-5 h-5 mr-3 group-focus-within:text-orange-500 transition ${darkMode ? 'text-slate-400' : 'text-slate-500'}`} />\n                        <input\n                            className={`bg-transparent outline-none text-sm w-full font-medium ${darkMode ? 'text-white placeholder-slate-500' : 'text-slate-900 placeholder-slate-400'}`}\n                            placeholder=\"¬øQu√© est√°s buscando hoy?\"\n                            value={searchQuery}\n                            onChange={e => setSearchQuery(e.target.value)}\n                        />\n                    </div>\n\n                    {/* Acciones de Usuario */}\n                    <div className=\"flex items-center gap-4\">\n                        {/* Botones de Contacto */}\n                        <div className=\"hidden md:flex items-center gap-2\">\n                            {settings?.showWhatsapp !== false && settings?.whatsappLink && (\n                                <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-green-900/10 text-green-400 hover:bg-green-500 hover:text-white border border-green-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(34,197,94,0.3)]\">\n                                    <MessageCircle className=\"w-5 h-5\" /> WhatsApp\n                                </button>\n                            )}\n                            {settings?.showInstagram !== false && settings?.instagramLink && (\n                                <button onClick={() => window.open(settings?.instagramLink, '_blank')} className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-pink-900/10 text-pink-400 hover:bg-pink-500 hover:text-white border border-pink-500/20 transition font-bold text-sm hover:shadow-[0_0_15px_rgba(236,72,153,0.3)]\">\n                                    <Instagram className=\"w-5 h-5\" /> Instagram\n                                </button>\n                            )}\n                        </div>\n\n                        {/* Bot√≥n Modo Claro/Oscuro */}\n                        <button\n                            onClick={() => setDarkMode(!darkMode)}\n                            className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group overflow-hidden border ${darkMode ? 'bg-slate-900/50 text-yellow-400 hover:bg-slate-800 border-slate-700/50' : 'bg-yellow-50 text-yellow-600 hover:bg-yellow-100 border-yellow-200'}`}\n                            title={darkMode ? 'Activar modo claro' : 'Activar modo oscuro'}\n                        >\n                            <div className={`transform transition-all duration-500 ${darkMode ? 'rotate-0 scale-100' : 'rotate-180 scale-0 absolute'}`}>\n                                <Moon className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                            <div className={`transform transition-all duration-500 ${!darkMode ? 'rotate-0 scale-100' : '-rotate-180 scale-0 absolute'}`}>\n                                <Sun className=\"w-4 h-4 sm:w-5 sm:h-5 group-hover:scale-110 transition\" />\n                            </div>\n                        </button>\n\n                        {/* Bot√≥n Carrito */}\n                        <button onClick={() => setView('cart')} className={`relative p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition group border ${darkMode ? 'bg-slate-900/50 text-slate-300 hover:text-white hover:bg-slate-800 border-slate-700/50 hover:border-orange-500/30' : 'bg-slate-100 text-slate-600 hover:text-slate-900 hover:bg-slate-200 border-slate-200 hover:border-orange-400'}`}>\n                            <ShoppingBag className=\"w-5 h-5 sm:w-6 sm:h-6 group-hover:scale-110 transition\" />\n                            {cart.length > 0 && (\n                                <span className={`absolute -top-1.5 -right-1.5 sm:-top-2 sm:-right-2 bg-orange-500 text-white text-[9px] sm:text-[10px] font-black w-5 h-5 sm:w-6 sm:h-6 rounded-full flex items-center justify-center shadow-lg border-2 animate-bounce-short ${darkMode ? 'border-[#050505]' : 'border-white'}`}>\n                                    {cart.length}\n                                </span>\n                            )}\n                        </button>\n\n                        {/* Perfil / Login - Solo mostrar perfil si el usuario tiene datos v√°lidos */}\n                        {currentUser && currentUser.id && currentUser.email && currentUser.name ? (\n                            <button onClick={() => setView('profile')} className={`flex items-center gap-2 sm:gap-3 pl-2 pr-3 sm:pr-4 py-1.5 sm:py-2 rounded-lg sm:rounded-xl border transition group ${darkMode ? 'bg-slate-900/50 border-slate-700/50 hover:border-orange-500/50' : 'bg-slate-100 border-slate-200 hover:border-orange-400'}`}>\n                                <div className=\"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center text-white font-bold shadow-lg text-xs sm:text-sm group-hover:scale-105 transition\">\n                                    {currentUser.name.charAt(0)}\n                                </div>\n                                <div className=\"text-left hidden md:block\">\n                                    <p className={`text-[9px] sm:text-[10px] uppercase font-bold tracking-wider ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Hola,</p>\n                                    <p className={`text-xs sm:text-sm font-bold leading-none group-hover:text-orange-500 transition ${darkMode ? 'text-white' : 'text-slate-900'}`}>{currentUser.name.split(' ')[0]}</p>\n                                </div>\n                            </button>\n                        ) : (\n                            <button onClick={() => setView('login')} className={`px-3 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-black transition shadow-lg flex items-center gap-1 sm:gap-2 transform hover:-translate-y-0.5 ${darkMode ? 'bg-white text-black hover:bg-orange-500 hover:text-white' : 'bg-orange-500 text-white hover:bg-orange-600'}`}>\n                                <User className=\"w-4 h-4 sm:w-5 sm:h-5\" /> <span className=\"hidden sm:inline\">INGRESAR</span><span className=\"sm:hidden\">Entrar</span>\n                            </button>\n                        )}\n                    </div>\n                </nav>\n            )}\n\n            {/* --- MEN√ö M√ìVIL (DETALLADO Y EXPL√çCITO) --- */}\n            {isMenuOpen && (\n                <div className=\"fixed inset-0 z-[10000] flex justify-start\">\n                    {/* Backdrop */}\n                    <div className={`fixed inset-0 backdrop-blur-sm transition-opacity ${darkMode ? 'bg-black/90' : 'bg-black/50'}`} onClick={() => setIsMenuOpen(false)}></div>\n\n                    {/* Panel Lateral */}\n                    <div className={`relative w-72 sm:w-80 h-full p-6 sm:p-8 animate-fade-in-right flex flex-col shadow-2xl z-[10001] ${darkMode ? 'bg-[#0a0a0a] border-r border-slate-800' : 'bg-white border-r border-slate-200'}`}>\n                        <div className={`flex justify-between items-center mb-8 sm:mb-10 border-b pb-4 sm:pb-6 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <h2 className={`text-2xl sm:text-3xl font-black tracking-tight drop-shadow-md ${darkMode ? 'text-white' : 'text-slate-900'}`}>MEN√ö</h2>\n                            <button onClick={() => setIsMenuOpen(false)} className={`p-2 sm:p-3 rounded-full transition border ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200 border-slate-200'}`}>\n                                <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                            </button>\n                        </div>\n\n                        {/* Lista de Botones */}\n                        <div className=\"space-y-2 sm:space-y-3 flex-1 overflow-y-auto custom-scrollbar pr-2\">\n                            <button onClick={() => { setView('store'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Home className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Inicio\n                            </button>\n\n                            <button onClick={() => { setView('profile'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <User className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Mi Perfil\n                            </button>\n\n                            <button onClick={() => { setView('cart'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <div className=\"relative\">\n                                    <ShoppingBag className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                    {cart.length > 0 && <span className=\"absolute -top-2 -right-2 bg-orange-500 text-[10px] text-white rounded-full w-4 h-4 flex items-center justify-center font-bold\">{cart.length}</span>}\n                                </div>\n                                Mi Carrito\n                            </button>\n\n                            <div className={`h-px my-3 sm:my-4 mx-4 ${darkMode ? 'bg-slate-800' : 'bg-slate-200'}`}></div>\n\n                            <button onClick={() => { setView('about'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                <Info className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> Sobre Nosotros\n                            </button>\n\n                            {settings?.showGuideLink !== false && (\n                                <button onClick={() => { setView('guide'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold transition flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl group border border-transparent ${darkMode ? 'text-slate-300 hover:text-orange-400 hover:bg-slate-900/50 hover:border-slate-800' : 'text-slate-700 hover:text-orange-500 hover:bg-slate-100 hover:border-slate-200'}`}>\n                                    <FileQuestion className={`w-5 h-5 sm:w-6 sm:h-6 group-hover:text-orange-500 transition ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} /> {settings?.guideTitle || 'C√≥mo Comprar'}\n                                </button>\n                            )}\n\n                            {/* Panel Admin (Solo si tiene permisos) */}\n                            {hasAccess(currentUser?.email) && (\n                                <button onClick={() => { setView('admin'); setIsMenuOpen(false) }} className={`w-full text-left text-base sm:text-lg font-bold text-orange-500 mt-4 sm:mt-6 pt-4 sm:pt-6 flex items-center gap-3 sm:gap-4 p-3 sm:p-4 rounded-xl transition border ${darkMode ? 'border-t border-slate-800 bg-orange-900/10 hover:bg-orange-900/20 border-orange-500/20' : 'border-t border-slate-200 bg-orange-50 hover:bg-orange-100 border-orange-200'}`}>\n                                    <Shield className=\"w-5 h-5 sm:w-6 sm:h-6\" /> Admin Panel\n                                </button>\n                            )}\n                        </div>\n\n                        <div className={`mt-6 sm:mt-8 pt-6 sm:pt-8 border-t text-center ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                            <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-widest ${darkMode ? 'text-slate-600' : 'text-slate-400'}`}>{settings?.menuCopyright || settings.storeName}</p>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Espaciador para el Navbar Fixed */}\n            {view !== 'admin' && <div className=\"h-16 sm:h-20 md:h-24\"></div>}\n\n            {/* --- CONTENIDO PRINCIPAL (VIEW SWITCHER) --- */}\n            <main className={`flex-grow relative z-10 ${view === 'admin' ? 'min-h-screen min-full-viewport flex overflow-hidden' : 'p-4 md:p-8'}`}>\n\n                {/* 1. VISTA TIENDA (HOME) */}\n                {view === 'store' && (\n                    <div className=\"max-w-[1400px] mx-auto pb-32 min-h-screen block\">\n\n                        {/* Anuncio Global (Marquesina) - Solo mostrar cuando settings est√°n cargados */}\n                        {settingsLoaded && settings?.showAnnouncementBanner !== false && settings?.announcementMessage && (\n                            <div className=\"w-full bg-gradient-to-r from-orange-900/20 to-red-900/20 border border-orange-500/20 rounded-xl p-3 mb-8 text-center animate-pulse relative overflow-hidden group\">\n                                <div className=\"absolute inset-0 bg-white/5 skew-x-12 -translate-x-full group-hover:translate-x-full transition duration-1000\"></div>\n                                <p className=\"text-orange-400 font-black text-xs md:text-sm tracking-[0.2em] uppercase flex items-center justify-center gap-3\">\n                                    <Flame className=\"w-4 h-4 text-orange-500\" /> {settings.announcementMessage} <Flame className=\"w-4 h-4 text-orange-500\" />\n                                </p>\n                            </div>\n                        )}\n\n                        {/* Brand Ticker (Futuristic) - Solo mostrar cuando settings est√°n cargados */}\n                        {settingsLoaded && settings?.showBrandTicker !== false && (\n                            <div className={`mb-8 w-full overflow-hidden border-y backdrop-blur-sm py-2 ${darkMode ? 'border-slate-800/50 bg-[#0a0a0a]/50' : 'border-slate-200 bg-slate-100/50'}`}>\n                                <div className=\"ticker-wrap\">\n                                    <div className={`ticker-content font-mono text-xs md:text-sm tracking-[0.2em] md:tracking-[0.5em] uppercase flex items-center gap-6 md:gap-12 ${darkMode ? 'text-orange-500/50' : 'text-orange-600/70'}`}>\n                                        {[1, 2, 3, 4].map((i) => (\n                                            <React.Fragment key={i}>\n                                                <span className=\"whitespace-nowrap\">{settings?.tickerText || `${settings?.storeName || ''} Tech ‚Ä¢ Futuro ‚Ä¢ Calidad Premium ‚Ä¢ Innovaci√≥n`}</span>\n                                                <span>‚Ä¢</span>\n                                            </React.Fragment>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Banner Hero */}\n                        <div className={`relative w-full h-[30vh] md:h-[350px] 2xl:h-[450px] rounded-[2rem] overflow-hidden shadow-2xl mb-8 border group relative container-tv ${darkMode ? 'border-slate-800 bg-[#080808]' : 'border-slate-200 bg-white'}`}>\n                            <div className={`absolute inset-0 bg-[url('/noise.svg')] z-0 ${darkMode ? 'opacity-20' : 'opacity-10'}`}></div>\n                            <HomeBannerCarouselBackground\n                                settingsLoaded={settingsLoaded}\n                                banners={settings?.showHomeBannerCarousel === false ? [] : homeBanners}\n                                fallbackUrl={settings?.heroUrl}\n                                autoplayMs={settings?.homeBannerAutoplayMs || 5000}\n                                darkMode={darkMode}\n                                onBannerClick={handleHomeBannerClick}\n                            />\n\n                            {/* Overlay de Texto */}\n                            <div className={`absolute inset-0 flex flex-col justify-center px-8 md:px-20 z-10 p-12 pointer-events-none ${darkMode ? 'bg-gradient-to-t md:bg-gradient-to-r from-[#050505] via-[#050505]/80 to-transparent' : 'bg-gradient-to-t md:bg-gradient-to-r from-white/25 via-white/10 to-transparent'}`}>\n                                <div className=\"max-w-2xl animate-fade-up\">\n                                    {/* Skeleton/Loading mientras no se cargan los settings */}\n                                    {!settingsLoaded ? (\n                                        <>\n                                            <div className=\"h-6 w-32 bg-slate-700/50 rounded-md mb-4 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-64 md:w-80 bg-slate-700/50 rounded-lg mb-2 animate-pulse\"></div>\n                                            <div className=\"h-12 md:h-16 w-48 md:w-64 bg-slate-700/50 rounded-lg mb-4 animate-pulse\"></div>\n                                            <div className=\"h-4 w-72 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                            <div className=\"h-4 w-56 bg-slate-700/50 rounded mb-6 animate-pulse\"></div>\n                                            <div className=\"flex items-center gap-4\">\n                                                <div className=\"h-12 w-40 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                                <div className=\"h-10 w-24 bg-slate-700/50 rounded-xl animate-pulse\"></div>\n                                            </div>\n                                        </>\n                                    ) : (\n                                        <>\n                                            <span className=\"bg-orange-500 text-black px-3 py-1 rounded-md text-[10px] font-black uppercase tracking-widest shadow-[0_0_15px_rgba(255,255,255,0.1)] mb-4 inline-block\">\n                                                {settings?.heroBadge || ''}\n                                            </span>\n                                            <h1 className={`text-3xl md:text-5xl lg:text-6xl text-tv-huge font-black leading-[0.9] mb-4 ${darkMode ? 'text-white drop-shadow-2xl' : 'text-slate-900'}`}>\n                                                {settings?.heroTitle1 || ''} <br />\n                                                <span className={`text-transparent bg-clip-text bg-gradient-to-r ${darkMode ? 'from-orange-400 to-blue-600' : 'from-orange-600 to-blue-700'}`}>\n                                                    {settings?.heroTitle2 || ''}\n                                                </span>\n                                            </h1>\n                                            <p className={`text-sm md:text-base lg:text-lg mb-6 max-w-md font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                                {settings?.heroSubtitle || ''}\n                                            </p>\n                                            <div className=\"flex items-center gap-4\">\n                                                <button onClick={() => document.getElementById('catalog').scrollIntoView({ behavior: 'smooth' })} className=\"px-8 py-4 bg-white text-black font-black rounded-xl hover:bg-orange-400 transition shadow-[0_0_30px_rgba(255,255,255,0.1)] flex items-center justify-center gap-2 group/btn pointer-events-auto\">\n                                                    VER CAT√ÅLOGO <ArrowRight className=\"w-5 h-5 group-hover/btn:translate-x-1 transition\" />\n                                                </button>\n                                                <button onClick={() => setView('guide')} className={`px-6 py-2.5 rounded-xl flex items-center gap-2 transition font-bold text-xs group pointer-events-auto ${darkMode ? 'bg-white/5 backdrop-blur-md border border-white/10 hover:bg-white/10 text-white' : 'bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-900'}`}>\n                                                    <Info className={`w-4 h-4 ${darkMode ? 'text-orange-400' : 'text-orange-600'}`} /> Ayuda\n                                                </button>\n                                            </div>\n                                        </>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Why Choose Us Section */}\n                        {/* Why Choose Us Section (Editable) - Respeta toggles de configuraci√≥n */}\n                        {settingsLoaded && settings?.showFeaturesSection !== false && (\n                            <div className={`grid grid-cols-1 ${[settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 1 ? 'md:grid-cols-1 max-w-md mx-auto' :\n                                [settings?.showFeature1 !== false, settings?.showFeature2 !== false, settings?.showFeature3 !== false].filter(Boolean).length === 2 ? 'md:grid-cols-2 max-w-2xl mx-auto' :\n                                    'md:grid-cols-3'\n                                } gap-4 md:gap-8 mb-12 container-tv`}>\n                                {!settingsLoaded ? (\n                                    <>\n                                        {/* Skeleton para las tarjetas */}\n                                        {[1, 2, 3].map((i) => (\n                                            <div key={i} className=\"p-4 rounded-[1.5rem] bg-slate-900/30 border border-slate-800 backdrop-blur-sm flex flex-col items-center text-center\">\n                                                <div className=\"w-10 h-10 rounded-full bg-slate-700/50 mb-3 animate-pulse\"></div>\n                                                <div className=\"h-5 w-32 bg-slate-700/50 rounded mb-2 animate-pulse\"></div>\n                                                <div className=\"h-3 w-48 bg-slate-700/50 rounded mb-1 animate-pulse\"></div>\n                                                <div className=\"h-3 w-40 bg-slate-700/50 rounded animate-pulse\"></div>\n                                            </div>\n                                        ))}\n                                    </>\n                                ) : (\n                                    <>\n                                        {/* Beneficio 1 */}\n                                        {settings?.showFeature1 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-orange-900/20' : 'bg-orange-100'}`}>\n                                                    <Zap className={`w-5 h-5 ${darkMode ? 'text-orange-400' : 'text-orange-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature1Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature1Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 2 */}\n                                        {settings?.showFeature2 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-purple-900/20' : 'bg-purple-100'}`}>\n                                                    <Shield className={`w-5 h-5 ${darkMode ? 'text-purple-400' : 'text-purple-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature2Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature2Desc || ''}</p>\n                                            </div>\n                                        )}\n                                        {/* Beneficio 3 */}\n                                        {settings?.showFeature3 !== false && (\n                                            <div className={`p-4 rounded-[1.5rem] border backdrop-blur-sm flex flex-col items-center text-center tech-glow transition duration-500 group ${darkMode ? 'bg-slate-900/30 border-slate-800 hover:bg-slate-900/50' : 'bg-white border-slate-200 hover:bg-slate-50 shadow-sm hover:shadow-md'}`}>\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition ${darkMode ? 'bg-green-900/20' : 'bg-green-100'}`}>\n                                                    <Headphones className={`w-5 h-5 ${darkMode ? 'text-green-400' : 'text-green-600'}`} />\n                                                </div>\n                                                <h3 className={`text-base font-bold mb-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{settings?.feature3Title || ''}</h3>\n                                                <p className={`text-[11px] ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{settings?.feature3Desc || ''}</p>\n                                            </div>\n                                        )}\n                                    </>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Filtros de Categor√≠a */}\n                        <div id=\"catalog\" className={`sticky top-16 sm:top-20 z-40 backdrop-blur-xl py-3 sm:py-4 mb-6 sm:mb-8 -mx-4 px-4 border-y transition-colors duration-300 ${darkMode ? 'bg-[#050505]/80 border-slate-800/50' : 'bg-white/90 border-slate-200'}`}>\n                            <div\n                                ref={categoriesScrollRef}\n                                onMouseDown={handleMouseDownCategories}\n                                onMouseLeave={handleMouseLeaveCategories}\n                                onMouseUp={handleMouseUpCategories}\n                                onMouseMove={handleMouseMoveCategories}\n                                className={`flex items-center gap-2 overflow-x-auto pb-1 ${isDraggingCategories ? 'cursor-grabbing scroll-auto' : 'cursor-grab scroll-smooth'}`}\n                                style={{ scrollbarWidth: 'none', msOverflowStyle: 'none', WebkitOverflowScrolling: 'touch' }}\n                            >\n                                <Filter className={`w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n\n                                {/* BOT√ìN PROMOS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Promos')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-black text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 group relative overflow-hidden flex-shrink-0 ${selectedCategory === 'Promos' ? 'text-white border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.5)]' : darkMode ? 'bg-slate-900 border-slate-800 text-purple-400 hover:text-white hover:border-purple-500/50' : 'bg-purple-50 border-purple-200 text-purple-600 hover:bg-purple-100 hover:border-purple-300'}`}\n                                >\n                                    {selectedCategory === 'Promos' && <div className=\"absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 animate-gradient-xy\"></div>}\n                                    <span className=\"relative z-10 flex items-center gap-1.5 sm:gap-2\"><Sparkles className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> PROMOS</span>\n                                </button>\n\n                                {/* BOT√ìN OFERTAS (SPECIAL) */}\n                                <button\n                                    onClick={() => setSelectedCategory('Ofertas')}\n                                    className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex items-center gap-1.5 sm:gap-2 flex-shrink-0 ${selectedCategory === 'Ofertas' ? 'bg-red-600/20 text-red-500 border-red-500 shadow-[0_0_15px_rgba(220,38,38,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-red-400 hover:text-white hover:border-red-500/50' : 'bg-red-50 border-red-200 text-red-600 hover:bg-red-100 hover:border-red-300'}`}\n                                >\n                                    <Percent className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" /> OFERTAS\n                                </button>\n\n                                <button onClick={() => setSelectedCategory('')} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === '' ? darkMode ? 'bg-white text-black border-white shadow-[0_0_15px_rgba(255,255,255,0.2)]' : 'bg-slate-900 text-white border-slate-900 shadow-md' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300'}`}>\n                                    Todos\n                                </button>\n                                {settings?.categories?.map(c => (\n                                    <button key={c} onClick={() => setSelectedCategory(c)} className={`px-3 sm:px-5 py-1.5 sm:py-2 rounded-lg sm:rounded-xl font-bold text-[10px] sm:text-xs transition border whitespace-nowrap flex-shrink-0 ${selectedCategory === c ? 'bg-orange-500 text-white border-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.3)]' : darkMode ? 'bg-slate-900 border-slate-800 text-slate-400 hover:text-white hover:border-slate-600' : 'bg-white border-slate-200 text-slate-600 hover:bg-orange-50 hover:border-orange-300 hover:text-orange-600'}`}>\n                                        {c}\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n\n\n                        {/* SECCI√ìN PROMOS (NUEVO) */}\n                        {/* SECCI√ìN PROMOS (TAB VIEW) */}\n                        {selectedCategory === 'Promos' && (\n                            <div className=\"mb-16 animate-fade-in\">\n                                {promos.length > 0 ? (\n                                    <>\n                                        <h2 className={`text-3xl font-black mb-8 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                            <Tag className=\"w-8 h-8 text-purple-500 animate-pulse\" /> PROMOCIONES ESPECIALES\n                                        </h2>\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n                                            {promos.map(promo => {\n                                                // Calcular si hay stock para esta promo\n                                                // La disponibilidad depende del \"item\" con menor stock relativo\n                                                let maxPurchasable = Infinity;\n                                                promo.items.forEach(item => {\n                                                    const p = products.find(prod => prod.id === item.productId);\n                                                    const pStock = p ? (Number(p.stock) || 0) : 0;\n                                                    const maxForThisItem = Math.floor(pStock / item.quantity);\n                                                    if (maxForThisItem < maxPurchasable) maxPurchasable = maxForThisItem;\n                                                });\n\n                                                const hasStock = maxPurchasable > 0;\n\n                                                return (\n                                                    <div key={promo.id} className={`rounded-[2.5rem] border overflow-hidden group transition duration-500 relative flex flex-col ${darkMode ? 'bg-gradient-to-br from-purple-900/10 to-blue-900/10 border-purple-500/30 shadow-[0_0_30px_rgba(168,85,247,0.1)] hover:shadow-[0_0_50px_rgba(168,85,247,0.2)]' : 'bg-white border-purple-200 shadow-sm hover:shadow-xl'}`}>\n                                                        <div\n                                                            className={`aspect-square flex items-center justify-center relative overflow-hidden cursor-zoom-in ${darkMode ? 'bg-slate-900/50' : 'bg-slate-50'}`}\n                                                            onClick={() => setSelectedProduct({ ...promo, isPromo: true, stock: maxPurchasable })}\n                                                        >\n                                                            <img src={promo.image} className=\"w-full h-full object-contain transition duration-700 group-hover:scale-110\" />\n                                                            <div className={`absolute inset-0 bg-gradient-to-t via-transparent to-transparent ${darkMode ? 'from-[#0a0a0a]' : 'from-white/50'}`}></div>\n                                                            <div className=\"absolute top-4 right-4 bg-purple-600 text-white text-xs font-black px-3 py-1 rounded-full uppercase tracking-wider shadow-lg\">\n                                                                Oferta Limitada\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"p-8 flex-1 flex flex-col\">\n                                                            <h3 className={`text-2xl font-black mb-2 leading-tight ${darkMode ? 'text-white' : 'text-slate-900'}`}>{promo.name}</h3>\n                                                            <p className={`text-sm mb-6 flex-1 ${darkMode ? 'text-purple-300' : 'text-purple-600'}`}>{promo.description}</p>\n\n                                                            {/* Lista de productos incluidos */}\n                                                            <div className=\"mb-6 space-y-2\">\n                                                                <p className=\"text-[10px] uppercase font-bold text-slate-500 tracking-widest\">Incluye:</p>\n                                                                {promo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    return (\n                                                                        <div key={idx} className={`flex items-center gap-2 text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                                                            <CheckCircle className={`w-3.5 h-3.5 ${darkMode ? 'text-purple-500' : 'text-purple-600'}`} />\n                                                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}x</span> {p ? p.name : 'Producto'}\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                            </div>\n\n                                                            <div className={`flex items-center justify-between mt-auto pt-6 border-t ${darkMode ? 'border-white/5' : 'border-slate-100'}`}>\n                                                                <div className=\"flex flex-col\">\n                                                                    <span className=\"text-slate-500 text-xs font-bold line-through decoration-red-500 decoration-2\">\n                                                                        ${promo.items.reduce((acc, item) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                        }, 0).toLocaleString()}\n                                                                    </span>\n                                                                    <span className={`text-3xl font-black ${darkMode ? 'text-purple-400 neon-text' : 'text-purple-600'}`}>\n                                                                        ${Number(promo.price).toLocaleString()}\n                                                                    </span>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!hasStock) return showToast(\"Sin stock disponible para esta promo.\", \"warning\");\n                                                                        const promoProduct = {\n                                                                            id: promo.id,\n                                                                            name: promo.name,\n                                                                            basePrice: promo.price,\n                                                                            image: promo.image,\n                                                                            isPromo: true,\n                                                                            items: promo.items,\n                                                                            stock: maxPurchasable\n                                                                        };\n                                                                        manageCart(promoProduct, 1);\n                                                                    }}\n                                                                    disabled={!hasStock}\n                                                                    className={`px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition shadow-lg ${hasStock ? (darkMode ? 'bg-white text-black hover:bg-purple-400 hover:text-white hover:scale-105' : 'bg-slate-900 text-white hover:bg-purple-600 hover:scale-105') : (darkMode ? 'bg-slate-800 text-slate-500 cursor-not-allowed' : 'bg-slate-200 text-slate-400 cursor-not-allowed')}`}\n                                                                >\n                                                                    {hasStock ? <ShoppingCart className=\"w-5 h-5\" /> : <X className=\"w-5 h-5\" />}\n                                                                    {hasStock ? 'AGREGAR' : 'AGOTADO'}\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                );\n                                            })}\n                                        </div>\n                                    </>\n                                ) : (\n                                    <div className={`flex flex-col items-center justify-center p-20 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                        <div className={`p-8 rounded-full mb-6 shadow-2xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                            <Tag className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                        </div>\n                                        <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Sin Promociones Activas</h3>\n                                        <p className=\"text-slate-500 max-w-sm\">No hay promociones disponibles en este momento. ¬°Volv√© pronto!</p>\n                                        <button\n                                            onClick={() => setSelectedCategory('')}\n                                            className={`mt-6 px-6 py-3 rounded-xl font-bold transition border ${darkMode ? 'bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 border-orange-500/20' : 'bg-orange-50 hover:bg-orange-100 text-orange-600 border-orange-200'}`}\n                                        >\n                                            Ver Todo el Cat√°logo\n                                        </button>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n\n                        {/* Grid de Productos - Filtrando productos inv√°lidos (ej: tests) */}\n                        {products.filter(p => p.isActive !== false).length === 0 ? (\n                            <div className={`flex flex-col items-center justify-center p-20 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                {/* Empty State expl√≠cito (sin componente externo para \"bulk\") */}\n                                <div className={`p-8 rounded-full mb-6 shadow-2xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <Package className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                </div>\n                                <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Cat√°logo Vac√≠o</h3>\n                                <p className=\"text-slate-500 max-w-sm\">No hay productos disponibles en este momento. Por favor revisa m√°s tarde o contacta soporte.</p>\n                            </div>\n                        ) : (\n                            <>\n                                {filteredProducts.length === 0 && selectedCategory !== 'Promos' && (\n                                    <div className=\"flex flex-col items-center justify-center p-20 text-center col-span-full animate-fade-in w-full\">\n                                        <div className={`p-6 rounded-full mb-4 inline-block border ${darkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                            <Search className={`w-12 h-12 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`} />\n                                        </div>\n                                        <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>No se encontraron resultados</h3>\n                                        <p className=\"text-slate-500 mb-6 max-w-md mx-auto\">\n                                            No hay productos que coincidan con <span className={`${darkMode ? 'text-white' : 'text-slate-900'} font-bold`}>\"{searchQuery}\"</span>\n                                            {selectedCategory && <span> en la categor√≠a <span className={`${darkMode ? 'text-white' : 'text-slate-900'} font-bold`}>{selectedCategory}</span></span>}.\n                                        </p>\n                                        <button\n                                            onClick={() => { setSearchQuery(''); setSelectedCategory(''); }}\n                                            className={`px-6 py-3 rounded-xl font-bold transition border ${darkMode ? 'bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 border-orange-500/20' : 'bg-orange-50 hover:bg-orange-100 text-orange-600 border-orange-200'}`}\n                                        >\n                                            Limpiar filtros\n                                        </button>\n                                    </div>\n                                )}\n                                <div className=\"grid grid-cols-1 min-[380px]:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 min-[1920px]:grid-cols-5 gap-3 sm:gap-6 md:gap-8 pb-32\">\n                                    {filteredProducts.map(p => (\n                                        <ProductCard\n                                            key={p.id}\n                                            p={p}\n                                            settings={settings}\n                                            currentUser={currentUser}\n                                            toggleFavorite={toggleFavorite}\n                                            setSelectedProduct={setSelectedProduct}\n                                            manageCart={manageCart}\n                                            calculateItemPrice={calculateItemPrice}\n                                            darkMode={darkMode}\n                                        />\n                                    ))}\n                                </div>\n\n                            </>\n                        )}\n                    </div>\n                )}\n\n                {/* 2. VISTA DEL CARRITO DE COMPRAS */}\n                {view === 'cart' && (\n                    <div className=\"max-w-6xl mx-auto animate-fade-up px-4 md:px-8 pb-20\">\n                        <div className=\"flex flex-col gap-4 mb-8 pt-8 sm:flex-row sm:items-center sm:justify-between\">\n                            <div className=\"flex items-center gap-4\">\n                                <button onClick={() => setView('store')} className={`p-3 rounded-full transition group ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800' : 'bg-slate-100 text-slate-500 hover:text-slate-900 hover:bg-slate-200'}`}>\n                                    <ArrowLeft className=\"w-6 h-6 group-hover:-translate-x-1 transition\" />\n                                </button>\n                                <h1 className={`text-4xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    <ShoppingBag className=\"w-10 h-10 text-orange-500\" /> Mi Carrito\n                                </h1>\n                            </div>\n\n                            {cart.length > 0 && settings?.showCartWhatsappCheckout === true && (\n                                <button\n                                    onClick={() => {\n                                        const url = buildWhatsappUrl(settings?.whatsappLink, buildWhatsappCartMessage());\n                                        if (!url) {\n                                            showToast('Configura el enlace de WhatsApp en Admin ‚Üí Configuraci√≥n ‚Üí Social.', 'warning');\n                                            return;\n                                        }\n                                        window.open(url, '_blank');\n                                    }}\n                                    className=\"w-full sm:w-auto px-5 py-3 bg-green-600 hover:bg-green-500 text-white rounded-2xl font-black transition shadow-lg hover:shadow-green-500/30 flex items-center justify-center gap-2\"\n                                >\n                                    <MessageCircle className=\"w-5 h-5\" /> Terminar compra por WhatsApp\n                                </button>\n                            )}\n                        </div>\n\n                        {cart.length === 0 ? (\n                            <div className={`flex flex-col items-center justify-center p-16 text-center border-2 border-dashed rounded-[3rem] ${darkMode ? 'border-slate-800 bg-slate-950/30' : 'border-slate-200 bg-slate-50'}`}>\n                                <div className={`p-8 rounded-full mb-6 shadow-xl border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <ShoppingCart className={`w-16 h-16 ${darkMode ? 'text-slate-600' : 'text-slate-400'}`} />\n                                </div>\n                                <h3 className={`text-2xl font-black mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>Tu carrito est√° vac√≠o</h3>\n                                <p className=\"text-slate-500 text-sm max-w-xs mb-8 leading-relaxed\">\n                                    ¬°Es un buen momento para buscar ese producto que tanto quieres!\n                                </p>\n                                <button onClick={() => setView('store')} className=\"px-8 py-4 bg-orange-600 text-white rounded-xl font-bold transition shadow-lg hover:bg-orange-500 hover:shadow-orange-500/30 flex items-center gap-2\">\n                                    Ir a la Tienda <ArrowRight className=\"w-5 h-5\" />\n                                </button>\n                            </div>\n                        ) : (\n                            <div className=\"grid lg:grid-cols-3 gap-8\">\n                                {/* Lista de Items */}\n                                <div className=\"lg:col-span-2 space-y-4\">\n                                    {cart.map((item) => (\n                                        <div key={item.product.id} className={`p-4 md:p-6 rounded-3xl border flex flex-col md:flex-row gap-6 items-center group relative overflow-hidden transition duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-orange-900/50' : 'bg-white border-slate-200 hover:border-orange-200 shadow-sm hover:shadow-md'}`}>\n                                            {/* Imagen */}\n                                            <div className=\"w-full md:w-32 h-32 bg-white rounded-2xl flex items-center justify-center p-2 flex-shrink-0 shadow-lg border border-slate-100\">\n                                                <img src={item.product.image} alt={item.product.name} className=\"w-full h-full object-contain\" />\n                                            </div>\n\n                                            {/* Info */}\n                                            <div className=\"flex-1 w-full text-center md:text-left z-10\">\n                                                <div className=\"flex justify-between items-start w-full\">\n                                                    <h3 className={`font-bold text-lg truncate mb-1 pr-4 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.product.name}</h3>\n                                                    <button onClick={() => manageCart(item.product, -item.quantity)} className={`p-2 rounded-lg transition ${darkMode ? 'text-slate-600 hover:text-red-500 bg-slate-900 hover:bg-red-900/20' : 'text-slate-400 hover:text-red-600 bg-slate-50 hover:bg-red-50'}`}>\n                                                        <Trash2 className=\"w-5 h-5\" />\n                                                    </button>\n                                                </div>\n\n                                                <p className=\"text-orange-500 font-bold text-sm mb-4\">\n                                                    ${calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0).toLocaleString()} <span className=\"text-slate-500 font-normal\">unitario</span>\n                                                </p>\n\n                                                {/* Controles de Cantidad */}\n                                                <div className=\"flex items-center justify-center md:justify-start gap-4\">\n                                                    <div className={`flex items-center gap-3 rounded-xl p-1 border ${darkMode ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-200'}`}>\n                                                        <button onClick={() => manageCart(item.product, -1)} className={`w-10 h-10 flex items-center justify-center rounded-lg transition ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}>\n                                                            <Minus className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <span className={`text-base font-bold w-8 text-center ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.quantity}</span>\n                                                        <button onClick={() => manageCart(item.product, 1)} className={`w-10 h-10 flex items-center justify-center rounded-lg transition ${darkMode ? 'hover:bg-slate-800 text-slate-400 hover:text-white' : 'hover:bg-white text-slate-500 hover:text-slate-900'}`}>\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                    <div className={`hidden md:block h-8 w-px mx-2 ${darkMode ? 'bg-slate-800' : 'bg-slate-200'}`}></div>\n                                                    <p className=\"text-xs text-slate-500 font-bold uppercase hidden md:block\">\n                                                        Subtotal: <span className={`text-lg ml-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>${(calculateItemPrice(item.product?.basePrice ?? 0, item.product?.discount ?? 0) * (item.quantity || 0)).toLocaleString()}</span>\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </div>\n\n                                {/* Resumen y Checkout */}\n                                <div className={`border p-8 rounded-[2.5rem] h-fit sticky top-28 shadow-2xl transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`text-2xl font-black mb-8 border-b pb-4 transition-colors duration-300 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>Resumen de Compra</h3>\n\n                                    {/* Secci√≥n de Cupones */}\n                                    <div className=\"mb-8\">\n                                        <label className={`text-xs font-bold uppercase tracking-widest mb-3 block flex items-center gap-2 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                            <Tag className=\"w-4 h-4\" /> Cup√≥n de Descuento\n                                        </label>\n                                        {appliedCoupon ? (\n                                            <div className=\"bg-purple-900/20 border border-purple-500/30 p-4 rounded-2xl flex justify-between items-center relative overflow-hidden group animate-fade-up\">\n                                                <div className=\"absolute inset-0 bg-purple-500/5 group-hover:bg-purple-500/10 transition\"></div>\n                                                <div className=\"relative z-10\">\n                                                    <p className=\"font-black text-purple-300 text-lg tracking-widest\">{appliedCoupon.code}</p>\n                                                    <p className=\"text-xs text-purple-400 font-bold\">\n                                                        {appliedCoupon.type === 'fixed' ? `$${appliedCoupon.value} OFF` : `${appliedCoupon.value}% OFF`}\n                                                    </p>\n                                                </div>\n                                                <button onClick={() => setAppliedCoupon(null)} className={`p-2 rounded-full transition relative z-10 border border-transparent hover:border-red-500/30 ${darkMode ? 'bg-slate-900/50 text-purple-300 hover:text-red-400 hover:bg-red-900/30' : 'bg-white text-purple-600 hover:text-red-600 hover:bg-red-50'}`}>\n                                                    <Trash2 className=\"w-4 h-4\" />\n                                                </button>\n                                            </div>\n                                        ) : (\n                                            <button onClick={() => setShowCouponModal(true)} className={`w-full py-4 border border-dashed rounded-2xl transition flex items-center justify-center gap-2 text-sm font-bold group ${darkMode ? 'border-slate-700 hover:border-purple-500 bg-slate-900/30 hover:bg-purple-900/10 text-slate-400 hover:text-purple-300' : 'border-slate-300 hover:border-purple-500 bg-slate-50 hover:bg-purple-50 text-slate-500 hover:text-purple-600'}`}>\n                                                <Ticket className=\"w-5 h-5 group-hover:rotate-12 transition\" /> Ver cupones disponibles\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Desglose de Precios */}\n                                    <div className={`space-y-4 border-b pb-8 mb-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                        <div className={`flex justify-between font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Subtotal</span>\n                                            <span className={`font-mono font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n                                        <div className={`flex justify-between text-sm font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>\n                                            <span>Env√≠o {checkoutData.shippingMethod === 'Delivery' ? '(A domicilio)' : '(Retiro)'}</span>\n                                            <span className=\"text-orange-500 font-bold flex items-center gap-1\">\n                                                <Truck className=\"w-3 h-3\" />\n                                                {shippingFee > 0 ? `$${shippingFee.toLocaleString()}` : (checkoutData.shippingMethod === 'Pickup' ? 'Gratis' : '¬°Env√≠o Gratis!')}\n                                            </span>\n                                        </div>\n                                        {appliedCoupon && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold text-sm animate-pulse bg-purple-900/10 p-2 rounded-lg\">\n                                                <span>Descuento aplicado</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Total Final */}\n                                    <div className=\"flex justify-between items-end mb-8\">\n                                        <span className={`font-bold text-lg ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total Final</span>\n                                        <span className={`text-4xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                                            ${finalTotal.toLocaleString()}\n                                        </span>\n                                    </div>\n\n                                    {/* Bot√≥n Acci√≥n */}\n                                    <button onClick={() => setView('checkout')} className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-5 text-white font-bold text-lg rounded-2xl shadow-[0_0_25px_rgba(249,115,22,0.3)] hover:shadow-[0_0_35px_rgba(249,115,22,0.5)] transition-all flex items-center justify-center gap-3 transform hover:-translate-y-1\">\n                                        Iniciar Compra <ArrowRight className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                )}\n\n                {/* 3. VISTA DE CHECKOUT (FINALIZAR COMPRA) */}\n                {view === 'checkout' && (\n                    <div className=\"max-w-5xl mx-auto pb-20 animate-fade-up px-4 md:px-8\">\n                        <button onClick={() => setView('cart')} className=\"mb-8 mt-8 text-slate-400 hover:text-white flex items-center gap-2 font-bold transition\">\n                            <ArrowLeft className=\"w-5 h-5\" /> Volver al Carrito\n                        </button>\n\n                        <div className=\"grid md:grid-cols-5 gap-8\">\n                            {/* Columna Izquierda: Formularios */}\n                            <div className=\"md:col-span-3 space-y-8\">\n\n                                {/* Opciones de Entrega */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <Truck className=\"text-orange-500 w-6 h-6\" /> M√©todo de Entrega\n                                    </h2>\n                                    <div className=\"grid grid-cols-2 gap-4 relative z-10 mb-6\">\n                                        {settings?.shippingPickup?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Pickup' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Pickup' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Pickup' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <MapPin className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Retiro en Local</span>\n                                            </button>\n                                        )}\n                                        {settings?.shippingDelivery?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, shippingMethod: 'Delivery' })}\n                                                className={`p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.shippingMethod === 'Delivery' ? 'border-orange-500 bg-orange-500/10 text-orange-500' : darkMode ? 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500' : 'border-slate-200 bg-slate-50 text-slate-500 hover:border-slate-400'}`}\n                                            >\n                                                {checkoutData.shippingMethod === 'Delivery' && <CheckCircle className=\"absolute top-2 right-2 w-5 h-5 text-orange-500\" />}\n                                                <Truck className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-xs font-black uppercase\">Env√≠o a Domicilio</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {checkoutData.shippingMethod === 'Pickup' && (\n                                        <div className=\"p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl animate-fade-up flex gap-3\">\n                                            <Info className=\"w-5 h-5 text-orange-400 shrink-0\" />\n                                            <p className=\"text-xs text-orange-200\">Retira tu pedido en: <span className=\"font-bold\">{settings?.shippingPickup?.address || 'Direcci√≥n a coordinar'}</span></p>\n                                        </div>\n                                    )}\n\n                                    {checkoutData.shippingMethod === 'Delivery' && (\n                                        <div className=\"space-y-5 relative z-10 animate-fade-up mt-4\">\n                                            <h3 className={`text-sm font-bold uppercase tracking-widest pl-2 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>Datos de Destino</h3>\n                                            <div>\n                                                <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Direcci√≥n y Altura</label>\n                                                <input\n                                                    className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 focus:ring-1 focus:ring-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                    placeholder=\"Ej: Av. Santa Fe 1234\"\n                                                    value={checkoutData.address || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, address: e.target.value })}\n                                                />\n                                            </div>\n                                            <div className=\"grid grid-cols-2 gap-5\">\n                                                <div>\n                                                    <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Ciudad</label>\n                                                    <input\n                                                        className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                        placeholder=\"Ej: Rosario\"\n                                                        value={checkoutData.city || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, city: e.target.value })}\n                                                    />\n                                                </div>\n                                                <div>\n                                                    <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Provincia</label>\n                                                    <input\n                                                        className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                        placeholder=\"Ej: Santa Fe\"\n                                                        value={checkoutData.province || ''}\n                                                        onChange={e => setCheckoutData({ ...checkoutData, province: e.target.value })}\n                                                    />\n                                                </div>\n                                            </div>\n                                            <div>\n                                                <label className={`text-xs font-bold uppercase ml-2 mb-1 block ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>C√≥digo Postal</label>\n                                                <input\n                                                    className={`w-full border rounded-xl p-4 transition font-medium outline-none focus:border-orange-500 ${darkMode ? 'bg-slate-900 border-slate-700 text-white placeholder-slate-600' : 'bg-white border-slate-200 text-slate-900 placeholder-slate-400'}`}\n                                                    placeholder=\"Ej: 2000\"\n                                                    value={checkoutData.zipCode || ''}\n                                                    onChange={e => setCheckoutData({ ...checkoutData, zipCode: e.target.value })}\n                                                />\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n\n                                {/* M√©todo de Pago */}\n                                <div className={`border p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-green-500/10 rounded-bl-[100px] pointer-events-none\"></div>\n                                    <h2 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <CreditCard className=\"text-orange-500 w-6 h-6\" /> M√©todo de Pago\n                                    </h2>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10\">\n                                        {settings?.paymentMercadoPago?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Tarjeta' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Tarjeta' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Tarjeta' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <CreditCard className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Tarjeta</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentTransfer?.enabled && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Transferencia' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Transferencia' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Transferencia' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <RefreshCw className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Transferencia</span>\n                                            </button>\n                                        )}\n                                        {settings?.paymentCash && checkoutData.shippingMethod !== 'Delivery' && (\n                                            <button\n                                                onClick={() => setCheckoutData({ ...checkoutData, paymentChoice: 'Efectivo' })}\n                                                className={`p-4 md:p-6 rounded-2xl border transition flex flex-col items-center gap-3 relative overflow-hidden group ${checkoutData.paymentChoice === 'Efectivo' ? 'border-orange-500 bg-orange-900/20 text-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.2)]' : 'border-slate-700 bg-slate-900/30 text-slate-500 hover:border-slate-500 hover:bg-slate-800'}`}\n                                            >\n                                                {checkoutData.paymentChoice === 'Efectivo' && <CheckCircle className=\"absolute top-2 right-2 text-orange-500\" />}\n                                                <Banknote className=\"w-8 h-8 group-hover:scale-110 transition\" />\n                                                <span className=\"text-sm font-black tracking-wider uppercase\">Efectivo</span>\n                                            </button>\n                                        )}\n                                    </div>\n\n                                    {/* Card Payment Brick Container - Solo para Tarjeta */}\n                                    {checkoutData.paymentChoice === 'Tarjeta' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/30\">\n                                                <h3 className=\"text-white font-bold mb-4 flex items-center gap-2\">\n                                                    <CreditCard className=\"w-5 h-5 text-orange-400\" />\n                                                    Ingres√° los datos de tu tarjeta\n                                                </h3>\n                                                <p className=\"text-slate-400 text-sm mb-4\">\n                                                    Pag√° de forma segura con Visa, MasterCard, AMEX y m√°s.\n                                                </p>\n\n                                                {/* WARNING: AD BLOCKER */}\n                                                <div className=\"mb-6 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <AlertCircle className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        <strong className=\"text-orange-400 block mb-1\">ATENCI√ìN:</strong>\n                                                        Si ten√©s activado un <span className=\"text-white font-bold\">AdBlocker/Bloqueador de Anuncios</span>, por favor desactivalo temporalmente.\n                                                        Es posible que el pago no se concrete si el bloqueador interfiere con la seguridad del banco.\n                                                    </p>\n                                                </div>\n\n                                                {/* Contenedor del Card Payment Brick de Mercado Pago */}\n                                                <div id=\"cardPaymentBrick_container\" ref={cardPaymentBrickRef} className=\"min-h-[400px]\"></div>\n\n                                                {/* Mensaje de error si hay */}\n                                                {paymentError && (\n                                                    <div className=\"mt-4 space-y-3\">\n                                                        <div className=\"p-4 bg-red-900/20 border border-red-500/30 rounded-xl text-red-400 text-sm flex items-center gap-3\">\n                                                            <AlertTriangle className=\"w-5 h-5 flex-shrink-0\" />\n                                                            {paymentError}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => {\n                                                                setPaymentError(null);\n                                                                initializeCardPaymentBrick();\n                                                            }}\n                                                            className=\"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2\"\n                                                        >\n                                                            <RefreshCw className=\"w-4 h-4\" />\n                                                            Reintentar Pago\n                                                        </button>\n                                                    </div>\n                                                )}\n\n                                                {/* Indicador de procesamiento */}\n                                                {isPaymentProcessing && (\n                                                    <div className=\"mt-4 p-4 bg-orange-900/20 border border-orange-500/30 rounded-xl text-orange-400 text-sm flex items-center gap-3\">\n                                                        <Loader2 className=\"w-5 h-5 animate-spin flex-shrink-0\" />\n                                                        Procesando tu pago, por favor esper√°...\n                                                    </div>\n                                                )}\n                                            </div>\n                                        </div>\n                                    )}\n                                    {checkoutData.paymentChoice === 'Transferencia' && (\n                                        <div className=\"mt-8 animate-fade-up\">\n                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-orange-500/20\">\n                                                <h3 className=\"text-white font-bold mb-3 flex items-center gap-2\">\n                                                    <Building className=\"w-5 h-5 text-orange-400\" />\n                                                    Datos para transferir\n                                                </h3>\n                                                <div className=\"space-y-2 text-sm\">\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Titular</span>\n                                                        <span className=\"text-white font-medium text-right break-all\">{settings?.paymentTransfer?.holderName ? String(settings.paymentTransfer.holderName) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">Alias</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.alias ? String(settings.paymentTransfer.alias) : 'Sin configurar'}</span>\n                                                    </div>\n                                                    <div className=\"flex items-start justify-between gap-4\">\n                                                        <span className=\"text-slate-400\">CBU</span>\n                                                        <span className=\"text-white font-mono text-right break-all\">{settings?.paymentTransfer?.cbu ? String(settings.paymentTransfer.cbu) : 'Sin configurar'}</span>\n                                                    </div>\n                                                </div>\n                                                <div className=\"mt-4 p-4 bg-orange-900/10 border border-orange-500/20 rounded-xl flex items-start gap-3\">\n                                                    <Info className=\"w-5 h-5 text-orange-500 shrink-0 mt-0.5\" />\n                                                    <p className=\"text-xs text-orange-200 leading-relaxed font-medium\">\n                                                        Una vez realizada la transferencia, confirm√° el pedido. Si necesit√°s coordinar el comprobante, te contactamos por WhatsApp si est√° disponible.\n                                                    </p>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna Derecha: Confirmaci√≥n */}\n                            <div className=\"md:col-span-2\">\n                                <div className={`border p-8 rounded-[2.5rem] sticky top-28 shadow-2xl ${darkMode ? 'bg-gradient-to-br from-slate-900 via-[#0a0a0a] to-[#050505] border-slate-800' : 'bg-white border-slate-200'}`}>\n                                    <h3 className={`font-black mb-8 text-xl border-b pb-4 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-100'}`}>Resumen Final</h3>\n\n                                    <div className=\"space-y-4 mb-8\">\n                                        <div className={`flex justify-between ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                            <span>Productos ({cart.length})</span>\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>${cartSubtotal.toLocaleString()}</span>\n                                        </div>\n\n                                        {discountAmount > 0 && (\n                                            <div className=\"flex justify-between text-purple-500 font-bold\">\n                                                <span>Descuento</span>\n                                                <span>-${discountAmount.toLocaleString()}</span>\n                                            </div>\n                                        )}\n\n                                        <div className={`h-px my-4 border-t border-dashed ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-100 border-slate-200'}`}></div>\n\n                                        <div className=\"flex justify-between items-end\">\n                                            <span className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Total a Pagar</span>\n                                            <span className={`text-3xl font-black tracking-tighter ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>${finalTotal.toLocaleString()}</span>\n                                        </div>\n                                    </div>\n\n                                    {/* Bot√≥n Confirmar - Solo para Efectivo o Transferencia (NO para Tarjeta) */}\n                                    {checkoutData.paymentChoice && checkoutData.paymentChoice !== 'Tarjeta' ? (\n                                        <>\n                                            <button\n                                                onClick={confirmOrder}\n                                                disabled={isProcessingOrder}\n                                                className={`w-full py-5 text-white font-bold text-lg rounded-2xl shadow-xl flex items-center justify-center gap-3 transition-all ${isProcessingOrder ? 'bg-slate-700 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500 shadow-green-900/20 hover:scale-[1.02]'}`}\n                                            >\n                                                {isProcessingOrder ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <CheckCircle className=\"w-6 h-6\" />}\n                                                {isProcessingOrder ? 'Procesando...' : 'Confirmar Pedido'}\n                                            </button>\n\n                                            <p className=\"text-center text-slate-600 text-xs mt-6 leading-relaxed px-4\">\n                                                Al confirmar, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad.\n                                            </p>\n                                        </>\n                                    ) : checkoutData.paymentChoice === 'Tarjeta' ? (\n                                        <div className=\"bg-orange-900/10 border border-orange-500/20 p-4 rounded-2xl text-center\">\n                                            <p className=\"text-orange-400 text-sm font-medium flex items-center justify-center gap-2\">\n                                                <CreditCard className=\"w-4 h-4\" />\n                                                Complet√° los datos de tu tarjeta arriba para pagar\n                                            </p>\n                                            <p className=\"text-slate-500 text-xs mt-2\">\n                                                Tu compra quedar√° confirmada autom√°ticamente al procesar el pago.\n                                            </p>\n                                        </div>\n                                    ) : null}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 4. VISTA DE PERFIL (HISTORIAL Y FAVORITOS) - Solo si el usuario tiene datos v√°lidos */}\n                {view === 'profile' && currentUser && currentUser.id && currentUser.email && currentUser.name && (\n                    <div className=\"max-w-6xl mx-auto pt-8 animate-fade-up px-4 md:px-8 pb-20\">\n                        {/* Tarjeta de Usuario */}\n                        <div className={`p-8 md:p-12 rounded-[3rem] mb-12 flex flex-col md:flex-row items-center gap-8 relative overflow-hidden shadow-2xl border transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                            {/* Decoraci√≥n Fondo */}\n                            <div className={`absolute top-0 right-0 w-96 h-96 rounded-full blur-[120px] pointer-events-none ${darkMode ? 'bg-orange-500/5' : 'bg-orange-500/10'}`}></div>\n                            <div className={`absolute bottom-0 left-0 w-64 h-64 rounded-full blur-[100px] pointer-events-none ${darkMode ? 'bg-blue-600/5' : 'bg-blue-600/10'}`}></div>\n\n                            {/* Avatar */}\n                            <div className={`w-28 h-28 rounded-[2rem] bg-gradient-to-br from-orange-500 to-blue-600 flex items-center justify-center text-5xl font-black text-white shadow-2xl z-10 transform rotate-3 border-4 ${darkMode ? 'border-[#0a0a0a]' : 'border-white'}`}>\n                                {currentUser.name.charAt(0)}\n                            </div>\n\n                            {/* Info */}\n                            <div className=\"text-center md:text-left z-10 flex-1\">\n                                <h2 className={`text-4xl md:text-5xl font-black mb-2 tracking-tight ${darkMode ? 'text-white' : 'text-slate-900'}`}>{currentUser.name}</h2>\n                                <p className={`flex items-center justify-center md:justify-start gap-2 font-medium mb-4 ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>\n                                    <Mail className=\"w-4 h-4 text-orange-500\" /> {currentUser.email}\n                                </p>\n                                <div className=\"flex flex-wrap gap-4 justify-center md:justify-start\">\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <User className=\"w-3 h-3\" /> {currentUser.dni || 'Sin DNI'}\n                                    </span>\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <Phone className=\"w-3 h-3\" /> {currentUser.phone || 'Sin Tel√©fono'}\n                                    </span>\n                                    <span className={`px-4 py-2 rounded-xl text-xs font-mono flex items-center gap-2 border ${darkMode ? 'bg-slate-900 border-slate-800 text-slate-500' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>\n                                        <Shield className=\"w-3 h-3\" /> {getRole(currentUser.email).toUpperCase()}\n                                    </span>\n                                </div>\n                            </div>\n\n                            {/* Acciones */}\n                            <div className=\"flex flex-col gap-3 z-10 w-full md:w-auto\">\n                                {hasAccess(currentUser.email) && (\n                                    <button onClick={() => setView('admin')} className={`px-6 py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2 shadow-lg border ${darkMode ? 'bg-slate-900 border-orange-500/30 text-orange-400 hover:bg-orange-900/20 hover:shadow-orange-500/10' : 'bg-orange-50 border-orange-200 text-orange-600 hover:bg-orange-100'}`}>\n                                        <Shield className=\"w-5 h-5\" /> Panel Admin\n                                    </button>\n                                )}\n                                <button onClick={() => { localStorage.removeItem('sustore_user_data'); setCurrentUser(null); setView('store') }} className={`px-6 py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2 border ${darkMode ? 'bg-red-900/10 border-red-500/20 text-red-500 hover:bg-red-900/20 hover:border-red-500/40' : 'bg-red-50 border-red-100 text-red-600 hover:bg-red-100'}`}>\n                                    <LogOut className=\"w-5 h-5\" /> Cerrar Sesi√≥n\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* SECCI√ìN: MIS CUPONES (NUEVO) */}\n                        <div className={`p-8 rounded-[2.5rem] mb-12 shadow-2xl animate-fade-up border transition-colors duration-300 ${darkMode ? 'bg-[#0a0a0a] border-slate-800' : 'bg-white border-slate-200'}`}>\n                            <h3 className={`text-2xl font-black mb-6 flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                <Ticket className=\"text-purple-400 w-6 h-6\" /> Mis Cupones Disponibles\n                            </h3>\n\n                            <div className=\"grid md:grid-cols-2 gap-8\">\n                                <div className=\"space-y-4\">\n                                    {/* Mostrar cupones GLOBALES (targetType='global') y ESPECIFICOS para este usuario */}\n                                    {(() => {\n                                        const myCoupons = coupons.filter(c =>\n                                            (c.targetType === 'global') ||\n                                            (c.targetType === 'specific_email' && c.targetUser === currentUser.email)\n                                        );\n\n                                        if (myCoupons.length === 0) return <p className={`${darkMode ? 'text-slate-500' : 'text-slate-400'} italic`}>No tienes cupones disponibles en este momento.</p>;\n\n                                        return myCoupons.map(c => (\n                                            <div key={c.id} className={`p-4 rounded-xl flex items-center justify-between group transition border ${darkMode ? 'bg-slate-900/50 border-slate-800 hover:border-purple-500/30' : 'bg-slate-50 border-slate-100 hover:border-purple-300 hover:bg-white'}`}>\n                                                <div>\n                                                    <p className={`font-black text-lg tracking-widest ${darkMode ? 'text-white' : 'text-slate-900'}`}>{c.code}</p>\n                                                    <p className={`text-sm font-bold ${darkMode ? 'text-purple-400' : 'text-purple-600'}`}>\n                                                        {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                    </p>\n                                                    {c.expirationDate && <p className={`text-[10px] mt-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Vence: {c.expirationDate}</p>}\n                                                </div>\n                                                <button\n                                                    onClick={() => {\n                                                        navigator.clipboard.writeText(c.code);\n                                                        showToast(\"C√≥digo copiado\", \"success\");\n                                                    }}\n                                                    className={`px-4 py-2 rounded-lg text-xs font-bold transition border ${darkMode ? 'bg-purple-900/20 text-purple-400 border-purple-500/20 hover:bg-purple-500 hover:text-white' : 'bg-purple-50 text-purple-600 border-purple-200 hover:bg-purple-600 hover:text-white'}`}\n                                                >\n                                                    COPIAR\n                                                </button>\n                                            </div>\n                                        ));\n                                    })()}\n                                </div>\n\n                                <div className={`p-6 rounded-2xl border ${darkMode ? 'bg-slate-900/30 border-slate-800' : 'bg-slate-50 border-slate-200'}`}>\n                                    <h4 className={`font-bold mb-4 text-sm uppercase tracking-wider ${darkMode ? 'text-white' : 'text-slate-900'}`}>Canjear C√≥digo</h4>\n                                    <div className=\"flex gap-2\">\n                                        <input\n                                            className={`flex-1 rounded-xl p-3 outline-none uppercase font-mono border ${darkMode ? 'bg-slate-950 border-slate-800 text-white focus:border-purple-500' : 'bg-white border-slate-200 text-slate-900 focus:border-purple-400'}`}\n                                            placeholder=\"C√ìDIGO\"\n                                            id=\"couponRedeemInput\"\n                                        />\n                                        <button\n                                            onClick={() => {\n                                                const input = document.getElementById('couponRedeemInput');\n                                                const code = String(input?.value || '').trim().toUpperCase();\n                                                if (!code) return showToast(\"Ingresa un c√≥digo\", \"warning\");\n                                                const coupon = coupons.find(c => c.code === code);\n                                                if (coupon) {\n                                                    showToast(\"¬°Cup√≥n v√°lido! √ösalo en el checkout.\", \"success\");\n                                                } else {\n                                                    showToast(\"Cup√≥n no encontrado o inv√°lido\", \"error\");\n                                                }\n                                            }}\n                                            className=\"bg-purple-600 px-6 rounded-xl text-white font-bold hover:bg-purple-500 transition shadow-lg\"\n                                        >\n                                            Validar\n                                        </button>\n                                    </div>\n                                    <p className={`text-xs mt-3 leading-relaxed ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>\n                                        Ingresa el c√≥digo aqu√≠ para verificar si es v√°lido. Ll√©valo al checkout para aplicar el descuento.\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className=\"grid lg:grid-cols-2 gap-10\">\n                            {/* Columna Izquierda: Historial de Pedidos */}\n                            <div className=\"space-y-6\">\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className={`text-2xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <ShoppingBag className=\"text-orange-400 w-6 h-6\" /> Tus Compras\n                                    </h3>\n                                </div>\n\n                                {(() => {\n                                    const completedOrders = orders.filter(o => o.userId === currentUser.id && o.status === 'Realizado');\n                                    // Flatten all items from completed orders\n                                    const purchasedItems = completedOrders.flatMap(o => o.items.map(item => ({ ...item, date: o.date })));\n\n                                    if (purchasedItems.length === 0) {\n                                        return (\n                                            <div className={`p-12 border-2 border-dashed rounded-[2rem] text-center bg-slate-900/20 ${darkMode ? 'border-slate-800 text-slate-500' : 'border-slate-200 text-slate-400 bg-slate-50'}`}>\n                                                <ShoppingBag className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                                <p className=\"font-bold\">A√∫n no tienes compras finalizadas.</p>\n                                                <button onClick={() => setView('store')} className=\"mt-4 text-orange-400 hover:underline text-sm font-bold\">Ir a la tienda</button>\n                                            </div>\n                                        );\n                                    }\n\n                                    return (\n                                        <div className=\"grid grid-cols-1 gap-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                            {purchasedItems.sort((a, b) => new Date(b.date) - new Date(a.date)).map((item, idx) => (\n                                                <div key={idx} className={`p-4 rounded-2xl flex items-center gap-4 group transition duration-300 border ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-orange-500/50' : 'bg-white border-slate-200 hover:border-orange-400 hover:shadow-md'}`}>\n                                                    <div className={`w-16 h-16 rounded-xl p-1 flex-shrink-0 ${darkMode ? 'bg-white' : 'bg-slate-50 border border-slate-100'}`}>\n                                                        <img src={item.image} className=\"w-full h-full object-contain\" alt={item.title} />\n                                                    </div>\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <h4 className={`font-bold text-sm truncate transition group-hover:text-orange-500 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{item.title}</h4>\n                                                        <p className={`text-xs font-mono mt-1 ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>{new Date(item.date).toLocaleDateString()}</p>\n                                                    </div>\n                                                    <div className=\"text-right flex flex-col items-end gap-1\">\n                                                        <p className={`font-black ${darkMode ? 'text-white' : 'text-slate-900'}`}>${item.unit_price.toLocaleString()}</p>\n                                                        {item.quantity > 1 && (\n                                                            <span className={`text-[10px] font-bold ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>x{item.quantity} und.</span>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })()}\n                            </div>\n\n                            {/* Columna Derecha: Favoritos */}\n                            <div className=\"space-y-6\">\n\n                                <div className=\"flex items-center justify-between\">\n                                    <h3 className={`text-2xl font-black flex items-center gap-3 ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        <Heart className=\"text-red-500 w-6 h-6 fill-current\" /> Mis Favoritos\n                                    </h3>\n                                    <span className={`text-xs font-bold px-3 py-1 rounded-full ${darkMode ? 'text-slate-500 bg-slate-900' : 'text-slate-600 bg-slate-100'}`}>\n                                        {currentUser.favorites?.length || 0} Guardados\n                                    </span>\n                                </div>\n\n                                {!currentUser.favorites || currentUser.favorites.length === 0 ? (\n                                    <div className={`p-12 border-2 border-dashed rounded-[2rem] text-center bg-slate-900/20 ${darkMode ? 'border-slate-800 text-slate-500' : 'border-slate-200 text-slate-400 bg-slate-50'}`}>\n                                        <Heart className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n                                        <p className=\"font-bold\">Tu lista de deseos est√° vac√≠a.</p>\n                                        <p className=\"text-xs mt-2 max-w-xs mx-auto\">Guarda productos haciendo click en el coraz√≥n de las tarjetas.</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"space-y-4 max-h-[600px] overflow-y-auto custom-scrollbar pr-2\">\n                                        {currentUser.favorites.map(fid => {\n                                            const p = products.find(prod => prod.id === fid);\n                                            if (!p) return null;\n                                            return (\n                                                <div key={fid} className={`p-4 rounded-2xl flex items-center gap-4 relative group transition border ${darkMode ? 'bg-[#0a0a0a] border-slate-800 hover:border-slate-600' : 'bg-white border-slate-200 hover:border-orange-400 hover:shadow-md'}`}>\n                                                    <div className={`w-16 h-16 rounded-xl p-1 flex-shrink-0 ${darkMode ? 'bg-white' : 'bg-slate-50 border border-slate-100'}`}>\n                                                        <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                    </div>\n\n                                                    <div className=\"flex-1 min-w-0\">\n                                                        <p className={`font-bold line-clamp-1 transition group-hover:text-orange-500 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{p.name}</p>\n                                                        <p className=\"text-orange-500 font-bold text-sm mt-1\">${p.basePrice.toLocaleString()}</p>\n                                                    </div>\n\n                                                    <div className=\"flex gap-2\">\n                                                        <button\n                                                            onClick={() => toggleFavorite(p)}\n                                                            className={`p-3 rounded-xl transition border ${darkMode ? 'bg-slate-900 text-red-400 border-slate-800 hover:bg-red-900/20 hover:border-red-500/30' : 'bg-red-50 text-red-500 border-red-100 hover:bg-red-100'}`}\n                                                            title=\"Eliminar de favoritos\"\n                                                        >\n                                                            <Trash2 className=\"w-4 h-4\" />\n                                                        </button>\n                                                        <button\n                                                            onClick={() => manageCart(p, 1)}\n                                                            className={`p-3 rounded-xl transition border ${darkMode ? 'bg-slate-900 text-orange-400 border-slate-800 hover:bg-orange-900/20 hover:border-orange-500/30' : 'bg-orange-50 text-orange-600 border-orange-100 hover:bg-orange-100'}`}\n                                                            title=\"Agregar al carrito\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* Fallback: Si intenta acceder a profile sin usuario v√°lido, mostrar login */}\n                {view === 'profile' && (!currentUser || !currentUser.id || !currentUser.email || !currentUser.name) && (\n                    <div className=\"max-w-md mx-auto pt-20 animate-fade-up px-4 text-center\">\n                        <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] shadow-2xl\">\n                            <User className=\"w-16 h-16 mx-auto mb-6 text-orange-500 opacity-50\" />\n                            <h2 className=\"text-2xl font-black text-white mb-4\">Inicia Sesi√≥n</h2>\n                            <p className=\"text-slate-400 mb-8\">Debes iniciar sesi√≥n o registrarte para acceder a tu perfil.</p>\n                            <button\n                                onClick={() => setView('login')}\n                                className=\"w-full py-4 bg-gradient-to-r from-orange-500 to-blue-600 text-white rounded-2xl font-black hover:from-orange-400 hover:to-blue-500 transition shadow-lg\"\n                            >\n                                INICIAR SESI√ìN\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 5. MODAL DE AUTENTICACI√ìN (LOGIN/REGISTER) */}\n                {(view === 'login' || view === 'register') && (\n                    <div className=\"fixed inset-0 z-[20002] flex items-center justify-center bg-[#050505]/95 p-4 animate-fade-up backdrop-blur-xl\">\n\n                        <div className=\"bg-[#0a0a0a] p-8 md:p-12 rounded-[3rem] w-full max-w-md shadow-2xl border border-slate-800 relative overflow-hidden\">\n                            {/* Bot√≥n Cerrar (Dentro de la tarjeta) */}\n                            <button onClick={() => setView('store')} className=\"absolute top-6 right-6 p-2 bg-slate-900/50 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition z-20\">\n                                <X className=\"w-6 h-6\" />\n                            </button>\n\n                            <div className=\"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 via-orange-600 to-red-600\"></div>\n\n                            <h2 className=\"text-4xl font-black text-white mb-2 text-center tracking-tight\">\n                                {loginMode ? 'Bienvenido' : 'Crear Cuenta'}\n                            </h2>\n                            <p className=\"text-slate-500 text-center mb-8 text-sm\">\n                                {loginMode ? 'Ingresa a tu cuenta para continuar.' : '√önete a nosotros hoy mismo.'}\n                            </p>\n\n                            <form onSubmit={(e) => { e.preventDefault(); handleAuth(!loginMode) }} className=\"space-y-4\">\n                                {!loginMode && (\n                                    <div className=\"space-y-4 animate-fade-up\">\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre Completo *\" value={authData.name} onChange={e => setAuthData({ ...authData, name: e.target.value })} required />\n                                        <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de Usuario *\" value={authData.username} onChange={e => setAuthData({ ...authData, username: e.target.value })} required />\n                                        <div className=\"grid grid-cols-2 gap-4\">\n                                            <input className=\"input-cyber p-4\" placeholder=\"DNI *\" value={authData.dni} onChange={e => setAuthData({ ...authData, dni: e.target.value })} required />\n                                            <input className=\"input-cyber p-4\" placeholder=\"Tel√©fono *\" value={authData.phone} onChange={e => setAuthData({ ...authData, phone: e.target.value })} required />\n                                        </div>\n                                    </div>\n                                )}\n\n                                <div className=\"space-y-4\">\n                                    <input className=\"input-cyber w-full p-4\" placeholder={loginMode ? \"Email o Usuario\" : \"Email *\"} value={authData.email} onChange={e => setAuthData({ ...authData, email: e.target.value })} required />\n                                    <input className=\"input-cyber w-full p-4\" type=\"password\" placeholder={loginMode ? \"Contrase√±a\" : \"Contrase√±a *\"} value={authData.password} onChange={e => setAuthData({ ...authData, password: e.target.value })} required />\n                                </div>\n\n                                <button type=\"submit\" className=\"w-full bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 py-4 text-white rounded-xl font-bold mt-6 transition transform hover:-translate-y-1 shadow-lg flex items-center justify-center gap-2\">\n                                    {isLoading ? <Loader2 className=\"animate-spin w-5 h-5\" /> : (loginMode ? 'INGRESAR' : 'REGISTRARSE')}\n                                </button>\n                            </form>\n\n                            <button onClick={() => setLoginMode(!loginMode)} className=\"w-full text-center text-slate-500 text-sm mt-8 font-bold hover:text-orange-400 transition border-t border-slate-800 pt-6\">\n                                {loginMode ? '¬øNo tienes cuenta? Reg√≠strate gratis' : '¬øYa tienes cuenta? Inicia sesi√≥n'}\n                            </button>\n                        </div>\n                    </div>\n                )}\n\n                {/* 6. VISTAS EST√ÅTICAS (ABOUT & GUIDE) */}\n                {view === 'about' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Info className=\"text-orange-500 w-12 h-12\" /> Sobre Nosotros\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] text-xl leading-relaxed whitespace-pre-wrap shadow-2xl relative overflow-hidden ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"absolute top-0 right-0 w-64 h-64 bg-purple-500/10 rounded-full blur-[100px] pointer-events-none\"></div>\n                            <p className=\"relative z-10\">{settings.aboutUsText}</p>\n\n                            <div className={`mt-12 pt-12 border-t flex flex-col md:flex-row gap-8 ${darkMode ? 'border-slate-800' : 'border-slate-200'}`}>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Shield className=\"text-orange-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Garant√≠a Oficial</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>Productos de calidad</p></div>\n                                </div>\n                                <div className=\"flex items-center gap-4\">\n                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center border ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-100 border-slate-200'}`}><Truck className=\"text-purple-500\" /></div>\n                                    <div><h4 className={`font-bold ${darkMode ? 'text-white' : 'text-slate-900'}`}>Env√≠os Seguros</h4><p className={`text-sm ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>A todo el pa√≠s</p></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {view === 'guide' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <FileQuestion className=\"text-orange-500 w-12 h-12\" /> {settings?.guideTitle || 'C√≥mo Comprar'}\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            {[\n                                { title: settings?.guideStep1Title || \"Selecciona Productos\", text: settings?.guideStep1Text || \"Navega por nuestro cat√°logo y a√±ade lo que te guste al carrito con el bot√≥n '+'.\" },\n                                { title: settings?.guideStep2Title || \"Revisa tu Carrito\", text: settings?.guideStep2Text || \"Verifica las cantidades. Si tienes un cup√≥n de descuento, ¬°es el momento de usarlo!\" },\n                                { title: settings?.guideStep3Title || \"Datos de Env√≠o\", text: settings?.guideStep3Text || \"Completa la informaci√≥n de entrega. Hacemos env√≠os a todo el pa√≠s.\" },\n                                { title: settings?.guideStep4Title || \"Pago y Confirmaci√≥n\", text: settings?.guideStep4Text || \"Elige tu m√©todo de pago preferido. Si es transferencia, recibir√°s los datos por email.\" },\n                                { title: settings?.guideStep5Title || \"¬°Listo!\", text: settings?.guideStep5Text || \"Recibir√°s un correo con el seguimiento de tu pedido. ¬°Disfruta tu compra!\" }\n                            ].filter((step, idx) => {\n                                // Filtrar pasos que est√°n desactivados\n                                if (idx === 0 && settings?.showGuideStep1 === false) return false;\n                                if (idx === 1 && settings?.showGuideStep2 === false) return false;\n                                if (idx === 2 && settings?.showGuideStep3 === false) return false;\n                                if (idx === 3 && settings?.showGuideStep4 === false) return false;\n                                if (idx === 4 && settings?.showGuideStep5 === false) return false;\n                                return true;\n                            }).map((step, idx) => (\n                                <div key={idx} className=\"flex gap-6 items-start\">\n                                    <div className={`w-10 h-10 rounded-full font-black flex items-center justify-center border flex-shrink-0 mt-1 ${darkMode ? 'bg-orange-900/20 text-orange-400 border-orange-500/20' : 'bg-orange-100 text-orange-600 border-orange-200'}`}>\n                                        {idx + 1}\n                                    </div>\n                                    <div>\n                                        <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-900'}`}>{step.title}</h3>\n                                        <p className={`leading-relaxed ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{step.text}</p>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {view === 'privacy' && (\n                    <div className=\"max-w-4xl mx-auto pt-10 px-6 animate-fade-up pb-20\">\n                        <button onClick={() => setView('store')} className={`mb-8 p-3 rounded-full transition ${darkMode ? 'bg-slate-900 text-slate-400 hover:text-white' : 'bg-slate-100 text-slate-600 hover:text-slate-900'}`}><ArrowLeft /></button>\n                        <h2 className={`text-4xl md:text-5xl font-black mb-12 flex items-center gap-4 ${darkMode ? 'text-white neon-text' : 'text-slate-900'}`}>\n                            <Shield className=\"text-orange-500 w-12 h-12\" /> Pol√≠tica de Privacidad\n                        </h2>\n                        <div className={`border p-8 md:p-12 rounded-[3rem] shadow-2xl space-y-8 max-h-[70vh] overflow-y-auto custom-scrollbar ${darkMode ? 'bg-[#0a0a0a] border-slate-800 text-slate-300' : 'bg-white border-slate-200 text-slate-600'}`}>\n                            <div className=\"prose prose-invert max-w-none\">\n                                <p className={`text-sm mb-8 italic ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>√öltima actualizaci√≥n: 07 de enero de 2026</p>\n\n                                <p>Este Aviso de Privacidad para <strong>{settings?.storeName || 'Sustore'}</strong> (\"nosotros\", \"nos\" o \"nuestro\"), describe c√≥mo y por qu√© podr√≠amos acceder, recopilar, almacenar, usar y/o compartir (\"proceso\") su informaci√≥n personal cuando utiliza nuestros servicios (\"Servicios\"), incluso cuando:</p>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Visita nuestro sitio web en <a href=\"https://sustore.vercel.app\" className=\"text-orange-500 hover:underline\">https://sustore.vercel.app</a> o cualquier sitio web nuestro que enlace a este Aviso de Privacidad.</li>\n                                    <li>Interact√∫e con nosotros de otras maneras relacionadas, incluido cualquier marketing o evento.</li>\n                                </ul>\n\n                                <div className={`p-6 rounded-2xl border my-8 ${darkMode ? 'bg-slate-900/50 border-slate-800 text-slate-300' : 'bg-slate-50 border-slate-200 text-slate-700'}`}>\n                                    <h3 className={`text-xl font-bold mb-4 ${darkMode ? 'text-white' : 'text-slate-900'}`}>RESUMEN DE PUNTOS CLAVE</h3>\n                                    <ul className=\"space-y-4 text-sm\">\n                                        <li><strong>¬øQu√© informaci√≥n personal procesamos?</strong> Informaci√≥n proporcionada al registrarse o comprar.</li>\n                                        <li><strong>¬øProcesamos informaci√≥n confidencial?</strong> No.</li>\n                                        <li><strong>¬øRecopilamos informaci√≥n de terceros?</strong> No.</li>\n                                        <li><strong>¬øC√≥mo procesamos su informaci√≥n?</strong> Para gestionar pedidos, seguridad y mejora del servicio.</li>\n                                        <li><strong>¬øCompartimos informaci√≥n?</strong> Solo en situaciones espec√≠ficas como transferencias comerciales o requisitos legales.</li>\n                                    </ul>\n                                </div>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>1. ¬øQU√â INFORMACI√ìN RECOPILAMOS?</h3>\n                                <p>Recopilamos informaci√≥n que usted nos proporciona voluntariamente: nombres, tel√©fonos, emails, direcciones, nombres de usuario y contrase√±as.</p>\n                                <p>Tambi√©n recopilamos datos t√©cnicos autom√°ticamente (IP, tipo de navegador) para seguridad y an√°lisis del sitio.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>2. ¬øC√ìMO PROCESAMOS TU INFORMACI√ìN?</h3>\n                                <ul className=\"list-disc pl-5 space-y-2\">\n                                    <li>Facilitar creaci√≥n y administraci√≥n de cuentas.</li>\n                                    <li>Gestionar pedidos, pagos y env√≠os.</li>\n                                    <li>Proteger nuestros servicios contra fraude.</li>\n                                    <li>Evaluar y mejorar la experiencia del usuario.</li>\n                                </ul>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>3. ¬øCU√ÅNTO TIEMPO CONSERVAMOS TU INFORMACI√ìN?</h3>\n                                <p>Conservamos su informaci√≥n mientras tenga una cuenta activa con nosotros o seg√∫n lo exija la ley para fines contables o legales.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>4. ¬øCU√ÅLES SON SUS DERECHOS?</h3>\n                                <p>Puede revisar, cambiar o cancelar su cuenta en cualquier momento desde su perfil o contact√°ndonos directamente.</p>\n\n                                <h3 className={`text-xl font-bold mt-12 mb-4 border-b pb-2 ${darkMode ? 'text-white border-slate-800' : 'text-slate-900 border-slate-200'}`}>5. CONTACTO</h3>\n                                <p>Para preguntas sobre este aviso, puede escribirnos a:</p>\n                                <div className={`p-6 rounded-xl border font-mono text-sm leading-relaxed ${darkMode ? 'bg-slate-950 border-slate-800' : 'bg-white border-slate-200 shadow-sm'}`}>\n                                    <strong>{settings?.storeName || 'Sustore'}</strong><br />\n                                    Saavedra 7568<br />\n                                    Santa Fe, 3000<br />\n                                    Argentina<br />\n                                    <a href={`https://mail.google.com/mail/?view=cm&fs=1&to=${settings?.sellerEmail}`} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-orange-500 hover:underline\">{settings?.sellerEmail || '[Email de contacto]'}</a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                {/* 7. PANEL DE ADMINISTRACI√ìN (COMPLETO Y DETALLADO) */}\n                {view === 'admin' && (\n                    // === Verificaci√≥n de carga antes de verificar acceso ===\n                    // Si los settings no est√°n cargados o el rol est√° indeterminado, mostrar loading\n                    (!settingsLoaded || isRoleLoading(currentUser?.email)) ? (\n                        <div className=\"min-h-screen bg-[#050505] flex items-center justify-center\">\n                            <div className=\"text-center\">\n                                <div className=\"relative\">\n                                    <div className=\"w-16 h-16 rounded-full border-4 border-slate-800 animate-spin\" style={{ borderTopColor: '#f97316' }}></div>\n                                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                                        <Shield className=\"w-6 h-6 text-orange-500 animate-pulse\" />\n                                    </div>\n                                </div>\n                                <p className=\"text-slate-500 text-xs mt-4 font-mono uppercase tracking-widest\">Verificando permisos...</p>\n                            </div>\n                        </div>\n                    ) :\n                        // === SEGURIDAD: Triple verificaci√≥n de acceso ===\n                        // 1. Verificar que tiene permisos por rol\n                        // 2. Verificar que el usuario tiene un ID v√°lido\n                        // 3. Verificar que la sesi√≥n no fue manipulada\n                        (hasAccess(currentUser?.email) &&\n                            currentUser?.id &&\n                            currentUser?.id.length >= 10 &&\n                            !SecurityManager.detectManipulation()) ? (\n                            <div className=\"flex min-h-screen min-full-viewport bg-[#050505] overflow-hidden animate-fade-up relative w-full font-sans\">\n\n                                {/* Overlay para cerrar el men√∫ en m√≥vil */}\n                                {isAdminMenuOpen && (\n                                    <div\n                                        className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-30 md:hidden animate-fade-in\"\n                                        onClick={() => setIsAdminMenuOpen(false)}\n                                    />\n                                )}\n\n                                {/* 7.1 Sidebar Admin */}\n                                <div className={`fixed inset-y-0 left-0 z-40 w-[280px] bg-[#0a0a0a] border-r border-slate-800 flex flex-col transition-transform duration-300 ease-out ${isAdminMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'} md:static md:w-72 shadow-2xl`}>\n                                    <div className=\"p-6 md:p-8 border-b border-slate-900 flex items-center justify-between\">\n                                        <div>\n                                            <h2 className=\"text-xl md:text-2xl font-black text-white tracking-tight flex items-center gap-3\">\n                                                <div className=\"w-9 h-9 md:w-10 md:h-10 bg-orange-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-orange-900/20\">\n                                                    <Shield className=\"w-5 h-5 md:w-6 md:h-6\" />\n                                                </div>\n                                                ADMIN\n                                            </h2>\n                                            <p className=\"text-[10px] md:text-xs text-slate-500 mt-1.5 font-mono ml-1\">v3.0.0 PRO</p>\n                                        </div>\n                                        {/* Bot√≥n cerrar en m√≥vil */}\n                                        <button\n                                            onClick={() => setIsAdminMenuOpen(false)}\n                                            className=\"md:hidden p-2 bg-slate-900 hover:bg-slate-800 rounded-xl text-slate-400 hover:text-white transition border border-slate-800\"\n                                        >\n                                            <X className=\"w-5 h-5\" />\n                                        </button>\n                                    </div>\n\n                                    <nav className=\"flex-1 p-3 md:p-4 space-y-1.5 md:space-y-2 overflow-y-auto custom-scrollbar\">\n                                        <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-1\">Principal</p>\n\n                                        <button onClick={() => { setAdminTab('dashboard'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'dashboard' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <LayoutDashboard className=\"w-5 h-5\" /> Inicio\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('orders'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'orders' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <ShoppingBag className=\"w-5 h-5\" /> Pedidos\n                                            {isAdminUser && hasUnseenOrders && (\n                                                <span className=\"ml-auto text-[10px] px-2 py-1 rounded-full bg-red-900/30 text-red-300 border border-red-500/30 font-black uppercase tracking-widest\">\n                                                    Nuevo\n                                                </span>\n                                            )}\n                                        </button>\n\n                                        <button onClick={() => { setAdminTab('products'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'products' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                            <Package className=\"w-5 h-5\" /> Productos\n                                        </button>\n\n                                        {/* Promos - Available for editors and admins */}\n                                        {(isAdmin(currentUser?.email) || isEditor(currentUser?.email)) && (\n                                            <button onClick={() => { setAdminTab('promos'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'promos' ? 'bg-purple-900/20 text-purple-400 border border-purple-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                <Tag className=\"w-5 h-5\" /> Promos\n                                            </button>\n                                        )}\n\n                                        {isAdmin(currentUser?.email) && (\n                                            <>\n                                                <p className=\"text-[10px] font-black text-slate-600 uppercase tracking-widest px-3 md:px-4 py-2 mt-4 md:mt-6\">Gesti√≥n</p>\n\n                                                <button onClick={() => { setAdminTab('coupons'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'coupons' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Ticket className=\"w-5 h-5\" /> Cupones\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('suppliers'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'suppliers' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Truck className=\"w-5 h-5\" /> Proveedores\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('purchases'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'purchases' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <ShoppingCart className=\"w-5 h-5\" /> Compras\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('finance'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'finance' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Wallet className=\"w-5 h-5\" /> Finanzas\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('settings'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'settings' ? 'bg-orange-900/20 text-orange-400 border border-orange-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Settings className=\"w-5 h-5\" /> Configuraci√≥n\n                                                </button>\n\n                                                <button onClick={() => { setAdminTab('users'); setIsAdminMenuOpen(false); }} className={`w-full text-left px-4 md:px-5 py-3 md:py-3.5 rounded-xl flex items-center gap-3 font-bold text-sm transition ${adminTab === 'users' ? 'bg-pink-900/20 text-pink-400 border border-pink-900/30' : 'text-slate-400 hover:text-white hover:bg-slate-900'}`}>\n                                                    <Users className=\"w-5 h-5\" /> Usuarios\n                                                </button>\n                                            </>\n                                        )}\n                                    </nav>\n\n                                    <div className=\"p-4 md:p-6 border-t border-slate-900\">\n                                        <button onClick={() => { setView('store'); setIsAdminMenuOpen(false); }} className=\"w-full py-3.5 md:py-4 bg-slate-900 rounded-xl text-slate-400 hover:text-white hover:bg-slate-800 transition font-bold text-sm flex items-center justify-center gap-2 group border border-slate-800\">\n                                            <LogOut className=\"w-4 h-4 group-hover:-translate-x-1 transition\" /> Volver a Tienda\n                                        </button>\n                                    </div>\n                                </div>\n\n                                {/* 7.2 Contenido Principal Admin */}\n                                <div className=\"flex-1 bg-[#050505] overflow-y-auto relative w-full p-4 md:p-10 custom-scrollbar\">\n                                    <button onClick={() => setIsAdminMenuOpen(true)} className=\"md:hidden mb-4 p-3 bg-slate-900 hover:bg-slate-800 rounded-xl text-white border border-slate-800 flex items-center gap-2 font-bold text-sm transition\">\n                                        <Menu className=\"w-5 h-5\" /> Men√∫\n                                    </button>\n\n                                    {/* TAB: DASHBOARD */}\n                                    {adminTab === 'dashboard' && (\n                                        <div className=\"max-w-[1600px] mx-auto animate-fade-up space-y-8 pb-20\">\n                                            <ManualSaleModal />\n                                            <MetricsDetailModal />\n                                            {/* Modales Admin Users */}\n\n\n                                            <div className=\"flex flex-col md:flex-row justify-between items-end mb-4 gap-4\">\n                                                <div>\n                                                    <h1 className=\"text-4xl font-black text-white neon-text\">Panel de Control</h1>\n                                                    <p className=\"text-slate-500 mt-2\">Resumen administrativo y financiero.</p>\n                                                </div>\n                                                <div className=\"flex items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"dashboard\" />\n                                                    <div className=\"hidden md:block bg-slate-900 px-4 py-2 rounded-lg text-xs text-slate-400 font-mono border border-slate-800\">\n                                                        {new Date().toLocaleDateString('es-AR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 1: ANAL√çTICA FINANCIERA (Lista Gr√°fica) */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                {/* INGRESOS BRUTOS */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-green-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Ingresos Brutos</p>\n                                                            <h2 className=\"text-4xl font-black text-white tracking-tighter\">${dashboardMetrics.revenue.toLocaleString()}</h2>\n                                                        </div>\n                                                        <div className=\"p-4 bg-green-900/20 text-green-400 rounded-2xl\">\n                                                            <DollarSign className=\"w-8 h-8\" />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gr√°fica (Ultimos 6 meses) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Rendimiento Mensual</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            const maxRev = Math.max(...dashboardMetrics.analytics.monthly.map(x => x.revenue));\n                                                            const percentage = maxRev > 0 ? (m.revenue / maxRev) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-white font-bold\">${m.revenue.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div\n                                                                            className=\"h-full bg-gradient-to-r from-green-600 to-emerald-400 rounded-full transition-all duration-1000 group-hover/item:brightness-125\"\n                                                                            style={{ width: `${percentage}%` }}\n                                                                        ></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n\n                                                {/* BENEFICIO NETO */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-orange-500/30 transition\">\n                                                    <div className=\"flex justify-between items-center mb-6\">\n                                                        <div>\n                                                            <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-1\">Beneficio Neto (Estimado)</p>\n                                                            <h2 className={`text-4xl font-black tracking-tighter ${dashboardMetrics.netIncome >= 0 ? 'text-orange-400' : 'text-red-500'}`}>\n                                                                ${dashboardMetrics.netIncome.toLocaleString()}\n                                                            </h2>\n                                                        </div>\n                                                        <div className={`p-4 rounded-2xl ${dashboardMetrics.netIncome >= 0 ? 'bg-orange-900/20 text-orange-400' : 'bg-red-900/20 text-red-500'}`}>\n                                                            {dashboardMetrics.netIncome >= 0 ? <TrendingUp className=\"w-8 h-8\" /> : <TrendingDown className=\"w-8 h-8\" />}\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Lista Gr√°fica (Comparativa Ingreso vs Gasto) */}\n                                                    <div className=\"space-y-4 mt-8 border-t border-slate-800 pt-6\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Ingresos vs Gastos (√öltimos Meses)</p>\n                                                        {dashboardMetrics.analytics.monthly.slice(-6).reverse().map((m, i) => {\n                                                            // Estimaci√≥n simplificada de gastos mensuales (proporcional solo para visualizaci√≥n si no hay data exacta mensual de gastos guardada historica)\n                                                            // En una real app, se calcular√≠a real desde expenses.\n                                                            // Como `expenses` tiene fecha, podemos calcularlo.\n                                                            const monthExpenses = expenses.filter(e => e.date.startsWith(m.date)).reduce((acc, c) => acc + c.amount, 0)\n                                                                + (purchases || []).filter(p => p.date.startsWith(m.date)).reduce((acc, c) => acc + c.cost, 0);\n\n                                                            const totalVol = m.revenue + monthExpenses;\n                                                            const revPct = totalVol > 0 ? (m.revenue / totalVol) * 100 : 0;\n\n                                                            return (\n                                                                <div key={i} className=\"group/item\">\n                                                                    <div className=\"flex justify-between text-xs mb-1\">\n                                                                        <span className=\"text-slate-400 font-mono\">{m.date}</span>\n                                                                        <span className=\"text-orange-400 font-bold\">+${(m.revenue - monthExpenses).toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex h-2 bg-slate-800 rounded-full overflow-hidden w-full\">\n                                                                        <div title={`Ingresos: $${m.revenue}`} className=\"h-full bg-orange-500 transition-all duration-1000\" style={{ width: `${revPct}%` }}></div>\n                                                                        <div title={`Gastos: $${monthExpenses}`} className=\"h-full bg-red-500 transition-all duration-1000\" style={{ width: `${100 - revPct}%` }}></div>\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                        {dashboardMetrics.analytics.monthly.length === 0 && <p className=\"text-slate-600 text-xs\">Sin datos suficientes.</p>}\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 2: KPIs R√ÅPIDOS */}\n                                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Usuarios Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalUsers}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Pedidos Totales</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">{dashboardMetrics.totalOrders}</p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Ticket Promedio</p>\n                                                    <p className=\"text-white font-black text-2xl text-center mt-1\">\n                                                        ${dashboardMetrics.totalOrders > 0 ? Math.round(dashboardMetrics.revenue / dashboardMetrics.totalOrders).toLocaleString() : 0}\n                                                    </p>\n                                                </div>\n                                                <div className=\"bg-slate-900/30 p-4 rounded-2xl border border-slate-800\">\n                                                    <p className=\"text-slate-500 text-[10px] uppercase font-bold text-center\">Stock Bajo</p>\n                                                    <p className={`font-black text-2xl text-center mt-1 ${dashboardMetrics.lowStockProducts.length > 0 ? 'text-red-500' : 'text-green-500'}`}>\n                                                        {dashboardMetrics.lowStockProducts.length}\n                                                    </p>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 2.5: MEJORES Y PEORES (NUEVO) */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                {/* BEST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-yellow-500/30 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <Star className=\"w-32 h-32 text-yellow-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <Star className=\"w-4 h-4 text-yellow-500\" /> Producto Estrella\n                                                    </p>\n                                                    {dashboardMetrics.starProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg flex-shrink-0\">\n                                                                <img src={dashboardMetrics.starProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.starProduct.name}</h3>\n                                                                <p className=\"text-yellow-400 font-bold text-lg\">{dashboardMetrics.starProduct.sales} Und. vendidas</p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Stock actual: {dashboardMetrics.starProduct.stock}</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">No hay datos de ventas a√∫n.</p>\n                                                    )}\n                                                </div>\n\n                                                {/* WORST SELLER */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] relative overflow-hidden group hover:border-slate-600 transition\">\n                                                    <div className=\"absolute top-0 right-0 p-8 opacity-10 pointer-events-none\">\n                                                        <AlertCircle className=\"w-32 h-32 text-slate-500\" />\n                                                    </div>\n                                                    <p className=\"text-slate-500 font-black text-xs tracking-widest uppercase mb-4 flex items-center gap-2\">\n                                                        <TrendingDown className=\"w-4 h-4 text-slate-500\" /> Menos Vendido (En Stock)\n                                                    </p>\n                                                    {dashboardMetrics.leastSoldProduct ? (\n                                                        <div className=\"flex items-center gap-6 relative z-10\">\n                                                            <div className=\"w-24 h-24 bg-white rounded-2xl p-2 shadow-lg grayscale flex-shrink-0\">\n                                                                <img src={dashboardMetrics.leastSoldProduct.image} className=\"w-full h-full object-contain\" />\n                                                            </div>\n                                                            <div>\n                                                                <h3 className=\"text-xl font-black text-white leading-tight mb-1\">{dashboardMetrics.leastSoldProduct.name}</h3>\n                                                                <p className=\"text-slate-400 font-bold text-lg\">\n                                                                    {dashboardMetrics.salesCount[dashboardMetrics.leastSoldProduct.id] || 0} Und. vendidas\n                                                                </p>\n                                                                <p className=\"text-slate-500 text-xs mt-1\">Hay que rotar este stock.</p>\n                                                            </div>\n                                                        </div>\n                                                    ) : (\n                                                        <p className=\"text-slate-600\">Todos los productos tienen buena rotaci√≥n.</p>\n                                                    )}\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN 3: LIBRO MAYOR (REGISTRO ADMINISTRATIVO) */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 overflow-hidden shadow-2xl\">\n                                                <h3 className=\"text-xl font-black text-white mb-6 flex items-center gap-2\">\n                                                    <FileText className=\"w-6 h-6 text-purple-400\" /> Registro de Movimientos\n                                                </h3>\n\n                                                <div className=\"overflow-x-auto\">\n                                                    <table className=\"w-full text-left border-collapse\">\n                                                        <thead>\n                                                            <tr className=\"text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-slate-800\">\n                                                                <th className=\"pb-4 pl-4\">Fecha</th>\n                                                                <th className=\"pb-4\">Tipo</th>\n                                                                <th className=\"pb-4\">Concepto</th>\n                                                                <th className=\"pb-4\">Estado</th>\n                                                                <th className=\"pb-4 text-right pr-4\">Monto</th>\n                                                            </tr>\n                                                        </thead>\n                                                        <tbody className=\"text-sm font-medium\">\n                                                            {dashboardMetrics.transactions.map((t, idx) => (\n                                                                <tr key={`${t.type}-${idx}`} className=\"border-b border-slate-800/50 hover:bg-slate-900/20 transition group\">\n                                                                    <td className=\"py-4 pl-4 text-slate-400 font-mono text-xs\">{new Date(t.date).toLocaleDateString()}</td>\n                                                                    <td className=\"py-4\">\n                                                                        <span className={`px-2 py-1 rounded text-[10px] font-black uppercase tracking-wider ${t.type === 'income' ? 'bg-green-900/20 text-green-400 border border-green-500/20' : 'bg-red-900/20 text-red-400 border border-red-500/20'\n                                                                            }`}>\n                                                                            {t.category}\n                                                                        </span>\n                                                                    </td>\n                                                                    <td className=\"py-4 text-white group-hover:text-purple-300 transition\">\n                                                                        {t.description}\n                                                                    </td>\n                                                                    <td className=\"py-4 text-xs text-slate-500\">\n                                                                        {t.status}\n                                                                    </td>\n                                                                    <td className={`py-4 text-right pr-4 font-mono font-bold ${t.type === 'income' ? 'text-green-400' : 'text-red-400'}`}>\n                                                                        {t.type === 'income' ? '+' : '-'}${t.amount.toLocaleString()}\n                                                                    </td>\n                                                                </tr>\n                                                            ))}\n                                                            {dashboardMetrics.transactions.length === 0 && (\n                                                                <tr><td colSpan=\"5\" className=\"text-center py-8 text-slate-500\">Sin movimientos registrados.</td></tr>\n                                                            )}\n                                                        </tbody>\n                                                    </table>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CONFIGURACI√ìN (BLINDADA) - REMOVED (Consolidated in main Settings tab below) */}\n\n\n                                    {/* TAB: PROVEEDORES (CON SELECTOR VISUAL) */}\n                                    {adminTab === 'suppliers' && (\n                                        <div className=\"max-w-6xl mx-auto space-y-8 animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n                                                <h1 className=\"text-3xl font-black text-white\">Proveedores</h1>\n                                                <div className=\"flex items-center gap-2\">\n                                                    <AdminHowToUse guideKey=\"suppliers\" />\n                                                    <button onClick={() => { setNewSupplier({ name: '', contact: '', phone: '', ig: '', address: '', cuit: '', associatedProducts: [] }); setEditingSupplierId(null); setShowSupplierModal(true); }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:-translate-y-1\">\n                                                        <Plus className=\"w-5 h-5\" /> Nuevo Proveedor\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {suppliers.map((s, idx) => (\n                                                    <div key={s.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-[2rem] hover:border-slate-600 transition duration-300 group animate-fade-up\">\n                                                        <div className=\"flex justify-between items-start mb-6\">\n                                                            <div className=\"p-4 bg-slate-900 rounded-xl text-slate-400 group-hover:text-orange-400 transition group-hover:bg-orange-900/20\">\n                                                                <Truck className=\"w-8 h-8\" />\n                                                            </div>\n                                                            <div className=\"flex gap-2\">\n                                                                <button\n                                                                    onClick={() => { setNewSupplier(s); setEditingSupplierId(s.id); setShowSupplierModal(true); }}\n                                                                    className=\"text-slate-600 hover:text-orange-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Editar\"\n                                                                >\n                                                                    <Edit className=\"w-5 h-5\" />\n                                                                </button>\n                                                                <button\n                                                                    onClick={() => openConfirm(\"Eliminar Proveedor\", \"¬øEliminar proveedor?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'suppliers', s.id)))}\n                                                                    className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-900 rounded-lg transition\"\n                                                                    title=\"Eliminar\"\n                                                                >\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n\n                                                        <h3 className=\"text-2xl font-bold text-white mb-2\">{s.name}</h3>\n\n                                                        <div className=\"space-y-3 mb-6 p-4 bg-slate-900/30 rounded-xl border border-slate-800/50\">\n                                                            <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                <User className=\"w-4 h-4 text-slate-500\" /> {s.contact}\n                                                            </p>\n                                                            {s.phone && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Phone className=\"w-4 h-4 text-slate-500\" /> {s.phone}\n                                                                </p>\n                                                            )}\n                                                            {s.ig && (\n                                                                <p className=\"text-slate-400 text-sm flex items-center gap-3\">\n                                                                    <Instagram className=\"w-4 h-4 text-slate-500\" /> {s.ig}\n                                                                </p>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"pt-4 border-t border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase mb-3 tracking-wider\">Productos Suministrados</p>\n                                                            <div className=\"flex flex-wrap gap-2\">\n                                                                {(s.associatedProducts && s.associatedProducts.length > 0) ? (\n                                                                    s.associatedProducts.map(pid => {\n                                                                        const p = products.find(prod => prod.id === pid);\n                                                                        if (!p) return null;\n                                                                        return (\n                                                                            <div key={pid} className=\"w-10 h-10 rounded-lg bg-white p-1 flex items-center justify-center border border-slate-600 tooltip-container\" title={p.name}>\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                ) : (\n                                                                    <span className=\"text-xs text-slate-600 italic\">No hay productos asignados</span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: COMPRAS (STOCK) */}\n                                    {adminTab === 'purchases' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Stock y Compras</h1>\n                                                <AdminHowToUse guideKey=\"purchases\" />\n                                            </div>\n\n                                            {/* Formulario de Compra Unificado */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] mb-10 shadow-xl overflow-hidden relative\">\n\n                                                {/* Header / Solo Reposici√≥n de Stock */}\n                                                <div className=\"flex border-b border-slate-800\">\n                                                    <div className=\"flex-1 p-6 text-center font-bold tracking-wider bg-orange-900/20 text-orange-400\">\n                                                        <Package className=\"w-5 h-5 inline-block mr-2\" /> REGISTRAR REPOSICI√ìN DE STOCK\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"p-8\">\n                                                    {(() => {\n                                                        const selectedProduct = products.find(p => p.id === newPurchase.productId);\n                                                        const productPrice = selectedProduct?.purchasePrice || selectedProduct?.basePrice || 0;\n                                                        const autoCost = productPrice * newPurchase.quantity;\n\n                                                        return (\n                                                            <div className=\"space-y-6 animate-fade-in\">\n                                                                {/* Preview del Producto Seleccionado (REMOVIDO de aqu√≠ para moverlo junto al input) */}\n\n                                                                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                                    <div className=\"md:col-span-2\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Producto Existente</label>\n                                                                        <div className=\"flex gap-4 items-center\">\n                                                                            {selectedProduct && (\n                                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                                    <img src={selectedProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                                </div>\n                                                                            )}\n                                                                            <div className=\"flex-1\">\n                                                                                <select className=\"input-cyber w-full p-4\" value={newPurchase.productId} onChange={e => setNewPurchase({ ...newPurchase, productId: e.target.value })}>\n                                                                                    <option value=\"\">Seleccionar Producto...</option>\n                                                                                    {products.map(p => (\n                                                                                        <option key={p.id} value={p.id}>\n                                                                                            {p.name} (Stock: {isNaN(Number(p.stock)) ? 0 : p.stock})\n                                                                                        </option>\n                                                                                    ))}\n                                                                                </select>\n                                                                                {selectedProduct && (\n                                                                                    <p className=\"text-xs text-orange-400 mt-2 font-bold\">\n                                                                                        Stock Actual: {isNaN(Number(selectedProduct.stock)) ? 0 : selectedProduct.stock} | Costo Total Estimado: ${autoCost.toLocaleString()}\n                                                                                    </p>\n                                                                                )}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    <div>\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cantidad</label>\n                                                                        <input type=\"number\" className=\"input-cyber w-full p-4\" placeholder=\"0\" value={newPurchase.quantity} onChange={e => setNewPurchase({ ...newPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                                    </div>\n                                                                    <div className=\"md:col-span-3\">\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Proveedor</label>\n                                                                        <select className=\"input-cyber w-full p-4\" value={newPurchase.supplierId} onChange={e => setNewPurchase({ ...newPurchase, supplierId: e.target.value })}>\n                                                                            <option value=\"\">Seleccionar...</option>\n                                                                            {suppliers.map(s => <option key={s.id} value={s.id}>{s.name}</option>)}\n                                                                        </select>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        )\n                                                    })()}\n\n\n                                                    <button\n                                                        onClick={async () => {\n                                                            // Validaciones\n                                                            if (!newPurchase.productId) return showToast(\"Selecciona un producto existente.\", \"warning\");\n                                                            if (newPurchase.quantity <= 0) return showToast(\"La cantidad debe ser mayor a 0.\", \"warning\");\n                                                            if (newPurchase.cost < 0) return showToast(\"El costo no puede ser negativo.\", \"warning\");\n\n                                                            try {\n                                                                const selectedProd = products.find(p => p.id === newPurchase.productId);\n                                                                const targetProductName = selectedProd?.name || \"Desconocido\";\n\n                                                                // Auto-calcular costo: precio de compra √ó cantidad\n                                                                const productPrice = selectedProd?.purchasePrice || selectedProd?.basePrice || 0;\n                                                                const calculatedCost = productPrice * newPurchase.quantity;\n\n                                                                // REGISTRAR COMPRA\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'purchases'), {\n                                                                    productId: newPurchase.productId,\n                                                                    supplierId: newPurchase.supplierId || '',\n                                                                    quantity: newPurchase.quantity,\n                                                                    cost: calculatedCost,\n                                                                    date: new Date().toISOString()\n                                                                });\n\n                                                                // ACTUALIZAR STOCK\n                                                                const currentStock = isNaN(Number(selectedProd?.stock)) ? 0 : Number(selectedProd.stock);\n                                                                const newStock = currentStock + newPurchase.quantity;\n\n                                                                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', newPurchase.productId), {\n                                                                    stock: newStock\n                                                                });\n\n                                                                // Resetear Formulario\n                                                                setNewPurchase({\n                                                                    isNewProduct: false, productId: '', supplierId: '', quantity: 1, cost: 0,\n                                                                    newProdName: '', newProdPrice: 0, newProdImage: '', newProdCategory: ''\n                                                                });\n                                                                showToast(`Compra de \"${targetProductName}\" registrada exitosamente.`, \"success\");\n\n                                                            } catch (e) {\n                                                                console.error(\"Error stock update:\", e);\n                                                                showToast(\"Error: \" + (e.message || \"Operaci√≥n fallida\"), \"error\");\n                                                            }\n                                                        }}\n                                                        className=\"w-full mt-8 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-black py-5 rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <Save className=\"w-6 h-6\" /> REGISTRAR REPOSICI√ìN DE STOCK\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* CARRITO DE COMPRAS */}\n                                            {purchaseCart.length > 0 && (\n                                                <div className=\"bg-gradient-to-br from-orange-900/20 to-red-900/20 border border-orange-800 rounded-[2.5rem] p-8 mb-10 animate-fade-up\">\n                                                    <div className=\"flex items-center justify-between mb-6\">\n                                                        <h3 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <ShoppingCart className=\"w-6 h-6 text-orange-400\" />\n                                                            Carrito de Compras ({purchaseCart.length} {purchaseCart.length === 1 ? 'producto' : 'productos'})\n                                                        </h3>\n                                                        <p className=\"text-orange-400 font-black text-2xl\">\n                                                            TOTAL: ${purchaseCart.reduce((acc, item) => acc + item.cost, 0).toLocaleString()}\n                                                        </p>\n                                                    </div>\n\n                                                    <div className=\"space-y-4 mb-6\">\n                                                        {purchaseCart.map((item, index) => (\n                                                            <div key={index} className=\"flex items-center gap-6 bg-slate-900/50 p-4 rounded-xl border border-slate-700\">\n                                                                <div className=\"w-16 h-16 bg-white rounded-lg p-1 flex-shrink-0\">\n                                                                    <img src={item.productImage} className=\"w-full h-full object-contain\" alt={item.productName} />\n                                                                </div>\n                                                                <div className=\"flex-1\">\n                                                                    <p className=\"font-bold text-white\">{item.productName}</p>\n                                                                    <p className=\"text-xs text-slate-400\">Precio Unit.: ${item.unitPrice.toLocaleString()}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-3\">\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        value={item.quantity}\n                                                                        onChange={(e) => updatePurchaseCartItem(index, parseInt(e.target.value) || 1)}\n                                                                        className=\"w-20 bg-slate-800 border border-slate-700 text-white px-3 py-2 rounded-lg text-center font-bold\"\n                                                                        min=\"1\"\n                                                                    />\n                                                                    <p className=\"text-orange-400 font-bold w-28 text-right\">${item.cost.toLocaleString()}</p>\n                                                                    <button\n                                                                        onClick={() => removeFromPurchaseCart(index)}\n                                                                        className=\"p-2 bg-red-900/20 hover:bg-red-900/40 text-red-400 rounded-lg transition\"\n                                                                    >\n                                                                        <Trash2 className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        ))}\n                                                    </div>\n\n                                                    <button\n                                                        onClick={finalizePurchaseOrder}\n                                                        className=\"w-full py-5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-black rounded-2xl shadow-xl transition transform hover:scale-[1.01] flex items-center justify-center gap-3 text-lg\"\n                                                    >\n                                                        <CheckCircle className=\"w-6 h-6\" /> FINALIZAR PEDIDO\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Historial */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6\">Historial de Compras</h3>\n                                                <div className=\"space-y-4\">\n                                                    {purchases.sort((a, b) => new Date(b.date) - new Date(a.date)).map((p, idx) => {\n                                                        const prod = products.find(prod => prod.id === p.productId);\n                                                        const sup = suppliers.find(s => s.id === p.supplierId);\n                                                        return (\n                                                            <div key={p.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"flex justify-between items-center bg-slate-900/40 p-4 rounded-xl border border-slate-800 hover:border-slate-600 transition group animate-fade-up\">\n                                                                <div className=\"flex items-center gap-4 flex-1\">\n                                                                    {/* Image Preview */}\n                                                                    <div className=\"w-12 h-12 bg-white rounded-lg p-1 flex-shrink-0 border border-slate-700\">\n                                                                        {prod?.image ? (\n                                                                            <img src={prod.image} className=\"w-full h-full object-contain\" alt={prod.name} />\n                                                                        ) : (\n                                                                            <Package className=\"w-full h-full text-slate-400 p-2\" />\n                                                                        )}\n                                                                    </div>\n\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white flex items-center gap-2\">\n                                                                            {prod?.name || 'Producto Eliminado'}\n                                                                            <span className=\"text-[10px] bg-slate-800 px-2 py-0.5 rounded text-slate-400\">STOCK ACTUAL: {prod?.stock || 0}</span>\n                                                                        </p>\n                                                                        <p className=\"text-xs text-slate-500\">{new Date(p.date).toLocaleDateString()} {sup ? `- Prov: ${sup.name}` : ''}</p>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex items-center gap-6\">\n                                                                    <div className=\"text-right\">\n                                                                        <p className=\"text-orange-400 font-bold\">+{p.quantity} u.</p>\n                                                                        <p className=\"text-slate-400 text-xs font-mono\">${(p.cost || 0).toLocaleString()}</p>\n                                                                    </div>\n                                                                    <div className=\"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                                                                        <button onClick={() => setEditingPurchase(p)} className=\"p-2 bg-slate-800 hover:bg-blue-900/30 text-slate-400 hover:text-blue-400 rounded-lg transition\">\n                                                                            <Edit className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                        <button onClick={() => deletePurchaseFn(p)} className=\"p-2 bg-slate-800 hover:bg-red-900/30 text-slate-400 hover:text-red-400 rounded-lg transition\">\n                                                                            <Trash2 className=\"w-4 h-4\" />\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        );\n                                                    })}\n                                                </div>\n                                            </div>\n\n                                            {/* Modal Edici√≥n Compra */}\n                                            {editingPurchase && (\n                                                <div className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-in\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-700 rounded-3xl p-8 w-full max-w-lg shadow-2xl relative\">\n                                                        <button onClick={() => setEditingPurchase(null)} className=\"absolute top-4 right-4 p-2 text-slate-500 hover:text-white\"><X className=\"w-6 h-6\" /></button>\n                                                        <h3 className=\"text-2xl font-bold text-white mb-6\">Editar Compra</h3>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Cantidad comprada</label>\n                                                                <div className=\"text-xs text-yellow-500 mb-2\">‚ö† Modificar esto ajustar√° el stock del producto autom√°ticamente.</div>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.quantity} onChange={e => setEditingPurchase({ ...editingPurchase, quantity: parseInt(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase block mb-1\">Costo Total ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-3\" value={editingPurchase.cost} onChange={e => setEditingPurchase({ ...editingPurchase, cost: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => {\n                                                                const original = purchases.find(x => x.id === editingPurchase.id);\n                                                                if (original) updatePurchaseFn(editingPurchase.id, original, editingPurchase);\n                                                            }}\n                                                            className=\"w-full mt-6 bg-orange-600 hover:bg-orange-500 text-white font-bold py-3 rounded-xl transition shadow-lg\"\n                                                        >\n                                                            Guardar Cambios\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: FINANZAS (GASTOS E INVERSIONES) */}\n                                    {adminTab === 'finance' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-4xl font-black text-white neon-text\">Finanzas y Capital</h1>\n                                                <AdminHowToUse guideKey=\"finance\" />\n                                            </div>\n\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* SECCI√ìN: REGISTRAR INVERSI√ìN (NUEVO) */}\n                                                <div className=\"bg-[#0a0a0a] border border-orange-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <TrendingUp className=\"w-5 h-5 text-orange-400\" /> Registrar Inversi√≥n / Aporte\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Inversor (Socio)</label>\n                                                            <div className=\"relative\">\n                                                                <Users className=\"absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500 w-4 h-4\" />\n                                                                <select\n                                                                    className=\"input-cyber w-full pl-12 p-4 appearance-none\"\n                                                                    value={newInvestment.investor}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                >\n                                                                    <option value=\"\">Seleccionar Socio...</option>\n                                                                    {(settings?.team || []).map((member, idx) => (\n                                                                        <option key={idx} value={member.name || member.email}>\n                                                                            {member.name || member.email}\n                                                                        </option>\n                                                                    ))}\n                                                                    <option value=\"other\">Otro / Externo</option>\n                                                                </select>\n                                                            </div>\n                                                            {newInvestment.investor === 'other' && (\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4 mt-2\"\n                                                                    placeholder=\"Nombre del Inversor Externo\"\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, investor: e.target.value })}\n                                                                />\n                                                            )}\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4 font-mono font-bold text-orange-400\"\n                                                                    placeholder=\"0.00\"\n                                                                    value={newInvestment.amount}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, amount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Fecha</label>\n                                                                <input\n                                                                    type=\"date\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={newInvestment.date}\n                                                                    onChange={e => setNewInvestment({ ...newInvestment, date: e.target.value })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Notas (Opcional)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Ej: Inversi√≥n Inicial, Refuerzo de capital...\"\n                                                                value={newInvestment.notes}\n                                                                onChange={e => setNewInvestment({ ...newInvestment, notes: e.target.value })}\n                                                            />\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newInvestment.investor || newInvestment.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'investments'), {\n                                                                    ...newInvestment,\n                                                                    timestamp: new Date().toISOString()\n                                                                });\n                                                                setNewInvestment({ investor: '', amount: '', date: new Date().toISOString().split('T')[0], notes: '' });\n                                                                showToast(\"Inversi√≥n registrada correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-gradient-to-r from-orange-600 to-blue-600 hover:from-orange-500 hover:to-blue-500 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-orange-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Aporte\n                                                        </button>\n                                                    </div>\n                                                </div>\n\n                                                {/* SECCI√ìN: REGISTRAR GASTO */}\n                                                <div className=\"bg-[#0a0a0a] border border-red-900/30 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden\">\n                                                    <div className=\"absolute top-0 right-0 w-32 h-32 bg-red-500/5 rounded-bl-[100px] pointer-events-none\"></div>\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        <Wallet className=\"w-5 h-5 text-red-400\" /> Registrar Gasto / Egreso\n                                                    </h3>\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Ej: Pago de Internet, Alquiler...\" value={newExpense.description} onChange={e => setNewExpense({ ...newExpense, description: e.target.value })} />\n                                                        </div>\n                                                        <div className=\"grid grid-cols-2 gap-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Monto ($)</label>\n                                                                <input type=\"number\" className=\"input-cyber w-full p-4 font-mono font-bold text-red-400\" placeholder=\"0.00\" value={newExpense.amount} onChange={e => setNewExpense({ ...newExpense, amount: parseFloat(e.target.value) || 0 })} />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Categor√≠a</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newExpense.category} onChange={e => setNewExpense({ ...newExpense, category: e.target.value })}>\n                                                                    <option>General</option>\n                                                                    <option>Servicios</option>\n                                                                    <option>Impuestos</option>\n                                                                    <option>Mantenimiento</option>\n                                                                    <option>Marketing</option>\n                                                                    <option>Sueldos</option>\n                                                                    <option>Otros</option>\n                                                                </select>\n                                                            </div>\n                                                        </div>\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newExpense.description || newExpense.amount <= 0) return showToast(\"Completa los datos correctamente.\", \"warning\");\n                                                                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'expenses'), {\n                                                                    ...newExpense,\n                                                                    date: new Date().toISOString()\n                                                                });\n                                                                setNewExpense({ description: '', amount: '', category: 'General', date: new Date().toISOString().split('T')[0] });\n                                                                showToast(\"Gasto registrado correctamente.\", \"success\");\n                                                            }}\n                                                            className=\"w-full mt-2 bg-red-900/50 hover:bg-red-900 text-white font-black py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2 border border-red-500/20\"\n                                                        >\n                                                            <Save className=\"w-5 h-5\" /> Registrar Gasto\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* TABLAS DETALLADAS */}\n                                            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12\">\n                                                {/* Historial de Inversiones */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Inversiones</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {investments.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin inversiones registradas.</p> :\n                                                            investments.sort((a, b) => new Date(b.date) - new Date(a.date)).map((inv, idx) => (\n                                                                <div key={inv.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-orange-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{inv.investor}</p>\n                                                                        <p className=\"text-slate-500 text-xs\">{new Date(inv.date).toLocaleDateString()} {inv.notes && `- ${inv.notes}`}</p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-orange-400 font-mono font-bold\">+${inv.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Inversi√≥n\", \"¬øDeseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'investments', inv.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n\n                                                {/* Historial de Gastos */}\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 rounded-[2.5rem] p-8 h-[500px] flex flex-col\">\n                                                    <h3 className=\"text-lg font-bold text-white mb-4\">Historial de Gastos</h3>\n                                                    <div className=\"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3\">\n                                                        {expenses.length === 0 ? <p className=\"text-slate-500 text-sm italic text-center py-10\">Sin gastos registrados.</p> :\n                                                            expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map((ex, idx) => (\n                                                                <div key={ex.id} className=\"bg-slate-900/30 border border-slate-800 p-4 rounded-xl flex justify-between items-center group hover:border-red-500/30 transition\">\n                                                                    <div>\n                                                                        <p className=\"text-white font-bold text-sm\">{ex.description}</p>\n                                                                        <p className=\"text-slate-500 text-xs flex gap-2\">\n                                                                            <span className=\"text-red-300 font-bold bg-red-900/20 px-1.5 rounded\">{ex.category}</span>\n                                                                            <span>{new Date(ex.date).toLocaleDateString()}</span>\n                                                                        </p>\n                                                                    </div>\n                                                                    <div className=\"flex items-center gap-4\">\n                                                                        <p className=\"text-red-400 font-mono font-bold\">-${ex.amount.toLocaleString()}</p>\n                                                                        <button onClick={() => openConfirm(\"Eliminar Gasto\", \"¬øDeseas eliminar este registro?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'expenses', ex.id)))} className=\"text-slate-600 hover:text-red-400 p-2 hover:bg-slate-800 rounded-lg transition\"><Trash2 className=\"w-4 h-4\" /></button>\n                                                                    </div>\n                                                                </div>\n                                                            ))\n                                                        }\n                                                    </div>\n                                                </div>\n                                            </div>\n\n                                            {/* SECCI√ìN: DISTRIBUCI√ìN DE GANANCIAS (AUTOM√ÅTICA) */}\n                                            <div className=\"animate-fade-up pt-12 border-t border-slate-800\">\n                                                <div className=\"flex justify-between items-center mb-8\">\n                                                    <div>\n                                                        <h2 className=\"text-2xl font-black text-white flex items-center gap-3\">\n                                                            <DollarSign className=\"w-8 h-8 text-green-500\" /> Distribuci√≥n de Ganancias\n                                                        </h2>\n                                                        <p className=\"text-slate-500 mt-1\">C√°lculo autom√°tico basado en las inversiones registradas.</p>\n                                                    </div>\n                                                    <div className=\"text-right\">\n                                                        <p className=\"text-xs font-bold text-slate-500 uppercase tracking-widest\">Beneficio Neto</p>\n                                                        <p className={`text-3xl font-black ${dashboardMetrics.netIncome >= 0 ? 'text-green-400' : 'text-red-500'}`}>\n                                                            ${dashboardMetrics.netIncome.toLocaleString()}\n                                                        </p>\n                                                    </div>\n                                                </div>\n\n                                                {/* Gr√°fico y Tabla */}\n                                                <div className=\"flex flex-col gap-8 bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                    {(() => {\n                                                        const team = settings?.team || [];\n                                                        // Calcular Total Invertido por Miembro desde la colecci√≥n 'investments'\n                                                        const memberInvestments = team.map(member => {\n                                                            const totalInv = investments\n                                                                .filter(inv => inv.investor === member.name || inv.investor === member.email) // Match by Name or Email\n                                                                .reduce((acc, inv) => acc + (Number(inv.amount) || 0), 0);\n                                                            return { ...member, totalInv };\n                                                        });\n\n                                                        const totalCapital = memberInvestments.reduce((acc, m) => acc + m.totalInv, 0);\n\n                                                        if (totalCapital === 0) return <p className=\"text-slate-500 text-center py-12\">Registra inversiones para ver la distribuci√≥n de ganancias.</p>;\n\n                                                        return (\n                                                            <>\n                                                                {/* Barra de Progreso Distribuci√≥n */}\n                                                                <div className=\"w-full h-8 bg-slate-900 rounded-full flex overflow-hidden\">\n                                                                    {memberInvestments.map((member, idx) => {\n                                                                        const pct = totalCapital > 0 ? (member.totalInv / totalCapital) * 100 : 0;\n                                                                        const colors = ['bg-green-500', 'bg-orange-500', 'bg-purple-500', 'bg-pink-500', 'bg-yellow-500', 'bg-red-500'];\n                                                                        if (pct <= 0) return null;\n                                                                        return (\n                                                                            <div key={idx} className={`${colors[idx % colors.length]} h-full transition-all duration-500`} style={{ width: `${pct}%` }} title={`${member.name}: ${pct.toFixed(1)}%`}></div>\n                                                                        );\n                                                                    })}\n                                                                </div>\n\n                                                                {/* Tabla de Distribuci√≥n */}\n                                                                <div className=\"overflow-x-auto\">\n                                                                    <table className=\"w-full text-left border-collapse\">\n                                                                        <thead>\n                                                                            <tr className=\"bg-slate-900/50 border-b border-slate-800\">\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest\">Socio</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right\">Capital Aportado</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-center\">% Part.</th>\n                                                                                <th className=\"p-6 text-xs font-black text-slate-500 uppercase tracking-widest text-right text-green-500\">Ganancia Est.</th>\n                                                                            </tr>\n                                                                        </thead>\n                                                                        <tbody className=\"divide-y divide-slate-800/50\">\n                                                                            {memberInvestments.map((member, idx) => {\n                                                                                const sharePercentage = totalCapital > 0 ? ((member.totalInv / totalCapital) * 100) : 0;\n                                                                                const memberProfit = (dashboardMetrics.netIncome * sharePercentage) / 100;\n                                                                                const colors = ['text-green-500', 'text-orange-500', 'text-purple-500', 'text-pink-500', 'text-yellow-500', 'text-red-500'];\n\n                                                                                return (\n                                                                                    <tr key={idx} className=\"hover:bg-slate-900/20 transition\">\n                                                                                        <td className=\"p-5\">\n                                                                                            <div className=\"flex items-center gap-3\">\n                                                                                                <div className={`w-3 h-3 rounded-full ${colors[idx % colors.length].replace('text-', 'bg-')}`}></div>\n                                                                                                <div>\n                                                                                                    <p className=\"font-bold text-white\">{member.name || 'Sin Nombre'}</p>\n                                                                                                    <p className=\"text-xs text-slate-500\">{member.email}</p>\n                                                                                                </div>\n                                                                                            </div>\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-bold text-white\">\n                                                                                            ${member.totalInv.toLocaleString()}\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-center font-mono text-slate-300 font-bold\">\n                                                                                            {sharePercentage.toFixed(1)}%\n                                                                                        </td>\n                                                                                        <td className=\"p-6 text-right font-mono font-black text-green-400 text-lg\">\n                                                                                            ${memberProfit.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                                                                                        </td>\n                                                                                    </tr>\n                                                                                );\n                                                                            })}\n                                                                        </tbody>\n                                                                        <tfoot className=\"bg-slate-900/30 border-t border-slate-800\">\n                                                                            <tr>\n                                                                                <td className=\"p-6 font-black text-white text-right\">TOTAL CAPITAL</td>\n                                                                                <td className=\"p-6 text-right font-black text-orange-400 text-lg\">\n                                                                                    ${totalCapital.toLocaleString()}\n                                                                                </td>\n                                                                                <td className=\"p-6 text-center font-bold text-slate-500\">100%</td>\n                                                                                <td className=\"p-6 text-right font-black text-green-500 text-xl\">\n                                                                                    ${dashboardMetrics.netIncome.toLocaleString()}\n                                                                                </td>\n                                                                            </tr>\n                                                                        </tfoot>\n                                                                    </table>\n                                                                </div>\n                                                            </>\n                                                        );\n                                                    })()}\n                                                </div>\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: CUPONES (GESTI√ìN AVANZADA) */}\n                                    {adminTab === 'coupons' && (\n                                        <div className=\"max-w-5xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Overlay for Entrepreneur Plan */}\n                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                <button\n                                                    onClick={() => setShowPlansModal(true)}\n                                                    className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/80 backdrop-blur-md rounded-[2.5rem] cursor-pointer hover:bg-black/70 transition group\"\n                                                >\n                                                    <div className=\"text-center p-8 max-w-md\">\n                                                        <div className=\"w-20 h-20 mx-auto mb-6 bg-purple-500/20 rounded-full flex items-center justify-center border border-purple-500/30 group-hover:scale-110 transition\">\n                                                            <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-2xl font-black text-white mb-4\">Cupones Bloqueados</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Los cupones de descuento est√°n disponibles a partir del <span className=\"text-purple-400 font-bold\">Plan Negocio</span>.</p>\n                                                        <p className=\"text-sm text-white/60 group-hover:text-white transition\">Clic para ver planes disponibles</p>\n                                                    </div>\n                                                </button>\n                                            )}\n\n                                            <div className=\"relative z-30 flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Cupones</h1>\n                                                <AdminHowToUse guideKey=\"coupons\" />\n                                            </div>\n\n                                            {/* Formulario de Creaci√≥n */}\n                                            <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2.5rem] mb-10 shadow-xl\">\n                                                <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                    <Plus className=\"w-5 h-5 text-purple-400\" /> Crear Nuevo Cup√≥n\n                                                </h3>\n                                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                    {/* Columna 1 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">C√≥digo del Cup√≥n</label>\n                                                            <input className=\"input-cyber w-full p-4 font-mono text-lg uppercase tracking-widest\" placeholder=\"Ej: VERANO2024\" value={newCoupon.code} onChange={e => setNewCoupon({ ...newCoupon, code: e.target.value.toUpperCase() })} />\n                                                        </div>\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo</label>\n                                                                <select className=\"input-cyber w-full p-4\" value={newCoupon.type} onChange={e => setNewCoupon({ ...newCoupon, type: e.target.value })}>\n                                                                    <option value=\"percentage\">Porcentaje (%)</option>\n                                                                    <option value=\"fixed\">Fijo ($)</option>\n                                                                </select>\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Valor</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"0\" value={newCoupon.value} onChange={e => setNewCoupon({ ...newCoupon, value: e.target.value })} />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Columna 2 */}\n                                                    <div className=\"space-y-4\">\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">M√≠nimo de Compra</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0\" value={newCoupon.minPurchase} onChange={e => setNewCoupon({ ...newCoupon, minPurchase: e.target.value })} />\n                                                            </div>\n                                                            {newCoupon.type === 'percentage' && (\n                                                                <div className=\"flex-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tope Reintegro</label>\n                                                                    <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"$0 (Opcional)\" value={newCoupon.maxDiscount} onChange={e => setNewCoupon({ ...newCoupon, maxDiscount: e.target.value })} />\n                                                                </div>\n                                                            )}\n                                                        </div>\n\n                                                        <div className=\"flex gap-4\">\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">L√≠mite Usos (Total)</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Ej: 100\" value={newCoupon.usageLimit} onChange={e => setNewCoupon({ ...newCoupon, usageLimit: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"flex-1\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Vencimiento</label>\n                                                                <input className=\"input-cyber w-full p-4\" type=\"date\" value={newCoupon.expirationDate} onChange={e => setNewCoupon({ ...newCoupon, expirationDate: e.target.value })} />\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"md:col-span-2\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                Tipo de Cup√≥n\n                                                            </label>\n                                                            <select\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={newCoupon.targetType}\n                                                                onChange={e => setNewCoupon({ ...newCoupon, targetType: e.target.value })}\n                                                            >\n                                                                <option value=\"global\">üåç P√∫blico / Canjeable (Redes Sociales)</option>\n                                                                <option value=\"specific_email\">üë§ Usuario Espec√≠fico (Email)</option>\n                                                            </select>\n                                                        </div>\n\n                                                        {newCoupon.targetType === 'specific_email' && (\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Email del Usuario\n                                                                </label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"usuario@ejemplo.com\"\n                                                                    value={newCoupon.targetUser || ''}\n                                                                    onChange={e => setNewCoupon({ ...newCoupon, targetUser: e.target.value })}\n                                                                />\n                                                                <p className=\"text-xs text-slate-400 mt-1\">Solo este usuario podr√° usar el cup√≥n</p>\n                                                            </div>\n                                                        )}\n                                                    </div>\n                                                </div>\n                                                <button onClick={saveCouponFn} className=\"w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg transition flex items-center justify-center gap-2\">\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cup√≥n\n                                                </button>\n                                            </div>\n\n                                            {/* Lista de Cupones Activos */}\n                                            <div className=\"grid gap-4\">\n                                                {coupons.map((c, idx) => (\n                                                    <div key={c.id} style={{ animationDelay: `${idx * 0.05}s` }} className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col md:flex-row justify-between items-center group hover:border-slate-700 transition animate-fade-up\">\n                                                        <div className=\"flex items-center gap-6 mb-4 md:mb-0 w-full md:w-auto\">\n                                                            <div className=\"w-16 h-16 bg-slate-900 rounded-xl flex items-center justify-center border border-slate-800 text-purple-400 font-black text-2xl\">\n                                                                %\n                                                            </div>\n                                                            <div>\n                                                                <h4 className=\"text-white font-black text-xl tracking-wider\">{c.code}</h4>\n                                                                <p className=\"text-purple-400 font-bold text-sm\">\n                                                                    {c.type === 'fixed' ? `$${c.value} OFF` : `${c.value}% OFF`}\n                                                                    <span className=\"text-slate-500 font-normal ml-2\">\n                                                                        (Min: ${c.minPurchase})\n                                                                    </span>\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-600 mt-1 flex gap-3\">\n                                                                    <span>Usado: {c.usedBy ? c.usedBy.length : 0} veces</span>\n                                                                    {c.usageLimit && <span>L√≠mite: {c.usageLimit}</span>}\n                                                                    {c.expirationDate && <span>Vence: {c.expirationDate}</span>}\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 md:mt-0\">\n                                                            {c.targetType === 'global' && (\n                                                                <div className=\"bg-purple-900/30 text-purple-400 px-3 py-1 rounded-lg border border-purple-500/30 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest\">\n                                                                    <Globe className=\"w-3 h-3\" /> Social\n                                                                </div>\n                                                            )}\n                                                            <button\n                                                                onClick={() => {\n                                                                    navigator.clipboard.writeText(c.code);\n                                                                    showToast(\"C√≥digo copiado al portapapeles\", \"success\");\n                                                                }}\n                                                                className=\"bg-slate-900 hover:bg-slate-800 text-slate-400 hover:text-white p-3 rounded-xl transition border border-slate-800\"\n                                                                title=\"Copiar C√≥digo\"\n                                                            >\n                                                                <Copy className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button\n                                                                onClick={() => openConfirm(\"Eliminar Cup√≥n\", \"¬øEliminar este cup√≥n?\", async () => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'coupons', c.id)))}\n                                                                className=\"bg-slate-900 hover:bg-red-900/20 text-slate-500 hover:text-red-400 p-3 rounded-xl transition border border-slate-800\"\n                                                            >\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: USERS (NUEVO) */}\n\n                                    {adminTab === 'users' && (() => {\n                                        const filteredUsers = users.filter(u => {\n                                            const query = userSearch.toLowerCase();\n                                            const matchesSearch = (u.name || '').toLowerCase().includes(query) ||\n                                                (u.email || '').toLowerCase().includes(query) ||\n                                                (u.username || '').toLowerCase().includes(query);\n                                            const matchesRole = userRoleFilter === 'all' || u.role === userRoleFilter;\n                                            return matchesSearch && matchesRole;\n                                        });\n\n                                        return (\n                                            <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                                <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10\">\n                                                    <div>\n                                                        <h1 className=\"text-4xl font-black text-white tracking-tighter flex items-center gap-4\">\n                                                            <div className=\"w-12 h-12 rounded-2xl bg-pink-500/20 flex items-center justify-center border border-pink-500/30\">\n                                                                <Users className=\"w-6 h-6 text-pink-400\" />\n                                                            </div>\n                                                            Gesti√≥n de Usuarios\n                                                        </h1>\n                                                        <p className=\"text-slate-500 mt-2 font-medium\">Control total sobre cuentas, roles y auditor√≠a de carritos.</p>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto\">\n                                                        <div className=\"w-full sm:w-auto flex justify-end\">\n                                                            <AdminHowToUse guideKey=\"users\" />\n                                                        </div>\n                                                        <div className=\"relative w-full sm:w-64 group\">\n                                                            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 group-focus-within:text-orange-400 transition\" />\n                                                            <input\n                                                                className=\"input-cyber w-full pl-11 pr-4 py-3 text-sm\"\n                                                                placeholder=\"Buscar por nombre, email...\"\n                                                                value={userSearch}\n                                                                onChange={e => setUserSearch(e.target.value)}\n                                                            />\n                                                        </div>\n                                                        <div className=\"flex bg-slate-900/50 p-1 rounded-xl border border-white/5\">\n                                                            {['all', 'admin', 'user'].map(role => (\n                                                                <button\n                                                                    key={role}\n                                                                    onClick={() => setUserRoleFilter(role)}\n                                                                    className={`px-4 py-2 rounded-lg text-xs font-black uppercase transition-all ${userRoleFilter === role ? 'bg-white/10 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}\n                                                                >\n                                                                    {role === 'all' ? 'Todos' : role}\n                                                                </button>\n                                                            ))}\n                                                        </div>\n                                                    </div>\n                                                </div>\n\n                                                <div className=\"bg-[#050505] border border-white/5 rounded-[2.5rem] overflow-hidden shadow-2xl\">\n                                                    <div className=\"overflow-x-auto overflow-y-visible\">\n                                                        <table className=\"w-full text-left border-collapse\">\n                                                            <thead>\n                                                                <tr className=\"bg-white/[0.02] border-b border-white/5\">\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Identidad</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-center\">Actividad & Stats</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]\">Rango</th>\n                                                                    <th className=\"p-5 text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] text-right\">Acciones</th>\n                                                                </tr>\n                                                            </thead>\n                                                            <tbody className=\"divide-y divide-white/5\">\n                                                                {filteredUsers.length === 0 ? (\n                                                                    <tr>\n                                                                        <td colSpan=\"4\" className=\"p-20 text-center\">\n                                                                            <div className=\"flex flex-col items-center gap-4 opacity-20\">\n                                                                                <UserPlus className=\"w-16 h-16\" />\n                                                                                <p className=\"font-black uppercase tracking-widest\">No se encontraron usuarios</p>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ) : filteredUsers.map((u, idx) => (\n                                                                    <tr key={u.id} style={{ animationDelay: `${idx * 0.03}s` }} className=\"group hover:bg-white/[0.01] transition-all animate-fade-up\">\n                                                                        <td className=\"p-5\">\n                                                                            <div className=\"flex items-center gap-5\">\n                                                                                <div className=\"relative group/avatar\">\n                                                                                    <div className=\"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600 rounded-2xl blur-lg opacity-20 group-hover/avatar:opacity-40 transition\" />\n                                                                                    <div className=\"relative w-14 h-14 rounded-2xl bg-[#0a0a0a] border border-white/10 flex items-center justify-center text-xl font-black text-white overflow-hidden shadow-xl\">\n                                                                                        {u.image ? <img src={u.image} className=\"w-full h-full object-cover\" /> : (u.name || '?').charAt(0).toUpperCase()}\n                                                                                    </div>\n                                                                                </div>\n                                                                                <div>\n                                                                                    <div className=\"flex items-center gap-2\">\n                                                                                        <p className=\"font-bold text-white text-lg tracking-tight\">{u.name}</p>\n                                                                                        {u.isVerified && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 font-mono\">{u.email}</p>\n                                                                                    <div className=\"flex items-center gap-3 mt-2\">\n                                                                                        <span className=\"text-[9px] font-black text-slate-600 uppercase tracking-widest bg-white/5 px-2 py-0.5 rounded-md\">ID: {u.id.slice(-6)}</span>\n                                                                                        <span className=\"text-[9px] font-bold text-slate-500 uppercase\">INC. {new Date(u.joinDate).toLocaleDateString()}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8 relative\">\n                                                                            {/* Blur Overlay for Entrepreneur Plan */}\n                                                                            {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                                                                <button\n                                                                                    onClick={() => setShowPlansModal(true)}\n                                                                                    className=\"absolute inset-0 z-10 flex items-center justify-center bg-black/60 backdrop-blur-sm rounded-xl cursor-pointer hover:bg-black/70 transition group\"\n                                                                                >\n                                                                                    <div className=\"text-center\">\n                                                                                        <Lock className=\"w-6 h-6 text-yellow-500 mx-auto mb-2 group-hover:scale-110 transition\" />\n                                                                                        <p className=\"text-xs font-black text-yellow-400 uppercase tracking-wider\">Plan Negocio</p>\n                                                                                        <p className=\"text-[10px] text-slate-400 group-hover:text-white transition\">Clic para ver planes</p>\n                                                                                    </div>\n                                                                                </button>\n                                                                            )}\n                                                                            <div className={`flex flex-col items-center gap-3 ${(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) ? 'filter blur-sm pointer-events-none' : ''}`}>\n                                                                                <div className=\"flex gap-2\">\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Favoritos\">\n                                                                                        <Heart className={`w-4 h-4 ${u.favorites?.length > 0 ? 'text-pink-500 fill-pink-500' : 'text-slate-600'}`} />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.favorites ? u.favorites.length : 0}</span>\n                                                                                    </div>\n                                                                                    <div className=\"bg-slate-900/80 px-4 py-2 rounded-xl border border-white/5 flex items-center gap-3\" title=\"Pedidos Realizados\">\n                                                                                        <ShoppingBag className=\"w-4 h-4 text-orange-500\" />\n                                                                                        <span className=\"text-sm font-black text-white\">{u.ordersCount || 0}</span>\n                                                                                    </div>\n                                                                                </div>\n                                                                                <button\n                                                                                    onClick={() => setViewUserCart(u)}\n                                                                                    className=\"w-full py-2.5 rounded-xl border border-orange-500/20 bg-orange-500/5 text-orange-400 hover:bg-orange-500/20 text-[10px] font-black uppercase tracking-widest transition-all flex items-center justify-center gap-2\"\n                                                                                >\n                                                                                    <Maximize2 className=\"w-3 h-3\" /> Ver Carrito en Vivo\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className={`inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.1em] border shadow-inner ${u.role === 'admin'\n                                                                                ? 'bg-purple-500/10 text-purple-400 border-purple-500/30'\n                                                                                : 'bg-slate-900/50 text-slate-500 border-white/5'\n                                                                                }`}>\n                                                                                {u.role === 'admin' ? <Shield className=\"w-3 h-3\" /> : <User className=\"w-3 h-3\" />}\n                                                                                {u.role}\n                                                                            </div>\n                                                                        </td>\n                                                                        <td className=\"p-8\">\n                                                                            <div className=\"flex justify-end gap-3 translate-x-2 opacity-60 group-hover:opacity-100 transition-opacity\">\n                                                                                <button\n                                                                                    onClick={() => setViewUserEdit(u)}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-orange-400 hover:border-orange-500/40 hover:bg-orange-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Gestionar Perfil\"\n                                                                                >\n                                                                                    <Edit className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                                <button\n                                                                                    onClick={() => {\n                                                                                        setNewAdminPassword('');\n                                                                                        setUserPassModal(u);\n                                                                                    }}\n                                                                                    className=\"w-11 h-11 flex items-center justify-center bg-[#0a0a0a] border border-white/5 rounded-2xl text-slate-400 hover:text-pink-400 hover:border-pink-500/40 hover:bg-pink-500/5 transition-all shadow-xl group\"\n                                                                                    title=\"Seguridad & Acceso\"\n                                                                                >\n                                                                                    <Lock className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n                                                                                </button>\n                                                                            </div>\n                                                                        </td>\n                                                                    </tr>\n                                                                ))}\n                                                            </tbody>\n                                                        </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        );\n                                    })()}\n\n\n                                    {/* TAB: PROMOS (NUEVO) */}\n                                    {adminTab === 'promos' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white flex items-center gap-3\">\n                                                    <Tag className=\"w-8 h-8 text-purple-500\" /> Gesti√≥n de Promos\n                                                </h1>\n                                                <AdminHowToUse guideKey=\"promos\" />\n                                            </div>\n\n                                            {/* Formulario Nueva Promo */}\n                                            {/* Formulario Nueva Promo o Banner Upgrade */}\n                                            {(!((settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && promos.length >= 1) || isEditingPromo) ? (\n                                                <div className=\"bg-[#0a0a0a] border border-purple-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                        {isEditingPromo ? <Edit className=\"w-5 h-5 text-purple-400\" /> : <Plus className=\"w-5 h-5 text-green-400\" />}\n                                                        {isEditingPromo ? 'Editar Promo' : 'Crear Nueva Promo'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                                                        {/* Datos B√°sicos */}\n                                                        <div className=\"space-y-4\">\n                                                            <input\n                                                                type=\"text\"\n                                                                className=\"input-cyber w-full p-4\"\n                                                                placeholder=\"Nombre de la Promo\"\n                                                                value={newPromo.name}\n                                                                onChange={e => setNewPromo({ ...newPromo, name: e.target.value })}\n                                                            />\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <div className=\"relative\">\n                                                                    <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500\">$</span>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        className=\"input-cyber w-full p-4 pl-8\"\n                                                                        placeholder=\"Precio\"\n                                                                        value={newPromo.price}\n                                                                        onChange={e => setNewPromo({ ...newPromo, price: e.target.value })}\n                                                                    />\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900 rounded-xl border border-slate-700 text-slate-400 font-mono text-sm flex items-center\">\n                                                                    Costo: ${newPromo.items.reduce((acc, item) => {\n                                                                        const p = products.find(prod => prod.id === item.productId);\n                                                                        return acc + ((Number(p?.basePrice) || 0) * item.quantity);\n                                                                    }, 0).toLocaleString()}\n                                                                </div>\n                                                            </div>\n                                                            <div className=\"mb-4\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de la Promo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={e => handleImageUpload(e, setNewPromo)}\n                                                                />\n                                                                {newPromo.image && (\n                                                                    <div className=\"mt-2 relative group w-32 aspect-video overflow-hidden rounded-xl border border-slate-700\">\n                                                                        <img src={newPromo.image} className=\"w-full h-full object-cover\" />\n                                                                        <button onClick={() => setNewPromo({ ...newPromo, image: '' })} className=\"absolute top-1 right-1 bg-black/50 p-1 rounded-full text-white hover:bg-red-500 transition opacity-0 group-hover:opacity-100\">\n                                                                            <X className=\"w-3 h-3\" />\n                                                                        </button>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                placeholder=\"Descripci√≥n breve...\"\n                                                                value={newPromo.description}\n                                                                onChange={e => setNewPromo({ ...newPromo, description: e.target.value })}\n                                                            />\n                                                        </div>\n\n                                                        {/* Constructor de Bundle */}\n                                                        <div className=\"bg-slate-900/40 p-6 rounded-2xl border border-slate-800\">\n                                                            <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                                                <Package className=\"w-4 h-4\" /> Productos Incluidos\n                                                            </p>\n\n                                                            <div className=\"grid grid-cols-1 sm:grid-cols-[1fr_5rem_auto] gap-2 mb-4\">\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3 text-sm min-w-0\"\n                                                                    value={selectedPromoProduct}\n                                                                    onChange={e => setSelectedPromoProduct(e.target.value)}\n                                                                >\n                                                                    <option value=\"\">Agregar producto...</option>\n                                                                    {products.map(p => (\n                                                                        <option key={p.id} value={p.id}>{p.name} (${Number(p.basePrice)})</option>\n                                                                    ))}\n                                                                </select>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full sm:w-20 p-3 text-sm text-center\"\n                                                                    value={promoProductQty}\n                                                                    min=\"1\"\n                                                                    onChange={e => setPromoProductQty(Math.max(1, parseInt(e.target.value) || 1))}\n                                                                />\n                                                                <button\n                                                                    onClick={() => {\n                                                                        if (!selectedPromoProduct) return;\n                                                                        const exists = newPromo.items.find(i => i.productId === selectedPromoProduct);\n                                                                        if (exists) {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: newPromo.items.map(i => i.productId === selectedPromoProduct ? { ...i, quantity: i.quantity + promoProductQty } : i)\n                                                                            });\n                                                                        } else {\n                                                                            setNewPromo({\n                                                                                ...newPromo,\n                                                                                items: [...newPromo.items, { productId: selectedPromoProduct, quantity: promoProductQty }]\n                                                                            });\n                                                                        }\n                                                                        setSelectedPromoProduct('');\n                                                                        setPromoProductQty(1);\n                                                                    }}\n                                                                    className=\"h-[46px] w-full sm:w-auto px-4 bg-purple-600 hover:bg-purple-500 text-white rounded-xl transition flex items-center justify-center\"\n                                                                >\n                                                                    <Plus className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n\n                                                            <div className=\"space-y-2 max-h-[150px] overflow-y-auto custom-scrollbar\">\n                                                                {newPromo.items.map((item, idx) => {\n                                                                    const p = products.find(prod => prod.id === item.productId);\n                                                                    if (!p) return null;\n                                                                    return (\n                                                                        <div key={idx} className=\"flex justify-between items-center bg-slate-900 p-3 rounded-lg border border-slate-700\">\n                                                                            <div className=\"flex items-center gap-3\">\n                                                                                <img src={p.image} className=\"w-8 h-8 rounded bg-white object-contain p-0.5\" />\n                                                                                <div>\n                                                                                    <p className=\"text-sm font-bold text-white truncate max-w-[200px] sm:max-w-none\">{p.name}</p>\n                                                                                    <p className=\"text-xs text-slate-500\">{item.quantity} un. x ${p.basePrice}</p>\n                                                                                </div>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewPromo({ ...newPromo, items: newPromo.items.filter((_, i) => i !== idx) })}\n                                                                                className=\"text-red-500 hover:text-red-400 p-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-4 h-4\" />\n                                                                            </button>\n                                                                        </div>\n                                                                    );\n                                                                })}\n                                                                {newPromo.items.length === 0 && (\n                                                                    <div className=\"text-center py-6 text-slate-600 italic text-sm border border-dashed border-slate-800 rounded-lg\">\n                                                                        Agrega productos para armar el combo\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end mt-6\">\n                                                        {isEditingPromo && (\n                                                            <button\n                                                                onClick={() => {\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                }}\n                                                                className=\"w-full sm:w-auto px-6 py-3 rounded-xl border border-slate-800 bg-slate-900/40 text-slate-300 hover:text-white hover:bg-slate-900 transition font-bold\"\n                                                            >\n                                                                Cancelar\n                                                            </button>\n                                                        )}\n                                                        <button\n                                                            onClick={async () => {\n                                                                if (!newPromo.name || !newPromo.price || newPromo.items.length === 0) {\n                                                                    return showToast(\"Completa nombre, precio y agrega productos.\", \"warning\");\n                                                                }\n\n                                                                setIsLoading(true);\n                                                                try {\n                                                                    if (isEditingPromo && editingPromoId) {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', editingPromoId), newPromo);\n                                                                        showToast(\"Promo actualizada\", \"success\");\n                                                                    } else {\n                                                                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'promos'), {\n                                                                            ...newPromo,\n                                                                            createdAt: new Date().toISOString()\n                                                                        });\n                                                                        showToast(\"Promo creada exitosamente\", \"success\");\n                                                                    }\n                                                                    setNewPromo({ name: '', price: '', image: '', description: '', items: [] });\n                                                                    setIsEditingPromo(false);\n                                                                    setEditingPromoId(null);\n                                                                } catch (e) {\n                                                                    console.error(e);\n                                                                    showToast(\"Error al guardar promo\", \"error\");\n                                                                } finally {\n                                                                    setIsLoading(false);\n                                                                }\n                                                            }}\n                                                            className=\"w-full sm:w-auto px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center\"\n                                                        >\n                                                            {isEditingPromo ? 'Guardar Cambios' : 'Crear Promo'}\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            ) : (\n                                                <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem] mb-10 shadow-xl flex flex-col items-center justify-center text-center animate-fade-up\">\n                                                    <div className=\"w-20 h-20 bg-purple-500/20 rounded-full flex items-center justify-center mb-6 border border-purple-500/30\">\n                                                        <Lock className=\"w-10 h-10 text-purple-400\" />\n                                                    </div>\n                                                    <h3 className=\"text-2xl font-black text-white mb-2\">L√≠mite de Promos Alcanzado</h3>\n                                                    <p className=\"text-slate-400 max-w-md mb-8\">\n                                                        Tu plan actual te permite tener hasta <strong className=\"text-white\">1 promo activa</strong>.\n                                                        Para crear m√°s promociones ilimitadas, actualiza tu plan.\n                                                    </p>\n                                                    <button\n                                                        onClick={() => setShowPlansModal(true)}\n                                                        className=\"px-8 py-3 bg-purple-600 hover:bg-purple-500 text-white font-bold rounded-xl shadow-lg shadow-purple-600/20 transition flex items-center gap-2\"\n                                                    >\n                                                        <Zap className=\"w-5 h-5\" /> Mejorar mi Plan\n                                                    </button>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Promos */}\n                                            {/* Lista de Promos */}\n                                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                                                {promos.map(promo => {\n                                                    const totalCost = (promo.items || []).reduce((acc, item) => {\n                                                        const p = products.find(prod => prod.id === item.productId);\n                                                        return acc + ((Number(p?.purchasePrice) || 0) * item.quantity);\n                                                    }, 0);\n                                                    const price = Number(promo.price) || 0;\n                                                    const profit = price - totalCost;\n                                                    const margin = price > 0 ? ((profit / price) * 100).toFixed(1) : 0;\n                                                    const isProfitable = profit > 0;\n\n                                                    return (\n                                                        <div key={promo.id} className=\"bg-[#0a0a0a] border border-slate-800 rounded-2xl overflow-hidden hover:border-purple-500/30 transition group flex flex-col\">\n                                                            <div className=\"aspect-video relative overflow-hidden\">\n                                                                <img src={promo.image || 'https://via.placeholder.com/400'} className=\"w-full h-full object-cover transition duration-500 group-hover:scale-105\" />\n                                                                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent\"></div>\n                                                                <div className=\"absolute bottom-4 left-4 right-4 bg-black/55 backdrop-blur-sm rounded-2xl p-4 border border-white/10\">\n                                                                    <h4 className=\"text-xl font-black text-white mb-1 leading-tight\">{promo.name}</h4>\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <p className=\"text-3xl text-purple-400 font-black\">${price.toLocaleString()}</p>\n                                                                        {totalCost > 0 && (\n                                                                            <div className={`px-2 py-1 rounded text-xs font-bold border ${isProfitable ? 'bg-green-900/30 border-green-500/30 text-green-400' : 'bg-red-900/30 border-red-500/30 text-red-400'}`}>\n                                                                                {margin}% MG\n                                                                            </div>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"p-6 flex-1 flex flex-col\">\n                                                                {/* Productos Incluidos con Miniaturas */}\n                                                                <div className=\"mb-6 flex-1\">\n                                                                    <p className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Incluye:</p>\n                                                                    <div className=\"flex flex-col gap-2\">\n                                                                        {(promo.items || []).map((item, i) => {\n                                                                            const p = products.find(prod => prod.id === item.productId);\n                                                                            return (\n                                                                                <div key={i} className=\"flex items-center gap-3 p-2 rounded-lg bg-slate-900/50 border border-slate-800/50\">\n                                                                                    <div className=\"w-10 h-10 bg-white rounded-lg p-0.5 flex-shrink-0\">\n                                                                                        <img src={p?.image} className=\"w-full h-full object-contain\" />\n                                                                                    </div>\n                                                                                    <div className=\"flex-1 min-w-0\">\n                                                                                        <p className=\"text-sm font-bold text-white truncate\">{p?.name || 'Producto Eliminado'}</p>\n                                                                                        <p className=\"text-xs text-slate-500\">{item.quantity} x ${Number(p?.basePrice || 0).toLocaleString()} (Costo)</p>\n                                                                                    </div>\n                                                                                </div>\n                                                                            )\n                                                                        })}\n                                                                    </div>\n                                                                </div>\n\n                                                                {/* An√°lisis de Rentabilidad */}\n                                                                <div className=\"mb-6 p-4 bg-slate-900/40 rounded-xl border border-dashed border-slate-800\">\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Costo Real:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${totalCost.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"flex justify-between text-sm mb-1\">\n                                                                        <span className=\"text-slate-500\">Precio Venta:</span>\n                                                                        <span className=\"text-slate-300 font-mono\">${price.toLocaleString()}</span>\n                                                                    </div>\n                                                                    <div className=\"border-t border-slate-800 my-2\"></div>\n                                                                    <div className=\"flex justify-between text-sm font-bold\">\n                                                                        <span className={isProfitable ? \"text-green-500\" : \"text-red-500\"}>Ganancia Neta:</span>\n                                                                        <span className={`font-mono ${isProfitable ? \"text-green-400\" : \"text-red-400\"}`}>\n                                                                            {isProfitable ? '+' : ''}${profit.toLocaleString()}\n                                                                        </span>\n                                                                    </div>\n                                                                </div>\n\n                                                                <div className=\"flex gap-3 mt-auto\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            setNewPromo({\n                                                                                name: promo.name,\n                                                                                price: promo.price,\n                                                                                image: promo.image,\n                                                                                description: promo.description || '',\n                                                                                items: promo.items || []\n                                                                            });\n                                                                            setEditingPromoId(promo.id);\n                                                                            setIsEditingPromo(true);\n                                                                            window.scrollTo({ top: 0, behavior: 'smooth' });\n                                                                        }}\n                                                                        className=\"flex-1 py-3 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-bold transition border border-slate-700 flex items-center justify-center gap-2 group-hover:border-purple-500/30\"\n                                                                    >\n                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                    </button>\n                                                                    <button\n                                                                        onClick={() => openConfirm('Eliminar Promo', '¬øEst√°s seguro? Esto no se puede deshacer.', async () => {\n                                                                            await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'promos', promo.id));\n                                                                            showToast(\"Promo eliminada\", \"info\");\n                                                                        })}\n                                                                        className=\"px-4 py-3 bg-red-900/20 hover:bg-red-900/40 text-red-500 rounded-xl transition border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PEDIDOS (RESTAURADO) */}\n                                    {adminTab === 'orders' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20\">\n                                            <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8\">\n                                                <h1 className=\"text-3xl font-black text-white\">Gesti√≥n de Pedidos</h1>\n                                                <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\n                                                    <AdminHowToUse guideKey=\"orders\" />\n                                                    <button onClick={() => toggleAdminOrderAlarmMuted()} className={`px-5 py-3 rounded-xl font-black transition border flex items-center gap-3 ${adminOrderAlarmMuted ? 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800' : 'bg-green-900/10 text-green-400 border-green-500/20 hover:bg-green-600 hover:text-white'}`}>\n                                                        <Bell className={`w-5 h-5 ${adminOrderAlarmMuted ? 'opacity-40' : ''}`} />\n                                                        Notificaci√≥n pedidos\n                                                        <span className={`text-[10px] px-2 py-1 rounded-full border font-black uppercase tracking-widest ${adminOrderAlarmMuted ? 'bg-slate-900/60 text-slate-400 border-slate-700' : 'bg-green-900/20 text-green-400 border-green-500/30'}`}>\n                                                            {adminOrderAlarmMuted ? 'Muteada' : 'Activa'}\n                                                        </span>\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {orders.length === 0 ? (\n                                                <div className=\"text-center py-20 border border-dashed border-slate-800 rounded-[3rem] bg-slate-900/20\">\n                                                    <ShoppingBag className=\"w-20 h-20 mx-auto mb-4 text-slate-700\" />\n                                                    <p className=\"text-xl text-slate-500 font-bold\">No hay pedidos registrados a√∫n.</p>\n                                                </div>\n                                            ) : (\n                                                <div className=\"space-y-4\">\n                                                    {orders.map((o, idx) => (\n                                                        <div\n                                                            key={o.id}\n                                                            style={{ animationDelay: `${idx * 0.05}s` }}\n                                                            className=\"bg-[#0a0a0a] border border-slate-800 p-6 rounded-2xl flex flex-col lg:flex-row justify-between items-center gap-6 hover:border-slate-700 transition group animate-fade-up\"\n                                                        >\n                                                            {/* Info Principal */}\n                                                            <div className=\"flex-1 w-full lg:w-auto\">\n                                                                <div className=\"flex items-center gap-4 mb-2\">\n                                                                    <span className=\"bg-slate-900 text-orange-400 px-3 py-1 rounded-lg text-sm font-black tracking-widest border border-slate-800\">\n                                                                        #{o.orderId}\n                                                                    </span>\n                                                                    <span className={`text-[10px] px-2 py-1 rounded-full uppercase font-bold border ${o.status === 'Realizado' ? 'bg-green-900/20 text-green-400 border-green-500/30' : 'bg-yellow-900/20 text-yellow-400 border-yellow-500/30'}`}>\n                                                                        {o.status}\n                                                                    </span>\n                                                                </div>\n                                                                <h4 className=\"text-white font-bold text-lg mb-1\">{o.customer.name}</h4>\n                                                                <p className=\"text-slate-500 text-xs flex items-center gap-2\">\n                                                                    <Clock className=\"w-3 h-3\" /> {new Date(o.date).toLocaleString()}\n                                                                    <span className=\"w-1 h-1 bg-slate-700 rounded-full\"></span>\n                                                                    <span className=\"text-slate-400 font-mono\">${o.total.toLocaleString()}</span>\n                                                                </p>\n                                                            </div>\n\n                                                            {/* Items Preview */}\n                                                            <div className=\"flex -space-x-2\">\n                                                                {o.items.slice(0, 4).map((i, idx) => (\n                                                                    <div key={idx} className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center overflow-hidden\" title={i.title}>\n                                                                        {i.image ? <img src={i.image} className=\"w-full h-full object-cover\" /> : <Package className=\"w-4 h-4 text-slate-500\" />}\n                                                                    </div>\n                                                                ))}\n                                                                {o.items.length > 4 && (\n                                                                    <div className=\"w-10 h-10 rounded-full border-2 border-[#0a0a0a] bg-slate-800 flex items-center justify-center text-xs text-white font-bold\">\n                                                                        +{o.items.length - 4}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Acciones */}\n                                                            <div className=\"flex items-center gap-3 w-full lg:w-auto justify-end\">\n                                                                <button onClick={() => setSelectedOrder(o)} className=\"p-3 bg-slate-900 hover:bg-slate-800 text-slate-300 hover:text-white rounded-xl transition border border-slate-800\" title=\"Ver Detalles\">\n                                                                    <Eye className=\"w-5 h-5\" />\n                                                                </button>\n\n                                                                {o.status !== 'Realizado' && (\n                                                                    <button onClick={() => finalizeOrderFn(o.id)} className=\"p-3 bg-green-900/10 hover:bg-green-600 text-green-500 hover:text-white rounded-xl transition border border-green-500/20\" title=\"Marcar como Finalizado\">\n                                                                        <CheckCircle className=\"w-5 h-5\" />\n                                                                    </button>\n                                                                )}\n\n                                                                <button onClick={() => deleteOrderFn(o.id)} className=\"p-3 bg-red-900/10 hover:bg-red-600 text-red-500 hover:text-white rounded-xl transition border border-red-500/20\" title=\"Eliminar Pedido\">\n                                                                    <Trash2 className=\"w-5 h-5\" />\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    ))}\n\n                                                    {/* Paginaci√≥n */}\n                                                    <div className=\"flex items-center justify-center gap-4 mt-10 pb-10\">\n                                                        <button\n                                                            onClick={handlePrevOrders}\n                                                            disabled={ordersHistory.length === 0}\n                                                            className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition ${ordersHistory.length === 0 ? 'bg-slate-900 text-slate-700 cursor-not-allowed' : 'bg-slate-800 text-white hover:bg-slate-700'}`}\n                                                        >\n                                                            <ChevronLeft className=\"w-5 h-5\" /> Anterior\n                                                        </button>\n                                                        <span className=\"text-slate-500 font-mono text-sm\">\n                                                            P√°gina {ordersHistory.length + 1}\n                                                        </span>\n                                                        <button\n                                                            onClick={handleNextOrders}\n                                                            disabled={!hasMoreOrders || orders.length < ordersLimit}\n                                                            className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold transition ${(!hasMoreOrders || orders.length < ordersLimit) ? 'bg-slate-900 text-slate-700 cursor-not-allowed' : 'bg-orange-600 text-white hover:bg-orange-500'}`}\n                                                        >\n                                                            Siguiente <ChevronRight className=\"w-5 h-5\" />\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n\n                                    {/* TAB: PRODUCTOS (LISTA Y FORMULARIO) */}\n                                    {adminTab === 'products' && (\n                                        <div className=\"max-w-7xl mx-auto animate-fade-in pb-20\">\n                                            <div className=\"flex justify-between items-center mb-8\">\n                                                <div>\n                                                    <h1 className=\"text-3xl font-black text-white\">Inventario</h1>\n                                                    {(() => {\n                                                        const plan = settings?.subscriptionPlan || 'entrepreneur';\n                                                        const limit = plan === 'premium' ? '‚àû' : plan === 'business' ? 50 : 30;\n                                                        const current = products.length;\n                                                        const isNearLimit = plan !== 'premium' && current >= limit * 0.8;\n                                                        return (\n                                                            <p className={`text-sm font-bold mt-1 ${isNearLimit ? 'text-yellow-400' : 'text-slate-500'}`}>\n                                                                {current} / {limit} productos\n                                                                {isNearLimit && plan !== 'premium' && <span className=\"text-yellow-500 ml-2\">‚ö† Cerca del l√≠mite</span>}\n                                                            </p>\n                                                        );\n                                                    })()}\n                                                </div>\n                                                <div className=\"flex gap-2\">\n                                                    <AdminHowToUse guideKey=\"products\" />\n                                                    <button onClick={() => setShowCategoryModal(true)} className=\"bg-slate-800 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-slate-700 transition transform hover:scale-105 active:scale-95 border border-slate-700\">\n                                                        <FolderPlus className=\"w-5 h-5\" /> Categor√≠as\n                                                    </button>\n                                                    <button onClick={() => { setNewProduct({}); setEditingId(null); setShowProductForm(true) }} className=\"bg-orange-600 px-6 py-3 rounded-xl font-bold text-white flex gap-2 shadow-lg hover:bg-orange-500 transition transform hover:scale-105 active:scale-95\">\n                                                        <Plus className=\"w-5 h-5\" /> Agregar Producto\n                                                    </button>\n                                                </div>\n                                            </div>\n\n                                            {/* Banner de advertencia si hay productos desactivados por l√≠mite de plan */}\n                                            {(() => {\n                                                const deactivatedByPlan = products.filter(p => p.isActive === false && p.deactivatedByPlan);\n                                                const deactivatedManually = products.filter(p => p.isActive === false && !p.deactivatedByPlan);\n                                                const totalDeactivated = products.filter(p => p.isActive === false);\n\n                                                if (totalDeactivated.length > 0) {\n                                                    return (\n                                                        <div className=\"bg-yellow-900/20 border border-yellow-500/30 p-4 rounded-2xl mb-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n                                                            <div className=\"flex items-start gap-3\">\n                                                                <AlertTriangle className=\"w-6 h-6 text-yellow-400 flex-shrink-0 mt-0.5\" />\n                                                                <div>\n                                                                    <p className=\"font-bold text-yellow-400\">\n                                                                        {totalDeactivated.length} producto(s) desactivado(s)\n                                                                    </p>\n                                                                    <p className=\"text-sm text-yellow-200/70\">\n                                                                        {deactivatedByPlan.length > 0 && `${deactivatedByPlan.length} por l√≠mite de plan. `}\n                                                                        {deactivatedManually.length > 0 && `${deactivatedManually.length} desactivado(s) manualmente. `}\n                                                                        Los productos desactivados no se muestran en la tienda.\n                                                                    </p>\n                                                                </div>\n                                                            </div>\n                                                            <button\n                                                                onClick={() => showToast(\"Usa el bot√≥n de ojo (üëÅ) en cada producto para activar/desactivar\", \"info\")}\n                                                                className=\"px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-xl font-bold text-sm hover:bg-yellow-500/30 transition border border-yellow-500/30 whitespace-nowrap\"\n                                                            >\n                                                                Ver desactivados\n                                                            </button>\n                                                        </div>\n                                                    );\n                                                }\n                                                return null;\n                                            })()}\n\n                                            {/* Formulario Productos (Expandido) */}\n                                            {showProductForm && (\n                                                <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] mb-10 shadow-2xl relative\">\n                                                    <h3 className=\"text-xl font-bold text-white mb-6\">\n                                                        {editingId ? 'Editar Producto' : 'Nuevo Producto'}\n                                                    </h3>\n\n                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n                                                        <div className=\"space-y-4\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Producto\" value={newProduct.name || ''} onChange={e => setNewProduct({ ...newProduct, name: e.target.value })} />\n                                                            <div className=\"flex gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Precio Venta ($)\" value={newProduct.basePrice || ''} onChange={e => setNewProduct({ ...newProduct, basePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Costo Compra ($)\" value={newProduct.purchasePrice || ''} onChange={e => setNewProduct({ ...newProduct, purchasePrice: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" type=\"number\" placeholder=\"Stock\" value={newProduct.stock || ''} onChange={e => setNewProduct({ ...newProduct, stock: e.target.value })} />\n                                                            </div>\n                                                            <div className=\"space-y-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2\">\n                                                                    Categor√≠as (Selecciona una o m√°s)\n                                                                </label>\n                                                                <div className=\"bg-slate-900/50 border border-slate-700 rounded-xl p-4 max-h-64 overflow-y-auto custom-scrollbar\">\n                                                                    {(settings?.categories || []).length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 py-4 text-sm\">\n                                                                            No hay categor√≠as disponibles. Agr√©galas abajo.\n                                                                        </p>\n                                                                    ) : (\n                                                                        (settings?.categories || []).map(cat => {\n                                                                            // Soporte retrocompatible: verificar tanto categories (array) como category (string)\n                                                                            const isSelected = Array.isArray(newProduct.categories)\n                                                                                ? newProduct.categories.includes(cat)\n                                                                                : (newProduct.category === cat);\n\n                                                                            return (\n                                                                                <label\n                                                                                    key={cat}\n                                                                                    className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all group hover:bg-slate-800 mb-2 last:mb-0 ${isSelected ? 'bg-orange-900/20 border border-orange-500/30' : 'border border-transparent'\n                                                                                        }`}\n                                                                                >\n                                                                                    <input\n                                                                                        type=\"checkbox\"\n                                                                                        checked={isSelected}\n                                                                                        onChange={(e) => {\n                                                                                            if (e.target.checked) {\n                                                                                                // Agregar categor√≠a\n                                                                                                const current = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories\n                                                                                                    : (newProduct.category ? [newProduct.category] : []);\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: [...current, cat],\n                                                                                                    category: undefined // Eliminar el campo antiguo\n                                                                                                });\n                                                                                            } else {\n                                                                                                // Remover categor√≠a\n                                                                                                const updated = Array.isArray(newProduct.categories)\n                                                                                                    ? newProduct.categories.filter(c => c !== cat)\n                                                                                                    : [];\n                                                                                                setNewProduct({\n                                                                                                    ...newProduct,\n                                                                                                    categories: updated\n                                                                                                });\n                                                                                            }\n                                                                                        }}\n                                                                                        className=\"w-4 h-4 text-orange-600 bg-slate-900 border-slate-600 rounded focus:ring-orange-500 focus:ring-2\"\n                                                                                    />\n                                                                                    <span className={`flex-1 text-sm font-medium transition-colors ${isSelected ? 'text-orange-400' : 'text-slate-300 group-hover:text-white'\n                                                                                        }`}>\n                                                                                        {cat}\n                                                                                    </span>\n                                                                                    {isSelected && (\n                                                                                        <span className=\"text-xs font-bold text-orange-500 bg-orange-500/10 px-2 py-0.5 rounded flex items-center gap-1\">\n                                                                                            <CheckCircle className=\"w-3 h-3\" />\n                                                                                        </span>\n                                                                                    )}\n                                                                                </label>\n                                                                            );\n                                                                        })\n                                                                    )}\n                                                                </div>\n                                                                {/* Mostrar categor√≠as seleccionadas como tags */}\n                                                                {newProduct.categories && newProduct.categories.length > 0 && (\n                                                                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                                                                        {newProduct.categories.map(cat => (\n                                                                            <span\n                                                                                key={cat}\n                                                                                className=\"bg-orange-500/20 text-orange-400 text-xs font-bold px-3 py-1.5 rounded-full border border-orange-500/30 flex items-center gap-2\"\n                                                                            >\n                                                                                {cat}\n                                                                                <button\n                                                                                    type=\"button\"\n                                                                                    onClick={() => {\n                                                                                        setNewProduct({\n                                                                                            ...newProduct,\n                                                                                            categories: newProduct.categories.filter(c => c !== cat)\n                                                                                        });\n                                                                                    }}\n                                                                                    className=\"hover:text-orange-300 transition\"\n                                                                                >\n                                                                                    <X className=\"w-3 h-3\" />\n                                                                                </button>\n                                                                            </span>\n                                                                        ))}\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <button\n                                                                type=\"button\"\n                                                                onClick={() => setShowCategoryModal(true)}\n                                                                className=\"w-full mt-2 py-2 bg-orange-900/20 hover:bg-orange-900/40 text-orange-400 rounded-xl font-bold transition flex items-center justify-center gap-2 text-sm border border-orange-800\"\n                                                            >\n                                                                <FolderPlus className=\"w-4 h-4\" /> Nueva Categor√≠a\n                                                            </button>\n                                                        </div>\n\n                                                        <div className=\"space-y-4\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Imagen del Producto\n                                                                </label>\n                                                                <div className=\"space-y-3\">\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewProduct)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newProduct.image && (\n                                                                        <div className=\"bg-white rounded-xl p-3 w-32 h-32\">\n                                                                            <img src={newProduct.image} className=\"w-full h-full object-contain\" alt=\"Preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                    Descuento (%)\n                                                                </label>\n                                                                <p className=\"text-xs text-slate-400 mb-2\">Porcentaje de descuento sobre el precio base (0-100)</p>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    min=\"0\"\n                                                                    max=\"100\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    placeholder=\"0\"\n                                                                    value={newProduct.discount || 0}\n                                                                    onChange={e => setNewProduct({ ...newProduct, discount: parseFloat(e.target.value) || 0 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <textarea className=\"input-cyber w-full h-32 p-4 mb-6 resize-none\" placeholder=\"Descripci√≥n detallada del producto...\" value={newProduct.description || ''} onChange={e => setNewProduct({ ...newProduct, description: e.target.value })} />\n\n                                                    <div className=\"flex gap-4 justify-end\">\n                                                        <button onClick={() => setShowProductForm(false)} className=\"px-6 py-3 text-slate-400 font-bold hover:text-white transition\">Cancelar</button>\n                                                        <button onClick={saveProductFn} className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\">Guardar Producto</button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Lista de Productos */}\n                                            <div className=\"grid gap-3\">\n                                                {products.map((p, idx) => (\n                                                    <div\n                                                        key={p.id}\n                                                        style={{ animationDelay: `${idx * 0.05}s` }}\n                                                        className={`bg-[#0a0a0a] border p-4 rounded-xl flex flex-col sm:flex-row justify-between items-center group hover:border-orange-900/50 transition animate-fade-up ${p.isActive === false ? 'border-yellow-500/30 opacity-60' : 'border-slate-800'}`}\n                                                    >\n                                                        <div className=\"flex items-center gap-6 w-full sm:w-auto\">\n                                                            <div className={`w-16 h-16 bg-white rounded-lg p-2 flex-shrink-0 relative ${p.isActive === false ? 'grayscale' : ''}`}>\n                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                {p.isFeatured && (\n                                                                    <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg\">\n                                                                        <Star className=\"w-3 h-3 text-black fill-current\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-lg flex items-center gap-2\">\n                                                                    {p.name}\n                                                                    {p.isFeatured && <span className=\"text-[10px] bg-yellow-500/20 text-yellow-400 px-2 py-0.5 rounded-full font-bold\">DESTACADO</span>}\n                                                                    {p.isActive === false && <span className=\"text-[10px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full font-bold\">OCULTO{p.deactivatedByPlan ? ' (L√çMITE)' : ''}</span>}\n                                                                </p>\n                                                                <p className=\"text-xs text-slate-500 font-mono\">\n                                                                    Stock: <span className={(p.stock || 0) < (settings?.lowStockThreshold || 5) ? 'text-red-400 font-bold animate-pulse' : 'text-slate-400'}>{p.stock || 0}</span> |\n                                                                    <span className=\"text-orange-400 font-bold ml-2\" title=\"Precio Venta\">${Number(p.basePrice).toLocaleString()}</span> |\n                                                                    <span className=\"text-slate-500 ml-2 font-mono\" title=\"Costo Adquisici√≥n\">Costo: ${Number(p.purchasePrice || 0).toLocaleString()}</span>\n                                                                    {Number(p.basePrice) > 0 && (\n                                                                        <span className={`ml-2 text-[10px] font-black px-1.5 py-0.5 rounded border ${((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) < 0.3 ? 'bg-red-900/20 text-red-400 border-red-500/20' : 'bg-green-900/20 text-green-400 border-green-500/20'}`}>\n                                                                            {(((Number(p.basePrice) - Number(p.purchasePrice || 0)) / Number(p.basePrice)) * 100).toFixed(0)}%\n                                                                        </span>\n                                                                    )} |\n                                                                    <span className=\"text-green-400 ml-2\">Ventas: {(dashboardMetrics?.salesCount?.[p.id] || 0)}</span>\n                                                                </p>\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto justify-end items-center\">\n                                                            {/* Toggle Featured */}\n                                                            <button\n                                                                onClick={async () => {\n                                                                    try {\n                                                                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', p.id), {\n                                                                            isFeatured: !p.isFeatured\n                                                                        });\n                                                                        showToast(p.isFeatured ? \"Producto quitado de destacados\" : \"Producto marcado como destacado\", \"success\");\n                                                                    } catch (e) {\n                                                                        console.error(e);\n                                                                        showToast(\"Error al actualizar\", \"error\");\n                                                                    }\n                                                                }}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isFeatured ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30 hover:bg-yellow-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-yellow-400 hover:border-yellow-500/30'}`}\n                                                                title={p.isFeatured ? \"Quitar de Destacados\" : \"Marcar como Destacado\"}\n                                                            >\n                                                                <Star className={`w-5 h-5 ${p.isFeatured ? 'fill-current' : ''}`} />\n                                                            </button>\n                                                            {/* Toggle Activar/Desactivar */}\n                                                            <button\n                                                                onClick={() => p.isActive === false ? reactivateProduct(p.id) : deactivateProduct(p.id)}\n                                                                className={`p-3 rounded-xl transition border transform hover:scale-105 active:scale-95 ${p.isActive === false ? 'bg-red-500/20 text-red-400 border-red-500/30 hover:bg-green-500/20 hover:text-green-400 hover:border-green-500/30' : 'bg-slate-900 text-slate-500 border-slate-800 hover:text-red-400 hover:border-red-500/30'}`}\n                                                                title={p.isActive === false ? \"Activar Producto (hacerlo visible en tienda)\" : \"Desactivar Producto (ocultarlo de la tienda)\"}\n                                                            >\n                                                                {p.isActive === false ? <Eye className=\"w-5 h-5\" /> : <EyeOff className=\"w-5 h-5\" />}\n                                                            </button>\n                                                            <button onClick={() => openManualSaleModal(p)} className=\"p-3 bg-slate-900 rounded-xl text-green-400 hover:bg-green-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\" title=\"Venta Manual (Descontar 1)\">\n                                                                <DollarSign className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => { setNewProduct(p); setEditingId(p.id); setShowProductForm(true) }} className=\"p-3 bg-slate-900 rounded-xl text-orange-400 hover:bg-orange-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Edit className=\"w-5 h-5\" />\n                                                            </button>\n                                                            <button onClick={() => deleteProductFn(p)} className=\"p-3 bg-slate-900 rounded-xl text-red-400 hover:bg-red-900/20 transition border border-slate-800 transform hover:scale-105 active:scale-95\">\n                                                                <Trash2 className=\"w-5 h-5\" />\n                                                            </button>\n                                                        </div>\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        </div>\n                                    )}\n\n\n\n                                    {/* TAB: CONFIGURACI√ìN AVANZADA (NEW) */}\n                                    {adminTab === 'settings' && (\n                                        <div className=\"max-w-6xl mx-auto animate-fade-up pb-20 relative\">\n\n                                            {/* Developer-Only Access Block */}\n                                            {currentUser?.email !== SUPER_ADMIN_EMAIL && (\n                                                <div className=\"absolute inset-0 z-30 flex items-center justify-center bg-black/90 backdrop-blur-md rounded-[2.5rem]\">\n                                                    <div className=\"text-center p-8 max-w-lg\">\n                                                        <div className=\"w-24 h-24 mx-auto mb-6 bg-red-500/20 rounded-full flex items-center justify-center border border-red-500/30\">\n                                                            <Shield className=\"w-12 h-12 text-red-400\" />\n                                                        </div>\n                                                        <h3 className=\"text-3xl font-black text-white mb-4\">Acceso Restringido</h3>\n                                                        <p className=\"text-slate-400 mb-6\">Esta secci√≥n est√° reservada √∫nicamente para el <span className=\"text-orange-400 font-bold\">desarrollador</span> de la plataforma.</p>\n                                                        <div className=\"bg-slate-900/50 p-4 rounded-xl border border-slate-800 mb-6\">\n                                                            <p className=\"text-sm text-slate-500 mb-2\">Para solicitar cambios en la configuraci√≥n, contacta a:</p>\n                                                            <p className=\"text-orange-400 font-bold text-lg\">lautarocorazza63@gmail.com</p>\n                                                        </div>\n                                                        <p className=\"text-xs text-slate-600\">Si necesitas modificar tu tienda, env√≠a un email detallando los cambios que deseas realizar.</p>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            <h1 className=\"text-4xl font-black text-white neon-text mb-8 flex items-center gap-3\">\n                                                <Settings className=\"w-8 h-8 text-orange-500 animate-spin-slow\" /> Configuraci√≥n General\n                                            </h1>\n\n                                            {/* Sub-Navigation Tabs */}\n                                            <div className=\"flex flex-wrap gap-2 mb-8 pb-4 border-b border-slate-800\">\n                                                {[\n                                                    { id: 'store', label: 'Tienda', icon: Store },\n                                                    { id: 'appearance', label: 'Apariencia', icon: Palette },\n                                                    { id: 'social', label: 'Redes', icon: Share2 },\n                                                    { id: 'payments', label: 'Pagos', icon: CreditCard },\n                                                    { id: 'ticket', label: 'Ticket', icon: Ticket },\n                                                    { id: 'shipping', label: 'Env√≠os', icon: Truck },\n                                                    { id: 'seo', label: 'SEO', icon: Globe },\n                                                    { id: 'advanced', label: 'Avanzado', icon: Cog },\n                                                    { id: 'team', label: 'Equipo', icon: Users },\n                                                    // Only show Subscription tab to Super Admin\n                                                    ...(currentUser?.email === SUPER_ADMIN_EMAIL ? [{ id: 'subscription', label: 'Suscripciones', icon: Zap }] : [])\n                                                ].map(tab => (\n                                                    <button\n                                                        key={tab.id}\n                                                        onClick={() => setSettingsTab(tab.id)}\n                                                        className={`px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2 transition-all duration-300 border ${settingsTab === tab.id ? 'bg-orange-600 text-white shadow-[0_0_20px_rgba(8,145,178,0.4)] border-orange-400 transform scale-105' : 'bg-slate-900 text-slate-400 hover:text-white hover:bg-slate-800 border-slate-800'}`}\n                                                    >\n                                                        <tab.icon className={`w-4 h-4 ${settingsTab === tab.id ? 'animate-pulse' : ''}`} /> {tab.label}\n                                                    </button>\n                                                ))}\n                                            </div>\n\n                                            {/* === SUBSCRIPTION MANAGEMENT (SUPER ADMIN ONLY) === */}\n                                            {settingsTab === 'subscription' && currentUser?.email === SUPER_ADMIN_EMAIL && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-orange-500/30 p-8 rounded-[2rem] shadow-[0_0_50px_rgba(249,115,22,0.1)]\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 flex items-center gap-3\">\n                                                            <Zap className=\"w-6 h-6 text-yellow-500 fill-current\" />\n                                                            Modelos de Suscripci√≥n\n                                                        </h3>\n\n                                                        <div className=\"mb-8 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl flex items-center gap-4\">\n                                                            <AlertTriangle className=\"w-8 h-8 text-yellow-500\" />\n                                                            <div>\n                                                                <p className=\"font-bold text-yellow-500\">Zona de Peligro: Super Admin</p>\n                                                                <p className=\"text-sm text-yellow-200\">Cambiar el plan afecta inmediatamente los l√≠mites y funcionalidades de la tienda.</p>\n                                                            </div>\n                                                        </div>\n\n                                                        <div className=\"mb-8 p-6 bg-slate-900/40 border border-slate-800 rounded-2xl\">\n                                                            <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                                                                <div>\n                                                                    <p className=\"text-white font-black text-lg\">Backup de Tienda</p>\n                                                                    <p className=\"text-slate-500 text-xs font-mono\">storeId: {appId || '‚Äî'}</p>\n                                                                </div>\n                                                                <div className=\"flex items-center gap-2\">\n                                                                    <button\n                                                                        disabled={isExportingBackup || !appId}\n                                                                        onClick={exportBackup}\n                                                                        className=\"px-4 py-3 rounded-xl bg-green-500/10 border border-green-500/20 text-green-400 font-black text-[10px] uppercase tracking-widest hover:bg-green-500/20 transition disabled:opacity-50\"\n                                                                    >\n                                                                        {isExportingBackup ? 'Exportando‚Ä¶' : 'Exportar'}\n                                                                    </button>\n                                                                    <label className={`px-4 py-3 rounded-xl bg-indigo-600/20 border border-indigo-500/30 text-indigo-200 font-black text-[10px] uppercase tracking-widest hover:bg-indigo-600/30 transition ${isImportingBackup || !appId ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                        {isImportingBackup ? 'Importando‚Ä¶' : 'Importar'}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"application/json\"\n                                                                            className=\"hidden\"\n                                                                            onChange={(e) => {\n                                                                                const file = e.target.files && e.target.files[0];\n                                                                                if (file) importBackupFile(file);\n                                                                                e.target.value = '';\n                                                                            }}\n                                                                        />\n                                                                    </label>\n                                                                </div>\n                                                            </div>\n                                                            <p className=\"text-slate-600 text-xs mt-4\">Importar escribe con merge (no borra por defecto). Usalo con cuidado.</p>\n                                                        </div>\n\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            {/* Plan Emprendedor */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('entrepreneur')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan ? 'bg-slate-900 border-orange-500 shadow-[0_0_30px_rgba(249,115,22,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Store className=\"w-6 h-6 text-orange-400\" />\n                                                                    </div>\n                                                                    {(settings.subscriptionPlan === 'entrepreneur' || !settings.subscriptionPlan) && <div className=\"bg-orange-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Emprendedor</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">El esencial para arrancar s√≥lido pero econ√≥mico.</p>\n                                                                <div className=\"text-2xl font-black text-orange-400 mb-6\">$7.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Hasta 30 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Dominio Vercel</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500\" /> Mercado Pago Directo</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Negocio */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('business')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'business' ? 'bg-slate-900 border-purple-500 shadow-[0_0_30px_rgba(168,85,247,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Briefcase className=\"w-6 h-6 text-purple-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'business' && <div className=\"bg-purple-500 text-white text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Negocio</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Para marcas con identidad definida.</p>\n                                                                <div className=\"text-2xl font-black text-purple-400 mb-6\">$14.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Hasta 50 productos</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Personalizaci√≥n Visual</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500\" /> Bot√≥n WhatsApp</li>\n                                                                </ul>\n                                                            </button>\n\n                                                            {/* Plan Premium */}\n                                                            <button\n                                                                onClick={() => handlePlanChange('premium')}\n                                                                className={`relative p-6 rounded-2xl border-2 transition-all duration-300 text-left group ${settings.subscriptionPlan === 'premium' ? 'bg-slate-900 border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.2)] scale-105 z-10' : 'bg-[#050505] border-slate-800 hover:border-slate-600 opacity-60 hover:opacity-100'}`}\n                                                            >\n                                                                <div className=\"flex justify-between items-start mb-4\">\n                                                                    <div className=\"p-3 bg-slate-800 rounded-xl\">\n                                                                        <Sparkles className=\"w-6 h-6 text-yellow-400\" />\n                                                                    </div>\n                                                                    {settings.subscriptionPlan === 'premium' && <div className=\"bg-yellow-500 text-black text-xs font-black px-2 py-1 rounded\">ACTIVO</div>}\n                                                                </div>\n                                                                <h4 className=\"text-xl font-black text-white mb-1\">Premium</h4>\n                                                                <p className=\"text-sm text-slate-400 mb-4 h-10\">Servicio Full con IA.</p>\n                                                                <div className=\"text-2xl font-black text-yellow-400 mb-6\">$22.000 <span className=\"text-sm text-slate-500 font-normal\">/mes</span></div>\n\n                                                                <ul className=\"space-y-2 text-sm text-slate-300\">\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Ilimitado / Full IA</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Carga Inicial (10)</li>\n                                                                    <li className=\"flex items-center gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500\" /> Mantenimiento Mensual</li>\n                                                                </ul>\n                                                            </button>\n                                                        </div>\n\n                                                        {/* Billing Cycle Selection */}\n                                                        <div className=\"mt-8 pt-8 border-t border-slate-800/50\">\n                                                            <h4 className=\"text-lg font-bold text-slate-300 mb-4 flex items-center gap-2\">\n                                                                <Calendar className=\"w-5 h-5 text-green-400\" /> Ciclo de Facturaci√≥n\n                                                            </h4>\n                                                            <div className=\"grid grid-cols-3 gap-4\">\n                                                                {[\n                                                                    { id: 'Semanal', label: 'Semanal' },\n                                                                    { id: 'Mensual', label: 'Mensual' },\n                                                                    { id: 'Anual', label: 'Anual' }\n                                                                ].map(cycle => (\n                                                                    <button\n                                                                        key={cycle.id}\n                                                                        onClick={() => setSettings({ ...settings, subscriptionBillingCycle: cycle.id })}\n                                                                        className={`p-3 rounded-xl border transition-all font-bold ${settings?.subscriptionBillingCycle === cycle.id\n                                                                            ? 'bg-green-500 text-black border-green-400 shadow-lg shadow-green-500/20'\n                                                                            : 'bg-slate-900 text-slate-400 border-slate-800 hover:bg-slate-800'\n                                                                            }`}\n                                                                    >\n                                                                        {cycle.label}\n                                                                    </button>\n                                                                ))}\n                                                            </div>\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Define la frecuencia de cobro para este plan.</p>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'store' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Informaci√≥n de la Tienda\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre de la Tienda</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeName || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeName: e.target.value })}\n                                                                    placeholder=\"Mi Tienda\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Email de Contacto</label>\n                                                                <input\n                                                                    type=\"email\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeEmail || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                    placeholder=\"contacto@mitienda.com\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tel√©fono</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storePhone || ''}\n                                                                    onChange={e => setSettings({ ...settings, storePhone: e.target.value })}\n                                                                    placeholder=\"+54 11 1234-5678\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Direcci√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.storeAddress || ''}\n                                                                    onChange={e => setSettings({ ...settings, storeAddress: e.target.value })}\n                                                                    placeholder=\"Av. Corrientes 1234, CABA\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n de la Tienda</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-24 resize-none\"\n                                                                value={settings?.storeDescription || ''}\n                                                                onChange={e => setSettings({ ...settings, storeDescription: e.target.value })}\n                                                                placeholder=\"Breve descripci√≥n de tu tienda...\"\n                                                            />\n                                                        </div>\n                                                        <div className=\"mt-6\">\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto de Nosotros</label>\n                                                            <textarea\n                                                                className=\"input-cyber w-full p-4 h-32 resize-none\"\n                                                                value={settings?.aboutUsText || ''}\n                                                                onChange={e => setSettings({ ...settings, aboutUsText: e.target.value })}\n                                                                placeholder=\"Historia de tu marca, valores, misi√≥n...\"\n                                                            />\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Copyright Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-orange-400\" /> Textos de Copyright\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Men√∫ Lateral</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.menuCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, menuCopyright: e.target.value })}\n                                                                    placeholder={`${settings?.storeName || 'Mi Tienda'} ¬© ${new Date().getFullYear()}`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece al final del men√∫ hamburguesa</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Copyright del Footer</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerCopyright || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerCopyright: e.target.value })}\n                                                                    placeholder={`¬© ${new Date().getFullYear()} ${settings?.storeName || 'Mi Tienda'}. All rights reserved.`}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en la barra inferior del sitio</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Gu√≠a \"C√≥mo Comprar\" Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileQuestion className=\"w-5 h-5 text-orange-400\" /> Gu√≠a \"C√≥mo Comprar\"\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar la p√°gina */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar en Men√∫</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar enlace \"C√≥mo Comprar\" en el men√∫ lateral</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showGuideLink: settings?.showGuideLink === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showGuideLink !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideLink !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* T√≠tulo de la p√°gina */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo de la P√°gina</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.guideTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, guideTitle: e.target.value })}\n                                                                    placeholder=\"C√≥mo Comprar\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Paso 1 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">1</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 1</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep1: settings?.showGuideStep1 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep1 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Title: e.target.value })}\n                                                                        placeholder=\"Selecciona Productos\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep1Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep1Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 2 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">2</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 2</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep2: settings?.showGuideStep2 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep2 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep2 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Title: e.target.value })}\n                                                                        placeholder=\"Revisa tu Carrito\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep2Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep2Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 3 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">3</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 3</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep3: settings?.showGuideStep3 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep3 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep3 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Title: e.target.value })}\n                                                                        placeholder=\"Datos de Env√≠o\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep3Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep3Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 4 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">4</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 4</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep4: settings?.showGuideStep4 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep4 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep4 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep4 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Title: e.target.value })}\n                                                                        placeholder=\"Pago y Confirmaci√≥n\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep4Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep4Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep4 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Paso 5 */}\n                                                            <div className=\"border-t border-slate-800 pt-4\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"w-6 h-6 rounded-full bg-orange-900/30 text-orange-400 text-xs font-bold flex items-center justify-center\">5</span>\n                                                                        <label className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Paso 5</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showGuideStep5: settings?.showGuideStep5 === false ? true : false })}\n                                                                        className={`w-10 h-5 rounded-full transition-all duration-300 relative ${settings?.showGuideStep5 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-3 h-3 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showGuideStep5 !== false ? 'left-6' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-3 ${settings?.showGuideStep5 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Title: e.target.value })}\n                                                                        placeholder=\"¬°Listo!\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.guideStep5Text || ''}\n                                                                        onChange={e => setSettings({ ...settings, guideStep5Text: e.target.value })}\n                                                                        placeholder=\"Descripci√≥n del paso...\"\n                                                                        disabled={settings?.showGuideStep5 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Bell className=\"w-5 h-5 text-yellow-400\" /> Anuncios\n                                                        </h3>\n                                                        <div>\n                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Anuncio (Banner superior)</label>\n                                                            <input\n                                                                className=\"input-cyber w-full p-4\"\n                                                                value={settings?.announcementMessage || ''}\n                                                                onChange={e => setSettings({ ...settings, announcementMessage: e.target.value })}\n                                                                placeholder=\"üî• ¬°Env√≠o gratis en compras mayores a $50.000!\"\n                                                            />\n                                                            <p className=\"text-xs text-slate-500 mt-2\">Dejar vac√≠o para ocultar el banner.</p>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Zap className=\"w-5 h-5 text-yellow-500\" /> Pantalla de Carga\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingTitle: e.target.value })}\n                                                                    placeholder={settings?.storeName || \"SUSTORE\"}\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Aparece en grande (ej. SUSTORE).</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Mensaje de Carga</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Texto peque√±o debajo del t√≠tulo.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === APPEARANCE === */}\n                                            {settingsTab === 'appearance' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Im√°genes\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen Hero (Banner Principal)</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Logo de la Tienda</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'logoUrl')}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                />\n                                                                {settings?.logoUrl && (\n                                                                    <div className=\"mt-4 w-24 h-24 rounded-xl overflow-hidden border border-slate-700 bg-white p-2\">\n                                                                        <img src={settings.logoUrl} className=\"w-full h-full object-contain\" alt=\"Logo Preview\" />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Play className=\"w-5 h-5 text-orange-400\" /> Carrusel Home\n                                                        </h3>\n\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Mostrar carrusel</p>\n                                                                        <p className=\"text-xs text-slate-500\">Si est√° apagado, se usa la imagen Hero tradicional.</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showHomeBannerCarousel: settings?.showHomeBannerCarousel === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.showHomeBannerCarousel !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showHomeBannerCarousel !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Cambio autom√°tico (segundos)</label>\n                                                                    <input\n                                                                        type=\"number\"\n                                                                        min=\"1\"\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={Number.isFinite(Number(settings?.homeBannerAutoplayMs)) ? Math.max(1, Math.round(Number(settings.homeBannerAutoplayMs) / 1000)) : 5}\n                                                                        onChange={(e) => {\n                                                                            const seconds = Number(e.target.value);\n                                                                            const safeSeconds = Number.isFinite(seconds) ? Math.max(1, seconds) : 5;\n                                                                            setSettings({ ...settings, homeBannerAutoplayMs: Math.round(safeSeconds * 1000) });\n                                                                        }}\n                                                                    />\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                                                                <div className=\"lg:col-span-1\">\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen del slide</label>\n                                                                    <input\n                                                                        type=\"file\"\n                                                                        accept=\"image/*\"\n                                                                        onChange={(e) => handleImageUpload(e, setNewHomeBanner, 'imageUrl', 1400)}\n                                                                        className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-900/20 file:text-orange-400 hover:file:bg-orange-900/40 transition\"\n                                                                    />\n                                                                    {newHomeBanner?.imageUrl && (\n                                                                        <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-28\">\n                                                                            <img src={newHomeBanner.imageUrl} className=\"w-full h-full object-cover\" alt=\"Banner preview\" />\n                                                                        </div>\n                                                                    )}\n                                                                </div>\n\n                                                                <div className=\"lg:col-span-2 space-y-4\">\n                                                                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Acci√≥n al hacer click</label>\n                                                                            <select\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={newHomeBanner?.targetType || 'none'}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetType: e.target.value, targetId: '' }))}\n                                                                            >\n                                                                                <option value=\"none\">Solo mostrar (sin link)</option>\n                                                                                <option value=\"product\">Abrir producto</option>\n                                                                                <option value=\"promo\">Abrir promo</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Orden (0 = primero)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-3\"\n                                                                                value={Number.isFinite(Number(newHomeBanner?.order)) ? Number(newHomeBanner.order) : 0}\n                                                                                onChange={(e) => setNewHomeBanner(prev => ({ ...prev, order: e.target.value }))}\n                                                                            />\n                                                                            <p className=\"text-xs text-slate-500 mt-2\">Menor n√∫mero aparece primero (0, 1, 2...).</p>\n                                                                        </div>\n                                                                    </div>\n\n                                                                    {newHomeBanner?.targetType !== 'none' && (\n                                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                            <div>\n                                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">\n                                                                                    {newHomeBanner?.targetType === 'promo' ? 'Promo al hacer click' : 'Producto al hacer click'}\n                                                                                </label>\n                                                                                <select\n                                                                                    className=\"input-cyber w-full p-3\"\n                                                                                    value={newHomeBanner?.targetId || ''}\n                                                                                    onChange={(e) => setNewHomeBanner(prev => ({ ...prev, targetId: e.target.value }))}\n                                                                                >\n                                                                                    <option value=\"\">Seleccionar...</option>\n                                                                                    {(newHomeBanner?.targetType === 'promo' ? [...promos] : [...products])\n                                                                                        .sort((a, b) => (a?.name || '').localeCompare(b?.name || ''))\n                                                                                        .map(item => (\n                                                                                            <option key={item.id} value={item.id}>{item.name}</option>\n                                                                                        ))}\n                                                                                </select>\n                                                                            </div>\n                                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 flex items-center gap-4\">\n                                                                                {(() => {\n                                                                                    const isPromo = newHomeBanner?.targetType === 'promo';\n                                                                                    const item = isPromo\n                                                                                        ? promos.find(p => p.id === newHomeBanner?.targetId)\n                                                                                        : products.find(p => p.id === newHomeBanner?.targetId);\n                                                                                    const img = isPromo ? item?.image : item?.image;\n                                                                                    return (\n                                                                                        <>\n                                                                                            <div className=\"w-16 h-16 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                                {img ? <img src={img} className=\"w-full h-full object-cover\" alt=\"Preview\" /> : <ImageIcon className=\"w-6 h-6 text-slate-600\" />}\n                                                                                            </div>\n                                                                                            <div className=\"min-w-0\">\n                                                                                                <p className=\"text-xs text-slate-500 font-bold uppercase tracking-wider\">Vista previa</p>\n                                                                                                <p className=\"font-black text-white truncate\">{item?.name || 'Sin selecci√≥n'}</p>\n                                                                                            </div>\n                                                                                        </>\n                                                                                    );\n                                                                                })()}\n                                                                            </div>\n                                                                        </div>\n                                                                    )}\n\n                                                                    <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\n                                                                        <div className=\"flex items-center justify-between flex-1 p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                            <div>\n                                                                                <p className=\"font-bold text-white\">Slide habilitado</p>\n                                                                                <p className=\"text-xs text-slate-500\">Si est√° apagado no se muestra.</p>\n                                                                            </div>\n                                                                            <button\n                                                                                onClick={() => setNewHomeBanner(prev => ({ ...prev, enabled: prev?.enabled === false ? true : false }))}\n                                                                                className={`w-14 h-8 rounded-full transition relative ${newHomeBanner?.enabled !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                            >\n                                                                                <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${newHomeBanner?.enabled !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                            </button>\n                                                                        </div>\n\n                                                                        <div className=\"flex gap-3\">\n                                                                            {editingHomeBannerId && (\n                                                                                <button\n                                                                                    onClick={resetHomeBannerForm}\n                                                                                    className=\"px-6 py-3 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition\"\n                                                                                >\n                                                                                    Cancelar\n                                                                                </button>\n                                                                            )}\n                                                                            <button\n                                                                                onClick={saveHomeBannerFn}\n                                                                                className=\"px-8 py-3 bg-orange-600 rounded-xl text-white font-bold shadow-lg hover:bg-orange-500 transition\"\n                                                                            >\n                                                                                {editingHomeBannerId ? 'Guardar Slide' : 'Agregar Slide'}\n                                                                            </button>\n                                                                        </div>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            <div className=\"space-y-3\">\n                                                                {homeBanners.length === 0 ? (\n                                                                    <p className=\"text-slate-500 text-sm\">Todav√≠a no hay slides en el carrusel.</p>\n                                                                ) : (\n                                                                    homeBanners.map(b => {\n                                                                        const targetType = b.targetType || (b.promoId ? 'promo' : b.productId ? 'product' : 'none');\n                                                                        const targetId = b.targetId || b.promoId || b.productId || '';\n                                                                        const targetItem = targetType === 'promo'\n                                                                            ? promos.find(p => p.id === targetId)\n                                                                            : targetType === 'product'\n                                                                                ? products.find(p => p.id === targetId)\n                                                                                : null;\n                                                                        const targetName = targetType === 'none'\n                                                                            ? 'Solo imagen'\n                                                                            : targetItem?.name || (targetType === 'promo' ? 'Promo inexistente' : 'Producto inexistente');\n                                                                        const isEnabled = b?.enabled !== false;\n                                                                        return (\n                                                                            <div key={b.id} className=\"flex flex-col md:flex-row md:items-center gap-4 p-4 bg-slate-900/40 rounded-2xl border border-slate-800\">\n                                                                                <div className=\"w-full md:w-40 h-20 rounded-xl overflow-hidden border border-slate-700 bg-black/30 flex-shrink-0\">\n                                                                                    {b?.imageUrl ? (\n                                                                                        <img src={b.imageUrl} className=\"w-full h-full object-cover\" alt=\"Slide\" />\n                                                                                    ) : null}\n                                                                                </div>\n                                                                                <div className=\"flex-1 min-w-0\">\n                                                                                    <div className=\"flex items-center gap-3 flex-wrap\">\n                                                                                        <div className=\"w-10 h-10 rounded-lg overflow-hidden border border-slate-700 bg-black/30 flex items-center justify-center flex-shrink-0\">\n                                                                                            {targetItem?.image ? <img src={targetItem.image} className=\"w-full h-full object-cover\" alt=\"Target\" /> : <ImageIcon className=\"w-4 h-4 text-slate-600\" />}\n                                                                                        </div>\n                                                                                        <p className=\"font-black text-white truncate\">{targetName}</p>\n                                                                                        <span className={`text-[10px] font-black px-2 py-1 rounded-lg border ${isEnabled ? 'text-green-400 border-green-500/30 bg-green-500/10' : 'text-slate-400 border-slate-700 bg-slate-800/30'}`}>\n                                                                                            {isEnabled ? 'ACTIVO' : 'PAUSADO'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            {targetType === 'promo' ? 'PROMO' : targetType === 'product' ? 'PRODUCTO' : 'SIN LINK'}\n                                                                                        </span>\n                                                                                        <span className=\"text-[10px] font-black px-2 py-1 rounded-lg border border-slate-700 bg-slate-800/30 text-slate-300\">\n                                                                                            ORDEN {Number.isFinite(Number(b.order)) ? Number(b.order) : 0}\n                                                                                        </span>\n                                                                                    </div>\n                                                                                    <p className=\"text-xs text-slate-500 mt-1 truncate\">{targetType === 'none' ? 'Click desactivado' : targetId}</p>\n                                                                                </div>\n                                                                                <div className=\"flex items-center gap-2\">\n                                                                                    <button\n                                                                                        onClick={() => editHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-slate-700 text-slate-200 hover:bg-slate-900/60 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Edit className=\"w-4 h-4\" /> Editar\n                                                                                    </button>\n                                                                                    <button\n                                                                                        onClick={() => deleteHomeBannerFn(b)}\n                                                                                        className=\"px-4 py-2 rounded-xl font-bold border border-red-500/30 text-red-400 hover:bg-red-500/10 transition flex items-center gap-2\"\n                                                                                    >\n                                                                                        <Trash2 className=\"w-4 h-4\" /> Eliminar\n                                                                                    </button>\n                                                                                </div>\n                                                                            </div>\n                                                                        );\n                                                                    })\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Palette className=\"w-5 h-5 text-pink-400\" /> Colores del Tema\n                                                        </h3>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Primario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.primaryColor || '#f97316'}\n                                                                        onChange={e => setSettings({ ...settings, primaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Secundario</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.secondaryColor || '#8b5cf6'}\n                                                                        onChange={e => setSettings({ ...settings, secondaryColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Color Acento</label>\n                                                                <div className=\"flex gap-3 items-center\">\n                                                                    <input\n                                                                        type=\"color\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"w-12 h-12 rounded-lg border border-slate-700 cursor-pointer\"\n                                                                    />\n                                                                    <input\n                                                                        type=\"text\"\n                                                                        value={settings?.accentColor || '#22c55e'}\n                                                                        onChange={e => setSettings({ ...settings, accentColor: e.target.value })}\n                                                                        className=\"input-cyber flex-1 p-3 font-mono\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Brand Ticker Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-orange-400\" /> Ticker de Marca\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Ticker</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activar/desactivar la cinta de texto animada.</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-orange-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Ticker</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.tickerText || ''}\n                                                                    onChange={e => setSettings({ ...settings, tickerText: e.target.value })}\n                                                                    placeholder=\"TECNOLOG√çA ‚Ä¢ INNOVACI√ìN ‚Ä¢ CALIDAD PREMIUM ‚Ä¢ FUTURO\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Este texto se repetir√° en bucle.</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Hero Banner Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <ImageIcon className=\"w-5 h-5 text-purple-400\" /> Banner Principal (Hero)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Badge/Etiqueta</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.heroBadge || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroBadge: e.target.value })}\n                                                                    placeholder=\"Nueva Colecci√≥n 2026\"\n                                                                />\n                                                            </div>\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo L√≠nea 1</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle1 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle1: e.target.value })}\n                                                                        placeholder=\"TECNOLOG√çA\"\n                                                                    />\n                                                                </div>\n                                                                <div>\n                                                                    <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo L√≠nea 2</label>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.heroTitle2 || ''}\n                                                                        onChange={e => setSettings({ ...settings, heroTitle2: e.target.value })}\n                                                                        placeholder=\"DEL FUTURO\"\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Subt√≠tulo</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-20 resize-none\"\n                                                                    value={settings?.heroSubtitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, heroSubtitle: e.target.value })}\n                                                                    placeholder=\"Explora nuestra selecci√≥n premium. Calidad garantizada y soporte t√©cnico especializado.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen de Fondo</label>\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'heroUrl', 1920)}\n                                                                    className=\"block w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-900/20 file:text-purple-400 hover:file:bg-purple-900/40 transition\"\n                                                                />\n                                                                {settings?.heroUrl && (\n                                                                    <div className=\"mt-4 rounded-xl overflow-hidden border border-slate-700 h-32\">\n                                                                        <img src={settings.heroUrl} className=\"w-full h-full object-cover\" alt=\"Hero Preview\" />\n                                                                    </div>\n                                                                )}\n                                                                <p className=\"text-xs text-slate-500 mt-2\">Recomendado: 1920x800 px m√≠nimo</p>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Features Section Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Star className=\"w-5 h-5 text-yellow-400\" /> Beneficios Destacados\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Toggle para mostrar toda la secci√≥n */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Secci√≥n de Beneficios</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva toda la secci√≥n de beneficios</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFeaturesSection: settings?.showFeaturesSection === false ? true : false })}\n                                                                    className={`w-14 h-7 rounded-full transition-all duration-300 relative ${settings?.showFeaturesSection !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`w-5 h-5 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeaturesSection !== false ? 'left-8' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Feature 1 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Zap className=\"w-4 h-4 text-orange-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 1 (Rayo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature1: settings?.showFeature1 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature1 !== false ? 'bg-orange-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature1 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature1 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Title: e.target.value })}\n                                                                        placeholder=\"Env√≠o Ultra R√°pido\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature1Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature1Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature1 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 2 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Shield className=\"w-4 h-4 text-purple-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 2 (Escudo)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature2: settings?.showFeature2 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature2 !== false ? 'bg-purple-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature2 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature2 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Title: e.target.value })}\n                                                                        placeholder=\"Garant√≠a Extendida\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature2Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature2Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature2 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                            {/* Feature 3 */}\n                                                            <div className={`transition-opacity duration-300 ${settings?.showFeaturesSection === false ? 'opacity-50 pointer-events-none' : ''}`}>\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <Headphones className=\"w-4 h-4 text-green-400\" />\n                                                                        <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider block\">Beneficio 3 (Soporte)</label>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFeature3: settings?.showFeature3 === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition-all duration-300 relative ${settings?.showFeature3 !== false ? 'bg-green-600' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`w-4 h-4 bg-white rounded-full absolute top-1 transition-all duration-300 shadow-md ${settings?.showFeature3 !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 ${settings?.showFeature3 === false ? 'opacity-50' : ''}`}>\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Title || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Title: e.target.value })}\n                                                                        placeholder=\"Soporte 24/7\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-3\"\n                                                                        value={settings?.feature3Desc || ''}\n                                                                        onChange={e => setSettings({ ...settings, feature3Desc: e.target.value })}\n                                                                        placeholder=\"Subt√≠tulo corto...\"\n                                                                        disabled={settings?.showFeature3 === false}\n                                                                    />\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Contact Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <MessageCircle className=\"w-5 h-5 text-green-400\" /> Secci√≥n Contacto (Footer)\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Secci√≥n</p>\n                                                                    <p className=\"text-xs text-slate-500\">Activa/desactiva la secci√≥n de contacto en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showFooterContact: settings?.showFooterContact === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showFooterContact !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showFooterContact !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactTitle: e.target.value })}\n                                                                    placeholder=\"Contacto\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactDescription: e.target.value })}\n                                                                    placeholder=\"¬øTienes alguna duda? Estamos aqu√≠ para ayudarte.\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Texto del Bot√≥n</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactButtonText || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerContactButtonText: e.target.value })}\n                                                                    placeholder=\"Contactar Soporte\"\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Tipo de Contacto</label>\n                                                                <select\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerContactType || 'whatsapp'}\n                                                                    onChange={e => setSettings({ ...settings, footerContactType: e.target.value })}\n                                                                >\n                                                                    <option value=\"whatsapp\">WhatsApp</option>\n                                                                    <option value=\"instagram\">Instagram</option>\n                                                                    <option value=\"email\">Email</option>\n                                                                </select>\n\n                                                                {/* Conditional Input based on Type */}\n                                                                {(!settings?.footerContactType || settings?.footerContactType === 'whatsapp') && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-green-500 uppercase tracking-wider mb-1 block\">Enlace de WhatsApp</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-green-500/30 focus:border-green-500\"\n                                                                            value={settings?.whatsappLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                            placeholder=\"https://wa.me/54911...\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'instagram' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-pink-500 uppercase tracking-wider mb-1 block\">Perfil de Instagram</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-pink-500/30 focus:border-pink-500\"\n                                                                            value={settings?.instagramLink || ''}\n                                                                            onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                            placeholder=\"https://instagram.com/usuario\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n\n                                                                {settings?.footerContactType === 'email' && (\n                                                                    <div className=\"mt-3 animate-fade-in\">\n                                                                        <label className=\"text-[10px] font-bold text-blue-500 uppercase tracking-wider mb-1 block\">Email de Soporte</label>\n                                                                        <input\n                                                                            className=\"input-cyber w-full p-3 text-sm border-blue-500/30 focus:border-blue-500\"\n                                                                            value={settings?.storeEmail || ''}\n                                                                            onChange={e => setSettings({ ...settings, storeEmail: e.target.value })}\n                                                                            placeholder=\"soporte@tienda.com\"\n                                                                        />\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Brand Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Store className=\"w-5 h-5 text-orange-400\" /> Marca en Footer\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Sufijo del Nombre</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.footerSuffix || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerSuffix: e.target.value })}\n                                                                    placeholder=\".SF\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece junto al nombre de la tienda (ej: SUSTORE.SF)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Descripci√≥n</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-3 h-24 resize-none\"\n                                                                    value={settings?.footerDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, footerDescription: e.target.value })}\n                                                                    placeholder=\"Tu destino premium para tecnolog√≠a de vanguardia...\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Legal Links Configuration */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-5 md:p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FileText className=\"w-5 h-5 text-slate-400\" /> Links Legales\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Pol√≠tica de Privacidad</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showPrivacyPolicy: settings?.showPrivacyPolicy === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showPrivacyPolicy !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showPrivacyPolicy !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Terms of Service</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar link en el footer</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showTermsOfService: settings?.showTermsOfService === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showTermsOfService !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showTermsOfService !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {settingsTab === 'ticket' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Ticket className=\"w-5 h-5 text-orange-400\" /> Ticket / Comprobante\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Estos datos se usan en el comprobante que se env√≠a por email al confirmar la compra.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Nombre que aparece en el ticket</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.brandName || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, brandName: e.target.value } })}\n                                                                    placeholder={settings?.storeName || 'Mi Tienda'}\n                                                                />\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de WhatsApp (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, whatsappLink: e.target.value } })}\n                                                                    placeholder={settings?.whatsappLink || 'https://wa.me/5491112345678'}\n                                                                />\n                                                            </div>\n                                                            <div className=\"md:col-span-2\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Link de la p√°gina (para el ticket)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.ticket?.siteUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, ticket: { ...settings?.ticket, siteUrl: e.target.value } })}\n                                                                    placeholder={settings?.seoUrl || ''}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SOCIAL MEDIA === */}\n                                            {settingsTab === 'social' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Share2 className=\"w-5 h-5 text-blue-400\" /> Redes Sociales\n                                                        </h3>\n                                                        <p className=\"text-sm text-slate-500 mb-6\">Configura los enlaces y activa/desactiva la visibilidad de cada red social en el footer.</p>\n                                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                                                            {/* WhatsApp */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <MessageCircle className=\"w-4 h-4 text-green-400\" /> WhatsApp\n                                                                    </label>\n                                                                    <div className=\"flex items-center gap-2\">\n                                                                        <span className=\"text-[10px] text-slate-500 font-mono uppercase\">Footer</span>\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, showWhatsapp: !settings?.showWhatsapp })}\n                                                                            className={`w-10 h-5 rounded-full transition relative ${settings?.showWhatsapp === true ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                        >\n                                                                            <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showWhatsapp === true ? '22px' : '2px' }}></div>\n                                                                        </button>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm mb-3\"\n                                                                    value={settings?.whatsappLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, whatsappLink: e.target.value })}\n                                                                    placeholder=\"https://wa.me/5491112345678\"\n                                                                />\n\n                                                                {/* Floating Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold flex items-center gap-2\">\n                                                                            Bot√≥n Flotante\n                                                                            {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                                <Lock className=\"w-3 h-3 text-yellow-500\" />\n                                                                            )}\n                                                                        </p>\n                                                                        {(!['business', 'premium'].includes(settings?.subscriptionPlan)) && (\n                                                                            <p className=\"text-[9px] text-yellow-500/80 mt-0.5\">Requiere Plan Negocio</p>\n                                                                        )}\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if (['business', 'premium'].includes(settings?.subscriptionPlan)) {\n                                                                                setSettings({ ...settings, showFloatingWhatsapp: !settings?.showFloatingWhatsapp });\n                                                                            } else {\n                                                                                setShowPlansModal(true);\n                                                                            }\n                                                                        }}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showFloatingWhatsapp ? 'bg-green-500' : 'bg-slate-700'} ${(!['business', 'premium'].includes(settings?.subscriptionPlan)) ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showFloatingWhatsapp ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Cart Button Toggle */}\n                                                                <div className=\"flex items-center justify-between pt-3 mt-3 border-t border-slate-800/50\">\n                                                                    <div>\n                                                                        <p className=\"text-xs text-slate-400 font-bold\">Bot√≥n en Carrito</p>\n                                                                        <p className=\"text-[9px] text-slate-500 mt-0.5\">‚ÄúTerminar compra por WhatsApp‚Äù</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showCartWhatsappCheckout: !settings?.showCartWhatsappCheckout })}\n                                                                        className={`w-10 h-5 rounded-full transition relative ${settings?.showCartWhatsappCheckout ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full transition`} style={{ left: settings?.showCartWhatsappCheckout ? '22px' : '2px' }}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n                                                            {/* Instagram */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Instagram className=\"w-4 h-4 text-pink-400\" /> Instagram\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showInstagram: settings?.showInstagram === false ? true : false })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showInstagram !== false ? 'bg-pink-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showInstagram !== false ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.instagramLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, instagramLink: e.target.value })}\n                                                                    placeholder=\"https://instagram.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Facebook */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Facebook className=\"w-4 h-4 text-blue-500\" /> Facebook\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showFacebook: !settings?.showFacebook })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showFacebook ? 'bg-blue-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showFacebook ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.facebookLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, facebookLink: e.target.value })}\n                                                                    placeholder=\"https://facebook.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* Twitter */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Twitter className=\"w-4 h-4 text-sky-400\" /> Twitter/X\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTwitter: !settings?.showTwitter })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTwitter ? 'bg-sky-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTwitter ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.twitterLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, twitterLink: e.target.value })}\n                                                                    placeholder=\"https://twitter.com/mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* TikTok */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Music className=\"w-4 h-4 text-rose-400\" /> TikTok\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showTiktok: !settings?.showTiktok })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showTiktok ? 'bg-rose-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showTiktok ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.tiktokLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, tiktokLink: e.target.value })}\n                                                                    placeholder=\"https://tiktok.com/@mitienda\"\n                                                                />\n                                                            </div>\n                                                            {/* YouTube */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <label className=\"text-sm font-bold text-white flex items-center gap-2\">\n                                                                        <Youtube className=\"w-4 h-4 text-red-500\" /> YouTube\n                                                                    </label>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, showYoutube: !settings?.showYoutube })}\n                                                                        className={`w-12 h-6 rounded-full transition relative ${settings?.showYoutube ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full transition ${settings?.showYoutube ? 'left-6' : 'left-0.5'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3 text-sm\"\n                                                                    value={settings?.youtubeLink || ''}\n                                                                    onChange={e => setSettings({ ...settings, youtubeLink: e.target.value })}\n                                                                    placeholder=\"https://youtube.com/c/mitienda\"\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === PAYMENTS === */}\n                                            {settingsTab === 'payments' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <CreditCard className=\"w-5 h-5 text-green-400\" /> M√©todos de Pago\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Transfer */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Building className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Transferencia Bancaria</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, enabled: !settings?.paymentTransfer?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentTransfer?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentTransfer?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.paymentTransfer?.enabled && (\n                                                                    <div className=\"mt-5 grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Titular</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.holderName || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, holderName: e.target.value } })}\n                                                                                placeholder=\"Nombre y apellido\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">Alias</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.alias || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, alias: e.target.value } })}\n                                                                                placeholder=\"alias.ejemplo\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block\">CBU</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-3 text-sm\"\n                                                                                value={settings?.paymentTransfer?.cbu || ''}\n                                                                                onChange={e => setSettings({ ...settings, paymentTransfer: { ...settings?.paymentTransfer, cbu: e.target.value } })}\n                                                                                placeholder=\"0000000000000000000000\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n\n                                                            {/* Cash */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Banknote className=\"w-6 h-6 text-green-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Efectivo</p>\n                                                                            <p className=\"text-xs text-slate-500\">Pago al recibir</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            // Validar que Retiro en Local est√© activo\n                                                                            if (!settings?.shippingPickup?.enabled) {\n                                                                                showToast('Debes activar \"Retiro en Local\" (Env√≠os) para habilitar efectivo.', 'warning');\n                                                                                return;\n                                                                            }\n                                                                            setSettings({ ...settings, paymentCash: !settings?.paymentCash });\n                                                                        }}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'} ${!settings?.shippingPickup?.enabled ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentCash && settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {!settings?.shippingPickup?.enabled && (\n                                                                    <p className=\"text-[10px] text-orange-400/80 mt-2 flex items-center gap-1\">\n                                                                        <AlertTriangle className=\"w-3 h-3\" /> Requiere activar Retiro en Local\n                                                                    </p>\n                                                                )}\n                                                            </div>\n\n                                                            {/* MercadoPago (Tarjeta) */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <CreditCard className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Tarjeta (Mercado Pago)</p>\n                                                                            <p className=\"text-xs text-slate-500\">Activado / Desactivado</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, paymentMercadoPago: { ...settings?.paymentMercadoPago, enabled: !settings?.paymentMercadoPago?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.paymentMercadoPago?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.paymentMercadoPago?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                            </div>\n\n\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SHIPPING === */}\n                                            {settingsTab === 'shipping' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Truck className=\"w-5 h-5 text-orange-400\" /> Opciones de Env√≠o\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            {/* Pickup */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <MapPin className=\"w-6 h-6 text-orange-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Retiro en Local</p>\n                                                                            <p className=\"text-xs text-slate-500\">El cliente pasa a buscar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, enabled: !settings?.shippingPickup?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingPickup?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingPickup?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingPickup?.enabled && (\n                                                                    <input\n                                                                        className=\"input-cyber w-full p-4\"\n                                                                        value={settings?.shippingPickup?.address || ''}\n                                                                        onChange={e => setSettings({ ...settings, shippingPickup: { ...settings?.shippingPickup, address: e.target.value } })}\n                                                                        placeholder=\"Direcci√≥n de retiro: Av. Corrientes 1234\"\n                                                                    />\n                                                                )}\n                                                            </div>\n\n                                                            {/* Delivery */}\n                                                            <div className=\"bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-4\">\n                                                                    <div className=\"flex items-center gap-3\">\n                                                                        <Package className=\"w-6 h-6 text-purple-400\" />\n                                                                        <div>\n                                                                            <p className=\"font-bold text-white\">Env√≠o a Domicilio</p>\n                                                                            <p className=\"text-xs text-slate-500\">Delivery est√°ndar</p>\n                                                                        </div>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, enabled: !settings?.shippingDelivery?.enabled } })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.shippingDelivery?.enabled ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.shippingDelivery?.enabled ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n                                                                {settings?.shippingDelivery?.enabled && (\n                                                                    <div className=\"grid grid-cols-2 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Costo de Env√≠o ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.fee || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, fee: parseFloat(e.target.value) || 0 } })}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-xs text-slate-500 mb-1 block\">Gratis desde ($)</label>\n                                                                            <input\n                                                                                type=\"number\"\n                                                                                className=\"input-cyber w-full p-4\"\n                                                                                value={settings?.shippingDelivery?.freeAbove || 0}\n                                                                                onChange={e => setSettings({ ...settings, shippingDelivery: { ...settings?.shippingDelivery, freeAbove: parseFloat(e.target.value) || 0 } })}\n                                                                                placeholder=\"0 = nunca gratis\"\n                                                                            />\n                                                                        </div>\n                                                                    </div>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === SEO === */}\n                                            {settingsTab === 'seo' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Globe className=\"w-5 h-5 text-green-400\" /> Optimizaci√≥n SEO\n                                                        </h3>\n                                                        <div className=\"space-y-6\">\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">T√≠tulo del Sitio</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoTitle || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoTitle: e.target.value })}\n                                                                    placeholder=\"Mi Tienda Online | Los Mejores Productos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Aparece en la pesta√±a del navegador</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Meta Descripci√≥n</label>\n                                                                <textarea\n                                                                    className=\"input-cyber w-full p-4 h-20 resize-none\"\n                                                                    value={settings?.seoDescription || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoDescription: e.target.value })}\n                                                                    placeholder=\"Tienda online de productos de alta calidad. Env√≠os a todo el pa√≠s. ¬°Visitanos!\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Descripci√≥n que aparece en Google (max 160 caracteres)</p>\n                                                            </div>\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Palabras Clave</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoKeywords || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoKeywords: e.target.value })}\n                                                                    placeholder=\"tienda online, productos, ofertas, descuentos\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Separadas por comas</p>\n                                                            </div>\n\n                                                            {/* URL Can√≥nica */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">URL del Sitio (Can√≥nica)</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoUrl || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoUrl: e.target.value })}\n                                                                    placeholder=\"https://mitienda.vercel.app\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">URL oficial de tu tienda (aparece en Google y redes sociales)</p>\n                                                            </div>\n\n                                                            {/* Autor */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Autor / Empresa</label>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.seoAuthor || ''}\n                                                                    onChange={e => setSettings({ ...settings, seoAuthor: e.target.value })}\n                                                                    placeholder=\"Mi Empresa S.A.\"\n                                                                />\n                                                                <p className=\"text-xs text-slate-500 mt-1\">Nombre que aparece como autor del sitio</p>\n                                                            </div>\n\n                                                            {/* OG Image Upload */}\n                                                            <div>\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block\">Imagen para Redes Sociales (OG:Image)</label>\n                                                                <div className=\"flex items-center gap-4\">\n                                                                    <div className=\"relative group w-32 h-32 bg-slate-900 rounded-xl border-2 border-dashed border-slate-700 hover:border-orange-500 transition flex items-center justify-center overflow-hidden cursor-pointer\">\n                                                                        {settings?.seoImage ? (\n                                                                            <img src={settings.seoImage} alt=\"SEO Preview\" className=\"w-full h-full object-cover\" />\n                                                                        ) : (\n                                                                            <ImageIcon className=\"w-8 h-8 text-slate-600 group-hover:text-orange-500 transition\" />\n                                                                        )}\n                                                                        <input\n                                                                            type=\"file\"\n                                                                            accept=\"image/*\"\n                                                                            className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                            onChange={(e) => handleImageUpload(e, setSettings, 'seoImage', 1200)}\n                                                                        />\n                                                                        {/* Overlay al hacer hover para indicar cambio */}\n                                                                        <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                            <Upload className=\"w-6 h-6 text-white\" />\n                                                                        </div>\n                                                                    </div>\n                                                                    <div className=\"flex-1\">\n                                                                        <p className=\"text-sm text-slate-400 mb-2\">Sube una imagen atractiva (ej: logo con fondo, banner).</p>\n                                                                        <p className=\"text-xs text-slate-600\">Recomendado: 1200x630 p√≠xeles para mejor visualizaci√≥n en Facebook/WhatsApp.</p>\n                                                                        {settings?.seoImage && (\n                                                                            <button\n                                                                                onClick={() => setSettings({ ...settings, seoImage: '' })}\n                                                                                className=\"mt-2 text-xs text-red-400 hover:text-red-300 flex items-center gap-1\"\n                                                                            >\n                                                                                <Trash2 className=\"w-3 h-3\" /> Eliminar imagen\n                                                                            </button>\n                                                                        )}\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Links Status */}\n                                                            <div className=\"pt-4 border-t border-slate-800 grid grid-cols-2 gap-4\">\n                                                                <a href=\"/sitemap.xml\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Sitemap.xml</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                                <a href=\"/robots.txt\" target=\"_blank\" className=\"p-3 bg-slate-900 rounded-xl hover:bg-slate-800 transition flex items-center justify-between group\">\n                                                                    <div>\n                                                                        <p className=\"text-sm font-bold text-white\">Ver Robots.txt</p>\n                                                                        <p className=\"text-xs text-green-500\">Activo</p>\n                                                                    </div>\n                                                                    <ExternalLink className=\"w-4 h-4 text-slate-500 group-hover:text-white transition\" />\n                                                                </a>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === ADVANCED === */}\n                                            {settingsTab === 'advanced' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Cog className=\"w-5 h-5 text-slate-400\" /> Configuraci√≥n Avanzada\n                                                        </h3>\n                                                        <div className=\"space-y-4\">\n                                                            {/* Maintenance Mode */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Modo Mantenimiento</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mostrar p√°gina de \"Volvemos pronto\"</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, maintenanceMode: !settings?.maintenanceMode })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.maintenanceMode ? 'bg-red-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.maintenanceMode ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* PWA & Performance Controls */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800 space-y-4\">\n                                                                <h4 className=\"text-sm font-bold text-orange-400 uppercase tracking-wider mb-2\">Rendimiento & PWA</h4>\n\n                                                                {/* Lazy Loading */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Carga Diferida (Lazy Load)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Mejora velocidad cargando im√°genes al hacer scroll</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enableLazyLoad: settings?.enableLazyLoad === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enableLazyLoad !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enableLazyLoad !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* PWA Service Worker */}\n                                                                <div className=\"flex items-center justify-between\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Modo Offline (PWA)</p>\n                                                                        <p className=\"text-xs text-slate-500\">Permite instalar la app y uso sin internet</p>\n                                                                    </div>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, enablePWA: settings?.enablePWA === false ? true : false })}\n                                                                        className={`w-14 h-8 rounded-full transition relative ${settings?.enablePWA !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                    >\n                                                                        <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.enablePWA !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                    </button>\n                                                                </div>\n\n                                                                {/* Clear Cache Button */}\n                                                                <div className=\"pt-2 border-t border-slate-700\">\n                                                                    <button\n                                                                        onClick={() => {\n                                                                            if ('caches' in window) {\n                                                                                caches.keys().then(names => {\n                                                                                    names.forEach(name => caches.delete(name));\n                                                                                    showToast('Cach√© limpiada. Recargando...', 'success');\n                                                                                    setTimeout(() => window.location.reload(), 1500);\n                                                                                });\n                                                                            } else {\n                                                                                showToast('Tu navegador no soporta gesti√≥n de cach√©', 'warning');\n                                                                            }\n                                                                        }}\n                                                                        className=\"w-full py-2 px-4 bg-slate-800 hover:bg-slate-700 text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-2\"\n                                                                    >\n                                                                        <Trash2 className=\"w-4 h-4\" /> Forzar Limpieza de Cach√© y Recargar\n                                                                    </button>\n                                                                    <p className=\"text-xs text-slate-500 mt-2 text-center\">Usar si ves errores gr√°ficos o versiones antiguas.</p>\n                                                                </div>\n                                                            </div>\n\n                                                            {/* Loading Text */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"mb-3\">\n                                                                    <p className=\"font-bold text-white\">Texto de Carga</p>\n                                                                    <p className=\"text-xs text-slate-500\">Mensaje que aparece mientras carga la p√°gina</p>\n                                                                </div>\n                                                                <input\n                                                                    className=\"input-cyber w-full p-3\"\n                                                                    value={settings?.loadingText || ''}\n                                                                    onChange={e => setSettings({ ...settings, loadingText: e.target.value })}\n                                                                    placeholder=\"Cargando sistema...\"\n                                                                />\n                                                            </div>\n\n                                                            {/* Show Announcement Banner */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Banner de Anuncio</p>\n                                                                    <p className=\"text-xs text-slate-500\">Barra superior con mensaje promocional</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showAnnouncementBanner: settings?.showAnnouncementBanner === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showAnnouncementBanner !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showAnnouncementBanner !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Brand Ticker */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Ticker de Marca</p>\n                                                                    <p className=\"text-xs text-slate-500\">Texto en movimiento debajo del anuncio</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showBrandTicker: settings?.showBrandTicker === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showBrandTicker !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showBrandTicker !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Show Stock */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Mostrar Stock Disponible</p>\n                                                                    <p className=\"text-xs text-slate-500\">Los clientes ven cu√°ntas unidades hay</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, showStockCount: settings?.showStockCount === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.showStockCount !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.showStockCount !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require Phone */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir Tel√©fono</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requirePhone: settings?.requirePhone === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requirePhone !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requirePhone !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Require DNI */}\n                                                            <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div>\n                                                                    <p className=\"font-bold text-white\">Requerir DNI</p>\n                                                                    <p className=\"text-xs text-slate-500\">Obligatorio al registrarse</p>\n                                                                </div>\n                                                                <button\n                                                                    onClick={() => setSettings({ ...settings, requireDNI: settings?.requireDNI === false ? true : false })}\n                                                                    className={`w-14 h-8 rounded-full transition relative ${settings?.requireDNI !== false ? 'bg-green-500' : 'bg-slate-700'}`}\n                                                                >\n                                                                    <div className={`absolute top-1 w-6 h-6 bg-white rounded-full transition ${settings?.requireDNI !== false ? 'left-7' : 'left-1'}`}></div>\n                                                                </button>\n                                                            </div>\n\n                                                            {/* Low Stock Threshold */}\n                                                            <div className=\"p-4 bg-slate-900/50 rounded-xl border border-slate-800\">\n                                                                <div className=\"flex items-center justify-between mb-3\">\n                                                                    <div>\n                                                                        <p className=\"font-bold text-white\">Umbral de Stock Bajo</p>\n                                                                        <p className=\"text-xs text-slate-500\">Alerta cuando el stock es menor a este valor</p>\n                                                                    </div>\n                                                                </div>\n                                                                <input\n                                                                    type=\"number\"\n                                                                    className=\"input-cyber w-full p-4\"\n                                                                    value={settings?.lowStockThreshold || 5}\n                                                                    onChange={e => setSettings({ ...settings, lowStockThreshold: parseInt(e.target.value) || 5 })}\n                                                                />\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* AI Config Block (SustIA) */}\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Sparkles className=\"w-5 h-5 text-yellow-500\" /> Personalizaci√≥n IA\n                                                        </h3>\n                                                        <div className=\"flex items-center gap-6\">\n                                                            <div className=\"relative group w-24 h-24 bg-slate-900 rounded-full border-2 border-dashed border-slate-700 hover:border-yellow-500 transition flex items-center justify-center overflow-hidden cursor-pointer shrink-0 shadow-xl\">\n                                                                {settings?.botImage ? (\n                                                                    <img src={settings.botImage} alt=\"Bot Preview\" className=\"w-full h-full object-cover\" />\n                                                                ) : (\n                                                                    <Sparkles className=\"w-8 h-8 text-slate-600 group-hover:text-yellow-500 transition\" />\n                                                                )}\n                                                                <input\n                                                                    type=\"file\"\n                                                                    accept=\"image/*\"\n                                                                    className=\"absolute inset-0 opacity-0 cursor-pointer z-50\"\n                                                                    onChange={(e) => handleImageUpload(e, setSettings, 'botImage', 300)}\n                                                                />\n                                                                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition pointer-events-none\">\n                                                                    <Upload className=\"w-6 h-6 text-white\" />\n                                                                </div>\n                                                            </div>\n                                                            <div>\n                                                                <p className=\"font-bold text-white text-base mb-1\">Avatar del Asistente</p>\n                                                                <p className=\"text-xs text-slate-500 mb-3 max-w-xs leading-relaxed\">Sube una imagen personalizada para el bot (PNG/JPG). Se recomienda formato cuadrado.</p>\n                                                                {settings?.botImage ? (\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, botImage: '' })}\n                                                                        className=\"text-xs bg-red-900/20 text-red-400 hover:bg-red-900/40 px-3 py-1.5 rounded-lg transition flex items-center gap-2 border border-red-500/20\"\n                                                                    >\n                                                                        <Trash2 className=\"w-3 h-3\" /> Restaurar Default\n                                                                    </button>\n                                                                ) : (\n                                                                    <span className=\"text-xs text-yellow-600 bg-yellow-900/20 px-3 py-1 rounded-lg border border-yellow-700/30\">\n                                                                        Usando imagen por defecto\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <FolderPlus className=\"w-5 h-5 text-orange-400\" /> Categor√≠as de Productos\n                                                        </h3>\n                                                        <div className=\"flex flex-wrap gap-2 mb-4\">\n                                                            {(settings?.categories || []).map((cat, idx) => (\n                                                                <div key={idx} className=\"bg-slate-900 text-white px-4 py-2 rounded-lg flex items-center gap-2 border border-slate-700\">\n                                                                    <span>{cat}</span>\n                                                                    <button\n                                                                        onClick={() => setSettings({ ...settings, categories: (settings?.categories || []).filter((_, i) => i !== idx) })}\n                                                                        className=\"text-red-400 hover:text-red-300\"\n                                                                    >\n                                                                        <X className=\"w-4 h-4\" />\n                                                                    </button>\n                                                                </div>\n                                                            ))}\n                                                        </div>\n                                                        <button\n                                                            onClick={() => setShowCategoryModal(true)}\n                                                            className=\"px-4 py-2 bg-orange-900/20 text-orange-400 rounded-lg font-bold text-sm border border-orange-500/30 hover:bg-orange-900/40 transition flex items-center gap-2\"\n                                                        >\n                                                            <Plus className=\"w-4 h-4\" /> Agregar Categor√≠a\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* === TEAM === */}\n                                            {settingsTab === 'team' && (\n                                                <div className=\"space-y-6 animate-fade-up\">\n                                                    <div className=\"bg-[#0a0a0a] border border-slate-800 p-8 rounded-[2rem]\">\n                                                        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n                                                            <Users className=\"w-5 h-5 text-purple-400\" /> Equipo y Accesos\n                                                        </h3>\n                                                        <p className=\"text-slate-500 mb-6\">Gestiona los miembros del equipo, sus roles de acceso y participaci√≥n en ganancias.</p>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            {(settings?.team || []).map((member, idx) => (\n                                                                <div key={idx} className=\"flex flex-col md:flex-row md:items-center gap-4 bg-slate-900/50 p-6 rounded-2xl border border-slate-800\">\n                                                                    <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-lg flex-shrink-0\">\n                                                                        {member.name?.charAt(0)?.toUpperCase() || '?'}\n                                                                    </div>\n                                                                    <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Nombre</label>\n                                                                            <input\n                                                                                className=\"input-cyber w-full p-2 text-sm\"\n                                                                                value={member.name || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], name: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"Nombre\"\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Email (Acceso)</label>\n                                                                            <input\n                                                                                type=\"email\"\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.email || ''}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], email: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                placeholder=\"usuario@email.com\"\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            />\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Rol</label>\n                                                                            <select\n                                                                                className={`input-cyber w-full p-2 text-sm ${member.email === SUPER_ADMIN_EMAIL ? 'opacity-50 cursor-not-allowed' : ''}`}\n                                                                                value={member.role || 'employee'}\n                                                                                onChange={e => {\n                                                                                    const updated = [...(settings?.team || [])];\n                                                                                    updated[idx] = { ...updated[idx], role: e.target.value };\n                                                                                    setSettings({ ...settings, team: updated });\n                                                                                }}\n                                                                                disabled={member.email === SUPER_ADMIN_EMAIL}\n                                                                            >\n                                                                                <option value=\"employee\">Empleado</option>\n                                                                                <option value=\"admin\">Admin</option>\n                                                                            </select>\n                                                                        </div>\n                                                                        <div>\n                                                                            <label className=\"text-[10px] uppercase font-bold text-slate-500 mb-1 block\">Total Invertido</label>\n                                                                            <div className=\"input-cyber w-full p-2 text-sm bg-slate-900/50 text-slate-400 flex items-center cursor-not-allowed\">\n                                                                                $ {investments.filter(inv => inv.investor === member.name || inv.investor === member.email).reduce((acc, curr) => acc + (Number(curr.amount) || 0), 0).toLocaleString()}\n                                                                            </div>\n                                                                        </div>\n                                                                    </div>\n                                                                    {member.email !== SUPER_ADMIN_EMAIL && (\n                                                                        <button\n                                                                            onClick={() => setSettings({ ...settings, team: (settings?.team || []).filter((_, i) => i !== idx) })}\n                                                                            className=\"p-3 bg-red-900/20 text-red-400 hover:bg-red-900/40 rounded-xl transition flex-shrink-0\"\n                                                                            title=\"Eliminar Miembro\"\n                                                                        >\n                                                                            <Trash2 className=\"w-5 h-5\" />\n                                                                        </button>\n                                                                    )}\n                                                                </div>\n                                                            ))}\n                                                        </div>\n\n                                                        <button\n                                                            onClick={() => setSettings({ ...settings, team: [...(settings?.team || []), { name: '', email: '', role: 'employee', investment: 0 }] })}\n                                                            className=\"px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-bold shadow-lg shadow-purple-600/30 flex items-center gap-2 transition\"\n                                                        >\n                                                            <UserPlus className=\"w-5 h-5\" /> Agregar Nuevo Miembro\n                                                        </button>\n                                                    </div>\n                                                </div>\n                                            )}\n\n                                            {/* Save Button */}\n                                            <div className=\"fixed bottom-8 right-8 z-50\">\n                                                <button\n                                                    onClick={async () => {\n                                                        try {\n                                                            setIsLoading(true);\n                                                            const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'config');\n                                                            await setDoc(settingsRef, settings, { merge: true });\n                                                            showToast(\"Configuraci√≥n guardada exitosamente\", \"success\");\n                                                        } catch (e) {\n                                                            console.error(e);\n                                                            showToast(\"Error al guardar\", \"error\");\n                                                        } finally {\n                                                            setIsLoading(false);\n                                                        }\n                                                    }}\n                                                    className=\"px-8 py-4 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white font-bold rounded-2xl shadow-2xl shadow-orange-900/30 flex items-center gap-3 transition transform hover:scale-105\"\n                                                >\n                                                    <Save className=\"w-5 h-5\" /> Guardar Cambios\n                                                </button>\n                                            </div>\n                                        </div>\n                                    )\n                                    }\n\n                                    {/* 7.3 Modal Proveedores (Selector Visual) */}\n                                    {\n                                        showSupplierModal && (\n                                            <div className=\"fixed inset-0 bg-black/90 z-[200] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-scale\">\n                                                <div className=\"bg-[#0a0a0a] border border-slate-700 p-8 rounded-[2.5rem] w-full max-w-lg shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh]\">\n                                                    <div className=\"overflow-y-auto custom-scrollbar pr-2 pb-20\">\n                                                        <h3 className=\"text-2xl font-black text-white mb-6 sticky top-0 bg-[#0a0a0a] py-2 z-10\">\n                                                            {editingSupplierId ? 'Editar' : 'Nuevo'} Proveedor\n                                                        </h3>\n\n                                                        <div className=\"space-y-4 mb-6\">\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre de la Empresa\" value={newSupplier.name} onChange={e => setNewSupplier({ ...newSupplier, name: e.target.value })} />\n                                                            <input className=\"input-cyber w-full p-4\" placeholder=\"Nombre del Contacto\" value={newSupplier.contact} onChange={e => setNewSupplier({ ...newSupplier, contact: e.target.value })} />\n\n                                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Tel√©fono\" value={newSupplier.phone} onChange={e => setNewSupplier({ ...newSupplier, phone: e.target.value })} />\n                                                                <input className=\"input-cyber w-full p-4\" placeholder=\"Instagram (sin @)\" value={newSupplier.ig} onChange={e => setNewSupplier({ ...newSupplier, ig: e.target.value })} />\n                                                            </div>\n\n                                                            {/* Selector Visual de Productos */}\n                                                            <div className=\"border-t border-slate-800 pt-6 mt-6\">\n                                                                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 block\">\n                                                                    Asignar Productos Suministrados\n                                                                </label>\n                                                                <div className=\"h-48 overflow-y-auto bg-slate-900/50 rounded-xl p-2 border border-slate-800 custom-scrollbar\">\n                                                                    {products.length === 0 ? (\n                                                                        <p className=\"text-center text-slate-600 text-xs py-4\">Carga productos primero.</p>\n                                                                    ) : products.map(p => (\n                                                                        <div\n                                                                            key={p.id}\n                                                                            onClick={() => {\n                                                                                const prev = newSupplier.associatedProducts || [];\n                                                                                const exists = prev.includes(p.id);\n                                                                                setNewSupplier({\n                                                                                    ...newSupplier,\n                                                                                    associatedProducts: exists ? prev.filter(x => x !== p.id) : [...prev, p.id]\n                                                                                });\n                                                                            }}\n                                                                            className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer mb-1 transition ${newSupplier.associatedProducts?.includes(p.id) ? 'bg-orange-900/30 border border-orange-500/30' : 'hover:bg-slate-800 border border-transparent'}`}\n                                                                        >\n                                                                            <div className=\"w-8 h-8 bg-white rounded p-0.5 flex-shrink-0\">\n                                                                                <img src={p.image} className=\"w-full h-full object-contain\" />\n                                                                            </div>\n                                                                            <span className=\"text-xs text-white truncate flex-1 font-medium\">{p.name}</span>\n                                                                            {newSupplier.associatedProducts?.includes(p.id) && <CheckCircle className=\"w-4 h-4 text-orange-400\" />}\n                                                                        </div>\n                                                                    ))}\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n\n                                                    {/* Footer Botones Fixed */}\n                                                    <div className=\"absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a] to-transparent flex gap-4\">\n                                                        <button onClick={() => setShowSupplierModal(false)} className=\"flex-1 py-4 text-slate-400 font-bold hover:text-white transition bg-slate-900 rounded-xl\">Cancelar</button>\n                                                        <button onClick={saveSupplierFn} className=\"flex-1 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold shadow-lg transition\">Guardar</button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        )\n                                    }\n                                </div >\n                            </div >\n                        ) : (\n                            <AccessDenied onBack={() => setView('store')} />\n                        ))\n                }\n\n                {/* 8. VISTA POL√çTICA DE PRIVACIDAD */}\n                {\n                    view === 'privacy' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Pol√≠tica de <span className=\"text-orange-500 text-6xl\">Privacidad</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 text-lg leading-relaxed\">\n                                        En <strong>{settings?.storeName || 'SUSTORE'}</strong>, valoramos tu privacidad y nos comprometemos a proteger tus datos personales. Esta pol√≠tica describe c√≥mo recolectamos, usamos y resguardamos tu informaci√≥n.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">1. Informaci√≥n Recolectada</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Recolectamos datos b√°sicos como nombre, correo electr√≥nico y n√∫mero de tel√©fono √∫nicamente cuando te registras o realizas un pedido para procesar tu compra correctamente.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">2. Uso de los Datos</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Tu informaci√≥n se utiliza exclusivamente para:\n                                    </p>\n                                    <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                        <li>Gestionar tus pedidos y entregas.</li>\n                                        <li>Enviar actualizaciones sobre el estado de tu compra.</li>\n                                        <li>Mejorar nuestros servicios y experiencia de usuario.</li>\n                                    </ul>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">3. Seguridad</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed\">\n                                        Implementamos medidas de seguridad robustas y encriptaci√≥n de datos para asegurar que tu informaci√≥n est√© protegida contra accesos no autorizados.\n                                    </p>\n                                    <h2 className=\"text-2xl font-bold text-white mt-12 mb-6\">4. Contacto</h2>\n                                    <p className=\"text-slate-500 leadind-relaxed mb-12\">\n                                        Si tienes dudas sobre nuestra pol√≠tica de privacidad, cont√°ctanos a <span className=\"text-orange-400\">{settings?.storeEmail || 'soporte@tuempresa.com'}</span>.\n                                    </p>\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n                {/* 9. VISTA T√âRMINOS Y CONDICIONES */}\n                {\n                    view === 'terms' && (\n                        <div className=\"max-w-4xl mx-auto py-20 px-6 animate-fade-up\">\n                            <div className=\"glass p-12 rounded-[3rem] border border-slate-800\">\n                                <div className=\"prose prose-invert max-w-none\">\n                                    <h1 className=\"text-5xl font-black mb-12 tracking-tighter italic\">\n                                        Condiciones de <span className=\"text-orange-500 text-6xl\">Uso</span>\n                                    </h1>\n                                    <p className=\"text-slate-400 font-bold mb-8\">√öltima actualizaci√≥n: 07 de enero de 2026</p>\n\n                                    <h3 className=\"text-xl font-bold text-white mt-8 mb-4\">ACUERDO CON NUESTROS T√âRMINOS LEGALES</h3>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Nosotros somos <strong>{settings?.storeName || 'Sustore'}</strong> (\"<strong>Empresa</strong>\", \"<strong>nosotros</strong>\", \"<strong>nos</strong>\", \"<strong>nuestro</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Operamos el sitio web <a href=\"https://sustore.vercel.app\" className=\"text-orange-400 hover:underline\">https://sustore.vercel.app</a> (el \"<strong>Sitio</strong>\"), as√≠ como cualquier otro producto y servicio relacionado que haga referencia o se vincule con estos t√©rminos legales (los \"<strong>T√©rminos Legales</strong>\") (colectivamente, los \"<strong>Servicios</strong>\").\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Puede contactarnos por correo electr√≥nico a la direcci√≥n proporcionada al final de este documento.\n                                    </p>\n                                    <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                        Estos T√©rminos Legales constituyen un acuerdo legalmente vinculante celebrado entre usted, ya sea personalmente o en nombre de una entidad (\"<strong>usted</strong>\"), y Sustore, en relaci√≥n con su acceso y uso de los Servicios. Usted acepta que al acceder a los Servicios, ha le√≠do, comprendido y aceptado estar sujeto a todos estos T√©rminos Legales. <strong className=\"text-red-400\">SI NO EST√Å DE ACUERDO CON TODOS ESTOS T√âRMINOS LEGALES, ENTONCES TIENE EXPRESAMENTE PROHIBIDO UTILIZAR LOS SERVICIOS Y DEBE DEJAR DE UTILIZARLOS INMEDIATAMENTE.</strong>\n                                    </p>\n\n                                    <div className=\"bg-slate-900/50 p-8 rounded-3xl border border-slate-800 my-10\">\n                                        <h3 className=\"text-lg font-black text-white uppercase tracking-widest mb-6\">√çNDICE</h3>\n                                        <ul className=\"space-y-2 text-sm text-orange-400 font-medium\">\n                                            <li><a href=\"#section1\" className=\"hover:text-orange-300 transition\">1. NUESTROS SERVICIOS</a></li>\n                                            <li><a href=\"#section2\" className=\"hover:text-orange-300 transition\">2. DERECHOS DE PROPIEDAD INTELECTUAL</a></li>\n                                            <li><a href=\"#section3\" className=\"hover:text-orange-300 transition\">3. REPRESENTACIONES DE USUARIOS</a></li>\n                                            <li><a href=\"#section4\" className=\"hover:text-orange-300 transition\">4. ACTIVIDADES PROHIBIDAS</a></li>\n                                            <li><a href=\"#section5\" className=\"hover:text-orange-300 transition\">5. CONTRIBUCIONES GENERADAS POR EL USUARIO</a></li>\n                                            <li><a href=\"#section6\" className=\"hover:text-orange-300 transition\">6. LICENCIA DE CONTRIBUCI√ìN</a></li>\n                                            <li><a href=\"#section7\" className=\"hover:text-orange-300 transition\">7. GESTI√ìN DE SERVICIOS</a></li>\n                                            <li><a href=\"#section8\" className=\"hover:text-orange-300 transition\">8. PLAZO Y TERMINACI√ìN</a></li>\n                                            <li><a href=\"#section9\" className=\"hover:text-orange-300 transition\">9. MODIFICACIONES E INTERRUPCIONES</a></li>\n                                            <li><a href=\"#section10\" className=\"hover:text-orange-300 transition\">10. LEY APLICABLE</a></li>\n                                            <li><a href=\"#section11\" className=\"hover:text-orange-300 transition\">11. RESOLUCI√ìN DE DISPUTAS</a></li>\n                                            <li><a href=\"#section12\" className=\"hover:text-orange-300 transition\">12. CORRECCIONES</a></li>\n                                            <li><a href=\"#section13\" className=\"hover:text-orange-300 transition\">13. DESCARGO DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section14\" className=\"hover:text-orange-300 transition\">14. LIMITACIONES DE RESPONSABILIDAD</a></li>\n                                            <li><a href=\"#section15\" className=\"hover:text-orange-300 transition\">15. INDEMNIZACI√ìN</a></li>\n                                            <li><a href=\"#section16\" className=\"hover:text-orange-300 transition\">16. DATOS DEL USUARIO</a></li>\n                                            <li><a href=\"#section17\" className=\"hover:text-orange-300 transition\">17. COMUNICACIONES ELECTR√ìNICAS</a></li>\n                                            <li><a href=\"#section18\" className=\"hover:text-orange-300 transition\">18. VARIOS</a></li>\n                                            <li><a href=\"#section19\" className=\"hover:text-orange-300 transition\">19. CONT√ÅCTENOS</a></li>\n                                        </ul>\n                                    </div>\n\n                                    <section id=\"section1\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">1. NUESTROS SERVICIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            La informaci√≥n proporcionada al utilizar los Servicios no est√° destinada a ser distribuida o utilizada por ninguna persona o entidad en ninguna jurisdicci√≥n o pa√≠s donde dicha distribuci√≥n o uso ser√≠a contrario a la ley o regulaci√≥n o que nos someter√≠a a cualquier requisito de registro dentro de dicha jurisdicci√≥n o pa√≠s. En consecuencia, aquellas personas que eligen acceder a los Servicios desde otras ubicaciones lo hacen por iniciativa propia y son las √∫nicas responsables del cumplimiento de las leyes locales, si y en la medida en que sean aplicables.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section2\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">2. DERECHOS DE PROPIEDAD INTELECTUAL</h2>\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Nuestra propiedad intelectual</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Somos propietarios o licenciatarios de todos los derechos de propiedad intelectual de nuestros Servicios, incluido todo el c√≥digo fuente, bases de datos, funcionalidad, software, dise√±os de sitios web, audio, video, texto, fotograf√≠as y gr√°ficos de los Servicios (colectivamente, el \"Contenido\"), as√≠ como las marcas comerciales, marcas de servicio y logotipos contenidos en ellas (las \"Marcas\").\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Nuestro Contenido y Marcas est√°n protegidos por leyes de derechos de autor y marcas registradas (y varias otras leyes de derechos de propiedad intelectual y competencia desleal) y tratados alrededor del mundo.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            El Contenido y las Marcas se proporcionan en o a trav√©s de los Servicios \"TAL CUAL\" para su uso personal, no comercial o finalidad empresarial interna.\n                                        </p>\n\n                                        <h3 className=\"text-lg font-bold text-white mt-6 mb-2\">Su uso de nuestros Servicios</h3>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Sujeto a su cumplimiento de estos T√©rminos Legales, incluidos los \"ACTIVIDADES PROHIBIDAS\" en la secci√≥n siguiente, le otorgamos un contrato no exclusivo, intransferible y revocable licencia para:\n                                        </p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2 mb-4\">\n                                            <li>acceder a los Servicios; y</li>\n                                            <li>descargar o imprimir una copia de cualquier parte del Contenido al que haya obtenido acceso correctamente,</li>\n                                        </ul>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">√∫nicamente para tu uso personal, no comercial o finalidad empresarial interna.</p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Salvo lo establecido en esta secci√≥n o en otra parte de nuestros T√©rminos Legales, ninguna parte de los Servicios ni ning√∫n Contenido o Marca podr√°n copiarse ni reproducirse, agregado, republicado, cargado, publicado, mostrado p√∫blicamente, codificado, traducido, transmitido, distribuido, vendido, licenciado o explotado de otro modo para cualquier fin comercial, sin nuestro expreso previo escrito permiso.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Si desea hacer alg√∫n uso de los Servicios, Contenido o Marcas que no sea el establecido en esta secci√≥n o en otra parte de nuestros T√©rminos Legales, dirija su solicitud a nuestro correo de contacto.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section3\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">3. REPRESENTACIONES DE USUARIOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed\">\n                                            Al utilizar los Servicios, usted declara y garantiza que: (1) usted tiene la capacidad legal y acepta cumplir con estos T√©rminos Legales; (2) no eres un menor de edad en la jurisdicci√≥n en la que usted reside; (3) no acceder√°s a los Servicios a trav√©s de medios automatizados o no humanos, ya sea a trav√©s de un bot, script o de otro modo; (4) no utilizar√° los Servicios para ninguna actividad ilegal o no autorizado prop√≥sito; y (5) su uso de los Servicios no violar√° ninguna ley o regulaci√≥n aplicable.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section4\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">4. ACTIVIDADES PROHIBIDAS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            No puede acceder ni utilizar los Servicios para ning√∫n otro prop√≥sito que no sea aquel para el cual los ponemos a disposici√≥n. Los Servicios no podr√°n utilizarse en relaci√≥n con ning√∫n negocio comercial esfuerzo excepto aquellos que est√©n espec√≠ficamente respaldados o aprobados por nosotros.\n                                        </p>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">Como usuario de los Servicios, usted acepta no:</p>\n                                        <ul className=\"list-disc pl-6 text-slate-500 space-y-2\">\n                                            <li>Recuperar sistem√°ticamente datos u otro contenido de los Servicios para crear o compilar, directa o indirectamente, una colecci√≥n, compilaci√≥n, base de datos o directorio sin nuestro permiso por escrito.</li>\n                                            <li>Enga√±arnos, defraudarnos o enga√±arnos a nosotros y a otros usuarios, especialmente en cualquier intento de obtener informaci√≥n confidencial de la cuenta, como las contrase√±as de los usuarios.</li>\n                                            <li>Eludir, deshabilitar o interferir de otro modo con las caracter√≠sticas relacionadas con la seguridad de los Servicios.</li>\n                                            <li>Menospreciar, empa√±ar o da√±ar de otro modo, en nuestra opini√≥n, a nosotros y/o a los Servicios.</li>\n                                            <li>Utilizar cualquier informaci√≥n obtenida de los Servicios para acosar, abusar o da√±ar a otra persona.</li>\n                                            <li>Hacer un uso indebido de nuestros servicios de soporte o presentar informes falsos de abuso o mala conducta.</li>\n                                            <li>Utilice los Servicios de una manera incompatible con las leyes o regulaciones aplicables.</li>\n                                        </ul>\n                                    </section>\n\n                                    <section id=\"section13\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">13. DESCARGO DE RESPONSABILIDAD</h2>\n                                        <p className=\"text-slate-500 leading-relaxed text-xs uppercase tracking-wide border-l-4 border-red-500/50 pl-4 py-2 bg-red-900/5\">\n                                            LOS SERVICIOS SE PRESTAN TAL CUAL Y SEG√öN EST√â DISPONIBLE. USTED ACEPTA QUE SU USO DE LOS SERVICIOS SER√Å BAJO SU PROPIO RIESGO. EN LA M√ÅXIMA MEDIDA PERMITIDA POR LA LEY, RENUNCIAMOS A TODAS LAS GARANT√çAS, EXPRESAS O IMPL√çCITAS, EN RELACI√ìN CON LOS SERVICIOS Y SU USO DE LOS MISMOS.\n                                        </p>\n                                    </section>\n\n                                    <section id=\"section19\" className=\"mb-12\">\n                                        <h2 className=\"text-2xl font-bold text-white mb-4\">19. CONT√ÅCTENOS</h2>\n                                        <p className=\"text-slate-500 leading-relaxed mb-4\">\n                                            Para resolver una queja con respecto a los Servicios o para recibir m√°s informaci√≥n sobre el uso de los Servicios, cont√°ctenos en:\n                                        </p>\n                                        <p className=\"text-2xl font-black text-orange-400\">\n                                            {settings?.storeEmail || 'soporte@tuempresa.com'}\n                                        </p>\n                                    </section>\n\n                                    <button onClick={() => setView('store')} className=\"px-10 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-2xl font-bold transition flex items-center gap-3 border border-slate-700 mt-12\">\n                                        <ArrowLeft className=\"w-5 h-5\" /> Volver a la Tienda\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                    )\n                }\n            </main >\n\n            {/* FOOTER PROFESIONAL (Visible solo fuera del Admin y Auth) */}\n            {\n                view !== 'admin' && view !== 'login' && view !== 'register' && (\n                    <footer className={`pt-16 pb-8 relative overflow-hidden transition-colors duration-300 border-t ${darkMode ? 'bg-[#050505] border-slate-900' : 'bg-slate-100 border-slate-200'}`}>\n                        {/* Decoraci√≥n de Fondo */}\n                        <div className={`absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-orange-500/30 to-transparent`}></div>\n                        <div className={`absolute -top-40 -right-40 w-96 h-96 rounded-full blur-[100px] pointer-events-none ${darkMode ? 'bg-blue-900/5' : 'bg-blue-500/5'}`}></div>\n\n                        <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 grid grid-cols-1 md:grid-cols-4 gap-12 mb-16 relative z-10\">\n                            {/* Columna 1: Marca */}\n                            <div className=\"md:col-span-2 space-y-6\">\n                                <h2 className={`text-3xl font-black tracking-tighter italic ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                    {settingsLoaded ? (settings?.storeName || '') : ''}\n                                    <span className=\"text-orange-500\">{settings?.footerSuffix || '.SF'}</span>\n                                </h2>\n                                <p className={`max-w-sm leading-relaxed text-sm ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                    {settings?.footerDescription || 'Tu destino premium para tecnolog√≠a de vanguardia. Ofrecemos los mejores productos con garant√≠a y soporte especializado. Elevamos tu experiencia digital.'}\n                                </p>\n                                <div className=\"flex gap-3 pt-2 flex-wrap\">\n                                    {settings?.showInstagram !== false && settings?.instagramLink && (\n                                        <button onClick={() => window.open(settings?.instagramLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-pink-400 hover:bg-pink-900/10 hover:border-pink-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-pink-600 hover:bg-pink-50 hover:border-pink-300'}`}>\n                                            <Instagram className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showWhatsapp === true && settings?.whatsappLink && (\n                                        <button onClick={() => window.open(settings?.whatsappLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-green-400 hover:bg-green-900/10 hover:border-green-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-green-600 hover:bg-green-50 hover:border-green-300'}`}>\n                                            <MessageCircle className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showFacebook && settings?.facebookLink && (\n                                        <button onClick={() => window.open(settings?.facebookLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-blue-400 hover:bg-blue-900/10 hover:border-blue-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-blue-600 hover:bg-blue-50 hover:border-blue-300'}`}>\n                                            <Facebook className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTwitter && settings?.twitterLink && (\n                                        <button onClick={() => window.open(settings?.twitterLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-sky-400 hover:bg-sky-900/10 hover:border-sky-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-sky-600 hover:bg-sky-50 hover:border-sky-300'}`}>\n                                            <Twitter className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showTiktok && settings?.tiktokLink && (\n                                        <button onClick={() => window.open(settings?.tiktokLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-rose-400 hover:bg-rose-900/10 hover:border-rose-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-rose-600 hover:bg-rose-50 hover:border-rose-300'}`}>\n                                            <Music className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                    {settings?.showYoutube && settings?.youtubeLink && (\n                                        <button onClick={() => window.open(settings?.youtubeLink, '_blank')} className={`p-2 rounded-lg transition border ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-red-400 hover:bg-red-900/10 hover:border-red-500/30' : 'bg-white text-slate-500 border-slate-200 hover:text-red-600 hover:bg-red-50 hover:border-red-300'}`}>\n                                            <Youtube className=\"w-5 h-5\" />\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n\n                            {/* Columna 2: Quick Links */}\n                            <div className=\"space-y-6\">\n                                <h3 className={`font-bold uppercase tracking-widest text-xs ${darkMode ? 'text-white' : 'text-slate-900'}`}>Enlaces R√°pidos</h3>\n                                <ul className={`space-y-3 text-sm font-medium ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                    <li>\n                                        <button onClick={() => setView('store')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Inicio\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('profile')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Mi Cuenta\n                                        </button>\n                                    </li>\n                                    <li>\n                                        <button onClick={() => setView('guide')} className=\"hover:text-orange-500 transition flex items-center gap-2 group\">\n                                            <span className=\"w-0 group-hover:w-2 h-px bg-orange-500 transition-all duration-300\"></span> Ayuda & Soporte\n                                        </button>\n                                    </li>\n                                </ul>\n                            </div>\n\n                            {/* Columna 3: Soporte */}\n                            {settings?.showFooterContact !== false && (\n                                <div className=\"space-y-6\">\n                                    <h3 className={`font-bold uppercase tracking-widest text-xs ${darkMode ? 'text-white' : 'text-slate-900'}`}>\n                                        {settings?.footerContactTitle || 'Contacto'}\n                                    </h3>\n                                    <p className={`text-sm leading-relaxed mb-4 ${darkMode ? 'text-slate-500' : 'text-slate-600'}`}>\n                                        {settings?.footerContactDescription || '¬øTienes alguna duda? Estamos aqu√≠ para ayudarte.'}\n                                    </p>\n                                    <button\n                                        onClick={() => {\n                                            const type = settings?.footerContactType || 'whatsapp';\n                                            if (type === 'whatsapp' && settings?.whatsappLink) {\n                                                window.open(settings.whatsappLink, '_blank');\n                                            } else if (type === 'instagram' && settings?.instagramLink) {\n                                                window.open(settings.instagramLink, '_blank');\n                                            } else if (type === 'email' && settings?.storeEmail) {\n                                                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${settings.storeEmail}`, '_blank');\n                                            }\n                                        }}\n                                        className={`px-6 py-3 rounded-xl text-sm font-bold transition w-full md:w-auto border ${darkMode ? 'bg-orange-900/10 text-orange-400 border-orange-500/20 hover:bg-orange-500 hover:text-white' : 'bg-orange-50 text-orange-600 border-orange-200 hover:bg-orange-500 hover:text-white hover:border-orange-500'}`}\n                                    >\n                                        {settings?.footerContactButtonText || 'Contactar Soporte'}\n                                    </button>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Copyright Bar */}\n                        <div className={`border-t transition-colors duration-300 ${darkMode ? 'border-slate-900 bg-[#020202]' : 'border-slate-200 bg-slate-200/50'}`}>\n                            <div className=\"max-w-[1400px] mx-auto px-6 md:px-12 py-6 flex flex-col md:flex-row justify-between items-center gap-4\">\n                                <p className={`text-xs font-mono ${darkMode ? 'text-slate-600' : 'text-slate-500'}`}>\n                                    ¬© 2026 Sustore. Todos los derechos reservados.\n                                </p>\n                                <div className=\"flex gap-6\">\n                                    {settings?.showPrivacyPolicy !== false && (\n                                        <span onClick={() => setView('privacy')} className={`text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-orange-500 transition underline underline-offset-4 ${darkMode ? 'text-slate-700 decoration-slate-900' : 'text-slate-500 decoration-slate-300'}`}>Privacy Policy</span>\n                                    )}\n                                    {settings?.showTermsOfService !== false && (\n                                        <span onClick={() => setView('terms')} className={`text-xs font-bold uppercase tracking-wider cursor-pointer hover:text-orange-500 transition underline underline-offset-4 ${darkMode ? 'text-slate-700 decoration-slate-900' : 'text-slate-500 decoration-slate-300'}`}>Terms of Service</span>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n                    </footer>\n                )\n            }\n\n            {/* MODAL: CREAR CATEGOR√çA */}\n            {\n                showCategoryModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-orange-800 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-orange-900/20 text-orange-500\">\n                                <FolderPlus className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-6 text-white\">Nueva Categor√≠a</h3>\n                            <input\n                                type=\"text\"\n                                value={newCategory}\n                                onChange={(e) => setNewCategory(e.target.value)}\n                                className=\"input-cyber w-full p-4 mb-6\"\n                                placeholder=\"Nombre de la categor√≠a\"\n                                autoFocus\n                            />\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => { setNewCategory(''); setShowCategoryModal(false); }}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={createCategoryFn}\n                                    className=\"flex-1 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl font-bold transition shadow-lg shadow-orange-600/30\"\n                                >\n                                    Crear\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            {/* MODAL: VENTA MANUAL */}\n            {\n                showManualSaleModal && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md animate-fade-in-scale p-4\">\n                        <div className=\"glass p-8 rounded-[2rem] max-w-md w-full border border-green-900 shadow-2xl\">\n                            <div className=\"w-16 h-16 rounded-full flex items-center justify-center mb-6 mx-auto bg-green-900/20 text-green-500\">\n                                <DollarSign className=\"w-8 h-8\" />\n                            </div>\n                            <h3 className=\"text-2xl font-black text-center mb-2 text-white\">Venta Manual</h3>\n                            <p className=\"text-center text-slate-400 mb-6\">\n                                {products.find(p => p.id === saleData.productId)?.name}\n                            </p>\n\n                            <div className=\"space-y-4 mb-8\">\n                                <div className=\"grid grid-cols-2 gap-4\">\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Cantidad</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.quantity}\n                                            onChange={(e) => setSaleData({ ...saleData, quantity: parseInt(e.target.value) || 1 })}\n                                            min=\"1\"\n                                        />\n                                    </div>\n                                    <div>\n                                        <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">Precio Unit.</label>\n                                        <input\n                                            type=\"number\"\n                                            className=\"input-cyber w-full p-3\"\n                                            value={saleData.price}\n                                            onChange={(e) => setSaleData({ ...saleData, price: parseFloat(e.target.value) || 0 })}\n                                        />\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"text-[10px] font-bold text-slate-500 uppercase mb-1 block\">M√©todo de Pago</label>\n                                    <select\n                                        className=\"input-cyber w-full p-3\"\n                                        value={saleData.paymentMethod}\n                                        onChange={(e) => setSaleData({ ...saleData, paymentMethod: e.target.value })}\n                                    >\n                                        <option value=\"Efectivo\">Efectivo</option>\n                                        <option value=\"Transferencia\">Transferencia</option>\n                                        <option value=\"Tarjeta\">Tarjeta</option>\n                                    </select>\n                                </div>\n                                <div className=\"bg-slate-900 p-4 rounded-xl flex justify-between items-center border border-slate-800\">\n                                    <span className=\"text-slate-400 font-bold\">Total:</span>\n                                    <span className=\"text-2xl font-black text-green-400\">${(saleData.quantity * saleData.price).toLocaleString()}</span>\n                                </div>\n                            </div>\n\n                            <div className=\"flex gap-3\">\n                                <button\n                                    onClick={() => setShowManualSaleModal(false)}\n                                    className=\"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-bold transition\"\n                                >\n                                    Cancelar\n                                </button>\n                                <button\n                                    onClick={confirmManualSale}\n                                    disabled={isProcessingOrder}\n                                    className=\"flex-1 py-3 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold transition shadow-lg shadow-green-600/30 flex items-center justify-center gap-2\"\n                                >\n                                    {isProcessingOrder ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <CheckCircle className=\"w-5 h-5\" />}\n                                    Confirmar\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n            {/* BOT√ìN FLOTANTE DE WHATSAPP (Solo Plan Negocio/Premium) */}\n            {\n                settings?.showFloatingWhatsapp && settings?.whatsappLink && ['business', 'premium'].includes(settings?.subscriptionPlan) && view !== 'admin' && (\n                    <button\n                        onClick={() => window.open(settings.whatsappLink, '_blank')}\n                        className=\"fixed bottom-24 right-6 z-50 p-4 bg-green-500 rounded-full shadow-[0_0_20px_rgba(34,197,94,0.4)] hover:scale-110 hover:shadow-[0_0_30px_rgba(34,197,94,0.6)] transition-all animate-bounce-slow\"\n                        title=\"Chatea con nosotros\"\n                    >\n                        <MessageCircle className=\"w-8 h-8 text-white fill-white\" />\n                    </button>\n                )\n            }\n\n            <AdminUserDrawer />\n            {/* MODAL: VER PLANES DE SUSCRIPCI√ìN */}\n            {\n                showPlansModal && (\n                    <PlansModalContent settings={settings} onClose={() => setShowPlansModal(false)} />\n                )\n            }\n            {\n                false && (\n                    <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-0 md:p-4 overflow-hidden\">\n                        <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full md:h-auto md:max-h-[90vh] md:max-w-6xl md:rounded-[2.5rem] border-0 md:border md:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n                            {/* Scrollable Content */}\n                            <div className=\"flex-1 overflow-y-auto custom-scrollbar p-6 md:p-10 pb-20\">\n                                {/* Header */}\n                                <div className=\"flex justify-between items-start mb-6\">\n                                    <div>\n                                        <h2 className=\"text-3xl md:text-4xl font-black text-white flex items-center gap-3 mb-2\">\n                                            <div className=\"p-2 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl\">\n                                                <Zap className=\"w-6 h-6 md:w-8 md:h-8 text-white fill-current\" />\n                                            </div>\n                                            Planes Disponibles\n                                        </h2>\n                                        <p className=\"text-slate-500\">Tu plan actual: <span className=\"text-orange-400 font-bold uppercase bg-orange-500/10 px-3 py-1 rounded-full text-sm\">{settings?.subscriptionPlan === 'business' ? 'üöÄ Negocio' : settings?.subscriptionPlan === 'premium' ? 'üíé Premium' : 'üè™ Emprendedor'}</span></p>\n                                    </div>\n                                    <button onClick={() => setShowPlansModal(false)} className=\"p-3 bg-slate-900 hover:bg-slate-800 rounded-2xl text-slate-400 hover:text-white transition-all duration-300 hover:rotate-90\">\n                                        <X className=\"w-6 h-6\" />\n                                    </button>\n                                </div>\n\n                                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12\">\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN EMPRENDEDOR */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan\n                                        ? 'bg-gradient-to-b from-orange-950/40 to-slate-950 border-orange-500 shadow-[0_0_40px_rgba(249,115,22,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-orange-500/50'\n                                        }`}>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {(settings?.subscriptionPlan === 'entrepreneur' || !settings?.subscriptionPlan) && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-orange-500 to-orange-400 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-orange-600 to-orange-500 rounded-2xl shadow-lg shadow-orange-500/30\">\n                                                    <Store className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üöÄ Emprendedor</h4>\n                                                    <p className=\"text-sm text-orange-400 font-medium leading-tight\">Impulso inicial</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$7.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Carga de hasta <strong className=\"text-white\">30 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span>Integraci√≥n <strong className=\"text-white\">Mercado Pago</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-orange-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">1 promoci√≥n</strong> activa</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-orange-500/50 open:shadow-[0_0_20px_rgba(249,115,22,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-orange-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-orange-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$2.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$7.000', label: 'Pago Mensual', sub: 'M√°s equilibrado' },\n                                                        { cycle: 'Anual', price: '$70.000', label: 'Pago Anual', sub: 'Ahorr√°s $14.000 üéÅ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Emprendedor', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-orange-500 text-black border-orange-400 shadow-lg ring-2 ring-orange-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-orange-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Emprendedor' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN NEGOCIO */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'business'\n                                        ? 'bg-gradient-to-b from-purple-950/40 to-slate-950 border-purple-500 shadow-[0_0_40px_rgba(168,85,247,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-purple-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-purple-600 to-fuchsia-600 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20 animate-pulse\">‚≠ê M√ÅS POPULAR</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'business' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-purple-400 text-white text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-purple-600 to-fuchsia-600 rounded-2xl shadow-lg shadow-purple-500/30\">\n                                                    <Briefcase className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üöÄ Negocio</h4>\n                                                    <p className=\"text-sm text-purple-400 font-medium leading-tight\">Escala tu marca</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$13.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span>Hasta <strong className=\"text-white\">50 productos</strong></span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">5 promociones</strong> simult√°neas</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Cupones</strong> de descuento</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-purple-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Anal√≠tica</strong> de clientes</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-purple-500/50 open:shadow-[0_0_20px_rgba(168,85,247,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-purple-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-purple-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$4.000', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$13.000', label: 'Pago Mensual', sub: 'Ideal gesti√≥n mensual' },\n                                                        { cycle: 'Anual', price: '$117.000', label: 'Pago Anual', sub: '3 MESES GRATIS üéâ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Negocio', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-purple-600 text-white border-purple-500 shadow-lg ring-2 ring-purple-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-purple-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Negocio' && selectedPlanOption?.cycle === opt.cycle ? 'text-white/80' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    {/* PLAN PREMIUM */}\n                                    {/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}\n                                    <div className={`group relative rounded-[2rem] border-2 transition-all duration-500 hover:scale-[1.01] overflow-hidden flex flex-col ${settings?.subscriptionPlan === 'premium'\n                                        ? 'bg-gradient-to-b from-yellow-950/40 to-slate-950 border-yellow-500 shadow-[0_0_40px_rgba(234,179,8,0.25)]'\n                                        : 'bg-gradient-to-b from-slate-900/50 to-[#050505] border-slate-800 hover:border-yellow-500/50'\n                                        }`}>\n                                        <div className=\"absolute top-4 right-4 bg-gradient-to-r from-yellow-500 to-amber-600 text-black text-[10px] font-black px-3 py-1 rounded-full shadow-lg z-20\">üíé VIP</div>\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-yellow-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"></div>\n\n                                        {settings?.subscriptionPlan === 'premium' && (\n                                            <div className=\"absolute -top-0 left-1/2 -translate-x-1/2 bg-gradient-to-r from-yellow-500 to-amber-500 text-black text-xs font-black px-5 py-1.5 rounded-b-xl shadow-lg z-20\">‚úì TU PLAN ACTUAL</div>\n                                        )}\n\n                                        <div className=\"relative z-10 p-6 flex-1 flex flex-col\">\n                                            <div className=\"flex items-center gap-4 mb-4\">\n                                                <div className=\"p-4 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-2xl shadow-lg shadow-yellow-500/30\">\n                                                    <Sparkles className=\"w-7 h-7 text-white\" />\n                                                </div>\n                                                <div>\n                                                    <h4 className=\"text-2xl font-black text-white\">üíé Premium</h4>\n                                                    <p className=\"text-sm text-yellow-400 font-medium leading-tight\">Liderazgo total</p>\n                                                </div>\n                                            </div>\n\n                                            <div className=\"bg-black/30 rounded-2xl p-4 mb-5 border border-slate-800\">\n                                                <p className=\"text-xs text-slate-500 uppercase tracking-wider font-bold mb-1\">Desde</p>\n                                                <div className=\"text-4xl font-black text-white\">$22.000 <span className=\"text-lg text-slate-500 font-normal\">/mes</span></div>\n                                            </div>\n\n                                            <div className=\"space-y-3 mb-6 flex-1\">\n                                                <div className=\"space-y-2 text-sm text-slate-300\">\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Ilimitados</strong> productos y promos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Asistente IA</strong> 24/7</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Carga VIP</strong> 10 productos</span></div>\n                                                    <div className=\"flex items-start gap-2\"><CheckCircle className=\"w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0\" /> <span><strong className=\"text-white\">Mantenimiento</strong> Full Mensual</span></div>\n                                                </div>\n                                            </div>\n\n                                            <details className=\"group/payment bg-slate-900/50 rounded-2xl border border-slate-800 overflow-hidden cursor-pointer transition-all duration-300 open:bg-slate-900 open:border-yellow-500/50 open:shadow-[0_0_20px_rgba(234,179,8,0.15)]\">\n                                                <summary className=\"flex items-center justify-between p-4 list-none font-bold text-white text-sm hover:bg-slate-800/50 transition\">\n                                                    <span className=\"flex items-center gap-2 text-yellow-400\">üëá Eleg√≠ tu plan de pago</span>\n                                                    <ChevronDown className=\"w-5 h-5 text-yellow-400 transition-transform duration-300 group-open/payment:rotate-180\" />\n                                                </summary>\n                                                <div className=\"px-3 pb-3 space-y-2 animate-fade-in\">\n                                                    {[\n                                                        { cycle: 'Semanal', price: '$6.500', label: 'Pago Semanal', sub: 'Flexibilidad total' },\n                                                        { cycle: 'Mensual', price: '$22.000', label: 'Pago Mensual', sub: 'Equilibrio perfecto' },\n                                                        { cycle: 'Anual', price: '$198.000', label: 'Pago Anual', sub: '3 MESES GRATIS üéÅ' }\n                                                    ].map((opt) => (\n                                                        <div\n                                                            key={opt.cycle}\n                                                            onClick={() => setSelectedPlanOption({ plan: 'Premium', cycle: opt.cycle, price: opt.price })}\n                                                            className={`flex items-center justify-between p-3 rounded-xl border cursor-pointer transition-all duration-200 transform hover:scale-[1.02] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle\n                                                                ? 'bg-yellow-500 text-black border-yellow-400 shadow-lg ring-2 ring-yellow-500/50 ring-offset-2 ring-offset-[#0a0a0a]'\n                                                                : 'bg-black/40 text-slate-300 border-slate-800 hover:border-yellow-500/50 hover:bg-slate-800'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{opt.label}</div>\n                                                                <div className={`text-[10px] ${selectedPlanOption?.plan === 'Premium' && selectedPlanOption?.cycle === opt.cycle ? 'text-black/70' : 'text-slate-500'}`}>{opt.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-lg\">{opt.price}</div>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </details>\n                                        </div>\n                                    </div>\n                                </div>\n\n                            </div>\n\n                            {/* Sticky Footer */}\n                            <div className=\"border-t border-slate-800 bg-[#0a0a0a] p-6 z-20 shrink-0\">\n                                <div className={`p-4 md:p-6 rounded-2xl border transition-all duration-500 relative overflow-hidden group ${selectedPlanOption\n                                    ? 'bg-gradient-to-r from-green-900/80 to-emerald-900/80 border-green-500 shadow-[0_0_40px_rgba(34,197,94,0.3)]'\n                                    : 'bg-slate-900 border-slate-700 opacity-90'\n                                    }`}>\n                                    <div className=\"absolute inset-0 bg-[url('/noise.svg')] opacity-20\"></div>\n\n                                    <div className=\"relative z-10 flex flex-col md:flex-row items-center justify-between gap-6\">\n                                        <div className=\"flex items-center gap-4 text-left\">\n                                            <div className={`p-3 rounded-full shadow-lg transition-colors duration-300 ${selectedPlanOption ? 'bg-green-500 text-white' : 'bg-slate-700 text-slate-400'}`}>\n                                                {selectedPlanOption ? <CheckCircle className=\"w-8 h-8\" /> : <Zap className=\"w-8 h-8\" />}\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-xl font-bold text-white mb-1\">\n                                                    {selectedPlanOption\n                                                        ? `¬°Excelente elecci√≥n! üöÄ`\n                                                        : 'Seleccion√° una opci√≥n para continuar'}\n                                                </h3>\n                                                <p className={`text-sm ${selectedPlanOption ? 'text-green-300' : 'text-slate-400'}`}>\n                                                    {selectedPlanOption\n                                                        ? <span>Est√°s a un paso de activar tu <strong>Plan {selectedPlanOption.plan}</strong> con pago <strong>{selectedPlanOption.cycle}</strong>.</span>\n                                                        : 'Hac√© clic en una de las opciones de arriba para ver los detalles.'}\n                                                </p>\n                                            </div>\n                                        </div>\n\n                                        {selectedPlanOption && (\n                                            <a\n                                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero suscribirme al *Plan ${selectedPlanOption.plan}* con pago *${selectedPlanOption.cycle}* de ${selectedPlanOption.price}. ¬øC√≥mo seguimos?`)}`}\n                                                target=\"_blank\"\n                                                rel=\"noopener noreferrer\"\n                                                className=\"w-full md:w-auto px-8 py-4 bg-green-500 hover:bg-green-400 text-black font-black text-lg rounded-xl transition-all duration-300 hover:scale-105 shadow-xl shadow-green-500/30 flex items-center justify-center gap-2 animate-bounce-subtle\"\n                                            >\n                                                <MessageCircle className=\"w-6 h-6 fill-current\" />\n                                                Confirmar por WhatsApp\n                                                <ArrowRight className=\"w-5 h-5\" />\n                                            </a>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                )\n            }\n\n            <ConfirmModal\n                isOpen={confirmModal.isOpen}\n                title={confirmModal.title}\n                message={confirmModal.message}\n                onConfirm={confirmModal.onConfirm}\n                onCancel={confirmModal.onCancel || (() => setConfirmModal(prev => ({ ...prev, isOpen: false })))}\n                isDangerous={true}\n                darkMode={darkMode}\n            />\n            {/* --- SUSTIA CHATBOT (AI) --- */}\n            <CategoryModal\n                isOpen={showCategoryModal}\n                onClose={() => setShowCategoryModal(false)}\n                categories={settings?.categories || []}\n                onAdd={(newCat) => setSettings({ ...settings, categories: [...(settings?.categories || []), newCat] })}\n                onRemove={(cat) => setSettings({ ...settings, categories: (settings?.categories || []).filter(c => c !== cat) })}\n                darkMode={darkMode}\n            />\n            <SustIABot\n                settings={settings}\n                products={products}\n                addToCart={(p, q = 1) => manageCart(p, q)}\n                controlPanel={{\n                    setDarkMode: setDarkMode,\n                    openCart: () => setView('cart')\n                }}\n                coupons={coupons}\n            />\n        </div >\n    );\n}\n\n// === COMPONENTE MODAL DE PLANES REFACTORIZADO ===\nconst PlansModalContent = ({ settings, onClose }) => {\n    const [activePlanId, setActivePlanId] = React.useState(null);\n    const [selectedOption, setSelectedOption] = React.useState(null);\n\n    // Clases de color est√°ticas para Tailwind (no interpolar)\n    const colorClasses = {\n        purple: {\n            iconBg: 'bg-purple-600',\n            iconText: 'text-purple-400',\n            price: 'text-purple-400',\n            check: 'text-purple-500',\n            activeBg: 'bg-purple-500',\n            activeBorder: 'border-purple-400',\n            gradient: 'from-purple-900/40 to-slate-900',\n            border: 'border-purple-500/50'\n        },\n        orange: {\n            iconBg: 'bg-orange-600',\n            iconText: 'text-orange-400',\n            price: 'text-orange-400',\n            check: 'text-orange-500',\n            activeBg: 'bg-orange-500',\n            activeBorder: 'border-orange-400',\n            gradient: 'from-orange-900/40 to-slate-900',\n            border: 'border-orange-500/50'\n        },\n        yellow: {\n            iconBg: 'bg-yellow-500',\n            iconText: 'text-yellow-400',\n            price: 'text-yellow-400',\n            check: 'text-yellow-500',\n            activeBg: 'bg-yellow-500',\n            activeBorder: 'border-yellow-400',\n            gradient: 'from-yellow-900/40 to-slate-900',\n            border: 'border-yellow-500/50'\n        }\n    };\n\n    const PLANS = [\n        {\n            id: 'entrepreneur',\n            name: 'Plan Emprendedor',\n            emoji: 'üè™',\n            subtitle: 'El impulso que tu negocio necesita para despegar.',\n            price: '$7.000',\n            features: [\n                'üì¶ Carga de hasta 30 productos',\n                'üí≥ Integraci√≥n con Mercado Pago',\n                'üî• 1 Promoci√≥n activa',\n                'üìä Panel de Control completo',\n                'üìß Soporte t√©cnico v√≠a Gmail'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$2.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$7.000', sub: 'Opci√≥n equilibrada' },\n                { id: 'annual', label: 'Anual', price: '$70.000', sub: 'üéÅ 2 MESES GRATIS' }\n            ],\n            color: 'orange',\n            icon: Store\n        },\n        {\n            id: 'business',\n            name: 'Plan Negocio',\n            emoji: 'üöÄ',\n            subtitle: 'Para marcas con identidad que buscan escalar.',\n            price: '$13.000',\n            popular: true,\n            features: [\n                'üì¶ Hasta 50 productos',\n                'üî• 5 Promociones simult√°neas',\n                'üé´ Sistema de cupones',\n                'üìä Anal√≠tica de clientes',\n                'üì≤ Bot√≥n WhatsApp flotante'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$4.000', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$13.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$117.000', sub: 'üéÅ 3 MESES GRATIS' }\n            ],\n            color: 'purple',\n            icon: Briefcase\n        },\n        {\n            id: 'premium',\n            name: 'Plan Premium',\n            emoji: 'üíé',\n            subtitle: 'Automatizaci√≥n total y cero preocupaciones.',\n            price: '$22.000',\n            features: [\n                'üöÄ Productos ilimitados',\n                'ü§ñ Asistente IA 24/7',\n                '‚ú® Carga VIP (10 productos)',\n                'üõ†Ô∏è Mantenimiento mensual',\n                'üì≤ Omnicanalidad total'\n            ],\n            cycles: [\n                { id: 'weekly', label: 'Semanal', price: '$6.500', sub: 'Flexibilidad total' },\n                { id: 'monthly', label: 'Mensual', price: '$22.000', sub: 'Equilibrio perfecto' },\n                { id: 'annual', label: 'Anual', price: '$198.000', sub: 'üéÅ 3 MESES GRATIS' }\n            ],\n            color: 'yellow',\n            icon: Sparkles\n        }\n    ];\n\n    return (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/95 backdrop-blur-xl animate-fade-in-scale p-2 sm:p-4 overflow-hidden\">\n            <div className=\"bg-gradient-to-b from-[#0d0d0d] to-[#050505] relative w-full h-full sm:h-auto sm:max-h-[95vh] sm:max-w-5xl sm:rounded-3xl border-0 sm:border sm:border-slate-800/50 shadow-2xl flex flex-col overflow-hidden\">\n\n                {/* Header */}\n                <div className=\"flex justify-between items-center p-4 sm:p-6 border-b border-slate-800/50 shrink-0\">\n                    <div>\n                        <h2 className=\"text-xl sm:text-3xl font-black text-white flex items-center gap-2 sm:gap-3\">\n                            <Zap className=\"w-6 h-6 sm:w-8 sm:h-8 text-yellow-500 fill-current\" /> Planes Disponibles\n                        </h2>\n                        <p className=\"text-slate-500 text-xs sm:text-sm mt-1\">Eleg√≠ un plan y seleccion√° tu forma de pago</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 sm:p-3 bg-slate-800 hover:bg-slate-700 rounded-full text-white transition-all hover:rotate-90\">\n                        <X className=\"w-5 h-5 sm:w-6 sm:h-6\" />\n                    </button>\n                </div>\n\n                {/* Scrollable Content */}\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-5\">\n                        {PLANS.map(plan => {\n                            const isActive = activePlanId === plan.id;\n                            const isCurrentPlan = settings?.subscriptionPlan === plan.id || (!settings?.subscriptionPlan && plan.id === 'entrepreneur');\n                            const Icon = plan.icon;\n                            const colors = colorClasses[plan.color];\n\n                            return (\n                                <div\n                                    key={plan.id}\n                                    onClick={() => setActivePlanId(isActive ? null : plan.id)}\n                                    className={`relative rounded-2xl sm:rounded-3xl border-2 transition-all duration-300 overflow-hidden cursor-pointer flex flex-col\n                                        ${isActive\n                                            ? `bg-gradient-to-b ${colors.gradient} ${colors.border} shadow-xl scale-[1.01]`\n                                            : 'bg-[#111] border-slate-800 hover:border-slate-600'\n                                        }`}\n                                >\n                                    {/* Popular Badge */}\n                                    {plan.popular && (\n                                        <div className=\"absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[10px] font-black px-3 py-1 rounded-bl-xl\">\n                                            POPULAR\n                                        </div>\n                                    )}\n\n                                    {/* Current Plan Badge */}\n                                    {isCurrentPlan && (\n                                        <div className=\"absolute top-0 left-1/2 -translate-x-1/2 bg-white/10 backdrop-blur text-white text-[10px] font-bold px-3 py-1 rounded-b-lg border border-white/20\">\n                                            ‚úì TU PLAN\n                                        </div>\n                                    )}\n\n                                    <div className=\"p-4 sm:p-5 flex-1 flex flex-col\">\n                                        {/* Header */}\n                                        <div className=\"flex items-center gap-3 mb-3\">\n                                            <div className={`p-2.5 sm:p-3 rounded-xl ${colors.iconBg} shadow-lg`}>\n                                                <Icon className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                                            </div>\n                                            <div>\n                                                <h3 className=\"text-lg sm:text-xl font-black text-white\">{plan.name}</h3>\n                                                <p className=\"text-[11px] sm:text-xs text-slate-500\">{plan.subtitle}</p>\n                                            </div>\n                                        </div>\n\n                                        {/* Price */}\n                                        <div className={`text-2xl sm:text-3xl font-black ${colors.price} mb-4`}>\n                                            {plan.price} <span className=\"text-sm text-slate-500 font-normal\">/mes</span>\n                                        </div>\n\n                                        {/* Features */}\n                                        <div className=\"space-y-2 mb-4 flex-1\">\n                                            {plan.features.map((feat, i) => (\n                                                <div key={i} className=\"flex items-start gap-2 text-xs sm:text-sm text-slate-300\">\n                                                    <CheckCircle className={`w-3.5 h-3.5 sm:w-4 sm:h-4 ${colors.check} shrink-0 mt-0.5`} />\n                                                    <span>{feat}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n\n                                        {/* Expand/Collapse Indicator */}\n                                        <button\n                                            className={`w-full py-2 text-xs font-bold uppercase tracking-wider rounded-lg transition-all flex items-center justify-center gap-2\n                                                ${isActive ? 'bg-white/5 text-white' : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50'}`}\n                                        >\n                                            {isActive ? 'Eleg√≠ tu forma de pago' : 'Ver opciones de pago'}\n                                            <ChevronDown className={`w-4 h-4 transition-transform ${isActive ? 'rotate-180' : ''}`} />\n                                        </button>\n\n                                        {/* Payment Options (Expandable) */}\n                                        <div className={`transition-all duration-300 overflow-hidden ${isActive ? 'max-h-[400px] opacity-100 mt-4' : 'max-h-0 opacity-0'}`}>\n                                            <div className=\"space-y-2 pt-4 border-t border-white/10\">\n                                                {plan.cycles.map(cycle => {\n                                                    const isSelected = selectedOption?.price === cycle.price && selectedOption?.plan === plan.name;\n                                                    return (\n                                                        <button\n                                                            key={cycle.id}\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setSelectedOption({ plan: plan.name, cycle: cycle.label, price: cycle.price, sub: cycle.sub, emoji: plan.emoji });\n                                                            }}\n                                                            className={`w-full text-left p-3 rounded-xl border-2 transition-all flex justify-between items-center\n                                                                ${isSelected\n                                                                    ? `${colors.activeBg} text-black ${colors.activeBorder} shadow-lg`\n                                                                    : 'bg-slate-900/50 border-slate-700 hover:bg-slate-800 text-slate-300 hover:border-slate-500'\n                                                                }`}\n                                                        >\n                                                            <div>\n                                                                <div className=\"font-bold text-sm\">{cycle.label}</div>\n                                                                <div className={`text-[10px] ${isSelected ? 'text-black/70' : 'text-slate-500'}`}>{cycle.sub}</div>\n                                                            </div>\n                                                            <div className=\"font-black text-base sm:text-lg\">{cycle.price}</div>\n                                                        </button>\n                                                    );\n                                                })}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n\n                {/* Sticky Footer CTA */}\n                {selectedOption && (\n                    <div className=\"border-t border-slate-800 bg-gradient-to-r from-green-900/30 to-emerald-900/30 p-3 sm:p-5 shrink-0 animate-slide-up\">\n                        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-3 max-w-4xl mx-auto\">\n                            <div className=\"text-center sm:text-left\">\n                                <p className=\"text-white text-sm sm:text-base font-bold\">\n                                    {selectedOption.emoji} {selectedOption.plan} ‚Ä¢ <span className=\"text-green-400\">{selectedOption.cycle}</span>\n                                </p>\n                                <p className=\"text-slate-400 text-xs\">{selectedOption.sub} ‚Ä¢ {selectedOption.price}</p>\n                            </div>\n                            <a\n                                href={`https://wa.me/5493425906300?text=${encodeURIComponent(`Hola! Quiero contratar el *${selectedOption.plan}* con pago *${selectedOption.cycle}* (${selectedOption.price}). ¬øC√≥mo sigo?`)}`}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"w-full sm:w-auto px-6 py-3 bg-green-500 hover:bg-green-400 text-black font-black text-sm sm:text-base rounded-xl transition shadow-lg shadow-green-500/30 flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5 fill-current\" /> Confirmar por WhatsApp\n                            </a>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n};\n\n// Fallback para Acceso Denegado\nconst AccessDenied = ({ onBack }) => (\n    <div className=\"min-h-screen bg-black flex items-center justify-center p-4 animate-fade-in\">\n        <div className=\"text-center max-w-md\">\n            <div className=\"w-20 h-20 bg-red-900/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-900/50\">\n                <Shield className=\"w-10 h-10\" />\n            </div>\n            <h1 className=\"text-3xl font-black text-white mb-2\">ACCESO DENEGADO</h1>\n            <p className=\"text-slate-500 mb-8\">No tienes los permisos necesarios para acceder al Panel de Administraci√≥n.</p>\n            <button onClick={onBack} className=\"px-8 py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition flex items-center gap-2 mx-auto border border-slate-700\">\n                <ArrowLeft className=\"w-4 h-4\" /> Volver a la Tienda\n            </button>\n        </div>\n    </div>\n);\n\n// Renderizado Final\nconst rootElement = document.getElementById('root');\nif (!rootElement) {\n    throw new Error('No se encontr√≥ el contenedor #root');\n}\nconst root = createRoot(rootElement);\nroot.render(\n    <ErrorBoundary>\n        <App />\n    </ErrorBoundary>\n);\n"],
  "mappings": "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",
  "names": ["React", "useState", "useEffect", "useRef", "useMemo", "useCallback", "createRoot", "ShoppingBag", "X", "User", "Search", "Zap", "CheckCircle", "MessageCircle", "Instagram", "Minus", "Heart", "Tag", "Plus", "Trash2", "Edit", "AlertTriangle", "RefreshCw", "Send", "LogOut", "Mail", "CreditCard", "Menu", "Home", "Info", "FileQuestion", "Users", "Package", "LayoutDashboard", "Settings", "Ticket", "Truck", "Wallet", "FileText", "ArrowRight", "ArrowLeft", "DollarSign", "ChevronRight", "TrendingUp", "TrendingDown", "Briefcase", "Save", "AlertCircle", "Phone", "MapPin", "Copy", "ExternalLink", "Shield", "ShoppingCart", "Play", "FolderPlus", "Eye", "EyeOff", "Clock", "Calendar", "Gift", "Lock", "Loader2", "Star", "Percent", "Sparkles", "Flame", "ImageIcon", "Filter", "ChevronDown", "Store", "BarChart", "Globe", "Headphones", "Palette", "Share2", "Cog", "Facebook", "Twitter", "Youtube", "Bell", "Music", "Building", "Banknote", "UserPlus", "Maximize2", "Sun", "Moon", "Upload", "initializeApp", "getAuth", "signInAnonymously", "onAuthStateChanged", "signInWithCustomToken", "sendPasswordResetEmail", "signInWithEmailAndPassword", "createUserWithEmailAndPassword", "getFirestore", "collection", "addDoc", "onSnapshot", "query", "updateDoc", "doc", "getDocs", "deleteDoc", "where", "writeBatch", "getDoc", "increment", "setDoc", "orderBy", "limit", "startAfter", "firebaseConfig", "app", "auth", "db", "DEFAULT_APP_ID", "APP_VERSION", "mpPublicKeyPromise", "getMercadoPagoPublicKey", "res", "data", "setupSmoothWheelScroll", "getDocumentScrollingElement", "elementStates", "clamp", "value", "min", "max", "maxScrollTopForEl", "el", "isScrollable", "overflowY", "findScrollableAncestor", "startEl", "getState", "existing", "state", "animateElement", "ts", "dt", "friction", "current", "next", "nextTs", "onWheel", "e", "targetEl", "scrollEl", "deltaX", "deltaY", "strength", "onResize", "docEl", "_sa", "SUPER_ADMIN_EMAIL", "SecurityManager", "base", "timestamp", "password", "encoder", "salt", "hashBuffer", "b", "hash", "email", "key", "now", "record", "str", "i", "char", "userId", "payload", "token", "signature", "fullToken", "toSign", "stored", "payloadB64", "userData", "input", "a", "aBytes", "bBytes", "result", "noop", "method", "widthDiff", "heightDiff", "defaultSettings", "HomeBannerCarouselBackground", "settingsLoaded", "banners", "fallbackUrl", "autoplayMs", "darkMode", "onBannerClick", "slides", "useMemo", "b", "activeIndex", "setActiveIndex", "useState", "isPaused", "setIsPaused", "useEffect", "effectiveAutoplayMs", "shouldAutoplay", "id", "i", "next", "img", "activeSlide", "hasTarget", "type", "imageOpacity", "imageClass", "goPrev", "goNext", "React", "slide", "idx", "e", "ArrowLeft", "ArrowRight", "_", "Toast", "message", "onClose", "containerClass", "iconContainerClass", "IconComponent", "Info", "CheckCircle", "AlertCircle", "AlertTriangle", "t", "X", "ConfirmModal", "isOpen", "title", "onConfirm", "onCancel", "confirmText", "cancelText", "isDangerous", "ErrorBoundary", "props", "error", "errorInfo", "QuickAddButton", "product", "onAdd", "qty", "setQty", "added", "setAdded", "handleAdd", "isMax", "isMin", "Minus", "Plus", "ProductCard", "p", "settings", "currentUser", "toggleFavorite", "setSelectedProduct", "manageCart", "calculateItemPrice", "cardBg", "cardBorder", "cardHoverBorder", "cardShadow", "imageBg", "textPrimary", "textSecondary", "infoBg", "borderColor", "Maximize2", "ImageIcon", "Star", "Heart", "prev", "BotProductCard", "hasStock", "SustIABot", "products", "addToCart", "controlPanel", "coupons", "setIsOpen", "botImage", "chatStorageKey", "DEFAULT_APP_ID", "defaultBotMessage", "messages", "setMessages", "inputValue", "setInputValue", "isTyping", "setIsTyping", "lastContext", "setLastContext", "messagesEndRef", "useRef", "messagesRef", "inFlightRef", "pendingTextRef", "isMountedRef", "safeProducts", "safeCoupons", "aiEnabled", "normalizeText", "value", "tokenize", "raw", "stop", "w", "parseHumanNumber", "rawNumber", "contextText", "n", "parseQuantity", "text", "m1", "m2", "m3", "getProductCategories", "cats", "c", "getProductFinalPrice", "base", "disc", "aiContext", "storeName", "aboutUsText", "deliveryEnabled", "pickupEnabled", "deliveryFee", "freeAbove", "pickupAddress", "shippingParts", "hasCard", "hasTransfer", "hasCash", "payParts", "categories", "productHints", "a", "callExternalAI", "userText", "history", "signal", "res", "data", "fuzzySearch", "query", "str", "patt", "matches", "lastIndex", "char", "index", "callLocalBrain", "currentMessages", "resolve", "prodCats", "about", "lines", "wantsTransferData", "options", "holderName", "alias", "cbu", "o", "activeCoupons", "deals", "ctx", "isCheaper", "isExpensive", "isBuying", "minPrice", "maxPrice", "lessThanMatch", "parsed", "betweenMatch", "parsedMin", "parsedMax", "availableCategories", "detectedCategoryVal", "targetCategory", "synonyms", "keywords", "k", "alt", "candidates", "fp", "score", "pName", "pDesc", "pCats", "lastModelMsg", "m", "suggestionText", "topMatches", "best", "suggestions", "msg", "withTimeout", "promise", "ms", "timeoutId", "timeoutPromise", "reject", "sendText", "rawText", "opts", "alreadyAddedUser", "newMsgUserQueued", "newMsgUser", "updatedHistory", "localResponse", "finalText", "controller", "aiRes", "fallback", "pending", "handleSend", "handleQuickAction", "Trash2", "Send", "prevProps", "nextProps", "CategoryModal", "onRemove", "catName", "setCatName", "FolderPlus", "cat", "ADMIN_PANEL_GUIDES", "AdminHowToUse", "guideKey", "guide", "FileQuestion", "section", "App", "view", "setView", "adminTab", "setAdminTab", "expenses", "setExpenses", "investments", "setInvestments", "purchases", "setPurchases", "confirmModal", "setConfirmModal", "isMenuOpen", "setIsMenuOpen", "isAdminMenuOpen", "setIsAdminMenuOpen", "setDarkMode", "saved", "appId", "setAppId", "storeResolution", "setStoreResolution", "storeSetupStoreIdInput", "setStoreSetupStoreIdInput", "isStoreSetupSaving", "setIsStoreSetupSaving", "isExportingBackup", "setIsExportingBackup", "isImportingBackup", "setIsImportingBackup", "setCurrentUser", "userData", "systemUser", "setSystemUser", "isLoading", "setIsLoading", "isProcessingOrder", "setIsProcessingOrder", "toasts", "setToasts", "adminOrderAlarmMuted", "setAdminOrderAlarmMuted", "orderAlarmContextRef", "orderAlarmIntervalRef", "orderAlarmActiveRef", "orderAlarmToastShownRef", "orderAlarmUnlockListenerActiveRef", "lastOrdersSeenWriteRef", "setProducts", "promos", "setPromos", "homeBanners", "setHomeBanners", "cart", "setCart", "cartHydratedFromRemoteRef", "liveCarts", "setLiveCarts", "orders", "setOrders", "users", "setUsers", "setCoupons", "suppliers", "setSuppliers", "setSettings", "defaultSettings", "setSettingsLoaded", "searchQuery", "setSearchQuery", "selectedCategory", "setSelectedCategory", "categoriesScrollRef", "isDraggingCategories", "setIsDraggingCategories", "startXCategories", "setStartXCategories", "scrollLeftCategories", "setScrollLeftCategories", "handleMouseDownCategories", "handleMouseLeaveCategories", "handleMouseUpCategories", "handleMouseMoveCategories", "walk", "authData", "setAuthData", "loginMode", "setLoginMode", "newExpense", "setNewExpense", "newInvestment", "setNewInvestment", "newPurchase", "setNewPurchase", "newHomeBanner", "setNewHomeBanner", "editingHomeBannerId", "setEditingHomeBannerId", "newSupplier", "setNewSupplier", "editingSupplierId", "setEditingSupplierId", "showSupplierModal", "setShowSupplierModal", "purchaseCart", "setPurchaseCart", "showCategoryModal", "setShowCategoryModal", "selectedProduct", "openConfirm", "downloadJsonFile", "filename", "obj", "blob", "url", "exportBackup", "auth", "token", "safeDate", "showToast", "importBackupFile", "file", "getPlanLimit", "plan", "getPlanAllowsCoupons", "handlePlanChange", "newPlan", "currentPlan", "currentLimit", "newLimit", "activeProducts", "productsToDeactivate", "couponsToDeactivate", "sortedProducts", "salesA", "updateDoc", "doc", "db", "coupon", "setPlanDowngradeInfo", "reactivateProduct", "productId", "limit", "deactivateProduct", "checkoutData", "setCheckoutData", "appliedCoupon", "setAppliedCoupon", "showCouponModal", "setShowCouponModal", "newProduct", "setNewProduct", "editingId", "setEditingId", "showProductForm", "setShowProductForm", "settingsTab", "setSettingsTab", "newPromo", "setNewPromo", "promoSearch", "setPromoSearch", "selectedPromoProduct", "setSelectedPromoProduct", "promoProductQty", "setPromoProductQty", "isEditingPromo", "setIsEditingPromo", "editingPromoId", "setEditingPromoId", "newCoupon", "setNewCoupon", "editingPurchase", "setEditingPurchase", "aboutText", "setAboutText", "newCategory", "setNewCategory", "newTeamMember", "setNewTeamMember", "selectedOrder", "setSelectedOrder", "ordersLimit", "setOrdersLimit", "ordersCursor", "setOrdersCursor", "ordersHistory", "setOrdersHistory", "hasMoreOrders", "setHasMoreOrders", "showManualSaleModal", "setShowManualSaleModal", "metricsDetail", "setMetricsDetail", "showLeastSold", "setShowLeastSold", "saleData", "setSaleData", "viewUserCart", "setViewUserCart", "userPassModal", "setUserPassModal", "viewUserEdit", "setViewUserEdit", "newAdminPassword", "setNewAdminPassword", "userSearch", "setUserSearch", "userRoleFilter", "setUserRoleFilter", "showPlansModal", "setShowPlansModal", "selectedPlanOption", "setSelectedPlanOption", "planDowngradeInfo", "mpBrickController", "setMpBrickController", "isPaymentProcessing", "setIsPaymentProcessing", "paymentError", "setPaymentError", "isInitializingBrick", "cardPaymentBrickRef", "openManualSaleModal", "confirmManualSale", "productRef", "productSnap", "getDoc", "currentStock", "total", "newOrder", "addDoc", "collection", "increment", "fileInputRef", "removeToast", "handleHomeBannerClick", "targetType", "targetId", "promo", "maxPurchasable", "item", "prod", "pStock", "maxForThisItem", "getRole", "email", "cleanEmail", "SUPER_ADMIN_EMAIL", "member", "userDoc", "u", "isAdmin", "isEditor", "isRoleLoading", "hasAccess", "role", "isAdminUser", "isSuperAdminSession", "latestOrderIso", "v", "ordersLastSeenIso", "hasUnseenOrders", "toggleAdminOrderAlarmMuted", "useCallback", "stopOrderAlarm", "markOrdersSeen", "iso", "startOrderAlarm", "AudioContextCtor", "scheduleBeep", "at", "osc", "gain", "tick", "now", "rawHostname", "normalizedHostname", "cancelled", "snap", "storeId", "createStoreId", "rand", "bootstrapStoreData", "nowIso", "setDoc", "APP_VERSION", "registerHostname", "hostname", "normalizedStoreId", "debounceTimer", "remoteItems", "normalizedRemote", "prevCart", "hasChanges", "newCart", "currentProduct", "configRef", "unsubscribe", "onSnapshot", "didBootstrap", "isBootstrapping", "bootstrapAuth", "signInWithCustomToken", "signInAnonymously", "onAuthStateChanged", "user", "userDocRef", "primaryColor", "secondaryColor", "accentColor", "styleEl", "lightModeStyle", "unsubscribeFunctions", "snapshot", "productsData", "d", "team", "teamRoles", "mergedSettings", "promosSnap", "getDocs", "bannersSnap", "ao", "bo", "ad", "bd", "couponsSnap", "unsub", "isAuthenticatedUser", "isAdminViewActive", "ordersRef", "q", "constraints", "orderBy", "startAfter", "where", "ordersData", "getDateMs", "err", "handleNextOrders", "lastId", "handlePrevOrders", "prevCursor", "activeCarts", "productsById", "map", "lastSyncedCartRef", "changed", "removed", "validated", "itemId", "productInStore", "comp", "cid", "cp", "fresh", "payload", "lastSavedSettingsRef", "currentSettingsStr", "autoSaveTimer", "settingsRef", "settingsToSave", "updateMetaTag", "selector", "content", "element", "updateMetaTagById", "updateLinkTag", "href", "pageTitle", "description", "author", "ogImage", "link", "canvas", "handleAuth", "isRegister", "superAdminAttempt", "isLocalhost", "usersPath", "fetchProfile", "uid", "setupProfile", "firebaseUser", "claimLegacyProfile", "normalizedEmail", "userCredential", "createUserWithEmailAndPassword", "profile", "normalizedEmailLower", "superEmailLower", "normalizedProfile", "input", "emailToUse", "authUser", "signInWithEmailAndPassword", "code", "bootRes", "bootData", "minimal", "handleForgotPassword", "sendPasswordResetEmail", "currentFavs", "isAlreadyFav", "newFavs", "userRef", "quantityDelta", "existingItemIndex", "newQuantity", "updatedCart", "basePrice", "discount", "discounted", "cartSubtotal", "price", "calculateDiscountAmount", "discountValue", "buildWhatsappUrl", "baseLink", "trimmed", "digits", "isCouponValidForWhatsapp", "buildWhatsappCartMessage", "currency", "userBits", "name", "quantity", "unit", "lineTotal", "couponToUse", "couponDiscount", "messageSubtotal", "messageShipping", "shippingFee", "messageTotal", "shippingLabel", "discountAmount", "deliverySettings", "finalTotal", "selectCoupon", "sendOrderConfirmationEmail", "orderData", "discountDetails", "getAuthenticatedUser", "existing", "hydrated", "confirmOrder", "effectiveUser", "initializeCardPaymentBrick", "s", "safeAmount", "safetyTimeout", "containerElem", "publicKey", "getMercadoPagoPublicKey", "bricksBuilder", "cardFormData", "response", "result", "confirmOrderAfterPayment", "detailedError", "mpPaymentId", "isCheckoutView", "isMP", "timer", "saveProductFn", "MAX_PRODUCTS_ENTREPRENEUR", "MAX_PRODUCTS_BUSINESS", "isEntrepreneur", "isBusiness", "productData", "handleImageUpload", "setTargetState", "imageField", "maxWidth", "reader", "event", "MAX_WIDTH", "MAX_HEIGHT", "width", "height", "dataUrl", "resetHomeBannerForm", "editHomeBannerFn", "banner", "saveHomeBannerFn", "orderValue", "deleteHomeBannerFn", "deleteDoc", "deleteProductFn", "handleManualSale", "finalizeOrderFn", "orderId", "deleteOrderFn", "orderRef", "orderSnap", "saveCouponFn", "couponData", "saveSupplierFn", "supplierData", "deletePurchaseFn", "purchase", "updatePurchaseFn", "pId", "oldData", "newData", "qtyDiff", "createCategoryFn", "updatedCategories", "addToPurchaseCart", "supplierId", "productPrice", "cost", "existingIndex", "updated", "removeFromPurchaseCart", "updatePurchaseCartItem", "finalizePurchaseOrder", "batch", "writeBatch", "batchId", "timestamp", "newPurchaseRef", "newStock", "dashboardMetrics", "productStats", "initStats", "pid", "validOrders", "revenue", "acc", "expensesTotal", "purchasesTotal", "netIncome", "salesCount", "productMetadata", "trendingProducts", "stats", "liveProd", "meta", "starProductId", "maxSales", "count", "starProduct", "liveStar", "leastSoldProductId", "minSales", "leastSoldProduct", "timeline", "categoryStats", "dayKey", "monthKey", "yearKey", "agg", "key", "amount", "analytics", "totalSalesVolume", "salesByCategory", "lowStockThreshold", "lowStockProducts", "recentActivity", "transactions", "OrderDetailsModal", "order", "Clock", "User", "Truck", "CreditCard", "Package", "Ticket", "CouponSelectorModal", "availableCoupons", "isNotExpired", "isUserTarget", "isGlobal", "usedCount", "notExhausted", "userNotUsed", "Gift", "canApply", "ProductDetailModal", "isPromo", "stockLimit", "cartItem", "inCartQty", "availableToAdd", "isMaxInCart", "displayPrice", "itemToAdd", "Sparkles", "ShoppingCart", "ManualSaleModal", "handleProductChange", "Store", "MetricsDetailModal", "timeframe", "setTimeframe", "colorClass", "sortedByVal", "bestPeriod", "worstPeriod", "BarChart", "TrendingUp", "TrendingDown", "maxVal", "heightPct", "UserCartView", "cartItems", "Loader2", "UserEditForm", "initialData", "onSubmit", "onDelete", "isSaving", "formData", "setFormData", "isSuperAdminProfile", "Lock", "r", "Save", "AdminUserDrawer", "userCartItems", "setUserCartItems", "isLoadingCart", "setIsLoadingCart", "setIsSaving", "active", "initialFormState", "setInitialFormState", "cartDoc", "closeDrawer", "handleEditSubmit", "authUpdate", "firestoreUpdate", "handleDeleteUser", "loadingPrimaryColor", "Zap", "filteredProducts", "matchesSearch", "matchesCategory", "newStoreId", "Menu", "Search", "MessageCircle", "Instagram", "Moon", "Sun", "ShoppingBag", "Home", "Shield", "Flame", "Headphones", "Filter", "Percent", "Tag", "promoProduct", "MapPin", "RefreshCw", "Banknote", "Building", "Mail", "Phone", "LogOut", "myCoupons", "purchasedItems", "fid", "step", "SecurityManager", "LayoutDashboard", "Wallet", "Settings", "Users", "DollarSign", "maxRev", "x", "percentage", "monthExpenses", "totalVol", "revPct", "FileText", "Edit", "autoCost", "selectedProd", "targetProductName", "calculatedCost", "sup", "original", "inv", "ex", "memberInvestments", "totalInv", "totalCapital", "pct", "colors", "sharePercentage", "memberProfit", "Globe", "Copy", "filteredUsers", "matchesRole", "UserPlus", "exists", "totalCost", "profit", "margin", "isProfitable", "Bell", "Eye", "ChevronRight", "current", "isNearLimit", "deactivatedByPlan", "deactivatedManually", "totalDeactivated", "isSelected", "EyeOff", "Palette", "Share2", "Cog", "tab", "Briefcase", "Calendar", "cycle", "Play", "seconds", "safeSeconds", "targetItem", "targetName", "isEnabled", "Facebook", "Twitter", "Music", "Youtube", "Upload", "ExternalLink", "names", "curr", "AccessDenied", "PlansModalContent", "newCat", "activePlanId", "setActivePlanId", "selectedOption", "setSelectedOption", "colorClasses", "isActive", "isCurrentPlan", "Icon", "feat", "ChevronDown", "onBack", "rootElement", "root", "createRoot"]
}
